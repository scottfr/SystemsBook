<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><Setting unfolding="{&quot;children&quot;:[{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;Letâ€™s make our agent based disease model from earlier more realistic. We will add a variable &lt;span class=\'primitive\'&gt;Fraction Infected&lt;/span&gt; that calculates what fraction of the population is currently infected. We will then use this variable to determine the infection rate so the more people in the population who are infected, the faster the disease will spread.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nvar doc = mxUtils.parseXml(\\&quot;&lt;mxGraphModel&gt;  &lt;root&gt;    &lt;mxCell id=\\\\\\&quot;0\\\\\\&quot;/&gt;    &lt;mxCell id=\\\\\\&quot;1\\\\\\&quot; parent=\\\\\\&quot;0\\\\\\&quot;/&gt;    &lt;Folder name=\\\\\\&quot;Person\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Type=\\\\\\&quot;Agent\\\\\\&quot; Image=\\\\\\&quot;None\\\\\\&quot; FlipHorizontal=\\\\\\&quot;false\\\\\\&quot; FlipVertical=\\\\\\&quot;false\\\\\\&quot; LabelPosition=\\\\\\&quot;Middle\\\\\\&quot; id=\\\\\\&quot;28\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;folder\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot; parent=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;450\\\\\\&quot; y=\\\\\\&quot;100\\\\\\&quot; width=\\\\\\&quot;140\\\\\\&quot; height=\\\\\\&quot;320\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/Folder&gt;    &lt;State name=\\\\\\&quot;Healthy\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Active=\\\\\\&quot;True\\\\\\&quot; Image=\\\\\\&quot;None\\\\\\&quot; FlipHorizontal=\\\\\\&quot;false\\\\\\&quot; FlipVertical=\\\\\\&quot;false\\\\\\&quot; LabelPosition=\\\\\\&quot;Middle\\\\\\&quot; id=\\\\\\&quot;23\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;state\\\\\\&quot; parent=\\\\\\&quot;28\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;20\\\\\\&quot; y=\\\\\\&quot;20\\\\\\&quot; width=\\\\\\&quot;100\\\\\\&quot; height=\\\\\\&quot;40\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/State&gt;    &lt;State name=\\\\\\&quot;Infected\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Active=\\\\\\&quot;false\\\\\\&quot; Image=\\\\\\&quot;None\\\\\\&quot; FlipHorizontal=\\\\\\&quot;false\\\\\\&quot; FlipVertical=\\\\\\&quot;false\\\\\\&quot; LabelPosition=\\\\\\&quot;Middle\\\\\\&quot; id=\\\\\\&quot;24\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;state\\\\\\&quot; parent=\\\\\\&quot;28\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;20\\\\\\&quot; y=\\\\\\&quot;140\\\\\\&quot; width=\\\\\\&quot;100\\\\\\&quot; height=\\\\\\&quot;40\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/State&gt;    &lt;State name=\\\\\\&quot;Recovered\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Active=\\\\\\&quot;false\\\\\\&quot; Image=\\\\\\&quot;None\\\\\\&quot; FlipHorizontal=\\\\\\&quot;false\\\\\\&quot; FlipVertical=\\\\\\&quot;false\\\\\\&quot; LabelPosition=\\\\\\&quot;Middle\\\\\\&quot; id=\\\\\\&quot;25\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;state\\\\\\&quot; parent=\\\\\\&quot;28\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;20\\\\\\&quot; y=\\\\\\&quot;260\\\\\\&quot; width=\\\\\\&quot;100\\\\\\&quot; height=\\\\\\&quot;40\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/State&gt;    &lt;Transition name=\\\\\\&quot;Infection\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Trigger=\\\\\\&quot;Probability\\\\\\&quot; Value=\\\\\\&quot;0.3\\\\\\&quot; Units=\\\\\\&quot;Unitless\\\\\\&quot; MaxConstraintUsed=\\\\\\&quot;false\\\\\\&quot; MinConstraintUsed=\\\\\\&quot;false\\\\\\&quot; MaxConstraint=\\\\\\&quot;100\\\\\\&quot; MinConstraint=\\\\\\&quot;0\\\\\\&quot; ShowSlider=\\\\\\&quot;false\\\\\\&quot; SliderMax=\\\\\\&quot;100\\\\\\&quot; SliderMin=\\\\\\&quot;0\\\\\\&quot; SliderStep=\\\\\\&quot;\\\\\\&quot; id=\\\\\\&quot;26\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;transition\\\\\\&quot; parent=\\\\\\&quot;28\\\\\\&quot; source=\\\\\\&quot;23\\\\\\&quot; target=\\\\\\&quot;24\\\\\\&quot; edge=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;-450\\\\\\&quot; y=\\\\\\&quot;-100\\\\\\&quot; width=\\\\\\&quot;100\\\\\\&quot; height=\\\\\\&quot;100\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;&gt;          &lt;mxPoint x=\\\\\\&quot;-450\\\\\\&quot; as=\\\\\\&quot;sourcePoint\\\\\\&quot;/&gt;          &lt;mxPoint x=\\\\\\&quot;-350\\\\\\&quot; y=\\\\\\&quot;-100\\\\\\&quot; as=\\\\\\&quot;targetPoint\\\\\\&quot;/&gt;        &lt;/mxGeometry&gt;      &lt;/mxCell&gt;    &lt;/Transition&gt;    &lt;Transition name=\\\\\\&quot;Recovery\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Trigger=\\\\\\&quot;Probability\\\\\\&quot; Value=\\\\\\&quot;0.2\\\\\\&quot; Units=\\\\\\&quot;Unitless\\\\\\&quot; MaxConstraintUsed=\\\\\\&quot;false\\\\\\&quot; MinConstraintUsed=\\\\\\&quot;false\\\\\\&quot; MaxConstraint=\\\\\\&quot;100\\\\\\&quot; MinConstraint=\\\\\\&quot;0\\\\\\&quot; ShowSlider=\\\\\\&quot;false\\\\\\&quot; SliderMax=\\\\\\&quot;100\\\\\\&quot; SliderMin=\\\\\\&quot;0\\\\\\&quot; SliderStep=\\\\\\&quot;\\\\\\&quot; id=\\\\\\&quot;27\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;transition\\\\\\&quot; parent=\\\\\\&quot;28\\\\\\&quot; source=\\\\\\&quot;24\\\\\\&quot; target=\\\\\\&quot;25\\\\\\&quot; edge=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;-450\\\\\\&quot; y=\\\\\\&quot;-100\\\\\\&quot; width=\\\\\\&quot;100\\\\\\&quot; height=\\\\\\&quot;100\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;&gt;          &lt;mxPoint x=\\\\\\&quot;-450\\\\\\&quot; as=\\\\\\&quot;sourcePoint\\\\\\&quot;/&gt;          &lt;mxPoint x=\\\\\\&quot;-350\\\\\\&quot; y=\\\\\\&quot;-100\\\\\\&quot; as=\\\\\\&quot;targetPoint\\\\\\&quot;/&gt;        &lt;/mxGeometry&gt;      &lt;/mxCell&gt;    &lt;/Transition&gt;    &lt;Setting Note=\\\\\\&quot;\\\\\\&quot; Version=\\\\\\&quot;28\\\\\\&quot; TimeLength=\\\\\\&quot;20\\\\\\&quot; TimeStart=\\\\\\&quot;0\\\\\\&quot; TimeStep=\\\\\\&quot;1\\\\\\&quot; TimeUnits=\\\\\\&quot;Years\\\\\\&quot; StrictUnits=\\\\\\&quot;true\\\\\\&quot; Units=\\\\\\&quot;\\\\\\&quot; HiddenUIGroups=\\\\\\&quot;Validation,User Interface\\\\\\&quot; SolutionAlgorithm=\\\\\\&quot;RK1\\\\\\&quot; BackgroundColor=\\\\\\&quot;white\\\\\\&quot; Throttle=\\\\\\&quot;1\\\\\\&quot; Macros=\\\\\\&quot;\\\\\\&quot; SensitivityPrimitives=\\\\\\&quot;\\\\\\&quot; SensitivityRuns=\\\\\\&quot;50\\\\\\&quot; SensitivityBounds=\\\\\\&quot;50, 80, 95, 100\\\\\\&quot; SensitivityShowRuns=\\\\\\&quot;false\\\\\\&quot; id=\\\\\\&quot;2\\\\\\&quot;&gt;      &lt;mxCell parent=\\\\\\&quot;1\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot; visible=\\\\\\&quot;0\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;20\\\\\\&quot; y=\\\\\\&quot;20\\\\\\&quot; width=\\\\\\&quot;80\\\\\\&quot; height=\\\\\\&quot;40\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/Setting&gt;    &lt;Display name=\\\\\\&quot;Default Display\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Type=\\\\\\&quot;Time Series\\\\\\&quot; xAxis=\\\\\\&quot;Time (%u)\\\\\\&quot; yAxis=\\\\\\&quot;\\\\\\&quot; ThreeDimensional=\\\\\\&quot;false\\\\\\&quot; Primitives=\\\\\\&quot;23,24,25,29\\\\\\&quot; AutoAddPrimitives=\\\\\\&quot;true\\\\\\&quot; ScatterplotOrder=\\\\\\&quot;X Primitive, Y Primitive\\\\\\&quot; Image=\\\\\\&quot;Display\\\\\\&quot; yAxis2=\\\\\\&quot;\\\\\\&quot; Primitives2=\\\\\\&quot;\\\\\\&quot; showMarkers=\\\\\\&quot;false\\\\\\&quot; showLines=\\\\\\&quot;true\\\\\\&quot; showArea=\\\\\\&quot;false\\\\\\&quot; legendPosition=\\\\\\&quot;Automatic\\\\\\&quot; id=\\\\\\&quot;3\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;roundImage;image=/builder/images/DisplayFull.png;\\\\\\&quot; parent=\\\\\\&quot;1\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot; visible=\\\\\\&quot;0\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;50\\\\\\&quot; y=\\\\\\&quot;20\\\\\\&quot; width=\\\\\\&quot;64\\\\\\&quot; height=\\\\\\&quot;64\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/Display&gt;    &lt;Agents name=\\\\\\&quot;Population\\\\\\&quot; Note=\\\\\\&quot;\\\\\\&quot; Size=\\\\\\&quot;50\\\\\\&quot; GeoWrap=\\\\\\&quot;false\\\\\\&quot; GeoDimUnits=\\\\\\&quot;Unitless\\\\\\&quot; GeoWidth=\\\\\\&quot;200\\\\\\&quot; GeoHeight=\\\\\\&quot;100\\\\\\&quot; Placement=\\\\\\&quot;Random\\\\\\&quot; PlacementFunction=\\\\\\&quot;&amp;lt;&amp;lt;rand*width([Self]), rand*height([Self])&amp;gt;&amp;gt;\\\\\\&quot; Network=\\\\\\&quot;None\\\\\\&quot; NetworkFunction=\\\\\\&quot;randBoolean(0.02)\\\\\\&quot; Agent=\\\\\\&quot;28\\\\\\&quot; Image=\\\\\\&quot;None\\\\\\&quot; FlipHorizontal=\\\\\\&quot;false\\\\\\&quot; FlipVertical=\\\\\\&quot;false\\\\\\&quot; LabelPosition=\\\\\\&quot;Middle\\\\\\&quot; id=\\\\\\&quot;29\\\\\\&quot;&gt;      &lt;mxCell style=\\\\\\&quot;agents\\\\\\&quot; vertex=\\\\\\&quot;1\\\\\\&quot; parent=\\\\\\&quot;1\\\\\\&quot;&gt;        &lt;mxGeometry x=\\\\\\&quot;220\\\\\\&quot; y=\\\\\\&quot;180\\\\\\&quot; width=\\\\\\&quot;170\\\\\\&quot; height=\\\\\\&quot;80\\\\\\&quot; as=\\\\\\&quot;geometry\\\\\\&quot;/&gt;      &lt;/mxCell&gt;    &lt;/Agents&gt;  &lt;/root&gt;&lt;/mxGraphModel&gt;\\&quot;); var dec = new mxCodec(doc); dec.decode(doc.documentElement, graph.getModel());\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;Now let\'s configure the value of &lt;span class=\'primitive\'&gt;Percent Infected&lt;/span&gt; and change the &lt;span class=\'primitive\'&gt;Infection &lt;/span&gt;transition to use it.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nvar newPrimitive = createPrimitive(\'Fraction Infected\', \'Variable\', [280, 90], [130, 50]);\\n\\ngraph.fit(5);\\n\\n\\n\\nvar cell =createConnector(\'Link\', \'Link\', findName(\'Population\'), findName(\'Fraction Infected\'));\\nvar geo = new mxGeometry(0, 0, 100, 100);\\ngraph.model.execute(new mxGeometryChange(graph.model, cell, geo));\\n\\ngraph.fit(5);\\n\\n\\n\\nvar cell =createConnector(\'Link\', \'Link\', findName(\'Fraction Infected\'), findName(\'Infection\'));\\nvar geo = new mxGeometry(0, 0, 100, 100);\\ngraph.model.execute(new mxGeometryChange(graph.model, cell, geo));\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;This equation uses the FindState function to select all the people in the &lt;span class=\'primitive\'&gt;Population&lt;/span&gt; who are in the Infected state. It then divides the number of those people by the total size of the population.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nfindName(\'Fraction Infected\').setAttribute(\'Equation\', \'Count(FindState([Population], [Infected]))/PopulationSize([Population])\'); showEditor(findName(\'Fraction Infected\'));\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;Now that we have set our infection probability to the value of the &lt;span class=\'primitive\'&gt;Fraction Infected&lt;/span&gt; primitive, we are ready to run the model.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nfindName(\'Infection\').setAttribute(\'Value\', \'[Fraction Infected]\');\\n\\ngraph.fit(5);\\n\\n\\n\\nfindType(\'Display\')[0].setAttribute(\'Primitives\', getID(findName([\'Population\'])).join(\',\'));\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;That was a bit of a disappointment wasn\'t it? Nothing happened. Why is this?&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nrunModel();\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;Well since our infection rate now depends on the number of people who are infected we have to have at least one person infected to get the epidemic going. Let\'s change the &lt;span class=\'primitive\'&gt;Healthy&lt;/span&gt; and &lt;span class=\'primitive\'&gt;Infected&lt;/span&gt; states so one person starts in the infected state at the beginning of the simulation.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;graph.fit(5);&quot;,&quot;text&quot;:&quot;Refit model&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;Each agent has an index starting with 1, we have set our initially active equations so the first agent in the population will start the simulation in the infected state. Let\'s run the model to see this working.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nfindName(\'Healthy\').setAttribute(\'Active\', \'Index([Self]) &lt;&gt; 1\');\\n\\ngraph.fit(5);\\n\\n\\n\\nfindName(\'Infected\').setAttribute(\'Active\', \'Index([Self]) == 1\'); showEditor(findName(\'Infected\'));\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;note&quot;,&quot;data&quot;:&quot;Each time we run the model we will get a different set of results. Sometimes the infection will die off after the first infected person recovers. Many other times an epidemic spread of the disease will occur.&quot;,&quot;text&quot;:&quot;Show Message&quot;,&quot;leaf&quot;:true},{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nrunModel();\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;},{&quot;children&quot;:[{&quot;type&quot;:&quot;action&quot;,&quot;data&quot;:&quot;\\n\\nrunModel();\\n\\ngraph.fit(5);\\n\\n&quot;,&quot;text&quot;:&quot;Run Action&quot;,&quot;leaf&quot;:true}],&quot;type&quot;:&quot;group&quot;,&quot;text&quot;:&quot;New Group&quot;}],&quot;text&quot;:&quot;Root Node&quot;}" unfoldingStatus="on" unfoldingAuto="always" Note="" Version="28" TimeLength="20" TimeStart="0" TimeStep="1" TimeUnits="Years" StrictUnits="true" Units="" HiddenUIGroups="Validation,User Interface" SolutionAlgorithm="RK1" BackgroundColor="white" Throttle="1" Macros="" SensitivityPrimitives="" SensitivityRuns="50" SensitivityBounds="50, 80, 95, 100" SensitivityShowRuns="false" id="2"><mxCell parent="1" vertex="1" visible="0"><mxGeometry x="20" y="20" width="80" height="40" as="geometry"/></mxCell></Setting><Display name="Default Display" Note="" Type="Time Series" xAxis="Time (%u)" yAxis="" ThreeDimensional="false" Primitives="" AutoAddPrimitives="true" ScatterplotOrder="X Primitive, Y Primitive" Image="Display" yAxis2="" Primitives2="" showMarkers="false" showLines="true" showArea="false" legendPosition="Automatic" id="3"><mxCell style="roundImage;image=/builder/images/DisplayFull.png;" parent="1" vertex="1" visible="0"> <mxGeometry x="50" y="20" width="64" height="64" as="geometry"/></mxCell></Display></root></mxGraphModel>