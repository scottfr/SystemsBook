var translations={};function getText(a){translations[a]&&(a=translations[a]);for(var b=1;b<arguments.length;b++)a=a.replace("%s",arguments[b]);return a};Ext.onReady(function(){setTimeout(function(){Ext.get("loading").remove();Ext.get("loading-mask").fadeOut({remove:!0})},250)});function replace_html(a,b){if(a){var c="string"===typeof a?document.getElementById(a):a,d=document.createElement(c.nodeName);d.id=c.id;d.className=c.className;d.innerHTML=b;c.parentNode?c.parentNode.replaceChild(d,c):c.innerHTML=b;return d}}
function setTopLinks(){var a="",b="&uarr;";ribbonPanel.getDockedItems()[0].isVisible()||(b="&darr;");-1==drupal_node_ID?a='<div style="float:right;padding:0.2em;"><nobr><a href="'+base_path+'/help" target="_blank" >Help</a> | <a href="'+base_path+'/browse" target="_blank">Find More Insights</a> | <a href="javascript:toggleTopBar()"  id="toolbarToggle">'+b+"</a></nobr></div>":(a=is_editor?'<div style="float:left;padding:0.2em;"><a href="'+base_path+"/discussion/"+drupal_node_ID+'" target="_blank" id="commentBut">Insight Discussion</a> | <a href="'+
base_path+"/node/"+drupal_node_ID+'/access" target="_blank" id="editBut">Insight Properties</a> | <a href="'+base_path+"/node/"+drupal_node_ID+'/delete" id="deleteBut">Delete Insight</a></div></div>':a+'<div style="float:left;padding:0.2em;"><a href="'+base_path+"/discussion/"+drupal_node_ID+'" target="_blank" id="commentBut">Insight Discussion</a></div>',a+='<div style="float:right;padding:0.2em;"><nobr>',a=is_embed?a+'<a target="_blank" href="'+base_path+"/insight/"+drupal_node_ID+'">Full Screen Insight</a> | ':
a+'<a target="_blank" href="'+base_path+'/insight/">Make a New Insight</a> | <a target="_blank" href="'+base_path+"/node/"+drupal_node_ID+'/clone">Clone Insight</a> | ',a=a+'<a href="'+base_path+'/help" target="_blank">Help</a> | <a href="'+base_path+'/browse" target="_blank">Find More Insights</a> | <a href="javascript:toggleTopBar()" id="toolbarToggle">'+b+"</a></nobr></div>");replace_html(document.getElementById("toplinks-holder"),a);$.fn.frameWarp&&($("#commentBut").frameWarp({url:base_path+"/discussion/"+
drupal_node_ID}),$("#editBut").frameWarp({url:base_path+"/node/"+drupal_node_ID+"/access"}))};Ext.ns("Ext.ux.util");
Ext.ux.util.MD5=function(a){function b(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function c(a,c,d,e,f,o){a=b(b(c,a),b(e,o));return b(a<<f|a>>>32-f,d)}function d(a,b,d,e,f,o,p){return c(b&d|~b&e,a,b,f,o,p)}function e(a,b,d,e,f,o,p){return c(b&e|d&~e,a,b,f,o,p)}function f(a,b,d,e,f,o,p){return c(d^(b|~e),a,b,f,o,p)}return function(a){for(var b="",c=0;c<4*a.length;c++)b+="0123456789abcdef".charAt(a[c>>2]>>8*(c%4)+4&15)+"0123456789abcdef".charAt(a[c>>2]>>8*(c%4)&15);return b}(function(a,
h){a[h>>5]|=128<<h%32;a[(h+64>>>9<<4)+14]=h;for(var k=1732584193,l=-271733879,n=-1732584194,o=271733878,p=0;p<a.length;p+=16)var r=k,s=l,u=n,w=o,k=d(k,l,n,o,a[p+0],7,-680876936),o=d(o,k,l,n,a[p+1],12,-389564586),n=d(n,o,k,l,a[p+2],17,606105819),l=d(l,n,o,k,a[p+3],22,-1044525330),k=d(k,l,n,o,a[p+4],7,-176418897),o=d(o,k,l,n,a[p+5],12,1200080426),n=d(n,o,k,l,a[p+6],17,-1473231341),l=d(l,n,o,k,a[p+7],22,-45705983),k=d(k,l,n,o,a[p+8],7,1770035416),o=d(o,k,l,n,a[p+9],12,-1958414417),n=d(n,o,k,l,a[p+10],
17,-42063),l=d(l,n,o,k,a[p+11],22,-1990404162),k=d(k,l,n,o,a[p+12],7,1804603682),o=d(o,k,l,n,a[p+13],12,-40341101),n=d(n,o,k,l,a[p+14],17,-1502002290),l=d(l,n,o,k,a[p+15],22,1236535329),k=e(k,l,n,o,a[p+1],5,-165796510),o=e(o,k,l,n,a[p+6],9,-1069501632),n=e(n,o,k,l,a[p+11],14,643717713),l=e(l,n,o,k,a[p+0],20,-373897302),k=e(k,l,n,o,a[p+5],5,-701558691),o=e(o,k,l,n,a[p+10],9,38016083),n=e(n,o,k,l,a[p+15],14,-660478335),l=e(l,n,o,k,a[p+4],20,-405537848),k=e(k,l,n,o,a[p+9],5,568446438),o=e(o,k,l,n,a[p+
14],9,-1019803690),n=e(n,o,k,l,a[p+3],14,-187363961),l=e(l,n,o,k,a[p+8],20,1163531501),k=e(k,l,n,o,a[p+13],5,-1444681467),o=e(o,k,l,n,a[p+2],9,-51403784),n=e(n,o,k,l,a[p+7],14,1735328473),l=e(l,n,o,k,a[p+12],20,-1926607734),k=c(l^n^o,k,l,a[p+5],4,-378558),o=c(k^l^n,o,k,a[p+8],11,-2022574463),n=c(o^k^l,n,o,a[p+11],16,1839030562),l=c(n^o^k,l,n,a[p+14],23,-35309556),k=c(l^n^o,k,l,a[p+1],4,-1530992060),o=c(k^l^n,o,k,a[p+4],11,1272893353),n=c(o^k^l,n,o,a[p+7],16,-155497632),l=c(n^o^k,l,n,a[p+10],23,-1094730640),
k=c(l^n^o,k,l,a[p+13],4,681279174),o=c(k^l^n,o,k,a[p+0],11,-358537222),n=c(o^k^l,n,o,a[p+3],16,-722521979),l=c(n^o^k,l,n,a[p+6],23,76029189),k=c(l^n^o,k,l,a[p+9],4,-640364487),o=c(k^l^n,o,k,a[p+12],11,-421815835),n=c(o^k^l,n,o,a[p+15],16,530742520),l=c(n^o^k,l,n,a[p+2],23,-995338651),k=f(k,l,n,o,a[p+0],6,-198630844),o=f(o,k,l,n,a[p+7],10,1126891415),n=f(n,o,k,l,a[p+14],15,-1416354905),l=f(l,n,o,k,a[p+5],21,-57434055),k=f(k,l,n,o,a[p+12],6,1700485571),o=f(o,k,l,n,a[p+3],10,-1894986606),n=f(n,o,k,l,
a[p+10],15,-1051523),l=f(l,n,o,k,a[p+1],21,-2054922799),k=f(k,l,n,o,a[p+8],6,1873313359),o=f(o,k,l,n,a[p+15],10,-30611744),n=f(n,o,k,l,a[p+6],15,-1560198380),l=f(l,n,o,k,a[p+13],21,1309151649),k=f(k,l,n,o,a[p+4],6,-145523070),o=f(o,k,l,n,a[p+11],10,-1120210379),n=f(n,o,k,l,a[p+2],15,718787259),l=f(l,n,o,k,a[p+9],21,-343485551),k=b(k,r),l=b(l,s),n=b(n,u),o=b(o,w);return[k,l,n,o]}(function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<c%32;return b}(a),8*a.length))};
Ext.ux.util.clone=function(a){if(!a||"object"!==typeof a)return a;if("function"===typeof a.clone)return a.clone();var b="[object Array]"===Object.prototype.toString.call(a)?[]:{},c,d;for(c in a)a.hasOwnProperty(c)&&(d=a[c],b[c]=d&&"object"===typeof d?Ext.ux.util.clone(d):d);return b};Ext.ux.util.applyMatching=function(a,b){var b=b||this,c;for(c in a)a.hasOwnProperty(c)&&void 0!==b[c]&&(a[c]=b[c]);return a};Ext.chart.series.Line.prototype.drawSeries=function(){var a=this.chart,b=a.axes,c=a.getChartStore(),d=c.data.items,e,f=c.getCount(),g=this.chart.surface,h={},k=this.group,l=this.showMarkers,n=this.markerGroup,o=a.shadow,p=this.shadowGroups,r=this.shadowAttributes,s=this.smooth,u=p.length,w=["M"],v=["M"],x=["M"],x=["M"];e=a.markerIndex;[].concat(this.axis);var B,z=[],A={},J=[],y=!1,D=[],E=this.markerStyle,C=this.seriesStyle,F=this.colorArrayStyle,I=F&&F.length||0,P=Ext.isNumber,H=this.seriesIdx,N=
this.getAxesForXAndYFields(),L=N.xAxis,S=N.yAxis,O,Q,K,ba,X,G,ca,T,R,aa,na,oa,la,q,sa,pa;if(!1!==this.fireEvent("beforedraw",this))if(!f||this.seriesIsHidden){this.hide();this.items=[];if(this.line){this.line.hide(!0);if(this.line.shadows){b=this.line.shadows;for(d=0,u=b.length;d<u;d++)A=b[d],A.hide(!0)}this.fillPath&&this.fillPath.hide(!0)}this.fillPath=this.line=null}else{E=Ext.apply(E||{},this.markerConfig,{fill:this.seriesStyle.fill||F[H%F.length]});sa=E.type;delete E.type;C["stroke-width"]||
(C["stroke-width"]=0.5);pa="opacity"in C?C.opacity:1;N="opacity"in C?C.opacity:0.3;pa="lineOpacity"in C?C.lineOpacity:pa;N="fillOpacity"in C?C.fillOpacity:N;if(e&&n&&n.getCount())for(G=0;G<e;G++)ca=n.getAt(G),n.remove(ca),n.add(ca),T=n.getAt(n.getCount()-2),ca.setAttributes({x:0,y:0,translate:{x:T.attr.translation.x,y:T.attr.translation.y}},!0);this.unHighlightItem();this.cleanHighlights();this.setBBox();h=this.bbox;this.clipRect=[h.x,h.y,h.width,h.height];if(G=b.get(L))G=G.applyData(),la=G.from,
R=G.to;if(G=b.get(S))G=G.applyData(),q=G.from,aa=G.to;this.xField&&!Ext.isNumber(la)&&(G=this.getMinMaxXValues(),la=G[0],R=G[1]);this.yField&&!Ext.isNumber(q)&&(G=this.getMinMaxYValues(),q=G[0],aa=G[1]);isNaN(la)?(la=0,na=h.width/(f-1||1)):na=h.width/(R-la||f-1||1);isNaN(q)?(q=0,oa=h.height/(f-1||1)):oa=h.height/(aa-q||f-1||1);for(G=0,f=d.length;G<f;G++){e=d[G];R=e.get(this.xField);if("string"==typeof R||"object"==typeof R&&!Ext.isDate(R)||L&&b.get(L)&&"Category"==b.get(L).type)R=R in A?A[R]:A[R]=
G;aa=e.get(this.yField);if("undefined"==typeof aa||"string"==typeof aa&&!aa)Ext.isDefined(Ext.global.console)&&Ext.global.console.warn("[Ext.chart.series.Line]  Skipping a store element with an undefined value at ",e,R,aa);else{if("string"==typeof aa||"object"==typeof aa&&!Ext.isDate(aa)||S&&b.get(S)&&"Category"==b.get(S).type)aa=G;D.push(G);z.push(R);J.push(aa)}}f=z.length;f>h.width&&(G=this.shrink(z,J,h.width),z=G.x,J=G.y);this.items=[];a.scaleX=function(a){return(h.x+(a-la)*na).toFixed(2)};a.scaleY=
function(a){return(h.y+h.height-(a-q)*oa).toFixed(2)};L=0;f=z.length;for(G=0;G<f;G++)if(R=z[G],aa=J[G],!1===aa)1==v.length&&(v=[]),y=!0,this.items.push(!1);else{K=a.scaleX(R);S=a.scaleY(aa);y&&(y=!1,v.push("M"));v=v.concat([K,S]);"undefined"==typeof X&&"undefined"!=typeof S&&(X=S,ba=K);if(!this.line||a.resizing)w=w.concat([K,h.y+h.height/2]);if(a.animate&&a.resizing&&this.line&&(this.line.setAttributes({path:w,opacity:pa},!0),this.fillPath&&this.fillPath.setAttributes({path:w,opacity:N},!0),this.line.shadows)){b=
this.line.shadows;for(d=0,u=b.length;d<u;d++)A=b[d],A.setAttributes({path:w},!0)}l&&((ca=n.getAt(L++))?ca.setAttributes({value:'"'+R+", "+aa+'"',x:0,y:0,hidden:!1},!0):ca=Ext.chart.Shape[sa](g,Ext.apply({group:[k,n],x:0,y:0,translate:{x:+(O||K),y:B||h.y+h.height/2},value:'"'+R+", "+aa+'"',zIndex:4E3},E)),ca._to={translate:{x:+K,y:+S}});this.items.push({series:this,value:[R,aa],point:[K,S],sprite:ca,storeItem:c.getAt(D[G])});O=K;B=S}if(!(1>=v.length)){this.smooth&&(x=Ext.draw.Draw.smooth(v,P(s)?s:
this.defaultSmoothness));x=s?x:v;a.markerIndex&&this.previousPath?(O=this.previousPath,s||Ext.Array.erase(O,1,2)):O=v;if(!this.line&&(this.line=g.add(Ext.apply({type:"path",group:k,path:w,stroke:C.stroke||C.fill},C||{})),this.line.setAttributes({opacity:pa},!0),o&&this.line.setAttributes(Ext.apply({},this.shadowOptions),!0),this.line.setAttributes({fill:"none",zIndex:3E3}),!C.stroke&&I&&this.line.setAttributes({stroke:F[H%I]},!0),o)){b=this.line.shadows=[];for(s=0;s<u;s++)B=r[s],B=Ext.apply({},B,
{path:w}),A=g.add(Ext.apply({},{type:"path",group:p[s]},B)),b.push(A)}this.fill&&(Q=x.concat([["L",K,h.y+h.height],["L",ba,h.y+h.height],["L",ba,X]]),this.fillPath||(this.fillPath=g.add({group:k,type:"path",fill:C.fill||F[H%I],path:w})));g=l&&n.getCount();if(a.animate){p=this.fill;r=this.line;k=this.renderer(r,!1,{path:x},G,c);Ext.apply(k,C||{},{stroke:C.stroke||C.fill});delete k.fill;r.show(!0);this.animation=a.markerIndex&&this.previousPath?this.onAnimate(r,{to:k,from:{path:O}}):this.onAnimate(r,
{to:k});if(o){b=r.shadows;for(d=0;d<u;d++)if(b[d].show(!0),a.markerIndex&&this.previousPath)this.onAnimate(b[d],{to:{path:x},from:{path:O}});else this.onAnimate(b[d],{to:{path:x}})}p&&(this.fillPath.show(!0),this.onAnimate(this.fillPath,{to:Ext.apply({},{path:Q,fill:C.fill||F[H%I],"stroke-width":0,opacity:N},C||{})}));if(l){for(G=L=0;G<f;G++)if(this.items[G]&&(l=n.getAt(L++)))k=this.renderer(l,c.getAt(G),l._to,G,c),this.onAnimate(l,{to:Ext.apply(k,E||{})}),l.show(!0);for(;L<g;L++)l=n.getAt(L),l.hide(!0)}}else{k=
this.renderer(this.line,!1,{path:x,hidden:!1},G,c);Ext.apply(k,C||{},{stroke:C.stroke||C.fill});delete k.fill;this.line.setAttributes(k,!0);this.line.setAttributes({opacity:pa},!0);if(o){b=this.line.shadows;for(d=0;d<u;d++)b[d].setAttributes({path:x,hidden:!1},!0)}this.fill&&this.fillPath.setAttributes({path:Q,hidden:!1,opacity:N},!0);if(l){for(G=L=0;G<f;G++)if(this.items[G]&&(l=n.getAt(L++)))k=this.renderer(l,c.getAt(G),l._to,G,c),l.setAttributes(Ext.apply(E||{},k||{}),!0),l.attr.hidden||l.show(!0);
for(;L<g;L++)l=n.getAt(L),l.hide(!0)}}a.markerIndex&&(this.smooth?Ext.Array.erase(v,1,2):Ext.Array.splice(v,1,0,v[1],v[2]),this.previousPath=v);this.renderLabels();this.renderCallouts();this.fireEvent("draw",this)}}};
Ext.chart.Chart.prototype.redraw=function(a){var b=this.series.items,c=b.length,d=this.axes.items,e=d.length,f;f=this.chartBBox={x:0,y:0,height:this.curHeight,width:this.curWidth};var g=this.legend;this.surface.setSize(f.width,f.height);for(f=0;f<c;f++)this.initializeSeries(b[f],f);for(f=0;f<e;f++)this.initializeAxis(d[f]);for(f=0;f<e;f++)d[f].processView();for(f=0;f<e;f++)d[f].drawAxis(!0);!1!==g&&g.visible&&(g.update||!g.created)&&g.create();this.alignAxes();!1!==g&&g.visible&&g.updatePosition();
this.getMaxGutter();this.resizing=!!a;for(f=0;f<e;f++)d[f].drawAxis();for(f=0;f<c;f++)this.drawCharts(b[f]);if(this.oldLinks){for(f=0;f<this.oldLinks.length;f++)this.oldLinks[f].remove();this.oldLinks=[]}if(this.links){this.oldLinks=[];for(var h in this.links)drawLink(this,this.links[h][0],this.links[h][1])}this.resizing=!1};function drawLink(a,b,c){b=[[a.scaleX(b.items[0]),a.scaleY(b.items[1])],[a.scaleX(c.items[0]),a.scaleY(c.items[1])]];drawPath(a,b,"#aaaaaa",0.5,"#aaaaaa",1)}
function drawPath(a,b,c,d,e,f,g){if("undefined"==typeof g||""==g)g=null;if(""==e||""==f||"undefined"==typeof e||"undefined"==typeof f)f=e=null;var h=h+"M"+b[0][0]+" "+b[0][1]+" ";for(i=1;i<b.length;i++)h=h+"L"+b[i][0]+" "+b[i][1]+" ";this.currFill=b=a.surface.add({type:"path",opacity:d,fill:c,path:h+"Z",stroke:e,"stroke-width":f,listeners:g}).show(!0);a.oldLinks.push(b)};var Graph=function(){this.nodeSet={};this.nodes=[];this.edges=[];this.adjacency={};this.nextEdgeId=this.nextNodeId=0;this.eventListeners=[]},Node=function(a,b){this.id=a;this.data="undefined"!==typeof b?b:{}},Edge=function(a,b,c,d){this.id=a;this.source=b;this.target=c;this.data="undefined"!==typeof d?d:{}};Graph.prototype.addNode=function(a){"undefined"===typeof this.nodeSet[a.id]&&this.nodes.push(a);this.nodeSet[a.id]=a;this.notify();return a};
Graph.prototype.addEdge=function(a){var b=!1;this.edges.forEach(function(c){a.id===c.id&&(b=!0)});b||this.edges.push(a);"undefined"===typeof this.adjacency[a.source.id]&&(this.adjacency[a.source.id]={});"undefined"===typeof this.adjacency[a.source.id][a.target.id]&&(this.adjacency[a.source.id][a.target.id]=[]);b=!1;this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===c.id&&(b=!0)});b||this.adjacency[a.source.id][a.target.id].push(a);this.notify();return a};
Graph.prototype.newNode=function(a){a=new Node(this.nextNodeId++,a);this.addNode(a);return a};Graph.prototype.newEdge=function(a,b,c){a=new Edge(this.nextEdgeId++,a,b,c);this.addEdge(a);return a};Graph.prototype.getEdges=function(a,b){return"undefined"!==typeof this.adjacency[a.id]&&"undefined"!==typeof this.adjacency[a.id][b.id]?this.adjacency[a.id][b.id]:[]};
Graph.prototype.removeNode=function(a){"undefined"!==typeof this.nodeSet[a.id]&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;0<=b;b--)this.nodes[b].id===a.id&&this.nodes.splice(b,1);this.detachNode(a)};Graph.prototype.detachNode=function(a){this.edges.slice().forEach(function(b){(b.source.id===a.id||b.target.id===a.id)&&this.removeEdge(b)},this);this.notify()};
Graph.prototype.removeEdge=function(a){for(var b=this.edges.length-1;0<=b;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency)for(var d in this.adjacency[c])for(b=this.adjacency[c][d].length-1;0<=b;b--)this.adjacency[c][d][b].id===a.id&&this.adjacency[c][d].splice(b,1);this.notify()};
Graph.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new Node(a.id,a.data)))},this);a.edges.forEach(function(a){var d=b[a.from],e=b[a.to],f=a.directed?f=a.type+"-"+d.id+"-"+e.id:d.id<e.id?a.type+"-"+d.id+"-"+e.id:a.type+"-"+e.id+"-"+d.id;this.addEdge(new Edge(f,d,e,a.data)).data.type=a.type},this)};Graph.prototype.filterNodes=function(a){this.nodes.slice().forEach(function(b){a(b)||this.removeNode(b)},this)};
Graph.prototype.filterEdges=function(a){this.edges.slice().forEach(function(b){a(b)||this.removeEdge(b)},this)};Graph.prototype.addGraphListener=function(a){this.eventListeners.push(a)};Graph.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var Layout={ForceDirected:function(a,b,c,d){this.graph=a;this.stiffness=b;this.repulsion=c;this.damping=d;this.nodePoints={};this.edgeSprings={}}};
Layout.ForceDirected.prototype.point=function(a){if("undefined"===typeof this.nodePoints[a.id]){var b="undefined"!==typeof a.data.mass?a.data.mass:1;this.nodePoints[a.id]=new Layout.ForceDirected.Point(gVector.random(),b)}return this.nodePoints[a.id]};
Layout.ForceDirected.prototype.spring=function(a){if("undefined"===typeof this.edgeSprings[a.id]){var b="undefined"!==typeof a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);d.forEach(function(a){!1===c&&"undefined"!==typeof this.edgeSprings[a.id]&&(c=this.edgeSprings[a.id])},this);if(!1!==c)return new Layout.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);d.forEach(function(a){!1===c&&"undefined"!==typeof this.edgeSprings[a.id]&&(c=this.edgeSprings[a.id])},
this);if(!1!==c)return new Layout.ForceDirected.Spring(c.point2,c.point1,0,0);this.edgeSprings[a.id]=new Layout.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,this.stiffness)}return this.edgeSprings[a.id]};Layout.ForceDirected.prototype.eachNode=function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})};Layout.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})};
Layout.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})};Layout.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,d){if(b!==d){var e=b.p.subtract(d.p),f=e.magnitude()+0.1,e=e.normalise();b.applyForce(e.multiply(this.repulsion).divide(0.5*f*f));d.applyForce(e.multiply(this.repulsion).divide(-0.5*f*f))}})})};
Layout.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),b=b.normalise();a.point1.applyForce(b.multiply(-0.5*a.k*c));a.point2.applyForce(b.multiply(0.5*a.k*c))})};Layout.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(this.repulsion/50))})};
Layout.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping);c.a=new gVector(0,0)})};Layout.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})};Layout.ForceDirected.prototype.totalEnergy=function(){var a=0;this.eachNode(function(b,c){var d=c.v.magnitude();a+=0.5*c.m*d*d});return a};var __bind=function(a,b){return function(){return a.apply(b,arguments)}};
Layout.requestAnimationFrame=__bind(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,10)},window);
Layout.ForceDirected.prototype.start=function(a,b,c){var d=this;this._started||(this._started=!0,Layout.requestAnimationFrame(function f(){d.applyCoulombsLaw();d.applyHookesLaw();d.attractToCentre();d.updateVelocity(0.03);d.updatePosition(0.03);"undefined"!==typeof b&&b();0.01>d.totalEnergy()?(d._started=!1,"undefined"!==typeof c&&c()):Layout.requestAnimationFrame(f)}))};
Layout.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();if(null===b.distance||f<b.distance)b={node:d,point:e,distance:f}});return b};
Layout.ForceDirected.prototype.getBoundingBox=function(){var a=new gVector(-2,-2),b=new gVector(2,2);this.eachNode(function(c,e){e.p.x<a.x&&(a.x=e.p.x);e.p.y<a.y&&(a.y=e.p.y);e.p.x>b.x&&(b.x=e.p.x);e.p.y>b.y&&(b.y=e.p.y)});var c=b.subtract(a).multiply(0.07);return{bottomleft:a.subtract(c),topright:b.add(c)}};gVector=function(a,b){this.x=a;this.y=b};gVector.random=function(){return new gVector(10*(Math.random()-0.5),10*(Math.random()-0.5))};
gVector.prototype.add=function(a){return new gVector(this.x+a.x,this.y+a.y)};gVector.prototype.subtract=function(a){return new gVector(this.x-a.x,this.y-a.y)};gVector.prototype.multiply=function(a){return new gVector(this.x*a,this.y*a)};gVector.prototype.divide=function(a){return new gVector(this.x/a||0,this.y/a||0)};gVector.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};gVector.prototype.normal=function(){return new gVector(-this.y,this.x)};
gVector.prototype.normalise=function(){return this.divide(this.magnitude())};Layout.ForceDirected.Point=function(a,b){this.p=a;this.m=b;this.v=new gVector(0,0);this.a=new gVector(0,0)};Layout.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))};Layout.ForceDirected.Spring=function(a,b,c,d){this.point1=a;this.point2=b;this.length=c;this.k=d};
function Renderer(a,b,c,d,e){this.interval=a;this.layout=b;this.clear=c;this.drawEdge=d;this.drawNode=e;this.layout.graph.addGraphListener(this)}Renderer.prototype.graphChanged=function(){this.start()};Renderer.prototype.start=function(){var a=this;this.layout.start(50,function(){a.clear();a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)});a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})};var mxClient={VERSION:"1.12.0.1",IS_IE:0<=navigator.userAgent.indexOf("MSIE"),IS_IE6:0<=navigator.userAgent.indexOf("MSIE 6"),IS_QUIRKS:0<=navigator.userAgent.indexOf("MSIE")&&(null==document.documentMode||5==document.documentMode),IS_NS:0<=navigator.userAgent.indexOf("Mozilla/")&&0>navigator.userAgent.indexOf("MSIE"),IS_OP:0<=navigator.userAgent.indexOf("Opera/"),IS_OT:0>navigator.userAgent.indexOf("Presto/2.4.")&&0>navigator.userAgent.indexOf("Presto/2.3.")&&0>navigator.userAgent.indexOf("Presto/2.2.")&&
0>navigator.userAgent.indexOf("Presto/2.1.")&&0>navigator.userAgent.indexOf("Presto/2.0.")&&0>navigator.userAgent.indexOf("Presto/1."),IS_SF:0<=navigator.userAgent.indexOf("AppleWebKit/")&&0>navigator.userAgent.indexOf("Chrome/"),IS_GC:0<=navigator.userAgent.indexOf("Chrome/"),IS_MT:0<=navigator.userAgent.indexOf("Firefox/")&&0>navigator.userAgent.indexOf("Firefox/1.")&&0>navigator.userAgent.indexOf("Firefox/2.")||0<=navigator.userAgent.indexOf("Iceweasel/")&&0>navigator.userAgent.indexOf("Iceweasel/1.")&&
0>navigator.userAgent.indexOf("Iceweasel/2.")||0<=navigator.userAgent.indexOf("SeaMonkey/")&&0>navigator.userAgent.indexOf("SeaMonkey/1.")||0<=navigator.userAgent.indexOf("Iceape/")&&0>navigator.userAgent.indexOf("Iceape/1."),IS_SVG:0<=navigator.userAgent.indexOf("Firefox/")||0<=navigator.userAgent.indexOf("Iceweasel/")||0<=navigator.userAgent.indexOf("Seamonkey/")||0<=navigator.userAgent.indexOf("Iceape/")||0<=navigator.userAgent.indexOf("Galeon/")||0<=navigator.userAgent.indexOf("Epiphany/")||0<=
navigator.userAgent.indexOf("AppleWebKit/")||0<=navigator.userAgent.indexOf("Gecko/")||0<=navigator.userAgent.indexOf("Opera/"),NO_FO:0<=navigator.userAgent.indexOf("Firefox/1.")||0<=navigator.userAgent.indexOf("Iceweasel/1.")||0<=navigator.userAgent.indexOf("Firefox/2.")||0<=navigator.userAgent.indexOf("Iceweasel/2.")||0<=navigator.userAgent.indexOf("SeaMonkey/1.")||0<=navigator.userAgent.indexOf("Iceape/1.")||0<=navigator.userAgent.indexOf("Camino/1.")||0<=navigator.userAgent.indexOf("Epiphany/2.")||
0<=navigator.userAgent.indexOf("Opera/")||0<=navigator.userAgent.indexOf("MSIE")||0<=navigator.userAgent.indexOf("Mozilla/2."),IS_VML:"MICROSOFT INTERNET EXPLORER"==navigator.appName.toUpperCase(),IS_MAC:0<navigator.userAgent.toUpperCase().indexOf("MACINTOSH"),IS_TOUCH:0<navigator.userAgent.toUpperCase().indexOf("IPAD")||0<navigator.userAgent.toUpperCase().indexOf("IPOD")||0<navigator.userAgent.toUpperCase().indexOf("IPHONE")||0<navigator.userAgent.toUpperCase().indexOf("ANDROID"),IS_LOCAL:0>document.location.href.indexOf("http://")&&
0>document.location.href.indexOf("https://"),isBrowserSupported:function(){return mxClient.IS_VML||mxClient.IS_SVG},link:function(a,b,c){c=c||document;if(mxClient.IS_IE6)c.write('<link rel="'+a+'" href="'+b+'" charset="ISO-8859-1" type="text/css"/>');else{var d=c.createElement("link");d.setAttribute("rel",a);d.setAttribute("href",b);d.setAttribute("charset","ISO-8859-1");d.setAttribute("type","text/css");c.getElementsByTagName("head")[0].appendChild(d)}},include:function(a){document.write('<script src="'+
a+'"><\/script>')},dispose:function(){for(var a=0;a<mxEvent.objects.length;a++)null!=mxEvent.objects[a].mxListenerList&&mxEvent.removeAllListeners(mxEvent.objects[a])}};"undefined"==typeof mxLoadResources&&(mxLoadResources=!0);"undefined"==typeof mxLoadStylesheets&&(mxLoadStylesheets=!0);"undefined"!=typeof mxBasePath&&0<mxBasePath.length?("/"==mxBasePath.substring(mxBasePath.length-1)&&(mxBasePath=mxBasePath.substring(0,mxBasePath.length-1)),mxClient.basePath=mxBasePath):mxClient.basePath=".";
"undefined"!=typeof mxImageBasePath&&0<mxImageBasePath.length?("/"==mxImageBasePath.substring(mxImageBasePath.length-1)&&(mxImageBasePath=mxImageBasePath.substring(0,mxImageBasePath.length-1)),mxClient.imageBasePath=mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images";mxClient.language="undefined"!=typeof mxLanguage?mxLanguage:mxClient.IS_IE?navigator.userLanguage:navigator.language;mxClient.defaultLanguage="undefined"!=typeof mxDefaultLanguage?mxDefaultLanguage:"en";
mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css");"undefined"!=typeof mxLanguages&&(mxClient.languages=mxLanguages);
if(mxClient.IS_IE){if(9<=document.documentMode)mxClient.IS_VML=!1,mxClient.IS_SVG=!0;else{8==document.documentMode?(document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add("o","urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add("v","urn:schemas-microsoft-com:vml"),document.namespaces.add("o","urn:schemas-microsoft-com:office:office"));var ss=document.createStyleSheet();ss.cssText="v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}";
mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css")}window.attachEvent("onunload",mxClient.dispose)}
var mxLog={consoleName:"Console",TRACE:!1,DEBUG:!0,WARN:!0,buffer:"",init:function(){if(null==mxLog.window&&null!=document.body){var a=mxLog.consoleName+" - mxGraph "+mxClient.VERSION,b=document.createElement("table");b.setAttribute("width","100%");b.setAttribute("height","100%");var c=document.createElement("tbody"),d=document.createElement("tr"),e=document.createElement("td");e.style.verticalAlign="top";mxLog.textarea=document.createElement("textarea");mxLog.textarea.setAttribute("readOnly","true");
mxLog.textarea.style.height="100%";mxLog.textarea.style.resize="none";mxLog.textarea.value=mxLog.buffer;mxLog.textarea.style.width=mxClient.IS_NS&&"BackCompat"!=document.compatMode?"99%":"100%";e.appendChild(mxLog.textarea);d.appendChild(e);c.appendChild(d);d=document.createElement("tr");mxLog.td=document.createElement("td");mxLog.td.style.verticalAlign="top";mxLog.td.setAttribute("height","30px");d.appendChild(mxLog.td);c.appendChild(d);b.appendChild(c);mxLog.addButton("Info",function(){mxLog.info()});
mxLog.addButton("DOM",function(){var a=mxUtils.getInnerHtml(document.body);mxLog.debug(a)});mxLog.addButton("Trace",function(){mxLog.TRACE=!mxLog.TRACE;mxLog.TRACE?mxLog.debug("Tracing enabled"):mxLog.debug("Tracing disabled")});mxLog.addButton("Copy",function(){try{mxUtils.copy(mxLog.textarea.value)}catch(a){mxUtils.alert(a)}});mxLog.addButton("Show",function(){try{mxUtils.popup(mxLog.textarea.value)}catch(a){mxUtils.alert(a)}});mxLog.addButton("Clear",function(){mxLog.textarea.value=""});d=c=0;
"number"===typeof window.innerWidth?(c=window.innerHeight,d=window.innerWidth):(c=document.documentElement.clientHeight||document.body.clientHeight,d=document.body.clientWidth);mxLog.window=new mxWindow(a,b,Math.max(0,d-320),Math.max(0,c-210),300,160);mxLog.window.setMaximizable(!0);mxLog.window.setScrollable(!1);mxLog.window.setResizable(!0);mxLog.window.setClosable(!0);mxLog.window.destroyOnClose=!1;if((mxClient.IS_NS||mxClient.IS_IE)&&!mxClient.IS_GC&&!mxClient.IS_SF&&"BackCompat"!=document.compatMode){var f=
mxLog.window.getElement(),a=function(){mxLog.textarea.style.height=Math.max(0,f.offsetHeight-70)+"px"};mxLog.window.addListener(mxEvent.RESIZE_END,a);mxLog.window.addListener(mxEvent.MAXIMIZE,a);mxLog.window.addListener(mxEvent.NORMALIZE,a);mxLog.textarea.style.height="92px"}}},info:function(){mxLog.writeln(mxUtils.toString(navigator))},addButton:function(a,b){var c=document.createElement("button");mxUtils.write(c,a);mxEvent.addListener(c,"click",b);mxLog.td.appendChild(c)},isVisible:function(){return null!=
mxLog.window?mxLog.window.isVisible():!1},show:function(){mxLog.setVisible(!0)},setVisible:function(a){null==mxLog.window&&mxLog.init();null!=mxLog.window&&mxLog.window.setVisible(a)},enter:function(a){if(mxLog.TRACE)return mxLog.writeln("Entering "+a),(new Date).getTime()},leave:function(a,b){if(mxLog.TRACE){var c=0!=b?" ("+((new Date).getTime()-b)+" ms)":"";mxLog.writeln("Leaving "+a+c)}},debug:function(){mxLog.DEBUG&&mxLog.writeln.apply(this,arguments)},warn:function(){mxLog.WARN&&mxLog.writeln.apply(this,
arguments)},write:function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b],b<arguments.length-1&&(a+=" ");null!=mxLog.textarea?(mxLog.textarea.value+=a,0<=navigator.userAgent.indexOf("Presto/2.5")&&(mxLog.textarea.style.visibility="hidden",mxLog.textarea.style.visibility="visible"),mxLog.textarea.scrollTop=mxLog.textarea.scrollHeight):mxLog.buffer+=a},writeln:function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b],b<arguments.length-1&&(a+=" ");mxLog.write(a+"\n")}},mxObjectIdentity=
{FIELD_NAME:"mxObjectId",counter:0,get:function(a){if("object"==typeof a&&null==a[mxObjectIdentity.FIELD_NAME]){var b=mxUtils.getFunctionName(a.constructor);a[mxObjectIdentity.FIELD_NAME]=b+"#"+mxObjectIdentity.counter++}return a[mxObjectIdentity.FIELD_NAME]},clear:function(a){"object"==typeof a&&delete a[mxObjectIdentity.FIELD_NAME]}};function mxDictionary(){this.clear()}mxDictionary.prototype.map=null;mxDictionary.prototype.clear=function(){this.map={}};mxDictionary.prototype.get=function(a){return this.map[mxObjectIdentity.get(a)]};
mxDictionary.prototype.put=function(a,b){var c=mxObjectIdentity.get(a),d=this.map[c];this.map[c]=b;return d};mxDictionary.prototype.remove=function(a){var a=mxObjectIdentity.get(a),b=this.map[a];delete this.map[a];return b};mxDictionary.prototype.getKeys=function(){var a=[],b;for(b in this.map)a.push(b);return a};mxDictionary.prototype.getValues=function(){var a=[],b;for(b in this.map)a.push(this.map[b]);return a};mxDictionary.prototype.visit=function(a){for(var b in this.map)a(b,this.map[b])};
var mxResources={resources:[],extension:".properties",resourcesEncoded:!0,loadDefaultBundle:!0,loadSpecialBundle:!0,isLanguageSupported:function(a){return null!=mxClient.languages?0<=mxUtils.indexOf(mxClient.languages,a):!0},getDefaultBundle:function(a,b){return mxResources.loadDefaultBundle||!mxResources.isLanguageSupported(b)?a+mxResources.extension:null},getSpecialBundle:function(a,b){if(null==mxClient.languages||!this.isLanguageSupported(b)){var c=b.indexOf("-");0<c&&(b=b.substring(0,c))}return mxResources.loadSpecialBundle&&
mxResources.isLanguageSupported(b)&&b!=mxClient.defaultLanguage?a+"_"+b+mxResources.extension:null},add:function(a,b){b=null!=b?b:mxClient.language.toLowerCase();if(b!=mxConstants.NONE){var c=mxResources.getDefaultBundle(a,b);if(null!=c)try{var d=mxUtils.load(c);d.isReady()&&mxResources.parse(d.getText())}catch(e){}c=mxResources.getSpecialBundle(a,b);if(null!=c)try{d=mxUtils.load(c),d.isReady()&&mxResources.parse(d.getText())}catch(f){}}},parse:function(a){if(null!=a)for(var a=a.split("\n"),b=0;b<
a.length;b++)if("#"!=a[b].charAt(0)){var c=a[b].indexOf("=");if(0<c){var d=a[b].substring(0,c),e=a[b].length;13==a[b].charCodeAt(e-1)&&e--;c=a[b].substring(c+1,e);this.resourcesEncoded?(c=c.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),mxResources.resources[d]=unescape(c)):mxResources.resources[d]=c}}},get:function(a,b,c){a=mxResources.resources[a];null==a&&(a=c);if(null!=a&&null!=b){for(var c=[],d=null,e=0;e<a.length;e++){var f=a.charAt(e);"{"==f?d="":null!=d&&"}"==f?(d=parseInt(d)-1,0<=d&&d<b.length&&c.push(b[d]),
d=null):null!=d?d+=f:c.push(f)}a=c.join("")}return a}};function mxPoint(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}mxPoint.prototype.x=null;mxPoint.prototype.y=null;mxPoint.prototype.equals=function(a){return a.x==this.x&&a.y==this.y};mxPoint.prototype.clone=function(){return mxUtils.clone(this)};function mxRectangle(a,b,c,d){mxPoint.call(this,a,b);this.width=null!=c?c:0;this.height=null!=d?d:0}mxRectangle.prototype=new mxPoint;mxRectangle.prototype.constructor=mxRectangle;
mxRectangle.prototype.width=null;mxRectangle.prototype.height=null;mxRectangle.prototype.setRect=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};mxRectangle.prototype.getCenterX=function(){return this.x+this.width/2};mxRectangle.prototype.getCenterY=function(){return this.y+this.height/2};
mxRectangle.prototype.add=function(a){if(null!=a){var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),a=Math.max(this.y+this.height,a.y+a.height);this.x=b;this.y=c;this.width=d-b;this.height=a-c}};mxRectangle.prototype.grow=function(a){this.x-=a;this.y-=a;this.width+=2*a;this.height+=2*a};mxRectangle.prototype.getPoint=function(){return new mxPoint(this.x,this.y)};
mxRectangle.prototype.equals=function(a){return a.x==this.x&&a.y==this.y&&a.width==this.width&&a.height==this.height};
var mxEffects={animateChanges:function(a,b,c){var d=0,e=function(){for(var g=!1,h=0;h<b.length;h++){var k=b[h];if(k instanceof mxGeometryChange||k instanceof mxTerminalChange||k instanceof mxValueChange||k instanceof mxChildChange||k instanceof mxStyleChange){var l=a.getView().getState(k.cell||k.child,!1);if(null!=l)if(g=!0,k.constructor!=mxGeometryChange||a.model.isEdge(k.cell))mxUtils.setOpacity(l.shape.node,100*d/10);else{var n=a.getView().scale,o=(k.geometry.x-k.previous.x)*n,p=(k.geometry.y-
k.previous.y)*n,r=(k.geometry.width-k.previous.width)*n,n=(k.geometry.height-k.previous.height)*n;0==d?(l.x-=o,l.y-=p,l.width-=r,l.height-=n):(l.x+=o/10,l.y+=p/10,l.width+=r/10,l.height+=n/10);a.cellRenderer.redraw(l);mxEffects.cascadeOpacity(a,k.cell,100*d/10)}}}mxUtils.repaintGraph(a,new mxPoint(1,1));10>d&&g?(d++,window.setTimeout(e,f)):null!=c&&c()},f=30;e()},cascadeOpacity:function(a,b,c){for(var d=a.model.getChildCount(b),e=0;e<d;e++){var f=a.model.getChildAt(b,e),g=a.getView().getState(f);
null!=g&&(mxUtils.setOpacity(g.shape.node,c),mxEffects.cascadeOpacity(a,f,c))}b=a.model.getEdges(b);if(null!=b)for(e=0;e<b.length;e++)d=a.getView().getState(b[e]),null!=d&&mxUtils.setOpacity(d.shape.node,c)},fadeOut:function(a,b,c,d,e,f){var d=d||40,e=e||30,g=b||100;mxUtils.setOpacity(a,g);if(f||null==f){var h=function(){g=Math.max(g-d,0);mxUtils.setOpacity(a,g);0<g?window.setTimeout(h,e):(a.style.visibility="hidden",c&&a.parentNode&&a.parentNode.removeChild(a))};window.setTimeout(h,e)}else a.style.visibility=
"hidden",c&&a.parentNode&&a.parentNode.removeChild(a)}},mxUtils={errorResource:"none"!=mxClient.language?"error":"",closeResource:"none"!=mxClient.language?"close":"",errorImage:mxClient.imageBasePath+"/error.gif",removeCursors:function(a){null!=a.style&&(a.style.cursor="");a=a.childNodes;if(null!=a)for(var b=a.length,c=0;c<b;c+=1)mxUtils.removeCursors(a[c])},repaintGraph:function(a,b){if(mxClient.IS_GC||mxClient.IS_SF||mxClient.IS_OP){var c=a.container;if(null!=c&&null!=b&&(0<c.scrollLeft||0<c.scrollTop)){var d=
document.createElement("div");d.style.position="absolute";d.style.left=b.x+"px";d.style.top=b.y+"px";d.style.width="1px";d.style.height="1px";c.appendChild(d);c.removeChild(d)}}},getCurrentStyle:function(){return mxClient.IS_IE?function(a){return null!=a?a.currentStyle:null}:function(a){return null!=a?window.getComputedStyle(a,""):null}}(),hasScrollbars:function(a){a=mxUtils.getCurrentStyle(a);return null!=a&&("scroll"==a.overflow||"auto"==a.overflow)},bind:function(a,b){return function(){return b.apply(a,
arguments)}},eval:function(a){var b=null;if(0<=a.indexOf("function"))try{eval("var _mxJavaScriptExpression="+a),b=_mxJavaScriptExpression,_mxJavaScriptExpression=null}catch(c){mxLog.warn(c.message+" while evaluating "+a)}else try{b=eval(a)}catch(d){mxLog.warn(d.message+" while evaluating "+a)}return b},findNode:function(a,b,c){var d=a.getAttribute(b);if(null!=d&&d==c)return a;for(a=a.firstChild;null!=a;){d=mxUtils.findNode(a,b,c);if(null!=d)return d;a=a.nextSibling}return null},findNodeByAttribute:function(){return 9<=
document.documentMode?function(a,b,c){var d=null;if(null!=a)if(a.nodeType==mxConstants.NODETYPE_ELEMENT&&a.getAttribute(b)==c)d=a;else for(a=a.firstChild;null!=a&&null==d;)d=mxUtils.findNodeByAttribute(a,b,c),a=a.nextSibling;return d}:mxClient.IS_IE?function(a,b,c){return null==a?null:a.ownerDocument.selectSingleNode("//*[@"+b+"='"+c+"']")}:function(a,b,c){return null==a?null:a.ownerDocument.evaluate("//*[@"+b+"='"+c+"']",a.ownerDocument,null,XPathResult.ANY_TYPE,null).iterateNext()}}(),getFunctionName:function(a){var b=
null;if(null!=a)if(null!=a.name)b=a.name;else{a=a.toString();for(b=9;" "==a.charAt(b);)b++;var c=a.indexOf("(",b),b=a.substring(b,c)}return b},indexOf:function(a,b){if(null!=a&&null!=b)for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1},remove:function(a,b){var c=null;if("object"==typeof b)for(var d=mxUtils.indexOf(b,a);0<=d;)b.splice(d,1),c=a,d=mxUtils.indexOf(b,a);for(var e in b)b[e]==a&&(delete b[e],c=a);return c},isNode:function(a,b,c,d){return null!=a&&!isNaN(a.nodeType)&&(null==b||a.nodeName.toLowerCase()==
b.toLowerCase())?null==c||a.getAttribute(c)==d:!1},getChildNodes:function(a,b){for(var b=b||mxConstants.NODETYPE_ELEMENT,c=[],d=a.firstChild;null!=d;)d.nodeType==b&&c.push(d),d=d.nextSibling;return c},createXmlDocument:function(){var a=null;document.implementation&&document.implementation.createDocument?a=document.implementation.createDocument("","",null):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLDOM"));return a},parseXml:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||
9>document.documentMode)?function(a){var b=mxUtils.createXmlDocument();b.async="false";b.loadXML(a);return b}:function(a){return(new DOMParser).parseFromString(a,"text/xml")}}(),clearSelection:function(){if(document.selection)return function(){document.selection.empty()};if(window.getSelection)return function(){window.getSelection().removeAllRanges()}}(),getPrettyXml:function(a,b,c){var d=[];if(null!=a)if(b=b||"  ",c=c||"",a.nodeType==mxConstants.NODETYPE_TEXT)d.push(a.nodeValue);else{d.push(c+"<"+
a.nodeName);var e=a.attributes;if(null!=e)for(var f=0;f<e.length;f++){var g=mxUtils.htmlEntities(e[f].nodeValue);d.push(" "+e[f].nodeName+'="'+g+'"')}e=a.firstChild;if(null!=e){for(d.push(">\n");null!=e;)d.push(mxUtils.getPrettyXml(e,b,c+b)),e=e.nextSibling;d.push(c+"</"+a.nodeName+">\n")}else d.push("/>\n")}return d.join("")},removeWhitespace:function(a,b){for(var c=b?a.previousSibling:a.nextSibling;null!=c&&c.nodeType==mxConstants.NODETYPE_TEXT;){var d=b?c.previousSibling:c.nextSibling,e=mxUtils.getTextContent(c);
0==mxUtils.trim(e).length&&c.parentNode.removeChild(c);c=d}},htmlEntities:function(a,b){a=(a||"").replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/\'/g,"&#39;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");if(null==b||b)a=a.replace(/\n/g,"&#xa;");return a},isVml:function(a){return null!=a&&"urn:schemas-microsoft-com:vml"==a.tagUrn},getXml:function(a,b){var c="";null!=window.XMLSerializer?c=(new XMLSerializer).serializeToString(a):null!=a.xml&&(c=a.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,
">").replace(/\r\n/g,"\n"));return c=c.replace(/\n/g,b||"&#xa;")},getTextContent:function(a){var b="";null!=a&&(null!=a.firstChild&&(a=a.firstChild),b=a.nodeValue||"");return b},getInnerHtml:function(){return mxClient.IS_IE?function(a){return null!=a?a.innerHTML:""}:function(a){return null!=a?(new XMLSerializer).serializeToString(a):""}}(),getOuterHtml:function(){return mxClient.IS_IE?function(a){if(null!=a){if(null!=a.outerHTML)return a.outerHTML;var b=[];b.push("<"+a.nodeName);var c=a.attributes;
if(null!=c)for(var d=0;d<c.length;d++){var e=c[d].nodeValue;null!=e&&0<e.length&&(b.push(" "),b.push(c[d].nodeName),b.push('="'),b.push(e),b.push('"'))}0==a.innerHTML.length?b.push("/>"):(b.push(">"),b.push(a.innerHTML),b.push("</"+a.nodeName+">"));return b.join("")}return""}:function(a){return null!=a?(new XMLSerializer).serializeToString(a):""}}(),write:function(a,b){var c=a.ownerDocument.createTextNode(b);null!=a&&a.appendChild(c);return c},writeln:function(a,b){var c=a.ownerDocument.createTextNode(b);
null!=a&&(a.appendChild(c),a.appendChild(document.createElement("br")));return c},br:function(a,b){for(var b=b||1,c=null,d=0;d<b;d++)null!=a&&(c=a.ownerDocument.createElement("br"),a.appendChild(c));return c},button:function(a,b,c){c=(null!=c?c:document).createElement("button");mxUtils.write(c,a);mxEvent.addListener(c,"click",function(a){b(a)});return c},para:function(a,b){var c=document.createElement("p");mxUtils.write(c,b);null!=a&&a.appendChild(c);return c},linkAction:function(a,b,c,d,e){return mxUtils.link(a,
b,function(){c.execute(d)},e)},linkInvoke:function(a,b,c,d,e,f){return mxUtils.link(a,b,function(){c[d](e)},f)},link:function(a,b,c,d){var e=document.createElement("span");e.style.color="blue";e.style.textDecoration="underline";e.style.cursor="pointer";null!=d&&(e.style.paddingLeft=d+"px");mxEvent.addListener(e,"click",c);mxUtils.write(e,b);null!=a&&a.appendChild(e);return e},fit:function(a){var b=parseInt(a.offsetLeft),c=parseInt(a.offsetWidth),d=document.body,e=document.documentElement,f=(d.scrollLeft||
e.scrollLeft)+(d.clientWidth||e.clientWidth);b+c>f&&(a.style.left=Math.max(d.scrollLeft||e.scrollLeft,f-c)+"px");b=parseInt(a.offsetTop);c=parseInt(a.offsetHeight);f=(d.scrollTop||e.scrollTop)+Math.max(d.clientHeight||0,e.clientHeight);b+c>f&&(a.style.top=Math.max(d.scrollTop||e.scrollTop,f-c)+"px")},open:function(a){if(mxClient.IS_NS){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(b){return mxUtils.alert("Permission to read file denied."),""}var c=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
c.initWithPath(a);if(!c.exists())return mxUtils.alert("File not found."),"";a=Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);a.init(c,1,4,null);c=Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);c.init(a);return c.read(c.available())}c=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(a,1);a=c.readAll();c.close();return a},save:function(a,b){if(mxClient.IS_NS){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(c){mxUtils.alert("Permission to write file denied.");
return}var d=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);d.initWithPath(a);d.exists()||d.create(0,420);var e=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);e.init(d,34,4,null);e.write(b,b.length);e.flush();e.close()}else d=(new ActiveXObject("Scripting.FileSystemObject")).CreateTextFile(a,!0),d.Write(b),d.Close()},saveAs:function(a){var b=document.createElement("iframe");
b.setAttribute("src","");b.style.visibility="hidden";document.body.appendChild(b);try{if(mxClient.IS_NS){var c=b.contentDocument;c.open();c.write(a);c.close();try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),b.focus(),saveDocument(c)}catch(d){mxUtils.alert("Permission to save document denied.")}}else c=b.contentWindow.document,c.write(a),c.execCommand("SaveAs",!1,document.location)}finally{document.body.removeChild(b)}},copy:function(a){if(window.clipboardData)window.clipboardData.setData("Text",
a);else{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var b=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(b){var c=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(c){c.addDataFlavor("text/unicode");var d=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);d.data=a;c.setTransferData("text/unicode",
d,2*a.length);b.setData(c,null,Components.interfaces.nsIClipboard.kGlobalClipboard)}}}},load:function(a){a=new mxXmlRequest(a,null,"GET",!1);a.send();return a},get:function(a,b,c){return(new mxXmlRequest(a,null,"GET")).send(b,c)},post:function(a,b,c,d){return(new mxXmlRequest(a,b)).send(c,d)},submit:function(a,b,c,d){return(new mxXmlRequest(a,b)).simulate(c,d)},loadInto:function(a,b,c){mxClient.IS_IE?b.onreadystatechange=function(){4==b.readyState&&c()}:b.addEventListener("load",c,!1);b.load(a)},
getValue:function(a,b,c){a=null!=a?a[b]:null;null==a&&(a=c);return a},getNumber:function(a,b,c){a=null!=a?a[b]:null;null==a&&(a=c||0);return Number(a)},getColor:function(a,b,c){a=null!=a?a[b]:null;null==a?a=c:a==mxConstants.NONE&&(a=null);return a},clone:function(a,b,c){var c=null!=c?c:!1,d=null;if(null!=a&&"function"==typeof a.constructor){var d=new a.constructor,e;for(e in a)if(e!=mxObjectIdentity.FIELD_NAME&&(null==b||0>mxUtils.indexOf(b,e)))d[e]=!c&&"object"==typeof a[e]?mxUtils.clone(a[e]):a[e]}return d},
equalPoints:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b)for(var c=0;c<a.length;c++)if(a[c]==b[c]||null!=a[c]&&!a[c].equals(b[c]))return!1;return!0},equalEntries:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b)for(var c in a)if(a[c]!=b[c])return!1;return!0},extend:function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=
a},toString:function(a){var b="",c;for(c in a)try{if(null==a[c])b+=c+" = [null]\n";else if("function"==typeof a[c])b+=c+" => [Function]\n";else if("object"==typeof a[c])var d=mxUtils.getFunctionName(a[c].constructor),b=b+(c+" => ["+d+"]\n");else b+=c+" = "+a[c]+"\n"}catch(e){b+=c+"="+e.message}return b},toRadians:function(a){return Math.PI*a/180},arcToCurves:function(a,b,c,d,e,f,g,h,k){h-=a;k-=b;if(0===c||0===d)return p;var c=Math.abs(c),d=Math.abs(d),l=-h/2,n=-k/2,o=Math.cos(e*Math.PI/180),p=Math.sin(e*
Math.PI/180),e=o*l+p*n,l=-1*p*l+o*n,n=e*e,r=l*l,s=c*c,u=d*d,w=n/s+r/u;1<w?(c*=Math.sqrt(w),d*=Math.sqrt(w),f=0):(w=1,f===g&&(w=-1),f=w*Math.sqrt((s*u-s*r-u*n)/(s*r+u*n)));n=f*c*l/d;r=-1*f*d*e/c;h=o*n-p*r+h/2;k=p*n+o*r+k/2;s=Math.atan2((l-r)/d,(e-n)/c)-Math.atan2(0,1);f=0<=s?s:2*Math.PI+s;s=Math.atan2((-l-r)/d,(-e-n)/c)-Math.atan2((l-r)/d,(e-n)/c);e=0<=s?s:2*Math.PI+s;0==g&&0<e?e-=2*Math.PI:0!=g&&0>e&&(e+=2*Math.PI);for(var g=2*e/Math.PI,g=Math.ceil(0>g?-1*g:g),e=e/g,l=8/3*Math.sin(e/4)*Math.sin(e/
4)/Math.sin(e/2),n=o*c,o=o*d,c=p*c,d=p*d,v=Math.cos(f),x=Math.sin(f),r=-l*(n*x+d*v),s=-l*(c*x-o*v),w=u=0,p=[],B=0;B<g;++B){var f=f+e,v=Math.cos(f),x=Math.sin(f),u=n*v-d*x+h,w=c*v+o*x+k,z=-l*(n*x+d*v),v=-l*(c*x-o*v),x=6*B;p[x]=Number(r+a);p[x+1]=Number(s+b);p[x+2]=Number(u-z+a);p[x+3]=Number(w-v+b);p[x+4]=Number(u+a);p[x+5]=Number(w+b);r=u+z;s=w+v}return p},getBoundingBox:function(a,b){var c=null;if(null!=a&&null!=b&&0!=b){var d=mxUtils.toRadians(b),c=Math.cos(d),e=Math.sin(d),f=new mxPoint(a.x+a.width/
2,a.y+a.height/2),g=new mxPoint(a.x,a.y),d=new mxPoint(a.x+a.width,a.y),h=new mxPoint(d.x,a.y+a.height),k=new mxPoint(a.x,h.y),g=mxUtils.getRotatedPoint(g,c,e,f),d=mxUtils.getRotatedPoint(d,c,e,f),h=mxUtils.getRotatedPoint(h,c,e,f),k=mxUtils.getRotatedPoint(k,c,e,f),c=new mxRectangle(g.x,g.y,0,0);c.add(new mxRectangle(d.x,d.y,0,0));c.add(new mxRectangle(h.x,h.y,0,0));c.add(new mxRectangle(k.x,k.y,0,0))}return c},getRotatedPoint:function(a,b,c,d){var d=null!=d?d:new mxPoint,e=a.x-d.x,a=a.y-d.y;return new mxPoint(e*
b-a*c+d.x,a*b+e*c+d.y)},getPortConstraints:function(a,b,c,d){a=mxUtils.getValue(a.style,mxConstants.STYLE_PORT_CONSTRAINT,null);if(null==a)return d;d=a.toString();a=mxConstants.DIRECTION_MASK_NONE;0<=d.indexOf(mxConstants.DIRECTION_NORTH)&&(a|=mxConstants.DIRECTION_MASK_NORTH);0<=d.indexOf(mxConstants.DIRECTION_WEST)&&(a|=mxConstants.DIRECTION_MASK_WEST);0<=d.indexOf(mxConstants.DIRECTION_SOUTH)&&(a|=mxConstants.DIRECTION_MASK_SOUTH);0<=d.indexOf(mxConstants.DIRECTION_EAST)&&(a|=mxConstants.DIRECTION_MASK_EAST);
return a},reversePortConstraints:function(a){var b=0,b=(a&mxConstants.DIRECTION_MASK_WEST)<<3,b=b|(a&mxConstants.DIRECTION_MASK_NORTH)<<1,b=b|(a&mxConstants.DIRECTION_MASK_SOUTH)>>1;return b|=(a&mxConstants.DIRECTION_MASK_EAST)>>3},findNearestSegment:function(a,b,c){var d=-1;if(0<a.absolutePoints.length)for(var e=a.absolutePoints[0],f=null,g=1;g<a.absolutePoints.length;g++){var h=a.absolutePoints[g],e=mxUtils.ptSegDistSq(e.x,e.y,h.x,h.y,b,c);if(null==f||e<f)f=e,d=g-1;e=h}return d},rectangleIntersectsSegment:function(a,
b,c){var d=a.y,e=a.x,f=d+a.height,g=e+a.width,a=b.x,h=c.x;b.x>c.x&&(a=c.x,h=b.x);h>g&&(h=g);a<e&&(a=e);if(a>h)return!1;var e=b.y,g=c.y,k=c.x-b.x;1.0E-7<Math.abs(k)&&(c=(c.y-b.y)/k,b=b.y-c*b.x,e=c*a+b,g=c*h+b);e>g&&(b=g,g=e,e=b);g>f&&(g=f);e<d&&(e=d);return e>g?!1:!0},contains:function(a,b,c){return a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c},intersects:function(a,b){var c=a.width,d=a.height,e=b.width,f=b.height;if(0>=e||0>=f||0>=c||0>=d)return!1;var g=a.x,h=a.y,k=b.x,l=b.y,e=e+k,f=f+l,c=c+g,
d=d+h;return(e<k||e>g)&&(f<l||f>h)&&(c<g||c>k)&&(d<h||d>l)},intersectsHotspot:function(a,b,c,d,e,f){d=null!=d?d:1;e=null!=e?e:0;f=null!=f?f:0;if(0<d){var g=a.getCenterX(),h=a.getCenterY(),k=a.width,l=a.height,n=mxUtils.getValue(a.style,mxConstants.STYLE_STARTSIZE)*a.view.scale;0<n&&(mxUtils.getValue(a.style,mxConstants.STYLE_HORIZONTAL,!0)?(h=a.y+n/2,l=n):(g=a.x+n/2,k=n));k=Math.max(e,k*d);l=Math.max(e,l*d);0<f&&(k=Math.min(k,f),l=Math.min(l,f));a=new mxRectangle(g-k/2,h-l/2,k,l);return mxUtils.contains(a,
b,c)}return!0},getOffset:function(a,b){var c=0,d=0;if(null!=b&&b)var e=document.body,f=document.documentElement,c=c+(e.scrollLeft||f.scrollLeft),d=d+(e.scrollTop||f.scrollTop);for(;a.offsetParent;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return new mxPoint(c,d)},getScrollOrigin:function(a){for(var b=document.body,c=document.documentElement,d=new mxPoint(b.scrollLeft||c.scrollLeft,b.scrollTop||c.scrollTop);null!=a&&a!=b&&a!=c;)!isNaN(a.scrollLeft)&&!isNaN(a.scrollTop)&&(d.x+=a.scrollLeft,d.y+=
a.scrollTop),a=a.parentNode;return d},convertPoint:function(a,b,c){var d=mxUtils.getScrollOrigin(a),a=mxUtils.getOffset(a);a.x-=d.x;a.y-=d.y;return new mxPoint(b-a.x,c-a.y)},ltrim:function(a,b){return a.replace(RegExp("^["+(b||"\\s")+"]+","g"),"")},rtrim:function(a,b){return a.replace(RegExp("["+(b||"\\s")+"]+$","g"),"")},trim:function(a,b){return mxUtils.ltrim(mxUtils.rtrim(a,b),b)},isNumeric:function(a){return null!=a&&(null==a.length||0<a.length&&0>a.indexOf("0x")&&0>a.indexOf("0X"))&&!isNaN(a)},
mod:function(a,b){return(a%b+b)%b},intersection:function(a,b,c,d,e,f,g,h){var k=(h-f)*(c-a)-(g-e)*(d-b),g=((g-e)*(b-f)-(h-f)*(a-e))/k,e=((c-a)*(b-f)-(d-b)*(a-e))/k;return 0<=g&&1>=g&&0<=e&&1>=e?new mxPoint(a+g*(c-a),b+g*(d-b)):null},ptSegDistSq:function(a,b,c,d,e,f){c-=a;d-=b;e-=a;f-=b;0>=e*c+f*d?c=0:(e=c-e,f=d-f,a=e*c+f*d,c=0>=a?0:a*a/(c*c+d*d));e=e*e+f*f-c;0>e&&(e=0);return e},relativeCcw:function(a,b,c,d,e,f){c-=a;d-=b;e-=a;f-=b;a=e*d-f*c;0==a&&(a=e*c+f*d,0<a&&(a=(e-c)*c+(f-d)*d,0>a&&(a=0)));return 0>
a?-1:0<a?1:0},animateChanges:function(a,b){mxEffects.animateChanges.apply(this,arguments)},cascadeOpacity:function(a,b,c){mxEffects.cascadeOpacity.apply(this,arguments)},fadeOut:function(a,b,c,d,e,f){mxEffects.fadeOut.apply(this,arguments)},setOpacity:function(a,b){mxUtils.isVml(a)?a.style.filter=100<=b?null:"alpha(opacity="+b/5+")":mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?a.style.filter=100<=b?null:"alpha(opacity="+b+")":a.style.opacity=b/100},createImage:function(a){var b=
null;mxClient.IS_IE6&&"CSS1Compat"!=document.compatMode?(b=document.createElement("v:image"),b.setAttribute("src",a),b.style.borderStyle="none"):(b=document.createElement("img"),b.setAttribute("src",a),b.setAttribute("border","0"));return b},sortCells:function(a,b){var b=null!=b?b:!0,c=new mxDictionary;a.sort(function(a,e){var f=c.get(a);null==f&&(f=mxCellPath.create(a).split(mxCellPath.PATH_SEPARATOR),c.put(a,f));var g=c.get(e);null==g&&(g=mxCellPath.create(e).split(mxCellPath.PATH_SEPARATOR),c.put(e,
g));f=mxCellPath.compare(f,g);return 0==f?0:0<f==b?1:-1});return a},getStylename:function(a){return null!=a&&(a=a.split(";")[0],0>a.indexOf("="))?a:""},getStylenames:function(a){var b=[];if(null!=a)for(var a=a.split(";"),c=0;c<a.length;c++)0>a[c].indexOf("=")&&b.push(a[c]);return b},indexOfStylename:function(a,b){if(null!=a&&null!=b)for(var c=a.split(";"),d=0,e=0;e<c.length;e++){if(c[e]==b)return d;d+=c[e].length+1}return-1},addStylename:function(a,b){0>mxUtils.indexOfStylename(a,b)&&(null==a?a="":
0<a.length&&";"!=a.charAt(a.length-1)&&(a+=";"),a+=b);return a},removeStylename:function(a,b){var c=[];if(null!=a)for(var d=a.split(";"),e=0;e<d.length;e++)d[e]!=b&&c.push(d[e]);return c.join(";")},removeAllStylenames:function(a){var b=[];if(null!=a)for(var a=a.split(";"),c=0;c<a.length;c++)0<=a[c].indexOf("=")&&b.push(a[c]);return b.join(";")},setCellStyles:function(a,b,c,d){if(null!=b&&0<b.length){a.beginUpdate();try{for(var e=0;e<b.length;e++)if(null!=b[e]){var f=mxUtils.setStyle(a.getStyle(b[e]),
c,d);a.setStyle(b[e],f)}}finally{a.endUpdate()}}},setStyle:function(a,b,c){var d=null!=c&&("undefined"==typeof c.length||0<c.length);if(null==a||0==a.length)d&&(a=b+"="+c);else{var e=a.indexOf(b+"=");0>e?d&&(d=";"==a.charAt(a.length-1)?"":";",a=a+d+b+"="+c):(b=d?b+"="+c:"",c=a.indexOf(";",e),d||c++,a=a.substring(0,e)+b+(c>e?a.substring(c):""))}return a},setCellStyleFlags:function(a,b,c,d,e){if(null!=b&&0<b.length){a.beginUpdate();try{for(var f=0;f<b.length;f++)if(null!=b[f]){var g=mxUtils.setStyleFlag(a.getStyle(b[f]),
c,d,e);a.setStyle(b[f],g)}}finally{a.endUpdate()}}},setStyleFlag:function(a,b,c,d){if(null==a||0==a.length)a=d||null==d?b+"="+c:b+"=0";else{var e=a.indexOf(b+"=");if(0>e)e=";"==a.charAt(a.length-1)?"":";",a=d||null==d?a+e+b+"="+c:a+e+b+"=0";else var f=a.indexOf(";",e),g="",g=0>f?a.substring(e+b.length+1):a.substring(e+b.length+1,f),g=null==d?parseInt(g)^c:d?parseInt(g)|c:parseInt(g)&~c,a=a.substring(0,e)+b+"="+g+(0<=f?a.substring(f):"")}return a},getSizeForString:function(a,b,c){var d=document.createElement("div");
d.style.fontSize=(b||mxConstants.DEFAULT_FONTSIZE)+"px";d.style.fontFamily=c||mxConstants.DEFAULT_FONTFAMILY;d.style.position="absolute";d.style.display="inline";d.style.visibility="hidden";d.innerHTML=a;document.body.appendChild(d);a=new mxRectangle(0,0,d.offsetWidth,d.offsetHeight);document.body.removeChild(d);return a},getViewXml:function(a,b,c,d,e){d=null!=d?d:0;e=null!=e?e:0;b=null!=b?b:1;null==c&&(c=[a.getModel().getRoot()]);var f=a.getView(),g=null,h=f.isEventsEnabled();f.setEventsEnabled(!1);
var k=f.drawPane,l=f.overlayPane;a.dialect==mxConstants.DIALECT_SVG?(f.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),f.canvas.appendChild(f.drawPane),f.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g")):(f.drawPane=f.drawPane.cloneNode(!1),f.canvas.appendChild(f.drawPane),f.overlayPane=f.overlayPane.cloneNode(!1));f.canvas.appendChild(f.overlayPane);var n=f.getTranslate();f.translate=new mxPoint(d,e);b=new mxTemporaryCellStates(a.getView(),b,c);try{g=(new mxCodec).encode(a.getView())}finally{b.destroy(),
f.translate=n,f.canvas.removeChild(f.drawPane),f.canvas.removeChild(f.overlayPane),f.drawPane=k,f.overlayPane=l,f.setEventsEnabled(h)}return g},getScaleForPageCount:function(a,b,c,d){if(1>a)return 1;var c=null!=c?c:mxConstants.PAGE_FORMAT_A4_PORTRAIT,d=null!=d?d:0,e=c.width-2*d,c=c.height-2*d,d=b.getGraphBounds().clone(),b=b.getView().getScale();d.width/=b;d.height/=b;var b=d.width,c=b/d.height/(e/c),d=Math.sqrt(a),f=Math.sqrt(c),c=d*f,d=d/f;if(1>c&&d>a)var g=d/a,d=a,c=c/g;1>d&&c>a&&(g=c/a,c=a,d/=
g);g=Math.ceil(c)*Math.ceil(d);for(f=0;g>a;){var g=Math.floor(c)/c,h=Math.floor(d)/d;1==g&&(g=Math.floor(c-1)/c);1==h&&(h=Math.floor(d-1)/d);g=g>h?g:h;c*=g;d*=g;g=Math.ceil(c)*Math.ceil(d);f++;if(10<f)break}return 0.99999*(e*c/b)},show:function(a,b,c,d){c=null!=c?c:0;d=null!=d?d:0;null==b?b=window.open().document:b.open();var e=a.getGraphBounds(),c=-e.x+c,d=-e.y+d;if(mxClient.IS_IE){for(var e="<html><head>",f=document.getElementsByTagName("base"),g=0;g<f.length;g++)e+=f[g].outerHTML;e+="<style>";
for(g=0;g<document.styleSheets.length;g++)try{e+=document.styleSheets(g).cssText}catch(h){}e=e+"</style></head><body>"+a.container.innerHTML;b.writeln(e+"</body><html>");b.close();a=b.body.getElementsByTagName("DIV")[0];null!=a&&(a.style.position="absolute",a.style.left=c+"px",a.style.top=d+"px")}else{b.writeln("<html");b.writeln("<head>");f=document.getElementsByTagName("base");for(g=0;g<f.length;g++)b.writeln(mxUtils.getOuterHtml(f[g]));f=document.getElementsByTagName("link");for(g=0;g<f.length;g++)b.writeln(mxUtils.getOuterHtml(f[g]));
f=document.getElementsByTagName("style");for(g=0;g<f.length;g++)b.writeln(mxUtils.getOuterHtml(f[g]));b.writeln("</head>");b.writeln("</html>");b.close();null==b.body&&b.documentElement.appendChild(b.createElement("body"));b.body.style.overflow="auto";for(a=a.container.firstChild;null!=a;)g=a.cloneNode(!0),b.body.appendChild(g),a=a.nextSibling;a=b.getElementsByTagName("g")[0];null!=a&&(a.setAttribute("transform","translate("+c+","+d+")"),c=a.ownerSVGElement,c.setAttribute("width",e.width+Math.max(e.x,
0)+3),c.setAttribute("height",e.height+Math.max(e.y,0)+3))}mxUtils.removeCursors(b.body);return b},printScreen:function(a){var b=window.open();mxUtils.show(a,b.document);a=function(){b.focus();b.print();b.close()};mxClient.IS_GC?b.setTimeout(a,500):a()},popup:function(a,b){if(b){var c=document.createElement("div");c.style.overflow="scroll";c.style.width="636px";c.style.height="460px";var d=document.createElement("pre");d.innerHTML=mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");
c.appendChild(d);c=new mxWindow("Popup Window",c,document.body.clientWidth/2-320,(document.body.clientHeight||document.documentElement.clientHeight)/2-240,640,480,!1,!0);c.setClosable(!0);c.setVisible(!0)}else mxClient.IS_NS?(c=window.open(),c.document.writeln("<pre>"+mxUtils.htmlEntities(a)+"</pre"),c.document.close()):(c=window.open(),d=c.document.createElement("pre"),d.innerHTML=mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),c.document.body.appendChild(d))},alert:function(a){alert(a)},
prompt:function(a,b){return prompt(a,b)},confirm:function(a){return confirm(a)},error:function(a,b,c,d){var e=document.createElement("div");e.style.padding="20px";var f=document.createElement("img");f.setAttribute("src",d||mxUtils.errorImage);f.setAttribute("valign","bottom");f.style.verticalAlign="middle";e.appendChild(f);e.appendChild(document.createTextNode("\u00a0"));e.appendChild(document.createTextNode("\u00a0"));e.appendChild(document.createTextNode("\u00a0"));mxUtils.write(e,a);var a=document.body.clientWidth,
d=document.body.clientHeight||document.documentElement.clientHeight,g=new mxWindow(mxResources.get(mxUtils.errorResource)||mxUtils.errorResource,e,(a-b)/2,d/4,b,null,!1,!0);c&&(mxUtils.br(e),b=document.createElement("p"),c=document.createElement("button"),mxClient.IS_IE?c.style.cssText="float:right":c.setAttribute("style","float:right"),mxEvent.addListener(c,"click",function(){g.destroy()}),mxUtils.write(c,mxResources.get(mxUtils.closeResource)||mxUtils.closeResource),b.appendChild(c),e.appendChild(b),
mxUtils.br(e),g.setClosable(!0));g.setVisible(!0);return g},makeDraggable:function(a,b,c,d,e,f,g,h,k,l){a=new mxDragSource(a,c);a.dragOffset=new mxPoint(null!=e?e:0,null!=f?f:mxConstants.TOOLTIP_VERTICAL_OFFSET);a.autoscroll=g;a.setGuidesEnabled(!1);null!=k&&(a.highlightDropTargets=k);null!=l&&(a.getDropTarget=l);a.getGraphForEvent=function(a){return"function"==typeof b?b(a):b};null!=d&&(a.createDragElement=function(){return d.cloneNode(!0)},h&&(a.createPreviewElement=function(a){var b=d.cloneNode(!0),
c=parseInt(b.style.width),e=parseInt(b.style.height);b.style.width=Math.round(c*a.view.scale)+"px";b.style.height=Math.round(e*a.view.scale)+"px";return b}));return a}},mxConstants={DEFAULT_HOTSPOT:0.3,MIN_HOTSPOT_SIZE:8,MAX_HOTSPOT_SIZE:0,RENDERING_HINT_EXACT:"exact",RENDERING_HINT_FASTER:"faster",RENDERING_HINT_FASTEST:"fastest",DIALECT_SVG:"svg",DIALECT_VML:"vml",DIALECT_MIXEDHTML:"mixedHtml",DIALECT_PREFERHTML:"preferHtml",DIALECT_STRICTHTML:"strictHtml",NS_SVG:"http://www.w3.org/2000/svg",NS_XHTML:"http://www.w3.org/1999/xhtml",
NS_XLINK:"http://www.w3.org/1999/xlink",SHADOWCOLOR:"gray",SHADOW_OFFSET_X:2,SHADOW_OFFSET_Y:3,SHADOW_OPACITY:1,NODETYPE_ELEMENT:1,NODETYPE_ATTRIBUTE:2,NODETYPE_TEXT:3,NODETYPE_CDATA:4,NODETYPE_ENTITY_REFERENCE:5,NODETYPE_ENTITY:6,NODETYPE_PROCESSING_INSTRUCTION:7,NODETYPE_COMMENT:8,NODETYPE_DOCUMENT:9,NODETYPE_DOCUMENTTYPE:10,NODETYPE_DOCUMENT_FRAGMENT:11,NODETYPE_NOTATION:12,TOOLTIP_VERTICAL_OFFSET:16,DEFAULT_VALID_COLOR:"#00FF00",DEFAULT_INVALID_COLOR:"#FF0000",HIGHLIGHT_STROKEWIDTH:3,CURSOR_MOVABLE_VERTEX:"move",
CURSOR_MOVABLE_EDGE:"move",CURSOR_LABEL_HANDLE:"default",CURSOR_BEND_HANDLE:"pointer",CURSOR_CONNECT:"pointer",HIGHLIGHT_COLOR:"#00FF00",CONNECT_TARGET_COLOR:"#0000FF",INVALID_CONNECT_TARGET_COLOR:"#FF0000",DROP_TARGET_COLOR:"#0000FF",VALID_COLOR:"#00FF00",INVALID_COLOR:"#FF0000",EDGE_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_STROKEWIDTH:1,EDGE_SELECTION_STROKEWIDTH:1,VERTEX_SELECTION_DASHED:!0,EDGE_SELECTION_DASHED:!0,GUIDE_COLOR:"#FF0000",GUIDE_STROKEWIDTH:1,OUTLINE_COLOR:"#0099FF",
OUTLINE_STROKEWIDTH:mxClient.IS_IE?2:3,HANDLE_SIZE:7,LABEL_HANDLE_SIZE:4,HANDLE_FILLCOLOR:"#00FF00",HANDLE_STROKECOLOR:"black",LABEL_HANDLE_FILLCOLOR:"yellow",CONNECT_HANDLE_FILLCOLOR:"#0000FF",LOCKED_HANDLE_FILLCOLOR:"#FF0000",OUTLINE_HANDLE_FILLCOLOR:"#00FFFF",OUTLINE_HANDLE_STROKECOLOR:"#0033FF",DEFAULT_FONTFAMILY:"Arial,Helvetica",DEFAULT_FONTSIZE:11,DEFAULT_STARTSIZE:40,DEFAULT_MARKERSIZE:6,DEFAULT_IMAGESIZE:24,ENTITY_SEGMENT:30,RECTANGLE_ROUNDING_FACTOR:0.15,LINE_ARCSIZE:20,ARROW_SPACING:10,
ARROW_WIDTH:30,ARROW_SIZE:30,PAGE_FORMAT_A4_PORTRAIT:new mxRectangle(0,0,826,1169),PAGE_FORMAT_A4_LANDSCAPE:new mxRectangle(0,0,1169,826),PAGE_FORMAT_LETTER_PORTRAIT:new mxRectangle(0,0,850,1100),PAGE_FORMAT_LETTER_LANDSCAPE:new mxRectangle(0,0,1100,850),NONE:"none",STYLE_PERIMETER:"perimeter",STYLE_SOURCE_PORT:"sourcePort",STYLE_TARGET_PORT:"targetPort",STYLE_PORT_CONSTRAINT:"portConstraint",STYLE_OPACITY:"opacity",STYLE_TEXT_OPACITY:"textOpacity",STYLE_OVERFLOW:"overflow",STYLE_ORTHOGONAL:"orthogonal",
STYLE_EXIT_X:"exitX",STYLE_EXIT_Y:"exitY",STYLE_EXIT_PERIMETER:"exitPerimeter",STYLE_ENTRY_X:"entryX",STYLE_ENTRY_Y:"entryY",STYLE_ENTRY_PERIMETER:"entryPerimeter",STYLE_WHITE_SPACE:"whiteSpace",STYLE_ROTATION:"rotation",STYLE_FILLCOLOR:"fillColor",STYLE_GRADIENTCOLOR:"gradientColor",STYLE_GRADIENT_DIRECTION:"gradientDirection",STYLE_STROKECOLOR:"strokeColor",STYLE_SEPARATORCOLOR:"separatorColor",STYLE_STROKEWIDTH:"strokeWidth",STYLE_ALIGN:"align",STYLE_VERTICAL_ALIGN:"verticalAlign",STYLE_LABEL_POSITION:"labelPosition",
STYLE_VERTICAL_LABEL_POSITION:"verticalLabelPosition",STYLE_IMAGE_ASPECT:"imageAspect",STYLE_IMAGE_ALIGN:"imageAlign",STYLE_IMAGE_VERTICAL_ALIGN:"imageVerticalAlign",STYLE_GLASS:"glass",STYLE_IMAGE:"image",STYLE_IMAGE_WIDTH:"imageWidth",STYLE_IMAGE_HEIGHT:"imageHeight",STYLE_IMAGE_BACKGROUND:"imageBackground",STYLE_IMAGE_BORDER:"imageBorder",STYLE_IMAGE_FLIPH:"imageFlipH",STYLE_IMAGE_FLIPV:"imageFlipV",STYLE_STENCIL_FLIPH:"stencilFlipH",STYLE_STENCIL_FLIPV:"stencilFlipV",STYLE_NOLABEL:"noLabel",STYLE_NOEDGESTYLE:"noEdgeStyle",
STYLE_LABEL_BACKGROUNDCOLOR:"labelBackgroundColor",STYLE_LABEL_BORDERCOLOR:"labelBorderColor",STYLE_LABEL_PADDING:"labelPadding",STYLE_INDICATOR_SHAPE:"indicatorShape",STYLE_INDICATOR_IMAGE:"indicatorImage",STYLE_INDICATOR_COLOR:"indicatorColor",STYLE_INDICATOR_STROKECOLOR:"indicatorStrokeColor",STYLE_INDICATOR_GRADIENTCOLOR:"indicatorGradientColor",STYLE_INDICATOR_SPACING:"indicatorSpacing",STYLE_INDICATOR_WIDTH:"indicatorWidth",STYLE_INDICATOR_HEIGHT:"indicatorHeight",STYLE_INDICATOR_DIRECTION:"indicatorDirection",
STYLE_SHADOW:"shadow",STYLE_SEGMENT:"segment",STYLE_ENDARROW:"endArrow",STYLE_STARTARROW:"startArrow",STYLE_ENDSIZE:"endSize",STYLE_STARTSIZE:"startSize",STYLE_ENDFILL:"endFill",STYLE_STARTFILL:"startFill",STYLE_DASHED:"dashed",STYLE_DASH_PATTERN:"dashPattern",STYLE_ROUNDED:"rounded",STYLE_CURVED:"curved",STYLE_ARCSIZE:"arcSize",STYLE_SMOOTH:"smooth",STYLE_SOURCE_PERIMETER_SPACING:"sourcePerimeterSpacing",STYLE_TARGET_PERIMETER_SPACING:"targetPerimeterSpacing",STYLE_PERIMETER_SPACING:"perimeterSpacing",
STYLE_SPACING:"spacing",STYLE_SPACING_TOP:"spacingTop",STYLE_SPACING_LEFT:"spacingLeft",STYLE_SPACING_BOTTOM:"spacingBottom",STYLE_SPACING_RIGHT:"spacingRight",STYLE_HORIZONTAL:"horizontal",STYLE_DIRECTION:"direction",STYLE_ELBOW:"elbow",STYLE_FONTCOLOR:"fontColor",STYLE_FONTFAMILY:"fontFamily",STYLE_FONTSIZE:"fontSize",STYLE_FONTSTYLE:"fontStyle",STYLE_AUTOSIZE:"autosize",STYLE_FOLDABLE:"foldable",STYLE_EDITABLE:"editable",STYLE_BENDABLE:"bendable",STYLE_MOVABLE:"movable",STYLE_RESIZABLE:"resizable",
STYLE_CLONEABLE:"cloneable",STYLE_DELETABLE:"deletable",STYLE_SHAPE:"shape",STYLE_EDGE:"edgeStyle",STYLE_LOOP:"loopStyle",STYLE_ROUTING_CENTER_X:"routingCenterX",STYLE_ROUTING_CENTER_Y:"routingCenterY",FONT_BOLD:1,FONT_ITALIC:2,FONT_UNDERLINE:4,FONT_SHADOW:8,SHAPE_RECTANGLE:"rectangle",SHAPE_ELLIPSE:"ellipse",SHAPE_DOUBLE_ELLIPSE:"doubleEllipse",SHAPE_RHOMBUS:"rhombus",SHAPE_LINE:"line",SHAPE_IMAGE:"image",SHAPE_ARROW:"arrow",SHAPE_LABEL:"label",SHAPE_CYLINDER:"cylinder",SHAPE_SWIMLANE:"swimlane",
SHAPE_CONNECTOR:"connector",SHAPE_ACTOR:"actor",SHAPE_CLOUD:"cloud",SHAPE_TRIANGLE:"triangle",SHAPE_HEXAGON:"hexagon",ARROW_CLASSIC:"classic",ARROW_BLOCK:"block",ARROW_OPEN:"open",ARROW_OVAL:"oval",ARROW_DIAMOND:"diamond",ARROW_DIAMOND_THIN:"diamondThin",ALIGN_LEFT:"left",ALIGN_CENTER:"center",ALIGN_RIGHT:"right",ALIGN_TOP:"top",ALIGN_MIDDLE:"middle",ALIGN_BOTTOM:"bottom",DIRECTION_NORTH:"north",DIRECTION_SOUTH:"south",DIRECTION_EAST:"east",DIRECTION_WEST:"west",DIRECTION_MASK_NONE:0,DIRECTION_MASK_WEST:1,
DIRECTION_MASK_NORTH:2,DIRECTION_MASK_SOUTH:4,DIRECTION_MASK_EAST:8,DIRECTION_MASK_ALL:15,ELBOW_VERTICAL:"vertical",ELBOW_HORIZONTAL:"horizontal",EDGESTYLE_ELBOW:"elbowEdgeStyle",EDGESTYLE_ENTITY_RELATION:"entityRelationEdgeStyle",EDGESTYLE_LOOP:"loopEdgeStyle",EDGESTYLE_SIDETOSIDE:"sideToSideEdgeStyle",EDGESTYLE_TOPTOBOTTOM:"topToBottomEdgeStyle",EDGESTYLE_ORTHOGONAL:"orthogonalEdgeStyle",EDGESTYLE_SEGMENT:"segmentEdgeStyle",PERIMETER_ELLIPSE:"ellipsePerimeter",PERIMETER_RECTANGLE:"rectanglePerimeter",
PERIMETER_RHOMBUS:"rhombusPerimeter",PERIMETER_TRIANGLE:"trianglePerimeter"};function mxEventObject(a){this.name=a;this.properties=[];for(var b=1;b<arguments.length;b+=2)null!=arguments[b+1]&&(this.properties[arguments[b]]=arguments[b+1])}mxEventObject.prototype.name=null;mxEventObject.prototype.properties=null;mxEventObject.prototype.consumed=!1;mxEventObject.prototype.getName=function(){return this.name};mxEventObject.prototype.getProperties=function(){return this.properties};
mxEventObject.prototype.getProperty=function(a){return this.properties[a]};mxEventObject.prototype.isConsumed=function(){return this.consumed};mxEventObject.prototype.consume=function(){this.consumed=!0};function mxMouseEvent(a,b){this.evt=a;this.state=b}mxMouseEvent.prototype.consumed=!1;mxMouseEvent.prototype.evt=null;mxMouseEvent.prototype.graphX=null;mxMouseEvent.prototype.graphY=null;mxMouseEvent.prototype.state=null;mxMouseEvent.prototype.getEvent=function(){return this.evt};
mxMouseEvent.prototype.getSource=function(){return mxEvent.getSource(this.evt)};mxMouseEvent.prototype.isSource=function(a){if(null!=a)for(var b=this.getSource();null!=b;){if(b==a.node)return!0;b=b.parentNode}return!1};mxMouseEvent.prototype.getX=function(){return mxEvent.getClientX(this.getEvent())};mxMouseEvent.prototype.getY=function(){return mxEvent.getClientY(this.getEvent())};mxMouseEvent.prototype.getGraphX=function(){return this.graphX};mxMouseEvent.prototype.getGraphY=function(){return this.graphY};
mxMouseEvent.prototype.getState=function(){return this.state};mxMouseEvent.prototype.getCell=function(){var a=this.getState();return null!=a?a.cell:null};mxMouseEvent.prototype.isPopupTrigger=function(){return mxEvent.isPopupTrigger(this.getEvent())};mxMouseEvent.prototype.isConsumed=function(){return this.consumed};mxMouseEvent.prototype.consume=function(a){(null!=a?a:1)&&this.evt.preventDefault&&this.evt.preventDefault();this.evt.returnValue=!1;this.consumed=!0};
function mxEventSource(a){this.setEventSource(a)}mxEventSource.prototype.eventListeners=null;mxEventSource.prototype.eventsEnabled=!0;mxEventSource.prototype.eventSource=null;mxEventSource.prototype.isEventsEnabled=function(){return this.eventsEnabled};mxEventSource.prototype.setEventsEnabled=function(a){this.eventsEnabled=a};mxEventSource.prototype.getEventSource=function(){return this.eventSource};mxEventSource.prototype.setEventSource=function(a){this.eventSource=a};
mxEventSource.prototype.addListener=function(a,b){null==this.eventListeners&&(this.eventListeners=[]);this.eventListeners.push(a);this.eventListeners.push(b)};mxEventSource.prototype.removeListener=function(a){if(null!=this.eventListeners)for(var b=0;b<this.eventListeners.length;)this.eventListeners[b+1]==a?this.eventListeners.splice(b,2):b+=2};
mxEventSource.prototype.fireEvent=function(a,b){if(null!=this.eventListeners&&this.isEventsEnabled()){null==a&&(a=new mxEventObject);null==b&&(b=this.getEventSource());null==b&&(b=this);for(var c=[b,a],d=0;d<this.eventListeners.length;d+=2){var e=this.eventListeners[d];(null==e||e==a.getName())&&this.eventListeners[d+1].apply(this,c)}}};
var mxEvent={objects:[],addListener:function(){var a=function(a,c,d){null==a.mxListenerList&&(a.mxListenerList=[],mxEvent.objects.push(a));a.mxListenerList.push({name:c,f:d})};return window.addEventListener?function(b,c,d){b.addEventListener(c,d,!1);a(b,c,d)}:function(b,c,d){b.attachEvent("on"+c,d);a(b,c,d)}}(),removeListener:function(){var a=function(a,c,d){if(null!=a.mxListenerList){for(var c=a.mxListenerList.length,e=0;e<c;e++)if(a.mxListenerList[e].f==d){a.mxListenerList.splice(e,1);break}0==
a.mxListenerList.length&&(a.mxListenerList=null)}};return window.removeEventListener?function(b,c,d){b.removeEventListener(c,d,!1);a(b,c,d)}:function(b,c,d){b.detachEvent("on"+c,d);a(b,c,d)}}(),removeAllListeners:function(a){var b=a.mxListenerList;if(null!=b)for(;0<b.length;){var c=b[0];mxEvent.removeListener(a,c.name,c.f)}},redirectMouseEvents:function(a,b,c,d,e,f,g){var h=function(a){return"function"==typeof c?c(a):c},k=mxClient.IS_TOUCH?"touchmove":"mousemove",l=mxClient.IS_TOUCH?"touchend":"mouseup";
mxEvent.addListener(a,mxClient.IS_TOUCH?"touchstart":"mousedown",function(a){null!=d?d(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,h(a)))});mxEvent.addListener(a,k,function(a){null!=e?e(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,h(a)))});mxEvent.addListener(a,l,function(a){null!=f?f(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,h(a)))});mxEvent.addListener(a,"dblclick",function(a){if(null!=
g)g(a);else if(!mxEvent.isConsumed(a)){var c=h(a);b.dblClick(a,null!=c?c.cell:null)}})},release:function(a){if(null!=a&&(mxEvent.removeAllListeners(a),a=a.childNodes,null!=a))for(var b=a.length,c=0;c<b;c+=1)mxEvent.release(a[c])},addMouseWheelListener:function(a){if(null!=a){var b=function(b){null==b&&(b=window.event);var d=0,d=mxClient.IS_NS&&!mxClient.IS_SF&&!mxClient.IS_GC?-b.detail/2:b.wheelDelta/120;0!=d&&a(b,0<d)};mxClient.IS_NS?mxEvent.addListener(window,mxClient.IS_SF||mxClient.IS_GC?"mousewheel":
"DOMMouseScroll",b):mxEvent.addListener(document,"mousewheel",b)}},disableContextMenu:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?function(a){mxEvent.addListener(a,"contextmenu",function(){return!1})}:function(a){a.setAttribute("oncontextmenu","return false;")}}(),getSource:function(a){return null!=a.srcElement?a.srcElement:a.target},isConsumed:function(a){return null!=a.isConsumed&&a.isConsumed},isLeftMouseButton:function(a){return a.button==
(mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?1:0)},isRightMouseButton:function(a){return 2==a.button},isPopupTrigger:function(a){return mxEvent.isRightMouseButton(a)||mxEvent.isShiftDown(a)&&!mxEvent.isControlDown(a)},isShiftDown:function(a){return null!=a?a.shiftKey:!1},isAltDown:function(a){return null!=a?a.altKey:!1},isControlDown:function(a){return null!=a?a.ctrlKey:!1},isMetaDown:function(a){return null!=a?a.metaKey:!1},getMainEvent:function(a){("touchstart"==
a.type||"touchmove"==a.type)&&null!=a.touches&&null!=a.touches[0]?a=a.touches[0]:"touchend"==a.type&&null!=a.changedTouches&&null!=a.changedTouches[0]&&(a=a.changedTouches[0]);return a},getClientX:function(a){return mxEvent.getMainEvent(a).clientX},getClientY:function(a){return mxEvent.getMainEvent(a).clientY},consume:function(a,b,c){c=null!=c?c:!0;if(null!=b?b:1)a.preventDefault?(c&&a.stopPropagation(),a.preventDefault()):c&&(a.cancelBubble=!0);a.isConsumed=!0;a.returnValue=!1},LABEL_HANDLE:-1,ROTATION_HANDLE:-2,
MOUSE_DOWN:"mouseDown",MOUSE_MOVE:"mouseMove",MOUSE_UP:"mouseUp",ACTIVATE:"activate",RESIZE_START:"resizeStart",RESIZE:"resize",RESIZE_END:"resizeEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",PAN_START:"panStart",PAN:"pan",PAN_END:"panEnd",MINIMIZE:"minimize",NORMALIZE:"normalize",MAXIMIZE:"maximize",HIDE:"hide",SHOW:"show",CLOSE:"close",DESTROY:"destroy",REFRESH:"refresh",SIZE:"size",SELECT:"select",FIRED:"fired",GET:"get",RECEIVE:"receive",CONNECT:"connect",DISCONNECT:"disconnect",
SUSPEND:"suspend",RESUME:"resume",MARK:"mark",SESSION:"session",ROOT:"root",POST:"post",OPEN:"open",SAVE:"save",BEFORE_ADD_VERTEX:"beforeAddVertex",ADD_VERTEX:"addVertex",AFTER_ADD_VERTEX:"afterAddVertex",DONE:"done",EXECUTE:"execute",BEGIN_UPDATE:"beginUpdate",END_UPDATE:"endUpdate",BEFORE_UNDO:"beforeUndo",UNDO:"undo",REDO:"redo",CHANGE:"change",NOTIFY:"notify",LAYOUT_CELLS:"layoutCells",CLICK:"click",SCALE:"scale",TRANSLATE:"translate",SCALE_AND_TRANSLATE:"scaleAndTranslate",UP:"up",DOWN:"down",
ADD:"add",REMOVE:"remove",CLEAR:"clear",ADD_CELLS:"addCells",CELLS_ADDED:"cellsAdded",MOVE_CELLS:"moveCells",CELLS_MOVED:"cellsMoved",RESIZE_CELLS:"resizeCells",CELLS_RESIZED:"cellsResized",TOGGLE_CELLS:"toggleCells",CELLS_TOGGLED:"cellsToggled",ORDER_CELLS:"orderCells",CELLS_ORDERED:"cellsOrdered",REMOVE_CELLS:"removeCells",CELLS_REMOVED:"cellsRemoved",GROUP_CELLS:"groupCells",UNGROUP_CELLS:"ungroupCells",REMOVE_CELLS_FROM_PARENT:"removeCellsFromParent",FOLD_CELLS:"foldCells",CELLS_FOLDED:"cellsFolded",
ALIGN_CELLS:"alignCells",LABEL_CHANGED:"labelChanged",CONNECT_CELL:"connectCell",CELL_CONNECTED:"cellConnected",SPLIT_EDGE:"splitEdge",FLIP_EDGE:"flipEdge",START_EDITING:"startEditing",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",UPDATE_CELL_SIZE:"updateCellSize",ESCAPE:"escape",CLICK:"click",DOUBLE_CLICK:"doubleClick",START:"start",RESET:"reset"};function mxXmlRequest(a,b,c,d,e,f){this.url=a;this.params=b;this.method=c||"POST";this.async=null!=d?d:!0;this.username=e;this.password=f}
mxXmlRequest.prototype.url=null;mxXmlRequest.prototype.params=null;mxXmlRequest.prototype.method=null;mxXmlRequest.prototype.async=null;mxXmlRequest.prototype.binary=!1;mxXmlRequest.prototype.username=null;mxXmlRequest.prototype.password=null;mxXmlRequest.prototype.request=null;mxXmlRequest.prototype.isBinary=function(){return this.binary};mxXmlRequest.prototype.setBinary=function(a){this.binary=a};mxXmlRequest.prototype.getText=function(){return this.request.responseText};
mxXmlRequest.prototype.isReady=function(){return 4==this.request.readyState};mxXmlRequest.prototype.getDocumentElement=function(){var a=this.getXml();return null!=a?a.documentElement:null};mxXmlRequest.prototype.getXml=function(){var a=this.request.responseXML;if(9<=document.documentMode||null==a||null==a.documentElement)a=mxUtils.parseXml(this.request.responseText);return a};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.getStatus=function(){return this.request.status};
mxXmlRequest.prototype.create=function(){if(window.XMLHttpRequest)return function(){var a=new XMLHttpRequest;this.isBinary()&&a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined");return a};if("undefined"!=typeof ActiveXObject)return function(){return new ActiveXObject("Microsoft.XMLHTTP")}}();
mxXmlRequest.prototype.send=function(a){this.request=this.create();null!=this.request&&(null!=a&&(this.request.onreadystatechange=mxUtils.bind(this,function(){this.isReady()&&(a(this),this.onreadystatechaange=null)})),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),this.request.send(this.params))};mxXmlRequest.prototype.setRequestHeaders=function(a,b){null!=b&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")};
mxXmlRequest.prototype.simulate=function(a,b){var a=a||document,c=null;a==document&&(c=window.onbeforeunload,window.onbeforeunload=null);var d=a.createElement("form");d.setAttribute("method",this.method);d.setAttribute("action",this.url);null!=b&&d.setAttribute("target",b);d.style.display="none";d.style.visibility="hidden";for(var e=0<this.params.indexOf("&")?this.params.split("&"):this.params.split(),f=0;f<e.length;f++){var g=e[f].indexOf("=");if(0<g){var h=e[f].substring(0,g),k=e[f].substring(g+
1),g=a.createElement("textarea");g.setAttribute("name",h);k=k.replace(/\n/g,"&#xa;");h=a.createTextNode(k);g.appendChild(h);d.appendChild(g)}}a.body.appendChild(d);d.submit();a.body.removeChild(d);null!=c&&(window.onbeforeunload=c)};
var mxClipboard={STEPSIZE:10,insertCount:1,cells:null,isEmpty:function(){return null==mxClipboard.cells},cut:function(a,b){b=mxClipboard.copy(a,b);mxClipboard.insertCount=0;mxClipboard.removeCells(a,b);return b},removeCells:function(a,b){a.removeCells(b)},copy:function(a,b){var b=b||a.getSelectionCells(),c=a.getExportableCells(b);mxClipboard.insertCount=1;mxClipboard.cells=a.cloneCells(c);return c},paste:function(a){if(null!=mxClipboard.cells){var b=a.getImportableCells(mxClipboard.cells),c=mxClipboard.insertCount*
mxClipboard.STEPSIZE,d=a.getDefaultParent(),b=a.importCells(b,c,c,d);mxClipboard.insertCount++;a.setSelectionCells(b)}}};function mxWindow(a,b,c,d,e,f,g,h,k,l){null!=b&&(g=null!=g?g:!0,this.content=b,this.init(c,d,e,f,l),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(g),this.setTitle(a),(null==h||h)&&this.installMoveHandler(),null!=k&&null!=k.parentNode?k.parentNode.replaceChild(this.div,k):document.body.appendChild(this.div))}
mxWindow.prototype=new mxEventSource;mxWindow.prototype.constructor=mxWindow;mxWindow.prototype.closeImage=mxClient.imageBasePath+"/close.gif";mxWindow.prototype.minimizeImage=mxClient.imageBasePath+"/minimize.gif";mxWindow.prototype.normalizeImage=mxClient.imageBasePath+"/normalize.gif";mxWindow.prototype.maximizeImage=mxClient.imageBasePath+"/maximize.gif";mxWindow.prototype.resizeImage=mxClient.imageBasePath+"/resize.gif";mxWindow.prototype.visible=!1;mxWindow.prototype.content=!1;
mxWindow.prototype.minimumSize=new mxRectangle(0,0,50,40);mxWindow.prototype.title=!1;mxWindow.prototype.content=!1;mxWindow.prototype.destroyOnClose=!0;
mxWindow.prototype.init=function(a,b,c,d,e){e=null!=e?e:"mxWindow";this.div=document.createElement("div");this.div.className=e;this.div.style.left=a+"px";this.div.style.top=b+"px";this.table=document.createElement("table");this.table.className=e;null!=c&&(mxClient.IS_IE||(this.div.style.width=c+"px"),this.table.style.width=c+"px");null!=d&&(mxClient.IS_IE||(this.div.style.height=d+"px"),this.table.style.height=d+"px");a=document.createElement("tbody");b=document.createElement("tr");this.title=document.createElement("td");
this.title.className=e+"Title";b.appendChild(this.title);a.appendChild(b);b=document.createElement("tr");this.td=document.createElement("td");this.td.className=e+"Pane";this.contentWrapper=document.createElement("div");this.contentWrapper.className=e+"Pane";this.contentWrapper.style.width="100%";this.contentWrapper.appendChild(this.content);if(mxClient.IS_IE||"DIV"!=this.content.nodeName.toUpperCase())this.contentWrapper.style.height="100%";this.td.appendChild(this.contentWrapper);b.appendChild(this.td);
a.appendChild(b);this.table.appendChild(a);this.div.appendChild(this.table);e=mxUtils.bind(this,function(){this.activate()});a=mxClient.IS_TOUCH?"touchstart":"mousedown";mxEvent.addListener(this.title,a,e);mxEvent.addListener(this.table,a,e);this.hide()};mxWindow.prototype.setTitle=function(a){for(var b=this.title.firstChild;null!=b;){var c=b.nextSibling;b.nodeType==mxConstants.NODETYPE_TEXT&&b.parentNode.removeChild(b);b=c}mxUtils.write(this.title,a||"")};
mxWindow.prototype.setScrollable=function(a){0>navigator.userAgent.indexOf("Presto/2.5")&&(this.contentWrapper.style.overflow=a?"auto":"hidden")};
mxWindow.prototype.activate=function(){if(mxWindow.activeWindow!=this){var a=mxUtils.getCurrentStyle(this.getElement()),a=null!=a?a.zIndex:3;if(mxWindow.activeWindow){var b=mxWindow.activeWindow.getElement();null!=b&&null!=b.style&&(b.style.zIndex=a)}b=mxWindow.activeWindow;this.getElement().style.zIndex=parseInt(a)+1;mxWindow.activeWindow=this;this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",b))}};mxWindow.prototype.getElement=function(){return this.div};
mxWindow.prototype.fit=function(){mxUtils.fit(this.div)};mxWindow.prototype.isResizable=function(){return null!=this.resize?"none"!=this.resize.style.display:!1};
mxWindow.prototype.setResizable=function(a){if(a)if(null==this.resize){this.resize=document.createElement("img");this.resize.style.position="absolute";this.resize.style.bottom="2px";this.resize.style.right="2px";this.resize.setAttribute("src",mxClient.imageBasePath+"/resize.gif");this.resize.style.cursor="nw-resize";var b=mxClient.IS_TOUCH?"touchmove":"mousemove",c=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(this.resize,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(a){this.activate();
var e=mxEvent.getClientX(a),f=mxEvent.getClientY(a),g=this.div.offsetWidth,h=this.div.offsetHeight,k=mxUtils.bind(this,function(a){var b=mxEvent.getClientX(a)-e,c=mxEvent.getClientY(a)-f;this.setSize(g+b,h+c);this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",a));mxEvent.consume(a)}),l=mxUtils.bind(this,function(a){mxEvent.removeListener(document,b,k);mxEvent.removeListener(document,c,l);this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",a));mxEvent.consume(a)});mxEvent.addListener(document,
b,k);mxEvent.addListener(document,c,l);this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",a));mxEvent.consume(a)}));this.div.appendChild(this.resize)}else this.resize.style.display="inline";else null!=this.resize&&(this.resize.style.display="none")};
mxWindow.prototype.setSize=function(a,b){a=Math.max(this.minimumSize.width,a);b=Math.max(this.minimumSize.height,b);mxClient.IS_IE||(this.div.style.width=a+"px",this.div.style.height=b+"px");this.table.style.width=a+"px";this.table.style.height=b+"px";mxClient.IS_IE||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-2+"px")};mxWindow.prototype.setMinimizable=function(a){this.minimize.style.display=a?"":"none"};
mxWindow.prototype.getMinimumSize=function(){return new mxRectangle(0,0,0,this.title.offsetHeight)};
mxWindow.prototype.installMinimizeHandler=function(){this.minimize=document.createElement("img");this.minimize.setAttribute("src",this.minimizeImage);this.minimize.setAttribute("align","right");this.minimize.setAttribute("title","Minimize");this.minimize.style.cursor="pointer";this.minimize.style.marginRight="1px";this.minimize.style.display="none";this.title.appendChild(this.minimize);var a=!1,b=null,c=null,d=mxUtils.bind(this,function(d){this.activate();if(a)a=!1,this.minimize.setAttribute("src",
this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=b,mxClient.IS_IE||(this.div.style.height=c),this.table.style.height=c,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",d));else{a=!0;this.minimize.setAttribute("src",this.normalizeImage);this.minimize.setAttribute("title","Normalize");this.contentWrapper.style.display="none";b=this.maximize.style.display;
this.maximize.style.display="none";c=this.table.style.height;var f=this.getMinimumSize();0<f.height&&(mxClient.IS_IE||(this.div.style.height=f.height+"px"),this.table.style.height=f.height+"px");0<f.width&&(mxClient.IS_IE||(this.div.style.width=f.width+"px"),this.table.style.width=f.width+"px");null!=this.resize&&(this.resize.style.visibility="hidden");this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",d))}mxEvent.consume(d)});mxEvent.addListener(this.minimize,mxClient.IS_TOUCH?"touchstart":
"mousedown",d)};mxWindow.prototype.setMaximizable=function(a){this.maximize.style.display=a?"":"none"};
mxWindow.prototype.installMaximizeHandler=function(){this.maximize=document.createElement("img");this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("align","right");this.maximize.setAttribute("title","Maximize");this.maximize.style.cursor="default";this.maximize.style.marginLeft="1px";this.maximize.style.cursor="pointer";this.maximize.style.display="none";this.title.appendChild(this.maximize);var a=!1,b=null,c=null,d=null,e=null,f=mxUtils.bind(this,function(f){this.activate();
if("none"!=this.maximize.style.display){if(a){a=!1;this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("title","Maximize");this.contentWrapper.style.display="";this.minimize.style.visibility="";this.div.style.left=b+"px";this.div.style.top=c+"px";if(!mxClient.IS_IE&&(this.div.style.height=d,this.div.style.width=e,h=mxUtils.getCurrentStyle(this.contentWrapper),"auto"==h.overflow||null!=this.resize))this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-
2+"px";this.table.style.height=d;this.table.style.width=e;null!=this.resize&&(this.resize.style.visibility="");this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",f))}else{a=!0;this.maximize.setAttribute("src",this.normalizeImage);this.maximize.setAttribute("title","Normalize");this.contentWrapper.style.display="";this.minimize.style.visibility="hidden";b=parseInt(this.div.style.left);c=parseInt(this.div.style.top);d=this.table.style.height;e=this.table.style.width;this.div.style.left="0px";
this.div.style.top="0px";mxClient.IS_IE||(this.div.style.height=document.body.clientHeight-2+"px",this.div.style.width=document.body.clientWidth-2+"px");this.table.style.width=document.body.clientWidth-2+"px";this.table.style.height=document.body.clientHeight-2+"px";null!=this.resize&&(this.resize.style.visibility="hidden");if(!mxClient.IS_IE){var h=mxUtils.getCurrentStyle(this.contentWrapper);if("auto"==h.overflow||null!=this.resize)this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-
2+"px"}this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",f))}mxEvent.consume(f)}});mxEvent.addListener(this.maximize,mxClient.IS_TOUCH?"touchstart":"mousedown",f);mxEvent.addListener(this.title,"dblclick",f)};
mxWindow.prototype.installMoveHandler=function(){this.title.style.cursor="move";var a=mxClient.IS_TOUCH?"touchmove":"mousemove",b=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(this.title,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(c){var d=mxEvent.getClientX(c),e=mxEvent.getClientY(c),f=this.getX(),g=this.getY(),h=mxUtils.bind(this,function(a){var b=mxEvent.getClientX(a)-d,c=mxEvent.getClientY(a)-e;this.setLocation(f+b,g+c);this.fireEvent(new mxEventObject(mxEvent.MOVE,
"event",a));mxEvent.consume(a)}),k=mxUtils.bind(this,function(c){mxEvent.removeListener(document,a,h);mxEvent.removeListener(document,b,k);this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",c));mxEvent.consume(c)});mxEvent.addListener(document,a,h);mxEvent.addListener(document,b,k);this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",c));mxEvent.consume(c)}))};mxWindow.prototype.setLocation=function(a,b){this.div.style.left=a+"px";this.div.style.top=b+"px"};mxWindow.prototype.getX=function(){return parseInt(this.div.style.left)};
mxWindow.prototype.getY=function(){return parseInt(this.div.style.top)};
mxWindow.prototype.installCloseHandler=function(){this.closeImg=document.createElement("img");this.closeImg.setAttribute("src",this.closeImage);this.closeImg.setAttribute("align","right");this.closeImg.setAttribute("title","Close");this.closeImg.style.marginLeft="2px";this.closeImg.style.cursor="pointer";this.closeImg.style.display="none";this.title.insertBefore(this.closeImg,this.title.firstChild);mxEvent.addListener(this.closeImg,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.CLOSE,
"event",a));this.destroyOnClose?this.destroy():this.setVisible(!1);mxEvent.consume(a)}))};mxWindow.prototype.setImage=function(a){this.image=document.createElement("img");this.image.setAttribute("src",a);this.image.setAttribute("align","left");this.image.style.marginRight="4px";this.image.style.marginLeft="0px";this.image.style.marginTop="-2px";this.title.insertBefore(this.image,this.title.firstChild)};mxWindow.prototype.setClosable=function(a){this.closeImg.style.display=a?"":"none"};
mxWindow.prototype.isVisible=function(){return null!=this.div?"hidden"!=this.div.style.visibility:!1};mxWindow.prototype.setVisible=function(a){null!=this.div&&this.isVisible()!=a&&(a?this.show():this.hide())};mxWindow.prototype.show=function(){this.div.style.visibility="";this.activate();var a=mxUtils.getCurrentStyle(this.contentWrapper);if(!mxClient.IS_IE&&("auto"==a.overflow||null!=this.resize))this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-2+"px";this.fireEvent(new mxEventObject(mxEvent.SHOW))};
mxWindow.prototype.hide=function(){this.div.style.visibility="hidden";this.fireEvent(new mxEventObject(mxEvent.HIDE))};mxWindow.prototype.destroy=function(){this.fireEvent(new mxEventObject(mxEvent.DESTROY));null!=this.div&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null);this.contentWrapper=this.content=this.title=null};
function mxForm(a){this.table=document.createElement("table");this.table.className=a;this.body=document.createElement("tbody");this.table.appendChild(this.body)}mxForm.prototype.table=null;mxForm.prototype.body=!1;mxForm.prototype.getTable=function(){return this.table};
mxForm.prototype.addButtons=function(a,b){var c=document.createElement("tr"),d=document.createElement("td");c.appendChild(d);var d=document.createElement("td"),e=document.createElement("button");mxUtils.write(e,mxResources.get("ok")||"OK");d.appendChild(e);mxEvent.addListener(e,"click",function(){a()});e=document.createElement("button");mxUtils.write(e,mxResources.get("cancel")||"Cancel");d.appendChild(e);mxEvent.addListener(e,"click",function(){b()});c.appendChild(d);this.body.appendChild(c)};
mxForm.prototype.addText=function(a,b){var c=document.createElement("input");c.setAttribute("type","text");c.value=b;return this.addField(a,c)};mxForm.prototype.addCheckbox=function(a,b){var c=document.createElement("input");c.setAttribute("type","checkbox");this.addField(a,c);b&&(c.checked=!0);return c};mxForm.prototype.addTextarea=function(a,b,c){var d=document.createElement("textarea");mxClient.IS_NS&&c--;d.setAttribute("rows",c||2);d.value=b;return this.addField(a,d)};
mxForm.prototype.addCombo=function(a,b,c){var d=document.createElement("select");null!=c&&d.setAttribute("size",c);b&&d.setAttribute("multiple","true");return this.addField(a,d)};mxForm.prototype.addOption=function(a,b,c,d){var e=document.createElement("option");mxUtils.writeln(e,b);e.setAttribute("value",c);d&&e.setAttribute("selected",d);a.appendChild(e)};
mxForm.prototype.addField=function(a,b){var c=document.createElement("tr"),d=document.createElement("td");mxUtils.write(d,a);c.appendChild(d);d=document.createElement("td");d.appendChild(b);c.appendChild(d);this.body.appendChild(c);return b};function mxImage(a,b,c){this.src=a;this.width=b;this.height=c}mxImage.prototype.src=null;mxImage.prototype.width=null;mxImage.prototype.height=null;
function mxDivResizer(a,b){if("div"==a.nodeName.toLowerCase()){null==b&&(b=window);this.div=a;var c=mxUtils.getCurrentStyle(a);null!=c&&(this.resizeWidth="auto"==c.width,this.resizeHeight="auto"==c.height);mxEvent.addListener(b,"resize",mxUtils.bind(this,function(){this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)}));this.resize()}}mxDivResizer.prototype.resizeWidth=!0;mxDivResizer.prototype.resizeHeight=!0;mxDivResizer.prototype.handlingResize=!1;
mxDivResizer.prototype.resize=function(){var a=this.getDocumentWidth(),b=this.getDocumentHeight(),c=parseInt(this.div.style.left),d=parseInt(this.div.style.right),e=parseInt(this.div.style.top),f=parseInt(this.div.style.bottom);this.resizeWidth&&!isNaN(c)&&!isNaN(d)&&0<=c&&0<=d&&0<a-d-c&&(this.div.style.width=a-d-c+"px");this.resizeHeight&&!isNaN(e)&&!isNaN(f)&&0<=e&&0<=f&&0<b-e-f&&(this.div.style.height=b-e-f+"px")};mxDivResizer.prototype.getDocumentWidth=function(){return document.body.clientWidth};
mxDivResizer.prototype.getDocumentHeight=function(){return document.body.clientHeight};function mxDragSource(a,b){this.element=a;this.dropHandler=b;mxEvent.addListener(a,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,this.mouseDown))}mxDragSource.prototype.element=null;mxDragSource.prototype.dropHandler=null;mxDragSource.prototype.dragOffset=null;mxDragSource.prototype.dragElement=null;mxDragSource.prototype.previewElement=null;mxDragSource.prototype.enabled=!0;
mxDragSource.prototype.currentGraph=null;mxDragSource.prototype.currentDropTarget=null;mxDragSource.prototype.currentPoint=null;mxDragSource.prototype.currentGuide=null;mxDragSource.prototype.currentHighlight=null;mxDragSource.prototype.autoscroll=!0;mxDragSource.prototype.guidesEnabled=!0;mxDragSource.prototype.gridEnabled=!0;mxDragSource.prototype.highlightDropTargets=!0;mxDragSource.prototype.dragElementZIndex=100;mxDragSource.prototype.dragElementOpacity=70;mxDragSource.prototype.isEnabled=function(){return this.enabled};
mxDragSource.prototype.setEnabled=function(a){this.enabled=a};mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled};mxDragSource.prototype.setGuidesEnabled=function(a){this.guidesEnabled=a};mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled};mxDragSource.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxDragSource.prototype.getGraphForEvent=function(){return null};mxDragSource.prototype.getDropTarget=function(a,b,c){return a.getCellAt(b,c)};
mxDragSource.prototype.createDragElement=function(){return this.element.cloneNode(!0)};mxDragSource.prototype.createPreviewElement=function(){return null};
mxDragSource.prototype.mouseDown=function(a){if(this.enabled&&!mxEvent.isConsumed(a)&&null==this.mouseMoveHandler){this.startDrag(a);var b=mxClient.IS_TOUCH?"touchmove":"mousemove",c=mxClient.IS_TOUCH?"touchend":"mouseup";this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove);mxEvent.addListener(document,b,this.mouseMoveHandler);this.mouseUpHandler=mxUtils.bind(this,this.mouseUp);mxEvent.addListener(document,c,this.mouseUpHandler);mxEvent.consume(a,!0,!1)}};
mxDragSource.prototype.startDrag=function(a){this.dragElement=this.createDragElement(a);this.dragElement.style.position="absolute";this.dragElement.style.zIndex=this.dragElementZIndex;mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)};mxDragSource.prototype.stopDrag=function(){null!=this.dragElement&&(null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)};
mxDragSource.prototype.graphContainsEvent=function(a,b){var c=mxEvent.getClientX(b),d=mxEvent.getClientY(b),e=mxUtils.getOffset(a.container),f=mxUtils.getScrollOrigin();return c>=e.x-f.x&&d>=e.y-f.y&&c<=e.x-f.x+a.container.offsetWidth&&d<=e.y-f.y+a.container.offsetHeight};
mxDragSource.prototype.mouseMove=function(a){var b=this.getGraphForEvent(a);null!=b&&!this.graphContainsEvent(b,a)&&(b=null);b!=this.currentGraph&&(null!=this.currentGraph&&this.dragExit(this.currentGraph),this.currentGraph=b,null!=this.currentGraph&&this.dragEnter(this.currentGraph));null!=this.currentGraph&&this.dragOver(this.currentGraph,a);if(null!=this.dragElement&&(null==this.previewElement||"visible"!=this.previewElement.style.visibility)){var b=mxEvent.getClientX(a),c=mxEvent.getClientY(a);
null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement);this.dragElement.style.visibility="visible";null!=this.dragOffset&&(b+=this.dragOffset.x,c+=this.dragOffset.y);b+=document.body.scrollLeft||document.documentElement.scrollLeft;c+=document.body.scrollTop||document.documentElement.scrollTop;this.dragElement.style.left=b+"px";this.dragElement.style.top=c+"px"}else null!=this.dragElement&&(this.dragElement.style.visibility="hidden");mxEvent.consume(a)};
mxDragSource.prototype.mouseUp=function(a){if(null!=this.currentGraph){if(null!=this.currentPoint&&(null==this.previewElement||"hidden"!=this.previewElement.style.visibility)){var b=this.currentGraph.view.scale,c=this.currentGraph.view.translate;this.drop(this.currentGraph,a,this.currentDropTarget,this.currentPoint.x/b-c.x,this.currentPoint.y/b-c.y)}this.dragExit(this.currentGraph)}this.stopDrag(a);this.currentGraph=null;null!=this.mouseMoveHandler&&(mxEvent.removeListener(document,mxClient.IS_TOUCH?
"touchmove":"mousemove",this.mouseMoveHandler),this.mouseMoveHandler=null);null!=this.mouseUpHandler&&(mxEvent.removeListener(document,mxClient.IS_TOUCH?"touchend":"mouseup",this.mouseUpHandler),this.mouseUpHandler=null);mxEvent.consume(a)};
mxDragSource.prototype.dragEnter=function(a){a.isMouseDown=!0;this.previewElement=this.createPreviewElement(a);this.isGuidesEnabled()&&null!=this.previewElement&&(this.currentGuide=new mxGuide(a,a.graphHandler.getGuideStates()));this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(a,mxConstants.DROP_TARGET_COLOR))};
mxDragSource.prototype.dragExit=function(a){this.currentPoint=this.currentDropTarget=null;a.isMouseDown=!1;null!=this.previewElement&&(null!=this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null);null!=this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null);null!=this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)};
mxDragSource.prototype.dragOver=function(a,b){var c=mxUtils.getOffset(a.container),d=mxUtils.getScrollOrigin(a.container),e=mxEvent.getClientX(b)-c.x+d.x,c=mxEvent.getClientY(b)-c.y+d.y;a.autoScroll&&(null==this.autoscroll||this.autoscroll)&&a.scrollPointToVisible(e,c,a.autoExtend);null!=this.currentHighlight&&a.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(a,e,c),this.currentHighlight.highlight(a.getView().getState(this.currentDropTarget)));if(null!=this.previewElement){null==this.previewElement.parentNode&&
(a.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");var d=this.isGridEnabled()&&a.isGridEnabledEvent(b),f=!0;if(null!=this.currentGuide&&this.currentGuide.isEnabledForEvent(b))var f=parseInt(this.previewElement.style.width),g=parseInt(this.previewElement.style.height),f=new mxRectangle(0,0,f,g),c=new mxPoint(e,c),c=this.currentGuide.move(f,c,d),f=!1,e=c.x,c=c.y;else if(d)var d=a.view.scale,g=a.view.translate,h=a.gridSize/
2,e=(a.snap(e/d-g.x-h)+g.x)*d,c=(a.snap(c/d-g.y-h)+g.y)*d;null!=this.currentGuide&&f&&this.currentGuide.hide();null!=this.previewOffset&&(e+=this.previewOffset.x,c+=this.previewOffset.y);this.previewElement.style.left=Math.round(e)+"px";this.previewElement.style.top=Math.round(c)+"px";this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(e,c)};mxDragSource.prototype.drop=function(a,b,c,d,e){this.dropHandler(a,b,c,d,e);a.container.focus()};
function mxToolbar(a){this.container=a}mxToolbar.prototype=new mxEventSource;mxToolbar.prototype.constructor=mxToolbar;mxToolbar.prototype.container=null;mxToolbar.prototype.enabled=!0;mxToolbar.prototype.noReset=!1;mxToolbar.prototype.updateDefaultMode=!0;
mxToolbar.prototype.addItem=function(a,b,c,d,e,f){var g=document.createElement(null!=b?"img":"button"),h=e||(null!=f?"mxToolbarMode":"mxToolbarItem");g.className=h;g.setAttribute("src",b);null!=a&&(null!=b?g.setAttribute("title",a):mxUtils.write(g,a));this.container.appendChild(g);null!=c&&mxEvent.addListener(g,mxClient.IS_TOUCH?"touchend":"click",c);a=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(g,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(a){null!=d?g.setAttribute("src",
d):g.style.backgroundColor="gray";if(null!=f){null==this.menu&&(this.menu=new mxPopupMenu,this.menu.init());var b=this.currentImg;this.menu.isMenuShowing()&&this.menu.hideMenu();b!=g&&(this.currentImg=g,this.menu.factoryMethod=f,b=new mxPoint(g.offsetLeft,g.offsetTop+g.offsetHeight),this.menu.popup(b.x,b.y,null,a),this.menu.isMenuShowing()&&(g.className=h+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this);g.className=h;this.currentImg=null}))}}));c=mxUtils.bind(this,
function(){null!=d?g.setAttribute("src",b):g.style.backgroundColor=""});mxEvent.addListener(g,a,c);mxEvent.addListener(g,"mouseout",c);return g};mxToolbar.prototype.addCombo=function(a){var b=document.createElement("div");b.style.display="inline";b.className="mxToolbarComboContainer";var c=document.createElement("select");c.className=a||"mxToolbarCombo";b.appendChild(c);this.container.appendChild(b);return c};
mxToolbar.prototype.addActionCombo=function(a,b){var c=document.createElement("select");c.className=b||"mxToolbarCombo";this.addOption(c,a,null);mxEvent.addListener(c,"change",function(a){var b=c.options[c.selectedIndex];c.selectedIndex=0;null!=b.funct&&b.funct(a)});this.container.appendChild(c);return c};mxToolbar.prototype.addOption=function(a,b,c){var d=document.createElement("option");mxUtils.writeln(d,b);"function"==typeof c?d.funct=c:d.setAttribute("value",c);a.appendChild(d);return d};
mxToolbar.prototype.addSwitchMode=function(a,b,c,d,e){var f=document.createElement("img");f.initialClassName=e||"mxToolbarMode";f.className=f.initialClassName;f.setAttribute("src",b);f.altIcon=d;null!=a&&f.setAttribute("title",a);mxEvent.addListener(f,"click",mxUtils.bind(this,function(){var a=this.selectedMode.altIcon;null!=a?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",a)):this.selectedMode.className=this.selectedMode.initialClassName;this.updateDefaultMode&&
(this.defaultMode=f);this.selectedMode=f;a=f.altIcon;null!=a?(f.altIcon=f.getAttribute("src"),f.setAttribute("src",a)):f.className=f.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT));c()}));this.container.appendChild(f);null==this.defaultMode&&(this.defaultMode=f,this.selectMode(f),c());return f};
mxToolbar.prototype.addMode=function(a,b,c,d,e,f){var f=null!=f?f:!0,g=document.createElement(null!=b?"img":"button");g.initialClassName=e||"mxToolbarMode";g.className=g.initialClassName;g.setAttribute("src",b);g.altIcon=d;null!=a&&g.setAttribute("title",a);this.enabled&&f&&(mxEvent.addListener(g,"click",mxUtils.bind(this,function(){this.selectMode(g,c);this.noReset=!1})),mxEvent.addListener(g,"dblclick",mxUtils.bind(this,function(){this.selectMode(g,c);this.noReset=!0})),null==this.defaultMode&&
(this.defaultMode=g,this.defaultFunction=c,this.selectMode(g,c)));this.container.appendChild(g);return g};
mxToolbar.prototype.selectMode=function(a,b){if(this.selectedMode!=a){if(null!=this.selectedMode){var c=this.selectedMode.altIcon;null!=c?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",c)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=a;c=this.selectedMode.altIcon;null!=c?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",c)):this.selectedMode.className=this.selectedMode.initialClassName+
"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",b))}};mxToolbar.prototype.resetMode=function(a){(a||!this.noReset)&&this.selectedMode!=this.defaultMode&&this.selectMode(this.defaultMode,this.defaultFunction)};mxToolbar.prototype.addSeparator=function(a){return this.addItem(null,a,null)};mxToolbar.prototype.addBreak=function(){mxUtils.br(this.container)};
mxToolbar.prototype.addLine=function(){var a=document.createElement("hr");a.style.marginRight="6px";a.setAttribute("size","1");this.container.appendChild(a)};mxToolbar.prototype.destroy=function(){mxEvent.release(this.container);this.selectedMode=this.defaultFunction=this.defaultMode=this.container=null;null!=this.menu&&this.menu.destroy()};
function mxSession(a,b,c,d){this.model=a;this.urlInit=b;this.urlPoll=c;this.urlNotify=d;null!=a&&(this.codec=new mxCodec,this.codec.lookup=function(b){return a.getCell(b)});a.addListener(mxEvent.NOTIFY,mxUtils.bind(this,function(a,b){var c=b.getProperty("edit");(null!=c&&this.debug||this.connected&&!this.suspended)&&this.notify("<edit>"+this.encodeChanges(c.changes,c.undone)+"</edit>")}))}mxSession.prototype=new mxEventSource;mxSession.prototype.constructor=mxSession;mxSession.prototype.model=null;
mxSession.prototype.urlInit=null;mxSession.prototype.urlPoll=null;mxSession.prototype.urlNotify=null;mxSession.prototype.codec=null;mxSession.prototype.linefeed="&#xa;";mxSession.prototype.escapePostData=!0;mxSession.prototype.significantRemoteChanges=!0;mxSession.prototype.sent=0;mxSession.prototype.received=0;mxSession.prototype.debug=!1;mxSession.prototype.connected=!1;mxSession.prototype.suspended=!1;mxSession.prototype.polling=!1;
mxSession.prototype.start=function(){this.debug?(this.connected=!0,this.fireEvent(new mxEventObject(mxEvent.CONNECT))):this.connected||this.get(this.urlInit,mxUtils.bind(this,function(){this.connected=!0;this.fireEvent(new mxEventObject(mxEvent.CONNECT));this.poll()}))};mxSession.prototype.suspend=function(){this.connected&&!this.suspended&&(this.suspended=!0,this.fireEvent(new mxEventObject(mxEvent.SUSPEND)))};
mxSession.prototype.resume=function(){this.connected&&this.suspended&&(this.suspended=!1,this.fireEvent(new mxEventObject(mxEvent.RESUME)),this.polling||this.poll())};mxSession.prototype.stop=function(a){this.connected&&(this.connected=!1);this.fireEvent(new mxEventObject(mxEvent.DISCONNECT,"reason",a))};mxSession.prototype.poll=function(){this.connected&&!this.suspended&&null!=this.urlPoll?(this.polling=!0,this.get(this.urlPoll,mxUtils.bind(this,function(){this.poll()}))):this.polling=!1};
mxSession.prototype.notify=function(a,b,c){null!=a&&0<a.length&&(null!=this.urlNotify&&(this.debug?(mxLog.show(),mxLog.debug("mxSession.notify: "+this.urlNotify+" xml="+a)):(a="<message><delta>"+a+"</delta></message>",this.escapePostData&&(a=encodeURIComponent(a)),mxUtils.post(this.urlNotify,"xml="+a,b,c))),this.sent+=a.length,this.fireEvent(new mxEventObject(mxEvent.NOTIFY,"url",this.urlNotify,"xml",a)))};
mxSession.prototype.get=function(a,b,c){if("undefined"!=typeof mxUtils){var d=mxUtils.bind(this,function(a){null!=c?c(a):this.stop(a)});mxUtils.get(a,mxUtils.bind(this,function(c){if("undefined"!=typeof mxUtils)if(c.isReady()&&404!=c.getStatus()){if(this.received+=c.getText().length,this.fireEvent(new mxEventObject(mxEvent.GET,"url",a,"request",c)),this.isValidResponse(c)){if(0<c.getText().length){var f=c.getDocumentElement();null==f?d("Invalid response: "+c.getText()):this.receive(f)}null!=b&&b(c)}}else d("Response not ready")}),
function(){d("Transmission error")})}};mxSession.prototype.isValidResponse=function(a){return 0>a.getText().indexOf("<?php")};mxSession.prototype.encodeChanges=function(a,b){for(var c="",d=b?-1:1,e=b?a.length-1:0;0<=e&&e<a.length;e+=d)var f=this.codec.encode(a[e]),c=c+mxUtils.getXml(f,this.linefeed);return c};
mxSession.prototype.receive=function(a){if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){var b=a.getAttribute("namespace");null!=b&&(this.model.prefix=b+"-");for(b=a.firstChild;null!=b;){var c=b.nodeName.toLowerCase();"state"==c?this.processState(b):"delta"==c&&this.processDelta(b);b=b.nextSibling}this.fireEvent(new mxEventObject(mxEvent.RECEIVE,"node",a))}};mxSession.prototype.processState=function(a){(new mxCodec(a.ownerDocument)).decode(a.firstChild,this.model)};
mxSession.prototype.processDelta=function(a){for(a=a.firstChild;null!=a;)"edit"==a.nodeName&&this.processEdit(a),a=a.nextSibling};mxSession.prototype.processEdit=function(a){a=this.decodeChanges(a);if(0<a.length){var b=this.createUndoableEdit(a);this.model.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",b,"changes",a));this.model.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",b));this.fireEvent(new mxEventObject(mxEvent.FIRED,"edit",b))}};
mxSession.prototype.createUndoableEdit=function(a){var b=new mxUndoableEdit(this.model,this.significantRemoteChanges);b.changes=a;b.notify=function(){b.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",b,"changes",b.changes));b.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",b,"changes",b.changes))};return b};mxSession.prototype.decodeChanges=function(a){this.codec.document=a.ownerDocument;for(var b=[],a=a.firstChild;null!=a;){var c=this.decodeChange(a);null!=c&&b.push(c);a=a.nextSibling}return b};
mxSession.prototype.decodeChange=function(a){var b=null;a.nodeType==mxConstants.NODETYPE_ELEMENT&&(b="mxRootChange"==a.nodeName?(new mxCodec(a.ownerDocument)).decode(a):this.codec.decode(a),null!=b&&(b.model=this.model,b.execute(),"mxChildChange"==a.nodeName&&null==b.parent&&this.cellRemoved(b.child)));return b};mxSession.prototype.cellRemoved=function(a){this.codec.putObject(a.getId(),a);for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.cellRemoved(this.model.getChildAt(a,c))};
function mxUndoableEdit(a,b){this.source=a;this.changes=[];this.significant=null!=b?b:!0}mxUndoableEdit.prototype.source=null;mxUndoableEdit.prototype.changes=null;mxUndoableEdit.prototype.significant=null;mxUndoableEdit.prototype.undone=!1;mxUndoableEdit.prototype.redone=!1;mxUndoableEdit.prototype.isEmpty=function(){return 0==this.changes.length};mxUndoableEdit.prototype.isSignificant=function(){return this.significant};mxUndoableEdit.prototype.add=function(a){this.changes.push(a)};
mxUndoableEdit.prototype.notify=function(){};mxUndoableEdit.prototype.die=function(){};mxUndoableEdit.prototype.undo=function(){if(!this.undone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var a=this.changes.length-1;0<=a;a--){var b=this.changes[a];null!=b.execute?b.execute():null!=b.undo&&b.undo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",b))}this.undone=!0;this.redone=!1;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};
mxUndoableEdit.prototype.redo=function(){if(!this.redone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var a=this.changes.length,b=0;b<a;b++){var c=this.changes[b];null!=c.execute?c.execute():null!=c.redo&&c.redo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",c))}this.undone=!1;this.redone=!0;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};function mxUndoManager(a){this.size=null!=a?a:100;this.clear()}mxUndoManager.prototype=new mxEventSource;
mxUndoManager.prototype.constructor=mxUndoManager;mxUndoManager.prototype.size=null;mxUndoManager.prototype.history=null;mxUndoManager.prototype.indexOfNextAdd=0;mxUndoManager.prototype.isEmpty=function(){return 0==this.history.length};mxUndoManager.prototype.clear=function(){this.history=[];this.indexOfNextAdd=0;this.fireEvent(new mxEventObject(mxEvent.CLEAR))};mxUndoManager.prototype.canUndo=function(){return 0<this.indexOfNextAdd};
mxUndoManager.prototype.undo=function(){for(;0<this.indexOfNextAdd;){var a=this.history[--this.indexOfNextAdd];a.undo();if(a.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",a));break}}};mxUndoManager.prototype.canRedo=function(){return this.indexOfNextAdd<this.history.length};
mxUndoManager.prototype.redo=function(){for(var a=this.history.length;this.indexOfNextAdd<a;){var b=this.history[this.indexOfNextAdd++];b.redo();if(b.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",b));break}}};mxUndoManager.prototype.undoableEditHappened=function(a){this.trim();0<this.size&&this.size==this.history.length&&this.history.shift();this.history.push(a);this.indexOfNextAdd=this.history.length;this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",a))};
mxUndoManager.prototype.trim=function(){if(this.history.length>this.indexOfNextAdd)for(var a=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),b=0;b<a.length;b++)a[b].die()};
var mxUrlConverter=function(){var a=!0,b=null,c=null;return{isEnabled:function(){return a},setEnabled:function(b){a=b},getBaseUrl:function(){return b},setBaseUrl:function(a){b=a},getBaseDomain:function(){return b},setBaseDomain:function(a){b=a},convert:function(d){if(a&&0!=d.indexOf("http://")&&0!=d.indexOf("https://")&&0!=d.indexOf("data:image")){if(null==b){c=location.protocol+"//"+location.host;b=c+location.pathname;var e=b.lastIndexOf("/");0<e&&(b=b.substring(0,e+1))}d="/"==d.charAt(0)?c+d:b+
d}return d}}};
function mxPanningManager(a){this.thread=null;this.active=!1;this.dy=this.dx=this.t0y=this.t0x=this.tdy=this.tdx=0;this.scrollbars=!1;this.scrollTop=this.scrollLeft=0;this.mouseListener={mouseDown:function(){},mouseMove:function(){},mouseUp:mxUtils.bind(this,function(){this.active&&this.stop()})};a.addMouseListener(this.mouseListener);mxEvent.addListener(document,"mouseup",mxUtils.bind(this,function(){this.active&&this.stop()}));var b=mxUtils.bind(this,function(){this.scrollbars=mxUtils.hasScrollbars(a.container);this.scrollLeft=
a.container.scrollLeft;this.scrollTop=a.container.scrollTop;return window.setInterval(mxUtils.bind(this,function(){this.tdx-=this.dx;this.tdy-=this.dy;if(this.scrollbars){var b=-a.container.scrollLeft-Math.ceil(this.dx),d=-a.container.scrollTop-Math.ceil(this.dy);a.panGraph(b,d);a.panDx=this.scrollLeft-a.container.scrollLeft;a.panDy=this.scrollTop-a.container.scrollTop;a.fireEvent(new mxEventObject(mxEvent.PAN))}else a.panGraph(this.getDx(),this.getDy())}),this.delay)});this.isActive=function(){return active};
this.getDx=function(){return Math.round(this.tdx)};this.getDy=function(){return Math.round(this.tdy)};this.start=function(){this.t0x=a.view.translate.x;this.t0y=a.view.translate.y;this.active=!0};this.panTo=function(c,d,e,f){this.active||this.start();this.scrollLeft=a.container.scrollLeft;this.scrollTop=a.container.scrollTop;var f=null!=f?f:0,g=a.container;this.dx=c+(null!=e?e:0)-g.scrollLeft-g.clientWidth;this.dx=0>this.dx&&Math.abs(this.dx)<this.border?this.border+this.dx:this.handleMouseOut?Math.max(this.dx,
0):0;0==this.dx&&(this.dx=c-g.scrollLeft,this.dx=0<this.dx&&this.dx<this.border?this.dx-this.border:this.handleMouseOut?Math.min(0,this.dx):0);this.dy=d+f-g.scrollTop-g.clientHeight;this.dy=0>this.dy&&Math.abs(this.dy)<this.border?this.border+this.dy:this.handleMouseOut?Math.max(this.dy,0):0;0==this.dy&&(this.dy=d-g.scrollTop,this.dy=0<this.dy&&this.dy<this.border?this.dy-this.border:this.handleMouseOut?Math.min(0,this.dy):0);0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==
this.thread&&(this.thread=b())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)};this.stop=function(){if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdy=this.tdx=0,this.scrollbars)a.panDx=0,a.panDy=0,a.fireEvent(new mxEventObject(mxEvent.PAN));else{var b=a.panDx,d=a.panDy;if(0!=b||0!=d)a.panGraph(0,0),a.view.setTranslate(this.t0x+b/a.view.scale,this.t0y+d/a.view.scale)}};this.destroy=function(){a.removeMouseListener(this.mouseListener)}}
mxPanningManager.prototype.damper=1/6;mxPanningManager.prototype.delay=10;mxPanningManager.prototype.handleMouseOut=!0;mxPanningManager.prototype.border=0;function mxPath(a){this.format=a;this.path=[];this.translate=new mxPoint(0,0)}mxPath.prototype.format=null;mxPath.prototype.translate=null;mxPath.prototype.scale=1;mxPath.prototype.path=null;mxPath.prototype.isVml=function(){return"vml"==this.format};mxPath.prototype.getPath=function(){return this.path.join("")};
mxPath.prototype.setTranslate=function(a,b){this.translate=new mxPoint(a,b)};mxPath.prototype.moveTo=function(a,b){a+=this.translate.x;b+=this.translate.y;a*=this.scale;b*=this.scale;this.isVml()?this.path.push("m ",Math.round(a)," ",Math.round(b)," "):this.path.push("M ",a," ",b," ")};mxPath.prototype.lineTo=function(a,b){a+=this.translate.x;b+=this.translate.y;a*=this.scale;b*=this.scale;this.isVml()?this.path.push("l ",Math.round(a)," ",Math.round(b)," "):this.path.push("L ",a," ",b," ")};
mxPath.prototype.quadTo=function(a,b,c,d){a+=this.translate.x;b+=this.translate.y;a*=this.scale;b*=this.scale;c+=this.translate.x;d+=this.translate.y;c*=this.scale;d*=this.scale;this.isVml()?this.path.push("c ",Math.round(a)," ",Math.round(b)," ",Math.round(c)," ",Math.round(d)," ",Math.round(c)," ",Math.round(d)," "):this.path.push("Q ",a," ",b," ",c," ",d," ")};
mxPath.prototype.curveTo=function(a,b,c,d,e,f){a+=this.translate.x;b+=this.translate.y;a*=this.scale;b*=this.scale;c+=this.translate.x;d+=this.translate.y;c*=this.scale;d*=this.scale;e+=this.translate.x;f+=this.translate.y;e*=this.scale;f*=this.scale;this.isVml()?this.path.push("c ",Math.round(a)," ",Math.round(b)," ",Math.round(c)," ",Math.round(d)," ",Math.round(e)," ",Math.round(f)," "):this.path.push("C ",a," ",b," ",c," ",d," ",e," ",f," ")};
mxPath.prototype.ellipse=function(a,b,c,d){a+=this.translate.x;b+=this.translate.y;a*=this.scale;b*=this.scale;if(this.isVml())this.path.push("at ",Math.round(a)," ",Math.round(b)," ",Math.round(a+c)," ",Math.round(b+d)," ",Math.round(a)," ",Math.round(b+d/2)," ",Math.round(a)," ",Math.round(b+d/2));else{var e=a,f=b+d/2,a=a+c,b=b+d/2,c=c/2,d=d/2;this.path.push("M ",e," ",f," ");this.path.push("A ",c," ",d," 0 1 0 ",a," ",b," ");this.path.push("A ",c," ",d," 0 1 0 ",e," ",f)}};
mxPath.prototype.addPath=function(a){this.path=this.path.concat(a.path)};mxPath.prototype.write=function(a){this.path.push(a," ")};mxPath.prototype.end=function(){"vml"==this.format&&this.path.push("e")};mxPath.prototype.close=function(){"vml"==this.format?this.path.push("x e"):this.path.push("Z")};function mxPopupMenu(a){this.factoryMethod=a;null!=a&&this.init()}mxPopupMenu.prototype=new mxEventSource;mxPopupMenu.prototype.constructor=mxPopupMenu;
mxPopupMenu.prototype.submenuImage=mxClient.imageBasePath+"/submenu.gif";mxPopupMenu.prototype.zIndex=10006;mxPopupMenu.prototype.factoryMethod=null;mxPopupMenu.prototype.useLeftButtonForPopup=!1;mxPopupMenu.prototype.enabled=!0;mxPopupMenu.prototype.itemCount=0;mxPopupMenu.prototype.autoExpand=!1;mxPopupMenu.prototype.smartSeparators=!1;mxPopupMenu.prototype.labels=!0;
mxPopupMenu.prototype.init=function(){this.table=document.createElement("table");this.table.className="mxPopupMenu";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.div=document.createElement("div");this.div.className="mxPopupMenu";this.div.style.display="inline";this.div.style.zIndex=this.zIndex;this.div.appendChild(this.table);mxEvent.disableContextMenu(this.div)};mxPopupMenu.prototype.isEnabled=function(){return this.enabled};
mxPopupMenu.prototype.setEnabled=function(a){this.enabled=a};mxPopupMenu.prototype.isPopupTrigger=function(a){return a.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(a.getEvent())};
mxPopupMenu.prototype.addItem=function(a,b,c,d,e,f){d=d||this;this.itemCount++;d.willAddSeparator&&(d.containsItems&&this.addSeparator(d,!0),d.willAddSeparator=!1);d.containsItems=!0;var g=document.createElement("tr");g.className="mxPopupMenuItem";var h=document.createElement("td");h.className="mxPopupMenuIcon";null!=b?(e=document.createElement("img"),e.src=b,h.appendChild(e)):null!=e&&(b=document.createElement("div"),b.className=e,h.appendChild(b));g.appendChild(h);this.labels&&(h=document.createElement("td"),
h.className="mxPopupMenuItem"+(null!=f&&!f?" disabled":""),mxUtils.write(h,a),h.align="left",g.appendChild(h),a=document.createElement("td"),a.className="mxPopupMenuItem"+(null!=f&&!f?" disabled":""),a.style.paddingRight="6px",a.style.textAlign="right",g.appendChild(a),null==d.div&&this.createSubmenu(d));d.tbody.appendChild(g);if(null==f||f)f=mxClient.IS_TOUCH?"touchmove":"mousemove",a=mxClient.IS_TOUCH?"touchend":"mouseup",mxEvent.addListener(g,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,
function(a){this.eventReceiver=g;d.activeRow!=g&&d.activeRow!=d&&(null!=d.activeRow&&null!=d.activeRow.div.parentNode&&this.hideSubmenu(d),null!=g.div&&(this.showSubmenu(d,g),d.activeRow=g));mxEvent.consume(a)})),mxEvent.addListener(g,f,mxUtils.bind(this,function(){d.activeRow!=g&&d.activeRow!=d&&(null!=d.activeRow&&null!=d.activeRow.div.parentNode&&this.hideSubmenu(d),this.autoExpand&&null!=g.div&&(this.showSubmenu(d,g),d.activeRow=g));g.className="mxPopupMenuItemHover"})),mxEvent.addListener(g,
a,mxUtils.bind(this,function(a){this.eventReceiver==g&&(d.activeRow!=g&&this.hideMenu(),null!=c&&c(a));this.eventReceiver=null;mxEvent.consume(a)})),mxEvent.addListener(g,"mouseout",mxUtils.bind(this,function(){g.className="mxPopupMenuItem"}));return g};
mxPopupMenu.prototype.createSubmenu=function(a){a.table=document.createElement("table");a.table.className="mxPopupMenu";a.tbody=document.createElement("tbody");a.table.appendChild(a.tbody);a.div=document.createElement("div");a.div.className="mxPopupMenu";a.div.style.position="absolute";a.div.style.display="inline";a.div.style.zIndex=this.zIndex;a.div.appendChild(a.table);var b=document.createElement("img");b.setAttribute("src",this.submenuImage);td=a.firstChild.nextSibling.nextSibling;td.appendChild(b)};
mxPopupMenu.prototype.showSubmenu=function(a,b){if(null!=b.div){b.div.style.left=a.div.offsetLeft+b.offsetLeft+b.offsetWidth-1+"px";b.div.style.top=a.div.offsetTop+b.offsetTop+"px";document.body.appendChild(b.div);var c=parseInt(b.div.offsetLeft),d=parseInt(b.div.offsetWidth),e=document.body,f=document.documentElement;if(c+d>(e.scrollLeft||f.scrollLeft)+(e.clientWidth||f.clientWidth))b.div.style.left=a.div.offsetLeft-d+(mxClient.IS_IE?6:-6)+"px";mxUtils.fit(b.div)}};
mxPopupMenu.prototype.addSeparator=function(a,b){a=a||this;if(this.smartSeparators&&!b)a.willAddSeparator=!0;else if(null!=a.tbody){a.willAddSeparator=!1;var c=document.createElement("tr"),d=document.createElement("td");d.className="mxPopupMenuIcon";d.style.padding="0 0 0 0px";c.appendChild(d);d=document.createElement("td");d.style.padding="0 0 0 0px";d.setAttribute("colSpan","2");var e=document.createElement("hr");e.setAttribute("size","1");d.appendChild(e);c.appendChild(d);a.tbody.appendChild(c)}};
mxPopupMenu.prototype.popup=function(a,b,c,d){if(null!=this.div&&null!=this.tbody&&null!=this.factoryMethod){this.div.style.left=a+"px";for(this.div.style.top=b+"px";null!=this.tbody.firstChild;)mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0;this.factoryMethod(this,c,d);0<this.itemCount&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}};
mxPopupMenu.prototype.isMenuShowing=function(){return null!=this.div&&this.div.parentNode==document.body};mxPopupMenu.prototype.showMenu=function(){9<=document.documentMode&&(this.div.style.filter="none");document.body.appendChild(this.div);mxUtils.fit(this.div)};mxPopupMenu.prototype.hideMenu=function(){null!=this.div&&(null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1)};
mxPopupMenu.prototype.hideSubmenu=function(a){null!=a.activeRow&&(this.hideSubmenu(a.activeRow),null!=a.activeRow.div.parentNode&&a.activeRow.div.parentNode.removeChild(a.activeRow.div),a.activeRow=null)};mxPopupMenu.prototype.destroy=function(){null!=this.div&&(mxEvent.release(this.div),null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null)};
function mxAutoSaveManager(a){this.changeHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.graphModelChanged(c.getProperty("edit").changes)});this.setGraph(a)}mxAutoSaveManager.prototype=new mxEventSource;mxAutoSaveManager.prototype.constructor=mxAutoSaveManager;mxAutoSaveManager.prototype.graph=null;mxAutoSaveManager.prototype.autoSaveDelay=10;mxAutoSaveManager.prototype.autoSaveThrottle=2;mxAutoSaveManager.prototype.autoSaveThreshold=5;mxAutoSaveManager.prototype.ignoredChanges=0;
mxAutoSaveManager.prototype.lastSnapshot=0;mxAutoSaveManager.prototype.enabled=!0;mxAutoSaveManager.prototype.changeHandler=null;mxAutoSaveManager.prototype.isEnabled=function(){return this.enabled};mxAutoSaveManager.prototype.setEnabled=function(a){this.enabled=a};mxAutoSaveManager.prototype.setGraph=function(a){null!=this.graph&&this.graph.getModel().removeListener(this.changeHandler);this.graph=a;null!=this.graph&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)};
mxAutoSaveManager.prototype.save=function(){};mxAutoSaveManager.prototype.graphModelChanged=function(){var a=((new Date).getTime()-this.lastSnapshot)/1E3;a>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&a>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++};mxAutoSaveManager.prototype.reset=function(){this.lastSnapshot=(new Date).getTime();this.ignoredChanges=0};mxAutoSaveManager.prototype.destroy=function(){this.setGraph(null)};
function mxAnimation(a){this.delay=null!=a?a:20}mxAnimation.prototype=new mxEventSource;mxAnimation.prototype.constructor=mxAnimation;mxAnimation.prototype.delay=null;mxAnimation.prototype.thread=null;mxAnimation.prototype.startAnimation=function(){null==this.thread&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))};mxAnimation.prototype.updateAnimation=function(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))};
mxAnimation.prototype.stopAnimation=function(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))};function mxMorphing(a,b,c,d){mxAnimation.call(this,d);this.graph=a;this.steps=null!=b?b:6;this.ease=null!=c?c:1.5}mxMorphing.prototype=new mxAnimation;mxMorphing.prototype.constructor=mxMorphing;mxMorphing.prototype.graph=null;mxMorphing.prototype.steps=null;mxMorphing.prototype.step=0;mxMorphing.prototype.ease=null;
mxMorphing.prototype.cells=null;mxMorphing.prototype.updateAnimation=function(){var a=new mxCellStatePreview(this.graph);if(null!=this.cells)for(var b=0;b<this.cells.length;b++)this.animateCell(cells[b],a,!1);else this.animateCell(this.graph.getModel().getRoot(),a,!0);this.show(a);(a.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()};mxMorphing.prototype.show=function(a){a.show()};
mxMorphing.prototype.animateCell=function(a,b,c){var d=this.graph.getView().getState(a),e=null;if(null!=d&&(e=this.getDelta(d),this.graph.getModel().isVertex(a)&&(0!=e.x||0!=e.y))){var f=this.graph.view.getTranslate(),g=this.graph.view.getScale();e.x+=f.x*g;e.y+=f.y*g;b.moveState(d,-e.x/this.ease,-e.y/this.ease)}if(c&&!this.stopRecursion(d,e)){d=this.graph.getModel().getChildCount(a);for(e=0;e<d;e++)this.animateCell(this.graph.getModel().getChildAt(a,e),b,c)}};
mxMorphing.prototype.stopRecursion=function(a,b){return null!=b&&(0!=b.x||0!=b.y)};mxMorphing.prototype.getDelta=function(a){var b=this.getOriginForCell(a.cell),c=this.graph.getView().getTranslate(),d=this.graph.getView().getScale(),a=new mxPoint(a.x/d-c.x,a.y/d-c.y);return new mxPoint((b.x-a.x)*d,(b.y-a.y)*d)};
mxMorphing.prototype.getOriginForCell=function(a){var b=null;null!=a&&(b=this.getOriginForCell(this.graph.getModel().getParent(a)),a=this.graph.getCellGeometry(a),null!=a&&(b.x+=a.x,b.y+=a.y));null==b&&(b=this.graph.view.getTranslate(),b=new mxPoint(-b.x,-b.y));return b};function mxImageBundle(a){this.images=[];this.alt=null!=a?a:!1}mxImageBundle.prototype.images=null;mxImageBundle.prototype.images=null;mxImageBundle.prototype.putImage=function(a,b,c){this.images[a]={value:b,fallback:c}};
mxImageBundle.prototype.getImage=function(a){var b=null;null!=a&&(a=this.images[a],null!=a&&(b=this.alt?a.fallback:a.value));return b};function mxImageExport(){this.initShapes();this.initMarkers()}mxImageExport.prototype.includeOverlays=!1;mxImageExport.prototype.glassSize=0.4;mxImageExport.prototype.shapes=null;mxImageExport.prototype.markers=null;
mxImageExport.prototype.drawState=function(a,b){if(null!=a){if(null!=a.shape){var c=null!=a.shape.stencil?a.shape.stencil:this.shapes[a.style[mxConstants.STYLE_SHAPE]];null==c&&("function"==typeof a.shape.redrawPath?c=this.createShape(a,b):a.view.graph.getModel().isVertex(a.cell)&&(c=this.shapes.rectangle));null!=c&&(this.drawShape(a,b,c),this.includeOverlays&&this.drawOverlays(a,b))}for(var c=a.view.graph,d=c.model.getChildCount(a.cell),e=0;e<d;e++)this.drawState(c.view.getState(c.model.getChildAt(a.cell,
e)),b)}};
mxImageExport.prototype.createShape=function(){return{drawShape:function(a,b,c,d){var e={translate:new mxPoint(c.x,c.y),moveTo:function(b,c){a.moveTo(this.translate.x+b,this.translate.y+c)},lineTo:function(b,c){a.lineTo(this.translate.x+b,this.translate.y+c)},quadTo:function(b,c,d,e){a.quadTo(this.translate.x+b,this.translate.y+c,this.translate.x+d,this.translate.y+e)},curveTo:function(b,c,d,e,l,n){a.curveTo(this.translate.x+b,this.translate.y+c,this.translate.x+d,this.translate.y+e,this.translate.x+l,
this.translate.y+n)},end:function(){},close:function(){a.close()}};d||a.fillAndStroke();a.begin();b.shape.redrawPath.call(b.shape,e,c.x,c.y,c.width,c.height,!d);d||a.fillAndStroke();return!0}}};mxImageExport.prototype.drawOverlays=function(a,b){null!=a.overlays&&a.overlays.visit(function(a,d){var e=d.bounds;null!=e&&b.image(e.x,e.y,e.width,e.height,d.image)})};
mxImageExport.prototype.drawShape=function(a,b,c){var d=mxUtils.getNumber(a.style,mxConstants.STYLE_ROTATION,0),e=mxUtils.getValue(a.style,mxConstants.STYLE_DIRECTION,null),f=a.style[mxConstants.STYLE_STENCIL_FLIPH],g=a.style[mxConstants.STYLE_STENCIL_FLIPV];if(f?!g:g)d*=-1;null!=e&&("north"==e?d+=270:"west"==e?d+=180:"south"==e&&(d+=90));f&&g&&(d+=180,g=f=!1);b.save();d%=360;(0!=d||f||g)&&b.rotate(d,f,g,a.getCenterX(),a.getCenterY());var h=a.view.scale,k=mxUtils.getNumber(a.style,mxConstants.STYLE_STROKEWIDTH,
1)*h;b.setStrokeWidth(k);var l=k/2,h=this.getBackgroundBounds(a);if(null==a.shape.stencil&&("south"==e||"north"==e)){var n=(h.width-h.height)/2;h.x+=n;h.y+=-n;n=h.width;h.width=h.height;h.height=n}var n=new mxRectangle(h.x-l,h.y-l,h.width+k,h.height+k),o=mxUtils.getValue(a.style,mxConstants.STYLE_OPACITY,100)/100,k=a.style[mxConstants.STYLE_SHAPE],p=(l=k==mxConstants.SHAPE_IMAGE)?null:mxUtils.getValue(a.style,mxConstants.STYLE_GRADIENTCOLOR);p==mxConstants.NONE&&(p=null);var r=mxUtils.getValue(a.style,
l?mxConstants.STYLE_IMAGE_BACKGROUND:mxConstants.STYLE_FILLCOLOR,null);r==mxConstants.NONE&&(r=null);var s=mxUtils.getValue(a.style,l?mxConstants.STYLE_IMAGE_BORDER:mxConstants.STYLE_STROKECOLOR,null);s==mxConstants.NONE&&(s=null);var u=null!=r&&(k==mxConstants.SHAPE_LABEL||k==mxConstants.SHAPE_RECTANGLE);mxUtils.getValue(a.style,mxConstants.STYLE_SHADOW,!1)&&this.drawShadow(b,a,c,d,f,g,h,o,null!=r);b.setAlpha(o);"1"==mxUtils.getValue(a.style,mxConstants.STYLE_DASHED,"0")&&(b.setDashed(!0),d=a.style.dashPattern,
null!=d&&b.setDashPattern(d));if(null!=s||null!=r)null!=s&&b.setStrokeColor(s),null!=r&&(null!=p&&"transparent"!=p?b.setGradient(r,p,h.x,h.y,h.width,h.height,e):b.setFillColor(r)),u=c.drawShape(b,a,h,!0,!1)&&u,c.drawShape(b,a,h,!1,!1);u&&1==mxUtils.getValue(a.style,mxConstants.STYLE_GLASS,0)&&this.drawGlass(a,b,n,c,this.glassSize);if(l||k==mxConstants.SHAPE_LABEL)c=a.view.graph.getImage(a),null!=c&&(e=this.getImageBounds(a),null!=e&&this.drawImage(a,b,e,c));b.restore();f=a.text;c=a.view.graph.getLabel(a.cell);
null!=f&&null!=c&&0<c.length&&(b.save(),b.setAlpha(mxUtils.getValue(a.style,mxConstants.STYLE_TEXT_OPACITY,100)/100),e=new mxRectangle(f.boundingBox.x,f.boundingBox.y,f.boundingBox.width,f.boundingBox.height),d=0==mxUtils.getValue(a.style,mxConstants.STYLE_HORIZONTAL,1),e.y+=2,d&&(f.dialect!=mxConstants.DIALECT_SVG?(g=e.x+e.width/2,f=e.y+e.height/2,n=e.width,e.width=e.height,e.height=n,e.x=g-e.width/2,e.y=f-e.height/2):f.dialect==mxConstants.DIALECT_SVG&&(h=a.y+a.height,g=e.getCenterX()-a.x,f=e.getCenterY()-
a.y,g=h-g-e.height/2,e.x=a.x+f-e.width/2,e.y=g)),this.drawLabelBackground(a,b,e,d),this.drawLabel(a,b,e,d,c),b.restore())};
mxImageExport.prototype.drawShadow=function(a,b,c,d,e,f,g,h,k){var l=d*Math.PI/180,d=Math.cos(-l),l=Math.sin(-l),d=mxUtils.getRotatedPoint(new mxPoint(mxConstants.SHADOW_OFFSET_X,mxConstants.SHADOW_OFFSET_Y),d,l);e&&(d.x*=-1);f&&(d.y*=-1);a.translate(d.x,d.y);c.drawShape(a,b,g,!0,!0)&&(a.setAlpha(mxConstants.SHADOW_OPACITY*h),a.shadow(mxConstants.SHADOWCOLOR,k));a.translate(-d.x,-d.y)};
mxImageExport.prototype.drawGlass=function(a,b,c,d,e){d.drawShape(b,a,c,!0,!1)&&(b.save(),b.clip(),b.setGlassGradient(c.x,c.y,c.width,c.height),b.begin(),b.moveTo(c.x,c.y),b.lineTo(c.x,c.y+c.height*e),b.quadTo(c.x+0.5*c.width,c.y+0.7*c.height,c.x+c.width,c.y+c.height*e),b.lineTo(c.x+c.width,c.y),b.close(),b.fill(),b.restore())};
mxImageExport.prototype.drawImage=function(a,b,c,d){var e=1==mxUtils.getValue(a.style,mxConstants.STYLE_IMAGE_ASPECT,1),f=1==mxUtils.getValue(a.style,mxConstants.STYLE_IMAGE_FLIPH,0),a=1==mxUtils.getValue(a.style,mxConstants.STYLE_IMAGE_FLIPV,0);b.image(c.x,c.y,c.width,c.height,d,e,f,a)};
mxImageExport.prototype.drawLabelBackground=function(a,b,c,d){var e=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_BORDERCOLOR),f=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR);e==mxConstants.NONE&&(e=null);f==mxConstants.NONE&&(f=null);if(null!=e||null!=f){var g=c.x,a=c.y-mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_PADDING,0),h=c.width,c=c.height;d&&(g+=(h-c)/2,a+=(c-h)/2,d=h,h=c,c=d);null!=f&&b.setFillColor(f);null!=e&&(b.setStrokeColor(e),b.setStrokeWidth(1),b.setDashed(!1));
b.rect(g,a,h,c);null!=f&&null!=e?b.fillAndStroke():null!=f?b.fill():null!=e&&b.stroke()}};
mxImageExport.prototype.drawLabel=function(a,b,c,d,e){var f=a.view.scale;b.setFontColor(mxUtils.getValue(a.style,mxConstants.STYLE_FONTCOLOR,"#000000"));b.setFontFamily(mxUtils.getValue(a.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY));b.setFontStyle(mxUtils.getValue(a.style,mxConstants.STYLE_FONTSTYLE,0));b.setFontSize(mxUtils.getValue(a.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*f);f=mxUtils.getValue(a.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT);
"left"==f&&(f=null);var g=c.y-mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_PADDING,0),h=a.view.graph.isWrapping(a.cell);(a=a.view.graph.isHtmlLabel(a.cell))&&mxText.prototype.replaceLinefeeds&&(e=e.replace(/\n/g,"<br/>"));b.text(c.x,g,c.width,c.height,e,f,null,d,h,a?"html":"")};
mxImageExport.prototype.getBackgroundBounds=function(a){if(a.style[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE){var b=a.view.scale,b=mxUtils.getValue(a.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)*b,c=a.width,d=a.height;mxUtils.getValue(a.style,mxConstants.STYLE_HORIZONTAL,!0)?d=b:c=b;return new mxRectangle(a.x,a.y,Math.min(a.width,c),Math.min(a.height,d))}return new mxRectangle(a.x,a.y,a.width,a.height)};
mxImageExport.prototype.getImageBounds=function(a){var b=new mxRectangle(a.x,a.y,a.width,a.height),c=a.style;if(mxUtils.getValue(c,mxConstants.STYLE_SHAPE)!=mxConstants.SHAPE_IMAGE){var a=mxUtils.getValue(c,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),d=mxUtils.getValue(c,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),e=mxUtils.getValue(c,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),f=mxUtils.getValue(c,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),
c=mxUtils.getValue(c,mxConstants.STYLE_SPACING,2);b.x=a==mxConstants.ALIGN_CENTER?b.x+(b.width-e)/2:a==mxConstants.ALIGN_RIGHT?b.x+(b.width-e-c-2):b.x+(c+4);b.y=d==mxConstants.ALIGN_TOP?b.y+c:d==mxConstants.ALIGN_BOTTOM?b.y+(b.height-f-c):b.y+(b.height-f)/2;b.width=e;b.height=f}return b};
mxImageExport.prototype.drawMarker=function(a,b,c){var d=null,e=b.absolutePoints,f=e.length,g=c?e[1]:e[f-2],e=c?e[0]:e[f-1],f=e.x-g.x,h=e.y-g.y,k=Math.max(1,Math.sqrt(f*f+h*h)),g=f/k,f=h/k,h=mxUtils.getValue(b.style,c?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE),k=mxUtils.getValue(b.style,mxConstants.STYLE_STROKEWIDTH,1),e=e.clone(),l=mxUtils.getValue(b.style,c?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW),n=this.markers[l];null!=n&&(d=n(a,b,l,e,
g,f,h,c,k));return d};
mxImageExport.prototype.initShapes=function(){this.shapes=[];this.shapes.rectangle={drawShape:function(a,c,d,e){if(e)return mxUtils.getValue(c.style,mxConstants.STYLE_ROUNDED,!1)?(c=mxUtils.getValue(c.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100,c=Math.min(d.width*c,d.height*c),a.roundrect(d.x,d.y,d.width,d.height,c,c)):a.rect(d.x,d.y,d.width,d.height),!0;a.fillAndStroke()}};this.shapes.swimlane={drawShape:function(a,c,d,e){if(e)return mxUtils.getValue(c.style,mxConstants.STYLE_ROUNDED,
!1)?(c=Math.min(d.width*mxConstants.RECTANGLE_ROUNDING_FACTOR,d.height*mxConstants.RECTANGLE_ROUNDING_FACTOR),a.roundrect(d.x,d.y,d.width,d.height,c,c)):a.rect(d.x,d.y,d.width,d.height),!0;a.fillAndStroke();a.begin();var e=c.x,f=c.y,g=c.width,h=c.height;0==mxUtils.getValue(c.style,mxConstants.STYLE_HORIZONTAL,1)?(e+=d.width,g-=d.width,a.moveTo(e,f),a.lineTo(e+g,f),a.lineTo(e+g,f+h),a.lineTo(e,f+h)):(f+=d.height,h-=d.height,a.moveTo(e,f),a.lineTo(e,f+h),a.lineTo(e+g,f+h),a.lineTo(e+g,f));a.stroke()}};
this.shapes.image=this.shapes.rectangle;this.shapes.label=this.shapes.rectangle;var a=this;this.shapes.connector={translatePoint:function(a,c,d){if(null!=d){var e=a[c].clone();e.x+=d.x;e.y+=d.y;a[c]=e}},drawShape:function(b,c,d,e,f){if(e){b.setFillColor(f?mxConstants.NONE:mxUtils.getValue(c.style,mxConstants.STYLE_STROKECOLOR,"#000000"));b.setDashed(!1);d=c.absolutePoints.slice();this.translatePoint(d,0,a.drawMarker(b,c,!0));this.translatePoint(d,d.length-1,a.drawMarker(b,c,!1));b.setDashed("1"==
mxUtils.getValue(c.style,mxConstants.STYLE_DASHED,"0"));b.begin();var g=d[0];b.moveTo(g.x,g.y);if(mxUtils.getValue(c.style,mxConstants.STYLE_CURVED,!1)){e=d.length;for(c=1;c<e-2;c++){var f=d[c],h=d[c+1];b.quadTo(f.x,f.y,(f.x+h.x)/2,(f.y+h.y)/2)}f=d[e-2];h=d[e-1];b.quadTo(f.x,f.y,h.x,h.y)}else{e=mxUtils.getValue(c.style,mxConstants.STYLE_ROUNDED,!1);f=mxConstants.LINE_ARCSIZE/2;h=d[d.length-1];b.moveTo(g.x,g.y);for(c=1;c<d.length-1;c++){var k=d[c],l=g.x-k.x,g=g.y-k.y;if(e&&c<d.length-1&&(0!=l||0!=
g)){var n=Math.sqrt(l*l+g*g),l=l*Math.min(f,n/2)/n,g=g*Math.min(f,n/2)/n;b.lineTo(k.x+l,k.y+g);g=d[c+1];l=g.x-k.x;g=g.y-k.y;n=Math.max(1,Math.sqrt(l*l+g*g));l=l*Math.min(f,n/2)/n;g=g*Math.min(f,n/2)/n;l=k.x+l;g=k.y+g;b.curveTo(k.x,k.y,k.x,k.y,l,g);k=new mxPoint(l,g)}else b.lineTo(k.x,k.y);g=k}b.lineTo(h.x,h.y)}b.stroke();return!0}}};this.shapes.arrow={drawShape:function(a,c,d,e){if(e){var d=mxConstants.ARROW_SPACING,f=mxConstants.ARROW_WIDTH,e=mxConstants.ARROW_SIZE,c=c.absolutePoints,g=c[0],c=c[c.length-
1],h=c.x-g.x,k=c.y-g.y,l=Math.sqrt(h*h+k*k),n=l-2*d-e,e=h/l,k=k/l,l=f*k/3,f=-f*e/3,h=g.x-l/2+d*e,g=g.y-f/2+d*k,o=h+l,p=g+f,r=o+n*e,n=p+n*k,s=r+l,u=n+f,w=s-3*l,v=u-3*f;a.begin();a.moveTo(h,g);a.lineTo(o,p);a.lineTo(r,n);a.lineTo(s,u);a.lineTo(c.x-d*e,c.y-d*k);a.lineTo(w,v);a.lineTo(w+l,v+f);a.close();return!0}a.fillAndStroke()}};this.shapes.cylinder={drawShape:function(a,c,d,e){if(e)return!1;var c=d.x,e=d.y,f=d.width,d=d.height,g=Math.min(mxCylinder.prototype.maxHeight,Math.floor(d/5));a.begin();a.moveTo(c,
e+g);a.curveTo(c,e-g/3,c+f,e-g/3,c+f,e+g);a.lineTo(c+f,e+d-g);a.curveTo(c+f,e+d+g/3,c,e+d+g/3,c,e+d-g);a.close();a.fillAndStroke();a.begin();a.moveTo(c,e+g);a.curveTo(c,e+2*g,c+f,e+2*g,c+f,e+g);a.stroke()}};this.shapes.line={drawShape:function(a,c,d,e){if(e)return!1;a.begin();c=c.getCenterY();a.moveTo(d.x,c);a.lineTo(d.x+d.width,c);a.stroke()}};this.shapes.ellipse={drawShape:function(a,c,d,e){if(e)return a.ellipse(d.x,d.y,d.width,d.height),!0;a.fillAndStroke()}};this.shapes.doubleEllipse={drawShape:function(a,
c,d,e){var c=d.x,f=d.y,g=d.width,d=d.height;if(e)return a.ellipse(c,f,g,d),!0;a.fillAndStroke();e=Math.min(4,Math.min(g/5,d/5));g-=2*e;d-=2*e;0<g&&0<d&&a.ellipse(c+e,f+e,g,d);a.stroke()}};this.shapes.triangle={drawShape:function(a,c,d,e){if(e){var c=d.x,e=d.y,f=d.width,d=d.height;a.begin();a.moveTo(c,e);a.lineTo(c+f,e+d/2);a.lineTo(c,e+d);a.close();return!0}a.fillAndStroke()}};this.shapes.rhombus={drawShape:function(a,c,d,e){if(e){var c=d.x,e=d.y,f=d.width,d=d.height,g=f/2,h=d/2;a.begin();a.moveTo(c+
g,e);a.lineTo(c+f,e+h);a.lineTo(c+g,e+d);a.lineTo(c,e+h);a.close();return!0}a.fillAndStroke()}};this.shapes.hexagon={drawShape:function(a,c,d,e){if(e){var c=d.x,e=d.y,f=d.width,d=d.height;a.begin();a.moveTo(c+0.25*f,e);a.lineTo(c+0.75*f,e);a.lineTo(c+f,e+0.5*d);a.lineTo(c+0.75*f,e+d);a.lineTo(c+0.25*f,e+d);a.lineTo(c,e+0.5*d);a.close();return!0}a.fillAndStroke()}};this.shapes.actor={drawShape:function(a,c,d,e){if(e){var c=d.x,e=d.y,f=d.width,d=d.height,g=2*f/6;a.begin();a.moveTo(c,e+d);a.curveTo(c,
e+3*d/5,c,e+2*d/5,c+f/2,e+2*d/5);a.curveTo(c+f/2-g,e+2*d/5,c+f/2-g,e,c+f/2,e);a.curveTo(c+f/2+g,e,c+f/2+g,e+2*d/5,c+f/2,e+2*d/5);a.curveTo(c+f,e+2*d/5,c+f,e+3*d/5,c+f,e+d);a.close();return!0}a.fillAndStroke()}};this.shapes.cloud={drawShape:function(a,c,d,e){if(e){var c=d.x,e=d.y,f=d.width,d=d.height;a.begin();a.moveTo(c+0.25*f,e+0.25*d);a.curveTo(c+0.05*f,e+0.25*d,c,e+0.5*d,c+0.16*f,e+0.55*d);a.curveTo(c,e+0.66*d,c+0.18*f,e+0.9*d,c+0.31*f,e+0.8*d);a.curveTo(c+0.4*f,e+d,c+0.7*f,e+d,c+0.8*f,e+0.8*d);
a.curveTo(c+f,e+0.8*d,c+f,e+0.6*d,c+0.875*f,e+0.5*d);a.curveTo(c+f,e+0.3*d,c+0.8*f,e+0.1*d,c+0.625*f,e+0.2*d);a.curveTo(c+0.5*f,e+0.05*d,c+0.3*f,e+0.05*d,c+0.25*f,e+0.25*d);a.close();return!0}a.fillAndStroke()}}};
mxImageExport.prototype.initMarkers=function(){this.markers=[];var a=function(a,c,d,e,f,g,h,k,l){var n=1.118*f*l,o=1.118*g*l;e.x-=n;e.y-=o;f*=h+l;g*=h+l;a.begin();a.moveTo(e.x,e.y);a.lineTo(e.x-f-g/2,e.y-g+f/2);d==mxConstants.ARROW_CLASSIC&&a.lineTo(e.x-3*f/4,e.y-3*g/4);a.lineTo(e.x+g/2-f,e.y-g-f/2);a.close();0==c.style[k?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL]?a.stroke():a.fillAndStroke();a=d!=mxConstants.ARROW_CLASSIC?1:0.75;return new mxPoint(-f*a-n,-g*a-o)};this.markers.classic=
a;this.markers.block=a;this.markers.open=function(a,c,d,e,f,g,h,k,l){c=1.118*f*l;d=1.118*g*l;e.x-=c;e.y-=d;f*=h+l;g*=h+l;a.begin();a.moveTo(e.x-f-g/2,e.y-g+f/2);a.lineTo(e.x,e.y);a.lineTo(e.x+g/2-f,e.y-g-f/2);a.stroke();return new mxPoint(2*-c,2*-d)};this.markers.oval=function(a,c,d,e,f,g,h,k){d=h/2;a.ellipse(e.x-d,e.y-d,h,h);0==c.style[k?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL]?a.stroke():a.fillAndStroke();return new mxPoint(-f/2,-g/2)};a=function(a,c,d,e,f,g,h,k,l){var n=d==mxConstants.ARROW_DIAMOND?
0.7071:0.9862,o=f*l*n,n=g*l*n,f=f*(h+l),g=g*(h+l);e.x-=o;e.y-=n;d=d==mxConstants.ARROW_DIAMOND?2:3.4;a.begin();a.moveTo(e.x,e.y);a.lineTo(e.x-f/2-g/d,e.y+f/d-g/2);a.lineTo(e.x-f,e.y-g);a.lineTo(e.x-f/2+g/d,e.y-g/2-f/d);a.close();0==c.style[k?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL]?a.stroke():a.fillAndStroke();return new mxPoint(-o-f,-n-g)};this.markers.diamond=a;this.markers.diamondThin=a};
var mxXmlCanvas2D=function(a){var b=new mxUrlConverter,c=!0,d=!0,e=a.ownerDocument,f=[],g={alpha:1,dashed:!1,strokewidth:1,fontsize:mxConstants.DEFAULT_FONTSIZE,fontfamily:mxConstants.DEFAULT_FONTFAMILY,fontcolor:"#000000"},h=function(a){return Math.round(100*parseFloat(a))/100};return{getConverter:function(){return b},isCompressed:function(){return c},setCompressed:function(a){c=a},isTextEnabled:function(){return d},setTextEnabled:function(a){d=a},getDocument:function(){return e},save:function(){c&&
(f.push(g),g=mxUtils.clone(g));a.appendChild(e.createElement("save"))},restore:function(){c&&(g=f.pop());a.appendChild(e.createElement("restore"))},scale:function(b){var c=e.createElement("scale");c.setAttribute("scale",b);a.appendChild(c)},translate:function(b,c){var d=e.createElement("translate");d.setAttribute("dx",h(b));d.setAttribute("dy",h(c));a.appendChild(d)},rotate:function(b,c,d,f,g){var r=e.createElement("rotate");r.setAttribute("theta",h(b));r.setAttribute("flipH",c?"1":"0");r.setAttribute("flipV",
d?"1":"0");r.setAttribute("cx",h(f));r.setAttribute("cy",h(g));a.appendChild(r)},setStrokeWidth:function(b){if(c){if(g.strokewidth==b)return;g.strokewidth=b}var d=e.createElement("strokewidth");d.setAttribute("width",h(b));a.appendChild(d)},setStrokeColor:function(b){var c=e.createElement("strokecolor");c.setAttribute("color",b);a.appendChild(c)},setDashed:function(b){if(c){if(g.dashed==b)return;g.dashed=b}var d=e.createElement("dashed");d.setAttribute("dashed",b?"1":"0");a.appendChild(d)},setDashPattern:function(b){var c=
e.createElement("dashpattern");c.setAttribute("pattern",b);a.appendChild(c)},setLineCap:function(b){var c=e.createElement("linecap");c.setAttribute("cap",b);a.appendChild(c)},setLineJoin:function(b){var c=e.createElement("linejoin");c.setAttribute("join",b);a.appendChild(c)},setMiterLimit:function(b){var c=e.createElement("miterlimit");c.setAttribute("limit",b);a.appendChild(c)},setFontSize:function(b){if(d){if(c){if(g.fontsize==b)return;g.fontsize=b}var f=e.createElement("fontsize");f.setAttribute("size",
b);a.appendChild(f)}},setFontColor:function(b){if(d){if(c){if(g.fontcolor==b)return;g.fontcolor=b}var f=e.createElement("fontcolor");f.setAttribute("color",b);a.appendChild(f)}},setFontFamily:function(b){if(d){if(c){if(g.fontfamily==b)return;g.fontfamily=b}var f=e.createElement("fontfamily");f.setAttribute("family",b);a.appendChild(f)}},setFontStyle:function(b){if(d){var c=e.createElement("fontstyle");c.setAttribute("style",b);a.appendChild(c)}},setAlpha:function(b){if(c){if(g.alpha==b)return;g.alpha=
b}var d=e.createElement("alpha");d.setAttribute("alpha",h(b));a.appendChild(d)},setFillColor:function(b){var c=e.createElement("fillcolor");c.setAttribute("color",b);a.appendChild(c)},setGradient:function(b,c,d,f,g,r,s){var u=e.createElement("gradient");u.setAttribute("c1",b);u.setAttribute("c2",c);u.setAttribute("x",h(d));u.setAttribute("y",h(f));u.setAttribute("w",h(g));u.setAttribute("h",h(r));null!=s&&u.setAttribute("direction",s);a.appendChild(u)},setGlassGradient:function(b,c,d,f){var g=e.createElement("glass");
g.setAttribute("x",h(b));g.setAttribute("y",h(c));g.setAttribute("w",h(d));g.setAttribute("h",h(f));a.appendChild(g)},rect:function(b,c,d,f){var g=e.createElement("rect");g.setAttribute("x",h(b));g.setAttribute("y",h(c));g.setAttribute("w",h(d));g.setAttribute("h",h(f));a.appendChild(g)},roundrect:function(b,c,d,f,g,r){var s=e.createElement("roundrect");s.setAttribute("x",h(b));s.setAttribute("y",h(c));s.setAttribute("w",h(d));s.setAttribute("h",h(f));s.setAttribute("dx",h(g));s.setAttribute("dy",
h(r));a.appendChild(s)},ellipse:function(b,c,d,f){var g=e.createElement("ellipse");g.setAttribute("x",h(b));g.setAttribute("y",h(c));g.setAttribute("w",h(d));g.setAttribute("h",h(f));a.appendChild(g)},image:function(c,d,f,g,p,r,s,u){var p=b.convert(p),w=e.createElement("image");w.setAttribute("x",h(c));w.setAttribute("y",h(d));w.setAttribute("w",h(f));w.setAttribute("h",h(g));w.setAttribute("src",p);w.setAttribute("aspect",r?"1":"0");w.setAttribute("flipH",s?"1":"0");w.setAttribute("flipV",u?"1":
"0");a.appendChild(w)},text:function(b,c,f,g,p,r,s,u,w,v){if(d){var x=e.createElement("text");x.setAttribute("x",h(b));x.setAttribute("y",h(c));x.setAttribute("w",h(f));x.setAttribute("h",h(g));x.setAttribute("str",p);null!=r&&x.setAttribute("align",r);null!=s&&x.setAttribute("valign",s);x.setAttribute("vertical",u?"1":"0");x.setAttribute("wrap",w?"1":"0");x.setAttribute("format",v);a.appendChild(x)}},begin:function(){a.appendChild(e.createElement("begin"))},moveTo:function(b,c){var d=e.createElement("move");
d.setAttribute("x",h(b));d.setAttribute("y",h(c));a.appendChild(d)},lineTo:function(b,c){var d=e.createElement("line");d.setAttribute("x",h(b));d.setAttribute("y",h(c));a.appendChild(d)},quadTo:function(b,c,d,f){var g=e.createElement("quad");g.setAttribute("x1",h(b));g.setAttribute("y1",h(c));g.setAttribute("x2",h(d));g.setAttribute("y2",h(f));a.appendChild(g)},curveTo:function(b,c,d,f,g,r){var s=e.createElement("curve");s.setAttribute("x1",h(b));s.setAttribute("y1",h(c));s.setAttribute("x2",h(d));
s.setAttribute("y2",h(f));s.setAttribute("x3",h(g));s.setAttribute("y3",h(r));a.appendChild(s)},close:function(){a.appendChild(e.createElement("close"))},stroke:function(){a.appendChild(e.createElement("stroke"))},fill:function(){a.appendChild(e.createElement("fill"))},fillAndStroke:function(){a.appendChild(e.createElement("fillstroke"))},shadow:function(b,c){var d=e.createElement("shadow");d.setAttribute("value",b);null!=c&&d.setAttribute("filled",c?"1":"0");a.appendChild(d)},clip:function(){a.appendChild(e.createElement("clip"))}}},
mxSvgCanvas2D=function(a,b){var b=null!=b?b:!1,c=new mxUrlConverter,d=!0,e=!0,f=!0,g=function(b,c){var d=a.ownerDocument||document;if(null!=d.createElementNS)return d.createElementNS(c||mxConstants.NS_SVG,b);d=d.createElement(b);null!=c&&d.setAttribute("xmlns",c);return d},h=g("defs");if(b){var k=g("style");k.setAttribute("type","text/css");mxUtils.write(k,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}");d&&mxUtils.write(k,
"rect{shape-rendering:crispEdges}");h.appendChild(k)}a.appendChild(h);var l={dx:0,dy:0,scale:1,transform:"",fill:null,gradient:null,stroke:null,strokeWidth:1,dashed:!1,dashpattern:"3 3",alpha:1,linecap:"flat",linejoin:"miter",miterlimit:10,fontColor:"#000000",fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0},n=!0,o=null,p=null,r=null,s=null,u=[],w=0,v=[],x=function(a,b){var c="margin:0px;font-size:"+Math.floor(l.fontSize)+"px;font-family:"+l.fontFamily+";color:"+
l.fontColor+";";(l.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(c+="font-weight:bold;");(l.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(c+="font-style:italic;");(l.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(c+="font-decoration:underline;");b==mxConstants.ALIGN_CENTER?c+="text-align:center;":b==mxConstants.ALIGN_RIGHT&&(c+="text-align:right;");var d=document.createElement("div");d.innerHTML=a;a=d.innerHTML.replace(/&nbsp;/g,"&#160;");return mxUtils.parseXml('<div xmlns="http://www.w3.org/1999/xhtml" style="'+
c+'">'+a+"</div>").documentElement},B=function(c,e,f,g){if(null!=c){null!=e.clip&&(c.setAttribute("clip-path","url(#"+e.clip+")"),e.clip=null);null!=r&&(c.setAttribute("d",r.join(" ")),r=null,d&&n&&(c.setAttribute("shape-rendering","crispEdges"),e.strokeWidth=Math.max(1,e.strokeWidth)));1>e.alpha&&c.setAttribute("opacity",e.alpha);f&&(null!=e.fill||null!=e.gradient)?null!=e.gradient?c.setAttribute("fill","url(#"+e.gradient+")"):c.setAttribute("fill",e.fill.toLowerCase()):b||c.setAttribute("fill",
"none");if(g&&null!=e.stroke&&(c.setAttribute("stroke",e.stroke.toLowerCase()),1!=e.strokeWidth&&("rect"==c.nodeName&&d&&(e.strokeWidth=Math.max(1,e.strokeWidth)),c.setAttribute("stroke-width",e.strokeWidth)),"path"==c.nodeName&&(null!=e.linejoin&&"miter"!=e.linejoin&&c.setAttribute("stroke-linejoin",e.linejoin),null!=e.linecap&&(f=e.linecap,"flat"==f&&(f="butt"),"butt"!=f&&c.setAttribute("stroke-linecap",f)),null!=e.miterlimit&&(!b||10!=e.miterlimit)&&c.setAttribute("stroke-miterlimit",e.miterlimit)),
e.dashed&&(f=e.dashpattern.split(" "),0<f.length))){for(var g=[],h=0;h<f.length;h++)g[h]=Number(f[h])*l.strokeWidth;c.setAttribute("stroke-dasharray",g.join(" "))}0<e.transform.length&&c.setAttribute("transform",e.transform);a.appendChild(c)}},z=function(a){return Math.round(100*parseFloat(a))/100};return{getConverter:function(){return c},isAutoAntiAlias:function(){return d},setAutoAntiAlias:function(a){d=a},isTextEnabled:function(){return e},setTextEnabled:function(a){e=a},isFoEnabled:function(){return f},
setFoEnabled:function(a){f=a},save:function(){v.push(l);l=mxUtils.clone(l)},restore:function(){l=v.pop()},scale:function(a){l.scale*=a;l.strokeWidth*=a},translate:function(a,b){l.dx+=a;l.dy+=b},rotate:function(a,b,c,d,e){d+=l.dx;e+=l.dy;d*=l.scale;e*=l.scale;if(b^c){var f=b?d:0,b=b?-1:1,g=c?e:0,c=c?-1:1;l.transform+="translate("+z(f)+","+z(g)+")";l.transform+="scale("+z(b)+","+z(c)+")";l.transform+="translate("+z(-f)+" "+z(-g)+")"}l.transform+="rotate("+z(a)+","+z(d)+","+z(e)+")"},setStrokeWidth:function(a){l.strokeWidth=
a*l.scale},setStrokeColor:function(a){l.stroke=a},setDashed:function(a){l.dashed=a},setDashPattern:function(a){l.dashpattern=a},setLineCap:function(a){l.linecap=a},setLineJoin:function(a){l.linejoin=a},setMiterLimit:function(a){l.miterlimit=a},setFontSize:function(a){l.fontSize=a},setFontColor:function(a){l.fontColor=a},setFontFamily:function(a){l.fontFamily=a},setFontStyle:function(a){l.fontStyle=a},setAlpha:function(a){l.alpha=a},setFillColor:function(a){l.fill=a;l.gradient=null},setGradient:function(a,
b,c,d,e,f,k){if(null!=a&&null!=b){c=l;d=a;e=b;"#"==d.charAt(0)&&(d=d.substring(1));"#"==e.charAt(0)&&(e=e.substring(1));d=d.toLowerCase();e=e.toLowerCase();f=null;if(null==k||k==mxConstants.DIRECTION_SOUTH)f="s";else if(k==mxConstants.DIRECTION_EAST)f="e";else{var n=d,d=e,e=n;k==mxConstants.DIRECTION_NORTH?f="s":k==mxConstants.DIRECTION_WEST&&(f="e")}d=d+"-"+e+"-"+f;e=u[d];null==e&&(e=g("linearGradient"),e.setAttribute("id",++w),e.setAttribute("x1","0%"),e.setAttribute("y1","0%"),e.setAttribute("x2",
"0%"),e.setAttribute("y2","0%"),null==k||k==mxConstants.DIRECTION_SOUTH?e.setAttribute("y2","100%"):k==mxConstants.DIRECTION_EAST?e.setAttribute("x2","100%"):k==mxConstants.DIRECTION_NORTH?e.setAttribute("y1","100%"):k==mxConstants.DIRECTION_WEST&&e.setAttribute("x1","100%"),k=g("stop"),k.setAttribute("offset","0%"),k.setAttribute("style","stop-color:"+a),e.appendChild(k),k=g("stop"),k.setAttribute("offset","100%"),k.setAttribute("style","stop-color:"+b),e.appendChild(k),h.appendChild(e),u[d]=e);
b=e.getAttribute("id");c.gradient=b;l.fill=a}},setGlassGradient:function(){if(null==o){o=g("linearGradient");o.setAttribute("id","0");o.setAttribute("x1","0%");o.setAttribute("y1","0%");o.setAttribute("x2","0%");o.setAttribute("y2","100%");var a=g("stop");a.setAttribute("offset","0%");a.setAttribute("style","stop-color:#ffffff;stop-opacity:0.9");o.appendChild(a);a=g("stop");a.setAttribute("offset","100%");a.setAttribute("style","stop-color:#ffffff;stop-opacity:0.1");o.appendChild(a);null!=h.firstChild.nextSibling?
h.insertBefore(o,h.firstChild.nextSibling):h.appendChild(o)}l.gradient="0"},rect:function(a,c,e,f){a+=l.dx;c+=l.dy;p=g("rect");p.setAttribute("x",z(a*l.scale));p.setAttribute("y",z(c*l.scale));p.setAttribute("width",z(e*l.scale));p.setAttribute("height",z(f*l.scale));!b&&d&&p.setAttribute("shape-rendering","crispEdges")},roundrect:function(a,c,e,f,h,k){a+=l.dx;c+=l.dy;p=g("rect");p.setAttribute("x",z(a*l.scale));p.setAttribute("y",z(c*l.scale));p.setAttribute("width",z(e*l.scale));p.setAttribute("height",
z(f*l.scale));0<h&&p.setAttribute("rx",z(h*l.scale));0<k&&p.setAttribute("ry",z(k*l.scale));!b&&d&&p.setAttribute("shape-rendering","crispEdges")},ellipse:function(a,b,c,d){a+=l.dx;b+=l.dy;p=g("ellipse");p.setAttribute("cx",z((a+c/2)*l.scale));p.setAttribute("cy",z((b+d/2)*l.scale));p.setAttribute("rx",z(c/2*l.scale));p.setAttribute("ry",z(d/2*l.scale))},image:function(b,d,e,f,h,k,n,o){var h=c.convert(h),k=null!=k?k:!0,n=null!=n?n:!1,o=null!=o?o:!1,b=b+l.dx,d=d+l.dy,p=g("image");p.setAttribute("x",
z(b*l.scale));p.setAttribute("y",z(d*l.scale));p.setAttribute("width",z(e*l.scale));p.setAttribute("height",z(f*l.scale));mxClient.IS_VML?p.setAttribute("xlink:href",h):p.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",h);k||p.setAttribute("preserveAspectRatio","none");1>l.alpha&&p.setAttribute("opacity",l.alpha);h=l.transform;if(n||o){var s=k=1,r=0,u=0;n&&(k=-1,r=-e-2*b);o&&(s=-1,u=-f-2*d);h+="scale("+k+","+s+")translate("+r+","+u+")"}0<h.length&&p.setAttribute("transform",h);a.appendChild(p)},
text:function(c,d,h,k,n,o,p,s,r,u){if(e){c+=l.dx;d+=l.dy;if(f&&"html"==u)r=g("g"),r.setAttribute("transform",l.transform+"scale("+l.scale+","+l.scale+")"),1>l.alpha&&r.setAttribute("opacity",l.alpha),u=g("foreignObject"),u.setAttribute("x",Math.round(c)),u.setAttribute("y",Math.round(d)),u.setAttribute("width",Math.round(h)),u.setAttribute("height",Math.round(k)),u.appendChild(x(n,o,p)),r.appendChild(u);else{var u=Math.floor(l.fontSize),r=g("g"),w=l.transform;s&&(s=d+k/2,w+="rotate(-90,"+z((c+h/2)*
l.scale)+","+z(s*l.scale)+")");0<w.length&&r.setAttribute("transform",w);1>l.alpha&&r.setAttribute("opacity",l.alpha);o=o==mxConstants.ALIGN_RIGHT?"end":o==mxConstants.ALIGN_CENTER?"middle":"start";c="end"==o?c+Math.max(0,h-2):"middle"==o?c+h/2:c+(0<h?2:0);(l.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&r.setAttribute("font-weight","bold");(l.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&r.setAttribute("font-style","italic");(l.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&
r.setAttribute("text-decoration","underline");"start"!=o&&r.setAttribute("text-anchor",o);(!b||u!=mxConstants.DEFAULT_FONTSIZE)&&r.setAttribute("font-size",Math.floor(u*l.scale)+"px");(!b||l.fontFamily!=mxConstants.DEFAULT_FONTFAMILY)&&r.setAttribute("font-family",l.fontFamily);r.setAttribute("fill",l.fontColor);h=n.split("\n");n=1.25*u;o=k-(0<k?u+(h.length-1)*n:h.length*n-1);null==p||p==mxConstants.ALIGN_TOP?d=Math.max(d-3*l.scale,d+o/2+(0<k?n/2-8:0)):p==mxConstants.ALIGN_MIDDLE?d+=o/2:p==mxConstants.ALIGN_BOTTOM&&
(d=Math.min(d,d+o+2*l.scale));d+=u;for(k=0;k<h.length;k++)p=g("text"),p.setAttribute("x",z(c*l.scale)),p.setAttribute("y",z(d*l.scale)),mxUtils.write(p,h[k]),r.appendChild(p),d+=1.3*u}a.appendChild(r)}},begin:function(){p=g("path");r=[];s=null;n=!0},moveTo:function(a,b){null!=r&&(a+=l.dx,b+=l.dy,r.push("M "+z(a*l.scale)+" "+z(b*l.scale)),d&&(s=new mxPoint(a,b)))},lineTo:function(a,b){null!=r&&(a+=l.dx,b+=l.dy,r.push("L "+z(a*l.scale)+" "+z(b*l.scale)),d&&(null!=s&&n&&a!=s.x&&b!=s.y&&(n=!1),s=new mxPoint(a,
b)))},quadTo:function(a,b,c,d){null!=r&&(a+=l.dx,b+=l.dy,c+=l.dx,d+=l.dy,r.push("Q "+z(a*l.scale)+" "+z(b*l.scale)+" "+z(c*l.scale)+" "+z(d*l.scale)),n=!1)},curveTo:function(a,b,c,d,e,f){null!=r&&(a+=l.dx,b+=l.dy,c+=l.dx,d+=l.dy,e+=l.dx,f+=l.dy,r.push("C "+z(a*l.scale)+" "+z(b*l.scale)+" "+z(c*l.scale)+" "+z(d*l.scale)+" "+z(e*l.scale)+" "+z(f*l.scale)),n=!1)},close:function(){null!=r&&r.push("Z")},stroke:function(){B(p,l,!1,!0)},fill:function(){B(p,l,!0,!1)},fillAndStroke:function(){B(p,l,!0,!0)},
shadow:function(a,b){this.save();this.setStrokeColor(a);b?(this.setFillColor(a),this.fillAndStroke()):this.stroke();this.restore()},clip:function(){if(null!=p){null!=r&&(p.setAttribute("d",r.join(" ")),r=null);var a=++w,b=g("clipPath");b.setAttribute("id",a);b.appendChild(p);h.appendChild(b);l.clip=a}}}};function mxGuide(a,b){this.graph=a;this.setStates(b)}mxGuide.prototype.graph=null;mxGuide.prototype.states=null;mxGuide.prototype.horizontal=!0;mxGuide.prototype.vertical=!0;
mxGuide.prototype.guideX=null;mxGuide.prototype.guideY=null;mxGuide.prototype.crisp=!0;mxGuide.prototype.setStates=function(a){this.states=a};mxGuide.prototype.isEnabledForEvent=function(){return!0};mxGuide.prototype.getGuideTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxGuide.prototype.createGuideShape=function(){var a=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);a.crisp=this.crisp;a.isDashed=!0;return a};
mxGuide.prototype.move=function(a,b,c){if(null!=this.states&&(this.horizontal||this.vertical)&&null!=a&&null!=b){var d=this.graph.getView().translate,e=this.graph.getView().scale,f=b.x,g=b.y,h=!1,k=!1,l=this.getGuideTolerance(),n=l,o=l,l=a.clone();l.x+=b.x;l.y+=b.y;for(var p=l.x,r=l.x+l.width,s=l.getCenterX(),u=l.y,w=l.y+l.height,v=l.getCenterY(),b=function(b){var b=b+this.graph.panDx,c=!1;Math.abs(b-s)<n?(f=b-a.getCenterX(),n=Math.abs(b-s),c=!0):Math.abs(b-p)<n?(f=b-a.x,n=Math.abs(b-p),c=!0):Math.abs(b-
r)<n&&(f=b-a.x-a.width,n=Math.abs(b-r),c=!0);if(c){null==this.guideX&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.init(this.graph.getView().getOverlayPane()),this.graph.dialect==mxConstants.DIALECT_SVG&&(this.guideX.node.setAttribute("pointer-events","none"),this.guideX.pipe.setAttribute("pointer-events","none")));var d=this.graph.container,b=b-this.graph.panDx;this.guideX.points=
[new mxPoint(b,-this.graph.panDy),new mxPoint(b,d.scrollHeight-3-this.graph.panDy)]}h=h||c},l=function(b){var b=b+this.graph.panDy,c=!1;Math.abs(b-v)<o?(g=b-a.getCenterY(),o=Math.abs(b-v),c=!0):Math.abs(b-u)<o?(g=b-a.y,o=Math.abs(b-u),c=!0):Math.abs(b-w)<o&&(g=b-a.y-a.height,o=Math.abs(b-w),c=!0);if(c){null==this.guideY&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.init(this.graph.getView().getOverlayPane()),
this.graph.dialect==mxConstants.DIALECT_SVG&&(this.guideY.node.setAttribute("pointer-events","none"),this.guideY.pipe.setAttribute("pointer-events","none")));var d=this.graph.container,b=b-this.graph.panDy;this.guideY.points=[new mxPoint(-this.graph.panDx,b),new mxPoint(d.scrollWidth-3-this.graph.panDx,b)]}k=k||c},x=0;x<this.states.length;x++){var B=this.states[x];null!=B&&(this.horizontal&&(b.call(this,B.getCenterX()),b.call(this,B.x),b.call(this,B.x+B.width)),this.vertical&&(l.call(this,B.getCenterY()),
l.call(this,B.y),l.call(this,B.y+B.height)))}!h&&null!=this.guideX?this.guideX.node.style.visibility="hidden":null!=this.guideX&&(this.guideX.node.style.visibility="visible",this.guideX.redraw());!k&&null!=this.guideY?this.guideY.node.style.visibility="hidden":null!=this.guideY&&(this.guideY.node.style.visibility="visible",this.guideY.redraw());c&&(h||(c=a.x-(this.graph.snap(a.x/e-d.x)+d.x)*e,f=this.graph.snap(f/e)*e-c),k||(d=a.y-(this.graph.snap(a.y/e-d.y)+d.y)*e,g=this.graph.snap(g/e)*e-d));b=new mxPoint(f,
g)}return b};mxGuide.prototype.hide=function(){null!=this.guideX&&(this.guideX.node.style.visibility="hidden");null!=this.guideY&&(this.guideY.node.style.visibility="hidden")};mxGuide.prototype.destroy=function(){null!=this.guideX&&(this.guideX.destroy(),this.guideX=null);null!=this.guideY&&(this.guideY.destroy(),this.guideY=null)};function mxShape(){}mxShape.prototype.SVG_STROKE_TOLERANCE=8;mxShape.prototype.scale=1;mxShape.prototype.dialect=null;mxShape.prototype.crisp=!1;
mxShape.prototype.roundedCrispSvg=!0;mxShape.prototype.mixedModeHtml=!0;mxShape.prototype.preferModeHtml=!0;mxShape.prototype.bounds=null;mxShape.prototype.points=null;mxShape.prototype.node=null;mxShape.prototype.label=null;mxShape.prototype.innerNode=null;mxShape.prototype.style=null;mxShape.prototype.startOffset=null;mxShape.prototype.endOffset=null;mxShape.prototype.boundingBox=null;mxShape.prototype.vmlNodes=["node","strokeNode","fillNode","shadowNode"];mxShape.prototype.vmlScale=1;
mxShape.prototype.strokewidth=1;mxShape.prototype.setCursor=function(a){null==a&&(a="");this.cursor=a;null!=this.innerNode&&(this.innerNode.style.cursor=a);null!=this.node&&(this.node.style.cursor=a);null!=this.pipe&&(this.pipe.style.cursor=a)};mxShape.prototype.getCursor=function(){return this.cursor};
mxShape.prototype.init=function(a){null==this.node&&(this.node=this.create(a),null!=a&&(a.appendChild(this.node),8==document.documentMode&&mxUtils.isVml(this.node)&&this.reparseVml()));null!=this.insertGradientNode&&(this.insertGradient(this.insertGradientNode),this.insertGradientNode=null)};
mxShape.prototype.reparseVml=function(){for(var a=0;a<this.vmlNodes.length;a++)null!=this[this.vmlNodes[a]]&&this[this.vmlNodes[a]].setAttribute("id","mxTemporaryReference-"+this.vmlNodes[a]);this.node.outerHTML=this.node.outerHTML;for(a=0;a<this.vmlNodes.length;a++)null!=this[this.vmlNodes[a]]&&(this[this.vmlNodes[a]]=this.node.ownerDocument.getElementById("mxTemporaryReference-"+this.vmlNodes[a]),this[this.vmlNodes[a]].removeAttribute("id"))};
mxShape.prototype.insertGradient=function(a){if(null!=a){for(var b=0,c=a.getAttribute("id"),d=document.getElementById(c);null!=d&&d.ownerSVGElement!=this.node.ownerSVGElement;)b++,c=a.getAttribute("id")+"-"+b,d=document.getElementById(c);null==d&&(a.setAttribute("id",c),this.node.ownerSVGElement.appendChild(a),d=a);null!=d&&(a="url(#"+c+")",b=null!=this.innerNode?this.innerNode:this.node,null!=b&&b.getAttribute("fill")!=a&&b.setAttribute("fill",a))}};
mxShape.prototype.isMixedModeHtml=function(){return this.mixedModeHtml&&!this.isRounded&&!this.isShadow&&null==this.gradient&&0==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,0)&&0==mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,0)};
mxShape.prototype.create=function(){var a=null;return a=this.dialect==mxConstants.DIALECT_SVG?this.createSvg():this.dialect==mxConstants.DIALECT_STRICTHTML||this.preferModeHtml&&this.dialect==mxConstants.DIALECT_PREFERHTML||this.isMixedModeHtml()&&this.dialect==mxConstants.DIALECT_MIXEDHTML?this.createHtml():this.createVml()};mxShape.prototype.createHtml=function(){var a=document.createElement("DIV");this.configureHtmlShape(a);return a};
mxShape.prototype.destroy=function(){null!=this.node&&(mxEvent.release(this.node),null!=this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node.glassOverlay&&(this.node.glassOverlay.parentNode.removeChild(this.node.glassOverlay),this.node.glassOverlay=null),this.node=null)};
mxShape.prototype.apply=function(a){this.style=a=a.style;null!=a&&(this.fill=mxUtils.getValue(a,mxConstants.STYLE_FILLCOLOR,this.fill),this.gradient=mxUtils.getValue(a,mxConstants.STYLE_GRADIENTCOLOR,this.gradient),this.gradientDirection=mxUtils.getValue(a,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection),this.opacity=mxUtils.getValue(a,mxConstants.STYLE_OPACITY,this.opacity),this.stroke=mxUtils.getValue(a,mxConstants.STYLE_STROKECOLOR,this.stroke),this.strokewidth=mxUtils.getNumber(a,
mxConstants.STYLE_STROKEWIDTH,this.strokewidth),this.isShadow=mxUtils.getValue(a,mxConstants.STYLE_SHADOW,this.isShadow),this.isDashed=mxUtils.getValue(a,mxConstants.STYLE_DASHED,this.isDashed),this.spacing=mxUtils.getValue(a,mxConstants.STYLE_SPACING,this.spacing),this.startSize=mxUtils.getNumber(a,mxConstants.STYLE_STARTSIZE,this.startSize),this.endSize=mxUtils.getNumber(a,mxConstants.STYLE_ENDSIZE,this.endSize),this.isRounded=mxUtils.getValue(a,mxConstants.STYLE_ROUNDED,this.isRounded),this.startArrow=
mxUtils.getValue(a,mxConstants.STYLE_STARTARROW,this.startArrow),this.endArrow=mxUtils.getValue(a,mxConstants.STYLE_ENDARROW,this.endArrow),this.rotation=mxUtils.getValue(a,mxConstants.STYLE_ROTATION,this.rotation),this.direction=mxUtils.getValue(a,mxConstants.STYLE_DIRECTION,this.direction),"none"==this.fill&&(this.fill=null),"none"==this.gradient&&(this.gradient=null),"none"==this.stroke&&(this.stroke=null))};
mxShape.prototype.createSvgGroup=function(a){var b=document.createElementNS(mxConstants.NS_SVG,"g");this.innerNode=document.createElementNS(mxConstants.NS_SVG,a);this.configureSvgShape(this.innerNode);"rect"==a&&1<=this.strokewidth*this.scale&&!this.isRounded&&this.innerNode.setAttribute("shape-rendering","optimizeSpeed");this.shadowNode=this.createSvgShadow(this.innerNode);null!=this.shadowNode&&b.appendChild(this.shadowNode);b.appendChild(this.innerNode);return b};
mxShape.prototype.createSvgShadow=function(a){return this.isShadow?(a=a.cloneNode(!0),a.setAttribute("opacity",mxConstants.SHADOW_OPACITY),null!=this.fill&&this.fill!=mxConstants.NONE&&a.setAttribute("fill",mxConstants.SHADOWCOLOR),null!=this.stroke&&this.stroke!=mxConstants.NONE&&a.setAttribute("stroke",mxConstants.SHADOWCOLOR),a):null};
mxShape.prototype.configureHtmlShape=function(a){if(mxUtils.isVml(a))this.configureVmlShape(a);else{a.style.position="absolute";a.style.overflow="hidden";var b=this.stroke;null!=b&&b!=mxConstants.NONE?(a.style.borderColor=b,this.isDashed?a.style.borderStyle="dashed":0<this.strokewidth&&(a.style.borderStyle="solid"),a.style.borderWidth=Math.ceil(this.strokewidth*this.scale)+"px"):a.style.borderWidth="0px";b=this.fill;a.style.background="";null!=b&&b!=mxConstants.NONE?a.style.backgroundColor=b:null==
this.points&&this.configureTransparentBackground(a);null!=this.opacity&&mxUtils.setOpacity(a,this.opacity)}};mxShape.prototype.updateVmlFill=function(a,b,c,d,e){a.color=b;null!=e&&100!=e&&(a.opacity=e+"%",null!=c&&a.setAttribute("o:opacity2",e+"%"));null!=c&&(a.type="gradient",a.color2=c,b="180",this.gradientDirection==mxConstants.DIRECTION_EAST?b="270":this.gradientDirection==mxConstants.DIRECTION_WEST?b="90":this.gradientDirection==mxConstants.DIRECTION_NORTH&&(b="0"),a.angle=b)};
mxShape.prototype.updateVmlStrokeNode=function(a){null==this.strokeNode&&(this.strokeNode=document.createElement("v:stroke"),this.strokeNode.joinstyle="miter",this.strokeNode.miterlimit=4,a.appendChild(this.strokeNode));null!=this.opacity&&(this.strokeNode.opacity=this.opacity+"%");this.updateVmlDashStyle()};mxShape.prototype.updateVmlStrokeColor=function(a){var b=this.stroke;null!=b&&b!=mxConstants.NONE?(a.stroked="true",a.strokecolor=b):a.stroked="false"};
mxShape.prototype.configureVmlShape=function(a){a.style.position="absolute";this.updateVmlStrokeColor(a);a.style.background="";var b=this.fill;null!=b&&b!=mxConstants.NONE?(null==this.fillNode&&(this.fillNode=document.createElement("v:fill"),a.appendChild(this.fillNode)),this.updateVmlFill(this.fillNode,b,this.gradient,this.gradientDirection,this.opacity)):(a.filled="false",null==this.points&&this.configureTransparentBackground(a));this.updateVmlStrokeNode(a);this.isShadow&&this.createVmlShadow(a);
if("roundrect"==a.nodeName)try{var c=100*mxConstants.RECTANGLE_ROUNDING_FACTOR;null!=this.style&&(c=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,c));a.setAttribute("arcsize",""+c+"%")}catch(d){}};
mxShape.prototype.createVmlShadow=function(a){null==this.shadowNode&&(this.shadowNode=document.createElement("v:shadow"),this.shadowNode.on="true",this.shadowNode.color=mxConstants.SHADOWCOLOR,this.shadowNode.opacity=100*mxConstants.SHADOW_OPACITY+"%",this.shadowStrokeNode=document.createElement("v:stroke"),this.shadowNode.appendChild(this.shadowStrokeNode),a.appendChild(this.shadowNode))};
mxShape.prototype.configureTransparentBackground=function(a){a.style.background="url('"+mxClient.imageBasePath+"/transparent.gif')"};
mxShape.prototype.configureSvgShape=function(a){var b=this.stroke;null!=b&&b!=mxConstants.NONE?a.setAttribute("stroke",b):a.setAttribute("stroke","none");b=this.fill;if(null!=b&&b!=mxConstants.NONE)if(null!=this.gradient){var c=this.getGradientId(b,this.gradient);null!=this.gradientNode&&this.gradientNode.getAttribute("id")!=c&&(this.gradientNode=null,a.setAttribute("fill",""));null==this.gradientNode&&(this.gradientNode=this.createSvgGradient(c,b,this.gradient,a),a.setAttribute("fill","url(#"+c+
")"))}else this.gradientNode=null,a.setAttribute("fill",b);else"ellipse"==a.nodeName&&mxClient.IS_NS&&!mxClient.IS_GC&&!mxClient.IS_SF?a.setAttribute("fill","transparent"):a.setAttribute("fill","none");null!=this.opacity&&(a.setAttribute("fill-opacity",this.opacity/100),a.setAttribute("stroke-opacity",this.opacity/100))};
mxShape.prototype.getGradientId=function(a,b){"#"==a.charAt(0)&&(a=a.substring(1));"#"==b.charAt(0)&&(b=b.substring(1));var a=a.toLowerCase(),b=b.toLowerCase(),c=null;if(null==this.gradientDirection||this.gradientDirection==mxConstants.DIRECTION_SOUTH)c="south";else if(this.gradientDirection==mxConstants.DIRECTION_EAST)c="east";else{var d=a,a=b,b=d;this.gradientDirection==mxConstants.DIRECTION_NORTH?c="south":this.gradientDirection==mxConstants.DIRECTION_WEST&&(c="east")}return"mx-gradient-"+a+"-"+
b+"-"+c};mxShape.prototype.createSvgPipe=function(){var a=document.createElementNS(mxConstants.NS_SVG,"path");a.setAttribute("pointer-events","stroke");a.setAttribute("fill","none");a.setAttribute("visibility","hidden");a.setAttribute("stroke",mxClient.IS_OP?"none":"white");return a};
mxShape.prototype.createSvgGradient=function(a,b,c){var d=this.insertGradientNode;null==d&&(d=document.createElementNS(mxConstants.NS_SVG,"linearGradient"),d.setAttribute("id",a),d.setAttribute("x1","0%"),d.setAttribute("y1","0%"),d.setAttribute("x2","0%"),d.setAttribute("y2","0%"),null==this.gradientDirection||this.gradientDirection==mxConstants.DIRECTION_SOUTH?d.setAttribute("y2","100%"):this.gradientDirection==mxConstants.DIRECTION_EAST?d.setAttribute("x2","100%"):this.gradientDirection==mxConstants.DIRECTION_NORTH?
d.setAttribute("y1","100%"):this.gradientDirection==mxConstants.DIRECTION_WEST&&d.setAttribute("x1","100%"),a=document.createElementNS(mxConstants.NS_SVG,"stop"),a.setAttribute("offset","0%"),a.setAttribute("style","stop-color:"+b),d.appendChild(a),a=document.createElementNS(mxConstants.NS_SVG,"stop"),a.setAttribute("offset","100%"),a.setAttribute("style","stop-color:"+c),d.appendChild(a));return this.insertGradientNode=d};
mxShape.prototype.createPoints=function(a,b,c,d){var e=d?this.bounds.x:0,d=d?this.bounds.y:0,f=this.crisp&&this.dialect==mxConstants.DIALECT_SVG&&mxClient.IS_IE?0.5:0;if(isNaN(this.points[0].x)||isNaN(this.points[0].y))return null;var g=mxConstants.LINE_ARCSIZE*this.scale,h=this.points[0];null!=this.startOffset&&(h=h.clone(),h.x+=this.startOffset.x,h.y+=this.startOffset.y);for(var a=a+" "+(Math.round(h.x-e)+f)+" "+(Math.round(h.y-d)+f)+" ",k=1;k<this.points.length;k++){var h=this.points[k-1],l=this.points[k];
if(isNaN(l.x)||isNaN(l.y))return null;k==this.points.length-1&&null!=this.endOffset&&(l=l.clone(),l.x+=this.endOffset.x,l.y+=this.endOffset.y);var n=h.x-l.x,h=h.y-l.y;if(this.isRounded&&k<this.points.length-1&&(0!=n||0!=h)&&0.3<this.scale){var o=Math.sqrt(n*n+h*h),n=n*Math.min(g,o/2)/o,h=h*Math.min(g,o/2)/o,a=a+(b+" "+(Math.round(l.x+n-e)+f)+" "+(Math.round(l.y+h-d)+f)+" "),h=this.points[k+1],n=h.x-l.x,h=h.y-l.y,o=Math.max(1,Math.sqrt(n*n+h*h));0!=o&&(n=n*Math.min(g,o/2)/o,h=h*Math.min(g,o/2)/o,a+=
c+" "+Math.round(l.x-e)+" "+Math.round(l.y-d)+" "+Math.round(l.x-e)+","+Math.round(l.y-d)+" "+(Math.round(l.x+n-e)+f)+" "+(Math.round(l.y+h-d)+f)+" ")}else a+=b+" "+(Math.round(l.x-e)+f)+" "+(Math.round(l.y-d)+f)+" "}return a};
mxShape.prototype.createCurvedPoints=function(a){for(var b=this.crisp&&this.dialect==mxConstants.DIALECT_SVG&&mxClient.IS_IE?0.5:0,c=a?this.bounds.x:0,d=a?this.bounds.y:0,e=this.points[0],f=this.points.length,g=(a?"m":"M")+" "+(Math.round(e.x-c)+b)+" "+(Math.round(e.y-d)+b)+" ",h=0,k=0,l=1;l<f-2;l++){var e=this.points[l],n=this.points[l+1],h=(e.x+n.x)/2,k=(e.y+n.y)/2;a?(n=this.points[l-1],g+=this.createVmlQuad(n.x-c,n.y-d,e.x-c,e.y-d,h-c,k-d)):g+="Q "+Math.round(e.x-c)+" "+Math.round(e.y-d)+" "+(Math.round(h-
c)+b)+" "+(Math.round(k-d)+b)+" "}e=this.points[f-2];n=this.points[f-1];return g=a?g+this.createVmlQuad(h-c,k-d,e.x-c,e.y-d,n.x-c,n.y-d):g+("Q "+Math.round(e.x-c)+" "+Math.round(e.y-d)+" "+(Math.round(n.x-c)+b)+" "+(Math.round(n.y-d)+b)+" ")};mxShape.prototype.createVmlQuad=function(a,b,c,d,e,f){var b=b+2/3*(d-b),g=e+2/3*(c-e),d=f+2/3*(d-f);return"C "+Math.round(a+2/3*(c-a))+" "+Math.round(b)+" "+Math.round(g)+" "+Math.round(d)+" "+Math.round(e)+" "+Math.round(f)};
mxShape.prototype.updateHtmlShape=function(a){if(null!=a){if(mxUtils.isVml(a))this.updateVmlShape(a);else{var b=Math.ceil(this.strokewidth*this.scale);a.style.borderWidth=Math.max(1,b)+"px";null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&(a.style.left=Math.round(this.bounds.x-b/2)+"px",a.style.top=Math.round(this.bounds.y-b/2)+"px","CSS1Compat"==document.compatMode&&(b=-b),a.style.width=Math.round(Math.max(0,this.bounds.width+
b))+"px",a.style.height=Math.round(Math.max(0,this.bounds.height+b))+"px",a.style.visibility=0==this.bounds.width||0==this.bounds.height?"hidden":"visible")}if(null!=this.points&&null!=this.bounds&&!mxUtils.isVml(a)){null==this.divContainer&&(this.divContainer=a);for(;null!=this.divContainer.firstChild;)mxEvent.release(this.divContainer.firstChild),this.divContainer.removeChild(this.divContainer.firstChild);a.style.borderStyle="";a.style.background="";if(2==this.points.length){var c=this.points[0],
b=this.points[1],d=b.x-c.x,e=b.y-c.y;if(0==d||0==e)a.style.borderStyle="solid";else{a.style.width=Math.round(this.bounds.width+1)+"px";a.style.height=Math.round(this.bounds.height+1)+"px";for(var b=1+Math.sqrt(d*d+e*e)/(8*this.scale),f=d/b,g=e/b,a=c.x-this.bounds.x,c=c.y-this.bounds.y,d=0;d<b;d++)e=document.createElement("DIV"),e.style.position="absolute",e.style.overflow="hidden",e.style.left=Math.round(a)+"px",e.style.top=Math.round(c)+"px",e.style.width=Math.max(1,2*this.scale)+"px",e.style.height=
Math.max(1,2*this.scale)+"px",e.style.backgroundColor=this.stroke,this.divContainer.appendChild(e),a+=f,c+=g}}else if(3==this.points.length)c=this.points[1],d="0",e="1",b="0",f="1",c.x==this.bounds.x&&(f="0",b="1"),c.y==this.bounds.y&&(d="1",e="0"),a.style.borderStyle="solid",a.style.borderWidth=d+" "+f+" "+e+" "+b+"px";else{a.style.width=Math.round(this.bounds.width+1)+"px";a.style.height=Math.round(this.bounds.height+1)+"px";g=this.points[0];for(d=1;d<this.points.length;d++)f=this.points[d],e=document.createElement("DIV"),
e.style.position="absolute",e.style.overflow="hidden",e.style.borderColor=this.stroke,e.style.borderStyle="solid",e.style.borderWidth="1 0 0 1px",a=Math.min(f.x,g.x)-this.bounds.x,c=Math.min(f.y,g.y)-this.bounds.y,b=Math.max(1,Math.abs(f.x-g.x)),g=Math.max(1,Math.abs(f.y-g.y)),e.style.left=a+"px",e.style.top=c+"px",e.style.width=b+"px",e.style.height=g+"px",this.divContainer.appendChild(e),g=f}}}};
mxShape.prototype.updateVmlDashStyle=function(){this.isDashed?"dash"!=this.strokeNode.dashstyle&&(this.strokeNode.dashstyle="dash"):"solid"!=this.strokeNode.dashstyle&&(this.strokeNode.dashstyle="solid")};
mxShape.prototype.updateVmlShape=function(a){a.strokeweight=this.strokewidth*this.scale+"px";null!=this.strokeNode&&this.updateVmlDashStyle();if(null!=this.shadowNode){var b=Math.round(mxConstants.SHADOW_OFFSET_X*this.scale),c=Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale);this.shadowNode.offset=b+"px,"+c+"px"}if(null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)){var b=1,c=Math.max(0,Math.round(this.bounds.width)),d=Math.max(0,
Math.round(this.bounds.height));if(null!=this.points||"shape"==a.nodeName||"group"==a.nodeName){var e="group"==a.parentNode.nodeName?1:this.vmlScale;a.coordsize=c*e+","+d*e}else"group"==a.parentNode.nodeName&&(b=this.vmlScale);a.parentNode!=this.node&&(a.style.left=Math.round(this.bounds.x*b)+"px",a.style.top=Math.round(this.bounds.y*b)+"px",null==this.points&&(null!=this.rotation&&0!=this.rotation?a.style.rotation=this.rotation:null!=a.style.rotation&&(a.style.rotation="")));a.style.width=c*b+"px";
a.style.height=d*b+"px"}if(null!=this.points&&"group"!=a.nodeName)if("polyline"==a.nodeName&&null!=a.points){b="";for(c=0;c<this.points.length;c++)b+=this.points[c].x+","+this.points[c].y+" ";a.points.value=b;a.style.left=null;a.style.top=null;a.style.width=null;a.style.height=null}else null!=this.bounds&&(b=null==this.style||1!=this.style[mxConstants.STYLE_CURVED]?this.createPoints("m","l","c",!0):this.createCurvedPoints(!0),a.path=b+" e")};
mxShape.prototype.updateSvgBounds=function(a){var b=this.bounds.width,c=this.bounds.height;if(this.isRounded&&(!this.crisp||!mxClient.IS_IE))a.setAttribute("x",this.bounds.x),a.setAttribute("y",this.bounds.y);else{var d=this.crisp&&mxClient.IS_IE?0.5:0;a.setAttribute("x",Math.round(this.bounds.x)+d);a.setAttribute("y",Math.round(this.bounds.y)+d);b=Math.round(b);c=Math.round(c)}a.setAttribute("width",b);a.setAttribute("height",c);this.isRounded&&(d=100*mxConstants.RECTANGLE_ROUNDING_FACTOR,null!=
this.style&&(d=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,d)/100),b=Math.min(b*d,c*d),a.setAttribute("rx",b),a.setAttribute("ry",b));this.updateSvgTransform(a,a==this.shadowNode)};mxShape.prototype.updateSvgPath=function(a){var b=null==this.style||1!=this.style[mxConstants.STYLE_CURVED]?this.createPoints("M","L","C",!1):this.createCurvedPoints(!1);null!=b&&(a.setAttribute("d",b),a.removeAttribute("x"),a.removeAttribute("y"),a.removeAttribute("width"),a.removeAttribute("height"))};
mxShape.prototype.updateSvgScale=function(a){a.setAttribute("stroke-width",Math.round(Math.max(1,this.strokewidth*this.scale)));if(this.isDashed){var b=Math.max(1,Math.round(3*this.scale*this.strokewidth));a.setAttribute("stroke-dasharray",b+" "+b)}this.crisp&&(this.roundedCrispSvg||!0!=this.isRounded)&&(null==this.rotation||0==this.rotation)?a.setAttribute("shape-rendering","crispEdges"):a.removeAttribute("shape-rendering")};
mxShape.prototype.updateSvgShape=function(a){null!=this.points&&null!=this.points[0]?this.updateSvgPath(a):null!=this.bounds&&this.updateSvgBounds(a);this.updateSvgScale(a)};mxShape.prototype.getSvgShadowTransform=function(){return"translate("+mxConstants.SHADOW_OFFSET_X*this.scale+" "+mxConstants.SHADOW_OFFSET_Y*this.scale+")"};
mxShape.prototype.updateSvgTransform=function(a,b){var c=b?this.getSvgShadowTransform():"";null!=this.rotation&&0!=this.rotation?a.setAttribute("transform","rotate("+this.rotation+","+(this.bounds.x+this.bounds.width/2)+","+(this.bounds.y+this.bounds.height/2)+") "+c):b?a.setAttribute("transform",c):a.removeAttribute("transform")};
mxShape.prototype.reconfigure=function(){this.dialect==mxConstants.DIALECT_SVG?(null!=this.innerNode?this.configureSvgShape(this.innerNode):this.configureSvgShape(this.node),null!=this.insertGradientNode&&(this.insertGradient(this.insertGradientNode),this.insertGradientNode=null)):(mxUtils.isVml(this.node)?(this.node.style.visibility="hidden",this.configureVmlShape(this.node)):(this.node.style.visibility="hidden",this.configureHtmlShape(this.node)),this.node.style.visibility="visible")};
mxShape.prototype.redraw=function(){this.updateBoundingBox();this.dialect==mxConstants.DIALECT_SVG?this.redrawSvg():mxUtils.isVml(this.node)?(this.node.style.visibility="hidden",this.redrawVml(),this.node.style.visibility="visible"):this.redrawHtml()};
mxShape.prototype.updateBoundingBox=function(){if(null!=this.bounds){var a=this.createBoundingBox();this.augmentBoundingBox(a);var b=Number(mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,0));0!=b&&(a=mxUtils.getBoundingBox(a,b));a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.width=Math.ceil(a.width);a.height=Math.ceil(a.height);this.boundingBox=a}};mxShape.prototype.createBoundingBox=function(){return this.bounds.clone()};
mxShape.prototype.augmentBoundingBox=function(a){this.isShadow&&(a.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),a.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale));var b=Math.ceil(this.strokewidth*this.scale);a.grow(Math.ceil(b/2))};
mxShape.prototype.redrawSvg=function(){null!=this.innerNode?(this.updateSvgShape(this.innerNode),null!=this.shadowNode&&this.updateSvgShape(this.shadowNode)):(this.updateSvgShape(this.node),null!=this.shadowNode&&this.shadowNode.setAttribute("transform",this.getSvgShadowTransform()));this.updateSvgGlassPane()};
mxShape.prototype.updateVmlGlassPane=function(){if(null!=this.bounds&&"group"==this.node.nodeName&&null!=this.style&&1==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,0)){if(null==this.node.glassOverlay){this.node.glassOverlay=document.createElement("v:shape");this.node.glassOverlay.setAttribute("filled","true");this.node.glassOverlay.setAttribute("fillcolor","white");this.node.glassOverlay.setAttribute("stroked","false");var a=document.createElement("v:fill");a.setAttribute("type","gradient");
a.setAttribute("color","white");a.setAttribute("color2","white");a.setAttribute("opacity","90%");a.setAttribute("o:opacity2","15%");a.setAttribute("angle","180");this.node.glassOverlay.appendChild(a);this.node.appendChild(this.node.glassOverlay)}var a=this.bounds,b=Math.ceil(this.strokewidth*this.scale/2+1),b="m "+-b+" "+-b+" l "+-b+" "+Math.round(0.4*a.height)+" c "+Math.round(0.3*a.width)+" "+Math.round(0.6*a.height)+" "+Math.round(0.7*a.width)+" "+Math.round(0.6*a.height)+" "+Math.round(a.width+
b)+" "+Math.round(0.4*a.height)+" l "+Math.round(a.width+b)+" "+-b+" x e";this.node.glassOverlay.style.position="absolute";this.node.glassOverlay.style.width=a.width+"px";this.node.glassOverlay.style.height=a.height+"px";this.node.glassOverlay.setAttribute("coordsize",Math.round(this.bounds.width)+","+Math.round(this.bounds.height));this.node.glassOverlay.setAttribute("path",b)}else null!=this.node.glassOverlay&&(this.node.glassOverlay.parentNode.removeChild(this.node.glassOverlay),this.node.glassOverlay=
null)};
mxShape.prototype.updateSvgGlassPane=function(){if("g"==this.node.nodeName&&null!=this.style&&1==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,0)){if(null==this.node.glassOverlay){if(null==this.node.ownerSVGElement.glassGradient){var a=document.createElementNS(mxConstants.NS_SVG,"linearGradient");a.setAttribute("x1","0%");a.setAttribute("y1","0%");a.setAttribute("x2","0%");a.setAttribute("y2","100%");var b=document.createElementNS(mxConstants.NS_SVG,"stop");b.setAttribute("offset","0%");b.setAttribute("style",
"stop-color:#ffffff;stop-opacity:0.9");a.appendChild(b);b=document.createElementNS(mxConstants.NS_SVG,"stop");b.setAttribute("offset","100%");b.setAttribute("style","stop-color:#ffffff;stop-opacity:0.1");a.appendChild(b);for(b=0;null!=document.getElementById("mx-glass-gradient-"+b);)b++;a.setAttribute("id","mx-glass-gradient-"+b);this.node.ownerSVGElement.appendChild(a);this.node.ownerSVGElement.glassGradient=a}this.node.glassOverlay=document.createElementNS(mxConstants.NS_SVG,"path");this.node.glassOverlay.setAttribute("style",
"fill:url(#"+this.node.ownerSVGElement.glassGradient.getAttribute("id")+");");this.node.appendChild(this.node.glassOverlay)}a=this.bounds;b=Math.ceil(this.strokewidth*this.scale/2);this.node.glassOverlay.setAttribute("d","m "+(a.x-b)+","+(a.y-b)+" L "+(a.x-b)+","+(a.y+0.4*a.height)+" Q "+(a.x+0.5*a.width)+","+(a.y+0.7*a.height)+" "+(a.x+a.width+b)+","+(a.y+0.4*a.height)+" L "+(a.x+a.width+b)+","+(a.y-b)+" z")}else null!=this.node.glassOverlay&&(this.node.glassOverlay.parentNode.removeChild(this.node.glassOverlay),
this.node.glassOverlay=null)};mxShape.prototype.redrawVml=function(){this.node.style.visibility="hidden";this.updateVmlShape(this.node);this.updateVmlGlassPane();this.node.style.visibility="visible"};mxShape.prototype.redrawHtml=function(){this.updateHtmlShape(this.node)};mxShape.prototype.getRotation=function(){var a=this.rotation||0;null!=this.direction&&("north"==this.direction?a+=270:"west"==this.direction?a+=180:"south"==this.direction&&(a+=90));return a};
mxShape.prototype.createPath=function(a){var b=this.bounds.x,c=this.bounds.y,d=this.bounds.width,e=this.bounds.height,f=0;if("north"==this.direction||"south"==this.direction)var f=(d-e)/2,b=b+f,c=c+(e-d)/2,g=d,d=e,e=g;var h=this.getRotation(),g=null;if(this.dialect==mxConstants.DIALECT_SVG){if(g=new mxPath("svg"),g.setTranslate(b,c),0!=h){var f=this.bounds.getCenterX(),k=this.bounds.getCenterY(),h="rotate("+h+" "+f+" "+k+")";null!=this.innerNode&&this.innerNode.setAttribute("transform",h);null!=this.foreground&&
this.foreground.setAttribute("transform",h);null!=this.shadowNode&&this.shadowNode.setAttribute("transform",this.getSvgShadowTransform()+" "+h)}}else g=new mxPath("vml"),g.setTranslate(f,-f),g.scale=this.vmlScale,0!=h&&(this.node.style.rotation=h);this.redrawPath(g,b,c,d,e,a);return g.getPath()};mxShape.prototype.redrawPath=function(){};function mxStencil(a){this.desc=a;this.parseDescription();this.parseConstraints()}mxStencil.defaultLocalized=!1;mxStencil.prototype.desc=null;
mxStencil.prototype.constraints=null;mxStencil.prototype.aspect=null;mxStencil.prototype.w0=null;mxStencil.prototype.h0=null;mxStencil.prototype.bgNode=null;mxStencil.prototype.fgNode=null;mxStencil.prototype.strokewidth=null;
mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0];this.bgNode=this.desc.getElementsByTagName("background")[0];this.w0=Number(this.desc.getAttribute("w")||100);this.h0=Number(this.desc.getAttribute("h")||100);var a=this.desc.getAttribute("aspect");this.aspect=null!=a?a:"variable";a=this.desc.getAttribute("strokewidth");this.strokewidth=null!=a?a:"1"};
mxStencil.prototype.parseConstraints=function(){var a=this.desc.getElementsByTagName("connections")[0];if(null!=a&&(a=mxUtils.getChildNodes(a),null!=a&&0<a.length)){this.constraints=[];for(var b=0;b<a.length;b++)this.constraints.push(this.parseConstraint(a[b]))}};mxStencil.prototype.parseConstraint=function(a){var b=Number(a.getAttribute("x")),c=Number(a.getAttribute("y")),a="1"==a.getAttribute("perimeter");return new mxConnectionConstraint(new mxPoint(b,c),a)};
mxStencil.prototype.evaluateTextAttribute=function(a,b,c){b=this.evaluateAttribute(a,b,c);a=a.getAttribute("localized");if(mxStencil.defaultLocalized&&null==a||"1"==a)b=mxResources.get(b);return b};mxStencil.prototype.evaluateAttribute=function(a,b,c){b=a.getAttribute(b);null==b&&(a=mxUtils.getTextContent(a),null!=a&&(a=mxUtils.eval(a),"function"==typeof a&&(b=a(c))));return b};
mxStencil.prototype.renderDom=function(a,b,c,d){var e=a.dialect!=mxConstants.DIALECT_SVG,f=8==document.documentMode?1:a.vmlScale,g=a.rotation||0,h=!1,k=a.style[mxConstants.STYLE_STENCIL_FLIPH],l=a.style[mxConstants.STYLE_STENCIL_FLIPV];if(k?!l:l)g*=-1;null!=a.direction&&("north"==a.direction?g+=270:"west"==a.direction?g+=180:"south"==a.direction&&(g+=90),h="north"==a.direction||"south"==a.direction);k&&l&&(g+=180,l=k=!1);var n="";if(e)k?c.style.flip="x":l&&(c.style.flip="y"),0!=g&&(c.style.rotation=
g);else{if(k||l){var o=1,p=1,r=0,s=0;k&&(o=-1,r=-b.width-2*b.x);l&&(p=-1,s=-b.height-2*b.y);n="scale("+o+" "+p+") translate("+r+" "+s+")"}0!=g&&(k=b.getCenterX(),l=b.getCenterY(),n+=" rotate("+g+" "+k+" "+l+")")}var u=null==d;if(null!=this.bgNode||null!=this.fgNode){var w=e&&null==d?0:b.x,v=e&&null==d?0:b.y,o=b.width/this.w0,p=b.height/this.h0;this.lastMoveY=this.lastMoveX=0;h&&(p=b.width/this.h0,o=b.height/this.w0,g=(b.width-b.height)/2,w+=g,v-=g);"fixed"==this.aspect&&(o=p=Math.min(o,p),h?(w+=(b.height-
this.w0*o)/2,v+=(b.width-this.h0*p)/2):(w+=(b.width-this.w0*o)/2,v+=(b.height-this.h0*p)/2));e&&(o*=f,p*=f,w*=f,v*=f);var x=Math.min(o,p),B=[],z=null!=d?d:{fillColorAssigned:!1,fill:a.fill,stroke:a.stroke,strokeWidth:"inherit"==this.strokewidth?Number(a.strokewidth)*a.scale:Number(this.strokewidth)*x/(e?f:1),dashed:a.isDashed,dashpattern:[3,3],alpha:a.opacity||1,linejoin:"miter",fontColor:"#000000",fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0},A=null,
J=null,y=function(b,c){var d=Math.max(1,c.strokeWidth);if(e){b.strokeweight=Math.round(d)+"px";if(null!=c.fill){var d=!c.fillColorAssigned?a.gradient:null,f=document.createElement("v:fill");a.updateVmlFill(f,c.fill,d,a.gradientDirection,100*c.alpha);b.appendChild(f)}else b.filled="false";null!=c.stroke?(b.stroked="true",b.strokecolor=c.stroke):b.stroked="false";b.style.position="absolute"}else b.setAttribute("stroke-width",d),1!=c.alpha&&b.setAttribute("opacity",c.alpha),null!=c.fill&&c.fillColorAssigned&&
b.setAttribute("fill",c.fill),null!=c.stroke&&b.setAttribute("stroke",c.stroke)},D=function(a){null!=A&&null!=J&&J.push(a)},E=function(a){return e?Math.round(a):a},C=function(d){var g=d.nodeName,h="fill"==g,k="stroke"==g,l="fillstroke"==g;if("save"==g)B.push(z),z=mxUtils.clone(z);else if("restore"==g)z=B.pop();else if("path"==g){J=[];e?(A=document.createElement("v:shape"),y.call(this,A,z),l=Math.round(b.width)*f,g=Math.round(b.height)*f,A.style.width=l+"px",A.style.height=g+"px",A.coordsize=l+","+
g):(A=document.createElementNS(mxConstants.NS_SVG,"path"),y.call(this,A,z),0<n.length&&A.setAttribute("transform",n),"1"==d.getAttribute("crisp")&&A.setAttribute("shape-rendering","crispEdges"));for(d=d.firstChild;null!=d;)d.nodeType==mxConstants.NODETYPE_ELEMENT&&C.call(this,d),d=d.nextSibling;e?(D("e"),A.path=J.join("")):A.setAttribute("d",J.join(""))}else if("move"==g)h=e?"m":"M",this.lastMoveX=E(w+Number(d.getAttribute("x"))*o),this.lastMoveY=E(v+Number(d.getAttribute("y"))*p),D(h+" "+this.lastMoveX+
" "+this.lastMoveY);else if("line"==g)h=e?"l":"L",this.lastMoveX=E(w+Number(d.getAttribute("x"))*o),this.lastMoveY=E(v+Number(d.getAttribute("y"))*p),D(h+" "+this.lastMoveX+" "+this.lastMoveY);else if("quad"==g)if(e){var h=this.lastMoveX,s=this.lastMoveY,k=w+Number(d.getAttribute("x1"))*o,g=v+Number(d.getAttribute("y1"))*p,l=w+Number(d.getAttribute("x2"))*o,d=v+Number(d.getAttribute("y2"))*p,s=s+2/3*(g-s),r=l+2/3*(k-l),g=d+2/3*(g-d);D("c "+Math.round(h+2/3*(k-h))+" "+Math.round(s)+" "+Math.round(r)+
" "+Math.round(g)+" "+Math.round(l)+" "+Math.round(d));this.lastMoveX=l;this.lastMoveY=d}else this.lastMoveX=w+Number(d.getAttribute("x2"))*o,this.lastMoveY=v+Number(d.getAttribute("y2"))*p,D("Q "+(w+Number(d.getAttribute("x1"))*o)+" "+(v+Number(d.getAttribute("y1"))*p)+" "+this.lastMoveX+" "+this.lastMoveY);else if("curve"==g)h=e?"c":"C",this.lastMoveX=E(w+Number(d.getAttribute("x3"))*o),this.lastMoveY=E(v+Number(d.getAttribute("y3"))*p),D(h+" "+E(w+Number(d.getAttribute("x1"))*o)+" "+E(v+Number(d.getAttribute("y1"))*
p)+" "+E(w+Number(d.getAttribute("x2"))*o)+" "+E(v+Number(d.getAttribute("y2"))*p)+" "+this.lastMoveX+" "+this.lastMoveY);else if("close"==g)D(e?"x":"Z");else if("rect"==g||"roundrect"==g)s="roundrect"==g,k=E(w+Number(d.getAttribute("x"))*o),h=E(v+Number(d.getAttribute("y"))*p),l=E(Number(d.getAttribute("w"))*o),g=E(Number(d.getAttribute("h"))*p),r=d.getAttribute("arcsize"),0==r&&(r=100*mxConstants.RECTANGLE_ROUNDING_FACTOR),e?(A=document.createElement(s?"v:roundrect":"v:rect"),A.style.left=k+"px",
A.style.top=h+"px",A.style.width=l+"px",A.style.height=g+"px",s&&A.setAttribute("arcsize",""+r+"%")):(A=document.createElementNS(mxConstants.NS_SVG,"rect"),A.setAttribute("x",k),A.setAttribute("y",h),A.setAttribute("width",l),A.setAttribute("height",g),s&&(h=Number(r)/100,h=Math.min(l*h,g*h),A.setAttribute("rx",h),A.setAttribute("ry",h)),0<n.length&&A.setAttribute("transform",n),"1"==d.getAttribute("crisp")&&A.setAttribute("shape-rendering","crispEdges")),y.call(this,A,z);else if("ellipse"==g)k=E(w+
Number(d.getAttribute("x"))*o),h=E(v+Number(d.getAttribute("y"))*p),l=E(Number(d.getAttribute("w"))*o),g=E(Number(d.getAttribute("h"))*p),e?(A=document.createElement("v:arc"),A.startangle="0",A.endangle="360",A.style.left=k+"px",A.style.top=h+"px",A.style.width=l+"px",A.style.height=g+"px"):(A=document.createElementNS(mxConstants.NS_SVG,"ellipse"),A.setAttribute("cx",k+l/2),A.setAttribute("cy",h+g/2),A.setAttribute("rx",l/2),A.setAttribute("ry",g/2),0<n.length&&A.setAttribute("transform",n)),y.call(this,
A,z);else if("arc"==g){var l=Number(d.getAttribute("rx"))*o,g=Number(d.getAttribute("ry"))*p,s=Number(d.getAttribute("x-axis-rotation")),r=Number(d.getAttribute("large-arc-flag")),O=Number(d.getAttribute("sweep-flag")),k=w+Number(d.getAttribute("x"))*o,h=v+Number(d.getAttribute("y"))*p;if(e){h=mxUtils.arcToCurves(this.lastMoveX,this.lastMoveY,l,g,s,r,O,k,h);for(d=0;d<h.length;d+=6)D("c "+Math.round(h[d])+" "+Math.round(h[d+1])+" "+Math.round(h[d+2])+" "+Math.round(h[d+3])+" "+Math.round(h[d+4])+" "+
Math.round(h[d+5])),this.lastMoveX=h[d+4],this.lastMoveY=h[d+5]}else D("A "+l+","+g+" "+s+" "+r+","+O+" "+k+","+h),this.lastMoveX=w+k,this.lastMoveY=v+h}else if("image"==g){if(s=this.evaluateAttribute(d,"src",a.state),null!=s){k=E(w+Number(d.getAttribute("x"))*o);h=E(v+Number(d.getAttribute("y"))*p);l=E(Number(d.getAttribute("w"))*o);g=E(Number(d.getAttribute("h"))*p);r="1"==d.getAttribute("flipH");O="1"==d.getAttribute("flipV");if(e)A=document.createElement("v:image"),A.style.filter="alpha(opacity="+
z.alpha+")",A.style.left=k+"px",A.style.top=h+"px",A.style.width=l+"px",A.style.height=g+"px",A.src=s,r&&O?A.style.rotation="180":r?A.style.flip="x":O&&(A.style.flip="y");else if(A=document.createElementNS(mxConstants.NS_SVG,"image"),A.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",s),A.setAttribute("opacity",z.alpha/100),A.setAttribute("x",k),A.setAttribute("y",h),A.setAttribute("width",l),A.setAttribute("height",g),A.setAttribute("preserveAspectRatio","none"),r||O){var Q=1,K=1,s=d=0;r&&(Q=-1,
d=-l-2*k);O&&(K=-1,s=-g-2*h);A.setAttribute("transform",n+"scale("+Q+" "+K+") translate("+d+" "+s+") ")}else A.setAttribute("transform",n);c.appendChild(A)}}else if("include-shape"==g)s=mxStencilRegistry.getStencil(d.getAttribute("name")),null!=s&&(k=w+Number(d.getAttribute("x"))*o,h=v+Number(d.getAttribute("y"))*p,l=Number(d.getAttribute("w"))*o,g=Number(d.getAttribute("h"))*p,s.renderDom(a,new mxRectangle(k,h,l,g),c,z));else if("text"==g)l=this.evaluateTextAttribute(d,"str",a.state),null!=l&&(k=
E(w+Number(d.getAttribute("x"))*o),h=E(v+Number(d.getAttribute("y"))*p),g=d.getAttribute("align")||"left",s=d.getAttribute("valign")||"top",e?(A=document.createElement("v:shape"),A.style.position="absolute",A.style.width="1px",A.style.height="1px",A.style.left=k+"px",A.style.top=h+"px",d=document.createElement("v:fill"),d.color=z.fontColor,d.on="true",A.appendChild(d),d=document.createElement("v:stroke"),d.on="false",A.appendChild(d),d=document.createElement("v:path"),d.textpathok="true",d.v="m "+
k+" "+h+" l "+(k+1)+" "+h,A.appendChild(d),d=document.createElement("v:textpath"),d.style.cssText="v-text-align:"+g,d.style.fontSize=Math.round(z.fontSize/f)+"px",d.style.fontFamily=z.fontFamily,d.string=l,d.on="true",(z.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(d.style.fontWeight="bold"),(z.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(d.style.fontStyle="italic"),(z.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(d.style.textDecoration="underline"),
"top"==s?A.style.top=h+z.fontSize/2+"px":"bottom"==s&&(A.style.top=h-z.fontSize/3+"px"),A.appendChild(d)):(A=document.createElementNS(mxConstants.NS_SVG,"text"),A.setAttribute("fill",z.fontColor),A.setAttribute("font-family",z.fontFamily),A.setAttribute("font-size",z.fontSize),A.setAttribute("stroke","none"),A.setAttribute("x",k),A.appendChild(document.createTextNode(l)),(z.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&A.setAttribute("font-weight","bold"),(z.fontStyle&mxConstants.FONT_ITALIC)==
mxConstants.FONT_ITALIC&&A.setAttribute("font-style","italic"),(z.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&A.setAttribute("text-decoration",uline),"left"==g?g="start":"center"==g?g="middle":"right"==g&&(g="end"),A.setAttribute("text-anchor",g),"top"==s?(A.setAttribute("y",h+z.fontSize/5),A.setAttribute("dy","1ex")):"middle"==s?(A.setAttribute("y",h+z.fontSize/8),A.setAttribute("dy","0.5ex")):A.setAttribute("y",h),0<n.length&&A.setAttribute("transform",n)),c.appendChild(A));
else if(h||k||l){if(null!=A){g=null;if(z.dashed){g=e?x:Number(A.getAttribute("stroke-width"));s=[];for(d=0;d<z.dashpattern.length;d++)s.push(Math.max(1,Math.round(Number(z.dashpattern[d])*g)));g=s.join(" ")}if(k||l)e?(d=document.createElement("v:stroke"),d.endcap=z.linecap||"flat",d.joinstyle=z.linejoin||"miter",d.miterlimit=z.miterlimit||"10",A.appendChild(d),null!=g&&(d.dashstyle=g)):(null!=z.linejoin&&A.setAttribute("stroke-linejoin",z.linejoin),null!=z.linecap&&(d=z.linecap,"flat"==d&&(d="butt"),
A.setAttribute("stroke-linecap",d)),null!=z.miterlimit&&A.setAttribute("stroke-miterlimit",z.miterlimit),null!=g&&A.setAttribute("stroke-dasharray",g));u&&a.isShadow&&(d=mxConstants.SHADOW_OFFSET_X*a.scale,s=mxConstants.SHADOW_OFFSET_Y*a.scale,e?(r=document.createElement("v:shadow"),r.setAttribute("on","true"),r.setAttribute("color",mxConstants.SHADOWCOLOR),r.setAttribute("offset",Math.round(d)+"px,"+Math.round(s)+"px"),r.setAttribute("opacity",100*mxConstants.SHADOW_OPACITY+"%"),d=document.createElement("v:stroke"),
d.endcap=z.linecap||"flat",d.joinstyle=z.linejoin||"miter",d.miterlimit=z.miterlimit||"10",null!=g&&(d.dashstyle=g),r.appendChild(d),A.appendChild(r)):(r=A.cloneNode(!0),r.setAttribute("stroke",mxConstants.SHADOWCOLOR),null!=z.fill&&(h||l)?r.setAttribute("fill",mxConstants.SHADOWCOLOR):r.setAttribute("fill","none"),r.setAttribute("transform","translate("+d+" "+s+") "+(r.getAttribute("transform")||"")),r.setAttribute("opacity",mxConstants.SHADOW_OPACITY),c.appendChild(r)));h?e?A.stroked="false":A.setAttribute("stroke",
"none"):k&&(e?A.filled="false":A.setAttribute("fill","none"));c.appendChild(A)}u&&(u=!1)}else"linecap"==g?z.linecap=d.getAttribute("cap"):"linejoin"==g?z.linejoin=d.getAttribute("join"):"miterlimit"==g?z.miterlimit=d.getAttribute("limit"):"dashed"==g?z.dashed="1"==d.getAttribute("dashed"):"dashpattern"==g?(d=d.getAttribute("pattern"),null!=d&&0<d.length&&(z.dashpattern=d.split(" "))):"strokewidth"==g?(z.strokeWidth=d.getAttribute("width")*x,e&&(z.strokeWidth/=f)):"strokecolor"==g?z.stroke=d.getAttribute("color"):
"fillcolor"==g?(z.fill=d.getAttribute("color"),z.fillColorAssigned=!0):"alpha"==g?z.alpha=Number(d.getAttribute("alpha")):"fontcolor"==g?z.fontColor=d.getAttribute("color"):"fontsize"==g?z.fontSize=Number(d.getAttribute("size"))*x:"fontfamily"==g?z.fontFamily=d.getAttribute("family"):"fontstyle"==g&&(z.fontStyle=Number(d.getAttribute("style")))};e||(d=document.createElementNS(mxConstants.NS_SVG,"rect"),d.setAttribute("x",b.x),d.setAttribute("y",b.y),d.setAttribute("width",b.width),d.setAttribute("height",
b.height),d.setAttribute("fill","none"),d.setAttribute("stroke","none"),c.appendChild(d));if(null!=this.bgNode)for(d=this.bgNode.firstChild;null!=d;)d.nodeType==mxConstants.NODETYPE_ELEMENT&&C.call(this,d),d=d.nextSibling;else u=!1;if(null!=this.fgNode)for(d=this.fgNode.firstChild;null!=d;)d.nodeType==mxConstants.NODETYPE_ELEMENT&&C.call(this,d),d=d.nextSibling}};
mxStencil.prototype.drawShape=function(a,b,c,d){d=d?this.bgNode:this.fgNode;if(null!=d){var e=mxUtils.getValue(b.style,mxConstants.STYLE_DIRECTION,null),c=this.computeAspect(b,c,e),e=Math.min(c.width,c.height),e="inherit"==this.strokewidth?Number(mxUtils.getNumber(b.style,mxConstants.STYLE_STROKEWIDTH,1))*b.view.scale:Number(this.strokewidth)*e;this.lastMoveY=this.lastMoveX=0;a.setStrokeWidth(e);for(d=d.firstChild;null!=d;)d.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(a,b,d,c),d=d.nextSibling;
return!0}return!1};mxStencil.prototype.computeAspect=function(a,b,c){var a=b.x,d=b.y,e=b.width/this.w0,f=b.height/this.h0;if(c="north"==c||"south"==c)var f=b.width/this.h0,e=b.height/this.w0,g=(b.width-b.height)/2,a=a+g,d=d-g;"fixed"==this.aspect&&(e=f=Math.min(e,f),c?(a+=(b.height-this.w0*e)/2,d+=(b.width-this.h0*f)/2):(a+=(b.width-this.w0*e)/2,d+=(b.height-this.h0*f)/2));return new mxRectangle(a,d,e,f)};
mxStencil.prototype.drawNode=function(a,b,c,d){var e=c.nodeName,f=d.x,g=d.y,h=d.width,k=d.height,l=Math.min(h,k);if("save"==e)a.save();else if("restore"==e)a.restore();else if("path"==e){a.begin();for(c=c.firstChild;null!=c;)c.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(a,b,c,d),c=c.nextSibling}else if("close"==e)a.close();else if("move"==e)this.lastMoveX=f+Number(c.getAttribute("x"))*h,this.lastMoveY=g+Number(c.getAttribute("y"))*k,a.moveTo(this.lastMoveX,this.lastMoveY);else if("line"==
e)this.lastMoveX=f+Number(c.getAttribute("x"))*h,this.lastMoveY=g+Number(c.getAttribute("y"))*k,a.lineTo(this.lastMoveX,this.lastMoveY);else if("quad"==e)this.lastMoveX=f+Number(c.getAttribute("x2"))*h,this.lastMoveY=g+Number(c.getAttribute("y2"))*k,a.quadTo(f+Number(c.getAttribute("x1"))*h,g+Number(c.getAttribute("y1"))*k,this.lastMoveX,this.lastMoveY);else if("curve"==e)this.lastMoveX=f+Number(c.getAttribute("x3"))*h,this.lastMoveY=g+Number(c.getAttribute("y3"))*k,a.curveTo(f+Number(c.getAttribute("x1"))*
h,g+Number(c.getAttribute("y1"))*k,f+Number(c.getAttribute("x2"))*h,g+Number(c.getAttribute("y2"))*k,this.lastMoveX,this.lastMoveY);else if("arc"==e)for(var b=Number(c.getAttribute("rx"))*h,l=Number(c.getAttribute("ry"))*k,d=Number(c.getAttribute("x-axis-rotation")),e=Number(c.getAttribute("large-arc-flag")),n=Number(c.getAttribute("sweep-flag")),f=f+Number(c.getAttribute("x"))*h,g=g+Number(c.getAttribute("y"))*k,c=mxUtils.arcToCurves(this.lastMoveX,this.lastMoveY,b,l,d,e,n,f,g),h=0;h<c.length;h+=
6)a.curveTo(c[h],c[h+1],c[h+2],c[h+3],c[h+4],c[h+5]),this.lastMoveX=c[h+4],this.lastMoveY=c[h+5];else if("rect"==e)a.rect(f+Number(c.getAttribute("x"))*h,g+Number(c.getAttribute("y"))*k,Number(c.getAttribute("w"))*h,Number(c.getAttribute("h"))*k);else if("roundrect"==e)b=c.getAttribute("arcsize"),0==b&&(b=100*mxConstants.RECTANGLE_ROUNDING_FACTOR),l=Number(c.getAttribute("w"))*h,d=Number(c.getAttribute("h"))*k,b=Number(b)/100,b=Math.min(l*b,d*b),a.roundrect(f+Number(c.getAttribute("x"))*h,g+Number(c.getAttribute("y"))*
k,l,d,b,b);else if("ellipse"==e)a.ellipse(f+Number(c.getAttribute("x"))*h,g+Number(c.getAttribute("y"))*k,Number(c.getAttribute("w"))*h,Number(c.getAttribute("h"))*k);else if("image"==e)b=this.evaluateAttribute(c,"src",b),a.image(f+Number(c.getAttribute("x"))*h,g+Number(c.getAttribute("y"))*k,Number(c.getAttribute("w"))*h,Number(c.getAttribute("h"))*k,b,!1,"1"==c.getAttribute("flipH"),"1"==c.getAttribute("flipV"));else if("text"==e)b=this.evaluateTextAttribute(c,"str",b),a.text(f+Number(c.getAttribute("x"))*
h,g+Number(c.getAttribute("y"))*k,0,0,b,c.getAttribute("align"),c.getAttribute("valign"),c.getAttribute("vertical"));else if("include-shape"==e)e=mxStencilRegistry.getStencil(c.getAttribute("name")),null!=e&&(f+=Number(c.getAttribute("x"))*h,g+=Number(c.getAttribute("y"))*k,l=Number(c.getAttribute("w"))*h,d=Number(c.getAttribute("h"))*k,c=new mxRectangle(f,g,l,d),e.drawShape(a,b,c,!0),e.drawShape(a,b,c,!1));else if("fillstroke"==e)a.fillAndStroke();else if("fill"==e)a.fill();else if("stroke"==e)a.stroke();
else if("strokewidth"==e)a.setStrokeWidth(Number(c.getAttribute("width"))*l);else if("dashed"==e)a.setDashed("1"==c.getAttribute("dashed"));else if("dashpattern"==e){if(c=c.getAttribute("pattern"),null!=c){c=c.split(" ");k=[];for(h=0;h<c.length;h++)0<c[h].length&&k.push(Number(c[h])*l);c=k.join(" ");a.setDashPattern(c)}}else"strokecolor"==e?a.setStrokeColor(c.getAttribute("color")):"linecap"==e?a.setLineCap(c.getAttribute("cap")):"linejoin"==e?a.setLineJoin(c.getAttribute("join")):"miterlimit"==e?
a.setMiterLimit(Number(c.getAttribute("limit"))):"fillcolor"==e?a.setFillColor(c.getAttribute("color")):"alpha"==e?a.setAlpha(c.getAttribute("alpha")):"fontcolor"==e?a.setFontColor(c.getAttribute("color")):"fontstyle"==e?a.setFontStyle(c.getAttribute("style")):"fontfamily"==e?a.setFontFamily(c.getAttribute("family")):"fontsize"==e&&a.setFontSize(Number(c.getAttribute("size"))*l)};var mxStencilRegistry={stencils:[],addStencil:function(a,b){mxStencilRegistry.stencils[a]=b},getStencil:function(a){return mxStencilRegistry.stencils[a]}};
function mxStencilShape(a){this.stencil=a}mxStencilShape.prototype=new mxShape;mxStencilShape.prototype.constructor=mxStencilShape;mxStencilShape.prototype.mixedModeHtml=!1;mxStencilShape.prototype.preferModeHtml=!1;mxStencilShape.prototype.stencil=null;mxStencilShape.prototype.state=null;mxStencilShape.prototype.vmlScale=4;mxStencilShape.prototype.apply=function(a){this.state=a;mxShape.prototype.apply.apply(this,arguments)};
mxStencilShape.prototype.createSvg=function(){var a=document.createElementNS(mxConstants.NS_SVG,"g");this.configureSvgShape(a);return a};mxStencilShape.prototype.configureHtmlShape=function(a){mxShape.prototype.configureHtmlShape.apply(this,arguments);mxUtils.isVml(a)||(a.style.overflow="visible")};mxStencilShape.prototype.createVml=function(){var a=document.createElement(8==document.documentMode?"div":"v:group");this.configureTransparentBackground(a);a.style.position="absolute";return a};
mxStencilShape.prototype.configureVmlShape=function(){};mxStencilShape.prototype.redraw=function(){this.updateBoundingBox();this.dialect==mxConstants.DIALECT_SVG?this.redrawShape():(this.node.style.visibility="hidden",this.redrawShape(),this.node.style.visibility="visible")};
mxStencilShape.prototype.redrawShape=function(){if(this.dialect!=mxConstants.DIALECT_SVG){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";var a=Math.round(this.bounds.width),b=Math.round(this.bounds.height);this.node.style.width=a+"px";this.node.style.height=b+"px";var c=this.node;"DIV"==this.node.nodeName?(c=document.createElement("v:group"),c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.style.width=a+"px",c.style.height=
b+"px"):c.innerHTML="";if(mxUtils.isVml(c)){var d=8!=document.documentMode?this.vmlScale:1;c.coordsize=a*d+","+b*d}this.stencil.renderDom(this,this.bounds,c);this.node!=c&&(this.node.innerHTML=c.outerHTML)}else{for(;null!=this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.stencil.renderDom(this,this.bounds,this.node)}};
var mxMarker={markers:[],paintMarker:function(a,b,c,d,e,f,g,h,k,l,n,o){var p=mxMarker.markers[b],r=null;if(null!=p){var r=mxUtils.isVml(a),s=d.x-c.x,c=d.y-c.y;if(isNaN(s)||isNaN(c))return;var u=Math.max(1,Math.sqrt(s*s+c*c)),s=s*h/u,c=c*h/u,d=d.clone();r&&(d.x-=k,d.y-=l);k=!0;0==o[n?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL]&&(k=!1);r?(a.strokecolor=e,k?a.fillcolor=e:a.filled="false"):(a.setAttribute("stroke",e),n=null!=o.opacity?o.opacity/100:1,a.setAttribute("stroke-opacity",n),k?(a.setAttribute("fill",
e),a.setAttribute("fill-opacity",n)):a.setAttribute("fill","none"));r=p.call(this,a,b,d,s,c,f,g,h,r)}return r}};
(function(){var a=function(a,c,d,e,f,g,h,k,l){var n=1.118*e*g,o=1.118*f*g;d.x-=n;d.y-=o;e*=h+g;f*=h+g;l?(a.path="m"+Math.round(d.x)+","+Math.round(d.y)+" l"+Math.round(d.x-e-f/2)+" "+Math.round(d.y-f+e/2)+(c!=mxConstants.ARROW_CLASSIC?"":" "+Math.round(d.x-3*e/4)+" "+Math.round(d.y-3*f/4))+" "+Math.round(d.x+f/2-e)+" "+Math.round(d.y-f-e/2)+" x e",a.setAttribute("strokeweight",g*k+"px")):(a.setAttribute("d","M "+d.x+" "+d.y+" L "+(d.x-e-f/2)+" "+(d.y-f+e/2)+(c!=mxConstants.ARROW_CLASSIC?"":" L "+
(d.x-3*e/4)+" "+(d.y-3*f/4))+" L "+(d.x+f/2-e)+" "+(d.y-f-e/2)+" z"),a.setAttribute("stroke-width",g*k));a=c!=mxConstants.ARROW_CLASSIC?1:0.75;return new mxPoint(-e*a-n,-f*a-o)};mxMarker.markers[mxConstants.ARROW_CLASSIC]=a;mxMarker.markers[mxConstants.ARROW_BLOCK]=a})();
mxMarker.markers[mxConstants.ARROW_OPEN]=function(a,b,c,d,e,f,g,h,k){var b=1.118*d*f,l=1.118*e*f;c.x-=b;c.y-=l;d*=g+f;e*=g+f;k?(a.path="m"+Math.round(c.x-d-e/2)+" "+Math.round(c.y-e+d/2)+" l"+Math.round(c.x)+" "+Math.round(c.y)+" "+Math.round(c.x+e/2-d)+" "+Math.round(c.y-e-d/2)+" e nf",a.setAttribute("strokeweight",f*h+"px")):(a.setAttribute("d","M "+(c.x-d-e/2)+" "+(c.y-e+d/2)+" L "+c.x+" "+c.y+" L "+(c.x+e/2-d)+" "+(c.y-e-d/2)),a.setAttribute("stroke-width",f*h),a.setAttribute("fill","none"));
return new mxPoint(2*-b,2*-l)};
mxMarker.markers[mxConstants.ARROW_OVAL]=function(a,b,c,d,e,f,g,h,k){d=d*g*(0.5+f/2);e=e*g*(0.5+f/2);b=g*h;g=b/2;k?(a.path="m"+Math.round(c.x+g)+" "+Math.round(c.y)+" at "+Math.round(c.x-g)+" "+Math.round(c.y-g)+" "+Math.round(c.x+g)+" "+Math.round(c.y+g)+" "+Math.round(c.x+g)+" "+Math.round(c.y)+" "+Math.round(c.x+g)+" "+Math.round(c.y)+" x e",a.setAttribute("strokeweight",f*h+"px")):(a.setAttribute("d","M "+(c.x-g)+" "+c.y+" a "+g+" "+g+" 0  1,1 "+b+" 0 a "+g+" "+g+" 0  1,1 "+-b+" 0 z"),a.setAttribute("stroke-width",
f*h));return new mxPoint(-d/(2+f),-e/(2+f))};
(function(){var a=function(a,c,d,e,f,g,h,k,l){var n=c==mxConstants.ARROW_DIAMOND?0.7071:0.9862,o=e*g*n,n=f*g*n,e=e*(h+g),f=f*(h+g);d.x-=o+e/2;d.y-=n+f/2;c=c==mxConstants.ARROW_DIAMOND?2:3.4;l?(a.path="m"+Math.round(d.x+e/2)+" "+Math.round(d.y+f/2)+" l"+Math.round(d.x-f/c)+" "+Math.round(d.y+e/c)+" "+Math.round(d.x-e/2)+" "+Math.round(d.y-f/2)+" "+Math.round(d.x+f/c)+" "+Math.round(d.y-e/c)+" x e",a.setAttribute("strokeweight",g*k+"px")):(a.setAttribute("d","M "+(d.x+e/2)+" "+(d.y+f/2)+" L "+(d.x-
f/c)+" "+(d.y+e/c)+" L "+(d.x-e/2)+" "+(d.y-f/2)+" L "+(d.x+f/c)+" "+(d.y-e/c)+" z"),a.setAttribute("stroke-width",g*k));return new mxPoint(-o-e,-n-f)};mxMarker.markers[mxConstants.ARROW_DIAMOND]=a;mxMarker.markers[mxConstants.ARROW_DIAMOND_THIN]=a})();function mxActor(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxActor.prototype=new mxShape;mxActor.prototype.constructor=mxActor;mxActor.prototype.mixedModeHtml=!1;mxActor.prototype.preferModeHtml=!1;
mxActor.prototype.vmlScale=2;mxActor.prototype.createVml=function(){var a=document.createElement("v:shape");a.style.position="absolute";this.configureVmlShape(a);return a};mxActor.prototype.redrawVml=function(){this.updateVmlShape(this.node);this.node.path=this.createPath()};mxActor.prototype.createSvg=function(){return this.createSvgGroup("path")};
mxActor.prototype.redrawSvg=function(){var a=Math.round(Math.max(1,this.strokewidth*this.scale));this.innerNode.setAttribute("stroke-width",a);this.innerNode.setAttribute("stroke-linejoin","round");this.crisp&&(null==this.rotation||0==this.rotation)?this.innerNode.setAttribute("shape-rendering","crispEdges"):this.innerNode.removeAttribute("shape-rendering");var b=this.createPath();0<b.length?(this.innerNode.setAttribute("d",b),null!=this.shadowNode&&(this.shadowNode.setAttribute("transform",this.getSvgShadowTransform()+
(this.innerNode.getAttribute("transform")||"")),this.shadowNode.setAttribute("stroke-width",a),this.shadowNode.setAttribute("d",b))):(this.innerNode.removeAttribute("d"),null!=this.shadowNode&&this.shadowNode.removeAttribute("d"));this.isDashed&&(a=Math.max(1,Math.round(3*this.scale*this.strokewidth)),this.innerNode.setAttribute("stroke-dasharray",a+" "+a))};
mxActor.prototype.redrawPath=function(a,b,c,d,e){b=d/3;a.moveTo(0,e);a.curveTo(0,3*e/5,0,2*e/5,d/2,2*e/5);a.curveTo(d/2-b,2*e/5,d/2-b,0,d/2,0);a.curveTo(d/2+b,0,d/2+b,2*e/5,d/2,2*e/5);a.curveTo(d,2*e/5,d,3*e/5,d,e);a.close()};function mxCloud(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxCloud.prototype=new mxActor;mxCloud.prototype.constructor=mxActor;
mxCloud.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0.25*d,0.25*e);a.curveTo(0.05*d,0.25*e,0,0.5*e,0.16*d,0.55*e);a.curveTo(0,0.66*e,0.18*d,0.9*e,0.31*d,0.8*e);a.curveTo(0.4*d,e,0.7*d,e,0.8*d,0.8*e);a.curveTo(d,0.8*e,d,0.6*e,0.875*d,0.5*e);a.curveTo(d,0.3*e,0.8*d,0.1*e,0.625*d,0.2*e);a.curveTo(0.5*d,0.05*e,0.3*d,0.05*e,0.25*d,0.25*e);a.close()};function mxRectangleShape(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxRectangleShape.prototype=new mxShape;
mxRectangleShape.prototype.constructor=mxRectangleShape;mxRectangleShape.prototype.createVml=function(){var a=document.createElement(this.isRounded?"v:roundrect":"v:rect");this.configureVmlShape(a);return a};mxRectangleShape.prototype.createSvg=function(){return this.createSvgGroup("rect")};function mxEllipse(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxEllipse.prototype=new mxShape;mxEllipse.prototype.constructor=mxEllipse;mxEllipse.prototype.mixedModeHtml=!1;
mxEllipse.prototype.preferModeHtml=!1;mxEllipse.prototype.createVml=function(){var a=document.createElement("v:arc");a.startangle="0";a.endangle="360";this.configureVmlShape(a);return a};mxEllipse.prototype.createSvg=function(){return this.createSvgGroup("ellipse")};mxEllipse.prototype.redrawSvg=function(){this.crisp?this.innerNode.setAttribute("shape-rendering","crispEdges"):this.innerNode.removeAttribute("shape-rendering");this.updateSvgNode(this.innerNode);this.updateSvgNode(this.shadowNode)};
mxEllipse.prototype.updateSvgNode=function(a){if(null!=a){var b=Math.round(Math.max(1,this.strokewidth*this.scale));a.setAttribute("stroke-width",b);a.setAttribute("cx",this.bounds.x+this.bounds.width/2);a.setAttribute("cy",this.bounds.y+this.bounds.height/2);a.setAttribute("rx",this.bounds.width/2);a.setAttribute("ry",this.bounds.height/2);null!=this.shadowNode&&this.shadowNode.setAttribute("transform",this.getSvgShadowTransform());this.isDashed&&(b=Math.max(1,Math.round(3*this.scale*this.strokewidth)),
a.setAttribute("stroke-dasharray",b+" "+b))}};function mxDoubleEllipse(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxDoubleEllipse.prototype=new mxShape;mxDoubleEllipse.prototype.constructor=mxDoubleEllipse;mxDoubleEllipse.prototype.vmlNodes=mxDoubleEllipse.prototype.vmlNodes.concat(["background","foreground"]);mxDoubleEllipse.prototype.mixedModeHtml=!1;mxDoubleEllipse.prototype.preferModeHtml=!1;mxDoubleEllipse.prototype.vmlScale=2;
mxDoubleEllipse.prototype.createVml=function(){var a=document.createElement("v:group");this.background=document.createElement("v:arc");this.background.startangle="0";this.background.endangle="360";this.configureVmlShape(this.background);a.appendChild(this.background);this.label=this.background;this.isShadow=!1;this.fill=null;this.foreground=document.createElement("v:oval");this.configureVmlShape(this.foreground);a.appendChild(this.foreground);this.stroke=null;this.configureVmlShape(a);return a};
mxDoubleEllipse.prototype.redrawVml=function(){this.updateVmlShape(this.node);this.updateVmlShape(this.background);this.updateVmlShape(this.foreground);var a=Math.round((this.strokewidth+3)*this.scale)*this.vmlScale,b=Math.round(this.bounds.width*this.vmlScale),c=Math.round(this.bounds.height*this.vmlScale);this.foreground.style.top=a+"px";this.foreground.style.left=a+"px";this.foreground.style.width=Math.max(0,b-2*a)+"px";this.foreground.style.height=Math.max(0,c-2*a)+"px"};
mxDoubleEllipse.prototype.createSvg=function(){var a=this.createSvgGroup("ellipse");this.foreground=document.createElementNS(mxConstants.NS_SVG,"ellipse");null!=this.stroke?this.foreground.setAttribute("stroke",this.stroke):this.foreground.setAttribute("stroke","none");mxClient.IS_NS&&!mxClient.IS_GC&&!mxClient.IS_SF?this.foreground.setAttribute("fill","transparent"):this.foreground.setAttribute("fill","none");a.appendChild(this.foreground);return a};
mxDoubleEllipse.prototype.redrawSvg=function(){this.crisp?(this.innerNode.setAttribute("shape-rendering","crispEdges"),this.foreground.setAttribute("shape-rendering","crispEdges")):(this.innerNode.removeAttribute("shape-rendering"),this.foreground.removeAttribute("shape-rendering"));this.updateSvgNode(this.innerNode);this.updateSvgNode(this.shadowNode);this.updateSvgNode(this.foreground,(this.strokewidth+3)*this.scale);if(this.isDashed){var a=Math.max(1,Math.round(3*this.scale*this.strokewidth));
this.innerNode.setAttribute("stroke-dasharray",a+" "+a)}};
mxDoubleEllipse.prototype.updateSvgNode=function(a,b){b=null!=b?b:0;if(null!=a){var c=Math.round(Math.max(1,this.strokewidth*this.scale));a.setAttribute("stroke-width",c);a.setAttribute("cx",this.bounds.x+this.bounds.width/2);a.setAttribute("cy",this.bounds.y+this.bounds.height/2);a.setAttribute("rx",Math.max(0,this.bounds.width/2-b));a.setAttribute("ry",Math.max(0,this.bounds.height/2-b));null!=this.shadowNode&&this.shadowNode.setAttribute("transform",this.getSvgShadowTransform())}};
function mxRhombus(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxRhombus.prototype=new mxShape;mxRhombus.prototype.constructor=mxRhombus;mxRhombus.prototype.mixedModeHtml=!1;mxRhombus.prototype.preferModeHtml=!1;mxRhombus.prototype.createHtml=function(){var a=document.createElement("DIV");this.configureHtmlShape(a);return a};mxRhombus.prototype.createVml=function(){var a=document.createElement("v:shape");this.configureVmlShape(a);return a};
mxRhombus.prototype.createSvg=function(){return this.createSvgGroup("path")};mxRhombus.prototype.redrawVml=function(){this.updateVmlShape(this.node);var a=Math.round(this.bounds.width),b=Math.round(this.bounds.height);this.node.path="m "+Math.round(0+a/2)+" 0 l "+(0+a)+" "+Math.round(0+b/2)+" l "+Math.round(0+a/2)+" "+(0+b)+" l 0 "+Math.round(0+b/2)+" x e"};mxRhombus.prototype.redrawHtml=function(){this.updateHtmlShape(this.node)};
mxRhombus.prototype.redrawSvg=function(){this.updateSvgNode(this.innerNode);null!=this.shadowNode&&this.updateSvgNode(this.shadowNode)};
mxRhombus.prototype.updateSvgNode=function(a){var b=Math.round(Math.max(1,this.strokewidth*this.scale));a.setAttribute("stroke-width",b);var b=this.bounds.x,c=this.bounds.y,d=this.bounds.width,e=this.bounds.height,b="M "+Math.round(b+d/2)+" "+Math.round(c)+" L "+Math.round(b+d)+" "+Math.round(c+e/2)+" L "+Math.round(b+d/2)+" "+Math.round(c+e)+" L "+Math.round(b)+" "+Math.round(c+e/2)+" Z ";a.setAttribute("d",b);this.updateSvgTransform(a,a==this.shadowNode);this.isDashed&&(b=Math.max(1,Math.round(3*
this.scale*this.strokewidth)),a.setAttribute("stroke-dasharray",b+" "+b))};function mxPolyline(a,b,c){this.points=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxPolyline.prototype=new mxShape;mxPolyline.prototype.constructor=mxPolyline;mxPolyline.prototype.addPipe=!0;
mxPolyline.prototype.create=function(){var a=null;if(this.dialect==mxConstants.DIALECT_SVG)a=this.createSvg();else if(this.dialect==mxConstants.DIALECT_STRICTHTML||this.dialect==mxConstants.DIALECT_PREFERHTML&&null!=this.points&&0<this.points.length)a=document.createElement("DIV"),this.configureHtmlShape(a),a.style.borderStyle="",a.style.background="";else{a=document.createElement("v:shape");this.configureVmlShape(a);var b=document.createElement("v:stroke");null!=this.opacity&&(b.opacity=this.opacity+
"%");a.appendChild(b)}return a};mxPolyline.prototype.redrawVml=function(){if(null!=this.points&&0<this.points.length&&null!=this.points[0]){this.bounds=new mxRectangle(this.points[0].x,this.points[0].y,0,0);for(var a=1;a<this.points.length;a++)this.bounds.add(new mxRectangle(this.points[a].x,this.points[a].y,0,0))}mxShape.prototype.redrawVml.apply(this,arguments)};
mxPolyline.prototype.createSvg=function(){var a=this.createSvgGroup("path");this.addPipe&&(this.pipe=this.createSvgPipe(),a.appendChild(this.pipe));return a};mxPolyline.prototype.redrawSvg=function(){this.updateSvgShape(this.innerNode);var a=this.innerNode.getAttribute("d");null!=a&&null!=this.pipe&&(this.pipe.setAttribute("d",a),this.pipe.setAttribute("stroke-width",Math.round(Math.max(1,this.strokewidth*this.scale))+mxShape.prototype.SVG_STROKE_TOLERANCE))};
function mxArrow(a,b,c,d,e,f,g){this.points=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1;this.arrowWidth=null!=e?e:mxConstants.ARROW_WIDTH;this.spacing=null!=f?f:mxConstants.ARROW_SPACING;this.endSize=null!=g?g:mxConstants.ARROW_SIZE}mxArrow.prototype=new mxActor;mxArrow.prototype.constructor=mxArrow;mxArrow.prototype.addPipe=!1;mxArrow.prototype.enableFill=!0;mxArrow.prototype.configureTransparentBackground=function(){};
mxArrow.prototype.augmentBoundingBox=function(a){a.grow(Math.max(this.arrowWidth/2,this.endSize/2)*this.scale);mxShape.prototype.augmentBoundingBox.apply(this,arguments)};mxArrow.prototype.createVml=function(){this.enableFill||(this.fill=null);return mxActor.prototype.createVml.apply(this,arguments)};
mxArrow.prototype.createSvg=function(){this.enableFill||(this.fill=null);var a=mxActor.prototype.createSvg.apply(this,arguments);this.addPipe&&(this.pipe=this.createSvgPipe(),a.appendChild(this.pipe));return a};mxArrow.prototype.reconfigure=function(){this.enableFill||(this.fill=null);mxActor.prototype.reconfigure.apply(this,arguments)};
mxArrow.prototype.redrawSvg=function(){mxActor.prototype.redrawSvg.apply(this,arguments);null!=this.pipe&&null!=this.innerNode.getAttribute("d")&&(this.pipe.setAttribute("d",this.innerNode.getAttribute("d")),this.pipe.setAttribute("stroke-width",Math.round(this.strokewidth*this.scale)+mxShape.prototype.SVG_STROKE_TOLERANCE))};
mxArrow.prototype.redrawPath=function(a,b,c){a.translate.x-=b;a.translate.y-=c;var b=this.spacing*this.scale,d=this.arrowWidth*this.scale,e=this.endSize*this.scale,f=this.points[0],c=this.points[this.points.length-1],g=c.x-f.x,h=c.y-f.y,k=Math.sqrt(g*g+h*h),l=k-2*b-e,g=g/k,h=h/k,k=d*h/3,d=-d*g/3,e=f.x-k/2+b*g,f=f.y-d/2+b*h,n=e+k,o=f+d,p=n+l*g,l=o+l*h,r=p+k,s=l+d,u=r-3*k,w=s-3*d;a.moveTo(e,f);a.lineTo(n,o);a.lineTo(p,l);a.lineTo(r,s);a.lineTo(c.x-b*g,c.y-b*h);a.lineTo(u,w);a.lineTo(u+k,w+d);a.lineTo(e,
f);a.close()};
function mxText(a,b,c,d,e,f,g,h,k,l,n,o,p,r,s,u,w,v,x,B){this.value=a;this.bounds=b;this.color=null!=e?e:"black";this.align=null!=c?c:"";this.valign=null!=d?d:"";this.family=null!=f?f:mxConstants.DEFAULT_FONTFAMILY;this.size=null!=g?g:mxConstants.DEFAULT_FONTSIZE;this.fontStyle=null!=h?h:0;this.spacing=parseInt(k||2);this.spacingTop=this.spacing+parseInt(l||0);this.spacingRight=this.spacing+parseInt(n||0);this.spacingBottom=this.spacing+parseInt(o||0);this.spacingLeft=this.spacing+parseInt(p||0);
this.horizontal=null!=r?r:!0;this.background=s;this.border=u;this.wrap=null!=w?w:!1;this.clipped=null!=v?v:!1;this.overflow=null!=x?x:"visible";this.labelPadding=null!=B?B:0}mxText.prototype=new mxShape;mxText.prototype.constructor=mxText;mxText.prototype.replaceLinefeeds=!0;mxText.prototype.ieVerticalFilter="progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";mxText.prototype.verticalTextDegree=-90;mxText.prototype.forceIgnoreStringSize=!1;
mxText.prototype.isStyleSet=function(a){return(this.fontStyle&a)==a};mxText.prototype.create=function(a){var b=null;return b=this.dialect==mxConstants.DIALECT_SVG?this.createSvg():this.dialect==mxConstants.DIALECT_STRICTHTML||this.dialect==mxConstants.DIALECT_PREFERHTML||!mxUtils.isVml(a)?mxClient.IS_SVG&&!mxClient.NO_FO?this.createForeignObject():this.createHtml():this.createVml()};mxText.prototype.updateBoundingBox=function(){};
mxText.prototype.createForeignObject=function(){var a=document.createElementNS(mxConstants.NS_SVG,"g"),b=document.createElementNS(mxConstants.NS_SVG,"foreignObject");b.setAttribute("pointer-events","fill");b.style.overflow="hidden"==this.overflow?"hidden":"visible";var c=document.createElement("div");c.style.margin="0px";c.style.height="100%";b.appendChild(c);a.appendChild(b);return a};mxText.prototype.createHtml=function(){var a=this.createHtmlTable();a.style.position="absolute";return a};
mxText.prototype.createVml=function(){return document.createElement("v:textbox")};mxText.prototype.redrawHtml=function(){this.redrawVml()};
mxText.prototype.getOffset=function(a,b,c,d,e){var f=(e=null!=e?e:this.horizontal)?this.align:this.valign,g=e?this.valign:this.align,h=c-a,k=d-b;f==mxConstants.ALIGN_CENTER||f==mxConstants.ALIGN_MIDDLE?h=Math.round(h/2):f==mxConstants.ALIGN_LEFT||f===mxConstants.ALIGN_TOP?h=e?0:(c-d)/2:e||(h=(c+d)/2-a);g==mxConstants.ALIGN_MIDDLE||g==mxConstants.ALIGN_CENTER?k=Math.round(k/2):g==mxConstants.ALIGN_TOP||g==mxConstants.ALIGN_LEFT?k=e?0:(d+c)/2-b:e||(k=(d-c)/2);return new mxPoint(h,k)};
mxText.prototype.getSpacing=function(a){var a=null!=a?a:this.horizontal,b=0,c=0,b=this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight:this.spacingLeft,c=this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom:this.spacingTop;return a?new mxPoint(b,c):new mxPoint(c,b)};
mxText.prototype.createHtmlTable=function(){var a=document.createElement("table");a.style.borderCollapse="collapse";var b=document.createElement("tbody"),c=document.createElement("tr"),d=document.createElement("td");9<=document.documentMode&&(d.style.height="100%");c.appendChild(d);b.appendChild(c);a.appendChild(b);return a};
mxText.prototype.updateHtmlTable=function(a,b){var b=null!=b?b:1,c=a.firstChild.firstChild.firstChild;this.wrap&&(a.style.width="");mxUtils.isNode(this.value)?c.firstChild!=this.value&&(null!=c.firstChild&&c.removeChild(c.firstChild),c.appendChild(this.value)):this.lastValue!=this.value&&(c.innerHTML=this.replaceLinefeeds?this.value.replace(/\n/g,"<br/>"):this.value,this.lastValue=this.value);var d=Math.round(this.size*b);a.style.visibility=0>=d?"hidden":"";a.style.fontSize=d+"px";a.style.color=this.color;
a.style.fontFamily=this.family;a.style.fontWeight=this.isStyleSet(mxConstants.FONT_BOLD)?"bold":"normal";a.style.fontStyle=this.isStyleSet(mxConstants.FONT_ITALIC)?"italic":"";a.style.textDecoration=this.isStyleSet(mxConstants.FONT_UNDERLINE)?"underline":"";mxClient.IS_IE&&(this.isStyleSet(mxConstants.FONT_SHADOW)?c.style.filter="Shadow(Color=#666666,Direction=135,Strength=%)":c.style.removeAttribute("filter"));c.style.textAlign=this.align==mxConstants.ALIGN_RIGHT?"right":this.align==mxConstants.ALIGN_CENTER?
"center":"left";c.style.verticalAlign=this.valign==mxConstants.ALIGN_BOTTOM?"bottom":this.valign==mxConstants.ALIGN_MIDDLE?"middle":"top";c.style.background=0<this.value.length&&null!=this.background?this.background:"";c.style.padding=this.labelPadding+"px";0<this.value.length&&null!=this.border?(a.style.borderColor=this.border,a.style.borderWidth="1px",a.style.borderStyle="solid"):a.style.borderStyle="none"};mxText.prototype.getTableSize=function(a){return new mxRectangle(0,0,a.offsetWidth,a.offsetHeight)};
mxText.prototype.updateTableWidth=function(a){var b=a.firstChild.firstChild.firstChild;if(this.wrap&&0<this.bounds.width&&this.dialect!=mxConstants.DIALECT_SVG){b.style.whiteSpace="nowrap";var c=this.getTableSize(a),c=Math.min(c.width,(this.horizontal||mxUtils.isVml(this.node)?this.bounds.width:this.bounds.height)/this.scale);mxClient.IS_OP&&(c*=this.scale);a.style.width=Math.round(c)+"px";b.style.whiteSpace="normal"}else a.style.width="";b.style.whiteSpace=this.wrap?"normal":"nowrap"};
mxText.prototype.redrawVml=function(){"g"==this.node.nodeName?this.redrawForeignObject():mxUtils.isVml(this.node)?this.redrawTextbox():this.redrawHtmlTable()};
mxText.prototype.redrawTextbox=function(){var a=this.node;null==a.firstChild&&a.appendChild(this.createHtmlTable());var b=a.firstChild;this.updateHtmlTable(b);this.updateTableWidth(b);null!=this.opacity&&mxUtils.setOpacity(b,this.opacity);b.style.filter="";a.inset="0px,0px,0px,0px";if("fill"!=this.overflow){var c=this.getTableSize(b),d=c.width*this.scale,c=c.height*this.scale,e=this.getOffset(this.bounds.width,this.bounds.height,d,c);this.horizontal||(b.style.filter=this.ieVerticalFilter);var f=this.getSpacing(),
b=this.bounds.x-e.x+f.x*this.scale,e=this.bounds.y-e.y+f.y*this.scale,g=this.bounds.x,f=this.bounds.y,h=this.bounds.width,k=this.bounds.height;if(this.horizontal){var l=Math.round(b-g),n=Math.round(e-f),o=Math.min(0,Math.round(g+h-b-d-1)),p=Math.min(0,Math.round(f+k-e-c-1));a.inset=l+"px,"+n+"px,"+o+"px,"+p+"px"}else p=o=n=l=0,this.align==mxConstants.ALIGN_CENTER?p=l=(k-d)/2:this.align==mxConstants.ALIGN_LEFT?l=k-d:p=k-d,this.valign==mxConstants.ALIGN_MIDDLE?o=n=(h-c)/2:this.valign==mxConstants.ALIGN_BOTTOM?
n=h-c:o=h-c,a.inset=n+"px,"+l+"px,"+o+"px,"+p+"px";a.style.zoom=this.scale;this.clipped&&0<this.bounds.width&&0<this.bounds.height?(this.boundingBox=this.bounds.clone(),d=Math.round(g-b),c=Math.round(f-e),a.style.clip="rect("+c/this.scale+" "+(d+this.bounds.width)/this.scale+" "+(c+this.bounds.height)/this.scale+" "+d/this.scale+")"):this.boundingBox=new mxRectangle(b,e,d,c)}else this.boundingBox=this.bounds.clone()};
mxText.prototype.redrawHtmlTable=function(){if(!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)){var a=this.node,b=a.firstChild.firstChild.firstChild,c=!1,d=1;mxClient.IS_IE?a.style.removeAttribute("filter"):mxClient.IS_SF||mxClient.IS_GC?a.style.WebkitTransform="":mxClient.IS_MT?(a.style.MozTransform="",b.style.MozTransform=""):(mxClient.IS_OT&&(a.style.OTransform=""),d=this.scale,c=!0);b.style.zoom="";this.updateHtmlTable(a,d);this.updateTableWidth(a);
null!=this.opacity&&mxUtils.setOpacity(a,this.opacity);a.style.left="";a.style.top="";a.style.height="";var e=parseFloat(b.style.zoom)||1,d=this.bounds.width,f=this.bounds.height;if(!this.forceIgnoreStringSize&&!("fill"==this.overflow||this.align==mxConstants.ALIGN_LEFT&&null==this.background&&null==this.border))f=this.getTableSize(a),d=f.width/e,f=f.height/e;var e=this.getOffset(this.bounds.width/this.scale,this.bounds.height/this.scale,d,f,c||this.horizontal),g=this.getSpacing(c||this.horizontal),
h=this.bounds.x/this.scale-e.x+g.x,k=this.bounds.y/this.scale-e.y+g.y,l=this.scale,g=1,n=0,o=0;this.horizontal||(mxClient.IS_IE&&mxClient.IS_SVG?a.style.msTransform="rotate("+this.verticalTextDegree+"deg)":mxClient.IS_IE?(a.style.filter=this.ieVerticalFilter,n=(d-f)/2,o=-n):mxClient.IS_SF||mxClient.IS_GC?a.style.WebkitTransform="rotate("+this.verticalTextDegree+"deg)":mxClient.IS_OT?a.style.OTransform="rotate("+this.verticalTextDegree+"deg)":mxClient.IS_MT&&(a.style.MozTransform="rotate("+this.verticalTextDegree+
"deg)",b.style.MozTransform="rotate(0deg)",g=1/this.scale,l=1));var p=!0;if(mxClient.IS_MT||c)mxClient.IS_MT?(a.style.MozTransform+=" scale("+this.scale+")",g=1/this.scale):mxClient.IS_OT&&(b.style.OTransform="scale("+this.scale+")",a.style.borderWidth=Math.round(this.scale*parseInt(a.style.borderWidth))+"px");else if(!c)if(9<=document.documentMode)b.style.msTransform="scale("+this.scale+")";else if(mxClient.IS_SF||mxClient.IS_GC)b.style.WebkitTransform="scale("+this.scale+")";else{b.style.zoom=this.scale;
""!=a.style.borderWidth&&8!=document.documentMode&&(a.style.borderWidth=Math.round(this.scale*parseInt(a.style.borderWidth))+"px");if(8==document.documentMode||!mxClient.IS_IE)l=1;p=!1}p&&(n=(this.scale-1)*d/(2*this.scale),o=(this.scale-1)*f/(2*this.scale),l=1);if("fill"!=this.overflow){h=new mxRectangle(Math.round((h+n)*this.scale),Math.round((k+o)*this.scale),Math.round(d*l),Math.round(f*l));a.style.left=h.x+"px";a.style.top=h.y+"px";a.style.width=h.width+"px";a.style.height=h.height+"px";if((null!=
this.background||null!=this.border)&&8<=document.documentMode)k=this.replaceLinefeeds?this.value.replace(/\n/g,"<br/>"):this.value,b.innerHTML='<div style="padding:'+this.labelPadding+"px;background:"+b.style.background+";border:"+a.style.border+'">'+k+"</div>",b.style.padding="0px",b.style.background="",a.style.border="";if(this.clipped&&0<this.bounds.width&&0<this.bounds.height)if(this.boundingBox=this.bounds.clone(),this.horizontal||c&&!mxClient.IS_OT)b=Math.max(0,e.x*l),c=Math.max(0,e.y*l),a.style.clip=
"rect("+c+"px "+(b+this.bounds.width*g)+"px "+(c+this.bounds.height*g)+"px "+b+"px)";else if(mxClient.IS_IE)e=this.bounds.width,g=this.bounds.height,c=b=0,this.align==mxConstants.ALIGN_LEFT?b=Math.max(0,d-g/this.scale)*this.scale:this.align==mxConstants.ALIGN_CENTER&&(b=Math.max(0,d-g/this.scale)*this.scale/2),this.valign==mxConstants.ALIGN_BOTTOM?c=Math.max(0,f-e/this.scale)*this.scale:this.valign==mxConstants.ALIGN_MIDDLE&&(c=Math.max(0,f-e/this.scale)*this.scale/2),a.style.clip="rect("+b+"px "+
(c+e-1)+"px "+(b+g-1)+"px "+c+"px)";else{e=this.bounds.width/this.scale;g=this.bounds.height/this.scale;mxClient.IS_OT&&(e=this.bounds.width,g=this.bounds.height);c=b=0;this.align==mxConstants.ALIGN_RIGHT?b=Math.max(0,d-g):this.align==mxConstants.ALIGN_CENTER&&(b=Math.max(0,d-g)/2);this.valign==mxConstants.ALIGN_BOTTOM?c=Math.max(0,f-e):this.valign==mxConstants.ALIGN_MIDDLE&&(c=Math.max(0,f-e)/2);if(mxClient.IS_GC||mxClient.IS_SF)b*=this.scale,c*=this.scale,e*=this.scale,g*=this.scale;a.style.clip=
"rect("+c+" "+(b+g)+" "+(c+e)+" "+b+")"}else this.boundingBox=h}else this.boundingBox=this.bounds.clone(),9<=document.documentMode||mxClient.IS_SVG?(a.style.left=Math.round(this.bounds.x+this.scale/2+n)+"px",a.style.top=Math.round(this.bounds.y+this.scale/2+o)+"px",a.style.width=Math.round((this.bounds.width-this.scale)/this.scale)+"px",a.style.height=Math.round((this.bounds.height-this.scale)/this.scale)+"px"):(l=8==document.documentMode?this.scale:1,a.style.left=Math.round(this.bounds.x+this.scale/
2)+"px",a.style.top=Math.round(this.bounds.y+this.scale/2)+"px",a.style.width=Math.round((this.bounds.width-this.scale)/l)+"px",a.style.height=Math.round((this.bounds.height-this.scale)/l)+"px")}};mxText.prototype.getVerticalOffset=function(a){return new mxPoint(a.y,-a.x)};
mxText.prototype.redrawForeignObject=function(){for(var a=this.node,b=a.firstChild;b==this.backgroundNode;)b=b.nextSibling;var c=b.firstChild;null==c.firstChild&&c.appendChild(this.createHtmlTable());var d=c.firstChild;this.updateHtmlTable(d);null!=this.opacity&&b.setAttribute("opacity",this.opacity/100);mxClient.IS_SF&&(d.style.borderStyle="none",d.firstChild.firstChild.firstChild.style.background="",null==this.backgroundNode&&(null!=this.background||null!=this.border)?(this.backgroundNode=document.createElementNS(mxConstants.NS_SVG,
"rect"),a.insertBefore(this.backgroundNode,a.firstChild)):null!=this.backgroundNode&&null==this.background&&null==this.border&&(this.backgroundNode.parentNode.removeChild(this.backgroundNode),this.backgroundNode=null),null!=this.backgroundNode&&(null!=this.background?this.backgroundNode.setAttribute("fill",this.background):this.backgroundNode.setAttribute("fill","none"),null!=this.border?this.backgroundNode.setAttribute("stroke",this.border):this.backgroundNode.setAttribute("stroke","none")));var e=
"";if("fill"!=this.overflow){b.removeAttribute("width");b.removeAttribute("height");b.style.width="";b.style.height="";b.style.clip="";(this.wrap||!mxClient.IS_GC&&!mxClient.IS_SF)&&document.body.appendChild(d);this.updateTableWidth(d);var f=this.getTableSize(d),g=f.width,f=f.height;d.parentNode!=c&&c.appendChild(d);var e=this.getSpacing(),h=this.bounds.x/this.scale+e.x,k=this.bounds.y/this.scale+e.y,d=this.bounds.width/this.scale,c=this.bounds.height/this.scale,l=this.getOffset(d,c,g,f);if(this.horizontal)h-=
l.x,k-=l.y,e="scale("+this.scale+")";else var e="scale("+this.scale+") rotate("+this.verticalTextDegree+" "+(h+g/2)+" "+(k+f/2)+")",n=this.getVerticalOffset(l),h=h+n.x,k=k+n.y;e+=" translate("+h+" "+k+")";null!=this.backgroundNode&&(this.backgroundNode.setAttribute("width",g),this.backgroundNode.setAttribute("height",f));b.setAttribute("width",g);b.setAttribute("height",f);this.clipped&&0<this.bounds.width&&0<this.bounds.height?(this.boundingBox=this.bounds.clone(),h=Math.max(0,l.x),l=Math.max(0,
l.y),this.horizontal?b.style.clip="rect("+l+"px,"+(h+d)+"px,"+(l+c)+"px,"+h+"px)":(l=h=0,this.align==mxConstants.ALIGN_RIGHT?h=Math.max(0,g-c):this.align==mxConstants.ALIGN_CENTER&&(h=Math.max(0,g-c)/2),this.valign==mxConstants.ALIGN_BOTTOM?l=Math.max(0,f-d):this.valign==mxConstants.ALIGN_MIDDLE&&(l=Math.max(0,f-d)/2),b.style.clip="rect("+l+"px,"+(h+c)+"px,"+(l+d)+"px,"+h+"px)"),null!=this.backgroundNode&&(h=this.bounds.x/this.scale,k=this.bounds.y/this.scale,this.horizontal||(h+=(f+g)/2-c,k+=(f-
g)/2,n=d,d=c,c=n),mxClient.IS_GC||(b=this.getSvgClip(this.node.ownerSVGElement,h,k,d,c),b!=this.clip&&(this.releaseSvgClip(),this.clip=b,b.refCount++),this.backgroundNode.setAttribute("clip-path","url(#"+b.getAttribute("id")+")")))):(this.releaseSvgClip(),null!=this.backgroundNode&&this.backgroundNode.removeAttribute("clip-path"),this.boundingBox=this.horizontal?new mxRectangle(h*this.scale,k*this.scale,g*this.scale,f*this.scale):new mxRectangle(h*this.scale,k*this.scale,f*this.scale,g*this.scale))}else this.boundingBox=
this.bounds.clone(),e=this.scale,g=this.bounds.width/e,f=this.bounds.height/e,b.setAttribute("width",g),b.setAttribute("height",f),d.style.width=g+"px",d.style.height=f+"px",null!=this.backgroundNode&&(this.backgroundNode.setAttribute("width",d.clientWidth),this.backgroundNode.setAttribute("height",d.offsetHeight)),e="scale("+e+") translate("+this.bounds.x/e+" "+this.bounds.y/e+")",this.wrap||(d.firstChild.firstChild.firstChild.style.whiteSpace="nowrap");a.setAttribute("transform",e)};
mxText.prototype.createSvg=function(){var a=document.createElementNS(mxConstants.NS_SVG,"g"),b=this.isStyleSet(mxConstants.FONT_UNDERLINE)?"underline":"none",c=this.isStyleSet(mxConstants.FONT_BOLD)?"bold":"normal",d=this.isStyleSet(mxConstants.FONT_ITALIC)?"italic":null;a.setAttribute("text-decoration",b);a.setAttribute("font-family",this.family);a.setAttribute("font-weight",c);a.setAttribute("font-size",Math.round(this.size*this.scale)+"px");a.setAttribute("fill",this.color);a.setAttribute("text-anchor",
this.align==mxConstants.ALIGN_RIGHT?"end":this.align==mxConstants.ALIGN_CENTER?"middle":"start");null!=d&&a.setAttribute("font-style",d);if(null!=this.background||null!=this.border)this.backgroundNode=document.createElementNS(mxConstants.NS_SVG,"rect"),this.backgroundNode.setAttribute("shape-rendering","crispEdges"),null!=this.background?this.backgroundNode.setAttribute("fill",this.background):this.backgroundNode.setAttribute("fill","none"),null!=this.border?this.backgroundNode.setAttribute("stroke",
this.border):this.backgroundNode.setAttribute("stroke","none");this.updateSvgValue(a);return a};
mxText.prototype.updateSvgValue=function(a){if(this.currentValue!=this.value){for(;null!=a.firstChild;)a.removeChild(a.firstChild);if(null!=this.value){var b=this.isStyleSet(mxConstants.FONT_UNDERLINE)?"underline":"none",c=this.value.split("\n");this.textNodes=Array(c.length);for(var d=0;d<c.length;d++)if(this.isEmptyString(c[d]))this.textNodes[d]=null;else{var e=this.createSvgSpan(c[d]);a.appendChild(e);this.textNodes[d]=e;e.setAttribute("text-decoration",b)}}this.currentValue=this.value}};
mxText.prototype.redrawSvg=function(){if("foreignObject"==this.node.nodeName)this.redrawHtml();else{var a=Math.round(this.size*this.scale);0>=a?this.node.setAttribute("visibility","hidden"):this.node.removeAttribute("visibility");this.updateSvgValue(this.node);this.node.setAttribute("font-size",a+"px");null!=this.opacity&&(this.node.setAttribute("fill-opacity",this.opacity/100),this.node.setAttribute("stroke-opacity",this.opacity/100));var b=this.value,c=this.createHtmlTable();this.lastValue=null;
this.value=mxUtils.htmlEntities(this.value,!1);this.updateHtmlTable(c);document.body.appendChild(c);var d=c.offsetWidth*this.scale,e=c.offsetHeight*this.scale;c.parentNode.removeChild(c);this.value=b;b=2*this.scale;this.align==mxConstants.ALIGN_CENTER?b+=d/2:this.align==mxConstants.ALIGN_RIGHT&&(b+=d);var c=Math.round(1.3*a),f=this.node.childNodes.length,g=null!=this.textNodes?this.textNodes.length:0;null!=this.backgroundNode&&f--;var f=this.bounds.x,h=this.bounds.y,f=f+(this.align==mxConstants.ALIGN_RIGHT?
(this.horizontal?this.bounds.width:this.bounds.height)-this.spacingRight*this.scale:this.align==mxConstants.ALIGN_CENTER?this.spacingLeft*this.scale+((this.horizontal?this.bounds.width:this.bounds.height)-this.spacingLeft*this.scale-this.spacingRight*this.scale)/2:this.spacingLeft*this.scale+1),h=h+(this.valign==mxConstants.ALIGN_BOTTOM?(this.horizontal?this.bounds.height:this.bounds.width)-(g-1)*c-this.spacingBottom*this.scale-4:this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop*this.scale+(this.horizontal?
this.bounds.height:this.bounds.width)-this.spacingBottom*this.scale-(g-1.5)*c)/2:this.spacingTop*this.scale+c);"fill"==this.overflow?(this.align==mxConstants.ALIGN_CENTER&&(f=Math.max(this.bounds.x+d/2,f)),h=Math.max(this.bounds.y+a,h),this.boundingBox=new mxRectangle(f-b,h-c,d+4*this.scale,e+1*this.scale),this.boundingBox.x=Math.min(this.bounds.x,this.boundingBox.x),this.boundingBox.y=Math.min(this.bounds.y,this.boundingBox.y),this.boundingBox.width=Math.max(this.bounds.width,this.boundingBox.width),
this.boundingBox.height=Math.max(this.bounds.height,this.boundingBox.height)):this.boundingBox=new mxRectangle(f-b,h-c,d+4*this.scale,e+1*this.scale);this.horizontal||this.node.setAttribute("transform","rotate("+this.verticalTextDegree+" "+(this.bounds.x+this.bounds.width/2)+" "+(this.bounds.y+this.bounds.height/2)+") translate("+-((this.bounds.height-this.bounds.width)/2)+" "+-((this.bounds.width-this.bounds.height)/2)+")");this.redrawSvgTextNodes(f,h,c);0<this.value.length&&null!=this.backgroundNode&&
null!=this.node.firstChild&&(this.node.firstChild!=this.backgroundNode&&this.node.insertBefore(this.backgroundNode,this.node.firstChild),this.backgroundNode.setAttribute("x",this.boundingBox.x+this.scale/2+1*this.scale),this.backgroundNode.setAttribute("y",this.boundingBox.y+this.scale/2+2*this.scale-this.labelPadding),this.backgroundNode.setAttribute("width",this.boundingBox.width-this.scale-2*this.scale),this.backgroundNode.setAttribute("height",this.boundingBox.height-this.scale),this.backgroundNode.setAttribute("stroke-width",
Math.round(Math.max(1,this.scale))));this.clipped&&0<this.bounds.width&&0<this.bounds.height?(this.boundingBox=this.bounds.clone(),this.horizontal||(this.boundingBox.width=this.bounds.height,this.boundingBox.height=this.bounds.width),f=this.bounds.x,h=this.bounds.y,this.horizontal?(d=this.bounds.width,e=this.bounds.height):(d=this.bounds.height,e=this.bounds.width),a=this.getSvgClip(this.node.ownerSVGElement,f,h,d,e),a!=this.clip&&(this.releaseSvgClip(),this.clip=a,a.refCount++),this.node.setAttribute("clip-path",
"url(#"+a.getAttribute("id")+")")):(this.releaseSvgClip(),this.node.removeAttribute("clip-path"))}};mxText.prototype.redrawSvgTextNodes=function(a,b,c){if(null!=this.textNodes)for(var d=0;d<this.textNodes.length;d++){var e=this.textNodes[d];null!=e&&(e.setAttribute("x",a),e.setAttribute("y",b),e.setAttribute("style","pointer-events: all"));b+=c}};
mxText.prototype.releaseSvgClip=function(){null!=this.clip&&(this.clip.refCount--,0==this.clip.refCount&&this.clip.parentNode.removeChild(this.clip),this.clip=null)};
mxText.prototype.getSvgClip=function(a,b,c,d,e){var b=Math.round(b),c=Math.round(c),d=Math.round(d),e=Math.round(e),f="mx-clip-"+b+"-"+c+"-"+d+"-"+e;if(null!=this.clip&&this.clip.ident==f)return this.clip;var g=0,h;for(h=document.getElementById(f+"-"+g);null!=h;){if(h.ownerSVGElement==a)return h;g++;h=f+"-"+g;h=document.getElementById(h)}if(null!=h)h=h.cloneNode(!0),g++;else{h=document.createElementNS(mxConstants.NS_SVG,"clipPath");var k=document.createElementNS(mxConstants.NS_SVG,"rect");k.setAttribute("x",
b);k.setAttribute("y",c);k.setAttribute("width",d);k.setAttribute("height",e);h.appendChild(k)}h.setAttribute("id",f+"-"+g);h.ident=f;a.appendChild(h);h.refCount=0;return h};mxText.prototype.isEmptyString=function(a){return 0==a.replace(/ /g,"").length};mxText.prototype.createSvgSpan=function(a){var b=document.createElementNS(mxConstants.NS_SVG,"text");mxUtils.write(b,a);return b};mxText.prototype.destroy=function(){this.releaseSvgClip();mxShape.prototype.destroy.apply(this,arguments)};
function mxTriangle(){}mxTriangle.prototype=new mxActor;mxTriangle.prototype.constructor=mxTriangle;mxTriangle.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0,0);a.lineTo(d,0.5*e);a.lineTo(0,e);a.close()};function mxHexagon(){}mxHexagon.prototype=new mxActor;mxHexagon.prototype.constructor=mxHexagon;mxHexagon.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0.25*d,0);a.lineTo(0.75*d,0);a.lineTo(d,0.5*e);a.lineTo(0.75*d,e);a.lineTo(0.25*d,e);a.lineTo(0,0.5*e);a.close()};
function mxLine(a,b,c){this.bounds=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxLine.prototype=new mxShape;mxLine.prototype.constructor=mxLine;mxLine.prototype.vmlNodes=mxLine.prototype.vmlNodes.concat(["label","innerNode"]);mxLine.prototype.mixedModeHtml=!1;mxLine.prototype.preferModeHtml=!1;mxLine.prototype.clone=function(){var a=new mxLine(this.bounds,this.stroke,this.strokewidth);a.isDashed=this.isDashed;return a};
mxLine.prototype.createVml=function(){var a=document.createElement("v:group");a.style.position="absolute";this.label=document.createElement("v:rect");this.label.style.position="absolute";this.label.stroked="false";this.label.filled="false";a.appendChild(this.label);this.innerNode=document.createElement("v:shape");this.configureVmlShape(this.innerNode);a.appendChild(this.innerNode);return a};
mxLine.prototype.reconfigure=function(){mxUtils.isVml(this.node)?this.configureVmlShape(this.innerNode):mxShape.prototype.reconfigure.apply(this,arguments)};
mxLine.prototype.redrawVml=function(){this.updateVmlShape(this.node);this.updateVmlShape(this.label);this.innerNode.coordsize=this.node.coordsize;this.innerNode.strokeweight=this.strokewidth*this.scale+"px";this.innerNode.style.width=this.node.style.width;this.innerNode.style.height=this.node.style.height;var a=this.bounds.width,b=this.bounds.height;this.innerNode.path=this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH?"m "+Math.round(a/2)+" 0 l "+Math.round(a/
2)+" "+Math.round(b)+" e":"m 0 "+Math.round(b/2)+" l "+Math.round(a)+" "+Math.round(b/2)+" e"};mxLine.prototype.createSvg=function(){var a=this.createSvgGroup("path");this.pipe=this.createSvgPipe();a.appendChild(this.pipe);return a};
mxLine.prototype.redrawSvg=function(){this.innerNode.setAttribute("stroke-width",Math.round(Math.max(1,this.strokewidth*this.scale)));if(null!=this.bounds){var a=this.bounds.x,b=this.bounds.y,c=this.bounds.width,d=this.bounds.height,e=null,e=this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH?"M "+Math.round(a+c/2)+" "+Math.round(b)+" L "+Math.round(a+c/2)+" "+Math.round(b+d):"M "+Math.round(a)+" "+Math.round(b+d/2)+" L "+Math.round(a+c)+" "+Math.round(b+d/2);
this.innerNode.setAttribute("d",e);this.pipe.setAttribute("d",e);this.pipe.setAttribute("stroke-width",this.strokewidth+mxShape.prototype.SVG_STROKE_TOLERANCE);this.updateSvgTransform(this.innerNode,!1);this.updateSvgTransform(this.pipe,!1);this.crisp?this.innerNode.setAttribute("shape-rendering","crispEdges"):this.innerNode.removeAttribute("shape-rendering");this.isDashed&&(a=Math.max(1,Math.round(3*this.scale*this.strokewidth)),this.innerNode.setAttribute("stroke-dasharray",a+" "+a))}};
function mxImageShape(a,b,c,d,e){this.bounds=a;this.image=null!=b?b:"";this.fill=c;this.stroke=d;this.strokewidth=null!=e?e:1;this.isShadow=!1}mxImageShape.prototype=new mxShape;mxImageShape.prototype.constructor=mxImageShape;mxImageShape.prototype.crisp=!1;mxImageShape.prototype.preserveImageAspect=!0;
mxImageShape.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);this.stroke=this.fill=null;null!=this.style&&(this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND),this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER),this.preserveImageAspect=1==mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1),this.gradient=null)};
mxImageShape.prototype.create=function(){var a=null;if(this.dialect==mxConstants.DIALECT_SVG){a=this.createSvgGroup("rect");this.innerNode.setAttribute("visibility","hidden");this.innerNode.setAttribute("pointer-events","fill");this.imageNode=document.createElementNS(mxConstants.NS_SVG,"image");this.imageNode.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",this.image);this.imageNode.setAttribute("style","pointer-events:none");this.configureSvgShape(this.imageNode);this.imageNode.removeAttribute("stroke");
this.imageNode.removeAttribute("fill");a.insertBefore(this.imageNode,this.innerNode);if(null!=this.fill&&this.fill!=mxConstants.NONE||null!=this.stroke&&this.stroke!=mxConstants.NONE)this.bg=document.createElementNS(mxConstants.NS_SVG,"rect"),a.insertBefore(this.bg,a.firstChild);this.preserveImageAspect||this.imageNode.setAttribute("preserveAspectRatio","none")}else{var a=1==mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_FLIPH,0),b=1==mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_FLIPV,
0),c=this.image.toUpperCase();mxClient.IS_IE&&!a&&!b&&"MHTML:"==c.substring(0,6)?(this.imageNode=document.createElement("DIV"),this.imageNode.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+this.image+"', sizingMethod='scale')",a=document.createElement("DIV"),this.configureHtmlShape(a)):!mxClient.IS_IE||"DATA:"==c.substring(0,5)||9<=document.documentMode?(this.imageNode=document.createElement("img"),this.imageNode.setAttribute("src",this.image),this.imageNode.setAttribute("border",
"0"),this.imageNode.style.position="absolute",this.imageNode.style.width="100%",this.imageNode.style.height="100%",a=document.createElement("DIV"),this.configureHtmlShape(a)):(this.imageNode=document.createElement("v:image"),this.imageNode.style.position="absolute",this.imageNode.src=this.image,a=document.createElement("DIV"),this.configureHtmlShape(a),a.style.overflow="visible");a.appendChild(this.imageNode)}return a};
mxImageShape.prototype.updateAspect=function(a,b){var c=Math.min(this.bounds.width/a,this.bounds.height/b),a=Math.max(0,Math.round(a*c)),b=Math.max(0,Math.round(b*c)),c=Math.max(0,Math.round((this.bounds.width-a)/2)),d=Math.max(0,Math.round((this.bounds.height-b)/2)),e=this.imageNode.style;this.imageNode.parentNode==this.node?(this.node.style.paddingLeft=c+"px",this.node.style.paddingTop=d+"px"):(e.left=Math.round(this.bounds.x)+c+"px",e.top=Math.round(this.bounds.y)+d+"px");e.width=a+"px";e.height=
b+"px"};mxImageShape.prototype.scheduleUpdateAspect=function(){var a=new Image;a.onload=mxUtils.bind(this,function(){mxImageShape.prototype.updateAspect.call(this,a.width,a.height)});a.src=this.image};
mxImageShape.prototype.redraw=function(){mxShape.prototype.redraw.apply(this,arguments);if(null!=this.imageNode&&null!=this.bounds){var a=1==mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_FLIPH,0),b=1==mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_FLIPV,0);if(this.dialect==mxConstants.DIALECT_SVG){var c=1,d=1,e=0,f=0;a&&(c=-1,e=-this.bounds.width-2*this.bounds.x);b&&(d=-1,f=-this.bounds.height-2*this.bounds.y);this.imageNode.setAttribute("transform",(this.imageNode.getAttribute("transform")||
"")+" scale("+c+" "+d+") translate("+e+" "+f+")")}else if("DIV"!=this.imageNode.nodeName&&(this.imageNode.style.width=Math.max(0,Math.round(this.bounds.width))+"px",this.imageNode.style.height=Math.max(0,Math.round(this.bounds.height))+"px"),this.preserveImageAspect&&this.scheduleUpdateAspect(),a||b)mxUtils.isVml(this.imageNode)?a&&b?this.imageNode.style.rotation="180":this.imageNode.style.flip=a?"x":"y":(c="DIV"==this.imageNode.nodeName?"progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+
this.image+"', sizingMethod='scale')":"",c=a&&b?c+"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":a?c+"progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":c+"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)",this.imageNode.style.filter!=c&&(this.imageNode.style.filter=c))}};mxImageShape.prototype.configureTransparentBackground=function(){};
mxImageShape.prototype.redrawSvg=function(){this.updateSvgShape(this.innerNode);this.updateSvgShape(this.imageNode);null!=this.bg&&(this.updateSvgShape(this.bg),null!=this.fill?this.bg.setAttribute("fill",this.fill):this.bg.setAttribute("fill","none"),null!=this.stroke?this.bg.setAttribute("stroke",this.stroke):this.bg.setAttribute("stroke","none"),this.bg.setAttribute("shape-rendering","crispEdges"))};
mxImageShape.prototype.configureSvgShape=function(a){mxShape.prototype.configureSvgShape.apply(this,arguments);null!=this.imageNode&&(null!=this.opacity?this.imageNode.setAttribute("opacity",this.opacity/100):this.imageNode.removeAttribute("opacity"))};function mxLabel(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxLabel.prototype=new mxShape;mxLabel.prototype.constructor=mxLabel;
mxLabel.prototype.vmlNodes=mxLabel.prototype.vmlNodes.concat(["label","imageNode","indicatorImageNode","rectNode"]);mxLabel.prototype.imageSize=mxConstants.DEFAULT_IMAGESIZE;mxLabel.prototype.spacing=2;mxLabel.prototype.indicatorSize=10;mxLabel.prototype.indicatorSpacing=2;mxLabel.prototype.opaqueVmlImages=!1;
mxLabel.prototype.init=function(a){mxShape.prototype.init.apply(this,arguments);null!=this.indicatorColor&&null!=this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.bounds=this.bounds,this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.init(this.node),this.indicatorShape=null)};
mxLabel.prototype.reconfigure=function(){mxShape.prototype.reconfigure.apply(this);null!=this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.reconfigure())};
mxLabel.prototype.createHtml=function(){var a=document.createElement("DIV");this.configureHtmlShape(a);null!=this.indicatorImage&&(this.indicatorImageNode=mxUtils.createImage(this.indicatorImage),this.indicatorImageNode.style.position="absolute",a.appendChild(this.indicatorImageNode));null!=this.image&&(this.imageNode=mxUtils.createImage(this.image),this.stroke=null,this.configureHtmlShape(this.imageNode),mxUtils.setOpacity(this.imageNode,"100"),a.appendChild(this.imageNode));return a};
mxLabel.prototype.createVml=function(){var a=document.createElement("v:group");this.rectNode=document.createElement(this.isRounded?"v:roundrect":"v:rect");this.configureVmlShape(this.rectNode);this.isShadow=!1;this.configureVmlShape(a);a.coordorigin="0,0";a.appendChild(this.rectNode);null!=this.indicatorImage&&(this.indicatorImageNode=this.createVmlImage(this.indicatorImage,this.opaqueVmlImages?null:this.opacity),a.appendChild(this.indicatorImageNode));null!=this.image&&(this.imageNode=this.createVmlImage(this.image,
this.opaqueVmlImages?null:this.opacity),a.appendChild(this.imageNode));this.label=document.createElement("v:rect");this.label.style.top="0px";this.label.style.left="0px";this.label.filled="false";this.label.stroked="false";a.appendChild(this.label);return a};
mxLabel.prototype.createVmlImage=function(a,b){var c=null;"data:"==a.substring(0,5)||null!=b?(c=document.createElement("img"),mxUtils.setOpacity(c,b),c.setAttribute("border","0"),c.style.position="absolute",c.setAttribute("src",a)):(c=document.createElement("v:image"),c.src=a);return c};
mxLabel.prototype.createSvg=function(){var a=this.createSvgGroup("rect");null!=this.indicatorImage&&(this.indicatorImageNode=document.createElementNS(mxConstants.NS_SVG,"image"),this.indicatorImageNode.setAttributeNS(mxConstants.NS_XLINK,"href",this.indicatorImage),a.appendChild(this.indicatorImageNode),null!=this.opacity&&this.indicatorImageNode.setAttribute("opacity",this.opacity/100));null!=this.image&&(this.imageNode=document.createElementNS(mxConstants.NS_SVG,"image"),this.imageNode.setAttributeNS(mxConstants.NS_XLINK,
"href",this.image),null!=this.opacity&&this.imageNode.setAttribute("opacity",this.opacity/100),this.imageNode.setAttribute("style","pointer-events:none"),this.configureSvgShape(this.imageNode),a.appendChild(this.imageNode));return a};
mxLabel.prototype.redraw=function(){this.updateBoundingBox();var a=this.dialect==mxConstants.DIALECT_SVG,b=mxUtils.isVml(this.node);a?(this.updateSvgShape(this.innerNode),null!=this.shadowNode&&this.updateSvgShape(this.shadowNode),this.updateSvgGlassPane()):b?(this.updateVmlShape(this.node),this.updateVmlShape(this.rectNode),this.label.style.width=this.node.style.width,this.label.style.height=this.node.style.height,this.updateVmlGlassPane()):this.updateHtmlShape(this.node);var c=b=0;null!=this.imageNode&&
(b=(this.style[mxConstants.STYLE_IMAGE_WIDTH]||this.imageSize)*this.scale,c=(this.style[mxConstants.STYLE_IMAGE_HEIGHT]||this.imageSize)*this.scale);var d=0,e=0,f=0;if(null!=this.indicator||null!=this.indicatorImageNode)d=(this.style[mxConstants.STYLE_INDICATOR_SPACING]||this.indicatorSpacing)*this.scale,e=(this.style[mxConstants.STYLE_INDICATOR_WIDTH]||this.indicatorSize)*this.scale,f=(this.style[mxConstants.STYLE_INDICATOR_HEIGHT]||this.indicatorSize)*this.scale;var g=this.style[mxConstants.STYLE_IMAGE_ALIGN],
h=this.style[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN],k=this.spacing*this.scale+5,l=Math.max(b,e),n=c+d+f,o=a?this.bounds.x:0,o=g==mxConstants.ALIGN_RIGHT?o+(this.bounds.width-l-k):g==mxConstants.ALIGN_CENTER?o+(this.bounds.width-l)/2:o+k,g=a?this.bounds.y:0,g=h==mxConstants.ALIGN_BOTTOM?g+(this.bounds.height-n-k):h==mxConstants.ALIGN_TOP?g+k:g+(this.bounds.height-n)/2;null!=this.imageNode&&(a?(this.imageNode.setAttribute("x",o+(l-b)/2+"px"),this.imageNode.setAttribute("y",g+"px"),this.imageNode.setAttribute("width",
b+"px"),this.imageNode.setAttribute("height",c+"px")):(this.imageNode.style.left=o+l-b+"px",this.imageNode.style.top=g+"px",this.imageNode.style.width=b+"px",this.imageNode.style.height=c+"px",this.imageNode.stroked="false"));null!=this.indicator?(this.indicator.bounds=new mxRectangle(o+(l-e)/2,g+c+d,e,f),this.indicator.redraw()):null!=this.indicatorImageNode&&(a?(this.indicatorImageNode.setAttribute("x",o+(l-e)/2+"px"),this.indicatorImageNode.setAttribute("y",g+c+d+"px"),this.indicatorImageNode.setAttribute("width",
e+"px"),this.indicatorImageNode.setAttribute("height",f+"px")):(this.indicatorImageNode.style.left=o+(l-e)/2+"px",this.indicatorImageNode.style.top=g+c+d+"px",this.indicatorImageNode.style.width=e+"px",this.indicatorImageNode.style.height=f+"px"))};function mxCylinder(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxCylinder.prototype=new mxShape;mxCylinder.prototype.constructor=mxCylinder;
mxCylinder.prototype.vmlNodes=mxCylinder.prototype.vmlNodes.concat(["background","foreground"]);mxCylinder.prototype.mixedModeHtml=!1;mxCylinder.prototype.preferModeHtml=!1;mxCylinder.prototype.addPipe=!1;mxCylinder.prototype.strokedBackground=!0;mxCylinder.prototype.maxHeight=40;mxCylinder.prototype.vmlScale=2;mxCylinder.prototype.create=function(a){null==this.stroke&&(this.stroke=this.fill);return mxShape.prototype.create.apply(this,arguments)};
mxCylinder.prototype.reconfigure=function(){this.dialect==mxConstants.DIALECT_SVG?(this.configureSvgShape(this.foreground),this.foreground.setAttribute("fill","none")):mxUtils.isVml(this.node)&&(this.configureVmlShape(this.background),this.configureVmlShape(this.foreground));mxShape.prototype.reconfigure.apply(this)};
mxCylinder.prototype.createVml=function(){var a=document.createElement("v:group");this.label=this.background=document.createElement("v:shape");this.configureVmlShape(this.background);a.appendChild(this.background);this.fill=null;this.isShadow=!1;this.configureVmlShape(a);this.foreground=document.createElement("v:shape");this.configureVmlShape(this.foreground);this.fgStrokeNode=document.createElement("v:stroke");this.fgStrokeNode.joinstyle="miter";this.fgStrokeNode.miterlimit=4;this.foreground.appendChild(this.fgStrokeNode);
a.appendChild(this.foreground);return a};mxCylinder.prototype.redrawVml=function(){this.updateVmlShape(this.node);this.updateVmlShape(this.background);this.updateVmlShape(this.foreground);this.background.path=this.createPath(!1);this.foreground.path=this.createPath(!0);this.fgStrokeNode.dashstyle=this.strokeNode.dashstyle};
mxCylinder.prototype.createSvg=function(){var a=this.createSvgGroup("path");this.foreground=document.createElementNS(mxConstants.NS_SVG,"path");null!=this.stroke&&this.stroke!=mxConstants.NONE?this.foreground.setAttribute("stroke",this.stroke):this.foreground.setAttribute("stroke","none");this.foreground.setAttribute("fill","none");a.appendChild(this.foreground);this.addPipe&&(this.pipe=this.createSvgPipe(),a.appendChild(this.pipe));return a};
mxCylinder.prototype.redrawSvg=function(){var a=Math.round(Math.max(1,this.strokewidth*this.scale));this.innerNode.setAttribute("stroke-width",a);this.crisp&&(null==this.rotation||0==this.rotation)?(this.innerNode.setAttribute("shape-rendering","crispEdges"),this.foreground.setAttribute("shape-rendering","crispEdges")):(this.innerNode.removeAttribute("shape-rendering"),this.foreground.removeAttribute("shape-rendering"));var b=this.createPath(!1);0<b.length?(this.innerNode.setAttribute("d",b),null!=
this.pipe&&(this.pipe.setAttribute("d",b),this.pipe.setAttribute("stroke-width",a+mxShape.prototype.SVG_STROKE_TOLERANCE),this.pipe.setAttribute("transform",this.innerNode.getAttribute("transform")||""))):(this.innerNode.removeAttribute("d"),null!=this.pipe&&this.pipe.removeAttribute("d"));this.strokedBackground||this.innerNode.setAttribute("stroke","none");null!=this.shadowNode&&(this.shadowNode.setAttribute("stroke-width",a),this.shadowNode.setAttribute("d",b),this.shadowNode.setAttribute("transform",
this.getSvgShadowTransform()));b=this.createPath(!0);0<b.length?(this.foreground.setAttribute("stroke-width",a),this.foreground.setAttribute("d",b)):this.foreground.removeAttribute("d");this.isDashed&&(a=Math.max(1,Math.round(3*this.scale*this.strokewidth)),this.innerNode.setAttribute("stroke-dasharray",a+" "+a),this.foreground.setAttribute("stroke-dasharray",a+" "+a))};
mxCylinder.prototype.redrawPath=function(a,b,c,d,e,f){b=Math.min(this.maxHeight,Math.round(e/5));f?(a.moveTo(0,b),a.curveTo(0,2*b,d,2*b,d,b)):(a.moveTo(0,b),a.curveTo(0,-b/3,d,-b/3,d,b),a.lineTo(d,e-b),a.curveTo(d,e+b/3,0,e+b/3,0,e-b),a.close())};function mxConnector(a,b,c){this.points=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxConnector.prototype=new mxShape;mxConnector.prototype.constructor=mxConnector;mxConnector.prototype.vmlNodes=mxConnector.prototype.vmlNodes.concat("shapeNode,start,end,startStroke,endStroke,startFill,endFill".split(","));
mxConnector.prototype.mixedModeHtml=!1;mxConnector.prototype.preferModeHtml=!1;mxConnector.prototype.allowCrispMarkers=!1;mxConnector.prototype.addPipe=!0;mxConnector.prototype.configureHtmlShape=function(a){mxShape.prototype.configureHtmlShape.apply(this,arguments);a.style.borderStyle="";a.style.background=""};
mxConnector.prototype.createVml=function(){var a=document.createElement("v:group");a.style.position="absolute";this.shapeNode=document.createElement("v:shape");this.updateVmlStrokeColor(this.shapeNode);this.updateVmlStrokeNode(this.shapeNode);a.appendChild(this.shapeNode);this.shapeNode.filled="false";this.isShadow&&this.createVmlShadow(this.shapeNode);null!=this.startArrow&&(this.start=document.createElement("v:shape"),this.start.style.position="absolute",this.startStroke=document.createElement("v:stroke"),
this.startStroke.joinstyle="miter",this.start.appendChild(this.startStroke),this.startFill=document.createElement("v:fill"),this.start.appendChild(this.startFill),a.appendChild(this.start));null!=this.endArrow&&(this.end=document.createElement("v:shape"),this.end.style.position="absolute",this.endStroke=document.createElement("v:stroke"),this.endStroke.joinstyle="miter",this.end.appendChild(this.endStroke),this.endFill=document.createElement("v:fill"),this.end.appendChild(this.endFill),a.appendChild(this.end));
this.updateVmlMarkerOpacity();return a};mxConnector.prototype.updateVmlMarkerOpacity=function(){var a=null!=this.opacity?this.opacity+"%":"100%";null!=this.start&&(this.startFill.opacity=a,this.startStroke.opacity=a);null!=this.end&&(this.endFill.opacity=a,this.endStroke.opacity=a)};
mxConnector.prototype.reconfigure=function(){this.fill=null;mxUtils.isVml(this.node)?(this.node.style.visibility="hidden",this.configureVmlShape(this.shapeNode),this.updateVmlMarkerOpacity(),this.node.style.visibility="visible"):mxShape.prototype.reconfigure.apply(this,arguments)};
mxConnector.prototype.redrawVml=function(){if(null!=this.node&&null!=this.points&&null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)){var a=Math.max(0,Math.round(this.bounds.width)),b=Math.max(0,Math.round(this.bounds.height)),c=a+","+b,a=a+"px",b=b+"px";if(null!=this.start){this.start.style.width=a;this.start.style.height=b;this.start.coordsize=c;var d=this.points[1],e=this.points[0],f=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,
mxConstants.DEFAULT_MARKERSIZE);this.startOffset=this.redrawMarker(this.start,this.startArrow,d,e,this.stroke,f)}null!=this.end&&(this.end.style.width=a,this.end.style.height=b,this.end.coordsize=c,a=this.points.length,d=this.points[a-2],e=this.points[a-1],f=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE),this.endOffset=this.redrawMarker(this.end,this.endArrow,d,e,this.stroke,f));this.updateVmlShape(this.node);this.updateVmlShape(this.shapeNode);this.shapeNode.filled=
"false";this.isDashed&&(d=mxUtils.getValue(this.style,"dashStyle",null),null!=d&&(this.strokeNode.dashstyle=d),null!=this.shadowStrokeNode&&(this.shadowStrokeNode.dashstyle=this.strokeNode.dashstyle))}};
mxConnector.prototype.createSvg=function(){this.fill=null;var a=this.createSvgGroup("path");null!=this.startArrow&&(this.start=document.createElementNS(mxConstants.NS_SVG,"path"),a.appendChild(this.start));null!=this.endArrow&&(this.end=document.createElementNS(mxConstants.NS_SVG,"path"),a.appendChild(this.end));this.addPipe&&(this.pipe=this.createSvgPipe(),a.appendChild(this.pipe));return a};
mxConnector.prototype.redrawSvg=function(){if(null!=this.points&&null!=this.points[0]){var a=this.innerNode.getAttribute("stroke");if(null!=this.start){var b=this.points[1],c=this.points[0],d=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE);this.startOffset=this.redrawMarker(this.start,this.startArrow,b,c,a,d);this.allowCrispMarkers&&this.crisp?this.start.setAttribute("shape-rendering","crispEdges"):this.start.removeAttribute("shape-rendering")}null!=this.end&&
(c=this.points.length,b=this.points[c-2],c=this.points[c-1],d=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE),this.endOffset=this.redrawMarker(this.end,this.endArrow,b,c,a,d),this.allowCrispMarkers&&this.crisp?this.end.setAttribute("shape-rendering","crispEdges"):this.end.removeAttribute("shape-rendering"))}this.updateSvgShape(this.innerNode);a=this.innerNode.getAttribute("d");null!=a&&(b=Math.round(this.strokewidth*this.scale),null!=this.pipe&&(this.pipe.setAttribute("d",
this.innerNode.getAttribute("d")),this.pipe.setAttribute("stroke-width",b+mxShape.prototype.SVG_STROKE_TOLERANCE)),null!=this.shadowNode&&(this.shadowNode.setAttribute("transform",this.getSvgShadowTransform()),this.shadowNode.setAttribute("d",a),this.shadowNode.setAttribute("stroke-width",b)));this.isDashed&&(a=this.createDashPattern(this.scale*this.strokewidth),null!=a&&this.innerNode.setAttribute("stroke-dasharray",a));null!=this.shadowNode&&(a=this.innerNode.getAttribute("stroke-dasharray"),null!=
a&&this.shadowNode.setAttribute("stroke-dasharray",a))};mxConnector.prototype.createDashPattern=function(a){var b=mxUtils.getValue(this.style,"dashPattern",null);if(null!=b){for(var b=b.split(" "),c=[],d=0;d<b.length;d++)0<b[d].length&&c.push(Math.round(Number(b[d])*a));return c.join(" ")}return null};mxConnector.prototype.redrawMarker=function(a,b,c,d,e,f){return mxMarker.paintMarker(a,b,c,d,e,this.strokewidth,f,this.scale,this.bounds.x,this.bounds.y,this.start==a,this.style)};
function mxSwimlane(a,b,c,d){this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxSwimlane.prototype=new mxShape;mxSwimlane.prototype.constructor=mxSwimlane;mxSwimlane.prototype.vmlNodes=mxSwimlane.prototype.vmlNodes.concat(["label","content","imageNode","separator"]);mxSwimlane.prototype.imageSize=16;mxSwimlane.prototype.mixedModeHtml=!1;mxRhombus.prototype.preferModeHtml=!1;
mxSwimlane.prototype.createHtml=function(){var a=document.createElement("DIV");this.configureHtmlShape(a);a.style.background="";a.style.backgroundColor="";a.style.borderStyle="none";this.label=document.createElement("DIV");this.configureHtmlShape(this.label);a.appendChild(this.label);this.content=document.createElement("DIV");this.configureHtmlShape(this.content);this.content.style.backgroundColor="";mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,!0)?this.content.style.borderTopStyle="none":
this.content.style.borderLeftStyle="none";this.content.style.cursor="default";a.appendChild(this.content);var b=this.style[mxConstants.STYLE_SEPARATORCOLOR];null!=b&&(this.separator=document.createElement("DIV"),this.separator.style.borderColor=b,this.separator.style.borderLeftStyle="dashed",a.appendChild(this.separator));null!=this.image&&(this.imageNode=mxUtils.createImage(this.image),this.configureHtmlShape(this.imageNode),this.imageNode.style.borderStyle="none",a.appendChild(this.imageNode));
return a};mxSwimlane.prototype.reconfigure=function(a){mxShape.prototype.reconfigure.apply(this,arguments);this.dialect==mxConstants.DIALECT_SVG?null!=this.shadowNode&&(this.updateSvgShape(this.shadowNode),mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,!0)?this.shadowNode.setAttribute("height",this.startSize*this.scale):this.shadowNode.setAttribute("width",this.startSize*this.scale)):mxUtils.isVml(this.node)||(this.node.style.background="",this.node.style.backgroundColor="")};
mxSwimlane.prototype.redrawHtml=function(){this.updateHtmlShape(this.node);this.node.style.background="";this.node.style.backgroundColor="";this.startSize=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));this.updateHtmlShape(this.label);this.label.style.top="0px";this.label.style.left="0px";if(mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,!0)){this.startSize=Math.min(this.startSize,this.bounds.height);this.label.style.height=this.startSize*
this.scale+"px";this.updateHtmlShape(this.content);this.content.style.background="";this.content.style.backgroundColor="";var a=this.startSize*this.scale;this.content.style.top=a+"px";this.content.style.left="0px";this.content.style.height=Math.max(1,this.bounds.height-a)+"px";null!=this.separator&&(this.separator.style.left=Math.round(this.bounds.width)+"px",this.separator.style.top=Math.round(this.startSize*this.scale)+"px",this.separator.style.width="1px",this.separator.style.height=Math.round(this.bounds.height)+
"px",this.separator.style.borderWidth=Math.round(this.scale)+"px");null!=this.imageNode&&(this.imageNode.style.left=this.bounds.width-this.imageSize-4+"px",this.imageNode.style.top="0px",this.imageNode.style.width=Math.round(this.imageSize*this.scale)+"px",this.imageNode.style.height=Math.round(this.imageSize*this.scale)+"px")}else this.startSize=Math.min(this.startSize,this.bounds.width),this.label.style.width=this.startSize*this.scale+"px",this.updateHtmlShape(this.content),this.content.style.background=
"",this.content.style.backgroundColor="",a=this.startSize*this.scale,this.content.style.top="0px",this.content.style.left=a+"px",this.content.style.width=Math.max(0,this.bounds.width-a)+"px",null!=this.separator&&(this.separator.style.left=Math.round(this.startSize*this.scale)+"px",this.separator.style.top=Math.round(this.bounds.height)+"px",this.separator.style.width=Math.round(this.bounds.width)+"px",this.separator.style.height="1px"),null!=this.imageNode&&(this.imageNode.style.left=this.bounds.width-
this.imageSize-4+"px",this.imageNode.style.top="0px",this.imageNode.style.width=this.imageSize*this.scale+"px",this.imageNode.style.height=this.imageSize*this.scale+"px")};
mxSwimlane.prototype.createVml=function(){var a=document.createElement("v:group"),b=this.isRounded?"v:roundrect":"v:rect";this.label=document.createElement(b);this.configureVmlShape(this.label);this.isRounded&&this.label.setAttribute("arcsize","20%");this.isShadow=!1;this.configureVmlShape(a);a.coordorigin="0,0";a.appendChild(this.label);this.content=document.createElement(b);b=this.fill;this.fill=null;this.configureVmlShape(this.content);a.style.background="";this.isRounded&&this.content.setAttribute("arcsize",
"4%");this.fill=b;this.content.style.borderBottom="0px";a.appendChild(this.content);b=this.style[mxConstants.STYLE_SEPARATORCOLOR];null!=b&&(this.separator=document.createElement("v:shape"),this.separator.style.position="absolute",this.separator.strokecolor=b,b=document.createElement("v:stroke"),b.dashstyle="2 2",this.separator.appendChild(b),a.appendChild(this.separator));null!=this.image&&(this.imageNode=document.createElement("v:image"),this.imageNode.src=this.image,this.configureVmlShape(this.imageNode),
this.imageNode.stroked="false",a.appendChild(this.imageNode));return a};
mxSwimlane.prototype.redrawVml=function(){var a=Math.round(this.bounds.x),b=Math.round(this.bounds.y),c=Math.round(this.bounds.width),d=Math.round(this.bounds.height);this.updateVmlShape(this.node);this.node.coordsize=c+","+d;this.updateVmlShape(this.label);this.label.style.top="0px";this.label.style.left="0px";this.label.style.rotation=null;this.startSize=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));var e=Math.round(this.startSize*this.scale);null!=
this.separator&&(this.separator.coordsize=c+","+d,this.separator.style.left=a+"px",this.separator.style.top=b+"px",this.separator.style.width=c+"px",this.separator.style.height=d+"px");mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,!0)?(e=Math.min(e,this.bounds.height),this.label.style.height=e+"px",this.updateVmlShape(this.content),this.content.style.background="",this.content.style.top=e+"px",this.content.style.left="0px",this.content.style.height=Math.max(0,d-e)+"px",null!=this.separator&&
(this.separator.path="m "+(c-a)+" "+(e-b)+" l "+(c-a)+" "+(d-b)+" e")):(e=Math.min(e,this.bounds.width),this.label.style.width=e+"px",this.updateVmlShape(this.content),this.content.style.background="",this.content.style.top="0px",this.content.style.left=e+"px",this.content.style.width=Math.max(0,c-e)+"px",null!=this.separator&&(this.separator.path="m "+(e-a)+" "+(d-b)+" l "+(c-a)+" "+(d-b)+" e"));null!=this.imageNode&&(a=Math.round(this.imageSize*this.scale),this.imageNode.style.left=c-a-4+"px",this.imageNode.style.top=
"0px",this.imageNode.style.width=a+"px",this.imageNode.style.height=a+"px");this.content.style.rotation=null};
mxSwimlane.prototype.createSvg=function(){var a=this.createSvgGroup("rect");this.isRounded&&(this.innerNode.setAttribute("rx",10),this.innerNode.setAttribute("ry",10));this.content=document.createElementNS(mxConstants.NS_SVG,"path");this.configureSvgShape(this.content);this.content.setAttribute("fill","none");this.isRounded&&(this.content.setAttribute("rx",10),this.content.setAttribute("ry",10));a.appendChild(this.content);var b=this.style[mxConstants.STYLE_SEPARATORCOLOR];null!=b&&(this.separator=
document.createElementNS(mxConstants.NS_SVG,"line"),this.separator.setAttribute("stroke",b),this.separator.setAttribute("fill","none"),this.separator.setAttribute("stroke-dasharray","2, 2"),a.appendChild(this.separator));null!=this.image&&(this.imageNode=document.createElementNS(mxConstants.NS_SVG,"image"),this.imageNode.setAttributeNS(mxConstants.NS_XLINK,"href",this.image),this.configureSvgShape(this.imageNode),a.appendChild(this.imageNode));return a};
mxSwimlane.prototype.redrawSvg=function(){var a=this.isRounded;this.isRounded=!1;this.updateSvgShape(this.innerNode);this.updateSvgShape(this.content);var b=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,!0);this.startSize=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));var c=this.startSize*this.scale;null!=this.shadowNode&&(this.updateSvgShape(this.shadowNode),b?this.shadowNode.setAttribute("height",c):this.shadowNode.setAttribute("width",
c));this.isRounded=a;this.content.removeAttribute("x");this.content.removeAttribute("y");this.content.removeAttribute("width");this.content.removeAttribute("height");var d=this.crisp&&mxClient.IS_IE?0.5:0,a=Math.round(this.bounds.x)+d,d=Math.round(this.bounds.y)+d,e=Math.round(this.bounds.width),f=Math.round(this.bounds.height);b?(c=Math.min(c,f),this.innerNode.setAttribute("height",c),this.content.setAttribute("d","M "+a+" "+(d+c)+" l 0 "+(f-c)+" l "+e+" 0 l 0 "+(c-f)),null!=this.separator&&(this.separator.setAttribute("x1",
a+e),this.separator.setAttribute("y1",d+c),this.separator.setAttribute("x2",a+e),this.separator.setAttribute("y2",d+f))):(c=Math.min(c,e),this.innerNode.setAttribute("width",c),this.content.setAttribute("d","M "+(a+c)+" "+d+" l "+(e-c)+" 0 l 0 "+f+" l "+(c-e)+" 0"),null!=this.separator&&(this.separator.setAttribute("x1",a+c),this.separator.setAttribute("y1",d+f),this.separator.setAttribute("x2",a+e),this.separator.setAttribute("y2",d+f)));null!=this.imageNode&&(this.imageNode.setAttribute("x",a+e-
this.imageSize-4),this.imageNode.setAttribute("y",d),this.imageNode.setAttribute("width",this.imageSize*this.scale+"px"),this.imageNode.setAttribute("height",this.imageSize*this.scale+"px"))};function mxGraphLayout(a){this.graph=a}mxGraphLayout.prototype.graph=null;mxGraphLayout.prototype.useBoundingBox=!0;mxGraphLayout.prototype.parent=null;mxGraphLayout.prototype.moveCell=function(){};mxGraphLayout.prototype.execute=function(){};mxGraphLayout.prototype.getGraph=function(){return this.graph};
mxGraphLayout.prototype.getConstraint=function(a,b){var c=this.graph.view.getState(b),c=null!=c?c.style:this.graph.getCellStyle(b);return null!=c?c[a]:null};
mxGraphLayout.traverse=function(a,b,c,d,e){if(null!=c&&null!=a){var b=null!=b?b:!0,e=e||[],f=mxCellPath.create(a);if(null==e[f]&&(e[f]=a,d=c(a,d),null==d||d))if(d=this.graph.model.getEdgeCount(a),0<d)for(f=0;f<d;f++){var g=this.graph.model.getEdgeAt(a,f),h=this.graph.model.getTerminal(g,!0)==a;(!b||h)&&this.traverse(this.graph.view.getVisibleTerminal(g,!h),b,c,g,e)}}};mxGraphLayout.prototype.isVertexMovable=function(a){return this.graph.isCellMovable(a)};
mxGraphLayout.prototype.isVertexIgnored=function(a){return!this.graph.getModel().isVertex(a)||!this.graph.isCellVisible(a)};mxGraphLayout.prototype.isEdgeIgnored=function(a){var b=this.graph.getModel();return!b.isEdge(a)||!this.graph.isCellVisible(a)||null==b.getTerminal(a,!0)||null==b.getTerminal(a,!1)};mxGraphLayout.prototype.setEdgeStyleEnabled=function(a,b){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,b?"0":"1",[a])};
mxGraphLayout.prototype.setOrthogonalEdge=function(a,b){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,b?"1":"0",[a])};mxGraphLayout.prototype.getParentOffset=function(a){var b=new mxPoint;if(null!=a&&a!=this.parent){var c=this.graph.getModel();if(c.isAncestor(this.parent,a))for(var d=c.getGeometry(a);a!=this.parent;)b.x+=d.x,b.y+=d.y,a=c.getParent(a),d=c.getGeometry(a)}return b};
mxGraphLayout.prototype.setEdgePoints=function(a,b){if(null!=a){var c=this.graph.model,d=c.getGeometry(a);null==d?(d=new mxGeometry,d.setRelative(!0)):d=d.clone();if(null!=this.parent&&null!=b)for(var e=this.getParentOffset(c.getParent(a)),f=0;f<b.length;f++)b[f].x-=e.x,b[f].y-=e.y;d.points=b;c.setGeometry(a,d)}};
mxGraphLayout.prototype.setVertexLocation=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a),f=null;if(null!=e){f=new mxRectangle(b,c,e.width,e.height);if(this.useBoundingBox){var g=this.graph.getView().getState(a);if(null!=g&&null!=g.text&&null!=g.text.boundingBox){var h=this.graph.getView().scale,k=g.text.boundingBox;g.text.boundingBox.x<g.x&&(b+=(g.x-k.x)/h,f.width=k.width);g.text.boundingBox.y<g.y&&(c+=(g.y-k.y)/h,f.height=k.height)}}null!=this.parent&&(g=d.getParent(a),null!=g&&g!=
this.parent&&(g=this.getParentOffset(g),b-=g.x,c-=g.y));if(e.x!=b||e.y!=c)e=e.clone(),e.x=b,e.y=c,d.setGeometry(a,e)}return f};
mxGraphLayout.prototype.getVertexBounds=function(a){var b=this.graph.getModel().getGeometry(a);if(this.useBoundingBox){var c=this.graph.getView().getState(a);if(null!=c&&null!=c.text&&null!=c.text.boundingBox)var d=this.graph.getView().scale,e=c.text.boundingBox,f=Math.max(c.x-e.x,0)/d,g=Math.max(c.y-e.y,0)/d,h=Math.max(e.x+e.width-(c.x+c.width),0)/d,c=Math.max(e.y+e.height-(c.y+c.height),0)/d,b=new mxRectangle(b.x-f,b.y-g,b.width+f+h,b.height+g+c)}null!=this.parent&&(a=this.graph.getModel().getParent(a),
b=b.clone(),null!=a&&a!=this.parent&&(a=this.getParentOffset(a),b.x+=a.x,b.y+=a.y));return new mxRectangle(b.x,b.y,b.width,b.height)};
mxGraphLayout.prototype.arrangeGroups=function(a,b){this.graph.getModel().beginUpdate();try{for(var c=a.length-1;0<=c;c--){var d=a[c],e=this.graph.getChildVertices(d),f=this.graph.getBoundingBoxFromGeometry(e),g=this.graph.getCellGeometry(d),h=0,k=0;if(this.graph.isSwimlane(d))var l=this.graph.getStartSize(d),h=l.width,k=l.height;null!=f&&null!=g&&(g=g.clone(),g.x=g.x+f.x-b-h,g.y=g.y+f.y-b-k,g.width=f.width+2*b+h,g.height=f.height+2*b+k,this.graph.getModel().setGeometry(d,g),this.graph.moveCells(e,
b+h-f.x,b+k-f.y))}}finally{this.graph.getModel().endUpdate()}};function mxStackLayout(a,b,c,d,e,f){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.spacing=null!=c?c:0;this.x0=null!=d?d:0;this.y0=null!=e?e:0;this.border=null!=f?f:0}mxStackLayout.prototype=new mxGraphLayout;mxStackLayout.prototype.constructor=mxStackLayout;mxStackLayout.prototype.horizontal=null;mxStackLayout.prototype.spacing=null;mxStackLayout.prototype.x0=null;mxStackLayout.prototype.y0=null;
mxStackLayout.prototype.border=0;mxStackLayout.prototype.keepFirstLocation=!1;mxStackLayout.prototype.fill=!1;mxStackLayout.prototype.resizeParent=!1;mxStackLayout.prototype.resizeLast=!1;mxStackLayout.prototype.wrap=null;mxStackLayout.prototype.isHorizontal=function(){return this.horizontal};
mxStackLayout.prototype.moveCell=function(a,b,c){var d=this.graph.getModel(),e=d.getParent(a),f=this.isHorizontal();if(null!=a&&null!=e){var g=0,h=0,k=d.getChildCount(e),b=f?b:c,g=this.graph.getView().getState(e);null!=g&&(b-=f?g.x:g.y);for(g=0;g<k;g++)if(c=d.getChildAt(e,g),c!=a&&(c=d.getGeometry(c),null!=c)){c=f?c.x+c.width/2:c.y+c.height/2;if(h<b&&c>b)break;h=c}f=e.getIndex(a);f=Math.max(0,g-(g>f?1:0));d.add(e,a,f)}};
mxStackLayout.prototype.getParentSize=function(a){var b=this.graph.getModel(),c=b.getGeometry(a);if(null!=this.graph.container&&(null==c&&b.isLayer(a)||a==this.graph.getView().currentRoot))c=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1);return c};
mxStackLayout.prototype.execute=function(a){if(null!=a){var b=this.isHorizontal(),c=this.graph.getModel(),d=this.getParentSize(a),e=null;null!=d&&(e=b?d.height:d.width);var e=e-(2*this.spacing+2*this.border),f=this.x0+this.border,g=this.y0+this.border;if(this.graph.isSwimlane(a)){var h=this.graph.getCellStyle(a),k=mxUtils.getNumber(h,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),h=1==mxUtils.getValue(h,mxConstants.STYLE_HORIZONTAL,!0);null!=d&&(k=h?Math.min(k,d.height):Math.min(k,d.width));
b==h&&(e-=k);h?g+=k:f+=k}c.beginUpdate();try{for(var k=0,h=null,l=c.getChildCount(a),n=0;n<l;n++){var o=c.getChildAt(a,n);if(!this.isVertexIgnored(o)&&this.isVertexMovable(o)){var p=c.getGeometry(o);if(null!=p){p=p.clone();if(null!=this.wrap&&null!=h&&(b&&h.x+h.width+p.width+2*this.spacing>this.wrap||!b&&h.y+h.height+p.height+2*this.spacing>this.wrap))h=null,b?g+=k+this.spacing:f+=k+this.spacing,k=0;k=Math.max(k,b?p.height:p.width);null!=h?b?p.x=h.x+h.width+this.spacing:p.y=h.y+h.height+this.spacing:
this.keepFirstLocation||(b?p.x=f:p.y=g);b?p.y=g:p.x=f;this.fill&&null!=e&&(b?p.height=e:p.width=e);c.setGeometry(o,p);h=p}}}this.resizeParent&&null!=d&&null!=h&&!this.graph.isCellCollapsed(a)?(d=d.clone(),b?d.width=h.x+h.width+this.spacing:d.height=h.y+h.height+this.spacing,c.setGeometry(a,d)):this.resizeLast&&null!=d&&null!=h&&(b?h.width=d.width-h.x-this.spacing:h.height=d.height-h.y-this.spacing)}finally{c.endUpdate()}}};
function mxPartitionLayout(a,b,c,d){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.spacing=c||0;this.border=d||0}mxPartitionLayout.prototype=new mxGraphLayout;mxPartitionLayout.prototype.constructor=mxPartitionLayout;mxPartitionLayout.prototype.horizontal=null;mxPartitionLayout.prototype.spacing=null;mxPartitionLayout.prototype.border=null;mxPartitionLayout.prototype.resizeVertices=!0;mxPartitionLayout.prototype.isHorizontal=function(){return this.horizontal};
mxPartitionLayout.prototype.moveCell=function(a,b){var c=this.graph.getModel(),d=c.getParent(a);if(null!=a&&null!=d){for(var e=0,f=0,g=c.getChildCount(d),e=0;e<g;e++){var h=this.getVertexBounds(c.getChildAt(d,e));if(null!=h){h=h.x+h.width/2;if(f<b&&h>b)break;f=h}}f=d.getIndex(a);f=Math.max(0,e-(e>f?1:0));c.add(d,a,f)}};
mxPartitionLayout.prototype.execute=function(a){var b=this.isHorizontal(),c=this.graph.getModel(),d=c.getGeometry(a);if(null!=this.graph.container&&(null==d&&c.isLayer(a)||a==this.graph.getView().currentRoot))d=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1);if(null!=d){for(var e=[],f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g);!this.isVertexIgnored(h)&&this.isVertexMovable(h)&&e.push(h)}f=e.length;if(0<f){var k=this.border,l=this.border,n=b?
d.height:d.width,n=n-2*this.border,a=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle,n=n-(b?a.height:a.width),k=k+a.width,l=l+a.height,a=this.border+(f-1)*this.spacing,d=b?(d.width-k-a)/f:(d.height-l-a)/f;if(0<d){c.beginUpdate();try{for(g=0;g<f;g++){var h=e[g],o=c.getGeometry(h);null!=o&&(o=o.clone(),o.x=k,o.y=l,b?(this.resizeVertices&&(o.width=d,o.height=n),k+=d+this.spacing):(this.resizeVertices&&(o.height=d,o.width=n),l+=d+this.spacing),c.setGeometry(h,o))}}finally{c.endUpdate()}}}}};
function mxCompactTreeLayout(a,b,c){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.invert=null!=c?c:!1}mxCompactTreeLayout.prototype=new mxGraphLayout;mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout;mxCompactTreeLayout.prototype.horizontal=null;mxCompactTreeLayout.prototype.invert=null;mxCompactTreeLayout.prototype.resizeParent=!0;mxCompactTreeLayout.prototype.groupPadding=10;mxCompactTreeLayout.prototype.parentsChanged=null;mxCompactTreeLayout.prototype.moveTree=!1;
mxCompactTreeLayout.prototype.levelDistance=10;mxCompactTreeLayout.prototype.nodeDistance=20;mxCompactTreeLayout.prototype.resetEdges=!0;mxCompactTreeLayout.prototype.prefHozEdgeSep=5;mxCompactTreeLayout.prototype.prefVertEdgeOff=4;mxCompactTreeLayout.prototype.minEdgeJetty=8;mxCompactTreeLayout.prototype.channelBuffer=4;mxCompactTreeLayout.prototype.edgeRouting=!0;mxCompactTreeLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};
mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal};
mxCompactTreeLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.getModel();if(null==b)if(0<this.graph.getEdges(a,c.getParent(a),this.invert,!this.invert,!1).length)b=a;else{var d=this.graph.findTreeRoots(a,!0,this.invert);if(0<d.length)for(var e=0;e<d.length;e++)if(!this.isVertexIgnored(d[e])&&0<this.graph.getEdges(d[e],null,this.invert,!this.invert,!1).length){b=d[e];break}}if(null!=b){this.parentsChanged=this.resizeParent?{}:null;c.beginUpdate();try{var f=this.dfs(b,a);if(null!=
f){this.layout(f);var g=this.graph.gridSize,d=g;if(!this.moveTree){var h=this.getVertexBounds(b);null!=h&&(g=h.x,d=h.y)}h=null;h=this.isHorizontal()?this.horizontalLayout(f,g,d):this.verticalLayout(f,null,g,d);if(null!=h){var k=e=0;0>h.x&&(e=Math.abs(g-h.x));0>h.y&&(k=Math.abs(d-h.y));(0!=e||0!=k)&&this.moveNode(f,e,k);this.resizeParent&&this.adjustParents();this.edgeRouting&&this.localEdgeProcessing(f)}}}finally{c.endUpdate()}}};
mxCompactTreeLayout.prototype.moveNode=function(a,b,c){a.x+=b;a.y+=c;this.apply(a);for(a=a.child;null!=a;)this.moveNode(a,b,c),a=a.next};
mxCompactTreeLayout.prototype.dfs=function(a,b,c){var c=null!=c?c:[],d=mxCellPath.create(a),e=null;if(null!=a&&null==c[d]&&!this.isVertexIgnored(a)){c[d]=a;for(var e=this.createNode(a),d=this.graph.getModel(),f=null,a=this.graph.getEdges(a,b,this.invert,!this.invert,!1,!0),g=this.graph.getView(),h=0;h<a.length;h++){var k=a[h];if(!this.isEdgeIgnored(k)){this.resetEdges&&this.setEdgePoints(k,null);this.edgeRouting&&(this.setEdgeStyleEnabled(k,!1),this.setEdgePoints(k,null));var l=g.getState(k),k=null!=
l?l.getVisibleTerminal(this.invert):g.getVisibleTerminal(k,this.invert),l=this.dfs(k,b,c);null!=l&&null!=d.getGeometry(k)&&(null==f?e.child=l:f.next=l,f=l)}}}return e};mxCompactTreeLayout.prototype.layout=function(a){if(null!=a){for(var b=a.child;null!=b;)this.layout(b),b=b.next;null!=a.child?this.attachParent(a,this.join(a)):this.layoutLeaf(a)}};
mxCompactTreeLayout.prototype.horizontalLayout=function(a,b,c,d){a.x+=b+a.offsetX;a.y+=c+a.offsetY;d=this.apply(a,d);b=a.child;if(null!=b)for(var d=this.horizontalLayout(b,a.x,a.y,d),c=a.y+b.offsetY,e=b.next;null!=e;)d=this.horizontalLayout(e,a.x+b.offsetX,c,d),c+=e.offsetY,e=e.next;return d};
mxCompactTreeLayout.prototype.verticalLayout=function(a,b,c,d,e){a.x+=c+a.offsetY;a.y+=d+a.offsetX;e=this.apply(a,e);b=a.child;if(null!=b){e=this.verticalLayout(b,a,a.x,a.y,e);c=a.x+b.offsetY;for(d=b.next;null!=d;)e=this.verticalLayout(d,a,c,a.y+b.offsetX,e),c+=d.offsetY,d=d.next}return e};
mxCompactTreeLayout.prototype.attachParent=function(a,b){var c=this.nodeDistance+this.levelDistance,d=(b-a.width)/2-this.nodeDistance,e=d+a.width+2*this.nodeDistance-b;a.child.offsetX=c+a.height;a.child.offsetY=e;a.contour.upperHead=this.createLine(a.height,0,this.createLine(c,e,a.contour.upperHead));a.contour.lowerHead=this.createLine(a.height,0,this.createLine(c,d,a.contour.lowerHead))};
mxCompactTreeLayout.prototype.layoutLeaf=function(a){var b=2*this.nodeDistance;a.contour.upperTail=this.createLine(a.height+b,0);a.contour.upperHead=a.contour.upperTail;a.contour.lowerTail=this.createLine(0,-a.width-b);a.contour.lowerHead=this.createLine(a.height+b,0,a.contour.lowerTail)};
mxCompactTreeLayout.prototype.join=function(a){var b=2*this.nodeDistance,c=a.child;a.contour=c.contour;for(var d=c.width+b,e=d,c=c.next;null!=c;){var f=this.merge(a.contour,c.contour);c.offsetY=f+d;c.offsetX=0;d=c.width+b;e+=f+d;c=c.next}return e};
mxCompactTreeLayout.prototype.merge=function(a,b){for(var c=0,d=0,e=0,f=a.lowerHead,g=b.upperHead;null!=g&&null!=f;){var h=this.offset(c,d,g.dx,g.dy,f.dx,f.dy),d=d+h,e=e+h;c+g.dx<=f.dx?(c+=g.dx,d+=g.dy,g=g.next):(c-=f.dx,d-=f.dy,f=f.next)}null!=g?(c=this.bridge(a.upperTail,0,0,g,c,d),a.upperTail=null!=c.next?b.upperTail:c,a.lowerTail=b.lowerTail):(c=this.bridge(b.lowerTail,c,d,f,0,0),null==c.next&&(a.lowerTail=c));a.lowerHead=b.lowerHead;return e};
mxCompactTreeLayout.prototype.offset=function(a,b,c,d,e,f){var g=0;if(e<=a||0>=a+c)return 0;g=0<e*d-c*f?0>a?a*d/c-b:0<a?a*f/e-b:-b:e<a+c?f-(b+(e-a)*d/c):e>a+c?(c+a)*f/e-(b+d):f-(b+d);return 0<g?g:0};mxCompactTreeLayout.prototype.bridge=function(a,b,c,d,e,f){b=e+d.dx-b;e=e=0;0==d.dx?e=d.dy:(e=b*d.dy,e/=d.dx);b=this.createLine(b,e,d.next);a.next=this.createLine(0,f+d.dy-e-c,b);return b};
mxCompactTreeLayout.prototype.createNode=function(a){var b={};b.cell=a;b.x=0;b.y=0;b.width=0;b.height=0;a=this.getVertexBounds(a);null!=a&&(this.isHorizontal()?(b.width=a.height,b.height=a.width):(b.width=a.width,b.height=a.height));b.offsetX=0;b.offsetY=0;b.contour={};return b};
mxCompactTreeLayout.prototype.apply=function(a,b){var c=this.graph.getModel(),d=a.cell,e=c.getGeometry(d);null!=d&&null!=e&&(this.isVertexMovable(d)&&(e=this.setVertexLocation(d,a.x,a.y),this.resizeParent&&(c=c.getParent(d),d=mxCellPath.create(c),null==this.parentsChanged[d]&&(this.parentsChanged[d]=c))),b=null==b?new mxRectangle(e.x,e.y,e.width,e.height):new mxRectangle(Math.min(b.x,e.x),Math.min(b.y,e.y),Math.max(b.x+b.width,e.x+e.width),Math.max(b.y+b.height,e.y+e.height)));return b};
mxCompactTreeLayout.prototype.createLine=function(a,b,c){var d={};d.dx=a;d.dy=b;d.next=c;return d};mxCompactTreeLayout.prototype.adjustParents=function(){var a=[],b;for(b in this.parentsChanged)a.push(this.parentsChanged[b]);this.arrangeGroups(mxUtils.sortCells(a,!0),this.groupPadding)};mxCompactTreeLayout.prototype.localEdgeProcessing=function(a){this.processNodeOutgoing(a);for(a=a.child;null!=a;)this.localEdgeProcessing(a),a=a.next};
mxCompactTreeLayout.prototype.processNodeOutgoing=function(a){for(var b=a.child,c=a.cell,d=0,e=[];null!=b;){d++;var f=b.x;this.horizontal&&(f=b.y);e.push(new WeightedCellSorter(b,f));b=b.next}e.sort(WeightedCellSorter.prototype.compare);var f=a.width,g=(d+1)*this.prefHozEdgeSep;f>g+2*this.prefHozEdgeSep&&(f-=2*this.prefHozEdgeSep);a=f/d;b=a/2;f>g+2*this.prefHozEdgeSep&&(b+=this.prefHozEdgeSep);for(var f=this.minEdgeJetty-this.prefVertEdgeOff,g=0,h=this.getVertexBounds(c),k=0;k<e.length;k++){for(var l=
e[k].cell.cell,n=this.getVertexBounds(l),l=this.graph.getEdgesBetween(c,l,!1),o=[],p=0,r=0,s=0;s<l.length;s++)this.horizontal?(p=h.x+h.width,r=h.y+b,o.push(new mxPoint(p,r)),p=h.x+h.width+f,o.push(new mxPoint(p,r)),r=n.y+n.height/2):(p=h.x+b,r=h.y+h.height,o.push(new mxPoint(p,r)),r=h.y+h.height+f,o.push(new mxPoint(p,r)),p=n.x+n.width/2),o.push(new mxPoint(p,r)),this.setEdgePoints(l[s],o);k<d/2?f+=this.prefVertEdgeOff:k>d/2&&(f-=this.prefVertEdgeOff);b+=a;g=Math.max(g,f)}};
function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?1:b.weightedValue<a.weightedValue?-1:b.nudge?1:-1:0};function mxFastOrganicLayout(a){mxGraphLayout.call(this,a)}
mxFastOrganicLayout.prototype=new mxGraphLayout;mxFastOrganicLayout.prototype.constructor=mxFastOrganicLayout;mxFastOrganicLayout.prototype.useInputOrigin=!0;mxFastOrganicLayout.prototype.resetEdges=!0;mxFastOrganicLayout.prototype.disableEdgeStyle=!0;mxFastOrganicLayout.prototype.forceConstant=50;mxFastOrganicLayout.prototype.forceConstantSquared=0;mxFastOrganicLayout.prototype.minDistanceLimit=2;mxFastOrganicLayout.prototype.maxDistanceLimit=500;
mxFastOrganicLayout.prototype.minDistanceLimitSquared=4;mxFastOrganicLayout.prototype.initialTemp=200;mxFastOrganicLayout.prototype.temperature=0;mxFastOrganicLayout.prototype.maxIterations=0;mxFastOrganicLayout.prototype.iteration=0;mxFastOrganicLayout.prototype.allowedToRun=!0;mxFastOrganicLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};
mxFastOrganicLayout.prototype.execute=function(a){var b=this.graph.getModel();this.vertexArray=[];for(var c=this.graph.getChildVertices(a),d=0;d<c.length;d++)this.isVertexIgnored(c[d])||this.vertexArray.push(c[d]);var e=this.useInputOrigin?this.graph.view.getBounds(this.vertexArray):null,f=this.vertexArray.length;this.indices=[];this.dispX=[];this.dispY=[];this.cellLocation=[];this.isMoveable=[];this.neighbours=[];this.radius=[];this.radiusSquared=[];0.0010>this.forceConstant&&(this.forceConstant=
0.0010);this.forceConstantSquared=this.forceConstant*this.forceConstant;for(d=0;d<this.vertexArray.length;d++){var g=this.vertexArray[d];this.cellLocation[d]=[];var h=mxCellPath.create(g);this.indices[h]=d;var k=this.getVertexBounds(g),l=k.width,n=k.height,o=k.x,p=k.y;this.cellLocation[d][0]=o+l/2;this.cellLocation[d][1]=p+n/2;this.radius[d]=Math.min(l,n);this.radiusSquared[d]=this.radius[d]*this.radius[d]}b.beginUpdate();try{for(d=0;d<f;d++){this.dispX[d]=0;this.dispY[d]=0;this.isMoveable[d]=this.isVertexMovable(this.vertexArray[d]);
var r=this.graph.getConnections(this.vertexArray[d],a),c=this.graph.getOpposites(r,this.vertexArray[d]);this.neighbours[d]=[];for(l=0;l<c.length;l++){this.resetEdges&&this.graph.resetEdge(r[l]);this.disableEdgeStyle&&this.setEdgeStyleEnabled(r[l],!1);var h=mxCellPath.create(c[l]),s=this.indices[h];this.neighbours[d][l]=null!=s?s:d}}this.temperature=this.initialTemp;0==this.maxIterations&&(this.maxIterations=20*Math.sqrt(f));for(this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun)return;
this.calcRepulsion();this.calcAttraction();this.calcPositions();this.reduceTemperature()}a=c=null;for(d=0;d<this.vertexArray.length;d++)g=this.vertexArray[d],this.isVertexMovable(g)&&(k=this.getVertexBounds(g),null!=k&&(this.cellLocation[d][0]-=k.width/2,this.cellLocation[d][1]-=k.height/2,o=this.graph.snap(this.cellLocation[d][0]),p=this.graph.snap(this.cellLocation[d][1]),this.setVertexLocation(g,o,p),c=null==c?o:Math.min(c,o),a=null==a?p:Math.min(a,p)));d=-(c||0)+1;g=-(a||0)+1;null!=e&&(d+=e.x,
g+=e.y);this.graph.moveCells(this.vertexArray,d,g)}finally{b.endUpdate()}};mxFastOrganicLayout.prototype.calcPositions=function(){for(var a=0;a<this.vertexArray.length;a++)if(this.isMoveable[a]){var b=Math.sqrt(this.dispX[a]*this.dispX[a]+this.dispY[a]*this.dispY[a]);0.0010>b&&(b=0.0010);var c=this.dispX[a]/b*Math.min(b,this.temperature),b=this.dispY[a]/b*Math.min(b,this.temperature);this.dispX[a]=0;this.dispY[a]=0;this.cellLocation[a][0]+=c;this.cellLocation[a][1]+=b}};
mxFastOrganicLayout.prototype.calcAttraction=function(){for(var a=0;a<this.vertexArray.length;a++)for(var b=0;b<this.neighbours[a].length;b++){var c=this.neighbours[a][b];if(a!=c&&this.isMoveable[a]&&this.isMoveable[c]){var d=this.cellLocation[a][0]-this.cellLocation[c][0],e=this.cellLocation[a][1]-this.cellLocation[c][1],f=d*d+e*e-this.radiusSquared[a]-this.radiusSquared[c];f<this.minDistanceLimitSquared&&(f=this.minDistanceLimitSquared);var g=Math.sqrt(f),f=f/this.forceConstant,d=d/g*f,e=e/g*f;
this.dispX[a]-=d;this.dispY[a]-=e;this.dispX[c]+=d;this.dispY[c]+=e}}};
mxFastOrganicLayout.prototype.calcRepulsion=function(){for(var a=this.vertexArray.length,b=0;b<a;b++)for(var c=b;c<a;c++){if(!this.allowedToRun)return;if(c!=b&&this.isMoveable[b]&&this.isMoveable[c]){var d=this.cellLocation[b][0]-this.cellLocation[c][0],e=this.cellLocation[b][1]-this.cellLocation[c][1];0==d&&(d=0.01+Math.random());0==e&&(e=0.01+Math.random());var f=Math.sqrt(d*d+e*e),g=f-this.radius[b]-this.radius[c];g>this.maxDistanceLimit||(g<this.minDistanceLimit&&(g=this.minDistanceLimit),g=this.forceConstantSquared/
g,d=d/f*g,e=e/f*g,this.dispX[b]+=d,this.dispY[b]+=e,this.dispX[c]-=d,this.dispY[c]-=e)}}};mxFastOrganicLayout.prototype.reduceTemperature=function(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)};function mxCircleLayout(a,b){mxGraphLayout.call(this,a);this.radius=null!=b?b:100}mxCircleLayout.prototype=new mxGraphLayout;mxCircleLayout.prototype.constructor=mxCircleLayout;mxCircleLayout.prototype.radius=null;mxCircleLayout.prototype.moveCircle=!1;
mxCircleLayout.prototype.x0=0;mxCircleLayout.prototype.y0=0;mxCircleLayout.prototype.resetEdges=!0;mxCircleLayout.prototype.disableEdgeStyle=!0;
mxCircleLayout.prototype.execute=function(a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0,d=null,e=null,f=[],g=b.getChildCount(a),h=0;h<g;h++){var k=b.getChildAt(a,h);if(this.isVertexIgnored(k))this.isEdgeIgnored(k)||(this.resetEdges&&this.graph.resetEdge(k),this.disableEdgeStyle&&this.setEdgeStyleEnabled(k,!1));else{f.push(k);var l=this.getVertexBounds(k),d=null==d?l.y:Math.min(d,l.y),e=null==e?l.x:Math.min(e,l.x),c=Math.max(c,Math.max(l.width,l.height))}}var n=this.getRadius(f.length,
c);this.moveCircle&&(e=this.x0,d=this.y0);this.circle(f,n,e,d)}finally{b.endUpdate()}};mxCircleLayout.prototype.getRadius=function(a,b){return Math.max(a*b/Math.PI,this.radius)};mxCircleLayout.prototype.circle=function(a,b,c,d){for(var e=a.length,f=2*Math.PI/e,g=0;g<e;g++)this.isVertexMovable(a[g])&&this.setVertexLocation(a[g],c+b+b*Math.sin(g*f),d+b+b*Math.cos(g*f))};function mxParallelEdgeLayout(a){mxGraphLayout.call(this,a)}mxParallelEdgeLayout.prototype=new mxGraphLayout;
mxParallelEdgeLayout.prototype.constructor=mxParallelEdgeLayout;mxParallelEdgeLayout.prototype.spacing=20;mxParallelEdgeLayout.prototype.execute=function(a){a=this.findParallels(a);this.graph.model.beginUpdate();try{for(var b in a){var c=a[b];1<c.length&&this.layout(c)}}finally{this.graph.model.endUpdate()}};
mxParallelEdgeLayout.prototype.findParallels=function(a){for(var b=this.graph.getModel(),c=[],d=b.getChildCount(a),e=0;e<d;e++){var f=b.getChildAt(a,e);if(!this.isEdgeIgnored(f)){var g=this.getEdgeId(f);null!=g&&(null==c[g]&&(c[g]=[]),c[g].push(f))}}return c};
mxParallelEdgeLayout.prototype.getEdgeId=function(a){var b=this.graph.getView(),c=b.getState(a),d=null!=c?c.getVisibleTerminal(!0):b.getVisibleTerminal(a,!0),a=null!=c?c.getVisibleTerminal(!1):b.getVisibleTerminal(a,!1);return null!=d&&null!=a?(d=mxCellPath.create(d),a=mxCellPath.create(a),d>a?a+"-"+d:d+"-"+a):null};
mxParallelEdgeLayout.prototype.layout=function(a){var b=a[0],c=this.graph.getModel(),d=c.getGeometry(c.getTerminal(b,!0)),e=c.getGeometry(c.getTerminal(b,!1));if(d==e)for(var b=d.x+d.width+this.spacing,c=d.y+d.height/2,f=0;f<a.length;f++)this.route(a[f],b,c),b+=this.spacing;else if(null!=d&&null!=e)for(var b=d.x+d.width/2,c=d.y+d.height/2,f=e.x+e.width/2-b,g=e.y+e.height/2-c,e=Math.sqrt(f*f+g*g),d=g*this.spacing/e,e=f*this.spacing/e,b=b+f/2+d*(a.length-1)/2,c=c+g/2-e*(a.length-1)/2,f=0;f<a.length;f++)this.route(a[f],
b,c),b-=d,c+=e};mxParallelEdgeLayout.prototype.route=function(a,b,c){this.graph.isCellMovable(a)&&this.setEdgePoints(a,[new mxPoint(b,c)])};function mxCompositeLayout(a,b,c){mxGraphLayout.call(this,a);this.layouts=b;this.master=c}mxCompositeLayout.prototype=new mxGraphLayout;mxCompositeLayout.prototype.constructor=mxCompositeLayout;mxCompositeLayout.prototype.layouts=null;mxCompositeLayout.prototype.master=null;
mxCompositeLayout.prototype.moveCell=function(a,b,c){null!=this.master?this.master.move.apply(this.master,arguments):this.layouts[0].move.apply(this.layouts[0],arguments)};mxCompositeLayout.prototype.execute=function(a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0;c<this.layouts.length;c++)this.layouts[c].execute.apply(this.layouts[c],arguments)}finally{b.endUpdate()}};function mxEdgeLabelLayout(a){mxGraphLayout.call(this,a)}mxEdgeLabelLayout.prototype=new mxGraphLayout;
mxEdgeLabelLayout.prototype.constructor=mxEdgeLabelLayout;mxEdgeLabelLayout.prototype.execute=function(a){for(var b=this.graph.view,c=this.graph.getModel(),d=[],e=[],f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g),k=b.getState(h);null!=k&&(this.isVertexIgnored(h)?this.isEdgeIgnored(h)||d.push(k):e.push(k))}this.placeLabels(e,d)};
mxEdgeLabelLayout.prototype.placeLabels=function(a,b){var c=this.graph.getModel();c.beginUpdate();try{for(var d=0;d<b.length;d++){var e=b[d];if(null!=e&&null!=e.text&&null!=e.text.boundingBox)for(var f=0;f<a.length;f++){var g=a[f];null!=g&&this.avoid(e,g)}}}finally{c.endUpdate()}};
mxEdgeLabelLayout.prototype.avoid=function(a,b){var c=this.graph.getModel(),d=a.text.boundingBox;if(mxUtils.intersects(d,b)){var e=-d.y-d.height+b.y,f=-d.y+b.y+b.height,e=Math.abs(e)<Math.abs(f)?e:f,f=-d.x-d.width+b.x,d=-d.x+b.x+b.width,d=Math.abs(f)<Math.abs(d)?f:d;Math.abs(d)<Math.abs(e)?e=0:d=0;f=c.getGeometry(a.cell);null!=f&&(f=f.clone(),null!=f.offset?(f.offset.x+=d,f.offset.y+=e):f.offset=new mxPoint(d,e),c.setGeometry(a.cell,f))}};
function mxGraphAbstractHierarchyCell(){this.x=[];this.y=[];this.temp=[]}mxGraphAbstractHierarchyCell.prototype.maxRank=-1;mxGraphAbstractHierarchyCell.prototype.minRank=-1;mxGraphAbstractHierarchyCell.prototype.x=null;mxGraphAbstractHierarchyCell.prototype.y=null;mxGraphAbstractHierarchyCell.prototype.width=0;mxGraphAbstractHierarchyCell.prototype.height=0;mxGraphAbstractHierarchyCell.prototype.nextLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.previousLayerConnectedCells=null;
mxGraphAbstractHierarchyCell.prototype.temp=null;mxGraphAbstractHierarchyCell.prototype.getNextLayerConnectedCells=function(){return null};mxGraphAbstractHierarchyCell.prototype.getPreviousLayerConnectedCells=function(){return null};mxGraphAbstractHierarchyCell.prototype.isEdge=function(){return!1};mxGraphAbstractHierarchyCell.prototype.isVertex=function(){return!1};mxGraphAbstractHierarchyCell.prototype.getGeneralPurposeVariable=function(){return null};
mxGraphAbstractHierarchyCell.prototype.setGeneralPurposeVariable=function(){return null};mxGraphAbstractHierarchyCell.prototype.setX=function(a,b){this.isVertex()?this.x[0]=b:this.isEdge()&&(this.x[a-this.minRank-1]=b)};mxGraphAbstractHierarchyCell.prototype.getX=function(a){return this.isVertex()?this.x[0]:this.isEdge()?this.x[a-this.minRank-1]:0};mxGraphAbstractHierarchyCell.prototype.setY=function(a,b){this.isVertex()?this.y[0]=b:this.isEdge()&&(this.y[a-this.minRank-1]=b)};
function mxGraphHierarchyNode(a){mxGraphAbstractHierarchyCell.apply(this,arguments);this.cell=a}mxGraphHierarchyNode.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyNode.prototype.constructor=mxGraphHierarchyNode;mxGraphHierarchyNode.prototype.cell=null;mxGraphHierarchyNode.prototype.connectsAsTarget=[];mxGraphHierarchyNode.prototype.connectsAsSource=[];mxGraphHierarchyNode.prototype.hashCode=!1;mxGraphHierarchyNode.prototype.getRankValue=function(){return this.maxRank};
mxGraphHierarchyNode.prototype.getNextLayerConnectedCells=function(a){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];this.nextLayerConnectedCells[0]=[];for(var b=0;b<this.connectsAsTarget.length;b++){var c=this.connectsAsTarget[b];-1==c.maxRank||c.maxRank==a+1?this.nextLayerConnectedCells[0].push(c.source):this.nextLayerConnectedCells[0].push(c)}}return this.nextLayerConnectedCells[0]};
mxGraphHierarchyNode.prototype.getPreviousLayerConnectedCells=function(a){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];this.previousLayerConnectedCells[0]=[];for(var b=0;b<this.connectsAsSource.length;b++){var c=this.connectsAsSource[b];-1==c.minRank||c.minRank==a-1?this.previousLayerConnectedCells[0].push(c.target):this.previousLayerConnectedCells[0].push(c)}}return this.previousLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.isVertex=function(){return!0};
mxGraphHierarchyNode.prototype.getGeneralPurposeVariable=function(){return this.temp[0]};mxGraphHierarchyNode.prototype.setGeneralPurposeVariable=function(a,b){this.temp[0]=b};mxGraphHierarchyNode.prototype.isAncestor=function(a){if(null!=a&&null!=this.hashCode&&null!=a.hashCode&&this.hashCode.length<a.hashCode.length){if(this.hashCode==a.hashCode)return!0;if(null==this.hashCode||null==this.hashCode)return!1;for(var b=0;b<this.hashCode.length;b++)if(this.hashCode[b]!=a.hashCode[b])return!1;return!0}return!1};
mxGraphHierarchyNode.prototype.getCoreCell=function(){return this.cell};function mxGraphHierarchyEdge(a){mxGraphAbstractHierarchyCell.apply(this,arguments);this.edges=a}mxGraphHierarchyEdge.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyEdge.prototype.constructor=mxGraphHierarchyEdge;mxGraphHierarchyEdge.prototype.edges=null;mxGraphHierarchyEdge.prototype.source=null;mxGraphHierarchyEdge.prototype.target=null;mxGraphHierarchyEdge.prototype.isReversed=!1;
mxGraphHierarchyEdge.prototype.invert=function(){var a=this.source;this.source=this.target;this.target=a;this.isReversed=!this.isReversed};
mxGraphHierarchyEdge.prototype.getNextLayerConnectedCells=function(a){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(var b=0;b<this.temp.length;b++)this.nextLayerConnectedCells[b]=[],b==this.temp.length-1?this.nextLayerConnectedCells[b].push(this.source):this.nextLayerConnectedCells[b].push(this)}return this.nextLayerConnectedCells[a-this.minRank-1]};
mxGraphHierarchyEdge.prototype.getPreviousLayerConnectedCells=function(a){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(var b=0;b<this.temp.length;b++)this.previousLayerConnectedCells[b]=[],0==b?this.previousLayerConnectedCells[b].push(this.target):this.previousLayerConnectedCells[b].push(this)}return this.previousLayerConnectedCells[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.isEdge=function(){return!0};
mxGraphHierarchyEdge.prototype.getGeneralPurposeVariable=function(a){return this.temp[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.setGeneralPurposeVariable=function(a,b){this.temp[a-this.minRank-1]=b};mxGraphHierarchyEdge.prototype.getCoreCell=function(){return null!=this.edges&&0<this.edges.length?this.edges[0]:null};
function mxGraphHierarchyModel(a,b,c,d,e){a.getGraph();this.tightenToSource=e;this.roots=c;this.parent=d;this.vertexMapper={};this.edgeMapper={};this.maxRank=0;c=[];null==b&&(b=this.graph.getChildVertices(d));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(a,b,c);for(d=0;d<b.length;d++){for(var e=c[d].connectsAsSource,f=0;f<e.length;f++){var g=e[f],h=g.edges;if(null!=h&&0<h.length){var h=h[0],k=a.getVisibleTerminal(h,!1),k=mxCellPath.create(k),k=this.vertexMapper[k];c[d]==k&&(k=a.getVisibleTerminal(h,
!0),k=mxCellPath.create(k),k=this.vertexMapper[k]);null!=k&&c[d]!=k&&(g.target=k,0==k.connectsAsTarget.length&&(k.connectsAsTarget=[]),0>mxUtils.indexOf(k.connectsAsTarget,g)&&k.connectsAsTarget.push(g))}}c[d].temp[0]=1}}mxGraphHierarchyModel.prototype.maxRank=null;mxGraphHierarchyModel.prototype.vertexMapper=null;mxGraphHierarchyModel.prototype.edgeMapper=null;mxGraphHierarchyModel.prototype.ranks=null;mxGraphHierarchyModel.prototype.roots=null;mxGraphHierarchyModel.prototype.parent=null;
mxGraphHierarchyModel.prototype.dfsCount=0;mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=1E8;mxGraphHierarchyModel.prototype.tightenToSource=!1;
mxGraphHierarchyModel.prototype.createInternalCells=function(a,b,c){for(var d=a.getGraph(),e=0;e<b.length;e++){c[e]=new mxGraphHierarchyNode(b[e]);this.vertexMapper[mxCellPath.create(b[e])]=c[e];var f=a.getEdges(b[e]);c[e].connectsAsSource=[];for(var g=0;g<f.length;g++){var h=a.getVisibleTerminal(f[g],!1);if(h!=b[e]&&h!=b[e]&&a.graph.model.isVertex(h)&&!a.isVertexIgnored(h)){var k=a.getEdgesBetween(b[e],h,!1),l=a.getEdgesBetween(b[e],h,!0),h=mxCellPath.create(k[0]);if(null!=k&&0<k.length&&null==this.edgeMapper[h]&&
2*l.length>=k.length){for(var l=new mxGraphHierarchyEdge(k),n=0;n<k.length;n++){var o=k[n],h=mxCellPath.create(o);this.edgeMapper[h]=l;d.resetEdge(o);a.disableEdgeStyle&&(a.setEdgeStyleEnabled(o,!1),a.setOrthogonalEdge(o,!0))}l.source=c[e];0>mxUtils.indexOf(c[e].connectsAsSource,l)&&c[e].connectsAsSource.push(l)}}}c[e].temp[0]=0}};
mxGraphHierarchyModel.prototype.initialRank=function(){var a=[];if(null!=this.roots)for(var b=0;b<this.roots.length;b++){var c=this.vertexMapper[mxCellPath.create(this.roots[b])];null!=c&&a.push(c)}for(var d in this.vertexMapper)c=this.vertexMapper[d],c.temp[0]=-1;for(var e=a.slice();0<a.length;){var c=a[0],f,g;f=c.connectsAsTarget;g=c.connectsAsSource;for(var h=!0,k=this.SOURCESCANSTARTRANK,b=0;b<f.length;b++){var l=f[b];if(5270620==l.temp[0])l=l.source,k=Math.min(k,l.temp[0]-1);else{h=!1;break}}if(h){c.temp[0]=
k;this.maxRank=Math.min(this.maxRank,k);if(null!=g)for(b=0;b<g.length;b++)l=g[b],l.temp[0]=5270620,l=l.target,-1==l.temp[0]&&(a.push(l),l.temp[0]=-2);a.shift()}else if(b=a.shift(),a.push(c),b==c&&1==a.length)break}for(d in this.vertexMapper)c=this.vertexMapper[d],c.temp[0]-=this.maxRank;for(b=0;b<e.length;b++){c=e[b];a=0;f=c.connectsAsSource;for(d=0;d<f.length;d++)l=f[d],l=l.target,c.temp[0]=Math.max(a,l.temp[0]+1),a=c.temp[0]}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank};
mxGraphHierarchyModel.prototype.fixRanks=function(){var a=[];this.ranks=[];for(var b=0;b<this.maxRank+1;b++)a[b]=[],this.ranks[b]=a[b];var c=null;if(null!=this.roots)for(var d=this.roots,c=[],b=0;b<d.length;b++){var e=this.vertexMapper[mxCellPath.create(d[b])];c[b]=e}this.visit(function(b,c,d,e,l){0==l&&0>c.maxRank&&0>c.minRank&&(a[c.temp[0]].push(c),c.maxRank=c.temp[0],c.minRank=c.temp[0],c.temp[0]=a[c.maxRank].length-1);if(null!=b&&null!=d&&1<b.maxRank-c.maxRank){d.maxRank=b.maxRank;d.minRank=c.maxRank;
d.temp=[];d.x=[];d.y=[];for(b=d.minRank+1;b<d.maxRank;b++)a[b].push(d),d.setGeneralPurposeVariable(b,a[b].length-1)}},c,!1,null)};mxGraphHierarchyModel.prototype.visit=function(a,b,c,d){if(null!=b){for(var e=0;e<b.length;e++){var f=b[e];null!=f&&(null==d&&(d={}),c?(f.hashCode=[],f.hashCode[0]=this.dfsCount,f.hashCode[1]=e,this.extendedDfs(null,f,null,a,d,f.hashCode,e,0)):this.dfs(null,f,null,a,d,0))}this.dfsCount++}};
mxGraphHierarchyModel.prototype.dfs=function(a,b,c,d,e,f){if(null!=b){var g=mxCellPath.create(b.cell);if(null==e[g]){e[g]=b;d(a,b,c,f,0);a=b.connectsAsSource.slice();for(c=0;c<a.length;c++)g=a[c],this.dfs(b,g.target,g,d,e,f+1)}else d(a,b,c,f,1)}};
mxGraphHierarchyModel.prototype.extendedDfs=function(a,b,c,d,e,f,g,h){if(null!=b){if(null!=a&&(null==b.hashCode||b.hashCode[0]!=a.hashCode[0]))f=a.hashCode.length+1,b.hashCode=a.hashCode.slice(),b.hashCode[f-1]=g;g=mxCellPath.create(b.cell);if(null==e[g]){e[g]=b;d(a,b,c,h,0);a=b.connectsAsSource.slice();for(c=0;c<a.length;c++)g=a[c],this.extendedDfs(b,g.target,g,d,e,b.hashCode,c,h+1)}else d(a,b,c,h,1)}};function mxHierarchicalLayoutStage(){}mxHierarchicalLayoutStage.prototype.execute=function(){};
function mxMedianHybridCrossingReduction(a){this.layout=a}mxMedianHybridCrossingReduction.prototype=new mxHierarchicalLayoutStage;mxMedianHybridCrossingReduction.prototype.constructor=mxMedianHybridCrossingReduction;mxMedianHybridCrossingReduction.prototype.layout=null;mxMedianHybridCrossingReduction.prototype.maxIterations=24;mxMedianHybridCrossingReduction.prototype.nestedBestRanks=null;mxMedianHybridCrossingReduction.prototype.currentBestCrossings=0;
mxMedianHybridCrossingReduction.prototype.iterationsWithoutImprovement=0;mxMedianHybridCrossingReduction.prototype.maxNoImprovementIterations=2;
mxMedianHybridCrossingReduction.prototype.execute=function(){var a=this.layout.getModel();this.nestedBestRanks=[];for(var b=0;b<a.ranks.length;b++)this.nestedBestRanks[b]=a.ranks[b].slice();for(var c=0,d=this.calculateCrossings(a),b=0;b<this.maxIterations&&c<this.maxNoImprovementIterations;b++){this.weightedMedian(b,a);this.transpose(b,a);var e=this.calculateCrossings(a);if(e<d){d=e;for(e=c=0;e<this.nestedBestRanks.length;e++)for(var f=a.ranks[e],g=0;g<f.length;g++){var h=f[g];this.nestedBestRanks[e][h.getGeneralPurposeVariable(e)]=
h}}else{c++;for(e=0;e<this.nestedBestRanks.length;e++){f=a.ranks[e];for(g=0;g<f.length;g++)h=f[g],h.setGeneralPurposeVariable(e,g)}}if(0==d)break}c=[];d=[];for(b=0;b<a.maxRank+1;b++)d[b]=[],c[b]=d[b];for(b=0;b<this.nestedBestRanks.length;b++)for(e=0;e<this.nestedBestRanks[b].length;e++)d[b].push(this.nestedBestRanks[b][e]);a.ranks=c};mxMedianHybridCrossingReduction.prototype.calculateCrossings=function(a){for(var b=a.ranks.length,c=0,d=1;d<b;d++)c+=this.calculateRankCrossing(d,a);return c};
mxMedianHybridCrossingReduction.prototype.calculateRankCrossing=function(a,b){for(var c=0,d=b.ranks[a],e=d.length,f=b.ranks[a-1].length,g=[],h=0;h<e;h++)g[h]=[];for(h=0;h<d.length;h++)for(var k=d[h],l=k.getGeneralPurposeVariable(a),n=k.getPreviousLayerConnectedCells(a),k=0;k<n.length;k++){var o=n[k].getGeneralPurposeVariable(a-1);g[l][o]=201207}for(h=0;h<e;h++)for(k=0;k<f;k++)if(201207==g[h][k]){for(d=h+1;d<e;d++)for(l=0;l<k;l++)201207==g[d][l]&&c++;for(d=0;d<h;d++)for(l=k+1;l<f;l++)201207==g[d][l]&&
c++}return c/2};
mxMedianHybridCrossingReduction.prototype.transpose=function(a,b){for(var c=!0,d=0;c&&10>d++;)for(var e=1==a%2&&1==d%2,c=!1,f=0;f<b.ranks.length;f++){for(var g=b.ranks[f],h=[],k=0;k<g.length;k++){var l=g[k],n=l.getGeneralPurposeVariable(f);0>n&&(n=k);h[n]=l}for(var o=n=l=null,p=null,r=null,s=null,u=null,w=null,v=null,x=null,k=0;k<g.length-1;k++){if(0==k){for(var v=h[k],l=v.getNextLayerConnectedCells(f),n=v.getPreviousLayerConnectedCells(f),r=[],s=[],B=0;B<l.length;B++)r[B]=l[B].getGeneralPurposeVariable(f+1);
for(B=0;B<n.length;B++)s[B]=n[B].getGeneralPurposeVariable(f-1)}else l=o,n=p,r=u,s=w,v=x;x=h[k+1];o=x.getNextLayerConnectedCells(f);p=x.getPreviousLayerConnectedCells(f);u=[];w=[];for(B=0;B<o.length;B++)u[B]=o[B].getGeneralPurposeVariable(f+1);for(B=0;B<p.length;B++)w[B]=p[B].getGeneralPurposeVariable(f-1);for(var z=0,A=0,B=0;B<r.length;B++)for(var J=0;J<u.length;J++)r[B]>u[J]&&z++,r[B]<u[J]&&A++;for(B=0;B<s.length;B++)for(J=0;J<w.length;J++)s[B]>w[J]&&z++,s[B]<w[J]&&A++;if(A<z||A==z&&e)o=v.getGeneralPurposeVariable(f),
v.setGeneralPurposeVariable(f,x.getGeneralPurposeVariable(f)),x.setGeneralPurposeVariable(f,o),o=l,p=n,u=r,w=s,x=v,e||(c=!0)}}};mxMedianHybridCrossingReduction.prototype.weightedMedian=function(a,b){var c=0==a%2;if(c)for(var d=b.maxRank-1;0<=d;d--)this.medianRank(d,c);else for(d=1;d<b.maxRank;d++)this.medianRank(d,c)};
mxMedianHybridCrossingReduction.prototype.medianRank=function(a,b){for(var c=this.nestedBestRanks[a].length,d=[],e=[],f=0;f<c;f++){var g=this.nestedBestRanks[a][f],h=new MedianCellSorter;h.cell=g;var k;k=b?g.getNextLayerConnectedCells(a):g.getPreviousLayerConnectedCells(a);var l;l=b?a+1:a-1;null!=k&&0!=k.length?(h.medianValue=this.medianValue(k,l),d.push(h)):e[g.getGeneralPurposeVariable(a)]=!0}d.sort(MedianCellSorter.prototype.compare);for(f=0;f<c;f++)null==e[f]&&(g=d.shift().cell,g.setGeneralPurposeVariable(a,
f))};mxMedianHybridCrossingReduction.prototype.medianValue=function(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e];c[d++]=f.getGeneralPurposeVariable(b)}c.sort(function(a,b){return a-b});if(1==d%2)return c[Math.floor(d/2)];if(2==d)return(c[0]+c[1])/2;e=d/2;f=c[e-1]-c[0];d=c[d-1]-c[e];return(c[e-1]*d+c[e]*f)/(f+d)};function MedianCellSorter(){}MedianCellSorter.prototype.medianValue=0;MedianCellSorter.prototype.cell=!1;
MedianCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.medianValue>a.medianValue?-1:b.medianValue<a.medianValue?1:0:0};function mxMinimumCycleRemover(a){this.layout=a}mxMinimumCycleRemover.prototype=new mxHierarchicalLayoutStage;mxMinimumCycleRemover.prototype.constructor=mxMinimumCycleRemover;mxMinimumCycleRemover.prototype.layout=null;
mxMinimumCycleRemover.prototype.execute=function(){var a=this.layout.getModel(),b={},c=mxUtils.clone(a.vertexMapper,null,!0),d=null;if(null!=a.roots)for(var e=a.roots,d=[],f=0;f<e.length;f++){var g=mxCellPath.create(e[f]);d[f]=a.vertexMapper[g]}a.visit(function(a,d,e){d.isAncestor(a)&&(e.invert(),mxUtils.remove(e,a.connectsAsSource),a.connectsAsTarget.push(e),mxUtils.remove(e,d.connectsAsTarget),d.connectsAsSource.push(e));a=mxCellPath.create(d.cell);b[a]=d;delete c[a]},d,!0,null);d=null;0<c.lenth&&
(d=mxUtils.clone(c,null,!0));f=mxUtils.clone(b,null,!0);a.visit(function(a,d,e){d.isAncestor(a)&&(e.invert(),mxUtils.remove(e,a.connectsAsSource),d.connectsAsSource.push(e),a.connectsAsTarget.push(e),mxUtils.remove(e,d.connectsAsTarget));a=mxCellPath.create(d.cell);b[a]=d;delete c[a]},c,!0,f);e=this.layout.getGraph();if(null!=d&&0<d.length){a=a.roots;for(f=0;f<d.length;f++)g=d[f].cell,0==e.getIncomingEdges(g).length&&a.push(g)}};
function mxCoordinateAssignment(a,b,c,d,e,f){this.layout=a;this.intraCellSpacing=b;this.interRankCellSpacing=c;this.orientation=d;this.initialX=e;this.parallelEdgeSpacing=f}var mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage;mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment;mxCoordinateAssignment.prototype.layout=null;mxCoordinateAssignment.prototype.intraCellSpacing=30;
mxCoordinateAssignment.prototype.interRankCellSpacing=100;mxCoordinateAssignment.prototype.parallelEdgeSpacing=10;mxCoordinateAssignment.prototype.maxIterations=8;mxCoordinateAssignment.prototype.prefHozEdgeSep=5;mxCoordinateAssignment.prototype.prefVertEdgeOff=2;mxCoordinateAssignment.prototype.minEdgeJetty=12;mxCoordinateAssignment.prototype.channelBuffer=4;mxCoordinateAssignment.prototype.jettyPositions=null;mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH;
mxCoordinateAssignment.prototype.initialX=null;mxCoordinateAssignment.prototype.limitX=null;mxCoordinateAssignment.prototype.currentXDelta=null;mxCoordinateAssignment.prototype.widestRank=null;mxCoordinateAssignment.prototype.rankTopY=null;mxCoordinateAssignment.prototype.rankBottomY=null;mxCoordinateAssignment.prototype.widestRankValue=null;mxCoordinateAssignment.prototype.rankWidths=null;mxCoordinateAssignment.prototype.rankY=null;mxCoordinateAssignment.prototype.fineTuning=!0;
mxCoordinateAssignment.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxCoordinateAssignment.prototype.nextLayerConnectedCache=null;mxCoordinateAssignment.prototype.previousLayerConnectedCache=null;mxCoordinateAssignment.prototype.groupPadding=10;
mxCoordinateAssignment.prototype.printStatus=function(){var a=this.layout.getModel();mxLog.show();mxLog.writeln("======Coord assignment debug=======");for(var b=0;b<a.ranks.length;b++){mxLog.write("Rank ",b," : ");for(var c=a.ranks[b],d=0;d<c.length;d++)mxLog.write(c[d].getGeneralPurposeVariable(b),"  ");mxLog.writeln()}mxLog.writeln("====================================")};
mxCoordinateAssignment.prototype.execute=function(){this.jettyPositions=[];var a=this.layout.getModel();this.currentXDelta=0;this.initialCoords(this.layout.getGraph(),a);this.fineTuning&&this.minNode(a);var b=1E8;if(this.fineTuning)for(var c=0;c<this.maxIterations;c++){0!=c&&(this.medianPos(c,a),this.minNode(a));if(this.currentXDelta<b){for(var d=0;d<a.ranks.length;d++)for(var e=a.ranks[d],f=0;f<e.length;f++){var g=e[f];g.setX(d,g.getGeneralPurposeVariable(d))}b=this.currentXDelta}else for(d=0;d<
a.ranks.length;d++){e=a.ranks[d];for(f=0;f<e.length;f++)g=e[f],g.setGeneralPurposeVariable(d,g.getX(d))}this.minPath(this.layout.getGraph(),a);this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),a)};
mxCoordinateAssignment.prototype.minNode=function(a){for(var b=[],c=[],d=[],e=0;e<=a.maxRank;e++){d[e]=a.ranks[e];for(var f=0;f<d[e].length;f++){var g=d[e][f],h=new WeightedCellSorter(g,e);h.rankIndex=f;h.visited=!0;b.push(h);g=mxCellPath.create(g.getCoreCell());c[g]=h}}a=10*b.length;for(f=0;0<b.length&&f<=a;){var h=b.shift(),e=h.cell,k=h.weightedValue,l=parseInt(h.rankIndex),g=e.getNextLayerConnectedCells(k),n=e.getPreviousLayerConnectedCells(k),o=g.length,p=n.length,r=this.medianXValue(g,k+1),s=
this.medianXValue(n,k-1),u=o+p,w=e.getGeneralPurposeVariable(k),v=w;0<u&&(v=(r*o+s*p)/u);o=!1;v<w-1?0==l?(e.setGeneralPurposeVariable(k,v),o=!0):(l=d[k][l-1],w=l.getGeneralPurposeVariable(k),w=w+l.width/2+this.intraCellSpacing+e.width/2,w<v?(e.setGeneralPurposeVariable(k,v),o=!0):w<e.getGeneralPurposeVariable(k)-1&&(e.setGeneralPurposeVariable(k,w),o=!0)):v>w+1&&(l==d[k].length-1?(e.setGeneralPurposeVariable(k,v),o=!0):(l=d[k][l+1],w=l.getGeneralPurposeVariable(k),w=w-l.width/2-this.intraCellSpacing-
e.width/2,w>v?(e.setGeneralPurposeVariable(k,v),o=!0):w>e.getGeneralPurposeVariable(k)+1&&(e.setGeneralPurposeVariable(k,w),o=!0)));if(o){for(e=0;e<g.length;e++)k=g[e],k=mxCellPath.create(k.getCoreCell()),k=c[k],null!=k&&!1==k.visited&&(k.visited=!0,b.push(k));for(e=0;e<n.length;e++)k=n[e],k=mxCellPath.create(k.getCoreCell()),k=c[k],null!=k&&!1==k.visited&&(k.visited=!0,b.push(k))}h.visited=!1;f++}};
mxCoordinateAssignment.prototype.medianPos=function(a,b){if(0==a%2)for(var c=b.maxRank;0<c;c--)this.rankMedianPosition(c-1,b,c);else for(c=0;c<b.maxRank-1;c++)this.rankMedianPosition(c+1,b,c)};
mxCoordinateAssignment.prototype.rankMedianPosition=function(a,b,c){for(var b=b.ranks[a],d=[],e=[],f=0;f<b.length;f++){var g=b[f];d[f]=new WeightedCellSorter;d[f].cell=g;d[f].rankIndex=f;var h=mxCellPath.create(g.getCoreCell());e[h]=d[f];var k=null,k=c<a?g.getPreviousLayerConnectedCells(a):g.getNextLayerConnectedCells(a);d[f].weightedValue=this.calculatedWeightedValue(g,k)}d.sort(WeightedCellSorter.prototype.compare);for(f=0;f<d.length;f++){h=0;g=d[f].cell;h=0;k=c<a?g.getPreviousLayerConnectedCells(a).slice():
g.getNextLayerConnectedCells(a).slice();null!=k&&(h=k.length,h=0<h?this.medianXValue(k,c):g.getGeneralPurposeVariable(a));for(var l=0,k=-1E8,n=d[f].rankIndex-1;0<=n;){var o=mxCellPath.create(b[n].getCoreCell()),o=e[o];if(null!=o){var p=o.cell;o.visited?(k=p.getGeneralPurposeVariable(a)+p.width/2+this.intraCellSpacing+l+g.width/2,n=-1):(l+=p.width+this.intraCellSpacing,n--)}}l=0;p=1E8;for(n=d[f].rankIndex+1;n<d.length;)if(o=mxCellPath.create(b[n].getCoreCell()),o=e[o],null!=o){var r=o.cell;o.visited?
(p=r.getGeneralPurposeVariable(a)-r.width/2-this.intraCellSpacing-l-g.width/2,n=d.length):(l+=r.width+this.intraCellSpacing,n++)}h>=k&&h<=p?g.setGeneralPurposeVariable(a,h):h<k?(g.setGeneralPurposeVariable(a,k),this.currentXDelta+=k-h):h>p&&(g.setGeneralPurposeVariable(a,p),this.currentXDelta+=h-p);d[f].visited=!0}};mxCoordinateAssignment.prototype.calculatedWeightedValue=function(a,b){for(var c=0,d=0;d<b.length;d++){var e=b[d];a.isVertex()&&e.isVertex()?c++:c=a.isEdge()&&e.isEdge()?c+8:c+2}return c};
mxCoordinateAssignment.prototype.medianXValue=function(a,b){if(0==a.length)return 0;for(var c=[],d=0;d<a.length;d++)c[d]=a[d].getGeneralPurposeVariable(b);c.sort(function(a,b){return a-b});if(1==a.length%2)return c[Math.floor(a.length/2)];d=a.length/2;return(c[d-1]+c[d])/2};
mxCoordinateAssignment.prototype.initialCoords=function(a,b){this.calculateWidestRank(a,b);for(var c=this.widestRank;0<=c;c--)c<b.maxRank&&this.rankCoordinates(c,a,b);for(c=this.widestRank+1;c<=b.maxRank;c++)0<c&&this.rankCoordinates(c,a,b)};
mxCoordinateAssignment.prototype.rankCoordinates=function(a,b,c){for(var b=c.ranks[a],c=0,d=this.initialX+(this.widestRankValue-this.rankWidths[a])/2,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.isVertex()){var h=this.layout.getVertexBounds(g.cell);null!=h?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(g.width=h.width,g.height=h.height):(g.width=h.height,g.height=h.width):e=!0;c=Math.max(c,g.height)}else g.isEdge()&&(h=1,null!=g.edges?h=g.edges.length:mxLog.warn("edge.edges is null"),
g.width=(h-1)*this.parallelEdgeSpacing);d+=g.width/2;g.setX(a,d);g.setGeneralPurposeVariable(a,d);d+=g.width/2;d+=this.intraCellSpacing}!0==e&&mxLog.warn("At least one cell has no bounds")};
mxCoordinateAssignment.prototype.calculateWidestRank=function(a,b){var c=-this.interRankCellSpacing,d=0;this.rankWidths=[];this.rankY=[];for(var e=b.maxRank;0<=e;e--){for(var f=0,g=b.ranks[e],h=this.initialX,k=!1,l=0;l<g.length;l++){var n=g[l];if(n.isVertex()){var o=this.layout.getVertexBounds(n.cell);null!=o?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(n.width=o.width,n.height=o.height):(n.width=o.height,n.height=o.width):k=!0;f=Math.max(f,n.height)}else n.isEdge()&&
(o=1,null!=n.edges?o=n.edges.length:mxLog.warn("edge.edges is null"),n.width=(o-1)*this.parallelEdgeSpacing);h+=n.width/2;n.setX(e,h);n.setGeneralPurposeVariable(e,h);h+=n.width/2;h+=this.intraCellSpacing;h>this.widestRankValue&&(this.widestRankValue=h,this.widestRank=e);this.rankWidths[e]=h}!0==k&&mxLog.warn("At least one cell has no bounds");this.rankY[e]=c;h=f/2+d/2+this.interRankCellSpacing;d=f;c=this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?c+h:c-
h;for(l=0;l<g.length;l++)g[l].setY(e,c)}};
mxCoordinateAssignment.prototype.minPath=function(a,b){var c=b.edgeMapper,d;for(d in c){var e=c[d];if(!(1>e.maxRank-e.minRank-1)){for(var f=e.getGeneralPurposeVariable(e.minRank+1),g=!0,h=0,k=e.minRank+2;k<e.maxRank;k++){var l=e.getGeneralPurposeVariable(k);f!=l?(g=!1,f=l):h++}if(!g){for(var g=f=0,l=[],n=[],o=e.getGeneralPurposeVariable(e.minRank+1),k=e.minRank+1;k<e.maxRank-1;k++){var p=e.getX(k+1);o==p?(l[k-e.minRank-1]=o,f++):this.repositionValid(b,e,k+1,o)?(l[k-e.minRank-1]=o,f++):o=l[k-e.minRank-
1]=p}o=e.getX(k);for(k=e.maxRank-1;k>e.minRank+1;k--)p=e.getX(k-1),o==p?(n[k-e.minRank-2]=o,g++):this.repositionValid(b,e,k-1,o)?(n[k-e.minRank-2]=o,g++):(n[k-e.minRank-2]=e.getX(k-1),o=p);if(g>h||f>h)if(g>=f)for(k=e.maxRank-2;k>e.minRank;k--)e.setX(k,n[k-e.minRank-1]);else if(f>g)for(k=e.minRank+2;k<e.maxRank;k++)e.setX(k,l[k-e.minRank-2])}}}};
mxCoordinateAssignment.prototype.repositionValid=function(a,b,c,d){for(var a=a.ranks[c],e=-1,f=0;f<a.length;f++)if(b==a[f]){e=f;break}if(0>e)return!1;f=b.getGeneralPurposeVariable(c);if(d<f){if(0==e)return!0;a=a[e-1];c=a.getGeneralPurposeVariable(c);c=c+a.width/2+this.intraCellSpacing+b.width/2;if(!(c<=d))return!1}else if(d>f){if(e==a.length-1)return!0;a=a[e+1];c=a.getGeneralPurposeVariable(c);c=c-a.width/2-this.intraCellSpacing-b.width/2;if(!(c>=d))return!1}return!0};
mxCoordinateAssignment.prototype.setCellLocations=function(a,b){this.rankTopY=[];this.rankBottomY=[];for(var c=0;c<b.ranks.length;c++)this.rankTopY[c]=Number.MAX_VALUE,this.rankBottomY[c]=0;c=null;this.layout.resizeParent&&(c={});var d=b.edgeMapper,e=b.vertexMapper,f;for(f in e){var g=e[f];this.setVertexLocation(g);if(this.layout.resizeParent){var g=a.model.getParent(g.cell),h=mxCellPath.create(g);null==c[h]&&(c[h]=g)}}this.layout.resizeParent&&null!=c&&this.adjustParents(c);(this.edgeStyle==mxHierarchicalEdgeStyle.ORTHOGONAL||
this.edgeStyle==mxHierarchicalEdgeStyle.POLYLINE||this.edgeStyle==mxHierarchicalEdgeStyle.CURVE)&&this.localEdgeProcessing(b);for(f in d)this.setEdgePosition(d[f])};mxCoordinateAssignment.prototype.adjustParents=function(a){var b=[],c;for(c in a)b.push(a[c]);this.layout.arrangeGroups(mxUtils.sortCells(b,!0),this.groupPadding)};
mxCoordinateAssignment.prototype.localEdgeProcessing=function(a){for(var b=0;b<a.ranks.length;b++)for(var c=a.ranks[b],d=0;d<c.length;d++){var e=c[d];if(e.isVertex())for(var f=e.getPreviousLayerConnectedCells(b),g=b-1,h=0;2>h;h++){if(-1<g&&g<a.ranks.length&&null!=f&&0<f.length){for(var k=[],l=0;l<f.length;l++){var n=new WeightedCellSorter(f[l],f[l].getX(g));k.push(n)}k.sort(WeightedCellSorter.prototype.compare);for(var n=e.x[0]-e.width/2,o=n+e.width,p=f=0,g=[],l=0;l<k.length;l++){var r=k[l].cell,
s;if(r.isVertex()){s=0==h?e.connectsAsSource:e.connectsAsTarget;for(var u=0;u<s.length;u++)if(s[u].source==r||s[u].target==r)f+=s[u].edges.length,p++,g.push(s[u])}else f+=r.edges.length,p++,g.push(r)}e.width>(f+1)*this.prefHozEdgeSep+2*this.prefHozEdgeSep&&(n+=this.prefHozEdgeSep,o-=this.prefHozEdgeSep);k=(o-n)/f;n+=k/2;o=this.minEdgeJetty-this.prefVertEdgeOff;for(l=p=0;l<g.length;l++){r=g[l].edges.length;u=mxCellPath.create(g[l].edges[0]);s=this.jettyPositions[u];null==s&&(s=[],this.jettyPositions[u]=
s);l<f/2?o+=this.prefVertEdgeOff:l>f/2&&(o-=this.prefVertEdgeOff);for(u=0;u<r;u++)s[4*u+2*h]=n,n+=k,s[4*u+2*h+1]=o;p=Math.max(p,o)}}f=e.getNextLayerConnectedCells(b);g=b+1}}};
mxCoordinateAssignment.prototype.setEdgePosition=function(a){var b=0;if(101207!=a.temp[0]){var c=a.maxRank,d=a.minRank;c==d&&(c=a.source.maxRank,d=a.target.minRank);for(var e=0,f=this.jettyPositions[mxCellPath.create(a.edges[0])],g=a.isReversed?a.target.cell:a.source.cell,h=this.layout.graph,k=0;k<a.edges.length;k++){var l=a.edges[k],n=this.layout.getVisibleTerminal(l,!0),o=h.model.getTerminal(l,!0),p=[],r=a.isReversed;n!=g&&(r=!r);if(null!=f){var s=r?2:0,u=r?this.rankTopY[d]:this.rankBottomY[c],
w=f[4*e+1+s];r&&(w=-w);u+=w;s=f[4*e+s];o=h.model.getTerminal(l,!0);this.layout.isPort(o)&&h.model.getParent(o)==n&&(s=h.view.getState(o),s=null!=s?s.x:n.geometry.x+a.source.width*o.geometry.x);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(p.push(new mxPoint(s,u)),this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&p.push(new mxPoint(s,u+w))):(p.push(new mxPoint(u,s)),this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&p.push(new mxPoint(u+w,s)))}s=a.x.length-
1;u=w=-1;n=a.maxRank-1;r&&(s=0,w=a.x.length,u=1,n=a.minRank+1);for(;a.maxRank!=a.minRank&&s!=w;s+=u){var o=a.x[s]+b,v=(this.rankTopY[n]+this.rankBottomY[n+1])/2,x=(this.rankTopY[n-1]+this.rankBottomY[n])/2;if(r)var B=v,v=x,x=B;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(p.push(new mxPoint(o,v)),p.push(new mxPoint(o,x))):(p.push(new mxPoint(v,o)),p.push(new mxPoint(x,o)));this.limitX=Math.max(this.limitX,o);n+=u}null!=f&&(s=r?2:0,u=r?this.rankBottomY[c]:
this.rankTopY[d],w=f[4*e+3-s],r&&(w=-w),u-=w,s=f[4*e+2-s],r=h.model.getTerminal(l,!1),n=this.layout.getVisibleTerminal(l,!1),this.layout.isPort(r)&&h.model.getParent(r)==n&&(s=h.view.getState(r),s=null!=s?s.x:n.geometry.x+a.target.width*r.geometry.x),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&p.push(new mxPoint(s,u-w)),p.push(new mxPoint(s,u))):(this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&p.push(new mxPoint(u-
w,s)),p.push(new mxPoint(u,s))));a.isReversed&&this.processReversedEdge(a,l);this.layout.setEdgePoints(l,p);b=0==b?this.parallelEdgeSpacing:0<b?-b:-b+this.parallelEdgeSpacing;e++}a.temp[0]=101207}};
mxCoordinateAssignment.prototype.setVertexLocation=function(a){var b=a.cell,c=a.x[0]-a.width/2,d=a.y[0]-a.height/2;this.rankTopY[a.minRank]=Math.min(this.rankTopY[a.minRank],d);this.rankBottomY[a.minRank]=Math.max(this.rankBottomY[a.minRank],d+a.height);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(b,c,d):this.layout.setVertexLocation(b,d,c);this.limitX=Math.max(this.limitX,c+a.width)};
mxCoordinateAssignment.prototype.processReversedEdge=function(){};function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?-1:b.weightedValue<a.weightedValue?1:b.nudge?-1:1:0};
function mxHierarchicalLayout(a,b,c){mxGraphLayout.call(this,a);this.orientation=null!=b?b:mxConstants.DIRECTION_NORTH;this.deterministic=null!=c?c:!0}mxHierarchicalLayout.prototype=new mxGraphLayout;mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout;mxHierarchicalLayout.prototype.roots=null;mxHierarchicalLayout.prototype.resizeParent=!1;mxHierarchicalLayout.prototype.moveParent=!1;mxHierarchicalLayout.prototype.parentBorder=0;mxHierarchicalLayout.prototype.intraCellSpacing=30;
mxHierarchicalLayout.prototype.interRankCellSpacing=100;mxHierarchicalLayout.prototype.interHierarchySpacing=60;mxHierarchicalLayout.prototype.parallelEdgeSpacing=10;mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxHierarchicalLayout.prototype.fineTuning=!0;mxHierarchicalLayout.prototype.tightenToSource=!0;mxHierarchicalLayout.prototype.disableEdgeStyle=!0;mxHierarchicalLayout.prototype.traverseAncestors=!0;mxHierarchicalLayout.prototype.model=null;
mxHierarchicalLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.getModel=function(){return this.model};
mxHierarchicalLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.model;this.edgesCache={};"array"!==typeof b&&(b=[b]);if(!(null==b&&null==a)){if(null!=b&&null!=a){for(var d=[],e=0;e<b.length;e++)c.isAncestor(a,b[e])&&d.push(b[e]);this.roots=d}else this.roots=b;c.beginUpdate();try{this.run(a),this.resizeParent&&!this.graph.isCellCollapsed(a)&&this.graph.updateGroupBounds([a],this.parentBorder,this.moveParent)}finally{c.endUpdate()}}};
mxHierarchicalLayout.prototype.findRoots=function(a,b){var c=[];if(null!=a&&null!=b){var d=this.graph.model,e=null,f=-1E5,g;for(g in b){var h=b[g];if(d.isVertex(h)&&this.graph.isCellVisible(h)){for(var k=this.getEdges(h),l=0,n=0,o=0;o<k.length;o++)this.getVisibleTerminal(k[o],!0)==h?l++:n++;0==n&&0<l&&c.push(h);k=l-n;k>f&&(f=k,e=h)}}0==c.length&&null!=e&&c.push(e)}return c};
mxHierarchicalLayout.prototype.getEdges=function(a){var b=mxCellPath.create(a);if(null!=this.edgesCache[b])return this.edgesCache[b];for(var c=this.graph.model,d=[],e=this.graph.isCellCollapsed(a),f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g);if(this.isPort(h))d=d.concat(c.getEdges(h,!0,!0));else if(e||!this.graph.isCellVisible(h))d=d.concat(c.getEdges(h,!0,!0))}d=d.concat(c.getEdges(a,!0,!0));c=[];for(g=0;g<d.length;g++)e=this.getVisibleTerminal(d[g],!0),f=this.getVisibleTerminal(d[g],
!1),(e==f||e!=f&&(f==a&&(null==this.parent||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))||e==a&&(null==this.parent||this.graph.isValidAncestor(f,this.parent,this.traverseAncestors))))&&c.push(d[g]);return this.edgesCache[b]=c};mxHierarchicalLayout.prototype.getVisibleTerminal=function(a,b){var c=this.graph.view.getState(a),c=null!=c?c.getVisibleTerminal(b):this.graph.view.getVisibleTerminal(a,b);this.isPort(c)&&(c=this.graph.model.getParent(c));return c};
mxHierarchicalLayout.prototype.run=function(a){var b=[],c=[];if(null==this.roots&&null!=a){var d={};this.filterDescendants(a,d);this.roots=[];var e=!0,f;for(f in d)if(null!=d[f]){e=!1;break}for(;!e;){for(var g=this.findRoots(a,d),e=0;e<g.length;e++){var h=[];b.push(h);this.traverse(g[e],!0,null,c,h,b,d)}for(e=0;e<g.length;e++)this.roots.push(g[e]);e=!0;for(f in d)if(null!=d[f]){e=!1;break}}}else for(e=0;e<this.roots.length;e++)h=[],b.push(h),this.traverse(this.roots[e],!0,null,c,h,b,null);for(e=c=
0;e<b.length;e++){h=b[e];d=[];for(f in h)d.push(h[f]);this.model=new mxGraphHierarchyModel(this,d,this.roots,a,this.tightenToSource);this.cycleStage(a);this.layeringStage();this.crossingStage(a);c=this.placementStage(c,a)}};
mxHierarchicalLayout.prototype.filterDescendants=function(a,b){var c=this.graph.model;c.isVertex(a)&&a!=this.parent&&this.graph.isCellVisible(a)&&(b[mxCellPath.create(a)]=a);if(this.traverseAncestors||a==this.parent&&this.graph.isCellVisible(a))for(var d=c.getChildCount(a),e=0;e<d;e++){var f=c.getChildAt(a,e);this.isPort(f)||this.filterDescendants(f,b)}};mxHierarchicalLayout.prototype.isPort=function(a){return a.geometry.relative?!0:!1};
mxHierarchicalLayout.prototype.getEdgesBetween=function(a,b,c){for(var c=null!=c?c:!1,d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.getVisibleTerminal(d[f],!0),h=this.getVisibleTerminal(d[f],!1);(g==a&&h==b||!c&&g==b&&h==a)&&e.push(d[f])}return e};
mxHierarchicalLayout.prototype.traverse=function(a,b,c,d,e,f,g){if(null!=a&&null!=d){var h=mxCellPath.create(a);if(null==d[h]&&(null==g||null!=g[h])){null==e[h]&&(e[h]=a);null==d[h]&&(d[h]=a);null!==g&&delete g[h];for(var k=this.getEdges(a),c=0;c<k.length;c++)if(h=this.getVisibleTerminal(k[c],!0)==a,!b||h)e=this.traverse(this.getVisibleTerminal(k[c],!h),b,k[c],d,e,f,g)}else if(null==e[h])for(c=0;c<f.length;c++)if(a=f[c],null!=a[h]){for(k in e)a[k]=e[k];f.pop();return a}}return e};
mxHierarchicalLayout.prototype.cycleStage=function(a){(new mxMinimumCycleRemover(this)).execute(a)};mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxHierarchicalLayout.prototype.crossingStage=function(a){(new mxMedianHybridCrossingReduction(this)).execute(a)};
mxHierarchicalLayout.prototype.placementStage=function(a,b){var c=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);c.fineTuning=this.fineTuning;c.execute(b);return c.limitX+this.interHierarchySpacing};function mxGraphModel(a){this.currentEdit=this.createUndoableEdit();null!=a?this.setRoot(a):this.clear()}mxGraphModel.prototype=new mxEventSource;mxGraphModel.prototype.constructor=mxGraphModel;mxGraphModel.prototype.root=null;
mxGraphModel.prototype.cells=null;mxGraphModel.prototype.maintainEdgeParent=!0;mxGraphModel.prototype.createIds=!0;mxGraphModel.prototype.prefix="";mxGraphModel.prototype.postfix="";mxGraphModel.prototype.nextId=0;mxGraphModel.prototype.currentEdit=null;mxGraphModel.prototype.updateLevel=0;mxGraphModel.prototype.endingUpdate=!1;mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())};mxGraphModel.prototype.isCreateIds=function(){return this.createIds};
mxGraphModel.prototype.setCreateIds=function(a){this.createIds=a};mxGraphModel.prototype.createRoot=function(){var a=new mxCell;a.insert(new mxCell);return a};mxGraphModel.prototype.getCell=function(a){return null!=this.cells?this.cells[a]:null};mxGraphModel.prototype.filterCells=function(a,b){var c=null;if(null!=a)for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c};mxGraphModel.prototype.getDescendants=function(a){return this.filterDescendants(null,a)};
mxGraphModel.prototype.filterDescendants=function(a,b){var c=[],b=b||this.getRoot();(null==a||a(b))&&c.push(b);for(var d=this.getChildCount(b),e=0;e<d;e++)var f=this.getChildAt(b,e),c=c.concat(this.filterDescendants(a,f));return c};mxGraphModel.prototype.getRoot=function(a){var b=a||this.root;if(null!=a)for(;null!=a;)b=a,a=this.getParent(a);return b};mxGraphModel.prototype.setRoot=function(a){this.execute(new mxRootChange(this,a));return a};
mxGraphModel.prototype.rootChanged=function(a){var b=this.root;this.root=a;this.nextId=0;this.cells=null;this.cellAdded(a);return b};mxGraphModel.prototype.isRoot=function(a){return null!=a&&this.root==a};mxGraphModel.prototype.isLayer=function(a){return this.isRoot(this.getParent(a))};mxGraphModel.prototype.isAncestor=function(a,b){for(;null!=b&&b!=a;)b=this.getParent(b);return b==a};mxGraphModel.prototype.contains=function(a){return this.isAncestor(this.root,a)};
mxGraphModel.prototype.getParent=function(a){return null!=a?a.getParent():null};mxGraphModel.prototype.add=function(a,b,c){if(b!=a&&null!=a&&null!=b){null==c&&(c=this.getChildCount(a));var d=a!=this.getParent(b);this.execute(new mxChildChange(this,a,b,c));this.maintainEdgeParent&&d&&this.updateEdgeParents(b)}return b};
mxGraphModel.prototype.cellAdded=function(a){if(null!=a){null==a.getId()&&this.createIds&&a.setId(this.createId(a));if(null!=a.getId()){var b=this.getCell(a.getId());if(b!=a){for(;null!=b;)a.setId(this.createId(a)),b=this.getCell(a.getId());null==this.cells&&(this.cells={});this.cells[a.getId()]=a}}mxUtils.isNumeric(a.getId())&&(this.nextId=Math.max(this.nextId,a.getId()));for(var b=this.getChildCount(a),c=0;c<b;c++)this.cellAdded(this.getChildAt(a,c))}};
mxGraphModel.prototype.createId=function(){var a=this.nextId;this.nextId++;return this.prefix+a+this.postfix};mxGraphModel.prototype.updateEdgeParents=function(a,b){for(var b=b||this.getRoot(a),c=this.getChildCount(a),d=0;d<c;d++)this.updateEdgeParents(this.getChildAt(a,d),b);for(var e=this.getEdgeCount(a),c=[],d=0;d<e;d++)c.push(this.getEdgeAt(a,d));for(d=0;d<c.length;d++)e=c[d],this.isAncestor(b,e)&&this.updateEdgeParent(e,b)};
mxGraphModel.prototype.updateEdgeParent=function(a,b){for(var c=this.getTerminal(a,!0),d=this.getTerminal(a,!1),e=null;null!=c&&!this.isEdge(c)&&null!=c.geometry&&c.geometry.relative;)c=this.getParent(c);for(;null!=d&&!this.isEdge(d)&&null!=d.geometry&&d.geometry.relative;)d=this.getParent(d);if(this.isAncestor(b,c)&&this.isAncestor(b,d)&&(e=c==d?this.getParent(c):this.getNearestCommonAncestor(c,d),null!=e&&(this.getParent(e)!=this.root||this.isAncestor(e,a))&&this.getParent(a)!=e)){c=this.getGeometry(a);
if(null!=c){var f=this.getOrigin(this.getParent(a)),g=this.getOrigin(e),d=g.x-f.x,f=g.y-f.y,c=c.clone();c.translate(-d,-f);this.setGeometry(a,c)}this.add(e,a,this.getChildCount(e))}};mxGraphModel.prototype.getOrigin=function(a){var b=null;null!=a?(b=this.getOrigin(this.getParent(a)),this.isEdge(a)||(a=this.getGeometry(a),null!=a&&(b.x+=a.x,b.y+=a.y))):b=new mxPoint;return b};
mxGraphModel.prototype.getNearestCommonAncestor=function(a,b){if(null!=a&&null!=b){var c=mxCellPath.create(b);if(null!=c&&0<c.length){var d=a,e=mxCellPath.create(d);if(c.length<e.length)var d=b,f=e,e=c,c=f;for(;null!=d;){f=this.getParent(d);if(0==c.indexOf(e+mxCellPath.PATH_SEPARATOR)&&null!=f)return d;e=mxCellPath.getParentPath(e);d=f}}}return null};mxGraphModel.prototype.remove=function(a){a==this.root?this.setRoot(null):null!=this.getParent(a)&&this.execute(new mxChildChange(this,null,a));return a};
mxGraphModel.prototype.cellRemoved=function(a){if(null!=a&&null!=this.cells){for(var b=this.getChildCount(a)-1;0<=b;b--)this.cellRemoved(this.getChildAt(a,b));null!=this.cells&&null!=a.getId()&&delete this.cells[a.getId()]}};mxGraphModel.prototype.parentForCellChanged=function(a,b,c){var d=this.getParent(a);null!=b?(b!=d||d.getIndex(a)!=c)&&b.insert(a,c):null!=d&&(c=d.getIndex(a),d.remove(c));!this.contains(d)&&null!=b?this.cellAdded(a):null==b&&this.cellRemoved(a);return d};
mxGraphModel.prototype.getChildCount=function(a){return null!=a?a.getChildCount():0};mxGraphModel.prototype.getChildAt=function(a,b){return null!=a?a.getChildAt(b):null};mxGraphModel.prototype.getChildren=function(a){return null!=a?a.children:null};mxGraphModel.prototype.getChildVertices=function(a){return this.getChildCells(a,!0,!1)};mxGraphModel.prototype.getChildEdges=function(a){return this.getChildCells(a,!1,!0)};
mxGraphModel.prototype.getChildCells=function(a,b,c){for(var b=null!=b?b:!1,c=null!=c?c:!1,d=this.getChildCount(a),e=[],f=0;f<d;f++){var g=this.getChildAt(a,f);(!c&&!b||c&&this.isEdge(g)||b&&this.isVertex(g))&&e.push(g)}return e};mxGraphModel.prototype.getTerminal=function(a,b){return null!=a?a.getTerminal(b):null};
mxGraphModel.prototype.setTerminal=function(a,b,c){var d=b!=this.getTerminal(a,c);this.execute(new mxTerminalChange(this,a,b,c));this.maintainEdgeParent&&d&&this.updateEdgeParent(a,this.getRoot());return b};mxGraphModel.prototype.setTerminals=function(a,b,c){this.beginUpdate();try{this.setTerminal(a,b,!0),this.setTerminal(a,c,!1)}finally{this.endUpdate()}};
mxGraphModel.prototype.terminalForCellChanged=function(a,b,c){var d=this.getTerminal(a,c);null!=b?b.insertEdge(a,c):null!=d&&d.removeEdge(a,c);return d};mxGraphModel.prototype.getEdgeCount=function(a){return null!=a?a.getEdgeCount():0};mxGraphModel.prototype.getEdgeAt=function(a,b){return null!=a?a.getEdgeAt(b):null};mxGraphModel.prototype.getDirectedEdgeCount=function(a,b,c){for(var d=0,e=this.getEdgeCount(a),f=0;f<e;f++){var g=this.getEdgeAt(a,f);g!=c&&this.getTerminal(g,b)==a&&d++}return d};
mxGraphModel.prototype.getConnections=function(a){return this.getEdges(a,!0,!0,!1)};mxGraphModel.prototype.getIncomingEdges=function(a){return this.getEdges(a,!0,!1,!1)};mxGraphModel.prototype.getOutgoingEdges=function(a){return this.getEdges(a,!1,!0,!1)};
mxGraphModel.prototype.getEdges=function(a,b,c,d){for(var b=null!=b?b:!0,c=null!=c?c:!0,d=null!=d?d:!0,e=this.getEdgeCount(a),f=[],g=0;g<e;g++){var h=this.getEdgeAt(a,g),k=this.getTerminal(h,!0),l=this.getTerminal(h,!1);(d&&k==l||k!=l&&(b&&l==a||c&&k==a))&&f.push(h)}return f};
mxGraphModel.prototype.getEdgesBetween=function(a,b,c){var c=null!=c?c:!1,d=this.getEdgeCount(a),e=this.getEdgeCount(b),f=a,g=d;e<d&&(g=e,f=b);d=[];for(e=0;e<g;e++){var h=this.getEdgeAt(f,e),k=this.getTerminal(h,!0),l=this.getTerminal(h,!1),n=l==a&&k==b;(k==a&&l==b||!c&&n)&&d.push(h)}return d};
mxGraphModel.prototype.getOpposites=function(a,b,c,d){var c=null!=c?c:!0,d=null!=d?d:!0,e=[];if(null!=a)for(var f=0;f<a.length;f++){var g=this.getTerminal(a[f],!0),h=this.getTerminal(a[f],!1);g==b&&null!=h&&h!=b&&d?e.push(h):h==b&&null!=g&&g!=b&&c&&e.push(g)}return e};mxGraphModel.prototype.getTopmostCells=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=!0,f=this.getParent(d);null!=f;){if(0<=mxUtils.indexOf(a,f)){e=!1;break}f=this.getParent(f)}e&&b.push(d)}return b};
mxGraphModel.prototype.isVertex=function(a){return null!=a?a.isVertex():!1};mxGraphModel.prototype.isEdge=function(a){return null!=a?a.isEdge():!1};mxGraphModel.prototype.isConnectable=function(a){return null!=a?a.isConnectable():!1};mxGraphModel.prototype.getValue=function(a){return null!=a?a.getValue():null};mxGraphModel.prototype.setValue=function(a,b){this.execute(new mxValueChange(this,a,b));return b};mxGraphModel.prototype.valueForCellChanged=function(a,b){return a.valueChanged(b)};
mxGraphModel.prototype.getGeometry=function(a){return null!=a?a.getGeometry():null};mxGraphModel.prototype.setGeometry=function(a,b){b!=this.getGeometry(a)&&this.execute(new mxGeometryChange(this,a,b));return b};mxGraphModel.prototype.geometryForCellChanged=function(a,b){var c=this.getGeometry(a);a.setGeometry(b);return c};mxGraphModel.prototype.getStyle=function(a){return null!=a?a.getStyle():null};
mxGraphModel.prototype.setStyle=function(a,b){b!=this.getStyle(a)&&this.execute(new mxStyleChange(this,a,b));return b};mxGraphModel.prototype.styleForCellChanged=function(a,b){var c=this.getStyle(a);a.setStyle(b);return c};mxGraphModel.prototype.isCollapsed=function(a){return null!=a?a.isCollapsed():!1};mxGraphModel.prototype.setCollapsed=function(a,b){b!=this.isCollapsed(a)&&this.execute(new mxCollapseChange(this,a,b));return b};
mxGraphModel.prototype.collapsedStateForCellChanged=function(a,b){var c=this.isCollapsed(a);a.setCollapsed(b);return c};mxGraphModel.prototype.isVisible=function(a){return null!=a?a.isVisible():!1};mxGraphModel.prototype.setVisible=function(a,b){b!=this.isVisible(a)&&this.execute(new mxVisibleChange(this,a,b));return b};mxGraphModel.prototype.visibleStateForCellChanged=function(a,b){var c=this.isVisible(a);a.setVisible(b);return c};
mxGraphModel.prototype.execute=function(a){a.execute();this.beginUpdate();this.currentEdit.add(a);this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",a));this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",a));this.endUpdate()};mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++;this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE));1==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))};
mxGraphModel.prototype.endUpdate=function(){this.updateLevel--;0==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT));if(!this.endingUpdate){this.endingUpdate=0==this.updateLevel;this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var a=this.currentEdit;this.currentEdit=this.createUndoableEdit();a.notify();this.fireEvent(new mxEventObject(mxEvent.UNDO,
"edit",a))}}finally{this.endingUpdate=!1}}};mxGraphModel.prototype.createUndoableEdit=function(){var a=new mxUndoableEdit(this,!0);a.notify=function(){a.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",a,"changes",a.changes));a.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",a,"changes",a.changes))};return a};
mxGraphModel.prototype.mergeChildren=function(a,b,c){c=null!=c?c:!0;this.beginUpdate();try{var d={};this.mergeChildrenImpl(a,b,c,d);for(var e in d){var f=d[e],g=this.getTerminal(f,!0);null!=g&&(g=d[mxCellPath.create(g)],this.setTerminal(f,g,!0));g=this.getTerminal(f,!1);null!=g&&(g=d[mxCellPath.create(g)],this.setTerminal(f,g,!1))}}finally{this.endUpdate()}};
mxGraphModel.prototype.mergeChildrenImpl=function(a,b,c,d){this.beginUpdate();try{for(var e=a.getChildCount(),f=0;f<e;f++){var g=a.getChildAt(f);if("function"==typeof g.getId){var h=g.getId(),k=null!=h&&(!this.isEdge(g)||!c)?this.getCell(h):null;if(null==k){var l=g.clone();l.setId(h);l.setTerminal(g.getTerminal(!0),!0);l.setTerminal(g.getTerminal(!1),!1);k=b.insert(l);this.cellAdded(k)}d[mxCellPath.create(g)]=k;this.mergeChildrenImpl(g,k,c,d)}}}finally{this.endUpdate()}};
mxGraphModel.prototype.getParents=function(a){var b=[];if(null!=a)for(var c={},d=0;d<a.length;d++){var e=this.getParent(a[d]);if(null!=e){var f=mxCellPath.create(e);null==c[f]&&(c[f]=e,b.push(e))}}return b};mxGraphModel.prototype.cloneCell=function(a){return null!=a?this.cloneCells([a],!0)[0]:null};
mxGraphModel.prototype.cloneCells=function(a,b){for(var c={},d=[],e=0;e<a.length;e++)null!=a[e]?d.push(this.cloneCellImpl(a[e],c,b)):d.push(null);for(e=0;e<d.length;e++)null!=d[e]&&this.restoreClone(d[e],a[e],c);return d};mxGraphModel.prototype.cloneCellImpl=function(a,b,c){var d=this.cellCloned(a);b[mxObjectIdentity.get(a)]=d;if(c)for(var c=this.getChildCount(a),e=0;e<c;e++){var f=this.cloneCellImpl(this.getChildAt(a,e),b,!0);d.insert(f)}return d};mxGraphModel.prototype.cellCloned=function(a){return a.clone()};
mxGraphModel.prototype.restoreClone=function(a,b,c){var d=this.getTerminal(b,!0);null!=d&&(d=c[mxObjectIdentity.get(d)],null!=d&&d.insertEdge(a,!0));d=this.getTerminal(b,!1);null!=d&&(d=c[mxObjectIdentity.get(d)],null!=d&&d.insertEdge(a,!1));for(var d=this.getChildCount(a),e=0;e<d;e++)this.restoreClone(this.getChildAt(a,e),this.getChildAt(b,e),c)};function mxRootChange(a,b){this.model=a;this.previous=this.root=b}mxRootChange.prototype.execute=function(){this.root=this.previous;this.previous=this.model.rootChanged(this.previous)};
function mxChildChange(a,b,c,d){this.model=a;this.previous=this.parent=b;this.child=c;this.previousIndex=this.index=d}
mxChildChange.prototype.execute=function(){var a=this.model.getParent(this.child),b=null!=a?a.getIndex(this.child):0;null==this.previous&&this.connect(this.child,!1);a=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex);null!=this.previous&&this.connect(this.child,!0);this.parent=this.previous;this.previous=a;this.index=this.previousIndex;this.previousIndex=b};
mxChildChange.prototype.connect=function(a,b){var b=null!=b?b:!0,c=a.getTerminal(!0),d=a.getTerminal(!1);null!=c&&(b?this.model.terminalForCellChanged(a,c,!0):this.model.terminalForCellChanged(a,null,!0));null!=d&&(b?this.model.terminalForCellChanged(a,d,!1):this.model.terminalForCellChanged(a,null,!1));a.setTerminal(c,!0);a.setTerminal(d,!1);c=this.model.getChildCount(a);for(d=0;d<c;d++)this.connect(this.model.getChildAt(a,d),b)};
function mxTerminalChange(a,b,c,d){this.model=a;this.cell=b;this.previous=this.terminal=c;this.source=d}mxTerminalChange.prototype.execute=function(){this.terminal=this.previous;this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)};function mxValueChange(a,b,c){this.model=a;this.cell=b;this.previous=this.value=c}mxValueChange.prototype.execute=function(){this.value=this.previous;this.previous=this.model.valueForCellChanged(this.cell,this.previous)};
function mxStyleChange(a,b,c){this.model=a;this.cell=b;this.previous=this.style=c}mxStyleChange.prototype.execute=function(){this.style=this.previous;this.previous=this.model.styleForCellChanged(this.cell,this.previous)};function mxGeometryChange(a,b,c){this.model=a;this.cell=b;this.previous=this.geometry=c}mxGeometryChange.prototype.execute=function(){this.geometry=this.previous;this.previous=this.model.geometryForCellChanged(this.cell,this.previous)};
function mxCollapseChange(a,b,c){this.model=a;this.cell=b;this.previous=this.collapsed=c}mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous;this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)};function mxVisibleChange(a,b,c){this.model=a;this.cell=b;this.previous=this.visible=c}mxVisibleChange.prototype.execute=function(){this.visible=this.previous;this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)};
function mxCellAttributeChange(a,b,c){this.cell=a;this.attribute=b;this.previous=this.value=c}mxCellAttributeChange.prototype.execute=function(){var a=this.cell.getAttribute(this.attribute);null==this.previous?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous);this.previous=a};function mxCell(a,b,c){this.value=a;this.setGeometry(b);this.setStyle(c);if(null!=this.onInit)this.onInit()}mxCell.prototype.id=null;mxCell.prototype.value=null;
mxCell.prototype.geometry=null;mxCell.prototype.style=null;mxCell.prototype.vertex=!1;mxCell.prototype.edge=!1;mxCell.prototype.connectable=!0;mxCell.prototype.visible=!0;mxCell.prototype.collapsed=!1;mxCell.prototype.parent=null;mxCell.prototype.source=null;mxCell.prototype.target=null;mxCell.prototype.children=null;mxCell.prototype.edges=null;mxCell.prototype.mxTransient="id,value,parent,source,target,children,edges".split(",");mxCell.prototype.getId=function(){return this.id};
mxCell.prototype.setId=function(a){this.id=a};mxCell.prototype.getValue=function(){return this.value};mxCell.prototype.setValue=function(a){this.value=a};mxCell.prototype.valueChanged=function(a){var b=this.getValue();this.setValue(a);return b};mxCell.prototype.getGeometry=function(){return this.geometry};mxCell.prototype.setGeometry=function(a){this.geometry=a};mxCell.prototype.getStyle=function(){return this.style};mxCell.prototype.setStyle=function(a){this.style=a};mxCell.prototype.isVertex=function(){return this.vertex};
mxCell.prototype.setVertex=function(a){this.vertex=a};mxCell.prototype.isEdge=function(){return this.edge};mxCell.prototype.setEdge=function(a){this.edge=a};mxCell.prototype.isConnectable=function(){return this.connectable};mxCell.prototype.setConnectable=function(a){this.connectable=a};mxCell.prototype.isVisible=function(){return this.visible};mxCell.prototype.setVisible=function(a){this.visible=a};mxCell.prototype.isCollapsed=function(){return this.collapsed};
mxCell.prototype.setCollapsed=function(a){this.collapsed=a};mxCell.prototype.getParent=function(){return this.parent};mxCell.prototype.setParent=function(a){this.parent=a};mxCell.prototype.getTerminal=function(a){return a?this.source:this.target};mxCell.prototype.setTerminal=function(a,b){b?this.source=a:this.target=a;return a};mxCell.prototype.getChildCount=function(){return null==this.children?0:this.children.length};mxCell.prototype.getIndex=function(a){return mxUtils.indexOf(this.children,a)};
mxCell.prototype.getChildAt=function(a){return null==this.children?null:this.children[a]};mxCell.prototype.insert=function(a,b){null!=a&&(null==b&&(b=this.getChildCount(),a.getParent()==this&&b--),a.removeFromParent(),a.setParent(this),null==this.children?(this.children=[],this.children.push(a)):this.children.splice(b,0,a));return a};mxCell.prototype.remove=function(a){var b=null;null!=this.children&&0<=a&&(b=this.getChildAt(a),null!=b&&(this.children.splice(a,1),b.setParent(null)));return b};
mxCell.prototype.removeFromParent=function(){null!=this.parent&&this.parent.remove(this.parent.getIndex(this))};mxCell.prototype.getEdgeCount=function(){return null==this.edges?0:this.edges.length};mxCell.prototype.getEdgeIndex=function(a){return mxUtils.indexOf(this.edges,a)};mxCell.prototype.getEdgeAt=function(a){return null==this.edges?null:this.edges[a]};
mxCell.prototype.insertEdge=function(a,b){if(null!=a&&(a.removeFromTerminal(b),a.setTerminal(this,b),null==this.edges||a.getTerminal(!b)!=this||0>mxUtils.indexOf(this.edges,a)))null==this.edges&&(this.edges=[]),this.edges.push(a);return a};mxCell.prototype.removeEdge=function(a,b){if(null!=a){if(a.getTerminal(!b)!=this&&null!=this.edges){var c=this.getEdgeIndex(a);0<=c&&this.edges.splice(c,1)}a.setTerminal(null,b)}return a};
mxCell.prototype.removeFromTerminal=function(a){var b=this.getTerminal(a);null!=b&&b.removeEdge(this,a)};mxCell.prototype.getAttribute=function(a,b){var c=this.getValue();return(null!=c&&c.nodeType==mxConstants.NODETYPE_ELEMENT?c.getAttribute(a):null)||b};mxCell.prototype.setAttribute=function(a,b){var c=this.getValue();null!=c&&c.nodeType==mxConstants.NODETYPE_ELEMENT&&c.setAttribute(a,b)};
mxCell.prototype.clone=function(){var a=mxUtils.clone(this,this.mxTransient);a.setValue(this.cloneValue());return a};mxCell.prototype.cloneValue=function(){var a=this.getValue();null!=a&&("function"==typeof a.clone?a=a.clone():isNaN(a.nodeType)||(a=a.cloneNode(!0)));return a};function mxGeometry(a,b,c,d){mxRectangle.call(this,a,b,c,d)}mxGeometry.prototype=new mxRectangle;mxGeometry.prototype.constructor=mxGeometry;mxGeometry.prototype.TRANSLATE_CONTROL_POINTS=!0;
mxGeometry.prototype.alternateBounds=null;mxGeometry.prototype.sourcePoint=null;mxGeometry.prototype.targetPoint=null;mxGeometry.prototype.points=null;mxGeometry.prototype.offset=null;mxGeometry.prototype.relative=!1;
mxGeometry.prototype.swap=function(){if(null!=this.alternateBounds){var a=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x;this.y=this.alternateBounds.y;this.width=this.alternateBounds.width;this.height=this.alternateBounds.height;this.alternateBounds=a}};mxGeometry.prototype.getTerminalPoint=function(a){return a?this.sourcePoint:this.targetPoint};mxGeometry.prototype.setTerminalPoint=function(a,b){b?this.sourcePoint=a:this.targetPoint=a;return a};
mxGeometry.prototype.translate=function(a,b){this.clone();this.relative||(this.x+=a,this.y+=b);null!=this.sourcePoint&&(this.sourcePoint.x+=a,this.sourcePoint.y+=b);null!=this.targetPoint&&(this.targetPoint.x+=a,this.targetPoint.y+=b);if(this.TRANSLATE_CONTROL_POINTS&&null!=this.points)for(var c=this.points.length,d=0;d<c;d++){var e=this.points[d];null!=e&&(e.x+=a,e.y+=b)}};
var mxCellPath={PATH_SEPARATOR:".",create:function(a){var b="";if(null!=a)for(var c=a.getParent();null!=c;)b=c.getIndex(a)+mxCellPath.PATH_SEPARATOR+b,a=c,c=a.getParent();a=b.length;1<a&&(b=b.substring(0,a-1));return b},getParentPath:function(a){if(null!=a){var b=a.lastIndexOf(mxCellPath.PATH_SEPARATOR);if(0<=b)return a.substring(0,b);if(0<a.length)return""}return null},resolve:function(a,b){var c=a;if(null!=b)for(var d=b.split(mxCellPath.PATH_SEPARATOR),e=0;e<d.length;e++)c=c.getChildAt(parseInt(d[e]));
return c},compare:function(a,b){for(var c=Math.min(a.length,b.length),d=0,e=0;e<c;e++)if(a[e]!=b[e]){0==a[e].length||0==b[e].length?d=a[e]==b[e]?0:a[e]>b[e]?1:-1:(c=parseInt(a[e]),e=parseInt(b[e]),d=c==e?0:c>e?1:-1);break}0==d&&(c=a.length,e=b.length,c!=e&&(d=c>e?1:-1));return d}},mxPerimeter={RectanglePerimeter:function(a,b,c,d){var b=a.getCenterX(),e=a.getCenterY(),f=Math.atan2(c.y-e,c.x-b),g=new mxPoint(0,0),h=Math.PI,k=Math.PI/2-f,l=Math.atan2(a.height,a.width);f<-h+l||f>h-l?(g.x=a.x,g.y=e-a.width*
Math.tan(f)/2):f<-l?(g.y=a.y,g.x=b-a.height*Math.tan(k)/2):f<l?(g.x=a.x+a.width,g.y=e+a.width*Math.tan(f)/2):(g.y=a.y+a.height,g.x=b+a.height*Math.tan(k)/2);d&&(c.x>=a.x&&c.x<=a.x+a.width?g.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(g.y=c.y),c.x<a.x?g.x=a.x:c.x>a.x+a.width&&(g.x=a.x+a.width),c.y<a.y?g.y=a.y:c.y>a.y+a.height&&(g.y=a.y+a.height));return g},EllipsePerimeter:function(a,b,c,d){var e=a.x,f=a.y,g=a.width/2,h=a.height/2,k=e+g,l=f+h,b=c.x,c=c.y,n=parseInt(b-k),o=parseInt(c-l);if(0==n&&0!=o)return new mxPoint(k,
l+h*o/Math.abs(o));if(0==n&&0==o)return new mxPoint(b,c);if(d){if(c>=f&&c<=f+a.height)return a=c-l,a=Math.sqrt(g*g*(1-a*a/(h*h)))||0,b<=e&&(a=-a),new mxPoint(k+a,c);if(b>=e&&b<=e+a.width)return a=b-k,a=Math.sqrt(h*h*(1-a*a/(g*g)))||0,c<=f&&(a=-a),new mxPoint(b,l+a)}e=o/n;l-=e*k;f=g*g*e*e+h*h;a=-2*k*f;h=Math.sqrt(a*a-4*f*(g*g*e*e*k*k+h*h*k*k-g*g*h*h));g=(-a+h)/(2*f);h=(-a-h)/(2*f);k=e*g+l;l=e*h+l;e=Math.sqrt(Math.pow(g-b,2)+Math.pow(k-c,2));b=Math.sqrt(Math.pow(h-b,2)+Math.pow(l-c,2));f=c=0;e<b?(c=
g,f=k):(c=h,f=l);return new mxPoint(c,f)},RhombusPerimeter:function(a,b,c,d){var b=a.x,e=a.y,f=a.width,a=a.height,g=b+f/2,h=e+a/2,k=c.x,c=c.y;if(g==k)return h>c?new mxPoint(g,e):new mxPoint(g,e+a);if(h==c)return g>k?new mxPoint(b,h):new mxPoint(b+f,h);var l=g,n=h;d&&(k>=b&&k<=b+f?l=k:c>=e&&c<=e+a&&(n=c));return k<g?c<h?mxUtils.intersection(k,c,l,n,g,e,b,h):mxUtils.intersection(k,c,l,n,g,e+a,b,h):c<h?mxUtils.intersection(k,c,l,n,g,e,b+f,h):mxUtils.intersection(k,c,l,n,g,e+a,b+f,h)},TrianglePerimeter:function(a,
b,c,d){var b=null!=b?b.style[mxConstants.STYLE_DIRECTION]:null,e=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_SOUTH,f=a.x,g=a.y,h=a.width,a=a.height,k=f+h/2,l=g+a/2,n=new mxPoint(f,g),o=new mxPoint(f+h,l),p=new mxPoint(f,g+a);b==mxConstants.DIRECTION_NORTH?(n=p,o=new mxPoint(k,g),p=new mxPoint(f+h,g+a)):b==mxConstants.DIRECTION_SOUTH?(o=new mxPoint(k,g+a),p=new mxPoint(f+h,g)):b==mxConstants.DIRECTION_WEST&&(n=new mxPoint(f+h,g),o=new mxPoint(f,l),p=new mxPoint(f+h,g+a));var r=c.x-k,s=
c.y-l,r=e?Math.atan2(r,s):Math.atan2(s,r),u=e?Math.atan2(h,a):Math.atan2(a,h),s=!1,s=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_WEST?r>-u&&r<u:r<-Math.PI+u||r>Math.PI-u,u=null;s?u=d&&(e&&c.x>=n.x&&c.x<=p.x||!e&&c.y>=n.y&&c.y<=p.y)?e?new mxPoint(c.x,n.y):new mxPoint(n.x,c.y):b==mxConstants.DIRECTION_NORTH?new mxPoint(f+h/2+a*Math.tan(r)/2,g+a):b==mxConstants.DIRECTION_SOUTH?new mxPoint(f+h/2-a*Math.tan(r)/2,g):b==mxConstants.DIRECTION_WEST?new mxPoint(f+h,g+a/2+h*Math.tan(r)/2):new mxPoint(f,
g+a/2-h*Math.tan(r)/2):(d&&(d=new mxPoint(k,l),c.y>=g&&c.y<=g+a?(d.x=e?k:b==mxConstants.DIRECTION_WEST?f+h:f,d.y=c.y):c.x>=f&&c.x<=f+h&&(d.x=c.x,d.y=!e?l:b==mxConstants.DIRECTION_NORTH?g+a:g),k=d.x,l=d.y),u=e&&c.x<=f+h/2||!e&&c.y<=g+a/2?mxUtils.intersection(c.x,c.y,k,l,n.x,n.y,o.x,o.y):mxUtils.intersection(c.x,c.y,k,l,o.x,o.y,p.x,p.y));null==u&&(u=new mxPoint(k,l));return u}};
function mxPrintPreview(a,b,c,d,e,f,g,h,k){this.graph=a;this.scale=null!=b?b:1/a.pageScale;this.border=null!=d?d:0;this.pageFormat=null!=c?c:a.pageFormat;this.title=null!=h?h:"Printer-friendly version";this.x0=null!=e?e:0;this.y0=null!=f?f:0;this.borderColor=g;this.pageSelector=null!=k?k:!0}mxPrintPreview.prototype.graph=null;mxPrintPreview.prototype.pageFormat=null;mxPrintPreview.prototype.scale=null;mxPrintPreview.prototype.border=0;mxPrintPreview.prototype.x0=0;mxPrintPreview.prototype.y0=0;
mxPrintPreview.prototype.autoOrigin=!0;mxPrintPreview.prototype.printOverlays=!1;mxPrintPreview.prototype.borderColor=null;mxPrintPreview.prototype.title=null;mxPrintPreview.prototype.pageSelector=null;mxPrintPreview.prototype.wnd=null;mxPrintPreview.prototype.pageCount=0;mxPrintPreview.prototype.getWindow=function(){return this.wnd};mxPrintPreview.prototype.getDoctype=function(){return""};
mxPrintPreview.prototype.open=function(a){var b=this.graph.cellRenderer.initializeOverlay,c=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(a,b){b.init(a.view.getDrawPane())});if(null==this.wnd){this.wnd=window.open();var d=this.wnd.document,e=this.getDoctype();null!=e&&0<e.length&&d.writeln(e);d.writeln("<html>");d.writeln("<head>");this.writeHead(d,a);d.writeln("</head>");d.writeln('<body class="mxPage">');mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",
d);mxClient.IS_VML&&(d.namespaces.add("v","urn:schemas-microsoft-com:vml"),d.namespaces.add("o","urn:schemas-microsoft-com:office:office"),d.createStyleSheet().cssText="v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}",mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css",d));var f=this.graph.getGraphBounds().clone(),g=this.graph.getView().getScale(),h=g/this.scale,k=this.graph.getView().getTranslate();this.autoOrigin||(this.x0=-k.x*this.scale,this.y0=-k.y*this.scale,
f.width+=f.x,f.height+=f.y,f.x=0,this.border=f.y=0);f.width/=h;f.height/=h;var l=this.pageFormat.width-2*this.border,n=this.pageFormat.height-2*this.border,o=Math.max(1,Math.ceil((f.width+this.x0)/l)),p=Math.max(1,Math.ceil((f.height+this.y0)/n));this.pageCount=o*p;var r=mxUtils.bind(this,function(){if(this.pageSelector&&(1<p||1<o)){var a=this.createPageSelector(p,o);d.body.appendChild(a);if(mxClient.IS_IE){a.style.position="absolute";var b=function(){a.style.top=d.body.scrollTop+10+"px"};mxEvent.addListener(this.wnd,
"scroll",function(){b()});mxEvent.addListener(this.wnd,"resize",function(){b()})}}}),s=null;if(mxClient.IS_IE&&9!=document.documentMode){var s=[],u=0,w=!1,v=mxImageShape.prototype.scheduleUpdateAspect,x=mxImageShape.prototype.updateAspect,B=function(){if(w&&0==u){mxImageShape.prototype.scheduleUpdateAspect=v;mxImageShape.prototype.updateAspect=x;for(var a="",b=0;b<s.length;b++)a+=s[b].outerHTML,s[b].parentNode.removeChild(s[b]),b<s.length-1&&(a+="<hr/>");d.body.innerHTML=a;r()}};mxImageShape.prototype.scheduleUpdateAspect=
function(){u++;v.apply(this,arguments)};mxImageShape.prototype.updateAspect=function(){x.apply(this,arguments);u--;B()}}for(a=0;a<p;a++)for(var z=a*n/this.scale-this.y0/this.scale+(f.y-k.y*g)/g,e=0;e<o;e++){if(null==this.wnd)return null;h=a*o+e+1;c=this.renderPage(this.pageFormat.width,this.pageFormat.height,-(e*l/this.scale-this.x0/this.scale+(f.x-k.x*g)/g),-z,this.scale,h);c.setAttribute("id","mxPage-"+h);null!=this.borderColor&&(c.style.borderColor=this.borderColor,c.style.borderStyle="solid",
c.style.borderWidth="1px");c.style.background="white";if(a<p-1||e<o-1)c.style.pageBreakAfter="always";mxClient.IS_IE?(d.writeln(c.outerHTML),null!=s?s.push(c):c.parentNode.removeChild(c)):(c.parentNode.removeChild(c),d.body.appendChild(c));if(a<p-1||e<o-1){var A=d.createElement("hr");A.className="mxPageBreak";d.body.appendChild(A)}}d.writeln("</body>");d.writeln("</html>");d.close();null!=s?(w=!0,B()):r();mxEvent.release(d.body)}this.wnd.focus()}catch(J){null!=c&&null!=c.parentNode&&c.parentNode.removeChild(c)}finally{this.graph.cellRenderer.initializeOverlay=
b}return this.wnd};
mxPrintPreview.prototype.writeHead=function(a,b){null!=this.title&&a.writeln("<title>"+this.title+"</title>");a.writeln('<style type="text/css">');a.writeln("@media print {");a.writeln("  table.mxPageSelector { display: none; }");a.writeln("  hr.mxPageBreak { display: none; }");a.writeln("}");a.writeln("@media screen {");a.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }");a.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }");
a.writeln("  body.mxPage { background: gray; }");a.writeln("}");null!=b&&a.writeln(b);a.writeln("</style>")};
mxPrintPreview.prototype.createPageSelector=function(a,b){var c=this.wnd.document,d=c.createElement("table");d.className="mxPageSelector";d.setAttribute("border","0");for(var e=c.createElement("tbody"),f=0;f<a;f++){for(var g=c.createElement("tr"),h=0;h<b;h++){var k=f*b+h+1,l=c.createElement("td");if(!mxClient.IS_NS||mxClient.IS_SF||mxClient.IS_GC){var n=c.createElement("a");n.setAttribute("href","#mxPage-"+k);mxUtils.write(n,k,c);l.appendChild(n)}else mxUtils.write(l,k,c);g.appendChild(l)}e.appendChild(g)}d.appendChild(e);
return d};
mxPrintPreview.prototype.renderPage=function(a,b,c,d,e){var f=document.createElement("div");try{f.style.width=a+"px";f.style.height=b+"px";f.style.overflow="hidden";f.style.pageBreakInside="avoid";var g=document.createElement("div");g.style.top=this.border+"px";g.style.left=this.border+"px";g.style.width=a-2*this.border+"px";g.style.height=b-2*this.border+"px";g.style.overflow="hidden";this.graph.dialect==mxConstants.DIALECT_VML&&(g.style.position="absolute");f.appendChild(g);document.body.appendChild(f);var h=
this.graph.getView(),k=this.graph.container;this.graph.container=g;var l=h.getCanvas(),n=h.getBackgroundPane(),o=h.getDrawPane(),p=h.getOverlayPane();this.graph.dialect==mxConstants.DIALECT_SVG?h.createSvg():this.graph.dialect==mxConstants.DIALECT_VML?h.createVml():h.createHtml();var r=h.isEventsEnabled();h.setEventsEnabled(!1);var s=this.graph.isEnabled();this.graph.setEnabled(!1);var u=h.getTranslate();h.translate=new mxPoint(c,d);a=null;try{var w=[this.graph.getModel().getRoot()],a=new mxTemporaryCellStates(h,
e,w)}finally{if(mxClient.IS_IE)h.overlayPane.innerHTML="";else for(var v=g.firstChild;null!=v;){var x=v.nextSibling,B=v.nodeName.toLowerCase();"svg"==B?(v.setAttribute("width",parseInt(g.style.width)),v.setAttribute("height",parseInt(g.style.height))):"default"!=v.style.cursor&&"table"!=B&&v.parentNode.removeChild(v);v=x}h.overlayPane.parentNode.removeChild(h.overlayPane);this.graph.setEnabled(s);this.graph.container=k;h.canvas=l;h.backgroundPane=n;h.drawPane=o;h.overlayPane=p;h.translate=u;a.destroy();
h.setEventsEnabled(r)}}catch(z){throw f.parentNode.removeChild(f),z;}return f};mxPrintPreview.prototype.print=function(){var a=this.open();null!=a&&a.print()};mxPrintPreview.prototype.close=function(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)};function mxStylesheet(){this.styles={};this.putDefaultVertexStyle(this.createDefaultVertexStyle());this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}
mxStylesheet.prototype.createDefaultVertexStyle=function(){var a={};a[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE;a[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter;a[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;a[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;a[mxConstants.STYLE_FILLCOLOR]="#C3D9FF";a[mxConstants.STYLE_STROKECOLOR]="#6482B9";a[mxConstants.STYLE_FONTCOLOR]="#774400";return a};
mxStylesheet.prototype.createDefaultEdgeStyle=function(){var a={};a[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR;a[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC;a[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;a[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;a[mxConstants.STYLE_STROKECOLOR]="#6482B9";a[mxConstants.STYLE_FONTCOLOR]="#446299";return a};mxStylesheet.prototype.putDefaultVertexStyle=function(a){this.putCellStyle("defaultVertex",a)};
mxStylesheet.prototype.putDefaultEdgeStyle=function(a){this.putCellStyle("defaultEdge",a)};mxStylesheet.prototype.getDefaultVertexStyle=function(){return this.styles.defaultVertex};mxStylesheet.prototype.getDefaultEdgeStyle=function(){return this.styles.defaultEdge};mxStylesheet.prototype.putCellStyle=function(a,b){this.styles[a]=b};
mxStylesheet.prototype.getCellStyle=function(a,b){var c=b;if(null!=a&&0<a.length)for(var d=a.split(";"),c=null!=c&&";"!=a.charAt(0)?mxUtils.clone(c):{},e=0;e<d.length;e++){var f=d[e],g=f.indexOf("=");if(0<=g){var h=f.substring(0,g),f=f.substring(g+1);f==mxConstants.NONE?delete c[h]:c[h]=mxUtils.isNumeric(f)?parseFloat(f):f}else if(f=this.styles[f],null!=f)for(h in f)c[h]=f[h]}return c};
function mxCellState(a,b,c){this.view=a;this.cell=b;this.style=c;this.origin=new mxPoint;this.absoluteOffset=new mxPoint}mxCellState.prototype=new mxRectangle;mxCellState.prototype.constructor=mxCellState;mxCellState.prototype.view=null;mxCellState.prototype.cell=null;mxCellState.prototype.style=null;mxCellState.prototype.invalid=!0;mxCellState.prototype.invalidOrder=!1;mxCellState.prototype.orderChanged=!1;mxCellState.prototype.origin=null;mxCellState.prototype.absolutePoints=null;
mxCellState.prototype.absoluteOffset=null;mxCellState.prototype.visibleSourceState=null;mxCellState.prototype.visibleTargetState=null;mxCellState.prototype.terminalDistance=0;mxCellState.prototype.length=0;mxCellState.prototype.segments=null;mxCellState.prototype.shape=null;mxCellState.prototype.text=null;
mxCellState.prototype.getPerimeterBounds=function(a,b){a=a||0;b=null!=b?b:new mxRectangle(this.x,this.y,this.width,this.height);if(null!=this.shape&&null!=this.shape.stencil){var c=this.shape.stencil.computeAspect(this,b,null);b.x=c.x;b.y=c.y;b.width=this.shape.stencil.w0*c.width;b.height=this.shape.stencil.h0*c.height}0!=a&&b.grow(a);return b};
mxCellState.prototype.setAbsoluteTerminalPoint=function(a,b){b?(null==this.absolutePoints&&(this.absolutePoints=[]),0==this.absolutePoints.length?this.absolutePoints.push(a):this.absolutePoints[0]=a):null==this.absolutePoints?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(a)):1==this.absolutePoints.length?this.absolutePoints.push(a):this.absolutePoints[this.absolutePoints.length-1]=a};
mxCellState.prototype.setCursor=function(a){null!=this.shape&&this.shape.setCursor(a);null!=this.text&&this.text.setCursor(a)};mxCellState.prototype.getVisibleTerminal=function(a){a=this.getVisibleTerminalState(a);return null!=a?a.cell:null};mxCellState.prototype.getVisibleTerminalState=function(a){return a?this.visibleSourceState:this.visibleTargetState};mxCellState.prototype.setVisibleTerminalState=function(a,b){b?this.visibleSourceState=a:this.visibleTargetState=a};
mxCellState.prototype.destroy=function(){this.view.graph.cellRenderer.destroy(this)};
mxCellState.prototype.clone=function(){var a=new mxCellState(this.view,this.cell,this.style);if(null!=this.absolutePoints){a.absolutePoints=[];for(var b=0;b<this.absolutePoints.length;b++)a.absolutePoints[b]=this.absolutePoints[b].clone()}null!=this.origin&&(a.origin=this.origin.clone());null!=this.absoluteOffset&&(a.absoluteOffset=this.absoluteOffset.clone());null!=this.boundingBox&&(a.boundingBox=this.boundingBox.clone());a.terminalDistance=this.terminalDistance;a.segments=this.segments;a.length=
this.length;a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a};function mxGraphSelectionModel(a){this.graph=a;this.cells=[]}mxGraphSelectionModel.prototype=new mxEventSource;mxGraphSelectionModel.prototype.constructor=mxGraphSelectionModel;mxGraphSelectionModel.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphSelectionModel.prototype.updatingSelectionResource="none"!=mxClient.language?"updatingSelection":"";mxGraphSelectionModel.prototype.graph=null;
mxGraphSelectionModel.prototype.singleSelection=!1;mxGraphSelectionModel.prototype.isSingleSelection=function(){return this.singleSelection};mxGraphSelectionModel.prototype.setSingleSelection=function(a){this.singleSelection=a};mxGraphSelectionModel.prototype.isSelected=function(a){return null!=a?0<=mxUtils.indexOf(this.cells,a):!1};mxGraphSelectionModel.prototype.isEmpty=function(){return 0==this.cells.length};mxGraphSelectionModel.prototype.clear=function(){this.changeSelection(null,this.cells)};
mxGraphSelectionModel.prototype.setCell=function(a){null!=a&&this.setCells([a])};mxGraphSelectionModel.prototype.setCells=function(a){if(null!=a){this.singleSelection&&(a=[this.getFirstSelectableCell(a)]);for(var b=[],c=0;c<a.length;c++)this.graph.isCellSelectable(a[c])&&b.push(a[c]);this.changeSelection(b,this.cells)}};mxGraphSelectionModel.prototype.getFirstSelectableCell=function(a){if(null!=a)for(var b=0;b<a.length;b++)if(this.graph.isCellSelectable(a[b]))return a[b];return null};
mxGraphSelectionModel.prototype.addCell=function(a){null!=a&&this.addCells([a])};mxGraphSelectionModel.prototype.addCells=function(a){if(null!=a){var b=null;this.singleSelection&&(b=this.cells,a=[this.getFirstSelectableCell(a)]);for(var c=[],d=0;d<a.length;d++)!this.isSelected(a[d])&&this.graph.isCellSelectable(a[d])&&c.push(a[d]);this.changeSelection(c,b)}};mxGraphSelectionModel.prototype.removeCell=function(a){null!=a&&this.removeCells([a])};
mxGraphSelectionModel.prototype.removeCells=function(a){if(null!=a){for(var b=[],c=0;c<a.length;c++)this.isSelected(a[c])&&b.push(a[c]);this.changeSelection(null,b)}};mxGraphSelectionModel.prototype.changeSelection=function(a,b){if(null!=a&&0<a.length&&null!=a[0]||null!=b&&0<b.length&&null!=b[0]){var c=new mxSelectionChange(this,a,b);c.execute();var d=new mxUndoableEdit(this,!1);d.add(c);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",d))}};
mxGraphSelectionModel.prototype.cellAdded=function(a){null!=a&&!this.isSelected(a)&&this.cells.push(a)};mxGraphSelectionModel.prototype.cellRemoved=function(a){null!=a&&(a=mxUtils.indexOf(this.cells,a),0<=a&&this.cells.splice(a,1))};function mxSelectionChange(a,b,c){this.selectionModel=a;this.added=null!=b?b.slice():null;this.removed=null!=c?c.slice():null}
mxSelectionChange.prototype.execute=function(){var a=mxLog.enter("mxSelectionChange.execute");window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource;if(null!=this.removed)for(var b=0;b<this.removed.length;b++)this.selectionModel.cellRemoved(this.removed[b]);if(null!=this.added)for(b=0;b<this.added.length;b++)this.selectionModel.cellAdded(this.added[b]);b=this.added;this.added=this.removed;this.removed=b;window.status=mxResources.get(this.selectionModel.doneResource)||
this.selectionModel.doneResource;mxLog.leave("mxSelectionChange.execute",a);this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))};function mxCellEditor(a){this.graph=a}mxCellEditor.prototype.graph=null;mxCellEditor.prototype.textarea=null;mxCellEditor.prototype.editingCell=null;mxCellEditor.prototype.trigger=null;mxCellEditor.prototype.modified=!1;mxCellEditor.prototype.emptyLabelText="";mxCellEditor.prototype.textNode="";
mxCellEditor.prototype.init=function(){this.textarea=document.createElement("textarea");this.textarea.className="mxCellEditor";this.textarea.style.position="absolute";this.textarea.style.overflow="visible";this.textarea.setAttribute("cols","20");this.textarea.setAttribute("rows","4");mxClient.IS_GC&&(this.textarea.style.resize="none");mxEvent.addListener(this.textarea,"blur",mxUtils.bind(this,function(){this.focusLost()}));mxEvent.addListener(this.textarea,"keydown",mxUtils.bind(this,function(a){mxEvent.isConsumed(a)||
(113==a.keyCode||this.graph.isEnterStopsCellEditing()&&13==a.keyCode&&!mxEvent.isControlDown(a)&&!mxEvent.isShiftDown(a)?(this.graph.stopEditing(!1),mxEvent.consume(a)):27==a.keyCode?(this.graph.stopEditing(!0),mxEvent.consume(a)):(this.clearOnChange&&(this.clearOnChange=!1,this.textarea.value=""),this.setModified(!0)))}))};mxCellEditor.prototype.isModified=function(){return this.modified};mxCellEditor.prototype.setModified=function(a){this.modified=a};mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())};
mxCellEditor.prototype.startEditing=function(a,b){null==this.textarea&&this.init();this.stopEditing(!0);var c=this.graph.getView().getState(a);if(null!=c){this.editingCell=a;this.trigger=b;this.textNode=null;null!=c.text&&this.isHideLabel(c)&&(this.textNode=c.text.node,this.textNode.style.visibility="hidden");var d=this.graph.getView().scale,d=mxUtils.getValue(c.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*d,e=mxUtils.getValue(c.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),
f=mxUtils.getValue(c.style,mxConstants.STYLE_FONTCOLOR,"black"),g=this.graph.model.isEdge(c.cell)?mxConstants.ALIGN_LEFT:mxUtils.getValue(c.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),h=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,k=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,l=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;
this.textarea.style.fontSize=d+"px";this.textarea.style.fontFamily=e;this.textarea.style.textAlign=g;this.textarea.style.color=f;this.textarea.style.fontWeight=h?"bold":"normal";this.textarea.style.fontStyle=k?"italic":"";this.textarea.style.textDecoration=l?"underline":"";d=this.getEditorBounds(c);this.textarea.style.left=d.x+"px";this.textarea.style.top=d.y+"px";this.textarea.style.width=d.width+"px";this.textarea.style.height=d.height+"px";this.textarea.style.zIndex=5;c=this.getInitialValue(c,
b);null==c||0==c.length?(c=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=!1;this.setModified(!1);this.textarea.value=c;this.graph.container.appendChild(this.textarea);"none"!=this.textarea.style.display&&(this.textarea.focus(),this.textarea.select())}};
mxCellEditor.prototype.stopEditing=function(a){null!=this.editingCell&&(null!=this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null),!a&&this.isModified()&&this.graph.labelChanged(this.editingCell,this.getCurrentValue(),this.trigger),this.trigger=this.editingCell=null,this.textarea.blur(),this.textarea.parentNode.removeChild(this.textarea))};mxCellEditor.prototype.getInitialValue=function(a,b){return this.graph.getEditingValue(a.cell,b)};
mxCellEditor.prototype.getCurrentValue=function(){return this.textarea.value.replace(/\r/g,"")};mxCellEditor.prototype.isHideLabel=function(){return!0};mxCellEditor.prototype.getMinimumSize=function(a){var b=this.graph.getView().scale;return new mxRectangle(0,0,null==a.text?30:a.text.size*b+20,"left"==this.textarea.style.textAlign?120:40)};
mxCellEditor.prototype.getEditorBounds=function(a){var b=this.graph.getModel().isEdge(a.cell),c=this.graph.getView().scale,d=this.getMinimumSize(a),e=d.width,d=d.height,f=parseInt(a.style[mxConstants.STYLE_SPACING]||2)*c,g=parseInt(a.style[mxConstants.STYLE_SPACING_TOP]||0)*c+f,h=parseInt(a.style[mxConstants.STYLE_SPACING_RIGHT]||0)*c+f,k=parseInt(a.style[mxConstants.STYLE_SPACING_BOTTOM]||0)*c+f,c=parseInt(a.style[mxConstants.STYLE_SPACING_LEFT]||0)*c+f,h=new mxRectangle(a.x,a.y,Math.max(e,a.width-
c-h),Math.max(d,a.height-g-k));b?(h.x=a.absoluteOffset.x,h.y=a.absoluteOffset.y,null!=a.text&&null!=a.text.boundingBox&&(0<a.text.boundingBox.x&&(h.x=a.text.boundingBox.x),0<a.text.boundingBox.y&&(h.y=a.text.boundingBox.y))):null!=a.text&&null!=a.text.boundingBox&&(h.x=Math.min(h.x,a.text.boundingBox.x),h.y=Math.min(h.y,a.text.boundingBox.y));h.x+=c;h.y+=g;null!=a.text&&null!=a.text.boundingBox&&(b?(h.width=Math.max(e,a.text.boundingBox.width),h.height=Math.max(d,a.text.boundingBox.height)):(h.width=
Math.max(h.width,a.text.boundingBox.width),h.height=Math.max(h.height,a.text.boundingBox.height)));this.graph.getModel().isVertex(a.cell)&&(b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),b==mxConstants.ALIGN_LEFT?h.x-=a.width:b==mxConstants.ALIGN_RIGHT&&(h.x+=a.width),b=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),b==mxConstants.ALIGN_TOP?h.y-=a.height:b==mxConstants.ALIGN_BOTTOM&&(h.y+=a.height));return h};
mxCellEditor.prototype.getEmptyLabelText=function(){return this.emptyLabelText};mxCellEditor.prototype.getEditingCell=function(){return this.editingCell};mxCellEditor.prototype.destroy=function(){null!=this.textarea&&(mxEvent.release(this.textarea),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null)};function mxCellRenderer(){this.shapes=mxUtils.clone(this.defaultShapes)}mxCellRenderer.prototype.shapes=null;
mxCellRenderer.prototype.defaultEdgeShape=mxConnector;mxCellRenderer.prototype.defaultVertexShape=mxRectangleShape;mxCellRenderer.prototype.defaultShapes={};mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_ARROW]=mxArrow;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_RECTANGLE]=mxRectangleShape;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_ELLIPSE]=mxEllipse;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_DOUBLE_ELLIPSE]=mxDoubleEllipse;
mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_RHOMBUS]=mxRhombus;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_IMAGE]=mxImageShape;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_LINE]=mxLine;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_LABEL]=mxLabel;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_CYLINDER]=mxCylinder;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_SWIMLANE]=mxSwimlane;
mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_CONNECTOR]=mxConnector;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_ACTOR]=mxActor;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_CLOUD]=mxCloud;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_TRIANGLE]=mxTriangle;mxCellRenderer.prototype.defaultShapes[mxConstants.SHAPE_HEXAGON]=mxHexagon;mxCellRenderer.prototype.registerShape=function(a,b){this.shapes[a]=b};
mxCellRenderer.prototype.initialize=function(a,b){var c=a.view.graph.getModel();if(null!=a.view.graph.container&&null==a.shape&&a.cell!=a.view.currentRoot&&(c.isVertex(a.cell)||c.isEdge(a.cell)))if(this.createShape(a),null!=a.shape&&(null==b||b))this.initializeShape(a),a.view.graph.ordered||c.isEdge(a.cell)?a.invalidOrder=!0:a.view.graph.keepEdgesInForeground&&null!=this.firstEdge&&(this.firstEdge.parentNode==a.shape.node.parentNode?this.insertState(a,this.firstEdge):this.firstEdge=null),a.shape.scale=
a.view.scale,this.createCellOverlays(a),this.installListeners(a)};mxCellRenderer.prototype.initializeShape=function(a){a.shape.init(a.view.getDrawPane())};mxCellRenderer.prototype.getPreviousStateInContainer=function(a,b){for(var c=null,d=a.view.graph,e=d.getModel(),f=a.cell,g=e.getParent(f);null!=g&&null==c;)c=this.findPreviousStateInContainer(d,g,f,b),f=g,g=e.getParent(f);return c};
mxCellRenderer.prototype.findPreviousStateInContainer=function(a,b,c,d){for(var e=null,f=a.getModel(),c=null!=c?b.getIndex(c)-1:f.getChildCount(b)-1;0<=c&&null==e;c--)e=this.findPreviousStateInContainer(a,f.getChildAt(b,c),null,d);if(null==e&&(e=a.view.getState(b),null!=e&&(null==e.shape||null==e.shape.node||e.shape.node.parentNode!=d)))e=null;return e};
mxCellRenderer.prototype.order=function(a){var b=a.shape.node.parentNode,c=this.getPreviousStateInContainer(a,b),d=b.firstChild;null!=c&&(d=c.shape.node,null!=c.text&&null!=c.text.node&&c.text.node.parentNode==b&&(d=c.text.node),d=d.nextSibling);this.insertState(a,d)};
mxCellRenderer.prototype.orderEdge=function(a){var b=a.view,c=b.graph.getModel();if(b.graph.keepEdgesInForeground){if(null==this.firstEdge||null==this.firstEdge.parentNode||this.firstEdge.parentNode!=a.shape.node.parentNode)this.firstEdge=a.shape.node}else if(b.graph.keepEdgesInBackground){var d=a.shape.node,e=d.parentNode,c=c.getParent(a.cell),b=b.getState(c),e=null!=b&&null!=b.shape&&null!=b.shape.node?b.shape.node.nextSibling:e.firstChild;null!=e&&e!=d&&this.insertState(a,e)}};
mxCellRenderer.prototype.insertState=function(a,b){a.shape.node.parentNode.insertBefore(a.shape.node,b);null!=a.text&&null!=a.text.node&&a.text.node.parentNode==a.shape.node.parentNode&&a.shape.node.parentNode.insertBefore(a.text.node,a.shape.node.nextSibling)};
mxCellRenderer.prototype.createShape=function(a){if(null!=a.style){var b=mxStencilRegistry.getStencil(a.style[mxConstants.STYLE_SHAPE]);null!=b?a.shape=new mxStencilShape(b):(b=this.getShapeConstructor(a),a.shape=new b);a.shape.points=a.absolutePoints;a.shape.bounds=new mxRectangle(a.x,a.y,a.width,a.height);a.shape.dialect=a.view.graph.dialect;this.configureShape(a)}};
mxCellRenderer.prototype.getShapeConstructor=function(a){var b=a.style[mxConstants.STYLE_SHAPE],b=null!=b?this.shapes[b]:null;null==b&&(b=a.view.graph.getModel().isEdge(a.cell)?this.defaultEdgeShape:this.defaultVertexShape);return b};
mxCellRenderer.prototype.configureShape=function(a){a.shape.apply(a);var b=a.view.graph.getImage(a);null!=b&&(a.shape.image=b);var b=a.view.graph.getIndicatorColor(a),c=a.view.graph.getIndicatorShape(a),c=null!=c?this.shapes[c]:null;null!=b?(a.shape.indicatorShape=c,a.shape.indicatorColor=b,a.shape.indicatorGradientColor=a.view.graph.getIndicatorGradientColor(a),a.shape.indicatorDirection=a.style[mxConstants.STYLE_INDICATOR_DIRECTION]):(b=a.view.graph.getIndicatorImage(a),null!=b&&(a.shape.indicatorImage=
b));this.postConfigureShape(a)};mxCellRenderer.prototype.postConfigureShape=function(a){null!=a.shape&&(this.resolveColor(a,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(a,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(a,"fill",mxConstants.STYLE_FILLCOLOR),this.resolveColor(a,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(a,"gradient",mxConstants.STYLE_GRADIENTCOLOR))};
mxCellRenderer.prototype.resolveColor=function(a,b,c){var d=a.shape[b],e=a.view.graph,f=null;"inherit"==d?f=e.model.getParent(a.cell):"swimlane"==d?(f=null!=e.model.getTerminal(a.cell,!1)?e.model.getTerminal(a.cell,!1):a.cell,f=e.getSwimlane(f),c=e.swimlaneIndicatorColorAttribute):"indicated"==d&&(a.shape[b]=a.shape.indicatorColor);null!=f&&(d=e.getView().getState(f),a.shape[b]=null,null!=d&&(a.shape[b]=null!=d.shape&&"indicatorColor"!=b?d.shape[b]:d.style[c]))};
mxCellRenderer.prototype.getLabelValue=function(a){var b=a.view.graph,c=b.getLabel(a.cell);!b.isHtmlLabel(a.cell)&&!mxUtils.isNode(c)&&b.dialect!=mxConstants.DIALECT_SVG&&null!=c&&(c=mxUtils.htmlEntities(c,!1));return c};
mxCellRenderer.prototype.createLabel=function(a,b){var c=a.view.graph;c.getModel().isEdge(a.cell);if(0<a.style[mxConstants.STYLE_FONTSIZE]||null==a.style[mxConstants.STYLE_FONTSIZE]){var d=(c.isHtmlLabel(a.cell)||null!=b&&mxUtils.isNode(b))&&c.dialect==mxConstants.DIALECT_SVG;a.text=new mxText(b,new mxRectangle,a.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,c.getVerticalAlign(a),a.style[mxConstants.STYLE_FONTCOLOR],a.style[mxConstants.STYLE_FONTFAMILY],a.style[mxConstants.STYLE_FONTSIZE],
a.style[mxConstants.STYLE_FONTSTYLE],a.style[mxConstants.STYLE_SPACING],a.style[mxConstants.STYLE_SPACING_TOP],a.style[mxConstants.STYLE_SPACING_RIGHT],a.style[mxConstants.STYLE_SPACING_BOTTOM],a.style[mxConstants.STYLE_SPACING_LEFT],a.style[mxConstants.STYLE_HORIZONTAL],a.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],a.style[mxConstants.STYLE_LABEL_BORDERCOLOR],c.isWrapping(a.cell)&&c.isHtmlLabel(a.cell),c.isLabelClipped(a.cell),a.style[mxConstants.STYLE_OVERFLOW],a.style[mxConstants.STYLE_LABEL_PADDING]);
a.text.opacity=a.style[mxConstants.STYLE_TEXT_OPACITY];a.text.dialect=d?mxConstants.DIALECT_STRICTHTML:a.view.graph.dialect;this.initializeLabel(a);var e=!1,f=function(b){var d=a;if(mxClient.IS_TOUCH||e)d=mxEvent.getClientX(b),b=mxEvent.getClientY(b),b=mxUtils.convertPoint(c.container,d,b),d=c.view.getState(c.getCellAt(b.x,b.y));return d},d=mxClient.IS_TOUCH?"touchmove":"mousemove",g=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(a.text.node,mxClient.IS_TOUCH?"touchstart":"mousedown",
mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,a)),e=c.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(b).nodeName)}));mxEvent.addListener(a.text.node,d,mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&c.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,f(b)))}));mxEvent.addListener(a.text.node,g,mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b,f(b))),e=!1)}));
mxEvent.addListener(a.text.node,"dblclick",mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.dblClick(b,a.cell),mxEvent.consume(b))}))}};
mxCellRenderer.prototype.initializeLabel=function(a){var b=a.view.graph;a.text.dialect!=mxConstants.DIALECT_SVG&&(mxClient.IS_SVG&&mxClient.NO_FO?a.text.init(b.container):mxUtils.isVml(a.view.getDrawPane())&&(null!=a.shape.label?a.text.init(a.shape.label):a.text.init(a.shape.node)));null==a.text.node&&(a.text.init(a.view.getDrawPane()),null!=a.shape&&null!=a.text&&a.shape.node.parentNode.insertBefore(a.text.node,a.shape.node.nextSibling))};
mxCellRenderer.prototype.createCellOverlays=function(a){var b=a.view.graph.getCellOverlays(a.cell),c=null;if(null!=b)for(var c=new mxDictionary,d=0;d<b.length;d++){var e=null!=a.overlays?a.overlays.remove(b[d]):null;null==e&&(e=new mxImageShape(new mxRectangle,b[d].image.src),e.dialect=a.view.graph.dialect,e.preserveImageAspect=!1,e.overlay=b[d],this.initializeOverlay(a,e),this.installCellOverlayListeners(a,b[d],e),null!=b[d].cursor&&(e.node.style.cursor=b[d].cursor));c.put(b[d],e)}null!=a.overlays&&
a.overlays.visit(function(a,b){b.destroy()});a.overlays=c};mxCellRenderer.prototype.initializeOverlay=function(a,b){b.init(a.view.getOverlayPane())};
mxCellRenderer.prototype.installCellOverlayListeners=function(a,b,c){var d=a.view.graph;mxEvent.addListener(c.node,"click",function(c){d.isEditing()&&d.stopEditing(!d.isInvokesStopCellEditing());b.fireEvent(new mxEventObject(mxEvent.CLICK,"event",c,"cell",a.cell))});var e=mxClient.IS_TOUCH?"touchmove":"mousemove";mxEvent.addListener(c.node,mxClient.IS_TOUCH?"touchstart":"mousedown",function(a){mxEvent.consume(a)});mxEvent.addListener(c.node,e,function(b){d.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,
a))});mxClient.IS_TOUCH&&mxEvent.addListener(c.node,"touchend",function(c){b.fireEvent(new mxEventObject(mxEvent.CLICK,"event",c,"cell",a.cell))})};
mxCellRenderer.prototype.createControl=function(a){var b=a.view.graph,c=b.getFoldingImage(a);if(b.foldingEnabled&&null!=c){if(null==a.control){var d=new mxRectangle(0,0,c.width,c.height);a.control=new mxImageShape(d,c.src);a.control.dialect=b.dialect;a.control.preserveImageAspect=!1;this.initControl(a,a.control,!0,function(c){if(b.isEnabled()){var d=!b.isCellCollapsed(a.cell);b.foldCells(d,!1,[a.cell]);mxEvent.consume(c)}})}}else null!=a.control&&(a.control.destroy(),a.control=null)};
mxCellRenderer.prototype.initControl=function(a,b,c,d){var e=a.view.graph;e.isHtmlLabel(a.cell)&&mxClient.NO_FO&&e.dialect==mxConstants.DIALECT_SVG?(b.dialect=mxConstants.DIALECT_PREFERHTML,b.init(e.container),b.node.style.zIndex=1):b.init(a.view.getOverlayPane());b=b.innerNode||b.node;d&&(e.isEnabled()&&(b.style.cursor="pointer"),mxEvent.addListener(b,"click",d));c&&(c=mxClient.IS_TOUCH?"touchmove":"mousemove",mxEvent.addListener(b,mxClient.IS_TOUCH?"touchstart":"mousedown",function(b){e.fireMouseEvent(mxEvent.MOUSE_DOWN,
new mxMouseEvent(b,a));mxEvent.consume(b)}),mxEvent.addListener(b,c,function(b){e.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,a))}));return b};mxCellRenderer.prototype.isShapeEvent=function(){return!0};mxCellRenderer.prototype.isLabelEvent=function(){return!0};
mxCellRenderer.prototype.installListeners=function(a){var b=a.view.graph;if(b.dialect==mxConstants.DIALECT_SVG){var c="all";if(b.getModel().isEdge(a.cell)&&null!=a.shape.stroke&&(null==a.shape.fill||a.shape.fill==mxConstants.NONE))c="visibleStroke";null!=a.shape.innerNode?a.shape.innerNode.setAttribute("pointer-events",c):a.shape.node.setAttribute("pointer-events",c)}var d=function(c){var d=a;if(b.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(c).nodeName||mxClient.IS_TOUCH)d=mxEvent.getClientX(c),
c=mxEvent.getClientY(c),c=mxUtils.convertPoint(b.container,d,c),d=b.view.getState(b.getCellAt(c.x,c.y));return d},e=!1;mxEvent.addListener(a.shape.node,"gesturestart",mxUtils.bind(this,function(a){b.lastTouchTime=0;e=!0;mxEvent.consume(a)}));var c=mxClient.IS_TOUCH?"touchmove":"mousemove",f=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(a.shape.node,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&!e?b.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(c,
null!=a.shape&&mxEvent.getSource(c)==a.shape.content?null:a)):e&&mxEvent.consume(c)}));mxEvent.addListener(a.shape.node,c,mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&!e?b.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(c,null!=a.shape&&mxEvent.getSource(c)==a.shape.content?null:d(c))):e&&mxEvent.consume(c)}));mxEvent.addListener(a.shape.node,f,mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&!e?b.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(c,null!=a.shape&&mxEvent.getSource(c)==
a.shape.content?null:d(c))):e&&mxEvent.consume(c)}));var g=mxClient.IS_TOUCH?"gestureend":"dblclick";mxEvent.addListener(a.shape.node,g,mxUtils.bind(this,function(c){e=!1;"gestureend"==g?(b.lastTouchTime=0,b.gestureEnabled&&(b.handleGesture(a,c),mxEvent.consume(c))):this.isShapeEvent(a,c)&&(b.dblClick(c,null!=a.shape&&mxEvent.getSource(c)==a.shape.content?null:a.cell),mxEvent.consume(c))}))};
mxCellRenderer.prototype.redrawLabel=function(a){var b=this.getLabelValue(a);if(null==a.text&&null!=b&&(mxUtils.isNode(b)||0<b.length))this.createLabel(a,b);else if(null!=a.text&&(null==b||0==b.length))a.text.destroy(),a.text=null;if(null!=a.text){var c=a.view.graph,d=c.isWrapping(a.cell),c=c.isLabelClipped(a.cell),e=this.getLabelBounds(a);if(a.text.value!=b||a.text.isWrapping!=d||a.text.isClipping!=c||a.text.scale!=a.view.scale||!a.text.bounds.equals(e))a.text.value=b,a.text.bounds=e,a.text.scale=
this.getTextScale(a),a.text.isWrapping=d,a.text.isClipping=c,a.text.redraw()}};mxCellRenderer.prototype.getTextScale=function(a){return a.view.scale};
mxCellRenderer.prototype.getLabelBounds=function(a){var b=a.view.graph,c=b.getModel().isEdge(a.cell),d=new mxRectangle(a.absoluteOffset.x,a.absoluteOffset.y);c||(d.x+=a.x,d.y+=a.y,d.width=Math.max(1,a.width),d.height=Math.max(1,a.height),b.isSwimlane(a.cell)&&(c=b.view.scale,a=b.getStartSize(a.cell),0<a.width?d.width=a.width*c:0<a.height&&(d.height=a.height*c)));return d};
mxCellRenderer.prototype.redrawCellOverlays=function(a){this.createCellOverlays(a);null!=a.overlays&&a.overlays.visit(function(b,c){var d=c.overlay.getBounds(a);if(null==c.bounds||c.scale!=a.view.scale||!c.bounds.equals(d))c.bounds=d,c.scale=a.view.scale,c.redraw()})};mxCellRenderer.prototype.redrawControl=function(a){if(null!=a.control){var b=this.getControlBounds(a),c=a.view.scale;if(a.control.scale!=c||!a.control.bounds.equals(b))a.control.bounds=b,a.control.scale=c,a.control.redraw()}};
mxCellRenderer.prototype.getControlBounds=function(a){if(null!=a.control){var b=a.control.scale,c=a.control.bounds.width/b,b=a.control.bounds.height/b,d=a.view.scale;return a.view.graph.getModel().isEdge(a.cell)?new mxRectangle(a.x+a.width/2-c/2*d,a.y+a.height/2-b/2*d,c*d,b*d):new mxRectangle(a.x+c/2*d,a.y+b/2*d,c*d,b*d)}return null};
mxCellRenderer.prototype.redraw=function(a,b,c){if(null!=a.shape){a.view.graph.getModel().isEdge(a.cell);reconfigure=null!=b?b:!1;this.createControl(a);if(a.orderChanged||a.invalidOrder)a.view.graph.ordered?this.order(a):this.orderEdge(a),reconfigure=a.orderChanged;delete a.invalidOrder;delete a.orderChanged;!reconfigure&&!mxUtils.equalEntries(a.shape.style,a.style)&&(reconfigure=!0);reconfigure&&(this.configureShape(a),a.shape.reconfigure());if(b||null==a.shape.bounds||a.shape.scale!=a.view.scale||
!a.shape.bounds.equals(a)||!mxUtils.equalPoints(a.shape.points,a.absolutePoints))a.shape.points=null!=a.absolutePoints?a.absolutePoints.slice():null,a.shape.bounds=new mxRectangle(a.x,a.y,a.width,a.height),a.shape.scale=a.view.scale,null==c||c?a.shape.redraw():a.shape.updateBoundingBox();if(null==c||c)this.redrawLabel(a),this.redrawCellOverlays(a),this.redrawControl(a)}};
mxCellRenderer.prototype.destroy=function(a){null!=a.shape&&(null!=a.text&&(a.text.destroy(),a.text=null),null!=a.overlays&&(a.overlays.visit(function(a,c){c.destroy()}),a.overlays=null),null!=a.control&&(a.control.destroy(),a.control=null),a.shape.destroy(),a.shape=null)};
var mxEdgeStyle={EntityRelation:function(a,b,c,d,e){var f=a.view,g=f.graph,d=mxUtils.getValue(a.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*f.scale,h=a.absolutePoints,k=h[0],l=h[h.length-1],h=!1;if(null!=k)b=new mxCellState,b.x=k.x,b.y=k.y;else if(null!=b){var n=mxUtils.getPortConstraints(b,a,!0,mxConstants.DIRECTION_MASK_NONE);n!=mxConstants.DIRECTION_MASK_NONE?h=n==mxConstants.DIRECTION_MASK_WEST:(k=g.getCellGeometry(b.cell),k.relative?h=0.5>=k.x:null!=c&&(h=c.x+c.width<b.x))}else return;
k=!0;null!=l?(c=new mxCellState,c.x=l.x,c.y=l.y):null!=c&&(n=mxUtils.getPortConstraints(c,a,!1,mxConstants.DIRECTION_MASK_NONE),n!=mxConstants.DIRECTION_MASK_NONE?k=n==mxConstants.DIRECTION_MASK_WEST:(a=g.getCellGeometry(c.cell),a.relative?k=0.5>=a.x:null!=b&&(k=b.x+b.width<c.x)));null!=b&&null!=c&&(a=h?b.x:b.x+b.width,b=f.getRoutingCenterY(b),g=k?c.x:c.x+c.width,c=f.getRoutingCenterY(c),f=new mxPoint(a+(h?-d:d),b),l=new mxPoint(g+(k?-d:d),c),h==k?(d=h?Math.min(a,g)-d:Math.max(a,g)+d,e.push(new mxPoint(d,
b)),e.push(new mxPoint(d,c))):(f.x<l.x==h?(d=b+(c-b)/2,e.push(f),e.push(new mxPoint(f.x,d)),e.push(new mxPoint(l.x,d))):e.push(f),e.push(l)))},Loop:function(a,b,c,d,e){if(null!=b){var c=a.view,f=c.graph,d=null!=d&&0<d.length?d[0]:null;null!=d&&(d=c.transformControlPoint(a,d),mxUtils.contains(b,d.x,d.y)&&(d=null));var g=0,h=0,k=0,l=0,f=mxUtils.getValue(a.style,mxConstants.STYLE_SEGMENT,f.gridSize)*c.scale,a=mxUtils.getValue(a.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);a==mxConstants.DIRECTION_NORTH||
a==mxConstants.DIRECTION_SOUTH?(g=c.getRoutingCenterX(b),h=f):(k=c.getRoutingCenterY(b),l=f);null==d||d.x<b.x||d.x>b.x+b.width?null!=d?(g=d.x,l=Math.max(Math.abs(k-d.y),l)):a==mxConstants.DIRECTION_NORTH?k=b.y-2*h:a==mxConstants.DIRECTION_SOUTH?k=b.y+b.height+2*h:g=a==mxConstants.DIRECTION_EAST?b.x-2*l:b.x+b.width+2*l:null!=d&&(g=c.getRoutingCenterX(b),h=Math.max(Math.abs(g-d.x),l),k=d.y,l=0);e.push(new mxPoint(g-h,k-l));e.push(new mxPoint(g+h,k+l))}},ElbowConnector:function(a,b,c,d,e){var f=null!=
d&&0<d.length?d[0]:null,g=!1,h=!1;if(null!=b&&null!=c)if(null!=f)var k=Math.min(b.x,c.x),l=Math.max(b.x+b.width,c.x+c.width),h=Math.min(b.y,c.y),n=Math.max(b.y+b.height,c.y+c.height),f=a.view.transformControlPoint(a,f),g=f.y<h||f.y>n,h=f.x<k||f.x>l;else k=Math.max(b.x,c.x),l=Math.min(b.x+b.width,c.x+c.width),g=k==l,g||(h=Math.max(b.y,c.y),n=Math.min(b.y+b.height,c.y+c.height),h=h==n);!h&&(g||a.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL)?mxEdgeStyle.TopToBottom(a,b,c,d,e):mxEdgeStyle.SideToSide(a,
b,c,d,e)},SideToSide:function(a,b,c,d,e){var f=a.view,d=null!=d&&0<d.length?d[0]:null,g=a.absolutePoints,h=g[0],g=g[g.length-1];null!=d&&(d=f.transformControlPoint(a,d));null!=h&&(b=new mxCellState,b.x=h.x,b.y=h.y);null!=g&&(c=new mxCellState,c.x=g.x,c.y=g.y);null!=b&&null!=c&&(a=Math.max(b.x,c.x),h=Math.min(b.x+b.width,c.x+c.width),a=null!=d?d.x:h+(a-h)/2,h=f.getRoutingCenterY(b),f=f.getRoutingCenterY(c),null!=d&&(d.y>=b.y&&d.y<=b.y+b.height&&(h=d.y),d.y>=c.y&&d.y<=c.y+c.height&&(f=d.y)),!mxUtils.contains(c,
a,h)&&!mxUtils.contains(b,a,h)&&e.push(new mxPoint(a,h)),!mxUtils.contains(c,a,f)&&!mxUtils.contains(b,a,f)&&e.push(new mxPoint(a,f)),1==e.length&&(null!=d?!mxUtils.contains(c,a,d.y)&&!mxUtils.contains(b,a,d.y)&&e.push(new mxPoint(a,d.y)):(f=Math.max(b.y,c.y),b=Math.min(b.y+b.height,c.y+c.height),e.push(new mxPoint(a,f+(b-f)/2)))))},TopToBottom:function(a,b,c,d,e){var f=a.view,d=null!=d&&0<d.length?d[0]:null,g=a.absolutePoints,h=g[0],g=g[g.length-1];null!=d&&(d=f.transformControlPoint(a,d));null!=
h&&(b=new mxCellState,b.x=h.x,b.y=h.y);null!=g&&(c=new mxCellState,c.x=g.x,c.y=g.y);null!=b&&null!=c&&(h=Math.max(b.y,c.y),g=Math.min(b.y+b.height,c.y+c.height),a=f.getRoutingCenterX(b),null!=d&&d.x>=b.x&&d.x<=b.x+b.width&&(a=d.x),h=null!=d?d.y:g+(h-g)/2,!mxUtils.contains(c,a,h)&&!mxUtils.contains(b,a,h)&&e.push(new mxPoint(a,h)),a=null!=d&&d.x>=c.x&&d.x<=c.x+c.width?d.x:f.getRoutingCenterX(c),!mxUtils.contains(c,a,h)&&!mxUtils.contains(b,a,h)&&e.push(new mxPoint(a,h)),1==e.length&&(null!=d&&1==e.length?
!mxUtils.contains(c,d.x,h)&&!mxUtils.contains(b,d.x,h)&&e.push(new mxPoint(d.x,h)):(f=Math.max(b.x,c.x),b=Math.min(b.x+b.width,c.x+c.width),e.push(new mxPoint(f+(b-f)/2,h)))))},SegmentConnector:function(a,b,c,d,e){var f=a.absolutePoints,g=!0,h=null,k=f[0];null==k&&null!=b?k=new mxPoint(a.view.getRoutingCenterX(b),a.view.getRoutingCenterY(b)):null!=k&&(k=k.clone());var l=f.length-1;if(null!=d&&0<d.length){for(var h=a.view.transformControlPoint(a,d[0]),n=b,o=f[0],p=!1,r=!1,p=h,s=d.length,u=0;2>u;u++){var w=
null!=o&&o.x==p.x,v=null!=o&&o.y==p.y,x=null!=n&&p.y>=n.y&&p.y<=n.y+n.height,n=null!=n&&p.x>=n.x&&p.x<=n.x+n.width,p=v||null==o&&x,r=w||null==o&&n;if(null!=o&&!v&&!w&&(x||n)){g=x?!1:!0;break}if(r||p){g=p;1==u&&(g=0==d.length%2?p:r);break}n=c;o=f[l];p=a.view.transformControlPoint(a,d[s-1])}g&&(null!=f[0]&&f[0].y!=h.y||null==f[0]&&null!=b&&(h.y<b.y||h.y>b.y+b.height))?e.push(new mxPoint(k.x,h.y)):!g&&(null!=f[0]&&f[0].x!=h.x||null==f[0]&&null!=b&&(h.x<b.x||h.x>b.x+b.width))&&e.push(new mxPoint(h.x,
k.y));g?k.y=h.y:k.x=h.x;for(u=0;u<d.length;u++)g=!g,h=a.view.transformControlPoint(a,d[u]),g?k.y=h.y:k.x=h.x,e.push(k.clone())}else h=k,g=!0;k=f[l];null==k&&null!=c&&(k=new mxPoint(a.view.getRoutingCenterX(c),a.view.getRoutingCenterY(c)));g&&(null!=f[l]&&f[l].y!=h.y||null==f[l]&&null!=c&&(h.y<c.y||h.y>c.y+c.height))?e.push(new mxPoint(k.x,h.y)):!g&&(null!=f[l]&&f[l].x!=h.x||null==f[l]&&null!=c&&(h.x<c.x||h.x>c.x+c.width))&&e.push(new mxPoint(h.x,k.y));if(null==f[0]&&null!=b)for(;1<e.length&&mxUtils.contains(b,
e[1].x,e[1].y);)e=e.splice(1,1);if(null==f[l]&&null!=c)for(;1<e.length&&mxUtils.contains(c,e[e.length-1].x,e[e.length-1].y);)e=e.splice(e.length-1,1)},orthBuffer:10,dirVectors:[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns:[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,
2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],inlineRoutePatterns:[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],vertexSeperations:[],limits:[[0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0]],LEFT_MASK:32,TOP_MASK:64,RIGHT_MASK:128,BOTTOM_MASK:256,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,SIDE_MASK:480,CENTER_MASK:512,SOURCE_MASK:1024,TARGET_MASK:2048,VERTEX_MASK:3072,OrthConnector:function(a,b,c,d,e){var f=a.view.graph,g=null==b?!1:f.getModel().isEdge(b.cell),f=null==c?!1:f.getModel().isEdge(c.cell);if(null!=d&&0<d.length||g||f)mxEdgeStyle.SegmentConnector(a,b,c,d,e);else{var d=a.absolutePoints,h=d[0],k=d[d.length-1],d=null!=b?b.x:h.x,g=null!=b?b.y:h.y,l=null!=b?b.width:1,n=
null!=b?b.height:1,o=null!=c?c.x:k.x,p=null!=c?c.y:k.y,r=null!=c?c.width:1,s=null!=c?c.height:1,f=a.view.scale*mxEdgeStyle.orthBuffer,u=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL];null!=b&&(u[0]=mxUtils.getPortConstraints(b,a,!0,mxConstants.DIRECTION_MASK_ALL));null!=c&&(u[1]=mxUtils.getPortConstraints(c,a,!1,mxConstants.DIRECTION_MASK_ALL));a=[0,0];d=[[d,g,l,n],[o,p,r,s]];for(l=0;2>l;l++)mxEdgeStyle.limits[l][1]=d[l][0]-f,mxEdgeStyle.limits[l][2]=d[l][1]-f,mxEdgeStyle.limits[l][4]=
d[l][0]+d[l][2]+f,mxEdgeStyle.limits[l][8]=d[l][1]+d[l][3]+f;l=d[0][0]+d[0][2]/2-(d[1][0]+d[1][2]/2);n=d[0][1]+d[0][3]/2-(d[1][1]+d[1][3]/2);g=0;0>l?g=0>n?2:1:0>=n&&(g=3,0==l&&(g=2));n=null;null!=b&&(n=h);b=[[0.5,0.5],[0.5,0.5]];for(l=0;2>l;l++)null!=n&&(b[l][0]=(n.x-d[l][0])/d[l][2],0.01>b[l][0]?a[l]=mxConstants.DIRECTION_MASK_WEST:0.99<b[l][0]&&(a[l]=mxConstants.DIRECTION_MASK_EAST),b[l][1]=(n.y-d[l][1])/d[l][3],0.01>b[l][1]?a[l]=mxConstants.DIRECTION_MASK_NORTH:0.99<b[l][1]&&(a[l]=mxConstants.DIRECTION_MASK_SOUTH)),
n=null,null!=c&&(n=k);l=d[0][1]-(d[1][1]+d[1][3]);n=d[0][0]-(d[1][0]+d[1][2]);o=d[1][1]-(d[0][1]+d[0][3]);p=d[1][0]-(d[0][0]+d[0][2]);mxEdgeStyle.vertexSeperations[1]=Math.max(n-2*f,0);mxEdgeStyle.vertexSeperations[2]=Math.max(l-2*f,0);mxEdgeStyle.vertexSeperations[4]=Math.max(o-2*f,0);mxEdgeStyle.vertexSeperations[3]=Math.max(p-2*f,0);c=[];h=[];k=[];h[0]=n>=p?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST;k[0]=l>=o?mxConstants.DIRECTION_MASK_NORTH:mxConstants.DIRECTION_MASK_SOUTH;
h[1]=mxUtils.reversePortConstraints(h[0]);k[1]=mxUtils.reversePortConstraints(k[0]);n=n>=p?n:p;o=l>=o?l:o;p=[[0,0],[0,0]];r=!1;for(l=0;2>l;l++)0==a[l]&&(0==(h[l]&u[l])&&(h[l]=mxUtils.reversePortConstraints(h[l])),0==(k[l]&u[l])&&(k[l]=mxUtils.reversePortConstraints(k[l])),p[l][0]=k[l],p[l][1]=h[l]);o>2*f&&n>2*f&&(0<(h[0]&u[0])&&0<(k[1]&u[1])?(p[0][0]=h[0],p[0][1]=k[0],p[1][0]=k[1],p[1][1]=h[1],r=!0):0<(k[0]&u[0])&&0<(h[1]&u[1])&&(p[0][0]=k[0],p[0][1]=h[0],p[1][0]=h[1],p[1][1]=k[1],r=!0));o>2*f&&!r&&
(p[0][0]=k[0],p[0][1]=h[0],p[1][0]=k[1],p[1][1]=h[1],r=!0);n>2*f&&!r&&(p[0][0]=h[0],p[0][1]=k[0],p[1][0]=h[1],p[1][1]=k[1]);for(l=0;2>l;l++)if(0==a[l]&&(0==(p[l][0]&u[l])&&(p[l][0]=p[l][1]),c[l]=p[l][0]&u[l],c[l]|=(p[l][1]&u[l])<<8,c[l]|=(p[1-l][l]&u[l])<<16,c[l]|=(p[1-l][1-l]&u[l])<<24,0==(c[l]&15)&&(c[l]<<=8),0==(c[l]&3840)&&(c[l]=c[l]&15|c[l]>>8),0==(c[l]&983040)&&(c[l]=c[l]&65535|(c[l]&251658240)>>8),a[l]=c[l]&15,u[l]==mxConstants.DIRECTION_MASK_WEST||u[l]==mxConstants.DIRECTION_MASK_NORTH||u[l]==
mxConstants.DIRECTION_MASK_EAST||u[l]==mxConstants.DIRECTION_MASK_SOUTH))a[l]=u[l];l=a[0]==mxConstants.DIRECTION_MASK_EAST?3:a[0];u=a[1]==mxConstants.DIRECTION_MASK_EAST?3:a[1];l-=g;u-=g;1>l&&(l+=4);1>u&&(u+=4);u=mxEdgeStyle.routePatterns[l-1][u-1];mxEdgeStyle.wayPoints1[0][0]=d[0][0];mxEdgeStyle.wayPoints1[0][1]=d[0][1];switch(a[0]){case mxConstants.DIRECTION_MASK_WEST:mxEdgeStyle.wayPoints1[0][0]-=f;mxEdgeStyle.wayPoints1[0][1]+=b[0][1]*d[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:mxEdgeStyle.wayPoints1[0][0]+=
b[0][0]*d[0][2];mxEdgeStyle.wayPoints1[0][1]+=d[0][3]+f;break;case mxConstants.DIRECTION_MASK_EAST:mxEdgeStyle.wayPoints1[0][0]+=d[0][2]+f;mxEdgeStyle.wayPoints1[0][1]+=b[0][1]*d[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:mxEdgeStyle.wayPoints1[0][0]+=b[0][0]*d[0][2],mxEdgeStyle.wayPoints1[0][1]-=f}f=0;h=c=0<(a[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1;for(l=k=0;l<u.length;l++){k=u[l]&15;s=k==mxConstants.DIRECTION_MASK_EAST?3:k;s+=g;4<s&&(s-=4);n=mxEdgeStyle.dirVectors[s-
1];k=0<s%2?0:1;k!=c&&(f++,mxEdgeStyle.wayPoints1[f][0]=mxEdgeStyle.wayPoints1[f-1][0],mxEdgeStyle.wayPoints1[f][1]=mxEdgeStyle.wayPoints1[f-1][1]);var w=0<(u[l]&mxEdgeStyle.TARGET_MASK),r=0<(u[l]&mxEdgeStyle.SOURCE_MASK),o=(u[l]&mxEdgeStyle.SIDE_MASK)>>5,o=o<<g;15<o&&(o>>=4);p=0<(u[l]&mxEdgeStyle.CENTER_MASK);(r||w)&&9>o?(s=0,r=r?0:1,s=p&&0==k?d[r][0]+b[r][0]*d[r][2]:p?d[r][1]+b[r][1]*d[r][3]:mxEdgeStyle.limits[r][o],0==k?(o=(s-mxEdgeStyle.wayPoints1[f][0])*n[0],0<o&&(mxEdgeStyle.wayPoints1[f][0]+=
n[0]*o)):(o=(s-mxEdgeStyle.wayPoints1[f][1])*n[1],0<o&&(mxEdgeStyle.wayPoints1[f][1]+=n[1]*o))):p&&(mxEdgeStyle.wayPoints1[f][0]+=n[0]*Math.abs(mxEdgeStyle.vertexSeperations[s]/2),mxEdgeStyle.wayPoints1[f][1]+=n[1]*Math.abs(mxEdgeStyle.vertexSeperations[s]/2));0<f&&mxEdgeStyle.wayPoints1[f][k]==mxEdgeStyle.wayPoints1[f-1][k]?f--:c=k}for(l=0;l<=f&&!(l==f&&((0<(a[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1)==h?0:1)!=(f+1)%2);l++)e.push(new mxPoint(mxEdgeStyle.wayPoints1[l][0],
mxEdgeStyle.wayPoints1[l][1]))}},getRoutePattern:function(a,b,c,d){var e=a[0]==mxConstants.DIRECTION_MASK_EAST?3:a[0],a=a[1]==mxConstants.DIRECTION_MASK_EAST?3:a[1],e=e-b,a=a-b;1>e&&(e+=4);1>a&&(a+=4);b=routePatterns[e-1][a-1];if(0==c||0==d)null!=inlineRoutePatterns[e-1][a-1]&&(b=inlineRoutePatterns[e-1][a-1]);return b}},mxStyleRegistry={values:[],putValue:function(a,b){mxStyleRegistry.values[a]=b},getValue:function(a){return mxStyleRegistry.values[a]},getName:function(a){for(var b in mxStyleRegistry.values)if(mxStyleRegistry.values[b]==
a)return b;return null}};mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector);
mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector);mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter);
function mxGraphView(a){this.graph=a;this.translate=new mxPoint;this.graphBounds=new mxRectangle;this.states=new mxDictionary}mxGraphView.prototype=new mxEventSource;mxGraphView.prototype.constructor=mxGraphView;mxGraphView.prototype.EMPTY_POINT=new mxPoint;mxGraphView.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphView.prototype.updatingDocumentResource="none"!=mxClient.language?"updatingDocument":"";mxGraphView.prototype.allowEval=!1;
mxGraphView.prototype.captureDocumentGesture=!0;mxGraphView.prototype.rendering=!0;mxGraphView.prototype.graph=null;mxGraphView.prototype.currentRoot=null;mxGraphView.prototype.graphBounds=null;mxGraphView.prototype.scale=1;mxGraphView.prototype.translate=null;mxGraphView.prototype.updateStyle=!1;mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds};mxGraphView.prototype.setGraphBounds=function(a){this.graphBounds=a};
mxGraphView.prototype.getBounds=function(a){var b=null;if(null!=a&&0<a.length)for(var c=this.graph.getModel(),d=0;d<a.length;d++)if(c.isVertex(a[d])||c.isEdge(a[d])){var e=this.getState(a[d]);null!=e&&(null==b?b=new mxRectangle(e.x,e.y,e.width,e.height):b.add(e))}return b};mxGraphView.prototype.setCurrentRoot=function(a){if(this.currentRoot!=a){var b=new mxCurrentRootChange(this,a);b.execute();var c=new mxUndoableEdit(this,!1);c.add(b);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",c));this.graph.sizeDidChange()}return a};
mxGraphView.prototype.scaleAndTranslate=function(a,b,c){var d=this.scale,e=new mxPoint(this.translate.x,this.translate.y);if(this.scale!=a||this.translate.x!=b||this.translate.y!=c)this.scale=a,this.translate.x=b,this.translate.y=c,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange());this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",a,"previousScale",d,"translate",this.translate,"previousTranslate",e))};mxGraphView.prototype.getScale=function(){return this.scale};
mxGraphView.prototype.setScale=function(a){var b=this.scale;this.scale!=a&&(this.scale=a,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",a,"previousScale",b))};mxGraphView.prototype.getTranslate=function(){return this.translate};
mxGraphView.prototype.setTranslate=function(a,b){var c=new mxPoint(this.translate.x,this.translate.y);if(this.translate.x!=a||this.translate.y!=b)this.translate.x=a,this.translate.y=b,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange());this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",c))};mxGraphView.prototype.refresh=function(){null!=this.currentRoot&&this.clear();this.revalidate()};
mxGraphView.prototype.revalidate=function(){this.invalidate();this.validate()};mxGraphView.prototype.clear=function(a,b,c){var d=this.graph.getModel(),a=a||d.getRoot(),b=null!=b?b:!1,c=null!=c?c:!0;this.removeState(a);if(c&&(b||a!=this.currentRoot))for(var c=d.getChildCount(a),e=0;e<c;e++)this.clear(d.getChildAt(a,e),b);else this.invalidate(a)};
mxGraphView.prototype.invalidate=function(a,b,c,d){var e=this.graph.getModel(),a=a||e.getRoot(),b=null!=b?b:!0,c=null!=c?c:!0,d=null!=d?d:!1,f=this.getState(a);null!=f&&(f.invalid=!0,d&&(f.orderChanged=!0));if(b)for(var g=e.getChildCount(a),f=0;f<g;f++)this.invalidate(e.getChildAt(a,f),b,c,d);if(c){d=e.getEdgeCount(a);for(f=0;f<d;f++)this.invalidate(e.getEdgeAt(a,f),b,c)}};
mxGraphView.prototype.validate=function(a){var b=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource;a=a||(null!=this.currentRoot?this.currentRoot:this.graph.getModel().getRoot());this.validateBounds(null,a);a=this.validatePoints(null,a);null==a&&(a=new mxRectangle);this.setGraphBounds(a);this.validateBackground();window.status=mxResources.get(this.doneResource)||this.doneResource;mxLog.leave("mxGraphView.validate",b)};
mxGraphView.prototype.createBackgroundPageShape=function(a){return new mxRectangleShape(a,"white","black")};
mxGraphView.prototype.validateBackground=function(){var a=this.graph.getBackgroundImage();if(null!=a){if(null==this.backgroundImage||this.backgroundImage.image!=a.src){null!=this.backgroundImage&&this.backgroundImage.destroy();var b=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(b,a.src);this.backgroundImage.dialect=this.graph.dialect;this.backgroundImage.init(this.backgroundPane);this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,a)}else null!=this.backgroundImage&&
(this.backgroundImage.destroy(),this.backgroundImage=null);this.graph.pageVisible?(b=this.getBackgroundPageBounds(),null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(b),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),mxEvent.addListener(this.backgroundPageShape.node,"dblclick",mxUtils.bind(this,
function(a){this.graph.dblClick(a)})),a=mxClient.IS_TOUCH?"touchmove":"mousemove",b=mxClient.IS_TOUCH?"touchend":"mouseup",mxEvent.addListener(this.backgroundPageShape.node,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))})),mxEvent.addListener(this.backgroundPageShape.node,a,mxUtils.bind(this,function(a){null!=this.graph.tooltipHandler&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide();
this.graph.isMouseDown&&!mxEvent.isConsumed(a)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))})),mxEvent.addListener(this.backgroundPageShape.node,b,mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=b,this.backgroundPageShape.redraw())):null!=this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)};
mxGraphView.prototype.getBackgroundPageBounds=function(){var a=this.graph.pageFormat,b=this.scale*this.graph.pageScale;return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,a.width*b,a.height*b)};mxGraphView.prototype.redrawBackgroundImage=function(a,b){a.scale=this.scale;a.bounds.x=this.scale*this.translate.x;a.bounds.y=this.scale*this.translate.y;a.bounds.width=this.scale*b.width;a.bounds.height=this.scale*b.height;a.redraw()};
mxGraphView.prototype.validateBounds=function(a,b){var c=this.graph.getModel(),d=this.getState(b,!0);if(null!=d&&d.invalid){if(this.graph.isCellVisible(b)){if(b!=this.currentRoot&&null!=a){d.absoluteOffset.x=0;d.absoluteOffset.y=0;d.origin.x=a.origin.x;d.origin.y=a.origin.y;var e=this.graph.getCellGeometry(b);if(null!=e){if(!c.isEdge(b)){var f=e.offset||this.EMPTY_POINT;e.relative?(d.origin.x+=e.x*a.width/this.scale+f.x,d.origin.y+=e.y*a.height/this.scale+f.y):(d.absoluteOffset.x=this.scale*f.x,d.absoluteOffset.y=
this.scale*f.y,d.origin.x+=e.x,d.origin.y+=e.y)}d.x=this.scale*(this.translate.x+d.origin.x);d.y=this.scale*(this.translate.y+d.origin.y);d.width=this.scale*e.width;d.height=this.scale*e.height;c.isVertex(b)&&this.updateVertexLabelOffset(d)}}}else this.removeState(b);f=this.graph.getChildOffsetForCell(b);null!=f&&(d.origin.x+=f.x,d.origin.y+=f.y)}if(null!=d&&(!this.graph.isCellCollapsed(b)||b==this.currentRoot)){e=c.getChildCount(b);for(f=0;f<e;f++){var g=c.getChildAt(b,f);this.validateBounds(d,g)}}};
mxGraphView.prototype.updateVertexLabelOffset=function(a){var b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);b==mxConstants.ALIGN_LEFT?a.absoluteOffset.x-=a.width:b==mxConstants.ALIGN_RIGHT&&(a.absoluteOffset.x+=a.width);b=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);b==mxConstants.ALIGN_TOP?a.absoluteOffset.y-=a.height:b==mxConstants.ALIGN_BOTTOM&&(a.absoluteOffset.y+=a.height)};
mxGraphView.prototype.validatePoints=function(a,b){var c=this.graph.getModel(),d=this.getState(b),e=null;if(null!=d){if(d.invalid){var f=this.graph.getCellGeometry(b);if(null!=f&&c.isEdge(b)){var g=this.getState(this.getVisibleTerminal(b,!0));d.setVisibleTerminalState(g,!0);if(null!=g&&c.isEdge(g.cell)&&!c.isAncestor(g.cell,b)){var h=this.getState(c.getParent(g.cell));this.validatePoints(h,g.cell)}var k=this.getState(this.getVisibleTerminal(b,!1));d.setVisibleTerminalState(k,!1);null!=k&&c.isEdge(k.cell)&&
!c.isAncestor(k.cell,b)&&(h=this.getState(c.getParent(k.cell)),this.validatePoints(h,k.cell));this.updateFixedTerminalPoints(d,g,k);this.updatePoints(d,f.points,g,k);this.updateFloatingTerminalPoints(d,g,k);this.updateEdgeBounds(d);this.updateEdgeLabelOffset(d)}else null!=f&&f.relative&&null!=a&&c.isEdge(a.cell)&&(f=this.getPoint(a,f),null!=f&&(d.x=f.x,d.y=f.y,f.x=f.x/this.scale-this.translate.x,f.y=f.y/this.scale-this.translate.y,d.origin=f,this.childMoved(a,d)));d.invalid=!1;b!=this.currentRoot&&
this.graph.cellRenderer.redraw(d,!1,this.isRendering())}if(c.isEdge(b)||c.isVertex(b))null!=d.shape&&null!=d.shape.boundingBox&&(e=d.shape.boundingBox.clone()),null!=d.text&&!this.graph.isLabelClipped(d.cell)&&null!=d.text.boundingBox&&(null!=e?e.add(d.text.boundingBox):e=d.text.boundingBox.clone())}if(null!=d&&(!this.graph.isCellCollapsed(b)||b==this.currentRoot)){f=c.getChildCount(b);for(g=0;g<f;g++)h=c.getChildAt(b,g),h=this.validatePoints(d,h),null!=h&&(null==e?e=h:e.add(h))}return e};
mxGraphView.prototype.childMoved=function(a,b){var c=b.cell;if(!this.graph.isCellCollapsed(c)||c==this.currentRoot)for(var d=this.graph.getModel(),e=d.getChildCount(c),f=0;f<e;f++)this.validateBounds(b,d.getChildAt(c,f))};mxGraphView.prototype.updateFixedTerminalPoints=function(a,b,c){this.updateFixedTerminalPoint(a,b,!0,this.graph.getConnectionConstraint(a,b,!0));this.updateFixedTerminalPoint(a,c,!1,this.graph.getConnectionConstraint(a,c,!1))};
mxGraphView.prototype.updateFixedTerminalPoint=function(a,b,c,d){var e=null;null!=d&&(e=this.graph.getConnectionPoint(b,d));if(null==e&&null==b){var b=this.scale,d=this.translate,f=a.origin,e=this.graph.getCellGeometry(a.cell).getTerminalPoint(c);null!=e&&(e=new mxPoint(b*(d.x+e.x+f.x),b*(d.y+e.y+f.y)))}a.setAbsoluteTerminalPoint(e,c)};
mxGraphView.prototype.updatePoints=function(a,b,c,d){if(null!=a){var e=[];e.push(a.absolutePoints[0]);var f=this.getEdgeStyle(a,b,c,d);if(null!=f)c=this.getTerminalPort(a,c,!0),d=this.getTerminalPort(a,d,!1),f(a,c,d,b,e);else if(null!=b)for(f=0;f<b.length;f++)null!=b[f]&&(d=mxUtils.clone(b[f]),e.push(this.transformControlPoint(a,d)));b=a.absolutePoints;e.push(b[b.length-1]);a.absolutePoints=e}};
mxGraphView.prototype.transformControlPoint=function(a,b){var c=a.origin;return new mxPoint(this.scale*(b.x+this.translate.x+c.x),this.scale*(b.y+this.translate.y+c.y))};
mxGraphView.prototype.getEdgeStyle=function(a,b,c,d){a=null!=c&&c==d?mxUtils.getValue(a.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):!mxUtils.getValue(a.style,mxConstants.STYLE_NOEDGESTYLE,!1)?a.style[mxConstants.STYLE_EDGE]:null;"string"==typeof a&&(b=mxStyleRegistry.getValue(a),null==b&&this.isAllowEval()&&(b=mxUtils.eval(a)),a=b);return"function"==typeof a?a:null};
mxGraphView.prototype.updateFloatingTerminalPoints=function(a,b,c){var d=a.absolutePoints,e=d[0];null==d[d.length-1]&&null!=c&&this.updateFloatingTerminalPoint(a,c,b,!1);null==e&&null!=b&&this.updateFloatingTerminalPoint(a,b,c,!0)};
mxGraphView.prototype.updateFloatingTerminalPoint=function(a,b,c,d){var b=this.getTerminalPort(a,b,d),e=this.getNextPoint(a,c,d),c=mxUtils.toRadians(Number(b.style[mxConstants.STYLE_ROTATION]||"0")),f=new mxPoint(b.getCenterX(),b.getCenterY());if(0!=c)var g=Math.cos(-c),h=Math.sin(-c),e=mxUtils.getRotatedPoint(e,g,h,f);g=parseFloat(a.style[mxConstants.STYLE_PERIMETER_SPACING]||0);g+=parseFloat(a.style[d?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0);b=this.getPerimeterPoint(b,
e,this.graph.isOrthogonal(a),g);0!=c&&(g=Math.cos(c),h=Math.sin(c),b=mxUtils.getRotatedPoint(b,g,h,f));a.setAbsoluteTerminalPoint(b,d)};mxGraphView.prototype.getTerminalPort=function(a,b,c){a=mxUtils.getValue(a.style,c?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT);null!=a&&(a=this.getState(this.graph.getModel().getCell(a)),null!=a&&(b=a));return b};
mxGraphView.prototype.getPerimeterPoint=function(a,b,c,d){var e=null;if(null!=a){var f=this.getPerimeterFunction(a);if(null!=f&&null!=b&&(d=this.getPerimeterBounds(a,d),0<d.width||0<d.height))e=f(d,a,b,c);null==e&&(e=this.getPoint(a))}return e};mxGraphView.prototype.getRoutingCenterX=function(a){var b=null!=a.style?parseFloat(a.style[mxConstants.STYLE_ROUTING_CENTER_X])||0:0;return a.getCenterX()+b*a.width};
mxGraphView.prototype.getRoutingCenterY=function(a){var b=null!=a.style?parseFloat(a.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0:0;return a.getCenterY()+b*a.height};mxGraphView.prototype.getPerimeterBounds=function(a,b){b=null!=b?b:0;null!=a&&(b+=parseFloat(a.style[mxConstants.STYLE_PERIMETER_SPACING]||0));return a.getPerimeterBounds(b*this.scale)};
mxGraphView.prototype.getPerimeterFunction=function(a){a=a.style[mxConstants.STYLE_PERIMETER];if("string"==typeof a){var b=mxStyleRegistry.getValue(a);null==b&&this.isAllowEval()&&(b=mxUtils.eval(a));a=b}return"function"==typeof a?a:null};mxGraphView.prototype.getNextPoint=function(a,b,c){var a=a.absolutePoints,d=null;if(null!=a&&(c||2<a.length||null==b))d=a.length,d=a[c?Math.min(1,d-1):Math.max(0,d-2)];null==d&&null!=b&&(d=new mxPoint(b.getCenterX(),b.getCenterY()));return d};
mxGraphView.prototype.getVisibleTerminal=function(a,b){for(var c=this.graph.getModel(),d=c.getTerminal(a,b),e=d;null!=d&&d!=this.currentRoot;){if(!this.graph.isCellVisible(e)||this.graph.isCellCollapsed(d))e=d;d=c.getParent(d)}c.getParent(e)==c.getRoot()&&(e=null);return e};
mxGraphView.prototype.updateEdgeBounds=function(a){var b=a.absolutePoints;a.length=0;if(null!=b&&0<b.length){var c=b[0],d=b[b.length-1];if(null==c||null==d)a.cell!=this.currentRoot&&this.clear(a.cell,!0);else{if(c.x!=d.x||c.y!=d.y){var e=d.x-c.x,f=d.y-c.y;a.terminalDistance=Math.sqrt(e*e+f*f)}else a.terminalDistance=0;var d=0,g=[],f=c;if(null!=f){for(var c=f.x,h=f.y,k=c,l=h,n=1;n<b.length;n++){var o=b[n];null!=o&&(e=f.x-o.x,f=f.y-o.y,e=Math.sqrt(e*e+f*f),g.push(e),d+=e,f=o,c=Math.min(f.x,c),h=Math.min(f.y,
h),k=Math.max(f.x,k),l=Math.max(f.y,l))}a.length=d;a.segments=g;a.x=c;a.y=h;a.width=Math.max(1,k-c);a.height=Math.max(1,l-h)}}}};
mxGraphView.prototype.getPoint=function(a,b){var c=a.getCenterX(),d=a.getCenterY();if(null!=a.segments&&(null==b||b.relative)){for(var e=a.absolutePoints.length,f=((null!=b?b.x/2:0)+0.5)*a.length,g=a.segments[0],h=0,k=1;f>h+g&&k<e-1;)h+=g,g=a.segments[k++];e=0==g?0:(f-h)/g;f=a.absolutePoints[k-1];k=a.absolutePoints[k];if(null!=f&&null!=k){h=c=d=0;if(null!=b){var d=b.y,l=b.offset;null!=l&&(c=l.x,h=l.y)}l=k.x-f.x;k=k.y-f.y;c=f.x+l*e+((0==g?0:k/g)*d+c)*this.scale;d=f.y+k*e-((0==g?0:l/g)*d-h)*this.scale}}else null!=
b&&(l=b.offset,null!=l&&(c+=l.x,d+=l.y));return new mxPoint(c,d)};
mxGraphView.prototype.getRelativePoint=function(a,b,c){var d=this.graph.getModel().getGeometry(a.cell);if(null!=d){var e=a.absolutePoints.length;if(d.relative&&1<e){for(var d=a.length,f=a.segments,g=a.absolutePoints[0],h=a.absolutePoints[1],k=mxUtils.ptSegDistSq(g.x,g.y,h.x,h.y,b,c),l=0,n=0,o=0,p=2;p<e;p++)n+=f[p-2],h=a.absolutePoints[p],g=mxUtils.ptSegDistSq(g.x,g.y,h.x,h.y,b,c),g<=k&&(k=g,l=p-1,o=n),g=h;e=f[l];g=a.absolutePoints[l];h=a.absolutePoints[l+1];f=h.x;k=h.y;a=g.x-f;l=g.y-k;f=(a-(b-f))*
a+(l-(c-k))*l;a=Math.sqrt(0>=f?0:f*f/(a*a+l*l));a>e&&(a=e);e=Math.sqrt(mxUtils.ptSegDistSq(g.x,g.y,h.x,h.y,b,c));-1==mxUtils.relativeCcw(g.x,g.y,h.x,h.y,b,c)&&(e=-e);return new mxPoint(-2*((d/2-o-a)/d),e/this.scale)}}return new mxPoint};
mxGraphView.prototype.updateEdgeLabelOffset=function(a){var b=a.absolutePoints;a.absoluteOffset.x=a.getCenterX();a.absoluteOffset.y=a.getCenterY();if(null!=b&&0<b.length&&null!=a.segments){var c=this.graph.getCellGeometry(a.cell);if(c.relative){var d=this.getPoint(a,c);null!=d&&(a.absoluteOffset=d)}else{var d=b[0],e=b[b.length-1];if(null!=d&&null!=e){var b=e.x-d.x,f=e.y-d.y,g=e=0,c=c.offset;null!=c&&(e=c.x,g=c.y);c=d.y+f/2+g*this.scale;a.absoluteOffset.x=d.x+b/2+e*this.scale;a.absoluteOffset.y=c}}}};
mxGraphView.prototype.getState=function(a,b){var b=b||!1,c=null;null!=a&&(c=this.states.get(a),this.graph.isCellVisible(a)&&(null==c&&b&&this.graph.isCellVisible(a)?(c=this.createState(a),this.states.put(a,c)):b&&null!=c&&this.updateStyle&&(c.style=this.graph.getCellStyle(a))));return c};mxGraphView.prototype.isRendering=function(){return this.rendering};mxGraphView.prototype.setRendering=function(a){this.rendering=a};mxGraphView.prototype.isAllowEval=function(){return this.allowEval};
mxGraphView.prototype.setAllowEval=function(a){this.allowEval=a};mxGraphView.prototype.getStates=function(){return this.states};mxGraphView.prototype.setStates=function(a){this.states=a};mxGraphView.prototype.getCellStates=function(a){if(null==a)return this.states;for(var b=[],c=0;c<a.length;c++){var d=this.getState(a[c]);null!=d&&b.push(d)}return b};
mxGraphView.prototype.removeState=function(a){var b=null;null!=a&&(b=this.states.remove(a),null!=b&&(this.graph.cellRenderer.destroy(b),b.destroy()));return b};mxGraphView.prototype.createState=function(a){var b=this.graph.getCellStyle(a),a=new mxCellState(this,a,b);this.graph.cellRenderer.initialize(a,this.isRendering());return a};mxGraphView.prototype.getCanvas=function(){return this.canvas};mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane};
mxGraphView.prototype.getDrawPane=function(){return this.drawPane};mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane};mxGraphView.prototype.isContainerEvent=function(a){a=mxEvent.getSource(a);return a==this.graph.container||a.parentNode==this.backgroundPane||null!=a.parentNode&&a.parentNode.parentNode==this.backgroundPane||a==this.canvas.parentNode||a==this.canvas||a==this.backgroundPane||a==this.drawPane||a==this.overlayPane};
mxGraphView.prototype.isScrollEvent=function(a){var b=mxUtils.getOffset(this.graph.container),a=new mxPoint(a.clientX-b.x,a.clientY-b.y),b=this.graph.container.offsetWidth,c=this.graph.container.clientWidth;if(b>c&&a.x>c+2&&a.x<=b)return!0;b=this.graph.container.offsetHeight;c=this.graph.container.clientHeight;return b>c&&a.y>c+2&&a.y<=b?!0:!1};
mxGraphView.prototype.init=function(){this.installListeners();var a=this.graph;a.dialect==mxConstants.DIALECT_SVG?this.createSvg():a.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()};
mxGraphView.prototype.installListeners=function(){var a=this.graph,b=a.container;if(null!=b){var c=mxClient.IS_TOUCH?"touchmove":"mousemove",d=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(b,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(b){mxClient.IS_TOUCH&&a.isEditing()&&a.stopEditing(!a.isInvokesStopCellEditing());this.isContainerEvent(b)&&(!mxClient.IS_IE&&!mxClient.IS_GC&&!mxClient.IS_OP&&!mxClient.IS_SF||!this.isScrollEvent(b))&&a.fireMouseEvent(mxEvent.MOUSE_DOWN,
new mxMouseEvent(b))}));mxEvent.addListener(b,c,mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b))}));mxEvent.addListener(b,d,mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))}));mxEvent.addListener(b,"dblclick",mxUtils.bind(this,function(b){a.dblClick(b)}));var e=function(c){var d=null;mxClient.IS_TOUCH&&(d=mxEvent.getClientX(c),c=mxEvent.getClientY(c),c=mxUtils.convertPoint(b,
d,c),d=a.view.getState(a.getCellAt(c.x,c.y)));return d};a.addMouseListener({mouseDown:function(){a.panningHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}});this.moveHandler=mxUtils.bind(this,function(b){null!=a.tooltipHandler&&a.tooltipHandler.isHideOnHover()&&a.tooltipHandler.hide();this.captureDocumentGesture&&a.isMouseDown&&!mxEvent.isConsumed(b)&&a.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,e(b)))});mxEvent.addListener(document,c,this.moveHandler);this.endHandler=mxUtils.bind(this,
function(b){this.captureDocumentGesture&&a.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))});mxEvent.addListener(document,d,this.endHandler)}};
mxGraphView.prototype.createHtml=function(){var a=this.graph.container;null!=a&&(this.canvas=this.createHtmlPane("100%","100%"),this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),a.appendChild(this.canvas),mxClient.IS_QUIRKS&&(a=mxUtils.bind(this,function(){var a=this.getGraphBounds();
this.updateHtmlCanvasSize(a.x+a.width+this.graph.border,a.y+a.height+this.graph.border)}),mxEvent.addListener(window,"resize",a)))};mxGraphView.prototype.updateHtmlCanvasSize=function(a,b){if(null!=this.graph.container){var c=this.graph.container.offsetHeight;this.canvas.style.width=this.graph.container.offsetWidth<a?a+"px":"100%";this.canvas.style.height=c<b?b+"px":"100%"}};
mxGraphView.prototype.createHtmlPane=function(a,b){var c=document.createElement("DIV");null!=a&&null!=b?(c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.style.width=a,c.style.height=b):c.style.position="relative";return c};
mxGraphView.prototype.createVml=function(){var a=this.graph.container;if(null!=a){var b=a.offsetWidth,c=a.offsetHeight;this.canvas=this.createVmlPane(b,c);this.backgroundPane=this.createVmlPane(b,c);this.drawPane=this.createVmlPane(b,c);this.overlayPane=this.createVmlPane(b,c);this.canvas.appendChild(this.backgroundPane);this.canvas.appendChild(this.drawPane);this.canvas.appendChild(this.overlayPane);a.appendChild(this.canvas)}};
mxGraphView.prototype.createVmlPane=function(a,b){var c=document.createElement("v:group");c.style.position="absolute";c.style.left="0px";c.style.top="0px";c.style.width=a+"px";c.style.height=b+"px";c.setAttribute("coordsize",a+","+b);c.setAttribute("coordorigin","0,0");return c};
mxGraphView.prototype.createSvg=function(){var a=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g");this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.backgroundPane);this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.drawPane);this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.overlayPane);var b=document.createElementNS(mxConstants.NS_SVG,
"svg");b.style.width="100%";b.style.height="100%";b.style.display="block";b.appendChild(this.canvas);null!=a&&(a.appendChild(b),"static"==mxUtils.getCurrentStyle(a).position&&(a.style.position="relative"))};
mxGraphView.prototype.destroy=function(){var a=null!=this.canvas?this.canvas.ownerSVGElement:null;null==a&&(a=this.canvas);null!=a&&null!=a.parentNode&&(this.clear(this.currentRoot,!0),null!=this.moveHandler&&(mxEvent.removeListener(document,mxClient.IS_TOUCH?"touchmove":"mousemove",this.moveHandler),this.moveHandler=null),null!=this.endHandler&&(mxEvent.removeListener(document,mxClient.IS_TOUCH?"touchend":"mouseup",this.endHandler),this.endHandler=null),mxEvent.release(this.graph.container),a.parentNode.removeChild(a),
this.overlayPane=this.drawPane=this.backgroundPane=this.canvas=null)};function mxCurrentRootChange(a,b){this.view=a;this.previous=this.root=b;this.isUp=null==b;if(!this.isUp)for(var c=this.view.currentRoot,d=this.view.graph.getModel();null!=c;){if(c==b){this.isUp=!0;break}c=d.getParent(c)}}
mxCurrentRootChange.prototype.execute=function(){var a=this.view.currentRoot;this.view.currentRoot=this.previous;this.previous=a;a=this.view.graph.getTranslateForRoot(this.view.currentRoot);null!=a&&(this.view.translate=new mxPoint(-a.x,-a.y));this.view.fireEvent(new mxEventObject(this.isUp?mxEvent.UP:mxEvent.DOWN,"root",this.view.currentRoot,"previous",this.previous));this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();this.isUp=!this.isUp};
function mxGraph(a,b,c,d){this.mouseListeners=null;this.renderHint=c;this.dialect=mxClient.IS_SVG?mxConstants.DIALECT_SVG:c==mxConstants.RENDERING_HINT_EXACT&&mxClient.IS_VML?mxConstants.DIALECT_VML:c==mxConstants.RENDERING_HINT_FASTEST?mxConstants.DIALECT_STRICTHTML:c==mxConstants.RENDERING_HINT_FASTER?mxConstants.DIALECT_PREFERHTML:mxConstants.DIALECT_MIXEDHTML;this.model=null!=b?b:new mxGraphModel;this.multiplicities=[];this.imageBundles=[];this.cellRenderer=this.createCellRenderer();this.setSelectionModel(this.createSelectionModel());
this.setStylesheet(null!=d?d:this.createStylesheet());this.view=this.createGraphView();this.graphModelChangeListener=mxUtils.bind(this,function(a,b){this.graphModelChanged(b.getProperty("edit").changes)});this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener);this.createHandlers();null!=a&&this.init(a);this.view.revalidate()}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/graph");mxGraph.prototype=new mxEventSource;mxGraph.prototype.constructor=mxGraph;
mxGraph.prototype.EMPTY_ARRAY=[];mxGraph.prototype.mouseListeners=null;mxGraph.prototype.isMouseDown=!1;mxGraph.prototype.model=null;mxGraph.prototype.view=null;mxGraph.prototype.stylesheet=null;mxGraph.prototype.selectionModel=null;mxGraph.prototype.cellEditor=null;mxGraph.prototype.cellRenderer=null;mxGraph.prototype.multiplicities=null;mxGraph.prototype.renderHint=null;mxGraph.prototype.dialect=null;mxGraph.prototype.gridSize=10;mxGraph.prototype.gridEnabled=!0;mxGraph.prototype.portsEnabled=!0;
mxGraph.prototype.doubleTapEnabled=!0;mxGraph.prototype.doubleTapTimeout=700;mxGraph.prototype.doubleTapTolerance=25;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchTime=0;mxGraph.prototype.gestureEnabled=!0;mxGraph.prototype.tolerance=4;mxGraph.prototype.defaultOverlap=0.5;mxGraph.prototype.defaultParent=null;mxGraph.prototype.alternateEdgeStyle=null;mxGraph.prototype.backgroundImage=null;mxGraph.prototype.pageVisible=!1;
mxGraph.prototype.pageBreaksVisible=!1;mxGraph.prototype.pageBreakColor="gray";mxGraph.prototype.pageBreakDashed=!0;mxGraph.prototype.minPageBreakDist=20;mxGraph.prototype.preferPageSize=!1;mxGraph.prototype.pageFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;mxGraph.prototype.pageScale=1.5;mxGraph.prototype.enabled=!0;mxGraph.prototype.escapeEnabled=!0;mxGraph.prototype.invokesStopCellEditing=!0;mxGraph.prototype.enterStopsCellEditing=!1;mxGraph.prototype.useScrollbarsForPanning=!0;
mxGraph.prototype.exportEnabled=!0;mxGraph.prototype.importEnabled=!0;mxGraph.prototype.cellsLocked=!1;mxGraph.prototype.cellsCloneable=!0;mxGraph.prototype.foldingEnabled=!0;mxGraph.prototype.cellsEditable=!0;mxGraph.prototype.cellsDeletable=!0;mxGraph.prototype.cellsMovable=!0;mxGraph.prototype.edgeLabelsMovable=!0;mxGraph.prototype.vertexLabelsMovable=!1;mxGraph.prototype.dropEnabled=!1;mxGraph.prototype.splitEnabled=!0;mxGraph.prototype.cellsResizable=!0;mxGraph.prototype.cellsBendable=!0;
mxGraph.prototype.cellsSelectable=!0;mxGraph.prototype.cellsDisconnectable=!0;mxGraph.prototype.autoSizeCells=!1;mxGraph.prototype.autoScroll=!0;mxGraph.prototype.timerAutoScroll=!1;mxGraph.prototype.allowAutoPanning=!1;mxGraph.prototype.ignoreScrollbars=!1;mxGraph.prototype.autoExtend=!0;mxGraph.prototype.maximumGraphBounds=null;mxGraph.prototype.minimumGraphSize=null;mxGraph.prototype.minimumContainerSize=null;mxGraph.prototype.maximumContainerSize=null;mxGraph.prototype.resizeContainer=!1;
mxGraph.prototype.border=0;mxGraph.prototype.ordered=!0;mxGraph.prototype.keepEdgesInForeground=!1;mxGraph.prototype.keepEdgesInBackground=!0;mxGraph.prototype.allowNegativeCoordinates=!0;mxGraph.prototype.constrainChildren=!0;mxGraph.prototype.extendParents=!0;mxGraph.prototype.extendParentsOnAdd=!0;mxGraph.prototype.collapseToPreferredSize=!0;mxGraph.prototype.zoomFactor=1.2;mxGraph.prototype.keepSelectionVisibleOnZoom=!1;mxGraph.prototype.centerZoom=!0;mxGraph.prototype.resetViewOnRootChange=!0;
mxGraph.prototype.resetEdgesOnResize=!1;mxGraph.prototype.resetEdgesOnMove=!1;mxGraph.prototype.resetEdgesOnConnect=!0;mxGraph.prototype.allowLoops=!1;mxGraph.prototype.defaultLoopStyle=mxEdgeStyle.Loop;mxGraph.prototype.multigraph=!0;mxGraph.prototype.connectableEdges=!1;mxGraph.prototype.allowDanglingEdges=!0;mxGraph.prototype.cloneInvalidEdges=!1;mxGraph.prototype.disconnectOnMove=!0;mxGraph.prototype.labelsVisible=!0;mxGraph.prototype.htmlLabels=!1;mxGraph.prototype.swimlaneSelectionEnabled=!0;
mxGraph.prototype.swimlaneNesting=!0;mxGraph.prototype.swimlaneIndicatorColorAttribute=mxConstants.STYLE_FILLCOLOR;mxGraph.prototype.imageBundles=null;mxGraph.prototype.minFitScale=0.1;mxGraph.prototype.maxFitScale=8;mxGraph.prototype.panDx=0;mxGraph.prototype.panDy=0;mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9);mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9);
mxGraph.prototype.warningImage=new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16);mxGraph.prototype.alreadyConnectedResource="none"!=mxClient.language?"alreadyConnected":"";mxGraph.prototype.containsValidationErrorsResource="none"!=mxClient.language?"containsValidationErrors":"";mxGraph.prototype.collapseExpandResource="none"!=mxClient.language?"collapse-expand":"";
mxGraph.prototype.init=function(a){this.container=a;this.cellEditor=this.createCellEditor();this.view.init();this.sizeDidChange();mxClient.IS_IE&&(mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})),mxEvent.addListener(a,"selectstart",mxUtils.bind(this,function(){return this.isEditing()})))};
mxGraph.prototype.createHandlers=function(){this.tooltipHandler=new mxTooltipHandler(this);this.tooltipHandler.setEnabled(!1);this.panningHandler=new mxPanningHandler(this);this.panningHandler.panningEnabled=!1;this.selectionCellsHandler=new mxSelectionCellsHandler(this);this.connectionHandler=new mxConnectionHandler(this);this.connectionHandler.setEnabled(!1);this.graphHandler=new mxGraphHandler(this)};mxGraph.prototype.createSelectionModel=function(){return new mxGraphSelectionModel(this)};
mxGraph.prototype.createStylesheet=function(){return new mxStylesheet};mxGraph.prototype.createGraphView=function(){return new mxGraphView(this)};mxGraph.prototype.createCellRenderer=function(){return new mxCellRenderer};mxGraph.prototype.createCellEditor=function(){return new mxCellEditor(this)};mxGraph.prototype.getModel=function(){return this.model};mxGraph.prototype.getView=function(){return this.view};mxGraph.prototype.getStylesheet=function(){return this.stylesheet};
mxGraph.prototype.setStylesheet=function(a){this.stylesheet=a};mxGraph.prototype.getSelectionModel=function(){return this.selectionModel};mxGraph.prototype.setSelectionModel=function(a){this.selectionModel=a};mxGraph.prototype.getSelectionCellsForChanges=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d.constructor!=mxRootChange){var e=null;d instanceof mxChildChange&&null==d.previous?e=d.child:null!=d.cell&&d.cell instanceof mxCell&&(e=d.cell);null!=e&&0>mxUtils.indexOf(b,e)&&b.push(e)}}return this.getModel().getTopmostCells(b)};
mxGraph.prototype.graphModelChanged=function(a){for(var b=0;b<a.length;b++)this.processChange(a[b]);this.removeSelectionCells(this.getRemovedCellsForChanges(a));this.view.validate();this.sizeDidChange()};mxGraph.prototype.getRemovedCellsForChanges=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d instanceof mxRootChange)break;else d instanceof mxChildChange?null!=d.previous&&null==d.parent&&(b=b.concat(this.model.getDescendants(d.child))):d instanceof mxVisibleChange&&(b=b.concat(this.model.getDescendants(d.cell)))}return b};
mxGraph.prototype.processChange=function(a){if(a instanceof mxRootChange)this.clearSelection(),this.removeStateForCell(a.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT));else if(a instanceof mxChildChange){var b=this.model.getParent(a.child);null!=b?this.view.invalidate(a.child,!0,!1,null!=a.previous):(this.removeStateForCell(a.child),this.view.currentRoot==a.child&&this.home());b!=a.previous&&
(null!=b&&this.view.invalidate(b,!1,!1),null!=a.previous&&this.view.invalidate(a.previous,!1,!1))}else a instanceof mxTerminalChange||a instanceof mxGeometryChange?this.view.invalidate(a.cell):a instanceof mxValueChange?this.view.invalidate(a.cell,!1,!1):a instanceof mxStyleChange?(this.view.invalidate(a.cell,!0,!0,!1),this.view.removeState(a.cell)):null!=a.cell&&a.cell instanceof mxCell&&this.removeStateForCell(a.cell)};
mxGraph.prototype.removeStateForCell=function(a){for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.removeStateForCell(this.model.getChildAt(a,c));this.view.removeState(a)};mxGraph.prototype.addCellOverlay=function(a,b){null==a.overlays&&(a.overlays=[]);a.overlays.push(b);var c=this.view.getState(a);null!=c&&this.cellRenderer.redraw(c);this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",a,"overlay",b));return b};mxGraph.prototype.getCellOverlays=function(a){return a.overlays};
mxGraph.prototype.removeCellOverlay=function(a,b){if(null==b)this.removeCellOverlays(a);else{var c=mxUtils.indexOf(a.overlays,b);0<=c?(a.overlays.splice(c,1),0==a.overlays.length&&(a.overlays=null),c=this.view.getState(a),null!=c&&this.cellRenderer.redraw(c),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",a,"overlay",b))):b=null}return b};
mxGraph.prototype.removeCellOverlays=function(a){var b=a.overlays;if(null!=b){a.overlays=null;var c=this.view.getState(a);null!=c&&this.cellRenderer.redraw(c);for(c=0;c<b.length;c++)this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",a,"overlay",b[c]))}return b};mxGraph.prototype.clearCellOverlays=function(a){a=null!=a?a:this.model.getRoot();this.removeCellOverlays(a);for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.clearCellOverlays(this.model.getChildAt(a,c))};
mxGraph.prototype.setCellWarning=function(a,b,c,d){if(null!=b&&0<b.length)return c=null!=c?c:this.warningImage,b=new mxCellOverlay(c,"<font color=red>"+b+"</font>"),d&&b.addListener(mxEvent.CLICK,mxUtils.bind(this,function(){this.isEnabled()&&this.setSelectionCell(a)})),this.addCellOverlay(a,b);this.removeCellOverlays(a);return null};mxGraph.prototype.startEditing=function(a){this.startEditingAtCell(null,a)};
mxGraph.prototype.startEditingAtCell=function(a,b){null==a&&(a=this.getSelectionCell(),null!=a&&!this.isCellEditable(a)&&(a=null));null!=a&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",a,"event",b)),this.cellEditor.startEditing(a,b))};mxGraph.prototype.getEditingValue=function(a){return this.convertValueToString(a)};mxGraph.prototype.stopEditing=function(a){this.cellEditor.stopEditing(a)};
mxGraph.prototype.labelChanged=function(a,b,c){this.model.beginUpdate();try{this.cellLabelChanged(a,b,this.isAutoSizeCell(a)),this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",a,"value",b,"event",c))}finally{this.model.endUpdate()}return a};mxGraph.prototype.cellLabelChanged=function(a,b,c){this.model.beginUpdate();try{this.model.setValue(a,b),c&&this.cellSizeUpdated(a,!1)}finally{this.model.endUpdate()}};
mxGraph.prototype.escape=function(){this.stopEditing(!0);this.connectionHandler.reset();this.graphHandler.reset();for(var a=this.getSelectionCells(),b=0;b<a.length;b++){var c=this.view.getState(a[b]);null!=c&&null!=c.handler&&c.handler.reset()}};
mxGraph.prototype.click=function(a){var b=a.getEvent(),c=a.getCell(),d=new mxEventObject(mxEvent.CLICK,"event",b,"cell",c);a.isConsumed()&&d.consume();this.fireEvent(d);this.isEnabled()&&!mxEvent.isConsumed(b)&&!d.isConsumed()&&(null!=c?this.selectCellForEvent(c,b):(c=null,this.isSwimlaneSelectionEnabled()&&(c=this.getSwimlaneAt(a.getGraphX(),a.getGraphY())),null!=c?this.selectCellForEvent(c,b):this.isToggleEvent(b)||this.clearSelection()))};
mxGraph.prototype.dblClick=function(a,b){var c=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",a,"cell",b);this.fireEvent(c);this.isEnabled()&&!mxEvent.isConsumed(a)&&!c.isConsumed()&&null!=b&&this.isCellEditable(b)&&this.startEditingAtCell(b,a)};
mxGraph.prototype.scrollPointToVisible=function(a,b,c,d){if(!this.timerAutoScroll&&(this.ignoreScrollbars||mxUtils.hasScrollbars(this.container))){var e=this.container,d=null!=d?d:20;if(a>=e.scrollLeft&&b>=e.scrollTop&&a<=e.scrollLeft+e.clientWidth&&b<=e.scrollTop+e.clientHeight){var f=e.scrollLeft+e.clientWidth-a;if(f<d){if(a=e.scrollLeft,e.scrollLeft+=d-f,c&&a==e.scrollLeft){if(this.dialect==mxConstants.DIALECT_SVG)var a=this.view.getDrawPane().ownerSVGElement,g=this.container.scrollWidth+d-f;else g=
Math.max(e.clientWidth,e.scrollWidth)+d-f,a=this.view.getCanvas();a.style.width=g+"px";e.scrollLeft+=d-f}}else f=a-e.scrollLeft,f<d&&(e.scrollLeft-=d-f);f=e.scrollTop+e.clientHeight-b;f<d?(a=e.scrollTop,e.scrollTop+=d-f,a==e.scrollTop&&c&&(this.dialect==mxConstants.DIALECT_SVG?(a=this.view.getDrawPane().ownerSVGElement,b=this.container.scrollHeight+d-f):(b=Math.max(e.clientHeight,e.scrollHeight)+d-f,a=this.view.getCanvas()),a.style.height=b+"px",e.scrollTop+=d-f)):(f=b-e.scrollTop,f<d&&(e.scrollTop-=
d-f))}}else this.allowAutoPanning&&!this.panningHandler.active&&(null==this.panningManager&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(a+this.panDx,b+this.panDy))};mxGraph.prototype.createPanningManager=function(){return new mxPanningManager(this)};
mxGraph.prototype.getBorderSizes=function(){function a(a){var b=0,b="thin"==a?2:"medium"==a?4:"thick"==a?6:parseInt(a);isNaN(b)&&(b=0);return b}var b=mxUtils.getCurrentStyle(this.container),c=new mxRectangle;c.x=a(b.borderLeftWidth)+parseInt(b.paddingLeft||0);c.y=a(b.borderTopWidth)+parseInt(b.paddingTop||0);c.width=a(b.borderRightWidth)+parseInt(b.paddingRight||0);c.height=a(b.borderBottomWidth)+parseInt(b.paddingBottom||0);return c};
mxGraph.prototype.getPreferredPageSize=function(a,b,c){var a=this.view.scale,d=this.view.translate,e=this.pageFormat,f=a*this.pageScale,e=new mxRectangle(0,0,e.width*f,e.height*f),b=this.pageBreaksVisible?Math.ceil(b/e.width):1,c=this.pageBreaksVisible?Math.ceil(c/e.height):1;return new mxRectangle(0,0,b*e.width+2+d.x/a,c*e.height+2+d.y/a)};
mxGraph.prototype.sizeDidChange=function(){var a=this.getGraphBounds();if(null!=this.container){var b=this.getBorder(),c=Math.max(0,a.x+a.width+1+b),b=Math.max(0,a.y+a.height+1+b);null!=this.minimumContainerSize&&(c=Math.max(c,this.minimumContainerSize.width),b=Math.max(b,this.minimumContainerSize.height));this.resizeContainer&&this.doResizeContainer(c,b);if(this.preferPageSize||!mxClient.IS_IE&&this.pageVisible){var d=this.getPreferredPageSize(a,c,b);null!=d&&(c=d.width,b=d.height)}null!=this.minimumGraphSize&&
(c=Math.max(c,this.minimumGraphSize.width*this.view.scale),b=Math.max(b,this.minimumGraphSize.height*this.view.scale));c=Math.ceil(c-1);b=Math.ceil(b-1);this.dialect==mxConstants.DIALECT_SVG?(d=this.view.getDrawPane().ownerSVGElement,d.style.minWidth=Math.max(1,c)+"px",d.style.minHeight=Math.max(1,b)+"px",d.style.width="100%",d.style.height="100%"):mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,c),Math.max(1,b)):(this.view.canvas.style.minWidth=Math.max(1,c)+"px",this.view.canvas.style.minHeight=
Math.max(1,b)+"px");this.updatePageBreaks(this.pageBreaksVisible,c-1,b-1)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",a))};
mxGraph.prototype.doResizeContainer=function(a,b){if(mxClient.IS_IE)if(mxClient.IS_QUIRKS)var c=this.getBorderSizes(),a=a+Math.max(2,c.x+c.width+1),b=b+Math.max(2,c.y+c.height+1);else 9<=document.documentMode?(a+=3,b+=5):(a+=1,b+=1);else b+=1;null!=this.maximumContainerSize&&(a=Math.min(this.maximumContainerSize.width,a),b=Math.min(this.maximumContainerSize.height,b));this.container.style.width=Math.ceil(a)+"px";this.container.style.height=Math.ceil(b)+"px"};
mxGraph.prototype.updatePageBreaks=function(a,b,c){var d=this.view.scale,e=this.view.translate,f=this.pageFormat,g=d*this.pageScale,e=new mxRectangle(d*e.x,d*e.y,f.width*g,f.height*g),a=a&&Math.min(e.width,e.height)>this.minPageBreakDist;e.x=mxUtils.mod(e.x,e.width);e.y=mxUtils.mod(e.y,e.height);f=a?Math.ceil((b-e.x)/e.width):0;a=a?Math.ceil((c-e.y)/e.height):0;null==this.horizontalPageBreaks&&0<f&&(this.horizontalPageBreaks=[]);if(null!=this.horizontalPageBreaks){for(g=0;g<=f;g++){var h=[new mxPoint(e.x+
g*e.width,1),new mxPoint(e.x+g*e.width,c)];null!=this.horizontalPageBreaks[g]?(this.horizontalPageBreaks[g].scale=1,this.horizontalPageBreaks[g].points=h,this.horizontalPageBreaks[g].redraw()):(h=new mxPolyline(h,this.pageBreakColor,this.scale),h.dialect=this.dialect,h.isDashed=this.pageBreakDashed,h.scale=d,h.crisp=!0,h.init(this.view.backgroundPane),h.redraw(),this.horizontalPageBreaks[g]=h)}for(g=f;g<this.horizontalPageBreaks.length;g++)this.horizontalPageBreaks[g].destroy();this.horizontalPageBreaks.splice(f,
this.horizontalPageBreaks.length-f)}null==this.verticalPageBreaks&&0<a&&(this.verticalPageBreaks=[]);if(null!=this.verticalPageBreaks){for(g=0;g<=a;g++)h=[new mxPoint(1,e.y+g*e.height),new mxPoint(b,e.y+g*e.height)],null!=this.verticalPageBreaks[g]?(this.verticalPageBreaks[g].scale=1,this.verticalPageBreaks[g].points=h,this.verticalPageBreaks[g].redraw()):(h=new mxPolyline(h,this.pageBreakColor,d),h.dialect=this.dialect,h.isDashed=this.pageBreakDashed,h.scale=d,h.crisp=!0,h.init(this.view.backgroundPane),
h.redraw(),this.verticalPageBreaks[g]=h);for(g=a;g<this.verticalPageBreaks.length;g++)this.verticalPageBreaks[g].destroy();this.verticalPageBreaks.splice(a,this.verticalPageBreaks.length-a)}};mxGraph.prototype.getCellStyle=function(a){var b=this.model.getStyle(a),c=null,c=this.model.isEdge(a)?this.stylesheet.getDefaultEdgeStyle():this.stylesheet.getDefaultVertexStyle();null!=b&&(c=this.postProcessCellStyle(this.stylesheet.getCellStyle(b,c)));null==c&&(c=mxGraph.prototype.EMPTY_ARRAY);return c};
mxGraph.prototype.postProcessCellStyle=function(a){if(null!=a){var b=a[mxConstants.STYLE_IMAGE],c=this.getImageFromBundles(b);null!=c?a[mxConstants.STYLE_IMAGE]=c:c=b;null!=c&&"data:image/"==c.substring(0,11)&&(b=c.indexOf(","),0<b&&(c=c.substring(0,b)+";base64,"+c.substring(b+1)),a[mxConstants.STYLE_IMAGE]=c)}return a};mxGraph.prototype.setCellStyle=function(a,b){b=b||this.getSelectionCells();if(null!=b){this.model.beginUpdate();try{for(var c=0;c<b.length;c++)this.model.setStyle(b[c],a)}finally{this.model.endUpdate()}}};
mxGraph.prototype.toggleCellStyle=function(a,b,c){c=c||this.getSelectionCell();this.toggleCellStyles(a,b,[c])};mxGraph.prototype.toggleCellStyles=function(a,b,c){b=null!=b?b:!1;c=c||this.getSelectionCells();if(null!=c&&0<c.length){var d=this.view.getState(c[0]),d=null!=d?d.style:this.getCellStyle(c[0]);null!=d&&(b=mxUtils.getValue(d,a,b)?0:1,this.setCellStyles(a,b,c))}};mxGraph.prototype.setCellStyles=function(a,b,c){c=c||this.getSelectionCells();mxUtils.setCellStyles(this.model,c,a,b)};
mxGraph.prototype.toggleCellStyleFlags=function(a,b,c){this.setCellStyleFlags(a,b,null,c)};mxGraph.prototype.setCellStyleFlags=function(a,b,c,d){d=d||this.getSelectionCells();if(null!=d&&0<d.length){if(null==c){var e=this.view.getState(d[0]),e=null!=e?e.style:this.getCellStyle(d[0]);null!=e&&(c=(parseInt(e[a]||0)&b)!=b)}mxUtils.setCellStyleFlags(this.model,d,a,b,c)}};
mxGraph.prototype.alignCells=function(a,b,c){null==b&&(b=this.getSelectionCells());if(null!=b&&1<b.length){if(null==c)for(var d=0;d<b.length;d++){var e=this.getCellGeometry(b[d]);if(null!=e&&!this.model.isEdge(b[d]))if(null==c)if(a==mxConstants.ALIGN_CENTER){c=e.x+e.width/2;break}else if(a==mxConstants.ALIGN_RIGHT)c=e.x+e.width;else if(a==mxConstants.ALIGN_TOP)c=e.y;else if(a==mxConstants.ALIGN_MIDDLE){c=e.y+e.height/2;break}else c=a==mxConstants.ALIGN_BOTTOM?e.y+e.height:e.x;else c=a==mxConstants.ALIGN_RIGHT?
Math.max(c,e.x+e.width):a==mxConstants.ALIGN_TOP?Math.min(c,e.y):a==mxConstants.ALIGN_BOTTOM?Math.max(c,e.y+e.height):Math.min(c,e.x)}if(null!=c){this.model.beginUpdate();try{for(d=0;d<b.length;d++)e=this.getCellGeometry(b[d]),null!=e&&!this.model.isEdge(b[d])&&(e=e.clone(),a==mxConstants.ALIGN_CENTER?e.x=c-e.width/2:a==mxConstants.ALIGN_RIGHT?e.x=c-e.width:a==mxConstants.ALIGN_TOP?e.y=c:a==mxConstants.ALIGN_MIDDLE?e.y=c-e.height/2:a==mxConstants.ALIGN_BOTTOM?e.y=c-e.height:e.x=c,this.model.setGeometry(b[d],
e));this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",a,"cells",b))}finally{this.model.endUpdate()}}}return b};mxGraph.prototype.flipEdge=function(a){if(null!=a&&null!=this.alternateEdgeStyle){this.model.beginUpdate();try{var b=this.model.getStyle(a);null==b||0==b.length?this.model.setStyle(a,this.alternateEdgeStyle):this.model.setStyle(a,null);this.resetEdge(a);this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",a))}finally{this.model.endUpdate()}}return a};
mxGraph.prototype.addImageBundle=function(a){this.imageBundles.push(a)};mxGraph.prototype.removeImageBundle=function(a){for(var b=[],c=0;c<this.imageBundles.length;c++)this.imageBundles[c]!=a&&b.push(this.imageBundles[c]);this.imageBundles=b};mxGraph.prototype.getImageFromBundles=function(a){if(null!=a)for(var b=0;b<this.imageBundles.length;b++){var c=this.imageBundles[b].getImage(a);if(null!=c)return c}return null};
mxGraph.prototype.orderCells=function(a,b){null==b&&(b=mxUtils.sortCells(this.getSelectionCells(),!0));this.model.beginUpdate();try{this.cellsOrdered(b,a),this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",a,"cells",b))}finally{this.model.endUpdate()}return b};
mxGraph.prototype.cellsOrdered=function(a,b){if(null!=a){this.model.beginUpdate();try{for(var c=0;c<a.length;c++){var d=this.model.getParent(a[c]);b?this.model.add(d,a[c],c):this.model.add(d,a[c],this.model.getChildCount(d)-1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",b,"cells",a))}finally{this.model.endUpdate()}}};
mxGraph.prototype.groupCells=function(a,b,c){null==c&&(c=mxUtils.sortCells(this.getSelectionCells(),!0));c=this.getCellsForGroup(c);null==a&&(a=this.createGroupCell(c));var d=this.getBoundsForGroup(a,c,b);if(0<c.length&&null!=d){var e=this.model.getParent(a);null==e&&(e=this.model.getParent(c[0]));this.model.beginUpdate();try{null==this.getCellGeometry(a)&&this.model.setGeometry(a,new mxGeometry);var f=this.model.getChildCount(a);this.cellsAdded(c,a,f,null,null,!1,!1);this.cellsMoved(c,-d.x,-d.y,
!1,!0);f=this.model.getChildCount(e);this.cellsAdded([a],e,f,null,null,!1);this.cellsResized([a],[d]);this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",a,"border",b,"cells",c))}finally{this.model.endUpdate()}}return a};mxGraph.prototype.getCellsForGroup=function(a){var b=[];if(null!=a&&0<a.length){var c=this.model.getParent(a[0]);b.push(a[0]);for(var d=1;d<a.length;d++)this.model.getParent(a[d])==c&&b.push(a[d])}return b};
mxGraph.prototype.getBoundsForGroup=function(a,b,c){b=this.getBoundingBoxFromGeometry(b);null!=b&&(this.isSwimlane(a)&&(a=this.getStartSize(a),b.x-=a.width,b.y-=a.height,b.width+=a.width,b.height+=a.height),b.x-=c,b.y-=c,b.width+=2*c,b.height+=2*c);return b};mxGraph.prototype.createGroupCell=function(){var a=new mxCell("");a.setVertex(!0);a.setConnectable(!1);return a};
mxGraph.prototype.ungroupCells=function(a){var b=[];if(null==a){for(var a=this.getSelectionCells(),c=[],d=0;d<a.length;d++)0<this.model.getChildCount(a[d])&&c.push(a[d]);a=c}if(null!=a&&0<a.length){this.model.beginUpdate();try{for(d=0;d<a.length;d++){var e=this.model.getChildren(a[d]);if(null!=e&&0<e.length){var e=e.slice(),f=this.model.getParent(a[d]),g=this.model.getChildCount(f);this.cellsAdded(e,f,g,null,null,!0);b=b.concat(e)}}this.cellsRemoved(this.addAllEdges(a));this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,
"cells",a))}finally{this.model.endUpdate()}}return b};mxGraph.prototype.removeCellsFromParent=function(a){null==a&&(a=this.getSelectionCells());this.model.beginUpdate();try{var b=this.getDefaultParent(),c=this.model.getChildCount(b);this.cellsAdded(a,b,c,null,null,!0);this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",a))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.updateGroupBounds=function(a,b,c){null==a&&(a=this.getSelectionCells());b=null!=b?b:0;c=null!=c?c:!1;this.model.beginUpdate();try{for(var d=0;d<a.length;d++){var e=this.getCellGeometry(a[d]);if(null!=e){var f=this.getChildCells(a[d]);if(null!=f&&0<f.length){var g=this.getBoundingBoxFromGeometry(f);if(0<g.width&&0<g.height){var h=this.isSwimlane(a[d])?this.getStartSize(a[d]):new mxRectangle,e=e.clone();c&&(e.x+=g.x-h.width-b,e.y+=g.y-h.height-b);e.width=g.width+h.width+2*b;e.height=
g.height+h.height+2*b;this.model.setGeometry(a[d],e);this.moveCells(f,-g.x+h.width+b,-g.y+h.height+b)}}}}}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cloneCells=function(a,b){var b=null!=b?b:!0,c=null;if(null!=a){for(var d={},c=[],e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e];c.push(a[e])}if(0<c.length)for(var f=this.view.scale,g=this.view.translate,c=this.model.cloneCells(a,!0),e=0;e<a.length;e++)if(!b&&this.model.isEdge(c[e])&&null!=this.getEdgeValidationError(c[e],this.model.getTerminal(c[e],!0),this.model.getTerminal(c[e],!1)))c[e]=null;else{var h=this.model.getGeometry(c[e]);if(null!=h){var k=this.view.getState(a[e]),
l=this.view.getState(this.model.getParent(a[e]));if(null!=k&&null!=l){var n=l.origin.x,l=l.origin.y;if(this.model.isEdge(c[e])){for(var k=k.absolutePoints,o=this.model.getTerminal(a[e],!0),p=mxCellPath.create(o);null!=o&&null==d[p];)o=this.model.getParent(o),p=mxCellPath.create(o);null==o&&h.setTerminalPoint(new mxPoint(k[0].x/f-g.x,k[0].y/f-g.y),!0);o=this.model.getTerminal(a[e],!1);for(p=mxCellPath.create(o);null!=o&&null==d[p];)o=this.model.getParent(o),p=mxCellPath.create(o);null==o&&(o=k.length-
1,h.setTerminalPoint(new mxPoint(k[o].x/f-g.x,k[o].y/f-g.y),!1));h=h.points;if(null!=h)for(k=0;k<h.length;k++)h[k].x+=n,h[k].y+=l}else h.x+=n,h.y+=l}}}else c=[]}return c};mxGraph.prototype.insertVertex=function(a,b,c,d,e,f,g,h,k){return this.addCell(this.createVertex(a,b,c,d,e,f,g,h,k),a)};mxGraph.prototype.createVertex=function(a,b,c,d,e,f,g,h,k){a=new mxGeometry(d,e,f,g);a.relative=null!=k?k:!1;c=new mxCell(c,a,h);c.setId(b);c.setVertex(!0);c.setConnectable(!0);return c};
mxGraph.prototype.insertEdge=function(a,b,c,d,e,f){return this.addEdge(this.createEdge(a,b,c,d,e,f),a,d,e)};mxGraph.prototype.createEdge=function(a,b,c,d,e,f){a=new mxCell(c,new mxGeometry,f);a.setId(b);a.setEdge(!0);a.geometry.relative=!0;return a};mxGraph.prototype.addEdge=function(a,b,c,d,e){return this.addCell(a,b,e,c,d)};mxGraph.prototype.addCell=function(a,b,c,d,e){return this.addCells([a],b,c,d,e)[0]};
mxGraph.prototype.addCells=function(a,b,c,d,e){null==b&&(b=this.getDefaultParent());null==c&&(c=this.model.getChildCount(b));this.model.beginUpdate();try{this.cellsAdded(a,b,c,d,e,!1,!0),this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",a,"parent",b,"index",c,"source",d,"target",e))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsAdded=function(a,b,c,d,e,f,g){if(null!=a&&null!=b&&null!=c){this.model.beginUpdate();try{for(var h=f?this.view.getState(b):null,k=null!=h?h.origin:null,l=new mxPoint(0,0),h=0;h<a.length;h++)if(null==a[h])c--;else{var n=this.model.getParent(a[h]);if(null!=k&&a[h]!=b&&b!=n){var o=this.view.getState(n),p=null!=o?o.origin:l,r=this.model.getGeometry(a[h]);if(null!=r){var s=p.x-k.x,u=p.y-k.y,r=r.clone();r.translate(s,u);!r.relative&&this.model.isVertex(a[h])&&!this.isAllowNegativeCoordinates()&&
(r.x=Math.max(0,r.x),r.y=Math.max(0,r.y));this.model.setGeometry(a[h],r)}}b==n&&c--;this.model.add(b,a[h],c+h);this.isExtendParentsOnAdd()&&this.isExtendParent(a[h])&&this.extendParent(a[h]);(null==g||g)&&this.constrainChild(a[h]);null!=d&&this.cellConnected(a[h],d,!0);null!=e&&this.cellConnected(a[h],e,!1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",a,"parent",b,"index",c,"source",d,"target",e,"absolute",f))}finally{this.model.endUpdate()}}};
mxGraph.prototype.removeCells=function(a,b){b=null!=b?b:!0;null==a&&(a=this.getDeletableCells(this.getSelectionCells()));b&&(a=this.getDeletableCells(this.addAllEdges(a)));this.model.beginUpdate();try{this.cellsRemoved(a),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",a,"includeEdges",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsRemoved=function(a){if(null!=a&&0<a.length){var b=this.view.scale,c=this.view.translate;this.model.beginUpdate();try{for(var d={},e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e]}for(e=0;e<a.length;e++){for(var g=this.getConnections(a[e]),h=0;h<g.length;h++)if(f=mxCellPath.create(g[h]),null==d[f]){var k=this.model.getGeometry(g[h]);if(null!=k){var l=this.view.getState(g[h]);if(null!=l){var k=k.clone(),n=l.getVisibleTerminal(!0)==a[e],o=l.absolutePoints,p=n?0:o.length-
1;k.setTerminalPoint(new mxPoint(o[p].x/b-c.x,o[p].y/b-c.y),n);this.model.setTerminal(g[h],null,n);this.model.setGeometry(g[h],k)}}}this.model.remove(a[e])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",a))}finally{this.model.endUpdate()}}};
mxGraph.prototype.splitEdge=function(a,b,c,d,e){d=d||0;e=e||0;null==c&&(c=this.cloneCells([a])[0]);var f=this.model.getParent(a),g=this.model.getTerminal(a,!0);this.model.beginUpdate();try{this.cellsMoved(b,d,e,!1,!1),this.cellsAdded(b,f,this.model.getChildCount(f),null,null,!0),this.cellsAdded([c],f,this.model.getChildCount(f),g,b[0],!1),this.cellConnected(a,b[0],!0),this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",a,"cells",b,"newEdge",c,"dx",d,"dy",e))}finally{this.model.endUpdate()}return c};
mxGraph.prototype.toggleCells=function(a,b,c){null==b&&(b=this.getSelectionCells());c&&(b=this.addAllEdges(b));this.model.beginUpdate();try{this.cellsToggled(b,a),this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",a,"cells",b,"includeEdges",c))}finally{this.model.endUpdate()}return b};mxGraph.prototype.cellsToggled=function(a,b){if(null!=a&&0<a.length){this.model.beginUpdate();try{for(var c=0;c<a.length;c++)this.model.setVisible(a[c],b)}finally{this.model.endUpdate()}}};
mxGraph.prototype.foldCells=function(a,b,c,d){b=null!=b?b:!1;null==c&&(c=this.getFoldableCells(this.getSelectionCells(),a));this.stopEditing(!1);this.model.beginUpdate();try{this.cellsFolded(c,a,b,d),this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",a,"recurse",b,"cells",c))}finally{this.model.endUpdate()}return c};
mxGraph.prototype.cellsFolded=function(a,b,c,d){if(null!=a&&0<a.length){this.model.beginUpdate();try{for(var e=0;e<a.length;e++)if((!d||this.isCellFoldable(a[e],b))&&b!=this.isCellCollapsed(a[e]))this.model.setCollapsed(a[e],b),this.swapBounds(a[e],b),this.isExtendParent(a[e])&&this.extendParent(a[e]),c&&this.foldCells(this.model.getChildren(a[e]),b,c);this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",a,"collapse",b,"recurse",c))}finally{this.model.endUpdate()}}};
mxGraph.prototype.swapBounds=function(a,b){if(null!=a){var c=this.model.getGeometry(a);null!=c&&(c=c.clone(),this.updateAlternateBounds(a,c,b),c.swap(),this.model.setGeometry(a,c))}};
mxGraph.prototype.updateAlternateBounds=function(a,b){if(null!=a&&null!=b)if(null==b.alternateBounds){var c=b;if(this.collapseToPreferredSize){var d=this.getPreferredSizeForCell(a);null!=d&&(c=d,d=this.view.getState(a),d=null!=d?d.style:this.getCellStyle(a),d=mxUtils.getValue(d,mxConstants.STYLE_STARTSIZE),0<d&&(c.height=Math.max(c.height,d)))}b.alternateBounds=new mxRectangle(b.x,b.y,c.width,c.height)}else b.alternateBounds.x=b.x,b.alternateBounds.y=b.y};
mxGraph.prototype.addAllEdges=function(a){var b=a.slice();return b=b.concat(this.getAllEdges(a))};mxGraph.prototype.getAllEdges=function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++){for(var d=this.model.getEdgeCount(a[c]),e=0;e<d;e++)b.push(this.model.getEdgeAt(a[c],e));d=this.model.getChildren(a[c]);b=b.concat(this.getAllEdges(d))}return b};
mxGraph.prototype.updateCellSize=function(a,b){b=null!=b?b:!1;this.model.beginUpdate();try{this.cellSizeUpdated(a,b),this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",a,"ignoreChildren",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellSizeUpdated=function(a,b){if(null!=a){this.model.beginUpdate();try{var c=this.getPreferredSizeForCell(a),d=this.model.getGeometry(a);if(null!=c&&null!=d){var e=this.isCellCollapsed(a),d=d.clone();if(this.isSwimlane(a)){var f=this.view.getState(a),g=null!=f?f.style:this.getCellStyle(a),h=this.model.getStyle(a);null==h&&(h="");mxUtils.getValue(g,mxConstants.STYLE_HORIZONTAL,!0)?(h=mxUtils.setStyle(h,mxConstants.STYLE_STARTSIZE,c.height+8),e&&(d.height=c.height+8),d.width=c.width):
(h=mxUtils.setStyle(h,mxConstants.STYLE_STARTSIZE,c.width+8),e&&(d.width=c.width+8),d.height=c.height);this.model.setStyle(a,h)}else d.width=c.width,d.height=c.height;if(!b&&!e){var k=this.view.getBounds(this.model.getChildren(a));if(null!=k){var l=this.view.translate,n=this.view.scale,o=(k.y+k.height)/n-d.y-l.y;d.width=Math.max(d.width,(k.x+k.width)/n-d.x-l.x);d.height=Math.max(d.height,o)}}this.cellsResized([a],[d])}}finally{this.model.endUpdate()}}};
mxGraph.prototype.getPreferredSizeForCell=function(a){var b=null;if(null!=a){var c=this.view.getState(a),d=null!=c?c.style:this.getCellStyle(a);if(null!=d&&!this.model.isEdge(a)){var e=d[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,f=0,b=0;if((null!=this.getImage(c)||null!=d[mxConstants.STYLE_IMAGE])&&d[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_LABEL)d[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(f+=parseFloat(d[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),
d[mxConstants.STYLE_ALIGN]!=mxConstants.ALIGN_CENTER&&(b+=parseFloat(d[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize);f+=2*(d[mxConstants.STYLE_SPACING]||0);f+=d[mxConstants.STYLE_SPACING_LEFT]||0;f+=d[mxConstants.STYLE_SPACING_RIGHT]||0;b+=2*(d[mxConstants.STYLE_SPACING]||0);b+=d[mxConstants.STYLE_SPACING_TOP]||0;b+=d[mxConstants.STYLE_SPACING_BOTTOM]||0;c=this.getFoldingImage(c);null!=c&&(f+=c.width+8);c=this.getLabel(a);null!=c&&0<c.length?(this.isHtmlLabel(a)||(c=c.replace(/\n/g,
"<br>")),e=mxUtils.getSizeForString(c,e,d[mxConstants.STYLE_FONTFAMILY]),a=e.width+f,b=e.height+b,mxUtils.getValue(d,mxConstants.STYLE_HORIZONTAL,!0)||(d=b,b=a,a=d),this.gridEnabled&&(a=this.snap(a+this.gridSize/2),b=this.snap(b+this.gridSize/2)),b=new mxRectangle(0,0,a,b)):(d=4*this.gridSize,b=new mxRectangle(0,0,d,d))}}return b};
mxGraph.prototype.handleGesture=function(a,b){if(0.2<Math.abs(1-b.scale)){var c=this.view.scale,d=this.view.translate,e=a.width*b.scale,f=a.height*b.scale,g=a.y-(f-a.height)/2,c=new mxRectangle(this.snap((a.x-(e-a.width)/2)/c)-d.x,this.snap(g/c)-d.y,this.snap(e/c),this.snap(f/c));this.resizeCell(a.cell,c)}};mxGraph.prototype.resizeCell=function(a,b){return this.resizeCells([a],[b])[0]};
mxGraph.prototype.resizeCells=function(a,b){this.model.beginUpdate();try{this.cellsResized(a,b),this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",a,"bounds",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsResized=function(a,b){if(null!=a&&null!=b&&a.length==b.length){this.model.beginUpdate();try{for(var c=0;c<a.length;c++){var d=b[c],e=this.model.getGeometry(a[c]);if(null!=e&&(e.x!=d.x||e.y!=d.y||e.width!=d.width||e.height!=d.height)){e=e.clone();if(e.relative){var f=e.offset;null!=f&&(f.x+=d.x-e.x,f.y+=d.y-e.y)}else e.x=d.x,e.y=d.y;e.width=d.width;e.height=d.height;!e.relative&&this.model.isVertex(a[c])&&!this.isAllowNegativeCoordinates()&&(e.x=Math.max(0,e.x),e.y=Math.max(0,
e.y));this.model.setGeometry(a[c],e);this.isExtendParent(a[c])&&this.extendParent(a[c])}}this.resetEdgesOnResize&&this.resetEdges(a);this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",a,"bounds",b))}finally{this.model.endUpdate()}}};
mxGraph.prototype.extendParent=function(a){if(null!=a){var b=this.model.getParent(a),c=this.model.getGeometry(b);if(null!=b&&null!=c&&!this.isCellCollapsed(b)&&(a=this.model.getGeometry(a),null!=a&&(c.width<a.x+a.width||c.height<a.y+a.height)))c=c.clone(),c.width=Math.max(c.width,a.x+a.width),c.height=Math.max(c.height,a.y+a.height),this.cellsResized([b],[c])}};mxGraph.prototype.importCells=function(a,b,c,d,e){return this.moveCells(a,b,c,!0,d,e)};
mxGraph.prototype.moveCells=function(a,b,c,d,e,f){b=null!=b?b:0;c=null!=c?c:0;d=null!=d?d:!1;if(null!=a&&(0!=b||0!=c||d||null!=e)){this.model.beginUpdate();try{d&&(a=this.cloneCells(a,this.isCloneInvalidEdges()),null==e&&(e=this.getDefaultParent()));var g=this.isAllowNegativeCoordinates();null!=e&&this.setAllowNegativeCoordinates(!0);this.cellsMoved(a,b,c,!d&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),null==e);this.setAllowNegativeCoordinates(g);if(null!=e){var h=this.model.getChildCount(e);
this.cellsAdded(a,e,h,null,null,!0)}this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",a,"dx",b,"dy",c,"clone",d,"target",e,"event",f))}finally{this.model.endUpdate()}}return a};
mxGraph.prototype.cellsMoved=function(a,b,c,d,e){if(null!=a&&(0!=b||0!=c)){this.model.beginUpdate();try{d&&this.disconnectGraph(a);for(var f=0;f<a.length;f++)this.translateCell(a[f],b,c),e&&this.constrainChild(a[f]);this.resetEdgesOnMove&&this.resetEdges(a);this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",a,"dx",c,"dy",c,"disconnect",d))}finally{this.model.endUpdate()}}};
mxGraph.prototype.translateCell=function(a,b,c){var d=this.model.getGeometry(a);null!=d&&(d=d.clone(),d.translate(b,c),!d.relative&&this.model.isVertex(a)&&!this.isAllowNegativeCoordinates()&&(d.x=Math.max(0,d.x),d.y=Math.max(0,d.y)),d.relative&&!this.model.isEdge(a)&&(null==d.offset?d.offset=new mxPoint(b,c):(d.offset.x+=b,d.offset.y+=c)),this.model.setGeometry(a,d))};
mxGraph.prototype.getCellContainmentArea=function(a){if(null!=a&&!this.model.isEdge(a)){var b=this.model.getParent(a);if(b==this.getDefaultParent()||b==this.getCurrentRoot())return this.getMaximumGraphBounds();if(null!=b&&b!=this.getDefaultParent()){var c=this.model.getGeometry(b);if(null!=c){var d=a=0,e=c.width,c=c.height;this.isSwimlane(b)&&(b=this.getStartSize(b),a=b.width,e-=b.width,d=b.height,c-=b.height);return new mxRectangle(a,d,e,c)}}}return null};
mxGraph.prototype.getMaximumGraphBounds=function(){return this.maximumGraphBounds};
mxGraph.prototype.constrainChild=function(a){if(null!=a){var b=this.model.getGeometry(a),c=this.isConstrainChild(a)?this.getCellContainmentArea(a):this.getMaximumGraphBounds();if(null!=b&&null!=c&&!b.relative&&(b.x<c.x||b.y<c.y||c.width<b.x+b.width||c.height<b.y+b.height))a=this.getOverlap(a),0<c.width&&(b.x=Math.min(b.x,c.x+c.width-(1-a)*b.width)),0<c.height&&(b.y=Math.min(b.y,c.y+c.height-(1-a)*b.height)),b.x=Math.max(b.x,c.x-b.width*a),b.y=Math.max(b.y,c.y-b.height*a)}};
mxGraph.prototype.resetEdges=function(a){if(null!=a){for(var b={},c=0;c<a.length;c++){var d=mxCellPath.create(a[c]);b[d]=a[c]}this.model.beginUpdate();try{for(c=0;c<a.length;c++){var e=this.model.getEdges(a[c]);if(null!=e)for(d=0;d<e.length;d++){var f=this.view.getState(e[d]),g=null!=f?f.getVisibleTerminal(!0):this.view.getVisibleTerminal(e[d],!0),h=null!=f?f.getVisibleTerminal(!1):this.view.getVisibleTerminal(e[d],!1),k=mxCellPath.create(g),l=mxCellPath.create(h);(null==b[k]||null==b[l])&&this.resetEdge(e[d])}this.resetEdges(this.model.getChildren(a[c]))}}finally{this.model.endUpdate()}}};
mxGraph.prototype.resetEdge=function(a){var b=this.model.getGeometry(a);null!=b&&null!=b.points&&0<b.points.length&&(b=b.clone(),b.points=[],this.model.setGeometry(a,b));return a};mxGraph.prototype.getAllConnectionConstraints=function(a){return null!=a&&null!=a.shape&&a.shape instanceof mxStencilShape&&null!=a.shape.stencil?a.shape.stencil.constraints:null};
mxGraph.prototype.getConnectionConstraint=function(a,b,c){var b=null,d=a.style[c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X];if(null!=d){var e=a.style[c?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y];null!=e&&(b=new mxPoint(parseFloat(d),parseFloat(e)))}d=!1;null!=b&&(d=mxUtils.getValue(a.style,c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0));return new mxConnectionConstraint(b,d)};
mxGraph.prototype.setConnectionConstraint=function(a,b,c,d){if(null!=d){this.model.beginUpdate();try{null==d||null==d.point?(this.setCellStyles(c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[a]),this.setCellStyles(c?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[a]),this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[a])):null!=d.point&&(this.setCellStyles(c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,d.point.x,[a]),this.setCellStyles(c?
mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,d.point.y,[a]),d.perimeter?this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[a]):this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[a]))}finally{this.model.endUpdate()}}};
mxGraph.prototype.getConnectionPoint=function(a,b){var c=null;if(null!=a){var d=this.view.getPerimeterBounds(a),e=new mxPoint(d.getCenterX(),d.getCenterY()),f=a.style[mxConstants.STYLE_DIRECTION],g=0;if(null!=f&&("north"==f?g+=270:"west"==f?g+=180:"south"==f&&(g+=90),"north"==f||"south"==f)){d.x+=d.width/2-d.height/2;d.y+=d.height/2-d.width/2;var h=d.width;d.width=d.height;d.height=h}if(null!=b.point){var k=c=1,l=0,n=0;if(a.shape instanceof mxStencilShape){var o=a.style[mxConstants.STYLE_STENCIL_FLIPH],
p=a.style[mxConstants.STYLE_STENCIL_FLIPV];if("north"==f||"south"==f)h=o,o=p,p=h;o&&(c=-1,l=-d.width);p&&(k=-1,n=-d.height)}c=new mxPoint(d.x+b.point.x*d.width*c-l,d.y+b.point.y*d.height*k-n)}f=a.style[mxConstants.STYLE_ROTATION]||0;b.perimeter?(0!=g&&null!=c&&(h=d=0,90==g?h=1:180==g?d=-1:270==f&&(h=-1),c=mxUtils.getRotatedPoint(c,d,h,e)),null!=c&&b.perimeter&&(c=this.view.getPerimeterPoint(a,c,!1))):f+=g;0!=f&&null!=c&&(g=mxUtils.toRadians(f),d=Math.cos(g),h=Math.sin(g),c=mxUtils.getRotatedPoint(c,
d,h,e))}return c};mxGraph.prototype.connectCell=function(a,b,c,d){this.model.beginUpdate();try{var e=this.model.getTerminal(a,c);this.cellConnected(a,b,c,d);this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",a,"terminal",b,"source",c,"previous",e))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellConnected=function(a,b,c,d){if(null!=a){this.model.beginUpdate();try{var e=this.model.getTerminal(a,c);this.setConnectionConstraint(a,b,c,d);this.isPortsEnabled()&&(d=null,this.isPort(b)&&(d=b.getId(),b=this.getTerminalForPort(b,c)),this.setCellStyles(c?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,d,[a]));this.model.setTerminal(a,b,c);this.resetEdgesOnConnect&&this.resetEdge(a);this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",a,"terminal",b,"source",
c,"previous",e))}finally{this.model.endUpdate()}}};
mxGraph.prototype.disconnectGraph=function(a){if(null!=a){this.model.beginUpdate();try{for(var b=this.view.scale,c=this.view.translate,d={},e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e]}for(e=0;e<a.length;e++)if(this.model.isEdge(a[e])){var g=this.model.getGeometry(a[e]);if(null!=g){var h=this.view.getState(a[e]),k=this.view.getState(this.model.getParent(a[e]));if(null!=h&&null!=k){var g=g.clone(),l=-k.origin.x,n=-k.origin.y,o=h.absolutePoints,p=this.model.getTerminal(a[e],!0);if(null!=
p&&this.isCellDisconnectable(a[e],p,!0)){for(var r=mxCellPath.create(p);null!=p&&null==d[r];)p=this.model.getParent(p),r=mxCellPath.create(p);null==p&&(g.setTerminalPoint(new mxPoint(o[0].x/b-c.x+l,o[0].y/b-c.y+n),!0),this.model.setTerminal(a[e],null,!0))}var s=this.model.getTerminal(a[e],!1);if(null!=s&&this.isCellDisconnectable(a[e],s,!1)){for(var u=mxCellPath.create(s);null!=s&&null==d[u];)s=this.model.getParent(s),u=mxCellPath.create(s);if(null==s){var w=o.length-1;g.setTerminalPoint(new mxPoint(o[w].x/
b-c.x+l,o[w].y/b-c.y+n),!1);this.model.setTerminal(a[e],null,!1)}}this.model.setGeometry(a[e],g)}}}}finally{this.model.endUpdate()}}};mxGraph.prototype.getCurrentRoot=function(){return this.view.currentRoot};mxGraph.prototype.getTranslateForRoot=function(){return null};mxGraph.prototype.isPort=function(){return!1};mxGraph.prototype.getTerminalForPort=function(a){return this.model.getParent(a)};mxGraph.prototype.getChildOffsetForCell=function(){return null};
mxGraph.prototype.enterGroup=function(a){a=a||this.getSelectionCell();null!=a&&this.isValidRoot(a)&&(this.view.setCurrentRoot(a),this.clearSelection())};mxGraph.prototype.exitGroup=function(){var a=this.model.getRoot(),b=this.getCurrentRoot();if(null!=b){for(var c=this.model.getParent(b);c!=a&&!this.isValidRoot(c)&&this.model.getParent(c)!=a;)c=this.model.getParent(c);c==a||this.model.getParent(c)==a?this.view.setCurrentRoot(null):this.view.setCurrentRoot(c);null!=this.view.getState(b)&&this.setSelectionCell(b)}};
mxGraph.prototype.home=function(){var a=this.getCurrentRoot();null!=a&&(this.view.setCurrentRoot(null),null!=this.view.getState(a)&&this.setSelectionCell(a))};mxGraph.prototype.isValidRoot=function(a){return null!=a};mxGraph.prototype.getGraphBounds=function(){return this.view.getGraphBounds()};
mxGraph.prototype.getCellBounds=function(a,b,c){var d=[a];b&&(d=d.concat(this.model.getEdges(a)));d=this.view.getBounds(d);if(c)for(var c=this.model.getChildCount(a),e=0;e<c;e++){var f=this.getCellBounds(this.model.getChildAt(a,e),b,!0);null!=d?d.add(f):d=f}return d};
mxGraph.prototype.getBoundingBoxFromGeometry=function(a,b){var b=null!=b?b:!1,c=null;if(null!=a)for(var d=0;d<a.length;d++)if(b||this.model.isVertex(a[d])){var e=this.getCellGeometry(a[d]);if(null!=e){var f=e.points;if(null!=f&&0<f.length){for(var g=new mxRectangle(f[0].x,f[0].y,0,0),h=function(a){null!=a&&g.add(new mxRectangle(a.x,a.y,0,0))},k=1;k<f.length;k++)h(f[k]);h(e.getTerminalPoint(!0));h(e.getTerminalPoint(!1))}null==c?c=new mxRectangle(e.x,e.y,e.width,e.height):c.add(e)}}return c};
mxGraph.prototype.refresh=function(a){this.view.clear(a,null==a);this.view.validate();this.sizeDidChange();this.fireEvent(new mxEventObject(mxEvent.REFRESH))};mxGraph.prototype.snap=function(a){this.gridEnabled&&(a=Math.round(a/this.gridSize)*this.gridSize);return a};
mxGraph.prototype.panGraph=function(a,b){if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container))this.container.scrollLeft=-a,this.container.scrollTop=-b;else{var c=this.view.getCanvas();if(this.dialect==mxConstants.DIALECT_SVG)if(0==a&&0==b){if(mxClient.IS_IE?c.setAttribute("transform","translate("+a+","+b+")"):c.removeAttribute("transform"),null!=this.shiftPreview1){for(var d=this.shiftPreview1.firstChild;null!=d;){var e=d.nextSibling;this.container.appendChild(d);d=e}this.shiftPreview1.parentNode.removeChild(this.shiftPreview1);
this.shiftPreview1=null;this.container.appendChild(c.parentNode);for(d=this.shiftPreview2.firstChild;null!=d;)e=d.nextSibling,this.container.appendChild(d),d=e;this.shiftPreview2.parentNode.removeChild(this.shiftPreview2);this.shiftPreview2=null}}else{c.setAttribute("transform","translate("+a+","+b+")");if(null==this.shiftPreview1){this.shiftPreview1=document.createElement("div");this.shiftPreview1.style.position="absolute";this.shiftPreview1.style.overflow="visible";this.shiftPreview2=document.createElement("div");
this.shiftPreview2.style.position="absolute";this.shiftPreview2.style.overflow="visible";for(var f=this.shiftPreview1,d=this.container.firstChild;null!=d;)e=d.nextSibling,d!=c.parentNode?f.appendChild(d):f=this.shiftPreview2,d=e;this.container.insertBefore(this.shiftPreview1,c.parentNode);this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=a+"px";this.shiftPreview1.style.top=b+"px";this.shiftPreview2.style.left=a+"px";this.shiftPreview2.style.top=b+"px"}else c.style.left=
a+"px",c.style.top=b+"px";this.panDx=a;this.panDy=b;this.fireEvent(new mxEventObject(mxEvent.PAN))}};mxGraph.prototype.zoomIn=function(){this.zoom(this.zoomFactor)};mxGraph.prototype.zoomOut=function(){this.zoom(1/this.zoomFactor)};mxGraph.prototype.zoomActual=function(){1==this.view.scale?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))};mxGraph.prototype.zoomTo=function(a,b){this.zoom(a/this.view.scale,b)};
mxGraph.prototype.zoom=function(a,b){var b=null!=b?b:this.centerZoom,c=this.view.scale*a,d=this.view.getState(this.getSelectionCell());if(this.keepSelectionVisibleOnZoom&&null!=d)d=new mxRectangle(d.x*a,d.y*a,d.width*a,d.height*a),this.view.scale=c,this.scrollRectToVisible(d)||(this.view.revalidate(),this.view.setScale(c));else if(b&&!mxUtils.hasScrollbars(this.container)){var d=this.container.offsetWidth,e=this.container.offsetHeight;if(1<a)var f=(a-1)/(2*c),d=d*-f,e=e*-f;else f=(1/a-1)/(2*this.view.scale),
d*=f,e*=f;this.view.scaleAndTranslate(c,this.view.translate.x+d,this.view.translate.y+e)}else this.view.setScale(c),mxUtils.hasScrollbars(this.container)&&(e=d=0,b&&(d=this.container.offsetWidth*(a-1)/2,e=this.container.offsetHeight*(a-1)/2),this.container.scrollLeft=Math.round(this.container.scrollLeft*a+d),this.container.scrollTop=Math.round(this.container.scrollTop*a+e))};
mxGraph.prototype.zoomToRect=function(a){var b=this.container.clientWidth/a.width/(this.container.clientHeight/a.height);a.x=Math.max(0,a.x);a.y=Math.max(0,a.y);var c=Math.min(this.container.scrollWidth,a.x+a.width),d=Math.min(this.container.scrollHeight,a.y+a.height);a.width=c-a.x;a.height=d-a.y;1>b?(b=a.height/b,c=(b-a.height)/2,a.height=b,b=Math.min(a.y,c),a.y-=b,d=Math.min(this.container.scrollHeight,a.y+a.height),a.height=d-a.y):(b*=a.width,c=(b-a.width)/2,a.width=b,b=Math.min(a.x,c),a.x-=b,
c=Math.min(this.container.scrollWidth,a.x+a.width),a.width=c-a.x);b=this.container.clientWidth/a.width;c=this.view.scale*b;mxUtils.hasScrollbars(this.container)?(this.view.setScale(c),this.container.scrollLeft=Math.round(a.x*b),this.container.scrollTop=Math.round(a.y*b)):this.view.scaleAndTranslate(c,this.view.translate.x-a.x/this.view.scale,this.view.translate.y-a.y/this.view.scale)};
mxGraph.prototype.fit=function(a,b){if(null!=this.container){var a=null!=a?a:0,b=null!=b?b:!1,c=this.container.clientWidth,d=this.container.clientHeight,e=this.view.getGraphBounds();b&&null!=e.x&&null!=e.y&&(e.width+=e.x,e.height+=e.y,e.x=0,e.y=0);var f=this.view.scale,g=e.width/f,h=e.height/f;null!=this.backgroundImage&&(g=Math.max(g,this.backgroundImage.width-e.x/f),h=Math.max(h,this.backgroundImage.height-e.y/f));var k=b?a:2*a,c=Math.floor(100*Math.min(c/(g+k),d/(h+k)))/100;null!=this.minFitScale&&
(c=Math.max(c,this.minFitScale));null!=this.maxFitScale&&(c=Math.min(c,this.maxFitScale));b?this.view.scale!=c&&this.view.setScale(c):mxUtils.hasScrollbars(this.container)?(this.view.setScale(c),null!=e.x&&(this.container.scrollLeft=Math.round(e.x/f)*c-a-Math.max(0,(this.container.clientWidth-g*c)/2)),null!=e.y&&(this.container.scrollTop=Math.round(e.y/f)*c-a-Math.max(0,(this.container.clientHeight-h*c)/2))):this.view.scaleAndTranslate(c,null!=e.x?Math.floor(this.view.translate.x-e.x/f+a+1):a,null!=
e.y?Math.floor(this.view.translate.y-e.y/f+a+1):a)}return this.view.scale};mxGraph.prototype.scrollCellToVisible=function(a,b){var c=-this.view.translate.x,d=-this.view.translate.y,e=this.view.getState(a);null!=e&&(c=new mxRectangle(c+e.x,d+e.y,e.width,e.height),b&&null!=this.container&&(d=this.container.clientWidth,e=this.container.clientHeight,c.x=c.getCenterX()-d/2,c.width=d,c.y=c.getCenterY()-e/2,c.height=e),this.scrollRectToVisible(c)&&this.view.setTranslate(this.view.translate.x,this.view.translate.y))};
mxGraph.prototype.scrollRectToVisible=function(a){var b=!1;if(null!=a){var c=this.container.offsetWidth,d=this.container.offsetHeight,e=Math.min(c,a.width),f=Math.min(d,a.height);if(mxUtils.hasScrollbars(this.container)){c=this.container;a.x+=this.view.translate.x;a.y+=this.view.translate.y;var g=c.scrollLeft-a.x,d=Math.max(g-c.scrollLeft,0);0<g?c.scrollLeft-=g+2:(g=a.x+e-c.scrollLeft-c.clientWidth,0<g&&(c.scrollLeft+=g+2));e=c.scrollTop-a.y;g=Math.max(0,e-c.scrollTop);0<e?c.scrollTop-=e+2:(e=a.y+
f-c.scrollTop-c.clientHeight,0<e&&(c.scrollTop+=e+2));!this.useScrollbarsForPanning&&(0!=d||0!=g)&&this.view.setTranslate(d,g)}else{var g=-this.view.translate.x,h=-this.view.translate.y,k=this.view.scale;a.x+e>g+c&&(this.view.translate.x-=(a.x+e-c-g)/k,b=!0);a.y+f>h+d&&(this.view.translate.y-=(a.y+f-d-h)/k,b=!0);a.x<g&&(this.view.translate.x+=(g-a.x)/k,b=!0);a.y<h&&(this.view.translate.y+=(h-a.y)/k,b=!0);b&&(this.view.refresh(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.refresh())}}return b};
mxGraph.prototype.getCellGeometry=function(a){return this.model.getGeometry(a)};mxGraph.prototype.isCellVisible=function(a){return this.model.isVisible(a)};mxGraph.prototype.isCellCollapsed=function(a){return this.model.isCollapsed(a)};mxGraph.prototype.isCellConnectable=function(a){return this.model.isConnectable(a)};
mxGraph.prototype.isOrthogonal=function(a){var b=a.style[mxConstants.STYLE_ORTHOGONAL];if(null!=b)return b;a=this.view.getEdgeStyle(a);return a==mxEdgeStyle.SegmentConnector||a==mxEdgeStyle.ElbowConnector||a==mxEdgeStyle.SideToSide||a==mxEdgeStyle.TopToBottom||a==mxEdgeStyle.EntityRelation||a==mxEdgeStyle.OrthConnector};mxGraph.prototype.isLoop=function(a){var b=a.getVisibleTerminalState(!0),a=a.getVisibleTerminalState(!1);return null!=b&&b==a};mxGraph.prototype.isCloneEvent=function(a){return mxEvent.isControlDown(a)};
mxGraph.prototype.isToggleEvent=function(a){return mxClient.IS_MAC?mxEvent.isMetaDown(a):mxEvent.isControlDown(a)};mxGraph.prototype.isGridEnabledEvent=function(a){return null!=a&&!mxEvent.isAltDown(a)};mxGraph.prototype.isConstrainedEvent=function(a){return mxEvent.isShiftDown(a)};mxGraph.prototype.isForceMarqueeEvent=function(a){return mxEvent.isAltDown(a)};mxGraph.prototype.validationAlert=function(a){mxUtils.alert(a)};
mxGraph.prototype.isEdgeValid=function(a,b,c){return null==this.getEdgeValidationError(a,b,c)};
mxGraph.prototype.getEdgeValidationError=function(a,b,c){if(null!=a&&!this.isAllowDanglingEdges()&&(null==b||null==c))return"";if(null!=a&&null==this.model.getTerminal(a,!0)&&null==this.model.getTerminal(a,!1))return null;if(!this.allowLoops&&b==c&&null!=b||!this.isValidConnection(b,c))return"";if(null!=b&&null!=c){var d="";if(!this.multigraph){var e=this.model.getEdgesBetween(b,c,!0);if(1<e.length||1==e.length&&e[0]!=a)d+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+
"\n"}var e=this.model.getDirectedEdgeCount(b,!0,a),f=this.model.getDirectedEdgeCount(c,!1,a);if(null!=this.multiplicities)for(var g=0;g<this.multiplicities.length;g++){var h=this.multiplicities[g].check(this,a,b,c,e,f);null!=h&&(d+=h)}h=this.validateEdge(a,b,c);null!=h&&(d+=h);return 0<d.length?d:null}return this.allowDanglingEdges?null:""};mxGraph.prototype.validateEdge=function(){return null};
mxGraph.prototype.validateGraph=function(a,b){for(var a=null!=a?a:this.model.getRoot(),b=null!=b?b:{},c=!0,d=this.model.getChildCount(a),e=0;e<d;e++){var f=this.model.getChildAt(a,e),g=b;this.isValidRoot(f)&&(g={});g=this.validateGraph(f,g);null!=g?this.setCellWarning(f,g.replace(/\n/g,"<br>")):this.setCellWarning(f,null);c=c&&null==g}d="";this.isCellCollapsed(a)&&!c&&(d+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+"\n");d=this.model.isEdge(a)?d+
(this.getEdgeValidationError(a,this.model.getTerminal(a,!0),this.model.getTerminal(a,!1))||""):d+(this.getCellValidationError(a)||"");e=this.validateCell(a,b);null!=e&&(d+=e);null==this.model.getParent(a)&&this.view.validate();return 0<d.length||!c?d:null};
mxGraph.prototype.getCellValidationError=function(a){var b=this.model.getDirectedEdgeCount(a,!0),c=this.model.getDirectedEdgeCount(a,!1),a=this.model.getValue(a),d="";if(null!=this.multiplicities)for(var e=0;e<this.multiplicities.length;e++){var f=this.multiplicities[e];if(f.source&&mxUtils.isNode(a,f.type,f.attr,f.value)&&(0==f.max&&0<b||1==f.min&&0==b||1==f.max&&1<b))d+=f.countError+"\n";else if(!f.source&&mxUtils.isNode(a,f.type,f.attr,f.value)&&(0==f.max&&0<c||1==f.min&&0==c||1==f.max&&1<c))d+=
f.countError+"\n"}return 0<d.length?d:null};mxGraph.prototype.validateCell=function(){return null};mxGraph.prototype.getBackgroundImage=function(){return this.backgroundImage};mxGraph.prototype.setBackgroundImage=function(a){this.backgroundImage=a};mxGraph.prototype.getFoldingImage=function(a){if(null!=a&&this.foldingEnabled&&!this.getModel().isEdge(a.cell)){var b=this.isCellCollapsed(a.cell);if(this.isCellFoldable(a.cell,!b))return b?this.collapsedImage:this.expandedImage}return null};
mxGraph.prototype.convertValueToString=function(a){a=this.model.getValue(a);if(null!=a){if(mxUtils.isNode(a))return a.nodeName;if("function"==typeof a.toString)return a.toString()}return""};mxGraph.prototype.getLabel=function(a){var b="";if(this.labelsVisible&&null!=a){var c=this.view.getState(a),c=null!=c?c.style:this.getCellStyle(a);mxUtils.getValue(c,mxConstants.STYLE_NOLABEL,!1)||(b=this.convertValueToString(a))}return b};mxGraph.prototype.isHtmlLabel=function(){return this.isHtmlLabels()};
mxGraph.prototype.isHtmlLabels=function(){return this.htmlLabels};mxGraph.prototype.setHtmlLabels=function(a){this.htmlLabels=a};mxGraph.prototype.isWrapping=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return null!=a?"wrap"==a[mxConstants.STYLE_WHITE_SPACE]:!1};mxGraph.prototype.isLabelClipped=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return null!=a?"hidden"==a[mxConstants.STYLE_OVERFLOW]:!1};
mxGraph.prototype.getTooltip=function(a,b){var c=null;if(null!=a){if(null!=a.control&&(b==a.control.node||b.parentNode==a.control.node))c=this.collapseExpandResource,c=mxResources.get(c)||c;null==c&&null!=a.overlays&&a.overlays.visit(function(a,d){if(null==c&&(b==d.node||b.parentNode==d.node))c=d.overlay.toString()});if(null==c){var d=this.selectionCellsHandler.getHandler(a.cell);null!=d&&"function"==typeof d.getTooltipForNode&&(c=d.getTooltipForNode(b))}null==c&&(c=this.getTooltipForCell(a.cell))}return c};
mxGraph.prototype.getTooltipForCell=function(a){var b=null;return b=null!=a&&null!=a.getTooltip?a.getTooltip():this.convertValueToString(a)};mxGraph.prototype.getCursorForCell=function(){return null};
mxGraph.prototype.getStartSize=function(a){var b=new mxRectangle,c=this.view.getState(a),a=null!=c?c.style:this.getCellStyle(a);null!=a&&(c=parseInt(mxUtils.getValue(a,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),mxUtils.getValue(a,mxConstants.STYLE_HORIZONTAL,!0)?b.height=c:b.width=c);return b};mxGraph.prototype.getImage=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_IMAGE]:null};
mxGraph.prototype.getVerticalAlign=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null};mxGraph.prototype.getIndicatorColor=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_COLOR]:null};mxGraph.prototype.getIndicatorGradientColor=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null};
mxGraph.prototype.getIndicatorShape=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_SHAPE]:null};mxGraph.prototype.getIndicatorImage=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_IMAGE]:null};mxGraph.prototype.getBorder=function(){return this.border};mxGraph.prototype.setBorder=function(a){this.border=a};
mxGraph.prototype.isSwimlane=function(a){if(null!=a&&this.model.getParent(a)!=this.model.getRoot()){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);if(null!=b&&!this.model.isEdge(a))return b[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE}return!1};mxGraph.prototype.isResizeContainer=function(){return this.resizeContainer};mxGraph.prototype.setResizeContainer=function(a){this.resizeContainer=a};mxGraph.prototype.isEnabled=function(){return this.enabled};
mxGraph.prototype.setEnabled=function(a){this.enabled=a};mxGraph.prototype.isEscapeEnabled=function(){return this.escapeEnabled};mxGraph.prototype.setEscapeEnabled=function(a){this.escapeEnabled=a};mxGraph.prototype.isInvokesStopCellEditing=function(){return this.invokesStopCellEditing};mxGraph.prototype.setInvokesStopCellEditing=function(a){this.invokesStopCellEditing=a};mxGraph.prototype.isEnterStopsCellEditing=function(){return this.enterStopsCellEditing};
mxGraph.prototype.setEnterStopsCellEditing=function(a){this.enterStopsCellEditing=a};mxGraph.prototype.isCellLocked=function(a){var b=this.model.getGeometry(a);return this.isCellsLocked()||null!=b&&this.model.isVertex(a)&&b.relative};mxGraph.prototype.isCellsLocked=function(){return this.cellsLocked};mxGraph.prototype.setCellsLocked=function(a){this.cellsLocked=a};mxGraph.prototype.getCloneableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellCloneable(a)}))};
mxGraph.prototype.isCellCloneable=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return this.isCellsCloneable()&&0!=a[mxConstants.STYLE_CLONEABLE]};mxGraph.prototype.isCellsCloneable=function(){return this.cellsCloneable};mxGraph.prototype.setCellsCloneable=function(a){this.cellsCloneable=a};mxGraph.prototype.getExportableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.canExportCell(a)}))};
mxGraph.prototype.canExportCell=function(){return this.exportEnabled};mxGraph.prototype.getImportableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.canImportCell(a)}))};mxGraph.prototype.canImportCell=function(){return this.importEnabled};mxGraph.prototype.isCellSelectable=function(){return this.isCellsSelectable()};mxGraph.prototype.isCellsSelectable=function(){return this.cellsSelectable};
mxGraph.prototype.setCellsSelectable=function(a){this.cellsSelectable=a};mxGraph.prototype.getDeletableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellDeletable(a)}))};mxGraph.prototype.isCellDeletable=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return this.isCellsDeletable()&&0!=a[mxConstants.STYLE_DELETABLE]};mxGraph.prototype.isCellsDeletable=function(){return this.cellsDeletable};
mxGraph.prototype.setCellsDeletable=function(a){this.cellsDeletable=a};mxGraph.prototype.isLabelMovable=function(a){return!this.isCellLocked(a)&&(this.model.isEdge(a)&&this.edgeLabelsMovable||this.model.isVertex(a)&&this.vertexLabelsMovable)};mxGraph.prototype.getMovableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellMovable(a)}))};
mxGraph.prototype.isCellMovable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsMovable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_MOVABLE]};mxGraph.prototype.isCellsMovable=function(){return this.cellsMovable};mxGraph.prototype.setCellsMovable=function(a){this.cellsMovable=a};mxGraph.prototype.isGridEnabled=function(){return this.gridEnabled};mxGraph.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxGraph.prototype.isPortsEnabled=function(){return this.portsEnabled};
mxGraph.prototype.setPortsEnabled=function(a){this.portsEnabled=a};mxGraph.prototype.getGridSize=function(){return this.gridSize};mxGraph.prototype.setGridSize=function(a){this.gridSize=a};mxGraph.prototype.getTolerance=function(){return this.tolerance};mxGraph.prototype.setTolerance=function(a){this.tolerance=a};mxGraph.prototype.isVertexLabelsMovable=function(){return this.vertexLabelsMovable};mxGraph.prototype.setVertexLabelsMovable=function(a){this.vertexLabelsMovable=a};
mxGraph.prototype.isEdgeLabelsMovable=function(){return this.edgeLabelsMovable};mxGraph.prototype.setEdgeLabelsMovable=function(a){this.edgeLabelsMovable=a};mxGraph.prototype.isSwimlaneNesting=function(){return this.swimlaneNesting};mxGraph.prototype.setSwimlaneNesting=function(a){this.swimlaneNesting=a};mxGraph.prototype.isSwimlaneSelectionEnabled=function(){return this.swimlaneSelectionEnabled};mxGraph.prototype.setSwimlaneSelectionEnabled=function(a){this.swimlaneSelectionEnabled=a};
mxGraph.prototype.isMultigraph=function(){return this.multigraph};mxGraph.prototype.setMultigraph=function(a){this.multigraph=a};mxGraph.prototype.isAllowLoops=function(){return this.allowLoops};mxGraph.prototype.setAllowDanglingEdges=function(a){this.allowDanglingEdges=a};mxGraph.prototype.isAllowDanglingEdges=function(){return this.allowDanglingEdges};mxGraph.prototype.setConnectableEdges=function(a){this.connectableEdges=a};mxGraph.prototype.isConnectableEdges=function(){return this.connectableEdges};
mxGraph.prototype.setCloneInvalidEdges=function(a){this.cloneInvalidEdges=a};mxGraph.prototype.isCloneInvalidEdges=function(){return this.cloneInvalidEdges};mxGraph.prototype.setAllowLoops=function(a){this.allowLoops=a};mxGraph.prototype.isDisconnectOnMove=function(){return this.disconnectOnMove};mxGraph.prototype.setDisconnectOnMove=function(a){this.disconnectOnMove=a};mxGraph.prototype.isDropEnabled=function(){return this.dropEnabled};
mxGraph.prototype.setDropEnabled=function(a){this.dropEnabled=a};mxGraph.prototype.isSplitEnabled=function(){return this.splitEnabled};mxGraph.prototype.setSplitEnabled=function(a){this.splitEnabled=a};mxGraph.prototype.isCellResizable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsResizable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_RESIZABLE]};mxGraph.prototype.isCellsResizable=function(){return this.cellsResizable};
mxGraph.prototype.setCellsResizable=function(a){this.cellsResizable=a};mxGraph.prototype.isTerminalPointMovable=function(){return!0};mxGraph.prototype.isCellBendable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsBendable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_BENDABLE]};mxGraph.prototype.isCellsBendable=function(){return this.cellsBendable};mxGraph.prototype.setCellsBendable=function(a){this.cellsBendable=a};
mxGraph.prototype.isCellEditable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsEditable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_EDITABLE]};mxGraph.prototype.isCellsEditable=function(){return this.cellsEditable};mxGraph.prototype.setCellsEditable=function(a){this.cellsEditable=a};mxGraph.prototype.isCellDisconnectable=function(a){return this.isCellsDisconnectable()&&!this.isCellLocked(a)};mxGraph.prototype.isCellsDisconnectable=function(){return this.cellsDisconnectable};
mxGraph.prototype.setCellsDisconnectable=function(a){this.cellsDisconnectable=a};mxGraph.prototype.isValidSource=function(a){return null==a&&this.allowDanglingEdges||null!=a&&(!this.model.isEdge(a)||this.connectableEdges)&&this.isCellConnectable(a)};mxGraph.prototype.isValidTarget=function(a){return this.isValidSource(a)};mxGraph.prototype.isValidConnection=function(a,b){return this.isValidSource(a)&&this.isValidTarget(b)};mxGraph.prototype.setConnectable=function(a){this.connectionHandler.setEnabled(a)};
mxGraph.prototype.isConnectable=function(){return this.connectionHandler.isEnabled()};mxGraph.prototype.setTooltips=function(a){this.tooltipHandler.setEnabled(a)};mxGraph.prototype.setPanning=function(a){this.panningHandler.panningEnabled=a};mxGraph.prototype.isEditing=function(a){if(null!=this.cellEditor){var b=this.cellEditor.getEditingCell();return null==a?null!=b:a==b}return!1};
mxGraph.prototype.isAutoSizeCell=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return this.isAutoSizeCells()||1==a[mxConstants.STYLE_AUTOSIZE]};mxGraph.prototype.isAutoSizeCells=function(){return this.autoSizeCells};mxGraph.prototype.setAutoSizeCells=function(a){this.autoSizeCells=a};mxGraph.prototype.isExtendParent=function(a){return!this.getModel().isEdge(a)&&this.isExtendParents()};mxGraph.prototype.isExtendParents=function(){return this.extendParents};
mxGraph.prototype.setExtendParents=function(a){this.extendParents=a};mxGraph.prototype.isExtendParentsOnAdd=function(){return this.extendParentsOnAdd};mxGraph.prototype.setExtendParentsOnAdd=function(a){this.extendParentsOnAdd=a};mxGraph.prototype.isConstrainChild=function(a){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(a))};mxGraph.prototype.isConstrainChildren=function(){return this.constrainChildren};
mxGraph.prototype.setConstrainChildren=function(a){this.constrainChildren=a};mxGraph.prototype.isAllowNegativeCoordinates=function(){return this.allowNegativeCoordinates};mxGraph.prototype.setAllowNegativeCoordinates=function(a){this.allowNegativeCoordinates=a};mxGraph.prototype.getOverlap=function(a){return this.isAllowOverlapParent(a)?this.defaultOverlap:0};mxGraph.prototype.isAllowOverlapParent=function(){return!1};
mxGraph.prototype.getFoldableCells=function(a,b){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellFoldable(a,b)}))};mxGraph.prototype.isCellFoldable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return 0<this.model.getChildCount(a)&&0!=b[mxConstants.STYLE_FOLDABLE]};
mxGraph.prototype.isValidDropTarget=function(a,b,c){return null!=a&&(this.isSplitEnabled()&&this.isSplitTarget(a,b,c)||!this.model.isEdge(a)&&(this.isSwimlane(a)||0<this.model.getChildCount(a)&&!this.isCellCollapsed(a)))};
mxGraph.prototype.isSplitTarget=function(a,b){if(this.model.isEdge(a)&&null!=b&&1==b.length&&this.isCellConnectable(b[0])&&null==this.getEdgeValidationError(a,this.model.getTerminal(a,!0),b[0])){var c=this.model.getTerminal(a,!0),d=this.model.getTerminal(a,!1);return!this.model.isAncestor(b[0],c)&&!this.model.isAncestor(b[0],d)}return!1};
mxGraph.prototype.getDropTarget=function(a,b,c){if(!this.isSwimlaneNesting())for(var d=0;d<a.length;d++)if(this.isSwimlane(a[d]))return null;d=mxUtils.convertPoint(this.container,mxEvent.getClientX(b),mxEvent.getClientY(b));d.x-=this.panDx;d.y-=this.panDy;d=this.getSwimlaneAt(d.x,d.y);if(null==c)c=d;else if(null!=d){for(var e=this.model.getParent(d);null!=e&&this.isSwimlane(e)&&e!=c;)e=this.model.getParent(e);e==c&&(c=d)}for(;null!=c&&!this.isValidDropTarget(c,a,b)&&!this.model.isLayer(c);)c=this.model.getParent(c);
return!this.model.isLayer(c)&&0>mxUtils.indexOf(a,c)?c:null};mxGraph.prototype.getDefaultParent=function(){var a=this.defaultParent;null==a&&(a=this.getCurrentRoot(),null==a&&(a=this.model.getChildAt(this.model.getRoot(),0)));return a};mxGraph.prototype.setDefaultParent=function(a){this.defaultParent=a};mxGraph.prototype.getSwimlane=function(a){for(;null!=a&&!this.isSwimlane(a);)a=this.model.getParent(a);return a};
mxGraph.prototype.getSwimlaneAt=function(a,b,c){c=c||this.getDefaultParent();if(null!=c)for(var d=this.model.getChildCount(c),e=0;e<d;e++){var f=this.model.getChildAt(c,e),g=this.getSwimlaneAt(a,b,f);if(null!=g)return g;if(this.isSwimlane(f)&&this.intersects(this.view.getState(f),a,b))return f}return null};
mxGraph.prototype.getCellAt=function(a,b,c,d,e){d=null!=d?d:!0;e=null!=e?e:!0;c=null!=c?c:this.getDefaultParent();if(null!=c)for(var f=this.model.getChildCount(c)-1;0<=f;f--){var g=this.model.getChildAt(c,f),h=this.getCellAt(a,b,g,d,e);if(null!=h)return h;if(this.isCellVisible(g)&&(e&&this.model.isEdge(g)||d&&this.model.isVertex(g))&&this.intersects(this.view.getState(g),a,b))return g}return null};
mxGraph.prototype.intersects=function(a,b,c){if(null!=a){var d=a.absolutePoints;if(null!=d)for(var a=this.tolerance*this.tolerance,e=d[0],f=1;f<d.length;f++){var g=d[f];if(mxUtils.ptSegDistSq(e.x,e.y,g.x,g.y,b,c)<=a)return!0;e=g}else if(mxUtils.contains(a,b,c))return!0}return!1};
mxGraph.prototype.hitsSwimlaneContent=function(a,b,c){var d=this.getView().getState(a),a=this.getStartSize(a);if(null!=d){var e=this.getView().getScale(),b=b-d.x,c=c-d.y;if(0<a.width&&0<b&&b>a.width*e||0<a.height&&0<c&&c>a.height*e)return!0}return!1};mxGraph.prototype.getChildVertices=function(a){return this.getChildCells(a,!0,!1)};mxGraph.prototype.getChildEdges=function(a){return this.getChildCells(a,!1,!0)};
mxGraph.prototype.getChildCells=function(a,b,c){a=null!=a?a:this.getDefaultParent();a=this.model.getChildCells(a,null!=b?b:!1,null!=c?c:!1);b=[];for(c=0;c<a.length;c++)this.isCellVisible(a[c])&&b.push(a[c]);return b};mxGraph.prototype.getConnections=function(a,b){return this.getEdges(a,b,!0,!0,!1)};mxGraph.prototype.getIncomingEdges=function(a,b){return this.getEdges(a,b,!0,!1,!1)};mxGraph.prototype.getOutgoingEdges=function(a,b){return this.getEdges(a,b,!1,!0,!1)};
mxGraph.prototype.getEdges=function(a,b,c,d,e,f){for(var c=null!=c?c:!0,d=null!=d?d:!0,e=null!=e?e:!0,f=null!=f?f:!1,g=[],h=this.isCellCollapsed(a),k=this.model.getChildCount(a),l=0;l<k;l++){var n=this.model.getChildAt(a,l);if(h||!this.isCellVisible(n))g=g.concat(this.model.getEdges(n,c,d))}g=g.concat(this.model.getEdges(a,c,d));h=[];for(l=0;l<g.length;l++)n=this.view.getState(g[l]),k=null!=n?n.getVisibleTerminal(!0):this.view.getVisibleTerminal(g[l],!0),n=null!=n?n.getVisibleTerminal(!1):this.view.getVisibleTerminal(g[l],
!1),(e&&k==n||k!=n&&(c&&n==a&&(null==b||this.isValidAncestor(k,b,f))||d&&k==a&&(null==b||this.isValidAncestor(n,b,f))))&&h.push(g[l]);return h};mxGraph.prototype.isValidAncestor=function(a,b,c){return c?this.model.isAncestor(b,a):this.model.getParent(a)==b};
mxGraph.prototype.getOpposites=function(a,b,c,d){var c=null!=c?c:!0,d=null!=d?d:!0,e=[],f={};if(null!=a)for(var g=0;g<a.length;g++){var h=this.view.getState(a[g]),k=null!=h?h.getVisibleTerminal(!0):this.view.getVisibleTerminal(a[g],!0),h=null!=h?h.getVisibleTerminal(!1):this.view.getVisibleTerminal(a[g],!1);if(k==b&&null!=h&&h!=b&&d){var l=mxCellPath.create(h);null==f[l]&&(f[l]=h,e.push(h))}else h==b&&null!=k&&k!=b&&c&&(l=mxCellPath.create(k),null==f[l]&&(f[l]=k,e.push(k)))}return e};
mxGraph.prototype.getEdgesBetween=function(a,b,c){for(var c=null!=c?c:!1,d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.view.getState(d[f]),h=null!=g?g.getVisibleTerminal(!0):this.view.getVisibleTerminal(d[f],!0),g=null!=g?g.getVisibleTerminal(!1):this.view.getVisibleTerminal(d[f],!1);(h==a&&g==b||!c&&h==b&&g==a)&&e.push(d[f])}return e};
mxGraph.prototype.getPointForEvent=function(a,b){var c=mxUtils.convertPoint(this.container,mxEvent.getClientX(a),mxEvent.getClientY(a)),d=this.view.scale,e=this.view.translate,f=!1!=b?this.gridSize/2:0;c.x=this.snap(c.x/d-e.x-f);c.y=this.snap(c.y/d-e.y-f);return c};
mxGraph.prototype.getCells=function(a,b,c,d,e,f){f=null!=f?f:[];if(0<c||0<d){var g=a+c,h=b+d,e=e||this.getDefaultParent();if(null!=e)for(var k=this.model.getChildCount(e),l=0;l<k;l++){var n=this.model.getChildAt(e,l),o=this.view.getState(n);this.isCellVisible(n)&&null!=o&&(o.x>=a&&o.y>=b&&o.x+o.width<=g&&o.y+o.height<=h?f.push(n):this.getCells(a,b,c,d,n,f))}}return f};
mxGraph.prototype.getCellsBeyond=function(a,b,c,d,e){var f=[];if(d||e)if(null==c&&(c=this.getDefaultParent()),null!=c)for(var g=this.model.getChildCount(c),h=0;h<g;h++){var k=this.model.getChildAt(c,h),l=this.view.getState(k);this.isCellVisible(k)&&null!=l&&(!d||l.x>=a)&&(!e||l.y>=b)&&f.push(k)}return f};
mxGraph.prototype.findTreeRoots=function(a,b,c){var b=null!=b?b:!1,c=null!=c?c:!1,d=[];if(null!=a){for(var e=this.getModel(),f=e.getChildCount(a),g=null,h=0,k=0;k<f;k++){var l=e.getChildAt(a,k);if(this.model.isVertex(l)&&this.isCellVisible(l)){for(var n=this.getConnections(l,b?a:null),o=0,p=0,r=0;r<n.length;r++)this.view.getVisibleTerminal(n[r],!0)==l?o++:p++;(c&&0==o&&0<p||!c&&0==p&&0<o)&&d.push(l);n=c?p-o:o-p;n>h&&(h=n,g=l)}}0==d.length&&null!=g&&d.push(g)}return d};
mxGraph.prototype.traverse=function(a,b,c,d,e){if(null!=c&&null!=a){var b=null!=b?b:!0,e=e||[],f=mxCellPath.create(a);if(null==e[f]&&(e[f]=a,d=c(a,d),null==d||d))if(d=this.model.getEdgeCount(a),0<d)for(f=0;f<d;f++){var g=this.model.getEdgeAt(a,f),h=this.model.getTerminal(g,!0)==a;(!b||h)&&this.traverse(this.model.getTerminal(g,!h),b,c,g,e)}}};mxGraph.prototype.isCellSelected=function(a){return this.getSelectionModel().isSelected(a)};mxGraph.prototype.isSelectionEmpty=function(){return this.getSelectionModel().isEmpty()};
mxGraph.prototype.clearSelection=function(){return this.getSelectionModel().clear()};mxGraph.prototype.getSelectionCount=function(){return this.getSelectionModel().cells.length};mxGraph.prototype.getSelectionCell=function(){return this.getSelectionModel().cells[0]};mxGraph.prototype.getSelectionCells=function(){return this.getSelectionModel().cells.slice()};mxGraph.prototype.setSelectionCell=function(a){this.getSelectionModel().setCell(a)};mxGraph.prototype.setSelectionCells=function(a){this.getSelectionModel().setCells(a)};
mxGraph.prototype.addSelectionCell=function(a){this.getSelectionModel().addCell(a)};mxGraph.prototype.addSelectionCells=function(a){this.getSelectionModel().addCells(a)};mxGraph.prototype.removeSelectionCell=function(a){this.getSelectionModel().removeCell(a)};mxGraph.prototype.removeSelectionCells=function(a){this.getSelectionModel().removeCells(a)};mxGraph.prototype.selectRegion=function(a,b){var c=this.getCells(a.x,a.y,a.width,a.height);this.selectCellsForEvent(c,b);return c};
mxGraph.prototype.selectNextCell=function(){this.selectCell(!0)};mxGraph.prototype.selectPreviousCell=function(){this.selectCell()};mxGraph.prototype.selectParentCell=function(){this.selectCell(!1,!0)};mxGraph.prototype.selectChildCell=function(){this.selectCell(!1,!1,!0)};
mxGraph.prototype.selectCell=function(a,b,c){var d=this.selectionModel,e=0<d.cells.length?d.cells[0]:null;1<d.cells.length&&d.clear();var d=null!=e?this.model.getParent(e):this.getDefaultParent(),f=this.model.getChildCount(d);null==e&&0<f?(a=this.model.getChildAt(d,0),this.setSelectionCell(a)):(null==e||b)&&null!=this.view.getState(d)&&null!=this.model.getGeometry(d)?this.getCurrentRoot()!=d&&this.setSelectionCell(d):null!=e&&c?0<this.model.getChildCount(e)&&(a=this.model.getChildAt(e,0),this.setSelectionCell(a)):
0<f&&(b=d.getIndex(e),a?(b++,a=this.model.getChildAt(d,b%f)):(b--,a=this.model.getChildAt(d,0>b?f-1:b)),this.setSelectionCell(a))};mxGraph.prototype.selectAll=function(a){a=a||this.getDefaultParent();a=this.model.getChildren(a);null!=a&&this.setSelectionCells(a)};mxGraph.prototype.selectVertices=function(a){this.selectCells(!0,!1,a)};mxGraph.prototype.selectEdges=function(a){this.selectCells(!1,!0,a)};
mxGraph.prototype.selectCells=function(a,b,c){c=c||this.getDefaultParent();this.setSelectionCells(this.model.filterDescendants(mxUtils.bind(this,function(c){return null!=this.view.getState(c)&&0==this.model.getChildCount(c)&&(this.model.isVertex(c)&&a||this.model.isEdge(c)&&b)}),c))};mxGraph.prototype.selectCellForEvent=function(a,b){var c=this.isCellSelected(a);this.isToggleEvent(b)?c?this.removeSelectionCell(a):this.addSelectionCell(a):(!c||1!=this.getSelectionCount())&&this.setSelectionCell(a)};
mxGraph.prototype.selectCellsForEvent=function(a,b){this.isToggleEvent(b)?this.addSelectionCells(a):this.setSelectionCells(a)};
mxGraph.prototype.createHandler=function(a){var b=null;null!=a&&(this.model.isEdge(a.cell)?(b=this.view.getEdgeStyle(a),b=this.isLoop(a)||b==mxEdgeStyle.ElbowConnector||b==mxEdgeStyle.SideToSide||b==mxEdgeStyle.TopToBottom?new mxElbowEdgeHandler(a):b==mxEdgeStyle.SegmentConnector||b==mxEdgeStyle.OrthConnector?new mxEdgeSegmentHandler(a):new mxEdgeHandler(a)):b=new mxVertexHandler(a));return b};mxGraph.prototype.addMouseListener=function(a){null==this.mouseListeners&&(this.mouseListeners=[]);this.mouseListeners.push(a)};
mxGraph.prototype.removeMouseListener=function(a){if(null!=this.mouseListeners)for(var b=0;b<this.mouseListeners.length;b++)if(this.mouseListeners[b]==a){this.mouseListeners.splice(b,1);break}};mxGraph.prototype.updateMouseEvent=function(a){if(null==a.graphX||null==a.graphY){var b=mxUtils.convertPoint(this.container,a.getX(),a.getY());a.graphX=b.x-this.panDx;a.graphY=b.y-this.panDy}};
mxGraph.prototype.fireMouseEvent=function(a,b,c){null==c&&(c=this);this.updateMouseEvent(b);a==mxEvent.MOUSE_DOWN&&(this.isMouseDown=!0);if(mxClient.IS_TOUCH&&this.doubleTapEnabled&&a==mxEvent.MOUSE_DOWN){var d=(new Date).getTime();d-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-b.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-b.getY())<this.doubleTapTolerance?(this.lastTouchTime=0,this.dblClick(b.getEvent(),b.getCell()),b.getEvent().cancelBubble=!0):(this.lastTouchX=
b.getX(),this.lastTouchY=b.getY(),this.lastTouchTime=d)}d=2!=b.getEvent().detail;if(mxClient.IS_IE&&"CSS1Compat"==document.compatMode){if(null!=this.lastMouseX&&Math.abs(this.lastMouseX-b.getX())>this.doubleTapTolerance||null!=this.lastMouseY&&Math.abs(this.lastMouseY-b.getY())>this.doubleTapTolerance)d=!0;a==mxEvent.MOUSE_UP&&(this.lastMouseX=b.getX(),this.lastMouseY=b.getY())}if((a!=mxEvent.MOUSE_UP||this.isMouseDown)&&d){if(a==mxEvent.MOUSE_UP&&(this.isMouseDown=!1),!this.isEditing()&&(mxClient.IS_OP||
mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE&&mxClient.IS_SVG||b.getEvent().target!=this.container)){a==mxEvent.MOUSE_MOVE&&this.isMouseDown&&this.autoScroll&&this.scrollPointToVisible(b.getGraphX(),b.getGraphY(),this.autoExtend);if(null!=this.mouseListeners){c=[c,b];b.getEvent().returnValue=!0;for(d=0;d<this.mouseListeners.length;d++){var e=this.mouseListeners[d];a==mxEvent.MOUSE_DOWN?e.mouseDown.apply(e,c):a==mxEvent.MOUSE_MOVE?e.mouseMove.apply(e,c):a==mxEvent.MOUSE_UP&&e.mouseUp.apply(e,c)}}a==
mxEvent.MOUSE_UP&&this.click(b)}}else a==mxEvent.MOUSE_UP&&(this.isMouseDown=!1)};
mxGraph.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tooltipHandler&&this.tooltipHandler.destroy(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.destroy(),null!=this.panningHandler&&this.panningHandler.destroy(),null!=this.connectionHandler&&this.connectionHandler.destroy(),null!=this.graphHandler&&this.graphHandler.destroy(),null!=this.cellEditor&&this.cellEditor.destroy(),null!=this.view&&this.view.destroy(),null!=this.model&&null!=this.graphModelChangeListener&&
(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)};function mxCellOverlay(a,b,c,d,e,f){this.image=a;this.tooltip=b;this.align=null!=c?c:this.align;this.verticalAlign=null!=d?d:this.verticalAlign;this.offset=null!=e?e:new mxPoint;this.cursor=null!=f?f:"help"}mxCellOverlay.prototype=new mxEventSource;mxCellOverlay.prototype.constructor=mxCellOverlay;mxCellOverlay.prototype.image=null;mxCellOverlay.prototype.tooltip=null;
mxCellOverlay.prototype.align=mxConstants.ALIGN_RIGHT;mxCellOverlay.prototype.verticalAlign=mxConstants.ALIGN_BOTTOM;mxCellOverlay.prototype.offset=null;mxCellOverlay.prototype.cursor=null;mxCellOverlay.prototype.defaultOverlap=0.5;
mxCellOverlay.prototype.getBounds=function(a){var b=a.view.graph.getModel().isEdge(a.cell),c=a.view.scale,d=null,e=this.image.width,f=this.image.height;b?(b=a.absolutePoints,1==b.length%2?d=b[Math.floor(b.length/2)]:(d=b.length/2,a=b[d-1],b=b[d],d=new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2))):(d=new mxPoint,d.x=this.align==mxConstants.ALIGN_LEFT?a.x:this.align==mxConstants.ALIGN_CENTER?a.x+a.width/2:a.x+a.width,d.y=this.verticalAlign==mxConstants.ALIGN_TOP?a.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?
a.y+a.height/2:a.y+a.height);return new mxRectangle(d.x-(e*this.defaultOverlap-this.offset.x)*c,d.y-(f*this.defaultOverlap-this.offset.y)*c,e*c,f*c)};mxCellOverlay.prototype.toString=function(){return this.tooltip};function mxOutline(a,b){this.source=a;null!=b&&this.init(b)}mxOutline.prototype.source=null;mxOutline.prototype.outline=null;mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER;mxOutline.prototype.enabled=!0;mxOutline.prototype.showViewport=!0;
mxOutline.prototype.border=10;mxOutline.prototype.sizerSize=8;mxOutline.prototype.updateOnPan=!1;mxOutline.prototype.sizerImage=null;mxOutline.prototype.suspended=!1;
mxOutline.prototype.init=function(a){this.outline=new mxGraph(a,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());this.outline.foldingEnabled=!1;this.outline.autoScroll=!1;var b=this.outline.graphModelChanged;this.outline.graphModelChanged=mxUtils.bind(this,function(a){!this.suspended&&null!=this.outline&&b.apply(this.outline,arguments)});mxClient.IS_SVG&&(a=this.outline.getView().getCanvas().parentNode,a.setAttribute("shape-rendering","optimizeSpeed"),a.setAttribute("image-rendering",
"optimizeSpeed"));this.outline.labelsVisible=!1;this.outline.setEnabled(!1);this.updateHandler=mxUtils.bind(this,function(){!this.suspended&&!this.active&&this.update()});this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler);this.outline.addMouseListener(this);a=this.source.getView();a.addListener(mxEvent.SCALE,this.updateHandler);a.addListener(mxEvent.TRANSLATE,this.updateHandler);a.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler);a.addListener(mxEvent.DOWN,this.updateHandler);
a.addListener(mxEvent.UP,this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);this.panHandler=mxUtils.bind(this,function(a){this.updateOnPan&&this.updateHandler.apply(this,arguments)});this.source.addListener(mxEvent.PAN,this.panHandler);this.refreshHandler=mxUtils.bind(this,function(){this.outline.setStylesheet(this.source.getStylesheet());this.outline.refresh()});this.source.addListener(mxEvent.REFRESH,this.refreshHandler);this.bounds=new mxRectangle(0,0,0,
0);this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH);this.selectionBorder.dialect=this.outline.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.crisp=!0;this.selectionBorder.init(this.outline.getView().getOverlayPane());mxEvent.redirectMouseEvents(this.selectionBorder.node,this.outline);this.selectionBorder.node.style.background="";this.sizer=this.createSizer();this.sizer.init(this.outline.getView().getOverlayPane());
this.enabled&&(this.sizer.node.style.cursor="pointer");mxEvent.addListener(this.sizer.node,mxClient.IS_TOUCH?"touchstart":"mousedown",mxUtils.bind(this,function(a){this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))}));this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;this.selectionBorder.node.style.cursor="move";this.update(!1)};mxOutline.prototype.isEnabled=function(){return this.enabled};
mxOutline.prototype.setEnabled=function(a){this.enabled=a};mxOutline.prototype.setZoomEnabled=function(a){this.sizer.node.style.visibility=a?"visible":"hidden"};mxOutline.prototype.refresh=function(){this.update(!0)};
mxOutline.prototype.createSizer=function(){if(null!=this.sizerImage){var a=new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src);a.dialect=this.outline.dialect}else a=new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR),a.dialect=this.outline.dialect,a.crisp=!0;return a};
mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)};mxOutline.prototype.getOutlineOffset=function(){return null};
mxOutline.prototype.update=function(a){if(null!=this.source){var b=this.source.view.scale,c=this.source.getGraphBounds(),c=new mxRectangle(c.x/b+this.source.panDx,c.y/b+this.source.panDy,c.width/b,c.height/b),d=new mxRectangle(0,0,this.source.container.clientWidth/b,this.source.container.clientHeight/b),e=c.clone();e.add(d);var f=this.getSourceContainerSize(),d=Math.max(f.width/b,e.width),b=Math.max(f.height/b,e.height),e=Math.max(0,this.outline.container.clientWidth-this.border),f=Math.max(0,this.outline.container.clientHeight-
this.border),e=Math.min(e/d,f/b);if(0<e){this.outline.getView().scale!=e&&(this.outline.getView().scale=e,a=!0);d=this.outline.getView();d.currentRoot!=this.source.getView().currentRoot&&d.setCurrentRoot(this.source.getView().currentRoot);var b=this.source.view.translate,f=b.x+this.source.panDx,g=b.y+this.source.panDy,e=this.getOutlineOffset(e);null!=e&&(f+=e.x,g+=e.y);0>c.x&&(f-=c.x);0>c.y&&(g-=c.y);if(d.translate.x!=f||d.translate.y!=g)d.translate.x=f,d.translate.y=g,a=!0;var c=d.translate,e=this.source.getView().scale,
f=e/d.scale,g=1/d.scale,h=this.source.container;this.bounds=new mxRectangle((c.x-b.x-this.source.panDx)/g,(c.y-b.y-this.source.panDy)/g,h.clientWidth/f,h.clientHeight/f);this.bounds.x+=this.source.container.scrollLeft*d.scale/e;this.bounds.y+=this.source.container.scrollTop*d.scale/e;c=this.selectionBorder.bounds;if(c.x!=this.bounds.x||c.y!=this.bounds.y||c.width!=this.bounds.width||c.height!=this.bounds.height)this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw();c=this.sizer.bounds;
d=new mxRectangle(this.bounds.x+this.bounds.width-c.width/2,this.bounds.y+this.bounds.height-c.height/2,c.width,c.height);if(c.x!=d.x||c.y!=d.y||c.width!=d.width||c.height!=d.height)this.sizer.bounds=d,"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();a&&this.outline.view.revalidate()}}};
mxOutline.prototype.mouseDown=function(a,b){this.enabled&&this.showViewport&&(this.zoom=b.isSource(this.sizer),this.startX=b.getX(),this.startY=b.getY(),this.active=!0,this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,this.dy0=this.source.container.scrollTop):this.dy0=this.dx0=0);b.consume()};
mxOutline.prototype.mouseMove=function(a,b){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;var c=b.getX()-this.startX,d=b.getY()-this.startY,e=null;if(this.zoom)e=this.source.container,d=c/(e.clientWidth/e.clientHeight),e=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+c),Math.max(1,this.bounds.height+d)),this.selectionBorder.bounds=e,this.selectionBorder.redraw();else{var f=
this.outline.getView().scale,e=new mxRectangle(this.bounds.x+c,this.bounds.y+d,this.bounds.width,this.bounds.height);this.selectionBorder.bounds=e;this.selectionBorder.redraw();c=c/f*this.source.getView().scale;d=d/f*this.source.getView().scale;this.source.panGraph(-c-this.dx0,-d-this.dy0)}c=this.sizer.bounds;this.sizer.bounds=new mxRectangle(e.x+e.width-c.width/2,e.y+e.height-c.height/2,c.width,c.height);"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();b.consume()}};
mxOutline.prototype.mouseUp=function(a,b){if(this.active){var c=b.getX()-this.startX,d=b.getY()-this.startY;if(0<Math.abs(c)||0<Math.abs(d)){if(this.zoom){var d=this.selectionBorder.bounds.width,e=this.source.getView().scale;this.source.zoomTo(e-c*e/d,!1)}else if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container))this.source.panGraph(0,0),c/=this.outline.getView().scale,d/=this.outline.getView().scale,e=this.source.getView().translate,this.source.getView().setTranslate(e.x-
c,e.y-d);this.update();b.consume()}this.index=null;this.active=!1}};
mxOutline.prototype.destroy=function(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.source=null);null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null);null!=this.selectionBorder&&(this.selectionBorder.destroy(),
this.selectionBorder=null);null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)};function mxMultiplicity(a,b,c,d,e,f,g,h,k,l){this.source=a;this.type=b;this.attr=c;this.value=d;this.min=null!=e?e:0;this.max=null!=f?f:"n";this.validNeighbors=g;this.countError=mxResources.get(h)||h;this.typeError=mxResources.get(k)||k;this.validNeighborsAllowed=null!=l?l:!0}mxMultiplicity.prototype.type=null;mxMultiplicity.prototype.attr=null;mxMultiplicity.prototype.value=null;mxMultiplicity.prototype.source=null;
mxMultiplicity.prototype.min=null;mxMultiplicity.prototype.max=null;mxMultiplicity.prototype.validNeighbors=null;mxMultiplicity.prototype.validNeighborsAllowed=!0;mxMultiplicity.prototype.countError=null;mxMultiplicity.prototype.typeError=null;
mxMultiplicity.prototype.check=function(a,b,c,d,e,f){var g="";if(this.source&&this.checkTerminal(a,c,b)||!this.source&&this.checkTerminal(a,d,b)){if(null!=this.countError&&(this.source&&(0==this.max||e>=this.max)||!this.source&&(0==this.max||f>=this.max)))g+=this.countError+"\n";null!=this.validNeighbors&&null!=this.typeError&&0<this.validNeighbors.length&&(this.checkNeighbors(a,b,c,d)||(g+=this.typeError+"\n"))}return 0<g.length?g:null};
mxMultiplicity.prototype.checkNeighbors=function(a,b,c,d){for(var b=a.model.getValue(c),d=a.model.getValue(d),c=!this.validNeighborsAllowed,e=this.validNeighbors,f=0;f<e.length;f++)if(this.source&&this.checkType(a,d,e[f])){c=this.validNeighborsAllowed;break}else if(!this.source&&this.checkType(a,b,e[f])){c=this.validNeighborsAllowed;break}return c};mxMultiplicity.prototype.checkTerminal=function(a,b){var c=a.model.getValue(b);return this.checkType(a,c,this.type,this.attr,this.value)};
mxMultiplicity.prototype.checkType=function(a,b,c,d,e){return null!=b?isNaN(b.nodeType)?b==c:mxUtils.isNode(b,c,d,e):!1};function mxLayoutManager(a){this.undoHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.beforeUndo(c.getProperty("edit"))});this.moveHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.cellsMoved(c.getProperty("cells"),c.getProperty("event"))});this.setGraph(a)}mxLayoutManager.prototype=new mxEventSource;mxLayoutManager.prototype.constructor=mxLayoutManager;
mxLayoutManager.prototype.graph=null;mxLayoutManager.prototype.bubbling=!0;mxLayoutManager.prototype.enabled=!0;mxLayoutManager.prototype.updateHandler=null;mxLayoutManager.prototype.moveHandler=null;mxLayoutManager.prototype.isEnabled=function(){return this.enabled};mxLayoutManager.prototype.setEnabled=function(a){this.enabled=a};mxLayoutManager.prototype.isBubbling=function(){return this.bubbling};mxLayoutManager.prototype.setBubbling=function(a){this.bubbling=a};
mxLayoutManager.prototype.getGraph=function(){return this.graph};mxLayoutManager.prototype.setGraph=function(a){if(null!=this.graph){var b=this.graph.getModel();b.removeListener(this.undoHandler);this.graph.removeListener(this.moveHandler)}this.graph=a;null!=this.graph&&(b=this.graph.getModel(),b.addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler))};mxLayoutManager.prototype.getLayout=function(){return null};
mxLayoutManager.prototype.beforeUndo=function(a){var a=this.getCellsForChanges(a.changes),b=this.getGraph().getModel();if(this.isBubbling())for(var c=b.getParents(a);0<c.length;)a=a.concat(c),c=b.getParents(c);this.layoutCells(mxUtils.sortCells(a,!1))};
mxLayoutManager.prototype.cellsMoved=function(a,b){if(null!=a&&null!=b)for(var c=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(b),mxEvent.getClientY(b)),d=this.getGraph().getModel(),e=0;e<a.length;e++){var f=this.getLayout(d.getParent(a[e]));null!=f&&f.moveCell(a[e],c.x,c.y)}};
mxLayoutManager.prototype.getCellsForChanges=function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d];if(e instanceof mxRootChange)return[];for(var e=this.getCellsForChange(e),f=0;f<e.length;f++)if(null!=e[f]){var g=mxCellPath.create(e[f]);null==c[g]&&(c[g]=e[f],b.push(e[f]))}}return b};
mxLayoutManager.prototype.getCellsForChange=function(a){var b=this.getGraph().getModel();return a instanceof mxChildChange?[a.child,a.previous,b.getParent(a.child)]:a instanceof mxTerminalChange||a instanceof mxGeometryChange?[a.cell,b.getParent(a.cell)]:[]};
mxLayoutManager.prototype.layoutCells=function(a){if(0<a.length){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=null,d=0;d<a.length;d++)a[d]!=b.getRoot()&&a[d]!=c&&(c=a[d],this.executeLayout(this.getLayout(c),c));this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",a))}finally{b.endUpdate()}}};mxLayoutManager.prototype.executeLayout=function(a,b){null!=a&&null!=b&&a.execute(b)};mxLayoutManager.prototype.destroy=function(){this.setGraph(null)};
function mxSpaceManager(a,b,c,d){this.resizeHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.cellsResized(b.getProperty("cells"))});this.foldHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.cellsResized(b.getProperty("cells"))});this.shiftRightwards=null!=b?b:!0;this.shiftDownwards=null!=c?c:!0;this.extendParents=null!=d?d:!0;this.setGraph(a)}mxSpaceManager.prototype=new mxEventSource;mxSpaceManager.prototype.constructor=mxSpaceManager;mxSpaceManager.prototype.graph=null;
mxSpaceManager.prototype.enabled=!0;mxSpaceManager.prototype.shiftRightwards=!0;mxSpaceManager.prototype.shiftDownwards=!0;mxSpaceManager.prototype.extendParents=!0;mxSpaceManager.prototype.resizeHandler=null;mxSpaceManager.prototype.foldHandler=null;mxSpaceManager.prototype.isCellIgnored=function(a){return!this.getGraph().getModel().isVertex(a)};mxSpaceManager.prototype.isCellShiftable=function(a){return this.getGraph().getModel().isVertex(a)&&this.getGraph().isCellMovable(a)};
mxSpaceManager.prototype.isEnabled=function(){return this.enabled};mxSpaceManager.prototype.setEnabled=function(a){this.enabled=a};mxSpaceManager.prototype.isShiftRightwards=function(){return this.shiftRightwards};mxSpaceManager.prototype.setShiftRightwards=function(a){this.shiftRightwards=a};mxSpaceManager.prototype.isShiftDownwards=function(){return this.shiftDownwards};mxSpaceManager.prototype.setShiftDownwards=function(a){this.shiftDownwards=a};mxSpaceManager.prototype.isExtendParents=function(){return this.extendParents};
mxSpaceManager.prototype.setExtendParents=function(a){this.extendParents=a};mxSpaceManager.prototype.getGraph=function(){return this.graph};mxSpaceManager.prototype.setGraph=function(a){null!=this.graph&&(this.graph.removeListener(this.resizeHandler),this.graph.removeListener(this.foldHandler));this.graph=a;null!=this.graph&&(this.graph.addListener(mxEvent.RESIZE_CELLS,this.resizeHandler),this.graph.addListener(mxEvent.FOLD_CELLS,this.foldHandler))};
mxSpaceManager.prototype.cellsResized=function(a){if(null!=a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)if(!this.isCellIgnored(a[c])){this.cellResized(a[c]);break}}finally{b.endUpdate()}}};
mxSpaceManager.prototype.cellResized=function(a){var b=this.getGraph(),c=b.getView(),d=b.getModel(),e=c.getState(a),f=c.getState(d.getParent(a));if(null!=e&&null!=f){var g=this.getCellsToShift(e),h=d.getGeometry(a);if(null!=g&&null!=h){var k=c.translate,l=c.scale,c=e.x-f.origin.x-k.x*l,f=e.y-f.origin.y-k.y*l,k=e.x+e.width,n=e.y+e.height,o=e.width-h.width*l+c-h.x*l,p=e.height-h.height*l+f-h.y*l,r=1-h.width*l/e.width,e=1-h.height*l/e.height;d.beginUpdate();try{for(h=0;h<g.length;h++)g[h]!=a&&this.isCellShiftable(g[h])&&
this.shiftCell(g[h],o,p,c,f,k,n,r,e,this.isExtendParents()&&b.isExtendParent(g[h]))}finally{d.endUpdate()}}}};
mxSpaceManager.prototype.shiftCell=function(a,b,c,d,e,f,g,h,k,l){var d=this.getGraph(),n=d.getView().getState(a);if(null!=n){var o=d.getModel(),p=o.getGeometry(a);if(null!=p){o.beginUpdate();try{if(this.isShiftRightwards())if(n.x>=f)p=p.clone(),p.translate(-b,0);else{var r=Math.max(0,n.x-x0),p=p.clone();p.translate(-h*r,0)}if(this.isShiftDownwards())if(n.y>=g)p=p.clone(),p.translate(0,-c);else{var s=Math.max(0,n.y-e),p=p.clone();p.translate(0,-k*s)}p!=o.getGeometry(a)&&(o.setGeometry(a,p),l&&d.extendParent(a))}finally{o.endUpdate()}}}};
mxSpaceManager.prototype.getCellsToShift=function(a){var b=this.getGraph(),c=b.getModel().getParent(a.cell),d=this.isShiftDownwards(),e=this.isShiftRightwards();return b.getCellsBeyond(a.x+(d?0:a.width),a.y+(d&&e?0:a.height),c,e,d)};mxSpaceManager.prototype.destroy=function(){this.setGraph(null)};
function mxSwimlaneManager(a,b,c,d){this.horizontal=null!=b?b:!0;this.addEnabled=null!=c?c:!0;this.resizeEnabled=null!=d?d:!0;this.addHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(b.getProperty("cells"))});this.resizeHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(b.getProperty("cells"))});this.setGraph(a)}mxSwimlaneManager.prototype=new mxEventSource;mxSwimlaneManager.prototype.constructor=mxSwimlaneManager;
mxSwimlaneManager.prototype.graph=null;mxSwimlaneManager.prototype.enabled=!0;mxSwimlaneManager.prototype.horizontal=!0;mxSwimlaneManager.prototype.addEnabled=!0;mxSwimlaneManager.prototype.resizeEnabled=!0;mxSwimlaneManager.prototype.addHandler=null;mxSwimlaneManager.prototype.resizeHandler=null;mxSwimlaneManager.prototype.isEnabled=function(){return this.enabled};mxSwimlaneManager.prototype.setEnabled=function(a){this.enabled=a};mxSwimlaneManager.prototype.isHorizontal=function(){return this.horizontal};
mxSwimlaneManager.prototype.setHorizontal=function(a){this.horizontal=a};mxSwimlaneManager.prototype.isAddEnabled=function(){return this.addEnabled};mxSwimlaneManager.prototype.setAddEnabled=function(a){this.addEnabled=a};mxSwimlaneManager.prototype.isResizeEnabled=function(){return this.resizeEnabled};mxSwimlaneManager.prototype.setResizeEnabled=function(a){this.resizeEnabled=a};mxSwimlaneManager.prototype.getGraph=function(){return this.graph};
mxSwimlaneManager.prototype.setGraph=function(a){null!=this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler));this.graph=a;null!=this.graph&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))};mxSwimlaneManager.prototype.isSwimlaneIgnored=function(a){return!this.getGraph().isSwimlane(a)};
mxSwimlaneManager.prototype.isCellHorizontal=function(a){if(this.graph.isSwimlane(a)){var b=this.graph.view.getState(a),a=null!=b?b.style:this.graph.getCellStyle(a);return 1==mxUtils.getValue(a,mxConstants.STYLE_HORIZONTAL,1)}return!this.isHorizontal()};mxSwimlaneManager.prototype.cellsAdded=function(a){if(null!=a){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)this.isSwimlaneIgnored(a[c])||this.swimlaneAdded(a[c])}finally{b.endUpdate()}}};
mxSwimlaneManager.prototype.swimlaneAdded=function(a){for(var b=this.getGraph().getModel(),c=b.getParent(a),d=b.getChildCount(c),e=null,f=0;f<d;f++){var g=b.getChildAt(c,f);if(g!=a&&!this.isSwimlaneIgnored(g)&&(e=b.getGeometry(g),null!=e))break}null!=e&&this.resizeSwimlane(a,e.width,e.height)};
mxSwimlaneManager.prototype.cellsResized=function(a){if(null!=a){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)if(!this.isSwimlaneIgnored(a[c])){var d=b.getGeometry(a[c]);if(null!=d){for(var e=new mxRectangle(0,0,d.width,d.height),f=a[c],g=f;null!=g;){var f=g,g=b.getParent(g),h=this.graph.isSwimlane(g)?this.graph.getStartSize(g):new mxRectangle;e.width+=h.width;e.height+=h.height}this.resizeSwimlane(f,e.width,e.height)}}}finally{b.endUpdate()}}};
mxSwimlaneManager.prototype.resizeSwimlane=function(a,b,c){var d=this.getGraph().getModel();d.beginUpdate();try{if(!this.isSwimlaneIgnored(a)){var e=d.getGeometry(a);if(null!=e){var f=this.isCellHorizontal(a);if(f&&e.height!=c||!f&&e.width!=b)e=e.clone(),f?e.height=c:e.width=b,d.setGeometry(a,e)}}for(var g=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle,b=b-g.width,c=c-g.height,h=d.getChildCount(a),e=0;e<h;e++)this.resizeSwimlane(d.getChildAt(a,e),b,c)}finally{d.endUpdate()}};
mxSwimlaneManager.prototype.destroy=function(){this.setGraph(null)};function mxTemporaryCellStates(a,b,c){this.view=a;b=null!=b?b:1;this.oldBounds=a.getGraphBounds();this.oldStates=a.getStates();this.oldScale=a.getScale();a.setStates(new mxDictionary);a.setScale(b);if(null!=c){for(var b=a.createState(new mxCell),d=0;d<c.length;d++)a.validateBounds(b,c[d]);for(var e=null,d=0;d<c.length;d++){var f=a.validatePoints(b,c[d]);null==e?e=f:e.add(f)}null==e&&(e=new mxRectangle);a.setGraphBounds(e)}}
mxTemporaryCellStates.prototype.view=null;mxTemporaryCellStates.prototype.oldStates=null;mxTemporaryCellStates.prototype.oldBounds=null;mxTemporaryCellStates.prototype.oldScale=null;mxTemporaryCellStates.prototype.destroy=function(){this.view.setScale(this.oldScale);this.view.setStates(this.oldStates);this.view.setGraphBounds(this.oldBounds)};function mxCellStatePreview(a){this.graph=a;this.deltas={}}mxCellStatePreview.prototype.graph=null;mxCellStatePreview.prototype.deltas=null;
mxCellStatePreview.prototype.count=0;mxCellStatePreview.prototype.isEmpty=function(){return 0==this.count};mxCellStatePreview.prototype.moveState=function(a,b,c,d,e){var d=null!=d?d:!0,e=null!=e?e:!0,f=mxCellPath.create(a.cell),g=this.deltas[f];null==g?(g=new mxPoint(b,c),this.deltas[f]=g,this.count++):d?(g.X+=b,g.Y+=c):(g.X=b,g.Y=c);e&&this.addEdges(a);return g};
mxCellStatePreview.prototype.show=function(a){var b=this.graph.getModel(),c=b.getRoot(),d;for(d in this.deltas){var e=mxCellPath.resolve(c,d),f=this.graph.view.getState(e),g=this.deltas[d],e=this.graph.view.getState(b.getParent(e));this.translateState(e,f,g.x,g.y)}for(d in this.deltas)e=mxCellPath.resolve(c,d),f=this.graph.view.getState(e),g=this.deltas[d],e=this.graph.view.getState(b.getParent(e)),this.revalidateState(e,f,g.x,g.y,a)};
mxCellStatePreview.prototype.translateState=function(a,b,c,d){if(null!=b){var e=this.graph.getModel();if(e.isVertex(b.cell)){b.invalid=!0;this.graph.view.validateBounds(a,b.cell);var a=e.getGeometry(b.cell),f=mxCellPath.create(b.cell);if((0!=c||0!=d)&&null!=a&&(!a.relative||null!=this.deltas[f]))b.x+=c,b.y+=d}a=e.getChildCount(b.cell);for(f=0;f<a;f++)this.translateState(b,this.graph.view.getState(e.getChildAt(b.cell,f)),c,d)}};
mxCellStatePreview.prototype.revalidateState=function(a,b,c,d,e){if(null!=b){b.invalid=!0;this.graph.view.validatePoints(a,b.cell);var f=mxCellPath.create(b.cell),g=this.graph.getModel(),h=this.graph.getCellGeometry(b.cell);if((0!=c||0!=d)&&null!=h&&h.relative&&g.isVertex(b.cell)&&(null==a||g.isVertex(a.cell)||null!=this.deltas[f]))b.x+=c,b.y+=d,this.graph.cellRenderer.redraw(b);null!=e&&e(b);a=g.getChildCount(b.cell);for(f=0;f<a;f++)this.revalidateState(b,this.graph.view.getState(g.getChildAt(b.cell,
f)),c,d,e)}};mxCellStatePreview.prototype.addEdges=function(a){for(var b=this.graph.getModel(),c=b.getEdgeCount(a.cell),d=0;d<c;d++){var e=this.graph.view.getState(b.getEdgeAt(a.cell,d));null!=e&&this.moveState(e,0,0)}};function mxConnectionConstraint(a,b){this.point=a;this.perimeter=null!=b?b:!0}mxConnectionConstraint.prototype.point=null;mxConnectionConstraint.prototype.perimeter=null;
function mxGraphHandler(a){this.graph=a;this.graph.addMouseListener(this);this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape()});this.graph.addListener(mxEvent.PAN,this.panHandler)}mxGraphHandler.prototype.graph=null;mxGraphHandler.prototype.maxCells=mxClient.IS_IE?20:50;mxGraphHandler.prototype.enabled=!0;mxGraphHandler.prototype.highlightEnabled=!0;mxGraphHandler.prototype.cloneEnabled=!0;mxGraphHandler.prototype.moveEnabled=!0;mxGraphHandler.prototype.guidesEnabled=!1;
mxGraphHandler.prototype.guide=null;mxGraphHandler.prototype.currentDx=null;mxGraphHandler.prototype.currentDy=null;mxGraphHandler.prototype.updateCursor=!0;mxGraphHandler.prototype.selectEnabled=!0;mxGraphHandler.prototype.removeCellsFromParent=!0;mxGraphHandler.prototype.connectOnDrop=!1;mxGraphHandler.prototype.scrollOnMove=!0;mxGraphHandler.prototype.minimumSize=6;mxGraphHandler.prototype.previewColor="black";mxGraphHandler.prototype.htmlPreview=!1;mxGraphHandler.prototype.shape=null;
mxGraphHandler.prototype.scaleGrid=!1;mxGraphHandler.prototype.crisp=!0;mxGraphHandler.prototype.isEnabled=function(){return this.enabled};mxGraphHandler.prototype.setEnabled=function(a){this.enabled=a};mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled};mxGraphHandler.prototype.setCloneEnabled=function(a){this.cloneEnabled=a};mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled};mxGraphHandler.prototype.setMoveEnabled=function(a){this.moveEnabled=a};
mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled};mxGraphHandler.prototype.setSelectEnabled=function(a){this.selectEnabled=a};mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent};mxGraphHandler.prototype.setRemoveCellsFromParent=function(a){this.removeCellsFromParent=a};mxGraphHandler.prototype.getInitialCellForEvent=function(a){return a.getCell()};mxGraphHandler.prototype.isDelayedSelection=function(a){return this.graph.isCellSelected(a)};
mxGraphHandler.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&!this.graph.isForceMarqueeEvent(b.getEvent())&&null!=b.getState()){var c=this.getInitialCellForEvent(b);this.cell=null;this.delayedSelection=this.isDelayedSelection(c);this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(c,b.getEvent());if(this.isMoveEnabled()){var d=this.graph.model,e=d.getGeometry(c);this.graph.isCellMovable(c)&&(!d.isEdge(c)||1<this.graph.getSelectionCount()||
null!=e.points&&0<e.points.length||null==d.getTerminal(c,!0)||null==d.getTerminal(c,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(b.getEvent())&&this.graph.isCellsCloneable())&&this.start(c,b.getX(),b.getY());this.cellWasClicked=!0;!mxClient.IS_SF&&!mxClient.IS_GC||"SELECT"!=b.getSource().nodeName?b.consume():mxClient.IS_SF&&"SELECT"==b.getSource().nodeName&&(this.cellWasClicked=!1,this.first=null)}}};
mxGraphHandler.prototype.getGuideStates=function(){var a=this.graph.getDefaultParent(),b=this.graph.getModel(),c=mxUtils.bind(this,function(a){return null!=this.graph.view.getState(a)&&b.isVertex(a)&&null!=b.getGeometry(a)&&!b.getGeometry(a).relative});return this.graph.view.getCellStates(b.filterDescendants(c,a))};mxGraphHandler.prototype.getCells=function(a){return!this.delayedSelection&&this.graph.isCellMovable(a)?[a]:this.graph.getMovableCells(this.graph.getSelectionCells())};
mxGraphHandler.prototype.getPreviewBounds=function(a){a=this.graph.getView().getBounds(a);null!=a&&(a.width<this.minimumSize&&(a.x-=(this.minimumSize-a.width)/2,a.width=this.minimumSize),a.height<this.minimumSize&&(a.y-=(this.minimumSize-a.height)/2,a.height=this.minimumSize));return a};
mxGraphHandler.prototype.createPreviewShape=function(a){a=new mxRectangleShape(a,null,this.previewColor);a.isDashed=!0;a.crisp=this.crisp;this.htmlPreview?(a.dialect=mxConstants.DIALECT_STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,a.init(this.graph.getView().getOverlayPane()),a.dialect==mxConstants.DIALECT_SVG?a.node.setAttribute("style","pointer-events:none;"):a.node.style.background="");return a};
mxGraphHandler.prototype.start=function(a,b,c){this.cell=a;this.first=mxUtils.convertPoint(this.graph.container,b,c);this.cells=this.getCells(this.cell);this.bounds=this.getPreviewBounds(this.cells);this.guidesEnabled&&(this.guide=new mxGuide(this.graph,this.getGuideStates()))};mxGraphHandler.prototype.useGuidesForEvent=function(a){return null!=this.guide?this.guide.isEnabledForEvent(a.getEvent()):!0};
mxGraphHandler.prototype.snap=function(a){var b=this.scaleGrid?this.graph.view.scale:1;a.x=this.graph.snap(a.x/b)*b;a.y=this.graph.snap(a.y/b)*b;return a};
mxGraphHandler.prototype.mouseMove=function(a,b){var c=this.graph;if(!b.isConsumed()&&c.isMouseDown&&null!=this.cell&&null!=this.first&&null!=this.bounds){var d=mxUtils.convertPoint(c.container,b.getX(),b.getY()),e=d.x-this.first.x,f=d.y-this.first.y,d=c.tolerance;if(null!=this.shape||Math.abs(e)>d||Math.abs(f)>d){null==this.highlight&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3));null==this.shape&&(this.shape=this.createPreviewShape(this.bounds));var g=c.isGridEnabledEvent(b.getEvent()),
d=!0;if(null!=this.guide&&this.useGuidesForEvent(b))f=this.guide.move(this.bounds,new mxPoint(e,f),g),d=!1,e=f.x,f=f.y;else if(g)var h=c.getView().translate,k=c.getView().scale,g=this.bounds.x-(c.snap(this.bounds.x/k-h.x)+h.x)*k,h=this.bounds.y-(c.snap(this.bounds.y/k-h.y)+h.y)*k,f=this.snap(new mxPoint(e,f)),e=f.x-g,f=f.y-h;null!=this.guide&&d&&this.guide.hide();c.isConstrainedEvent(b.getEvent())&&(Math.abs(e)>Math.abs(f)?f=0:e=0);this.currentDx=e;this.currentDy=f;this.updatePreviewShape();e=null;
d=b.getCell();c.isDropEnabled()&&this.highlightEnabled&&(e=c.getDropTarget(this.cells,b.getEvent(),d));f=e;for(g=c.getModel();null!=f&&f!=this.cells[0];)f=g.getParent(f);var h=c.isCloneEvent(b.getEvent())&&c.isCellsCloneable()&&this.isCloneEnabled(),k=c.getView().getState(e),l=!1;null!=k&&null==f&&(g.getParent(this.cell)!=e||h)?(this.target!=e&&(this.target=e,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),l=!0):(this.target=null,this.connectOnDrop&&null!=d&&1==this.cells.length&&c.getModel().isVertex(d)&&
c.isCellConnectable(d)&&(k=c.getView().getState(d),null!=k&&(this.setHighlightColor(null==c.getEdgeValidationError(null,this.cell,d)?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR),l=!0)));null!=k&&l?this.highlight.highlight(k):this.highlight.hide()}b.consume();mxEvent.consume(b.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!b.isConsumed()&&null!=b.getState()&&!c.isMouseDown)e=c.getCursorForCell(b.getCell()),null==e&&c.isEnabled()&&c.isCellMovable(b.getCell())&&
(e=c.getModel().isEdge(b.getCell())?mxConstants.CURSOR_MOVABLE_EDGE:mxConstants.CURSOR_MOVABLE_VERTEX),b.getState().setCursor(e),b.consume()};mxGraphHandler.prototype.updatePreviewShape=function(){null!=this.shape&&(this.shape.bounds=new mxRectangle(this.bounds.x+this.currentDx-this.graph.panDx,this.bounds.y+this.currentDy-this.graph.panDy,this.bounds.width,this.bounds.height),this.shape.redraw())};mxGraphHandler.prototype.setHighlightColor=function(a){null!=this.highlight&&this.highlight.setHighlightColor(a)};
mxGraphHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()){var c=this.graph;if(null!=this.cell&&null!=this.first&&null!=this.shape&&null!=this.currentDx&&null!=this.currentDy){var d=c.getView().scale,e=c.isCloneEvent(b.getEvent())&&c.isCellsCloneable()&&this.isCloneEnabled(),f=this.currentDx/d,d=this.currentDy/d,g=b.getCell();this.connectOnDrop&&null==this.target&&null!=g&&c.getModel().isVertex(g)&&c.isCellConnectable(g)&&c.isEdgeValid(null,this.cell,g)?c.connectionHandler.connect(this.cell,
g,b.getEvent()):(g=this.target,c.isSplitEnabled()&&c.isSplitTarget(g,this.cells,b.getEvent())?c.splitEdge(g,this.cells,null,f,d):this.moveCells(this.cells,f,d,e,this.target,b.getEvent()))}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(b)}this.cellWasClicked&&b.consume();this.reset()};mxGraphHandler.prototype.selectDelayed=function(a){this.graph.selectCellForEvent(this.cell,a.getEvent())};
mxGraphHandler.prototype.reset=function(){this.destroyShapes();this.delayedSelection=this.cellWasClicked=!1;this.target=this.cell=this.first=this.guides=this.currentDy=this.currentDx=null};mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(a,b,c){return this.graph.getModel().isVertex(a)?(a=this.graph.getView().getState(a),c=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(c),mxEvent.getClientY(c)),null!=a&&!mxUtils.contains(a,c.x,c.y)):!1};
mxGraphHandler.prototype.moveCells=function(a,b,c,d,e,f){d&&(a=this.graph.getCloneableCells(a));null==e&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),a,f)&&(e=this.graph.getDefaultParent());a=this.graph.moveCells(a,b-this.graph.panDx/this.graph.view.scale,c-this.graph.panDy/this.graph.view.scale,d,e,f);this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(a[0]);d&&this.graph.setSelectionCells(a)};
mxGraphHandler.prototype.destroyShapes=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.guide&&(this.guide.destroy(),this.guide=null);null!=this.highlight&&(this.highlight.destroy(),this.highlight=null)};mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.panHandler);this.destroyShapes()};
function mxPanningHandler(a,b){null!=a&&(this.graph=a,this.factoryMethod=b,this.graph.addMouseListener(this),this.init())}mxPanningHandler.prototype=new mxPopupMenu;mxPanningHandler.prototype.constructor=mxPanningHandler;mxPanningHandler.prototype.graph=null;mxPanningHandler.prototype.usePopupTrigger=!0;mxPanningHandler.prototype.useLeftButtonForPanning=!1;mxPanningHandler.prototype.selectOnPopup=!0;mxPanningHandler.prototype.clearSelectionOnBackground=!0;mxPanningHandler.prototype.ignoreCell=!1;
mxPanningHandler.prototype.previewEnabled=!0;mxPanningHandler.prototype.useGrid=!1;mxPanningHandler.prototype.panningEnabled=!0;mxPanningHandler.prototype.isPanningEnabled=function(){return this.panningEnabled};mxPanningHandler.prototype.setPanningEnabled=function(a){this.panningEnabled=a};mxPanningHandler.prototype.init=function(){mxPopupMenu.prototype.init.apply(this);mxEvent.addListener(this.div,mxClient.IS_TOUCH?"touchmove":"mousemove",mxUtils.bind(this,function(){this.graph.tooltipHandler.hide()}))};
mxPanningHandler.prototype.isPanningTrigger=function(a){var b=a.getEvent();return this.useLeftButtonForPanning&&(this.ignoreCell||null==a.getState())&&mxEvent.isLeftMouseButton(b)||mxEvent.isControlDown(b)&&mxEvent.isShiftDown(b)||this.usePopupTrigger&&mxEvent.isPopupTrigger(b)};
mxPanningHandler.prototype.mouseDown=function(a,b){!b.isConsumed()&&this.isEnabled()&&(this.hideMenu(),this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.popupTrigger=this.isPopupTrigger(b),this.panningTrigger=this.isPanningEnabled()&&this.isPanningTrigger(b),this.startX=b.getX(),this.startY=b.getY(),this.panningTrigger&&this.consumePanningTrigger(b))};mxPanningHandler.prototype.consumePanningTrigger=function(a){a.consume()};
mxPanningHandler.prototype.mouseMove=function(a,b){var c=b.getX()-this.startX,d=b.getY()-this.startY;if(this.active)this.previewEnabled&&(this.useGrid&&(c=this.graph.snap(c),d=this.graph.snap(d)),this.graph.panGraph(c+this.dx0,d+this.dy0)),this.fireEvent(new mxEventObject(mxEvent.PAN,"event",b)),b.consume();else if(this.panningTrigger){var e=this.active;this.active=Math.abs(c)>this.graph.tolerance||Math.abs(d)>this.graph.tolerance;!e&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,
"event",b))}};
mxPanningHandler.prototype.mouseUp=function(a,b){var c=Math.abs(b.getX()-this.startX),d=Math.abs(b.getY()-this.startY);if(this.active){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){c=b.getX()-this.startX;d=b.getY()-this.startY;this.useGrid&&(c=this.graph.snap(c),d=this.graph.snap(d));var e=this.graph.getView().scale,f=this.graph.getView().translate;this.graph.panGraph(0,0);this.panGraph(f.x+c/e,f.y+d/e)}this.active=!1;this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",
b));b.consume()}else this.popupTrigger&&c<this.graph.tolerance&&d<this.graph.tolerance&&(c=this.getCellForPopupEvent(b),this.graph.isEnabled()&&this.selectOnPopup&&null!=c&&!this.graph.isCellSelected(c)?this.graph.setSelectionCell(c):this.clearSelectionOnBackground&&null==c&&this.graph.clearSelection(),this.graph.tooltipHandler.hide(),d=mxUtils.getScrollOrigin(),d=new mxPoint(b.getX()+d.x,b.getY()+d.y),this.popup(d.x+1,d.y+1,c,b.getEvent()),b.consume());this.popupTrigger=this.panningTrigger=!1};
mxPanningHandler.prototype.getCellForPopupEvent=function(a){return a.getCell()};mxPanningHandler.prototype.panGraph=function(a,b){this.graph.getView().setTranslate(a,b)};mxPanningHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);mxPopupMenu.prototype.destroy.apply(this)};
function mxCellMarker(a,b,c,d){null!=a&&(this.graph=a,this.validColor=null!=b?b:mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=null!=b?c:mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=null!=d?d:mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(a))}mxCellMarker.prototype=new mxEventSource;mxCellMarker.prototype.constructor=mxCellMarker;mxCellMarker.prototype.graph=null;mxCellMarker.prototype.enabled=!0;mxCellMarker.prototype.hotspot=mxConstants.DEFAULT_HOTSPOT;
mxCellMarker.prototype.hotspotEnabled=!1;mxCellMarker.prototype.validColor=null;mxCellMarker.prototype.invalidColor=null;mxCellMarker.prototype.currentColor=null;mxCellMarker.prototype.validState=null;mxCellMarker.prototype.markedState=null;mxCellMarker.prototype.setEnabled=function(a){this.enabled=a};mxCellMarker.prototype.isEnabled=function(){return this.enabled};mxCellMarker.prototype.setHotspot=function(a){this.hotspot=a};mxCellMarker.prototype.getHotspot=function(){return this.hotspot};
mxCellMarker.prototype.setHotspotEnabled=function(a){this.hotspotEnabled=a};mxCellMarker.prototype.isHotspotEnabled=function(){return this.hotspotEnabled};mxCellMarker.prototype.hasValidState=function(){return null!=this.validState};mxCellMarker.prototype.getValidState=function(){return this.validState};mxCellMarker.prototype.getMarkedState=function(){return this.markedState};mxCellMarker.prototype.reset=function(){this.validState=null;null!=this.markedState&&(this.markedState=null,this.unmark())};
mxCellMarker.prototype.process=function(a){var b=null;if(this.isEnabled()){var b=this.getState(a),c=null!=b?this.isValidState(b):!1,a=this.getMarkerColor(a.getEvent(),b,c);this.validState=c?b:null;if(b!=this.markedState||a!=this.currentColor)this.currentColor=a,null!=b&&null!=this.currentColor?(this.markedState=b,this.mark()):null!=this.markedState&&(this.markedState=null,this.unmark())}return b};
mxCellMarker.prototype.markCell=function(a,b){var c=this.graph.getView().getState(a);null!=c&&(this.currentColor=null!=b?b:this.validColor,this.markedState=c,this.mark())};mxCellMarker.prototype.mark=function(){this.highlight.setHighlightColor(this.currentColor);this.highlight.highlight(this.markedState);this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))};mxCellMarker.prototype.unmark=function(){this.mark()};mxCellMarker.prototype.isValidState=function(){return!0};
mxCellMarker.prototype.getMarkerColor=function(a,b,c){return c?this.validColor:this.invalidColor};mxCellMarker.prototype.getState=function(a){var b=this.graph.getView();cell=this.getCell(a);b=this.getStateToMark(b.getState(cell));return null!=b&&this.intersects(b,a)?b:null};mxCellMarker.prototype.getCell=function(a){return a.getCell()};mxCellMarker.prototype.getStateToMark=function(a){return a};
mxCellMarker.prototype.intersects=function(a,b){return this.hotspotEnabled?mxUtils.intersectsHotspot(a,b.getGraphX(),b.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE):!0};mxCellMarker.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);this.highlight.destroy()};
function mxSelectionCellsHandler(a){this.graph=a;this.handlers=new mxDictionary;this.graph.addMouseListener(this);this.refreshHandler=mxUtils.bind(this,function(){this.isEnabled()&&this.refresh()});this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,
this.refreshHandler);this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler);this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}mxSelectionCellsHandler.prototype=new mxEventSource;mxSelectionCellsHandler.prototype.constructor=mxSelectionCellsHandler;mxSelectionCellsHandler.prototype.graph=null;mxSelectionCellsHandler.prototype.enabled=!0;mxSelectionCellsHandler.prototype.refreshHandler=null;mxSelectionCellsHandler.prototype.maxHandlers=100;
mxSelectionCellsHandler.prototype.handlers=null;mxSelectionCellsHandler.prototype.isEnabled=function(){return this.enabled};mxSelectionCellsHandler.prototype.setEnabled=function(a){this.enabled=a};mxSelectionCellsHandler.prototype.getHandler=function(a){return this.handlers.get(a)};mxSelectionCellsHandler.prototype.reset=function(){this.handlers.visit(function(a,b){b.reset.apply(b)})};
mxSelectionCellsHandler.prototype.refresh=function(){var a=this.handlers;this.handlers=new mxDictionary;for(var b=this.graph.getSelectionCells(),c=0;c<b.length;c++){var d=this.graph.view.getState(b[c]);if(null!=d){var e=a.remove(b[c]);null!=e&&(e.state!=d?(e.destroy(),e=null):e.redraw());null==e&&(e=this.graph.createHandler(d),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",d)));null!=e&&this.handlers.put(b[c],e)}}a.visit(mxUtils.bind(this,function(a,b){this.fireEvent(new mxEventObject(mxEvent.REMOVE,
"state",b.state));b.destroy()}))};mxSelectionCellsHandler.prototype.mouseDown=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseDown.apply(b,c)})}};mxSelectionCellsHandler.prototype.mouseMove=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseMove.apply(b,c)})}};
mxSelectionCellsHandler.prototype.mouseUp=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseUp.apply(b,c)})}};mxSelectionCellsHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.refreshHandler&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)};
function mxConnectionHandler(a,b){null!=a&&(this.graph=a,this.factoryMethod=b,this.init())}mxConnectionHandler.prototype=new mxEventSource;mxConnectionHandler.prototype.constructor=mxConnectionHandler;mxConnectionHandler.prototype.graph=null;mxConnectionHandler.prototype.factoryMethod=!0;mxConnectionHandler.prototype.moveIconFront=!1;mxConnectionHandler.prototype.moveIconBack=!1;mxConnectionHandler.prototype.connectImage=null;mxConnectionHandler.prototype.targetConnectImage=!1;
mxConnectionHandler.prototype.enabled=!0;mxConnectionHandler.prototype.select=!0;mxConnectionHandler.prototype.createTarget=!1;mxConnectionHandler.prototype.marker=null;mxConnectionHandler.prototype.constraintHandler=null;mxConnectionHandler.prototype.error=null;mxConnectionHandler.prototype.waypointsEnabled=!1;mxConnectionHandler.prototype.tapAndHoldEnabled=!0;mxConnectionHandler.prototype.tapAndHoldDelay=500;mxConnectionHandler.prototype.tapAndHoldInProgress=!1;
mxConnectionHandler.prototype.tapAndHoldValid=!1;mxConnectionHandler.prototype.tapAndHoldTolerance=4;mxConnectionHandler.prototype.initialTouchX=0;mxConnectionHandler.prototype.initialTouchY=0;mxConnectionHandler.prototype.ignoreMouseDown=!1;mxConnectionHandler.prototype.first=null;mxConnectionHandler.prototype.connectIconOffset=new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET);mxConnectionHandler.prototype.edgeState=null;mxConnectionHandler.prototype.changeHandler=null;
mxConnectionHandler.prototype.drillHandler=null;mxConnectionHandler.prototype.mouseDownCounter=0;mxConnectionHandler.prototype.movePreviewAway=mxClient.IS_VML;mxConnectionHandler.prototype.isEnabled=function(){return this.enabled};mxConnectionHandler.prototype.setEnabled=function(a){this.enabled=a};mxConnectionHandler.prototype.isCreateTarget=function(){return this.createTarget};mxConnectionHandler.prototype.setCreateTarget=function(a){this.createTarget=a};
mxConnectionHandler.prototype.createShape=function(){var a=new mxPolyline([],mxConstants.INVALID_COLOR);a.isDashed=!0;a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.init(this.graph.getView().getOverlayPane());if(this.graph.dialect==mxConstants.DIALECT_SVG)a.pipe.setAttribute("style","pointer-events:none;"),a.innerNode.setAttribute("style","pointer-events:none;");else{var b=mxUtils.bind(this,function(a){a=mxUtils.convertPoint(this.graph.container,
mxEvent.getClientX(a),mxEvent.getClientY(a));return this.graph.view.getState(this.graph.getCellAt(a.x,a.y))});mxEvent.redirectMouseEvents(a.node,this.graph,b)}return a};
mxConnectionHandler.prototype.init=function(){this.graph.addMouseListener(this);this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.changeHandler=mxUtils.bind(this,function(){null!=this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell));null!=this.iconState?this.redrawIcons(this.icons,this.iconState):(this.destroyIcons(this.icons),this.previous=null);this.constraintHandler.reset()});this.graph.getModel().addListener(mxEvent.CHANGE,
this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE,this.changeHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler);this.drillHandler=mxUtils.bind(this,function(){this.destroyIcons(this.icons)});this.graph.addListener(mxEvent.START_EDITING,this.drillHandler);this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler);this.graph.getView().addListener(mxEvent.UP,this.drillHandler)};
mxConnectionHandler.prototype.isConnectableCell=function(){return!0};
mxConnectionHandler.prototype.createMarker=function(){var a=new mxCellMarker(this.graph);a.hotspotEnabled=!0;a.getCell=mxUtils.bind(this,function(b,c){c=mxCellMarker.prototype.getCell.apply(a,arguments);this.error=null;if(!this.isConnectableCell(c))return null;null!=c?this.isConnecting()?null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,c),null!=this.error&&0==this.error.length&&(c=null,this.isCreateTarget()&&(this.error=null))):this.isValidSource(c)||(c=null):this.isConnecting()&&
!this.isCreateTarget()&&!this.graph.allowDanglingEdges&&(this.error="");return c});a.isValidState=mxUtils.bind(this,function(b){return this.isConnecting()?null==this.error:mxCellMarker.prototype.isValidState.apply(a,arguments)});a.getMarkerColor=mxUtils.bind(this,function(b,c,d){return null==this.connectImage||this.isConnecting()?mxCellMarker.prototype.getMarkerColor.apply(a,arguments):null});a.intersects=mxUtils.bind(this,function(b,c){return null!=this.connectImage||this.isConnecting()?!0:mxCellMarker.prototype.intersects.apply(a,
arguments)});return a};mxConnectionHandler.prototype.start=function(a,b,c,d){this.previous=a;this.first=new mxPoint(b,c);this.edgeState=null!=d?d:this.createEdgeState(null);this.marker.currentColor=this.marker.validColor;this.marker.markedState=a;this.marker.mark();this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))};mxConnectionHandler.prototype.isConnecting=function(){return null!=this.first&&null!=this.shape};mxConnectionHandler.prototype.isValidSource=function(a){return this.graph.isValidSource(a)};
mxConnectionHandler.prototype.isValidTarget=function(){return!0};mxConnectionHandler.prototype.validateConnection=function(a,b){return!this.isValidTarget(b)?"":this.graph.getEdgeValidationError(null,a,b)};mxConnectionHandler.prototype.getConnectImage=function(){return this.connectImage};mxConnectionHandler.prototype.isMoveIconToFrontForState=function(a){return null!=a.text&&a.text.node.parentNode==this.graph.container?!0:this.moveIconFront};
mxConnectionHandler.prototype.createIcons=function(a){var b=this.getConnectImage(a);if(null!=b&&null!=a){this.iconState=a;var c=[],d=new mxRectangle(0,0,b.width,b.height),e=new mxImageShape(d,b.src,null,null,0);e.preserveImageAspect=!1;this.isMoveIconToFrontForState(a)?(e.dialect=mxConstants.DIALECT_STRICTHTML,e.init(this.graph.container)):(e.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,e.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&
null!=e.node.previousSibling&&e.node.parentNode.insertBefore(e.node,e.node.parentNode.firstChild));e.node.style.cursor=mxConstants.CURSOR_CONNECT;var f=mxUtils.bind(this,function(){return null!=this.currentState?this.currentState:a}),b=mxUtils.bind(this,function(a){mxEvent.isConsumed(a)||(this.icon=e,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,f())))});mxEvent.redirectMouseEvents(e.node,this.graph,f,b);c.push(e);this.redrawIcons(c,this.iconState);return c}return null};
mxConnectionHandler.prototype.redrawIcons=function(a,b){if(null!=a&&null!=a[0]&&null!=b){var c=this.getIconPosition(a[0],b);a[0].bounds.x=c.x;a[0].bounds.y=c.y;a[0].redraw()}};mxConnectionHandler.prototype.getIconPosition=function(a,b){var c=this.graph.getView().scale,d=b.getCenterX(),e=b.getCenterY();if(this.graph.isSwimlane(b.cell))var f=this.graph.getStartSize(b.cell),d=0!=f.width?b.x+f.width*c/2:d,e=0!=f.height?b.y+f.height*c/2:e;return new mxPoint(d-a.bounds.width/2,e-a.bounds.height/2)};
mxConnectionHandler.prototype.destroyIcons=function(a){if(null!=a){this.iconState=null;for(var b=0;b<a.length;b++)a[b].destroy()}};mxConnectionHandler.prototype.isStartEvent=function(a){return!this.graph.isForceMarqueeEvent(a.getEvent())&&(null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint||null!=this.previous&&null==this.error&&(null==this.icons||null!=this.icons&&null!=this.icon))};
mxConnectionHandler.prototype.mouseDown=function(a,b){this.mouseDownCounter++;if(this.isEnabled()&&this.graph.isEnabled()&&!b.isConsumed()&&!this.isConnecting()&&this.isStartEvent(b))null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(b.getGraphX(),
b.getGraphY()),this.edgeState=this.createEdgeState(b),this.mouseDownCounter=1,this.waypointsEnabled&&null==this.shape&&(this.waypoints=null,this.shape=this.createShape()),null==this.previous&&null!=this.edgeState&&this.edgeState.cell.geometry.setTerminalPoint(this.graph.getPointForEvent(b.getEvent()),!0),this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous)),b.consume();else if(mxClient.IS_TOUCH&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress&&this.isEnabled()&&this.graph.isEnabled()&&
!this.isConnecting()){this.tapAndHoldInProgress=!0;this.initialTouchX=b.getX();this.initialTouchY=b.getY();var c=this.graph.view.getState(this.marker.getCell(b));this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread);this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,function(){this.tapAndHoldValid&&this.tapAndHold(b,c);this.tapAndHoldValid=this.tapAndHoldInProgress=!1}),this.tapAndHoldDelay);this.tapAndHoldValid=!0}this.selectedIcon=this.icon;this.icon=null};
mxConnectionHandler.prototype.tapAndHold=function(a,b){null!=b&&(this.marker.currentColor=this.marker.validColor,this.marker.markedState=b,this.marker.mark(),this.first=new mxPoint(a.getGraphX(),a.getGraphY()),this.edgeState=this.createEdgeState(a),this.previous=b,this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous)))};mxConnectionHandler.prototype.isImmediateConnectSource=function(a){return!this.graph.isCellMovable(a.cell)};mxConnectionHandler.prototype.createEdgeState=function(){return null};
mxConnectionHandler.prototype.updateCurrentState=function(a){var b=this.marker.process(a);this.constraintHandler.update(a,null==this.first);this.currentState=b};mxConnectionHandler.prototype.convertWaypoint=function(a){var b=this.graph.getView().getScale(),c=this.graph.getView().getTranslate();a.x=a.x/b-c.x;a.y=a.y/b-c.y};
mxConnectionHandler.prototype.mouseMove=function(a,b){this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-b.getX())<this.tapAndHoldTolerance&&Math.abs(this.initialTouchY-b.getY())<this.tapAndHoldTolerance);if(!b.isConsumed()&&(this.ignoreMouseDown||null!=this.first||!this.graph.isMouseDown)){!this.isEnabled()&&null!=this.currentState&&(this.destroyIcons(this.icons),this.currentState=null);(null!=this.first||this.isEnabled()&&this.graph.isEnabled())&&this.updateCurrentState(b);
if(null!=this.first){var c=this.graph.getView().scale,c=new mxPoint(this.graph.snap(b.getGraphX()/c)*c,this.graph.snap(b.getGraphY()/c)*c),d=null,e=c;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint&&(d=this.constraintHandler.currentConstraint,e=this.constraintHandler.currentPoint.clone());var f=this.first;if(null!=this.selectedIcon){var g=this.selectedIcon.bounds.width,h=this.selectedIcon.bounds.height;null!=this.currentState&&
this.targetConnectImage?(g=this.getIconPosition(this.selectedIcon,this.currentState),this.selectedIcon.bounds.x=g.x,this.selectedIcon.bounds.y=g.y):this.selectedIcon.bounds=new mxRectangle(b.getGraphX()+this.connectIconOffset.x,b.getGraphY()+this.connectIconOffset.y,g,h);this.selectedIcon.redraw()}if(null!=this.edgeState){this.edgeState.absolutePoints=[null,null!=this.currentState?null:e];this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint);null!=this.currentState&&
(null==d&&(d=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,d));f=null;if(null!=this.waypoints){f=[];for(e=0;e<this.waypoints.length;e++)d=this.waypoints[e].clone(),this.convertWaypoint(d),f[e]=d}this.graph.view.updatePoints(this.edgeState,f,this.previous,this.currentState);this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState);
e=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1];f=this.edgeState.absolutePoints[0]}else null!=this.currentState&&null==this.constraintHandler.currentConstraint&&(g=this.getTargetPerimeterPoint(this.currentState,b),null!=g&&(e=g)),null==this.sourceConstraint&&null!=this.previous&&(g=this.getSourcePerimeterPoint(this.previous,null!=this.waypoints&&0<this.waypoints.length?this.waypoints[0]:e,b),null!=g&&(f=g));if(null==this.currentState&&this.movePreviewAway){g=f;null!=this.edgeState&&
2<this.edgeState.absolutePoints.length&&(d=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2],null!=d&&(g=d));d=e.x-g.x;g=e.y-g.y;h=Math.sqrt(d*d+g*g);if(0==h)return;e.x-=4*d/h;e.y-=4*g/h}if(null==this.shape&&(d=Math.abs(c.x-this.first.x),g=Math.abs(c.y-this.first.y),d>this.graph.tolerance||g>this.graph.tolerance))this.shape=this.createShape(),this.updateCurrentState(b);null!=this.shape&&(null!=this.edgeState?this.shape.points=this.edgeState.absolutePoints:(c=[f],null!=this.waypoints&&
(c=c.concat(this.waypoints)),c.push(e),this.shape.points=c),this.drawPreview());mxEvent.consume(b.getEvent());b.consume()}else!this.isEnabled()||!this.graph.isEnabled()?this.constraintHandler.reset():this.previous!=this.currentState&&null==this.edgeState?(this.destroyIcons(this.icons),this.icons=null,null!=this.currentState&&null==this.error&&(this.icons=this.createIcons(this.currentState),null==this.icons&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),b.consume())),this.previous=this.currentState):
this.previous==this.currentState&&null!=this.currentState&&null==this.icons&&!this.graph.isMouseDown&&b.consume();null!=this.constraintHandler.currentConstraint&&this.marker.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){c=!1;f=b.getSource();for(e=0;e<this.icons.length&&!c;e++)c=f==this.icons[e].node||f.parentNode==this.icons[e].node;c||this.updateIcons(this.currentState,this.icons,b)}}else this.constraintHandler.reset()};
mxConnectionHandler.prototype.getTargetPerimeterPoint=function(a){var b=null,c=a.view,d=c.getPerimeterFunction(a);if(null!=d){var e=null!=this.waypoints&&0<this.waypoints.length?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),a=d(c.getPerimeterBounds(a),this.edgeState,e,!1);null!=a&&(b=a)}else b=new mxPoint(a.getCenterX(),a.getCenterY());return b};
mxConnectionHandler.prototype.getSourcePerimeterPoint=function(a,b){var c=null,d=a.view,e=d.getPerimeterFunction(a),f=new mxPoint(a.getCenterX(),a.getCenterY());if(null!=e){var g=mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0),h=-g*(Math.PI/180);0!=g&&(b=mxUtils.getRotatedPoint(new mxPoint(b.x,b.y),Math.cos(h),Math.sin(h),f));d=e(d.getPerimeterBounds(a),a,b,!1);null!=d&&(0!=g&&(d=mxUtils.getRotatedPoint(new mxPoint(d.x,d.y),Math.cos(-h),Math.sin(-h),f)),c=d)}else c=f;return c};
mxConnectionHandler.prototype.updateIcons=function(){};mxConnectionHandler.prototype.isStopEvent=function(a){return null!=a.getState()};
mxConnectionHandler.prototype.addWaypointForEvent=function(a){var b=mxUtils.convertPoint(this.graph.container,a.getX(),a.getY()),c=Math.abs(b.x-this.first.x),b=Math.abs(b.y-this.first.y);if(null!=this.waypoints||1<this.mouseDownCounter&&(c>this.graph.tolerance||b>this.graph.tolerance))null==this.waypoints&&(this.waypoints=[]),c=this.graph.view.scale,b=new mxPoint(this.graph.snap(a.getGraphX()/c)*c,this.graph.snap(a.getGraphY()/c)*c),this.waypoints.push(b)};
mxConnectionHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(b)){this.addWaypointForEvent(b);b.consume();return}if(null==this.error){var c=null!=this.previous?this.previous.cell:null,d=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(d=this.constraintHandler.currentFocus.cell);null==d&&this.marker.hasValidState()&&(d=this.marker.validState.cell);this.connect(c,d,b.getEvent(),
b.getCell())}else null!=this.previous&&null!=this.marker.validState&&this.previous.cell==this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.source,evt),0<this.error.length&&this.graph.validationAlert(this.error);this.destroyIcons(this.icons);b.consume()}null!=this.first&&this.reset();this.tapAndHoldValid=this.tapAndHoldInProgress=!1};
mxConnectionHandler.prototype.reset=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);this.destroyIcons(this.icons);this.icons=null;this.marker.reset();this.constraintHandler.reset();this.sourceConstraint=this.error=this.previous=this.edgeState=this.selectedIcon=null;this.mouseDownCounter=0;this.icon=this.first=null;this.fireEvent(new mxEventObject(mxEvent.RESET))};
mxConnectionHandler.prototype.drawPreview=function(){var a=null==this.error,b=this.getEdgeColor(a);this.shape.dialect==mxConstants.DIALECT_SVG?this.shape.innerNode.setAttribute("stroke",b):this.shape.node.strokecolor=b;this.shape.strokewidth=this.getEdgeWidth(a);this.shape.redraw();mxUtils.repaintGraph(this.graph,this.shape.points[1])};mxConnectionHandler.prototype.getEdgeColor=function(a){return a?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR};
mxConnectionHandler.prototype.getEdgeWidth=function(a){return a?3:1};
mxConnectionHandler.prototype.connect=function(a,b,c,d){if(null!=b||this.isCreateTarget()||this.graph.allowDanglingEdges){var e=this.graph.getModel(),f=null;e.beginUpdate();try{if(null!=a&&null==b&&this.isCreateTarget()&&(b=this.createTargetVertex(c,a),null!=b)){d=this.graph.getDropTarget([b],c,d);if(null==d||!this.graph.getModel().isEdge(d)){var g=this.graph.getView().getState(d);if(null!=g){var h=e.getGeometry(b);h.x-=g.origin.x;h.y-=g.origin.y}}else d=this.graph.getDefaultParent();this.graph.addCell(b,
d)}var k=this.graph.getDefaultParent();null!=a&&null!=b&&e.getParent(a)==e.getParent(b)&&e.getParent(e.getParent(a))!=e.getRoot()&&(k=e.getParent(a),null!=a.geometry&&a.geometry.relative&&null!=b.geometry&&b.geometry.relative&&(k=e.getParent(k)));h=g=null;null!=this.edgeState&&(g=this.edgeState.cell.value,h=this.edgeState.cell.style);f=this.insertEdge(k,null,g,a,b,h);if(null!=f){this.graph.setConnectionConstraint(f,a,!0,this.sourceConstraint);this.graph.setConnectionConstraint(f,b,!1,this.constraintHandler.currentConstraint);
null!=this.edgeState&&e.setGeometry(f,this.edgeState.cell.geometry);var l=e.getGeometry(f);null==l&&(l=new mxGeometry,l.relative=!0,e.setGeometry(f,l));if(null!=this.waypoints&&0<this.waypoints.length){var n=this.graph.view.scale,o=this.graph.view.translate;l.points=[];for(a=0;a<this.waypoints.length;a++){var p=this.waypoints[a];l.points.push(new mxPoint(p.x/n-o.x,p.y/n-o.y))}}null==b&&(p=this.graph.getPointForEvent(c,!1),p.x-=this.graph.panDx/this.graph.view.scale,p.y-=this.graph.panDy/this.graph.view.scale,
l.setTerminalPoint(p,!1));this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",f,"event",c,"target",d))}}catch(r){mxLog.show(),mxLog.debug(r.message)}finally{e.endUpdate()}this.select&&this.selectCells(f,b)}};mxConnectionHandler.prototype.selectCells=function(a){this.graph.setSelectionCell(a)};mxConnectionHandler.prototype.insertEdge=function(a,b,c,d,e,f){if(null==this.factoryMethod)return this.graph.insertEdge(a,b,c,d,e,f);b=this.createEdge(c,d,e,f);return b=this.graph.addEdge(b,a,d,e)};
mxConnectionHandler.prototype.createTargetVertex=function(a,b){for(var c=this.graph.getCellGeometry(b);null!=c&&c.relative;)b=this.graph.getModel().getParent(b),c=this.graph.getCellGeometry(b);var d=this.graph.cloneCells([b])[0],c=this.graph.getModel().getGeometry(d);if(null!=c){var e=this.graph.getPointForEvent(a);c.x=this.graph.snap(e.x-c.width/2)-this.graph.panDx/this.graph.view.scale;c.y=this.graph.snap(e.y-c.height/2)-this.graph.panDy/this.graph.view.scale;if(null!=this.first){var f=this.graph.view.getState(b);
if(null!=f){var g=this.getAlignmentTolerance();Math.abs(this.graph.snap(this.first.x)-this.graph.snap(e.x))<=g?c.x=f.x:Math.abs(this.graph.snap(this.first.y)-this.graph.snap(e.y))<=g&&(c.y=f.y)}}}return d};mxConnectionHandler.prototype.getAlignmentTolerance=function(){return this.graph.isGridEnabled()?this.graph.gridSize:this.graph.tolerance};
mxConnectionHandler.prototype.createEdge=function(a,b,c,d){var e=null;null!=this.factoryMethod&&(e=this.factoryMethod(b,c,d));null==e&&(e=new mxCell(a||""),e.setEdge(!0),e.setStyle(d),a=new mxGeometry,a.relative=!0,e.setGeometry(a));return e};
mxConnectionHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null);null!=this.drillHandler&&(this.graph.removeListener(this.drillHandler),
this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null)};function mxConstraintHandler(a){this.graph=a}mxConstraintHandler.prototype.pointImage=new mxImage(mxClient.imageBasePath+"/point.gif",5,5);mxConstraintHandler.prototype.graph=null;mxConstraintHandler.prototype.enabled=!0;mxConstraintHandler.prototype.highlightColor=mxConstants.DEFAULT_VALID_COLOR;mxConstraintHandler.prototype.isEnabled=function(){return this.enabled};
mxConstraintHandler.prototype.setEnabled=function(a){this.enabled=a};mxConstraintHandler.prototype.reset=function(){if(null!=this.focusIcons){for(var a=0;a<this.focusIcons.length;a++)this.focusIcons[a].destroy();this.focusIcons=null}null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null);this.focusPoints=this.currentFocus=this.currentPoint=this.currentFocusArea=this.currentConstraint=null};mxConstraintHandler.prototype.getTolerance=function(){return this.graph.getTolerance()};
mxConstraintHandler.prototype.getImageForConstraint=function(){return this.pointImage};mxConstraintHandler.prototype.isEventIgnored=function(){return!1};
mxConstraintHandler.prototype.update=function(a,b){if(this.isEnabled()&&!this.isEventIgnored(a)){var c=this.getTolerance(),d=new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*c),e=null!=a.getCell()?this.graph.isCellConnectable(a.getCell()):!1;if(null==this.currentFocusArea||!mxUtils.intersects(this.currentFocusArea,d)||null!=a.getState()&&null!=this.currentFocus&&e)if(this.currentFocusArea=null,a.getState()!=this.currentFocus)if(this.currentFocus=null,this.constraints=null!=a.getState()&&e?this.graph.getAllConnectionConstraints(a.getState(),
b):null,null!=this.constraints){this.currentFocus=a.getState();this.currentFocusArea=new mxRectangle(a.getState().x,a.getState().y,a.getState().width,a.getState().height);if(null!=this.focusIcons){for(e=0;e<this.focusIcons.length;e++)this.focusIcons[e].destroy();this.focusPoints=this.focusIcons=null}this.focusIcons=[];this.focusPoints=[];for(e=0;e<this.constraints.length;e++){var f=this.graph.getConnectionPoint(a.getState(),this.constraints[e]),g=this.getImageForConstraint(a.getState(),this.constraints[e],
f),h=g.src,g=new mxRectangle(f.x-g.width/2,f.y-g.height/2,g.width,g.height),g=new mxImageShape(g,h);g.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML;g.init(this.graph.getView().getOverlayPane());null!=g.node.previousSibling&&g.node.parentNode.insertBefore(g.node,g.node.parentNode.firstChild);h=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:a.getState()});g.redraw();mxEvent.redirectMouseEvents(g.node,this.graph,h);
this.currentFocusArea.add(g.bounds);this.focusIcons.push(g);this.focusPoints.push(f)}this.currentFocusArea.grow(c)}else if(null!=this.focusIcons){null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null);for(e=0;e<this.focusIcons.length;e++)this.focusIcons[e].destroy();this.focusPoints=this.focusIcons=null}this.currentPoint=this.currentConstraint=null;if(null!=this.focusIcons&&null!=this.constraints&&(null==a.getState()||this.currentFocus==a.getState()))for(e=0;e<this.focusIcons.length;e++)if(mxUtils.intersects(this.focusIcons[e].bounds,
d)){this.currentConstraint=this.constraints[e];this.currentPoint=this.focusPoints[e];c=this.focusIcons[e].bounds.clone();c.grow(mxClient.IS_IE?3:2);mxClient.IS_IE&&(c.width-=1,c.height-=1);null==this.focusHighlight?(c=new mxRectangleShape(c,null,this.highlightColor,3),c.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,c.init(this.graph.getView().getOverlayPane()),this.focusHighlight=c,h=mxUtils.bind(this,function(){return null!=this.currentFocus?
this.currentFocus:a.getState()}),mxEvent.redirectMouseEvents(c.node,this.graph,h)):(this.focusHighlight.bounds=c,this.focusHighlight.redraw());break}null==this.currentConstraint&&null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)}};mxConstraintHandler.prototype.destroy=function(){this.reset()};
function mxRubberband(a){null!=a&&(this.graph=a,this.graph.addMouseListener(this),this.panHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxRubberband.prototype.defaultOpacity=20;mxRubberband.prototype.enabled=!0;mxRubberband.prototype.div=null;mxRubberband.prototype.sharedDiv=null;mxRubberband.prototype.currentX=0;
mxRubberband.prototype.currentY=0;mxRubberband.prototype.isEnabled=function(){return this.enabled};mxRubberband.prototype.setEnabled=function(a){this.enabled=a};
mxRubberband.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&(this.graph.isForceMarqueeEvent(b.getEvent())||null==b.getState())){var c=mxUtils.getOffset(this.graph.container),d=mxUtils.getScrollOrigin(this.graph.container);d.x-=c.x;d.y-=c.y;this.start(b.getX()+d.x,b.getY()+d.y);if(mxClient.IS_NS&&!mxClient.IS_SF&&!mxClient.IS_GC){var e=this.graph.container,f=function(a){var a=new mxMouseEvent(a),b=mxUtils.convertPoint(e,a.getX(),a.getY());a.graphX=b.x;
a.graphY=b.y;return a};this.dragHandler=mxUtils.bind(this,function(a){this.mouseMove(this.graph,f(a))});this.dropHandler=mxUtils.bind(this,function(a){this.mouseUp(this.graph,f(a))});mxEvent.addListener(document,"mousemove",this.dragHandler);mxEvent.addListener(document,"mouseup",this.dropHandler)}b.consume(!1)}};mxRubberband.prototype.start=function(a,b){this.first=new mxPoint(a,b)};
mxRubberband.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&null!=this.first){var c=mxUtils.getScrollOrigin(this.graph.container),d=mxUtils.getOffset(this.graph.container);c.x-=d.x;c.y-=d.y;var d=b.getX()+c.x,c=b.getY()+c.y,e=this.first.x-d,f=this.first.y-c,g=this.graph.tolerance;if(null!=this.div||Math.abs(e)>g||Math.abs(f)>g)null==this.div&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(d,c),b.consume()}};
mxRubberband.prototype.createShape=function(){null==this.sharedDiv&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity));this.graph.container.appendChild(this.sharedDiv);return this.sharedDiv};mxRubberband.prototype.mouseUp=function(a,b){var c=null!=this.div;this.reset();c&&(this.graph.selectRegion(new mxRectangle(this.x,this.y,this.width,this.height),b.getEvent()),b.consume())};
mxRubberband.prototype.reset=function(){null!=this.div&&this.div.parentNode.removeChild(this.div);null!=this.dragHandler&&(mxEvent.removeListener(document,"mousemove",this.dragHandler),this.dragHandler=null);null!=this.dropHandler&&(mxEvent.removeListener(document,"mouseup",this.dropHandler),this.dropHandler=null);this.currentY=this.currentX=0;this.div=this.first=null};mxRubberband.prototype.update=function(a,b){this.currentX=a;this.currentY=b;this.repaint()};
mxRubberband.prototype.repaint=function(){if(null!=this.div){var a=this.currentX-this.graph.panDx,b=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,a);this.y=Math.min(this.first.y,b);this.width=Math.max(this.first.x,a)-this.x;this.height=Math.max(this.first.y,b)-this.y;a=mxClient.IS_VML?this.graph.panDy:0;this.div.style.left=this.x+(mxClient.IS_VML?this.graph.panDx:0)+"px";this.div.style.top=this.y+a+"px";this.div.style.width=Math.max(1,this.width)+"px";this.div.style.height=Math.max(1,
this.height)+"px"}};mxRubberband.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.reset(),null!=this.sharedDiv&&(this.sharedDiv=null))};function mxVertexHandler(a){null!=a&&(this.state=a,this.init())}mxVertexHandler.prototype.graph=null;mxVertexHandler.prototype.state=null;mxVertexHandler.prototype.singleSizer=!1;mxVertexHandler.prototype.index=null;
mxVertexHandler.prototype.allowHandleBoundsCheck=!0;mxVertexHandler.prototype.crisp=!0;mxVertexHandler.prototype.handleImage=null;mxVertexHandler.prototype.tolerance=0;
mxVertexHandler.prototype.init=function(){this.graph=this.state.view.graph;this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.selectionBorder=this.createSelectionShape(this.bounds);this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.init(this.graph.getView().getOverlayPane());
this.selectionBorder.dialect==mxConstants.DIALECT_SVG?this.selectionBorder.node.setAttribute("pointer-events","none"):this.selectionBorder.node.style.background="";this.graph.isCellMovable(this.state.cell)&&(this.selectionBorder.node.style.cursor=mxConstants.CURSOR_MOVABLE_VERTEX);mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state);if(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var a=this.graph.isCellResizable(this.state.cell);
this.sizers=[];if(a||this.graph.isLabelMovable(this.state.cell)&&2<=this.state.width&&2<=this.state.height){var b=0;a&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",b++)),this.sizers.push(this.createSizer("n-resize",b++)),this.sizers.push(this.createSizer("ne-resize",b++)),this.sizers.push(this.createSizer("w-resize",b++)),this.sizers.push(this.createSizer("e-resize",b++)),this.sizers.push(this.createSizer("sw-resize",b++)),this.sizers.push(this.createSizer("s-resize",b++))),this.sizers.push(this.createSizer("se-resize",
b++)));a=this.graph.model.getGeometry(this.state.cell);null!=a&&!a.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell)&&(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&2>this.state.width&&2>this.state.height&&(this.labelShape=
this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,null,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}this.redraw()};mxVertexHandler.prototype.getSelectionBounds=function(a){return new mxRectangle(a.x,a.y,a.width,a.height)};mxVertexHandler.prototype.createSelectionShape=function(a){a=new mxRectangleShape(a,null,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();a.crisp=this.crisp;return a};
mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR};mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH};mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED};
mxVertexHandler.prototype.createSizer=function(a,b,c,d){c=c||mxConstants.HANDLE_SIZE;c=this.createSizerShape(new mxRectangle(0,0,c,c),b,d);null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(c.bounds.height-=1,c.bounds.width-=1,c.dialect=mxConstants.DIALECT_STRICTHTML,c.init(this.graph.container)):(c.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,c.init(this.graph.getView().getOverlayPane()));mxEvent.redirectMouseEvents(c.node,
this.graph,this.state);this.graph.isEnabled()&&(c.node.style.cursor=a);this.isSizerVisible(b)||(c.node.style.visibility="hidden");return c};mxVertexHandler.prototype.isSizerVisible=function(){return!0};
mxVertexHandler.prototype.createSizerShape=function(a,b,c){if(null!=this.handleImage)return a.width=this.handleImage.width,a.height=this.handleImage.height,new mxImageShape(a,this.handleImage.src);a=new mxRectangleShape(a,c||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR);a.crisp=this.crisp;return a};mxVertexHandler.prototype.moveSizerTo=function(a,b,c){null!=a&&(a.bounds.x=b-a.bounds.width/2,a.bounds.y=c-a.bounds.height/2,a.redraw())};
mxVertexHandler.prototype.getHandleForEvent=function(a){if(a.isSource(this.labelShape))return mxEvent.LABEL_HANDLE;if(null!=this.sizers)for(var b=this.tolerance,b=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<b)?new mxRectangle(a.getGraphX()-b,a.getGraphY()-b,2*b,2*b):null,c=0;c<this.sizers.length;c++)if(a.isSource(this.sizers[c])||null!=b&&"hidden"!=this.sizers[c].node.style.visibility&&mxUtils.intersects(this.sizers[c].bounds,b))return c;return null};
mxVertexHandler.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.graph.isEnabled()&&!this.graph.isForceMarqueeEvent(b.getEvent())&&(0<this.tolerance||b.getState()==this.state)){var c=this.getHandleForEvent(b);null!=c&&(this.start(b.getX(),b.getY(),c),b.consume())}};
mxVertexHandler.prototype.start=function(a,b,c){a=mxUtils.convertPoint(this.graph.container,a,b);this.startX=a.x;this.startY=a.y;this.index=c;this.selectionBorder.node.style.visibility="hidden";this.preview=this.createSelectionShape(this.bounds);null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container)):(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:
mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane()))};
mxVertexHandler.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&null!=this.index){var c=new mxPoint(b.getGraphX(),b.getGraphY()),d=this.graph.isGridEnabledEvent(b.getEvent()),e=this.graph.getView().scale;this.index==mxEvent.LABEL_HANDLE?(d&&(c.x=this.graph.snap(c.x/e)*e,c.y=this.graph.snap(c.y/e)*e),this.moveSizerTo(this.sizers[this.sizers.length-1],c.x,c.y),b.consume()):null!=this.index&&(this.bounds=this.union(this.selectionBounds,c.x-this.startX,c.y-this.startY,this.index,d,e,this.graph.view.translate),
this.drawPreview(),b.consume())}else null!=this.getHandleForEvent(b)&&b.consume(!1)};mxVertexHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()&&null!=this.index&&null!=this.state){var c=new mxPoint(b.getGraphX(),b.getGraphY()),d=this.graph.getView().scale,e=this.graph.isGridEnabledEvent(b.getEvent());this.resizeCell(this.state.cell,(c.x-this.startX)/d,(c.y-this.startY)/d,this.index,e);this.reset();b.consume()}};
mxVertexHandler.prototype.reset=function(){this.index=null;null!=this.preview&&(this.preview.destroy(),this.preview=null);null!=this.selectionBorder&&(this.selectionBounds=this.getSelectionBounds(this.state),this.selectionBorder.node.style.visibility="visible",this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview())};
mxVertexHandler.prototype.resizeCell=function(a,b,c,d,e){var f=this.graph.model.getGeometry(a);d==mxEvent.LABEL_HANDLE?(c=this.graph.view.scale,b=(this.labelShape.bounds.getCenterX()-this.startX)/c,c=(this.labelShape.bounds.getCenterY()-this.startY)/c,f=f.clone(),null==f.offset?f.offset=new mxPoint(b,c):(f.offset.x+=b,f.offset.y+=c),this.graph.model.setGeometry(a,f)):(b=this.union(f,b,c,d,e,1,new mxPoint(0,0)),this.graph.resizeCell(a,b))};
mxVertexHandler.prototype.union=function(a,b,c,d,e,f,g){if(this.singleSizer){var g=a.x+a.width+b,h=a.y+a.height+c;e&&(g=this.graph.snap(g/f)*f,h=this.graph.snap(h/f)*f);f=new mxRectangle(a.x,a.y,0,0);f.add(new mxRectangle(g,h,0,0));return f}var h=a.x-g.x*f,k=h+a.width,l=a.y-g.y*f,a=l+a.height;4<d?(a+=c,e&&(a=this.graph.snap(a/f)*f)):3>d&&(l+=c,e&&(l=this.graph.snap(l/f)*f));if(0==d||3==d||5==d)h+=b,e&&(h=this.graph.snap(h/f)*f);else if(2==d||4==d||7==d)k+=b,e&&(k=this.graph.snap(k/f)*f);e=k-h;a-=
l;0>e&&(h+=e,e=Math.abs(e));0>a&&(l+=a,a=Math.abs(a));return new mxRectangle(h+g.x*f,l+g.y*f,e,a)};
mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);if(null!=this.sizers){var a=this.state,b=a.x+a.width,c=a.y+a.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],b,c);else{var d=a.x+a.width/2,e=a.y+a.height/2;1<this.sizers.length?(this.moveSizerTo(this.sizers[0],a.x,a.y),this.moveSizerTo(this.sizers[1],d,a.y),this.moveSizerTo(this.sizers[2],
b,a.y),this.moveSizerTo(this.sizers[3],a.x,e),this.moveSizerTo(this.sizers[4],b,e),this.moveSizerTo(this.sizers[5],a.x,c),this.moveSizerTo(this.sizers[6],d,c),this.moveSizerTo(this.sizers[7],b,c),this.moveSizerTo(this.sizers[8],d+a.absoluteOffset.x,e+a.absoluteOffset.y)):2<=this.state.width&&2<=this.state.height?this.moveSizerTo(this.sizers[0],d+a.absoluteOffset.x,e+a.absoluteOffset.y):this.moveSizerTo(this.sizers[0],a.x,a.y)}}this.drawPreview()};
mxVertexHandler.prototype.drawPreview=function(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.redraw());this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw()};
mxVertexHandler.prototype.destroy=function(){null!=this.preview&&(this.preview.destroy(),this.preview=null);this.selectionBorder.destroy();this.labelShape=this.selectionBorder=null;if(null!=this.sizers)for(var a=0;a<this.sizers.length;a++)this.sizers[a].destroy(),this.sizers[a]=null};function mxEdgeHandler(a){null!=a&&(this.state=a,this.init())}mxEdgeHandler.prototype.graph=null;mxEdgeHandler.prototype.state=null;mxEdgeHandler.prototype.marker=null;mxEdgeHandler.prototype.constraintHandler=null;
mxEdgeHandler.prototype.error=null;mxEdgeHandler.prototype.shape=null;mxEdgeHandler.prototype.bends=null;mxEdgeHandler.prototype.labelShape=null;mxEdgeHandler.prototype.cloneEnabled=!0;mxEdgeHandler.prototype.addEnabled=!1;mxEdgeHandler.prototype.removeEnabled=!1;mxEdgeHandler.prototype.preferHtml=!1;mxEdgeHandler.prototype.allowHandleBoundsCheck=!0;mxEdgeHandler.prototype.snapToTerminals=!1;mxEdgeHandler.prototype.crisp=!0;mxEdgeHandler.prototype.handleImage=null;
mxEdgeHandler.prototype.tolerance=0;
mxEdgeHandler.prototype.init=function(){this.graph=this.state.view.graph;this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.points=[];this.abspoints=this.getSelectionPoints(this.state);this.shape=this.createSelectionShape(this.abspoints);this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.shape.init(this.graph.getView().getOverlayPane());this.shape.node.style.cursor=mxConstants.CURSOR_MOVABLE_EDGE;
var a=mxClient.IS_TOUCH?"touchstart":"mousedown",b=mxClient.IS_TOUCH?"touchmove":"mousemove",c=mxClient.IS_TOUCH?"touchend":"mouseup";mxEvent.addListener(this.shape.node,"dblclick",mxUtils.bind(this,function(a){this.graph.dblClick(a,this.state.cell)}));mxEvent.addListener(this.shape.node,a,mxUtils.bind(this,function(a){this.addEnabled&&this.isAddPointEvent(a)?this.addPoint(this.state,a):this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,this.state))}));mxEvent.addListener(this.shape.node,
b,mxUtils.bind(this,function(a){var b=this.state.cell;if(null!=this.index){var c=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a)),b=this.graph.getCellAt(c.x,c.y);this.graph.isSwimlane(b)&&this.graph.hitsSwimlaneContent(b,c.x,c.y)&&(b=null)}this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,this.graph.getView().getState(b)))}));mxEvent.addListener(this.shape.node,c,mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,
this.state))}));this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode==this.graph.container;this.preferHtml||(a=this.state.getVisibleTerminalState(!0),null!=a&&(this.preferHtml=null!=a.text&&a.text.node.parentNode==this.graph.container),this.preferHtml||(a=this.state.getVisibleTerminalState(!1),null!=a&&(this.preferHtml=null!=a.text&&a.text.node.parentNode==this.graph.container)));if(this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells||0>=mxGraphHandler.prototype.maxCells)this.bends=
this.createBends();this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape=new mxRectangleShape(new mxRectangle,mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR);this.initBend(this.labelShape);this.labelShape.node.style.cursor=mxConstants.CURSOR_LABEL_HANDLE;mxEvent.redirectMouseEvents(this.labelShape.node,this.graph,this.state);this.redraw()};mxEdgeHandler.prototype.isAddPointEvent=function(a){return mxEvent.isShiftDown(a)};
mxEdgeHandler.prototype.isRemovePointEvent=function(a){return mxEvent.isShiftDown(a)};mxEdgeHandler.prototype.getSelectionPoints=function(a){return a.absolutePoints};mxEdgeHandler.prototype.createSelectionShape=function(a){a=new mxPolyline(a,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();return a};mxEdgeHandler.prototype.getSelectionColor=function(){return mxConstants.EDGE_SELECTION_COLOR};
mxEdgeHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.EDGE_SELECTION_STROKEWIDTH};mxEdgeHandler.prototype.isSelectionDashed=function(){return mxConstants.EDGE_SELECTION_DASHED};mxEdgeHandler.prototype.isConnectableCell=function(){return!0};
mxEdgeHandler.prototype.createMarker=function(){var a=new mxCellMarker(this.graph),b=this;a.getCell=function(a){var d=mxCellMarker.prototype.getCell.apply(this,arguments);if(!b.isConnectableCell(d))return null;var e=b.graph.getModel();if(d==b.state.cell||null!=d&&!b.graph.connectableEdges&&e.isEdge(d))d=null;return d};a.isValidState=function(a){var d=b.graph.getModel(),d=b.graph.view.getTerminalPort(a,b.graph.view.getState(d.getTerminal(b.state.cell,!b.isSource)),!b.isSource),d=null!=d?d.cell:null;
b.error=b.validateConnection(b.isSource?a.cell:d,b.isSource?d:a.cell);return null==b.error};return a};mxEdgeHandler.prototype.validateConnection=function(a,b){return this.graph.getEdgeValidationError(this.state.cell,a,b)};
mxEdgeHandler.prototype.createBends=function(){for(var a=this.state.cell,b=[],c=0;c<this.abspoints.length;c++)if(this.isHandleVisible(c)){var d=c==this.abspoints.length-1;if((d=0==c||d)||this.graph.isCellBendable(a)){var e=this.createHandleShape(c);this.initBend(e);mxClient.IS_TOUCH&&e.node.setAttribute("pointer-events","none");if(this.isHandleEnabled(c))if(mxClient.IS_TOUCH){var f=mxUtils.bind(this,function(a){a=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));
return this.graph.view.getState(this.graph.getCellAt(a.x,a.y))});mxEvent.redirectMouseEvents(e.node,this.graph,f)}else e.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE,mxEvent.redirectMouseEvents(e.node,this.graph,this.state);b.push(e);d||(this.points.push(new mxPoint(0,0)),e.node.style.visibility="hidden")}}return b};mxEdgeHandler.prototype.isHandleEnabled=function(){return!0};mxEdgeHandler.prototype.isHandleVisible=function(){return!0};
mxEdgeHandler.prototype.createHandleShape=function(){if(null!=this.handleImage)return new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);var a=mxConstants.HANDLE_SIZE;this.preferHtml&&(a-=1);return new mxRectangleShape(new mxRectangle(0,0,a,a),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxEdgeHandler.prototype.initBend=function(a){a.crisp=this.crisp;this.preferHtml?(a.dialect=mxConstants.DIALECT_STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,a.init(this.graph.getView().getOverlayPane()))};
mxEdgeHandler.prototype.getHandleForEvent=function(a){if(null!=this.bends)for(var b=this.tolerance,b=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<b)?new mxRectangle(a.getGraphX()-b,a.getGraphY()-b,2*b,2*b):null,c=0;c<this.bends.length;c++)if(a.isSource(this.bends[c])||null!=b&&"hidden"!=this.bends[c].node.style.visibility&&mxUtils.intersects(this.bends[c].bounds,b))return c;if(a.isSource(this.labelShape)||a.isSource(this.state.text))if(!mxClient.IS_SF&&!mxClient.IS_GC||"SELECT"!=a.getSource().nodeName)return mxEvent.LABEL_HANDLE;
return null};mxEdgeHandler.prototype.mouseDown=function(a,b){var c=null,c=this.getHandleForEvent(b);null!=c&&!b.isConsumed()&&this.graph.isEnabled()&&!this.graph.isForceMarqueeEvent(b.getEvent())&&(this.removeEnabled&&this.isRemovePointEvent(b.getEvent())?this.removePoint(this.state,c):(c!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(b.getCell()))&&this.start(b.getX(),b.getY(),c),b.consume())};
mxEdgeHandler.prototype.start=function(a,b,c){this.startX=a;this.startY=b;this.isSource=null==this.bends?!1:0==c;this.isTarget=null==this.bends?!1:c==this.bends.length-1;this.isLabel=c==mxEvent.LABEL_HANDLE;if(this.isSource||this.isTarget){if(a=this.state.cell,b=this.graph.model.getTerminal(a,this.isSource),null==b&&this.graph.isTerminalPointMovable(a,this.isSource)||null!=b&&this.graph.isCellDisconnectable(a,b,this.isSource))this.index=c}else this.index=c};
mxEdgeHandler.prototype.clonePreviewState=function(){return this.state.clone()};mxEdgeHandler.prototype.getSnapToTerminalTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};
mxEdgeHandler.prototype.getPointForEvent=function(a){var b=new mxPoint(a.getGraphX(),a.getGraphY()),c=this.getSnapToTerminalTolerance(),d=this.graph.getView(),e=!1,f=!1;if(this.snapToTerminals&&0<c){var g=function(a){if(null!=a){var d=a.x;Math.abs(b.x-d)<c&&(b.x=d,e=!0);a=a.y;Math.abs(b.y-a)<c&&(b.y=a,f=!0)}},h=function(a){null!=a&&g.call(this,new mxPoint(d.getRoutingCenterX(a),d.getRoutingCenterY(a)))};h.call(this,this.state.getVisibleTerminalState(!0));h.call(this,this.state.getVisibleTerminalState(!1));
if(null!=this.abspoints)for(h=0;h<this.abspoints;h++)h!=this.index&&g.call(this,this.abspoints[h])}this.graph.isGridEnabledEvent(a.getEvent())&&(a=d.scale,h=d.translate,e||(b.x=(this.graph.snap(b.x/a-h.x)+h.x)*a),f||(b.y=(this.graph.snap(b.y/a-h.y)+h.y)*a));return b};
mxEdgeHandler.prototype.getPreviewTerminalState=function(a){this.constraintHandler.update(a,this.isSource);this.marker.process(a);var a=this.marker.getValidState(),b=null;null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint&&this.marker.reset();null!=a?b=a:null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(b=this.constraintHandler.currentFocus);return b};
mxEdgeHandler.prototype.getPreviewPoints=function(a){var b=this.graph.getCellGeometry(this.state.cell),b=null!=b.points?b.points.slice():null;!this.isSource&&!this.isTarget?(this.convertPoint(a,!1),null==b?b=[a]:b[this.index-1]=a):this.graph.resetEdgesOnConnect&&(b=null);return b};
mxEdgeHandler.prototype.updatePreviewState=function(a,b,c){var d=this.isSource?c:this.state.getVisibleTerminalState(!0),e=this.isTarget?c:this.state.getVisibleTerminalState(!1),f=this.graph.getConnectionConstraint(a,d,!0),g=this.graph.getConnectionConstraint(a,e,!1),h=this.constraintHandler.currentConstraint;null==h&&(h=new mxConnectionConstraint);this.isSource?f=h:this.isTarget&&(g=h);(!this.isSource||null!=d)&&a.view.updateFixedTerminalPoint(a,d,!0,f);(!this.isTarget||null!=e)&&a.view.updateFixedTerminalPoint(a,
e,!1,g);if((this.isSource||this.isTarget)&&null==c)a.setAbsoluteTerminalPoint(b,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.allowDanglingEdges?null:"");a.view.updatePoints(a,this.points,d,e);a.view.updateFloatingTerminalPoints(a,d,e)};
mxEdgeHandler.prototype.mouseMove=function(a,b){if(null!=this.index&&null!=this.marker){var c=this.getPointForEvent(b);if(this.isLabel)this.label.x=c.x,this.label.y=c.y;else{this.points=this.getPreviewPoints(c);var d=this.isSource||this.isTarget?this.getPreviewTerminalState(b):null,e=this.clonePreviewState(c,null!=d?d.cell:null);this.updatePreviewState(e,c,d);this.setPreviewColor(null==this.error?this.marker.validColor:this.marker.invalidColor);this.abspoints=e.absolutePoints;this.active=!0}this.drawPreview();
mxEvent.consume(b.getEvent());b.consume()}else mxClient.IS_IE&&null!=this.getHandleForEvent(b)&&b.consume(!1)};
mxEdgeHandler.prototype.mouseUp=function(a,b){if(null!=this.index&&null!=this.marker){var c=this.state.cell;if(b.getX()!=this.startX||b.getY()!=this.startY)if(null!=this.error)0<this.error.length&&this.graph.validationAlert(this.error);else if(this.isLabel)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){var d=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(d=this.constraintHandler.currentFocus.cell);null==
d&&this.marker.hasValidState()&&(d=this.marker.validState.cell);if(null!=d)c=this.connect(c,d,this.isSource,this.graph.isCloneEvent(b.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable(),b);else if(this.graph.isAllowDanglingEdges()){d=this.abspoints[this.isSource?0:this.abspoints.length-1];d.x=d.x/this.graph.view.scale-this.graph.view.translate.x;d.y=d.y/this.graph.view.scale-this.graph.view.translate.y;var e=this.graph.getView().getState(this.graph.getModel().getParent(c));null!=e&&(d.x-=
e.origin.x,d.y-=e.origin.y);d.x-=this.graph.panDx/this.graph.view.scale;d.y-=this.graph.panDy/this.graph.view.scale;this.changeTerminalPoint(c,d,this.isSource)}}else this.active?this.changePoints(c,this.points):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().revalidate(this.state.cell));null!=this.marker&&(this.reset(),c!=this.state.cell&&this.graph.setSelectionCell(c));b.consume()}};
mxEdgeHandler.prototype.reset=function(){this.points=this.label=this.index=this.error=null;this.isTarget=this.isSource=this.isLabel=this.active=!1;this.marker.reset();this.constraintHandler.reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR);this.redraw()};mxEdgeHandler.prototype.setPreviewColor=function(a){null!=this.shape&&null!=this.shape.node&&(this.shape.dialect==mxConstants.DIALECT_SVG?this.shape.innerNode.setAttribute("stroke",a):this.shape.node.strokecolor=a)};
mxEdgeHandler.prototype.convertPoint=function(a,b){var c=this.graph.getView().getScale(),d=this.graph.getView().getTranslate();b&&(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));a.x=Math.round(a.x/c-d.x);a.y=Math.round(a.y/c-d.y);c=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell));null!=c&&(a.x-=c.origin.x,a.y-=c.origin.y);return a};
mxEdgeHandler.prototype.moveLabel=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a.cell);if(null!=e){var e=e.clone(),f=this.graph.getView().getRelativePoint(a,b,c);e.x=f.x;e.y=f.y;var g=this.graph.getView().scale;e.offset=new mxPoint(0,0);f=this.graph.view.getPoint(a,e);e.offset=new mxPoint((b-f.x)/g,(c-f.y)/g);d.setGeometry(a.cell,e)}};
mxEdgeHandler.prototype.connect=function(a,b,c,d){var e=this.graph.getModel(),f=e.getParent(a);e.beginUpdate();try{if(d){var g=a.clone();e.add(f,g,e.getChildCount(f));var h=e.getTerminal(a,!c);this.graph.connectCell(g,h,!c);a=g}var k=this.constraintHandler.currentConstraint;null==k&&(k=new mxConnectionConstraint);this.graph.connectCell(a,b,c,k)}finally{e.endUpdate()}return a};
mxEdgeHandler.prototype.changeTerminalPoint=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a);if(null!=e){d.beginUpdate();try{e=e.clone(),e.setTerminalPoint(b,c),d.setGeometry(a,e),this.graph.connectCell(a,null,c,new mxConnectionConstraint)}finally{d.endUpdate()}}};mxEdgeHandler.prototype.changePoints=function(a,b){var c=this.graph.getModel(),d=c.getGeometry(a);null!=d&&(d=d.clone(),d.points=b,c.setGeometry(a,d))};
mxEdgeHandler.prototype.addPoint=function(a,b){var c=this.graph.getCellGeometry(a.cell);if(null!=c){var c=c.clone(),d=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(b),mxEvent.getClientY(b)),e=mxUtils.findNearestSegment(a,d.x,d.y),f=this.graph.isGridEnabledEvent(b);this.convertPoint(d,f);null==c.points?c.points=[d]:c.points.splice(e,0,d);this.graph.getModel().setGeometry(a.cell,c);this.destroy();this.init();mxEvent.consume(b)}};
mxEdgeHandler.prototype.removePoint=function(a,b){if(0<b&&b<this.abspoints.length-1){var c=this.graph.getCellGeometry(this.state.cell);null!=c&&null!=c.points&&(c=c.clone(),c.points.splice(b-1,1),this.graph.getModel().setGeometry(a.cell,c),this.destroy(),this.init())}};
mxEdgeHandler.prototype.getHandleFillColor=function(a){var a=0==a,b=this.state.cell,c=this.graph.getModel().getTerminal(b,a),d=mxConstants.HANDLE_FILLCOLOR;null!=c&&!this.graph.isCellDisconnectable(b,c,a)||null==c&&!this.graph.isTerminalPointMovable(b,a)?d=mxConstants.LOCKED_HANDLE_FILLCOLOR:null!=c&&this.graph.isCellDisconnectable(b,c,a)&&(d=mxConstants.CONNECT_HANDLE_FILLCOLOR);return d};
mxEdgeHandler.prototype.redraw=function(){this.abspoints=this.state.absolutePoints.slice();var a=this.state.cell,b=mxConstants.LABEL_HANDLE_SIZE;this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape.bounds=new mxRectangle(this.label.x-b/2,this.label.y-b/2,b,b);this.labelShape.redraw();b=this.graph.getLabel(a);this.labelShape.node.style.visibility=null!=b&&0<b.length&&this.graph.isLabelMovable(a)?"visible":"hidden";if(null!=this.bends&&0<this.bends.length){var c=
this.abspoints.length-1,a=this.abspoints[0],b=this.bends[0].bounds;this.bends[0].bounds=new mxRectangle(this.abspoints[0].x-b.width/2,this.abspoints[0].y-b.height/2,b.width,b.height);this.bends[0].fill=this.getHandleFillColor(0);this.bends[0].reconfigure();this.bends[0].redraw();var d=this.abspoints[c],e=this.abspoints[c].x,c=this.abspoints[c].y,f=this.bends.length-1,b=this.bends[f].bounds;this.bends[f].bounds=new mxRectangle(e-b.width/2,c-b.height/2,b.width,b.height);this.bends[f].fill=this.getHandleFillColor(f);
this.bends[f].reconfigure();this.bends[f].redraw();this.redrawInnerBends(a,d)}this.drawPreview()};
mxEdgeHandler.prototype.redrawInnerBends=function(){var a=this.graph.getModel().getGeometry(this.state.cell).points;if(null!=a){null==this.points&&(this.points=[]);for(var b=1;b<this.bends.length-1;b++)if(null!=this.bends[b])if(null!=this.abspoints[b]){var c=this.abspoints[b].x,d=this.abspoints[b].y,e=this.bends[b].bounds;this.bends[b].node.style.visibility="visible";this.bends[b].bounds=new mxRectangle(c-e.width/2,d-e.height/2,e.width,e.height);this.bends[b].redraw();this.points[b-1]=a[b-1]}else this.bends[b].destroy(),
this.bends[b]=null}};mxEdgeHandler.prototype.drawPreview=function(){if(this.isLabel){var a=mxConstants.LABEL_HANDLE_SIZE;this.labelShape.bounds=new mxRectangle(this.label.x-a/2,this.label.y-a/2,a,a);this.labelShape.redraw()}else this.shape.points=this.abspoints,this.shape.redraw();mxUtils.repaintGraph(this.graph,this.shape.points[this.shape.points.length-1])};
mxEdgeHandler.prototype.destroy=function(){null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.labelShape&&(this.labelShape.destroy(),this.labelShape=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);if(null!=this.bends)for(var a=0;a<this.bends.length;a++)null!=this.bends[a]&&(this.bends[a].destroy(),this.bends[a]=null)};
function mxElbowEdgeHandler(a){null!=a&&(this.state=a,this.init())}mxElbowEdgeHandler.prototype=new mxEdgeHandler;mxElbowEdgeHandler.prototype.constructor=mxElbowEdgeHandler;mxElbowEdgeHandler.prototype.flipEnabled=!0;mxElbowEdgeHandler.prototype.doubleClickOrientationResource="none"!=mxClient.language?"doubleClickOrientation":"";
mxElbowEdgeHandler.prototype.createBends=function(){var a=[],b=this.createHandleShape(0);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");a.push(this.createVirtualBend());this.points.push(new mxPoint(0,0));b=this.createHandleShape(2);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);
a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");return a};
mxElbowEdgeHandler.prototype.createVirtualBend=function(){var a=this.createHandleShape();this.initBend(a);var b=this.getCursorForBend();a.node.style.cursor=b;b=mxUtils.bind(this,function(a){!mxEvent.isConsumed(a)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,a),mxEvent.consume(a))});mxEvent.redirectMouseEvents(a.node,this.graph,this.state,null,null,null,b);this.graph.isCellBendable(this.state.cell)||(a.node.style.visibility="hidden");return a};
mxElbowEdgeHandler.prototype.getCursorForBend=function(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"};
mxElbowEdgeHandler.prototype.getTooltipForNode=function(a){var b=null;if(null!=this.bends&&null!=this.bends[1]&&(a==this.bends[1].node||a.parentNode==this.bends[1].node))b=this.doubleClickOrientationResource,b=mxResources.get(b)||b;return b};
mxElbowEdgeHandler.prototype.convertPoint=function(a,b){var c=this.graph.getView().getScale(),d=this.graph.getView().getTranslate(),e=this.state.origin;b&&(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));a.x=Math.round(a.x/c-d.x-e.x);a.y=Math.round(a.y/c-d.y-e.y)};
mxElbowEdgeHandler.prototype.redrawInnerBends=function(a,b){var c=this.graph.getModel().getGeometry(this.state.cell).points,c=null!=c?c[0]:null,c=null==c?new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2):new mxPoint(this.graph.getView().scale*(c.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(c.y+this.graph.getView().translate.y+this.state.origin.y)),d=this.bends[1].bounds,e=d.width,d=d.height;null==this.handleImage&&(d=e=mxConstants.HANDLE_SIZE);var f=new mxRectangle(c.x-
e/2,c.y-d/2,e,d);null==this.handleImage&&"hidden"!=this.labelShape.node.style.visibility&&mxUtils.intersects(f,this.labelShape.bounds)&&(e+=3,d+=3,f=new mxRectangle(c.x-e/2,c.y-d/2,e,d));this.bends[1].bounds=f;this.bends[1].reconfigure();this.bends[1].redraw()};function mxEdgeSegmentHandler(a){null!=a&&(this.state=a,this.init())}mxEdgeSegmentHandler.prototype=new mxElbowEdgeHandler;mxEdgeSegmentHandler.prototype.constructor=mxEdgeSegmentHandler;
mxEdgeSegmentHandler.prototype.getPreviewPoints=function(a){if(this.isSource||this.isTarget)return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments);this.convertPoint(a,!1);var b=this.state.absolutePoints,c=b[0].clone();this.convertPoint(c,!1);for(var d=[],e=1;e<b.length;e++){var f=b[e].clone();this.convertPoint(f,!1);e==this.index&&(c.x==f.x?(c.x=a.x,f.x=a.x):(c.y=a.y,f.y=a.y));e<b.length-1&&d.push(f);c=f}if(1==d.length){if(c=this.state.view,e=this.state.getVisibleTerminalState(!0),
f=this.state.getVisibleTerminalState(!1),null!=f&null!=e){var g=this.state.origin.x,h=this.state.origin.y;mxUtils.contains(f,d[0].x+g,d[0].y+h)?b[1].y==b[2].y?d[0].y=c.getRoutingCenterY(e)-h:d[0].x=c.getRoutingCenterX(e)-g:mxUtils.contains(e,d[0].x+g,d[0].y+h)&&(b[1].y==b[0].y?d[0].y=c.getRoutingCenterY(f)-h:d[0].x=c.getRoutingCenterX(f)-g)}}else 0==d.length&&(d=[a]);return d};
mxEdgeSegmentHandler.prototype.createBends=function(){var a=[],b=this.createHandleShape(0);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");var c=this.state.absolutePoints;if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(var d=0;d<c.length-1;d++)b=this.createVirtualBend(),a.push(b),b.node.style.cursor=0==c[d].x-
c[d+1].x?"col-resize":"row-resize",this.points.push(new mxPoint(0,0)),mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none")}b=this.createHandleShape(c.length);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");return a};mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh();mxEdgeHandler.prototype.redraw.apply(this,arguments)};
mxEdgeSegmentHandler.prototype.refresh=function(){if(null!=this.bends){for(var a=0;a<this.bends.length;a++)null!=this.bends[a]&&(this.bends[a].destroy(),this.bends[a]=null);this.bends=this.createBends()}};
mxEdgeSegmentHandler.prototype.redrawInnerBends=function(a,b){if(this.graph.isCellBendable(this.state.cell)){var c=mxConstants.HANDLE_SIZE,d=this.state.absolutePoints;if(null!=d&&1<d.length)for(var e=0;e<this.state.absolutePoints.length-1;e++)if(null!=this.bends[e+1]){var a=d[e],b=d[e+1],f=new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2);this.bends[e+1].bounds=new mxRectangle(f.x-c/2,f.y-c/2,c,c);this.bends[e+1].reconfigure();this.bends[e+1].redraw()}}};
mxEdgeSegmentHandler.prototype.changePoints=function(a,b){var b=[],c=this.abspoints;if(1<c.length)for(var d=c[0],e=c[1],f=2;f<c.length;f++){var g=c[f];if((Math.round(d.x)!=Math.round(e.x)||Math.round(e.x)!=Math.round(g.x))&&(Math.round(d.y)!=Math.round(e.y)||Math.round(e.y)!=Math.round(g.y)))d=e,e=e.clone(),this.convertPoint(e,!1),b.push(e);e=g}mxElbowEdgeHandler.prototype.changePoints.apply(this,arguments)};
function mxKeyHandler(a,b){null!=a&&(this.graph=a,this.target=b||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],mxEvent.addListener(this.target,"keydown",mxUtils.bind(this,function(a){this.keyDown(a)})),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxKeyHandler.prototype.graph=null;mxKeyHandler.prototype.target=null;mxKeyHandler.prototype.normalKeys=null;
mxKeyHandler.prototype.shiftKeys=null;mxKeyHandler.prototype.controlKeys=null;mxKeyHandler.prototype.controlShiftKeys=null;mxKeyHandler.prototype.enabled=!0;mxKeyHandler.prototype.isEnabled=function(){return this.enabled};mxKeyHandler.prototype.setEnabled=function(a){this.enabled=a};mxKeyHandler.prototype.bindKey=function(a,b){this.normalKeys[a]=b};mxKeyHandler.prototype.bindShiftKey=function(a,b){this.shiftKeys[a]=b};mxKeyHandler.prototype.bindControlKey=function(a,b){this.controlKeys[a]=b};
mxKeyHandler.prototype.bindControlShiftKey=function(a,b){this.controlShiftKeys[a]=b};mxKeyHandler.prototype.isControlDown=function(a){return mxEvent.isControlDown(a)};mxKeyHandler.prototype.getFunction=function(a){return null!=a?this.isControlDown(a)?mxEvent.isShiftDown(a)?this.controlShiftKeys[a.keyCode]:this.controlKeys[a.keyCode]:mxEvent.isShiftDown(a)?this.shiftKeys[a.keyCode]:this.normalKeys[a.keyCode]:null};
mxKeyHandler.prototype.isGraphEvent=function(a){a=mxEvent.getSource(a);if(a==this.target||a.parentNode==this.target||null!=this.graph.cellEditor&&a==this.graph.cellEditor.textarea)return!0;for(;null!=a;){if(a==this.graph.container)return!0;a=a.parentNode}return!1};
mxKeyHandler.prototype.keyDown=function(a){if(this.graph.isEnabled()&&!mxEvent.isConsumed(a)&&this.isGraphEvent(a)&&this.isEnabled())if(27==a.keyCode)this.escape(a);else if(!this.graph.isEditing()){var b=this.getFunction(a);null!=b&&(b(a),mxEvent.consume(a))}};mxKeyHandler.prototype.escape=function(a){this.graph.isEscapeEnabled()&&this.graph.escape(a)};mxKeyHandler.prototype.destroy=function(){this.target=null};
function mxTooltipHandler(a,b){null!=a&&(this.graph=a,this.delay=b||500,this.graph.addMouseListener(this))}mxTooltipHandler.prototype.zIndex=10005;mxTooltipHandler.prototype.graph=null;mxTooltipHandler.prototype.delay=null;mxTooltipHandler.prototype.hideOnHover=!1;mxTooltipHandler.prototype.enabled=!0;mxTooltipHandler.prototype.isEnabled=function(){return this.enabled};mxTooltipHandler.prototype.setEnabled=function(a){this.enabled=a};mxTooltipHandler.prototype.isHideOnHover=function(){return this.hideOnHover};
mxTooltipHandler.prototype.setHideOnHover=function(a){this.hideOnHover=a};mxTooltipHandler.prototype.init=function(){null!=document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addListener(this.div,"mousedown",mxUtils.bind(this,function(){this.hideTooltip()})))};mxTooltipHandler.prototype.mouseDown=function(a,b){this.reset(b,!1);this.hideTooltip()};
mxTooltipHandler.prototype.mouseMove=function(a,b){if(b.getX()!=this.lastX||b.getY()!=this.lastY)this.reset(b,!0),(this.isHideOnHover()||b.getState()!=this.state||b.getSource()!=this.node&&(!this.stateSource||null!=b.getState()&&this.stateSource==(b.isSource(b.getState().shape)||!b.isSource(b.getState().text))))&&this.hideTooltip();this.lastX=b.getX();this.lastY=b.getY()};mxTooltipHandler.prototype.mouseUp=function(a,b){this.reset(b,!0);this.hideTooltip()};
mxTooltipHandler.prototype.resetTimer=function(){null!=this.thread&&(window.clearTimeout(this.thread),this.thread=null)};
mxTooltipHandler.prototype.reset=function(a,b){this.resetTimer();if(b&&this.isEnabled()&&null!=a.getState()&&(null==this.div||"hidden"==this.div.style.visibility)){var c=a.getState(),d=a.getSource(),e=a.getX(),f=a.getY(),g=a.isSource(c.shape)||a.isSource(c.text);this.thread=window.setTimeout(mxUtils.bind(this,function(){!this.graph.isEditing()&&!this.graph.panningHandler.isMenuShowing()&&(this.show(this.graph.getTooltip(c,d,e,f),e,f),this.state=c,this.node=d,this.stateSource=g)}),this.delay)}};
mxTooltipHandler.prototype.hide=function(){this.resetTimer();this.hideTooltip()};mxTooltipHandler.prototype.hideTooltip=function(){null!=this.div&&(this.div.style.visibility="hidden")};
mxTooltipHandler.prototype.show=function(a,b,c){if(null!=a&&0<a.length){null==this.div&&this.init();var d=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex;this.div.style.left=b+d.x+"px";this.div.style.top=c+mxConstants.TOOLTIP_VERTICAL_OFFSET+d.y+"px";mxUtils.isNode(a)?(this.div.innerHTML="",this.div.appendChild(a)):this.div.innerHTML=a.replace(/\n/g,"<br>");this.div.style.visibility="";mxUtils.fit(this.div)}};
mxTooltipHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);mxEvent.release(this.div);null!=this.div&&null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div);this.div=null};function mxCellTracker(a,b,c){mxCellMarker.call(this,a,b);this.graph.addMouseListener(this);null!=c&&(this.getCell=c);mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}mxCellTracker.prototype=new mxCellMarker;
mxCellTracker.prototype.constructor=mxCellTracker;mxCellTracker.prototype.mouseDown=function(){};mxCellTracker.prototype.mouseMove=function(a,b){this.isEnabled()&&this.process(b)};mxCellTracker.prototype.mouseUp=function(){this.reset()};mxCellTracker.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),mxCellMarker.prototype.destroy.apply(this))};
function mxCellHighlight(a,b,c){null!=a&&(this.graph=a,this.highlightColor=null!=b?b:mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=null!=c?c:mxConstants.HIGHLIGHT_STROKEWIDTH,this.repaintHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,
this.repaintHandler),this.resetHandler=mxUtils.bind(this,function(){this.hide()}),this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}mxCellHighlight.prototype.keepOnTop=!1;mxCellHighlight.prototype.graph=!0;mxCellHighlight.prototype.state=null;mxCellHighlight.prototype.spacing=2;mxCellHighlight.prototype.resetHandler=null;
mxCellHighlight.prototype.setHighlightColor=function(a){this.highlightColor=a;null!=this.shape&&(this.shape.dialect==mxConstants.DIALECT_SVG?this.shape.innerNode.setAttribute("stroke",a):this.shape.dialect==mxConstants.DIALECT_VML&&(this.shape.node.strokecolor=a))};
mxCellHighlight.prototype.drawHighlight=function(){this.shape=this.createShape();this.repaint();!this.keepOnTop&&this.shape.node.parentNode.firstChild!=this.shape.node&&this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild);this.graph.model.isEdge(this.state.cell)&&mxUtils.repaintGraph(this.graph,this.shape.points[0])};
mxCellHighlight.prototype.createShape=function(){var a=null,a=this.graph.model.isEdge(this.state.cell)?new mxPolyline(this.state.absolutePoints,this.highlightColor,this.strokeWidth):new mxRectangleShape(new mxRectangle,null,this.highlightColor,this.strokeWidth);a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(a.node,this.graph,this.state);return a};
mxCellHighlight.prototype.repaint=function(){if(null!=this.state&&null!=this.shape){this.graph.model.isEdge(this.state.cell)?this.shape.points=this.state.absolutePoints:this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing);null!=this.state.shape&&this.shape.setCursor(this.state.shape.getCursor());var a=!this.graph.model.isEdge(this.state.cell)?Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"):
0;if(this.shape.dialect==mxConstants.DIALECT_SVG){if(this.shape.node.setAttribute("style","pointer-events:none;"),0!=a){var b=this.state.getCenterX(),c=this.state.getCenterY();this.shape.node.setAttribute("transform","rotate("+a+" "+b+" "+c+")")}}else this.shape.node.style.background="",0!=a&&(this.shape.node.rotation=a);this.shape.redraw()}};mxCellHighlight.prototype.hide=function(){this.highlight(null)};
mxCellHighlight.prototype.highlight=function(a){this.state!=a&&(null!=this.shape&&(this.shape.destroy(),this.shape=null),this.state=a,null!=this.state&&this.drawHighlight())};mxCellHighlight.prototype.destroy=function(){this.graph.getView().removeListener(this.repaintHandler);this.graph.getModel().removeListener(this.repaintHandler);this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);null!=this.shape&&(this.shape.destroy(),this.shape=null)};
function mxDefaultKeyHandler(a){if(null!=a){this.editor=a;this.handler=new mxKeyHandler(a.graph);var b=this.handler.escape;this.handler.escape=function(c){b.apply(this,arguments);a.hideProperties();a.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",c))}}}mxDefaultKeyHandler.prototype.editor=null;mxDefaultKeyHandler.prototype.handler=null;
mxDefaultKeyHandler.prototype.bindAction=function(a,b,c){var d=mxUtils.bind(this,function(){this.editor.execute(b)});c?this.handler.bindControlKey(a,d):this.handler.bindKey(a,d)};mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy();this.handler=null};function mxDefaultPopupMenu(a){this.config=a}mxDefaultPopupMenu.prototype.imageBasePath=null;mxDefaultPopupMenu.prototype.config=null;
mxDefaultPopupMenu.prototype.createMenu=function(a,b,c,d){if(null!=this.config){var e=this.createConditions(a,c,d);this.addItems(a,b,c,d,e,this.config.firstChild,null)}};
mxDefaultPopupMenu.prototype.addItems=function(a,b,c,d,e,f,g){for(var h=!1;null!=f;){if("add"==f.nodeName){var k=f.getAttribute("if");if(null==k||e[k]){var k=f.getAttribute("as"),k=mxResources.get(k)||k,l=mxUtils.eval(mxUtils.getTextContent(f)),n=f.getAttribute("action"),o=f.getAttribute("icon"),p=f.getAttribute("iconCls");h&&(b.addSeparator(g),h=!1);null!=o&&this.imageBasePath&&(o=this.imageBasePath+o);k=this.addAction(b,a,k,o,l,n,c,g,p);this.addItems(a,b,c,d,e,f.firstChild,k)}}else"separator"==
f.nodeName&&(h=!0);f=f.nextSibling}};mxDefaultPopupMenu.prototype.addAction=function(a,b,c,d,e,f,g,h,k){return a.addItem(c,d,function(a){"function"==typeof e&&e.call(b,b,g,a);null!=f&&b.execute(f,g,a)},h,k)};
mxDefaultPopupMenu.prototype.createConditions=function(a,b,c){var d=a.graph.getModel(),e=d.getChildCount(b),f=[];f.nocell=null==b;f.ncells=1<a.graph.getSelectionCount();f.notRoot=d.getRoot()!=d.getParent(a.graph.getDefaultParent());f.cell=null!=b;d=null!=b&&1==a.graph.getSelectionCount();f.nonEmpty=d&&0<e;f.expandable=d&&a.graph.isCellFoldable(b,!1);f.collapsable=d&&a.graph.isCellFoldable(b,!0);f.validRoot=d&&a.graph.isValidRoot(b);f.emptyValidRoot=f.validRoot&&0==e;f.swimlane=d&&a.graph.isSwimlane(b);
e=this.config.getElementsByTagName("condition");for(d=0;d<e.length;d++){var g=mxUtils.eval(mxUtils.getTextContent(e[d])),h=e[d].getAttribute("name");null!=h&&"function"==typeof g&&(f[h]=g(a,b,c))}return f};function mxDefaultToolbar(a,b){this.editor=b;null!=a&&null!=b&&this.init(a)}mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=!1;
mxDefaultToolbar.prototype.init=function(a){null!=a&&(this.toolbar=new mxToolbar(a),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(a,c){var d=c.getProperty("function");this.editor.insertFunction=null!=d?mxUtils.bind(this,function(){d.apply(this,arguments);this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){null!=this.toolbar&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,
this.resetHandler))};mxDefaultToolbar.prototype.addItem=function(a,b,c,d){var e=mxUtils.bind(this,function(){null!=c&&0<c.length&&this.editor.execute(c)});return this.toolbar.addItem(a,b,e,d)};mxDefaultToolbar.prototype.addSeparator=function(a){a=a||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(a)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(a){return this.toolbar.addActionCombo(a)};
mxDefaultToolbar.prototype.addActionOption=function(a,b,c){var d=mxUtils.bind(this,function(){this.editor.execute(c)});this.addOption(a,b,d)};mxDefaultToolbar.prototype.addOption=function(a,b,c){return this.toolbar.addOption(a,b,c)};mxDefaultToolbar.prototype.addMode=function(a,b,c,d,e){var f=mxUtils.bind(this,function(){this.editor.setMode(c);null!=e&&e(this.editor)});return this.toolbar.addSwitchMode(a,b,f,d)};
mxDefaultToolbar.prototype.addPrototype=function(a,b,c,d,e,f){var g=function(){return"function"==typeof c?c():null!=c?c.clone():null},h=mxUtils.bind(this,function(a,b){"function"==typeof e?e(this.editor,g(),a,b):this.drop(g(),a,b);this.toolbar.resetMode();mxEvent.consume(a)}),a=this.toolbar.addMode(a,b,h,d,null,f);this.installDropHandler(a,function(a,b,c){h(b,c)});return a};
mxDefaultToolbar.prototype.drop=function(a,b,c){var d=this.editor.graph,e=d.getModel();if(null==c||e.isEdge(c)||!this.connectOnDrop||!d.isCellConnectable(c)){for(;null!=c&&!d.isValidDropTarget(c,[a],b);)c=e.getParent(c);this.insert(a,b,c)}else this.connect(a,b,c)};
mxDefaultToolbar.prototype.insert=function(a,b,c){var d=this.editor.graph;if(d.canImportCell(a)){var e=mxEvent.getClientX(b),f=mxEvent.getClientY(b),e=mxUtils.convertPoint(d.container,e,f);return d.isSplitEnabled()&&d.isSplitTarget(c,[a],b)?d.splitEdge(c,[a],null,e.x,e.y):this.editor.addVertex(c,a,e.x,e.y)}return null};
mxDefaultToolbar.prototype.connect=function(a,b,c){var b=this.editor.graph,d=b.getModel();if(null!=c&&b.isCellConnectable(a)&&b.isEdgeValid(null,c,a)){var e=null;d.beginUpdate();try{var f=d.getGeometry(c),g=d.getGeometry(a).clone();g.x=f.x+(f.width-g.width)/2;g.y=f.y+(f.height-g.height)/2;var h=this.spacing*b.gridSize,k=20*d.getDirectedEdgeCount(c,!0);this.editor.horizontalFlow?g.x+=(g.width+f.width)/2+h+k:g.y+=(g.height+f.height)/2+h+k;a.setGeometry(g);var l=d.getParent(c);b.addCell(a,l);b.constrainChild(a);
e=this.editor.createEdge(c,a);if(null==d.getGeometry(e)){var n=new mxGeometry;n.relative=!0;d.setGeometry(e,n)}b.addEdge(e,l,c,a)}finally{d.endUpdate()}b.setSelectionCells([a,e]);b.scrollCellToVisible(a)}};
mxDefaultToolbar.prototype.installDropHandler=function(a,b){var c=document.createElement("img");c.setAttribute("src",a.getAttribute("src"));var d=mxUtils.bind(this,function(){c.style.width=2*a.offsetWidth+"px";c.style.height=2*a.offsetHeight+"px";mxUtils.makeDraggable(a,this.editor.graph,b,c);mxEvent.removeListener(c,"load",d)});mxClient.IS_IE?d():mxEvent.addListener(c,"load",d)};
mxDefaultToolbar.prototype.destroy=function(){null!=this.resetHandler&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null);null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)};
function mxEditor(a){this.actions=[];this.addActions();if(null!=document.body){this.cycleAttributeValues=[];this.popupHandler=new mxDefaultPopupMenu;this.undoManager=new mxUndoManager;this.graph=this.createGraph();this.toolbar=this.createToolbar();this.keyHandler=new mxDefaultKeyHandler(this);this.configure(a);this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName;!mxClient.IS_LOCAL&&null!=this.urlInit&&(this.session=this.createSession());if(null!=this.onInit)this.onInit();mxClient.IS_IE&&
mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/editor");mxEditor.prototype=new mxEventSource;mxEditor.prototype.constructor=mxEditor;mxEditor.prototype.askZoomResource="none"!=mxClient.language?"askZoom":"";mxEditor.prototype.lastSavedResource="none"!=mxClient.language?"lastSaved":"";mxEditor.prototype.currentFileResource="none"!=mxClient.language?"currentFile":"";
mxEditor.prototype.propertiesResource="none"!=mxClient.language?"properties":"";mxEditor.prototype.tasksResource="none"!=mxClient.language?"tasks":"";mxEditor.prototype.helpResource="none"!=mxClient.language?"help":"";mxEditor.prototype.outlineResource="none"!=mxClient.language?"outline":"";mxEditor.prototype.outline=null;mxEditor.prototype.graph=null;mxEditor.prototype.graphRenderHint=null;mxEditor.prototype.toolbar=null;mxEditor.prototype.session=null;mxEditor.prototype.status=null;
mxEditor.prototype.popupHandler=null;mxEditor.prototype.undoManager=null;mxEditor.prototype.keyHandler=null;mxEditor.prototype.actions=null;mxEditor.prototype.dblClickAction="edit";mxEditor.prototype.swimlaneRequired=!1;mxEditor.prototype.disableContextMenu=!0;mxEditor.prototype.insertFunction=null;mxEditor.prototype.forcedInserting=!1;mxEditor.prototype.templates=null;mxEditor.prototype.defaultEdge=null;mxEditor.prototype.defaultEdgeStyle=null;mxEditor.prototype.defaultGroup=null;
mxEditor.prototype.groupBorderSize=null;mxEditor.prototype.filename=null;mxEditor.prototype.linefeed="&#xa;";mxEditor.prototype.postParameterName="xml";mxEditor.prototype.escapePostData=!0;mxEditor.prototype.urlPost=null;mxEditor.prototype.urlImage=null;mxEditor.prototype.urlInit=null;mxEditor.prototype.urlNotify=null;mxEditor.prototype.urlPoll=null;mxEditor.prototype.horizontalFlow=!1;mxEditor.prototype.layoutDiagram=!1;mxEditor.prototype.swimlaneSpacing=0;mxEditor.prototype.maintainSwimlanes=!1;
mxEditor.prototype.layoutSwimlanes=!1;mxEditor.prototype.cycleAttributeValues=null;mxEditor.prototype.cycleAttributeIndex=0;mxEditor.prototype.cycleAttributeName="fillColor";mxEditor.prototype.tasks=null;mxEditor.prototype.tasksWindowImage=null;mxEditor.prototype.tasksTop=20;mxEditor.prototype.help=null;mxEditor.prototype.helpWindowImage=null;mxEditor.prototype.urlHelp=null;mxEditor.prototype.helpWidth=300;mxEditor.prototype.helpHeight=260;mxEditor.prototype.propertiesWidth=240;
mxEditor.prototype.propertiesHeight=null;mxEditor.prototype.movePropertiesDialog=!1;mxEditor.prototype.validating=!1;mxEditor.prototype.modified=!1;mxEditor.prototype.isModified=function(){return this.modified};mxEditor.prototype.setModified=function(a){this.modified=a};
mxEditor.prototype.addActions=function(){this.addAction("save",function(a){a.save()});this.addAction("print",function(a){(new mxPrintPreview(a.graph,1)).open()});this.addAction("show",function(a){mxUtils.show(a.graph,null,10,10)});this.addAction("exportImage",function(a){var b=a.getUrlImage();if(null==b||mxClient.IS_LOCAL)a.execute("show");else{var c=mxUtils.getViewXml(a.graph,1),c=mxUtils.getXml(c,"\n");mxUtils.submit(b,a.postParameterName+"="+encodeURIComponent(c),document,"_blank")}});this.addAction("refresh",
function(a){a.graph.refresh()});this.addAction("cut",function(a){a.graph.isEnabled()&&mxClipboard.cut(a.graph)});this.addAction("copy",function(a){a.graph.isEnabled()&&mxClipboard.copy(a.graph)});this.addAction("paste",function(a){a.graph.isEnabled()&&mxClipboard.paste(a.graph)});this.addAction("delete",function(a){a.graph.isEnabled()&&a.graph.removeCells()});this.addAction("group",function(a){a.graph.isEnabled()&&a.graph.setSelectionCell(a.groupCells())});this.addAction("ungroup",function(a){a.graph.isEnabled()&&
a.graph.setSelectionCells(a.graph.ungroupCells())});this.addAction("removeFromParent",function(a){a.graph.isEnabled()&&a.graph.removeCellsFromParent()});this.addAction("undo",function(a){a.graph.isEnabled()&&a.undo()});this.addAction("redo",function(a){a.graph.isEnabled()&&a.redo()});this.addAction("zoomIn",function(a){a.graph.zoomIn()});this.addAction("zoomOut",function(a){a.graph.zoomOut()});this.addAction("actualSize",function(a){a.graph.zoomActual()});this.addAction("fit",function(a){a.graph.fit()});
this.addAction("showProperties",function(a,b){a.showProperties(b)});this.addAction("selectAll",function(a){a.graph.isEnabled()&&a.graph.selectAll()});this.addAction("selectNone",function(a){a.graph.isEnabled()&&a.graph.clearSelection()});this.addAction("selectVertices",function(a){a.graph.isEnabled()&&a.graph.selectVertices()});this.addAction("selectEdges",function(a){a.graph.isEnabled()&&a.graph.selectEdges()});this.addAction("edit",function(a,b){a.graph.isEnabled()&&a.graph.isCellEditable(b)&&a.graph.startEditingAtCell(b)});
this.addAction("toBack",function(a){a.graph.isEnabled()&&a.graph.orderCells(!0)});this.addAction("toFront",function(a){a.graph.isEnabled()&&a.graph.orderCells(!1)});this.addAction("enterGroup",function(a,b){a.graph.enterGroup(b)});this.addAction("exitGroup",function(a){a.graph.exitGroup()});this.addAction("home",function(a){a.graph.home()});this.addAction("selectPrevious",function(a){a.graph.isEnabled()&&a.graph.selectPreviousCell()});this.addAction("selectNext",function(a){a.graph.isEnabled()&&a.graph.selectNextCell()});
this.addAction("selectParent",function(a){a.graph.isEnabled()&&a.graph.selectParentCell()});this.addAction("selectChild",function(a){a.graph.isEnabled()&&a.graph.selectChildCell()});this.addAction("collapse",function(a){a.graph.isEnabled()&&a.graph.foldCells(!0)});this.addAction("collapseAll",function(a){if(a.graph.isEnabled()){var b=a.graph.getChildVertices();a.graph.foldCells(!0,!1,b)}});this.addAction("expand",function(a){a.graph.isEnabled()&&a.graph.foldCells(!1)});this.addAction("expandAll",
function(a){if(a.graph.isEnabled()){var b=a.graph.getChildVertices();a.graph.foldCells(!1,!1,b)}});this.addAction("bold",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)});this.addAction("italic",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)});this.addAction("underline",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)});
this.addAction("shadow",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_SHADOW)});this.addAction("alignCellsLeft",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_LEFT)});this.addAction("alignCellsCenter",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_CENTER)});this.addAction("alignCellsRight",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_RIGHT)});this.addAction("alignCellsTop",
function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_TOP)});this.addAction("alignCellsMiddle",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_MIDDLE)});this.addAction("alignCellsBottom",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_BOTTOM)});this.addAction("alignFontLeft",function(a){a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)});this.addAction("alignFontCenter",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_ALIGN,
mxConstants.ALIGN_CENTER)});this.addAction("alignFontRight",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)});this.addAction("alignFontTop",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)});this.addAction("alignFontMiddle",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)});this.addAction("alignFontBottom",function(a){a.graph.isEnabled()&&
a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)});this.addAction("zoom",function(a){var b=100*a.graph.getView().scale,b=parseFloat(mxUtils.prompt(mxResources.get(a.askZoomResource)||a.askZoomResource,b))/100;isNaN(b)||a.graph.getView().setScale(b)});this.addAction("toggleTasks",function(a){null!=a.tasks?a.tasks.setVisible(!a.tasks.isVisible()):a.showTasks()});this.addAction("toggleHelp",function(a){null!=a.help?a.help.setVisible(!a.help.isVisible()):a.showHelp()});
this.addAction("toggleOutline",function(a){null==a.outline?a.showOutline():a.outline.setVisible(!a.outline.isVisible())});this.addAction("toggleConsole",function(){mxLog.setVisible(!mxLog.isVisible())})};mxEditor.prototype.createSession=function(){return this.connect(this.urlInit,this.urlPoll,this.urlNotify,mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.SESSION,"session",a))}))};
mxEditor.prototype.configure=function(a){null!=a&&((new mxCodec(a.ownerDocument)).decode(a,this),this.resetHistory())};mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"};mxEditor.prototype.resetHistory=function(){this.lastSnapshot=(new Date).getTime();this.undoManager.clear();this.ignoredChanges=0;this.setModified(!1)};mxEditor.prototype.addAction=function(a,b){this.actions[a]=b};
mxEditor.prototype.execute=function(a,b,c){var d=this.actions[a];if(null!=d)try{var e=arguments;e[0]=this;d.apply(this,e)}catch(f){throw mxUtils.error("Cannot execute "+a+": "+f.message,280,!0),f;}else mxUtils.error("Cannot find action "+a,280,!0)};mxEditor.prototype.addTemplate=function(a,b){this.templates[a]=b};mxEditor.prototype.getTemplate=function(a){return this.templates[a]};
mxEditor.prototype.createGraph=function(){var a=new mxGraph(null,null,this.graphRenderHint);a.setTooltips(!0);a.setPanning(!0);this.installDblClickHandler(a);this.installUndoHandler(a);this.installDrillHandler(a);this.installChangeHandler(a);this.installInsertHandler(a);a.panningHandler.factoryMethod=mxUtils.bind(this,function(a,c,d){return this.createPopupMenu(a,c,d)});a.connectionHandler.factoryMethod=mxUtils.bind(this,function(a,c){return this.createEdge(a,c)});this.createSwimlaneManager(a);this.createLayoutManager(a);
return a};mxEditor.prototype.createSwimlaneManager=function(a){a=new mxSwimlaneManager(a,!1);a.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow});a.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes});return a};
mxEditor.prototype.createLayoutManager=function(a){var b=new mxLayoutManager(a),c=this;b.getLayout=function(b){var e=null,f=c.graph.getModel();if(null!=f.getParent(b))if(c.layoutSwimlanes&&a.isSwimlane(b))null==c.swimlaneLayout&&(c.swimlaneLayout=c.createSwimlaneLayout()),e=c.swimlaneLayout;else if(c.layoutDiagram&&(a.isValidRoot(b)||null==f.getParent(f.getParent(b))))null==c.diagramLayout&&(c.diagramLayout=c.createDiagramLayout()),e=c.diagramLayout;return e};return b};
mxEditor.prototype.setGraphContainer=function(a){null==this.graph.container&&(this.graph.init(a),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(a),mxClient.IS_QUIRKS&&new mxDivResizer(a))};mxEditor.prototype.installDblClickHandler=function(a){a.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(b,c){var d=c.getProperty("cell");null!=d&&a.isEnabled()&&null!=this.dblClickAction&&(this.execute(this.dblClickAction,d),c.consume())}))};
mxEditor.prototype.installUndoHandler=function(a){var b=mxUtils.bind(this,function(a,b){this.undoManager.undoableEditHappened(b.getProperty("edit"))});a.getModel().addListener(mxEvent.UNDO,b);a.getView().addListener(mxEvent.UNDO,b);b=function(b,d){var e=d.getProperty("edit").changes;a.setSelectionCells(a.getSelectionCellsForChanges(e))};this.undoManager.addListener(mxEvent.UNDO,b);this.undoManager.addListener(mxEvent.REDO,b)};
mxEditor.prototype.installDrillHandler=function(a){var b=mxUtils.bind(this,function(){this.fireEvent(new mxEventObject(mxEvent.ROOT))});a.getView().addListener(mxEvent.DOWN,b);a.getView().addListener(mxEvent.UP,b)};
mxEditor.prototype.installChangeHandler=function(a){var b=mxUtils.bind(this,function(b,d){this.setModified(!0);!0==this.validating&&a.validateGraph();for(var e=d.getProperty("edit").changes,f=0;f<e.length;f++){var g=e[f];if(g instanceof mxRootChange||g instanceof mxValueChange&&g.cell==this.graph.model.root||g instanceof mxCellAttributeChange&&g.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}});a.getModel().addListener(mxEvent.CHANGE,b)};
mxEditor.prototype.installInsertHandler=function(a){var b=this;a.addMouseListener({mouseDown:function(a,d){if(null!=b.insertFunction&&!d.isPopupTrigger()&&(b.forcedInserting||null==d.getState()))b.graph.clearSelection(),b.insertFunction(d.getEvent(),d.getCell()),this.isActive=!0,d.consume()},mouseMove:function(a,b){this.isActive&&b.consume()},mouseUp:function(a,b){this.isActive&&(this.isActive=!1,b.consume())}})};
mxEditor.prototype.createDiagramLayout=function(){var a=this.graph.gridSize,b=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*a,2*a);b.isVertexIgnored=function(a){return!b.graph.isSwimlane(a)};return b};mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)};mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)};
mxEditor.prototype.setToolbarContainer=function(a){this.toolbar.init(a);mxClient.IS_QUIRKS&&new mxDivResizer(a)};
mxEditor.prototype.setStatusContainer=function(a){null==this.status&&(this.status=a,this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var a=(new Date).toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+a)})),this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)})),mxClient.IS_QUIRKS&&new mxDivResizer(a))};
mxEditor.prototype.setStatus=function(a){null!=this.status&&null!=a&&(this.status.innerHTML=a)};mxEditor.prototype.setTitleContainer=function(a){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(){a.innerHTML=this.getTitle()}));mxClient.IS_QUIRKS&&new mxDivResizer(a)};mxEditor.prototype.treeLayout=function(a,b){null!=a&&(new mxCompactTreeLayout(this.graph,b)).execute(a)};
mxEditor.prototype.getTitle=function(){for(var a="",b=this.graph,c=b.getCurrentRoot();null!=c&&null!=b.getModel().getParent(b.getModel().getParent(c));)b.isValidRoot(c)&&(a=" > "+b.convertValueToString(c)+a),c=b.getModel().getParent(c);return this.getRootTitle()+a};mxEditor.prototype.getRootTitle=function(){return this.graph.convertValueToString(this.graph.getModel().getRoot())};mxEditor.prototype.undo=function(){this.undoManager.undo()};mxEditor.prototype.redo=function(){this.undoManager.redo()};
mxEditor.prototype.groupCells=function(){var a=null!=this.groupBorderSize?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),a)};mxEditor.prototype.createGroup=function(){return this.graph.getModel().cloneCell(this.defaultGroup)};mxEditor.prototype.open=function(a){null!=a&&(this.readGraphModel(mxUtils.load(a).getXml().documentElement),this.filename=a,this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",a)))};
mxEditor.prototype.readGraphModel=function(a){(new mxCodec(a.ownerDocument)).decode(a,this.graph.getModel());this.resetHistory()};mxEditor.prototype.save=function(a,b){a=a||this.getUrlPost();if(null!=a&&0<a.length){var c=this.writeGraphModel(b);this.postDiagram(a,c);this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",a))};
mxEditor.prototype.postDiagram=function(a,b){this.escapePostData&&(b=encodeURIComponent(b));mxUtils.post(a,this.postParameterName+"="+b,mxUtils.bind(this,function(c){this.fireEvent(new mxEventObject(mxEvent.POST,"request",c,"url",a,"data",b))}))};mxEditor.prototype.writeGraphModel=function(a){var a=null!=a?a:this.linefeed,b=(new mxCodec).encode(this.graph.getModel());return mxUtils.getXml(b,a)};mxEditor.prototype.getUrlPost=function(){return this.urlPost};mxEditor.prototype.getUrlImage=function(){return this.urlImage};
mxEditor.prototype.connect=function(a,b,c,d){var e=null;mxClient.IS_LOCAL||(e=new mxSession(this.graph.getModel(),a,b,c),e.addListener(mxEvent.RECEIVE,mxUtils.bind(this,function(a,b){null!=b.getProperty("node").getAttribute("namespace")&&this.resetHistory()})),e.addListener(mxEvent.DISCONNECT,d),e.addListener(mxEvent.CONNECT,d),e.addListener(mxEvent.NOTIFY,d),e.addListener(mxEvent.GET,d),e.start());return e};
mxEditor.prototype.swapStyles=function(a,b){var c=this.graph.getStylesheet().styles[b];this.graph.getView().getStylesheet().putCellStyle(b,this.graph.getStylesheet().styles[a]);this.graph.getStylesheet().putCellStyle(a,c);this.graph.refresh()};
mxEditor.prototype.showProperties=function(a){a=a||this.graph.getSelectionCell();null==a&&(a=this.graph.getCurrentRoot(),null==a&&(a=this.graph.getModel().getRoot()));if(null!=a){this.graph.stopEditing(!0);var b=mxUtils.getOffset(this.graph.container),c=b.x+10,b=b.y;if(null!=this.properties&&!this.movePropertiesDialog)c=this.properties.getX(),b=this.properties.getY();else{var d=this.graph.getCellBounds(a);null!=d&&(c+=d.x+Math.min(200,d.width),b+=d.y)}this.hideProperties();a=this.createProperties(a);
null!=a&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,a,c,b,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}};mxEditor.prototype.isPropertiesVisible=function(){return null!=this.properties};
mxEditor.prototype.createProperties=function(a){var b=this.graph.getModel(),c=b.getValue(a);if(mxUtils.isNode(c)){var d=new mxForm("properties");d.addText("ID",a.getId()).setAttribute("readonly","true");var e=null,f=null,g=null,h=null,k=null;b.isVertex(a)&&(e=b.getGeometry(a),null!=e&&(f=d.addText("top",e.y),g=d.addText("left",e.x),h=d.addText("width",e.width),k=d.addText("height",e.height)));for(var l=b.getStyle(a),n=d.addText("Style",l||""),o=c.attributes,p=[],c=0;c<o.length;c++)p[c]=d.addTextarea(o[c].nodeName,
o[c].nodeValue,"label"==o[c].nodeName?4:2);c=mxUtils.bind(this,function(){this.hideProperties();b.beginUpdate();try{null!=e&&(e=e.clone(),e.x=parseFloat(g.value),e.y=parseFloat(f.value),e.width=parseFloat(h.value),e.height=parseFloat(k.value),b.setGeometry(a,e));0<n.value.length?b.setStyle(a,n.value):b.setStyle(a,null);for(var c=0;c<o.length;c++){var d=new mxCellAttributeChange(a,o[c].nodeName,p[c].value);b.execute(d)}this.graph.isAutoSizeCell(a)&&this.graph.updateCellSize(a)}finally{b.endUpdate()}});
l=mxUtils.bind(this,function(){this.hideProperties()});d.addButtons(c,l);return d.table}return null};mxEditor.prototype.hideProperties=function(){null!=this.properties&&(this.properties.destroy(),this.properties=null)};
mxEditor.prototype.showTasks=function(){if(null==this.tasks){var a=document.createElement("div");a.style.padding="4px";a.style.paddingLeft="20px";var b=document.body.clientWidth,b=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,a,b-220,this.tasksTop,200);b.setClosable(!0);b.destroyOnClose=!1;var c=mxUtils.bind(this,function(){mxEvent.release(a);a.innerHTML="";this.createTasks(a)});this.graph.getModel().addListener(mxEvent.CHANGE,c);this.graph.getSelectionModel().addListener(mxEvent.CHANGE,
c);this.graph.addListener(mxEvent.ROOT,c);null!=this.tasksWindowImage&&b.setImage(this.tasksWindowImage);this.tasks=b;this.createTasks(a)}this.tasks.setVisible(!0)};mxEditor.prototype.refreshTasks=function(a){null!=this.tasks&&(a=this.tasks.content,mxEvent.release(a),a.innerHTML="",this.createTasks(a))};mxEditor.prototype.createTasks=function(){};
mxEditor.prototype.showHelp=function(){if(null==this.help){var a=document.createElement("iframe");a.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp);a.setAttribute("height","100%");a.setAttribute("width","100%");a.setAttribute("frameBorder","0");a.style.backgroundColor="white";var b=document.body.clientWidth,c=document.body.clientHeight||document.documentElement.clientHeight,d=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,a,(b-this.helpWidth)/2,(c-this.helpHeight)/
3,this.helpWidth,this.helpHeight);d.setMaximizable(!0);d.setClosable(!0);d.destroyOnClose=!1;d.setResizable(!0);null!=this.helpWindowImage&&d.setImage(this.helpWindowImage);mxClient.IS_NS&&(b=function(){a.setAttribute("height",d.div.offsetHeight-26+"px")},d.addListener(mxEvent.RESIZE_END,b),d.addListener(mxEvent.MAXIMIZE,b),d.addListener(mxEvent.NORMALIZE,b),d.addListener(mxEvent.SHOW,b));this.help=d}this.help.setVisible(!0)};
mxEditor.prototype.showOutline=function(){if(null==this.outline){var a=document.createElement("div");a.style.overflow="hidden";a.style.width="100%";a.style.height="100%";a.style.background="white";a.style.cursor="move";var b=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,a,600,480,200,200,!1),c=new mxOutline(this.graph,a);b.setClosable(!0);b.setResizable(!0);b.destroyOnClose=!1;b.addListener(mxEvent.RESIZE_END,function(){c.update()});this.outline=b;this.outline.outline=c}this.outline.setVisible(!0);
this.outline.outline.update(!0)};mxEditor.prototype.setMode=function(a){"select"==a?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):"connect"==a?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):"pan"==a&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))};mxEditor.prototype.createPopupMenu=function(a,b,c){this.popupHandler.createMenu(this,a,b,c)};
mxEditor.prototype.createEdge=function(){var a=null;if(null!=this.defaultEdge)a=this.graph.getModel().cloneCell(this.defaultEdge);else{a=new mxCell("");a.setEdge(!0);var b=new mxGeometry;b.relative=!0;a.setGeometry(b)}b=this.getEdgeStyle();null!=b&&a.setStyle(b);return a};mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle};
mxEditor.prototype.consumeCycleAttribute=function(a){return null!=this.cycleAttributeValues&&0<this.cycleAttributeValues.length&&this.graph.isSwimlane(a)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null};mxEditor.prototype.cycleAttribute=function(a){if(null!=this.cycleAttributeName){var b=this.consumeCycleAttribute(a);null!=b&&a.setStyle(a.getStyle()+";"+this.cycleAttributeName+"="+b)}};
mxEditor.prototype.addVertex=function(a,b,c,d){for(var e=this.graph.getModel();null!=a&&!this.graph.isValidDropTarget(a);)a=e.getParent(a);var a=null!=a?a:this.graph.getSwimlaneAt(c,d),f=this.graph.getView().scale,g=e.getGeometry(b),h=e.getGeometry(a);if(this.graph.isSwimlane(b)&&!this.graph.swimlaneNesting)a=null;else{if(null==a&&this.swimlaneRequired)return null;if(null!=a&&null!=h){var k=this.graph.getView().getState(a);if(null!=k){if(c-=k.origin.x*f,d-=k.origin.y*f,this.graph.isConstrainedMoving){var h=
g.width,l=g.height,n=k.x+k.width;c+h>n&&(c-=c+h-n);n=k.y+k.height;d+l>n&&(d-=d+l-n)}}else null!=h&&(c-=h.x*f,d-=h.y*f)}}g=g.clone();g.x=this.graph.snap(c/f-this.graph.getView().translate.x-this.graph.gridSize/2);g.y=this.graph.snap(d/f-this.graph.getView().translate.y-this.graph.gridSize/2);b.setGeometry(g);null==a&&(a=this.graph.getDefaultParent());this.cycleAttribute(b);this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",b,"parent",a));e.beginUpdate();try{b=this.graph.addCell(b,
a),null!=b&&(this.graph.constrainChild(b),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",b)))}finally{e.endUpdate()}null!=b&&(this.graph.setSelectionCell(b),this.graph.scrollCellToVisible(b),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",b)));return b};
mxEditor.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tasks&&this.tasks.destroy(),null!=this.outline&&this.outline.destroy(),null!=this.properties&&this.properties.destroy(),null!=this.keyHandler&&this.keyHandler.destroy(),null!=this.rubberband&&this.rubberband.destroy(),null!=this.toolbar&&this.toolbar.destroy(),null!=this.graph&&this.graph.destroy(),this.templates=this.status=null)};
var mxCodecRegistry={codecs:[],aliases:[],register:function(a){if(null!=a){var b=a.getName();mxCodecRegistry.codecs[b]=a;var c=mxUtils.getFunctionName(a.template.constructor);c!=b&&mxCodecRegistry.addAlias(c,b)}return a},addAlias:function(a,b){mxCodecRegistry.aliases[a]=b},getCodec:function(a){var b=null;if(null!=a){var b=mxUtils.getFunctionName(a),c=mxCodecRegistry.aliases[b];null!=c&&(b=c);b=mxCodecRegistry.codecs[b];if(null==b)try{b=new mxObjectCodec(new a),mxCodecRegistry.register(b)}catch(d){}}return b}};
function mxCodec(a){this.document=a||mxUtils.createXmlDocument();this.objects=[]}mxCodec.prototype.document=null;mxCodec.prototype.objects=null;mxCodec.prototype.encodeDefaults=!1;mxCodec.prototype.putObject=function(a,b){return this.objects[a]=b};mxCodec.prototype.getObject=function(a){var b=null;null!=a&&(b=this.objects[a],null==b&&(b=this.lookup(a),null==b&&(a=this.getElementById(a),null!=a&&(b=this.decode(a)))));return b};mxCodec.prototype.lookup=function(){return null};
mxCodec.prototype.getElementById=function(a,b){return mxUtils.findNodeByAttribute(this.document.documentElement,null!=b?b:"id",a)};mxCodec.prototype.getId=function(a){var b=null;null!=a&&(b=this.reference(a),null==b&&a instanceof mxCell&&(b=a.getId(),null==b&&(b=mxCellPath.create(a),0==b.length&&(b="root"))));return b};mxCodec.prototype.reference=function(){return null};
mxCodec.prototype.encode=function(a){var b=null;if(null!=a&&null!=a.constructor){var c=mxCodecRegistry.getCodec(a.constructor);null!=c?b=c.encode(this,a):mxUtils.isNode(a)?b=mxClient.IS_IE?a.cloneNode(!0):this.document.importNode(a,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(a.constructor))}return b};
mxCodec.prototype.decode=function(a,b){var c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){var d=null;try{d=eval(a.nodeName)}catch(e){}try{var f=mxCodecRegistry.getCodec(d);null!=f?c=f.decode(this,a,b):(c=a.cloneNode(!0),c.removeAttribute("as"))}catch(g){mxLog.debug("Cannot decode "+a.nodeName+": "+g.message)}}return c};mxCodec.prototype.encodeCell=function(a,b,c){b.appendChild(this.encode(a));if(null==c||c)for(var c=a.getChildCount(),d=0;d<c;d++)this.encodeCell(a.getChildAt(d),b)};
mxCodec.prototype.isCellCodec=function(a){return null!=a&&"function"==typeof a.isCellCodec?a.isCellCodec():!1};mxCodec.prototype.decodeCell=function(a,b){var b=null!=b?b:!0,c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){c=mxCodecRegistry.getCodec(a.nodeName);if(!this.isCellCodec(c))for(var d=a.firstChild;null!=d&&!this.isCellCodec(c);)c=mxCodecRegistry.getCodec(d.nodeName),d=d.nextSibling;this.isCellCodec(c)||(c=mxCodecRegistry.getCodec(mxCell));c=c.decode(this,a);b&&this.insertIntoGraph(c)}return c};
mxCodec.prototype.insertIntoGraph=function(a){var b=a.parent,c=a.getTerminal(!0),d=a.getTerminal(!1);a.setTerminal(null,!1);a.setTerminal(null,!0);a.parent=null;null!=b&&b.insert(a);null!=c&&c.insertEdge(a,!0);null!=d&&d.insertEdge(a,!1)};mxCodec.prototype.setAttribute=function(a,b,c){null!=b&&null!=c&&a.setAttribute(b,c)};
function mxObjectCodec(a,b,c,d){this.template=a;this.exclude=null!=b?b:[];this.idrefs=null!=c?c:[];this.mapping=null!=d?d:[];this.reverse={};for(var e in this.mapping)this.reverse[this.mapping[e]]=e}mxObjectCodec.prototype.template=null;mxObjectCodec.prototype.exclude=null;mxObjectCodec.prototype.idrefs=null;mxObjectCodec.prototype.mapping=null;mxObjectCodec.prototype.reverse=null;mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)};
mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor};mxObjectCodec.prototype.getFieldName=function(a){if(null!=a){var b=this.reverse[a];null!=b&&(a=b)}return a};mxObjectCodec.prototype.getAttributeName=function(a){if(null!=a){var b=this.mapping[a];null!=b&&(a=b)}return a};mxObjectCodec.prototype.isExcluded=function(a,b){return b==mxObjectIdentity.FIELD_NAME||0<=mxUtils.indexOf(this.exclude,b)};
mxObjectCodec.prototype.isReference=function(a,b){return 0<=mxUtils.indexOf(this.idrefs,b)};mxObjectCodec.prototype.encode=function(a,b){var c=a.document.createElement(this.getName()),b=this.beforeEncode(a,b,c);this.encodeObject(a,b,c);return this.afterEncode(a,b,c)};mxObjectCodec.prototype.encodeObject=function(a,b,c){a.setAttribute(c,"id",a.getId(b));for(var d in b){var e=d,f=b[e];null!=f&&!this.isExcluded(b,e,f,!0)&&(mxUtils.isNumeric(e)&&(e=null),this.encodeValue(a,b,e,f,c))}};
mxObjectCodec.prototype.encodeValue=function(a,b,c,d,e){if(null!=d){if(this.isReference(b,c,d,!0)){var f=a.getId(d);if(null==f){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+c+"="+d);return}d=f}f=this.template[c];if(null==c||a.encodeDefaults||f!=d)c=this.getAttributeName(c),this.writeAttribute(a,b,c,d,e)}};mxObjectCodec.prototype.writeAttribute=function(a,b,c,d,e){"object"!=typeof d?this.writePrimitiveAttribute(a,b,c,d,e):this.writeComplexAttribute(a,b,c,d,e)};
mxObjectCodec.prototype.writePrimitiveAttribute=function(a,b,c,d,e){d=this.convertValueToXml(d);null==c?(b=a.document.createElement("add"),"function"==typeof d?b.appendChild(a.document.createTextNode(d)):a.setAttribute(b,"value",d),e.appendChild(b)):"function"!=typeof d&&a.setAttribute(e,c,d)};
mxObjectCodec.prototype.writeComplexAttribute=function(a,b,c,d,e){a=a.encode(d);null!=a?(null!=c&&a.setAttribute("as",c),e.appendChild(a)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+c+": "+d)};mxObjectCodec.prototype.convertValueToXml=function(a){if("undefined"==typeof a.length&&(!0==a||!1==a))a=!0==a?"1":"0";return a};mxObjectCodec.prototype.convertValueFromXml=function(a){mxUtils.isNumeric(a)&&(a=parseFloat(a));return a};mxObjectCodec.prototype.beforeEncode=function(a,b){return b};
mxObjectCodec.prototype.afterEncode=function(a,b,c){return c};mxObjectCodec.prototype.decode=function(a,b,c){var d=b.getAttribute("id"),e=a.objects[d];null==e&&(e=c||this.cloneTemplate(),null!=d&&a.putObject(d,e));b=this.beforeDecode(a,b,e);this.decodeNode(a,b,e);return this.afterDecode(a,b,e)};mxObjectCodec.prototype.decodeNode=function(a,b,c){null!=b&&(this.decodeAttributes(a,b,c),this.decodeChildren(a,b,c))};
mxObjectCodec.prototype.decodeAttributes=function(a,b,c){b=b.attributes;if(null!=b)for(var d=0;d<b.length;d++)this.decodeAttribute(a,b[d],c)};mxObjectCodec.prototype.decodeAttribute=function(a,b,c){var d=b.nodeName;if("as"!=d&&"id"!=d){var b=this.convertValueFromXml(b.nodeValue),e=this.getFieldName(d);if(this.isReference(c,e,b,!1)){a=a.getObject(b);if(null==a){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+d+"="+b);return}b=a}this.isExcluded(c,d,b,!1)||(c[d]=b)}};
mxObjectCodec.prototype.decodeChildren=function(a,b,c){for(b=b.firstChild;null!=b;){var d=b.nextSibling;b.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,b,c)&&this.decodeChild(a,b,c);b=d}};
mxObjectCodec.prototype.decodeChild=function(a,b,c){var d=this.getFieldName(b.getAttribute("as"));if(null==d||!this.isExcluded(c,d,b,!1)){var e=this.getFieldTemplate(c,d,b),f=null;"add"==b.nodeName?(f=b.getAttribute("value"),null==f&&(f=mxUtils.eval(mxUtils.getTextContent(b)))):f=a.decode(b,e);this.addObjectValue(c,d,f,e)}};mxObjectCodec.prototype.getFieldTemplate=function(a,b){var c=a[b];c instanceof Array&&0<c.length&&(c=null);return c};
mxObjectCodec.prototype.addObjectValue=function(a,b,c,d){null!=c&&c!=d&&(null!=b&&0<b.length?a[b]=c:a.push(c))};mxObjectCodec.prototype.processInclude=function(a,b,c){if("include"==b.nodeName){b=b.getAttribute("name");if(null!=b)try{var d=mxUtils.load(b).getDocumentElement();null!=d&&a.decode(d,c)}catch(e){}return!0}return!1};mxObjectCodec.prototype.beforeDecode=function(a,b){return b};mxObjectCodec.prototype.afterDecode=function(a,b,c){return c};
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"]);a.isCellCodec=function(){return!0};a.isExcluded=function(a,c,d,e){return mxObjectCodec.prototype.isExcluded.apply(this,arguments)||e&&"value"==c&&d.nodeType==mxConstants.NODETYPE_ELEMENT};a.afterEncode=function(a,c,d){if(null!=c.value&&c.value.nodeType==mxConstants.NODETYPE_ELEMENT){var e=d,d=mxClient.IS_IE?c.value.cloneNode(!0):a.document.importNode(c.value,
!0);d.appendChild(e);a=e.getAttribute("id");d.setAttribute("id",a);e.removeAttribute("id")}return d};a.beforeDecode=function(a,c,d){var e=c,f=this.getName();c.nodeName!=f?(e=c.getElementsByTagName(f)[0],null!=e&&e.parentNode==c?(mxUtils.removeWhitespace(e,!0),mxUtils.removeWhitespace(e,!1),e.parentNode.removeChild(e)):e=null,d.value=c.cloneNode(!0),c=d.value.getAttribute("id"),null!=c&&(d.setId(c),d.value.removeAttribute("id"))):d.setId(c.getAttribute("id"));if(null!=e)for(c=0;c<this.idrefs.length;c++){var f=
this.idrefs[c],g=e.getAttribute(f);if(null!=g){e.removeAttribute(f);var h=a.objects[g]||a.lookup(g);null==h&&(g=a.getElementById(g),null!=g&&(h=(mxCodecRegistry.codecs[g.nodeName]||this).decode(a,g)));d[f]=h}}return e};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxGraphModel);a.encodeObject=function(a,c,d){var e=a.document.createElement("root");a.encodeCell(c.getRoot(),e);d.appendChild(e)};a.decodeChild=function(a,c,d){"root"==c.nodeName?this.decodeRoot(a,c,d):mxObjectCodec.prototype.decodeChild.apply(this,arguments)};a.decodeRoot=function(a,c,d){for(var e=null,c=c.firstChild;null!=c;){var f=a.decodeCell(c);null!=f&&null==f.getParent()&&(e=f);c=c.nextSibling}null!=e&&d.setRoot(e)};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxRootChange,["model","previous","root"]);a.afterEncode=function(a,c,d){a.encodeCell(c.root,d);return d};a.beforeDecode=function(a,c,d){if(null!=c.firstChild&&c.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){var c=c.cloneNode(!0),e=c.firstChild;d.root=a.decodeCell(e,!1);d=e.nextSibling;e.parentNode.removeChild(e);for(e=d;null!=e;)d=e.nextSibling,a.decodeCell(e),e.parentNode.removeChild(e),e=d}return c};a.afterDecode=function(a,c,
d){d.previous=d.root;return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxChildChange,["model","child","previousIndex"],["parent","previous"]);a.isReference=function(a,c,d,e){return"child"==c&&(null!=a.previous||!e)?!0:0<=mxUtils.indexOf(this.idrefs,c)};a.afterEncode=function(a,c,d){this.isReference(c,"child",c.child,!0)?d.setAttribute("child",a.getId(c.child)):a.encodeCell(c.child,d);return d};a.beforeDecode=function(a,c,d){if(null!=c.firstChild&&c.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){var c=
c.cloneNode(!0),e=c.firstChild;d.child=a.decodeCell(e,!1);d=e.nextSibling;e.parentNode.removeChild(e);for(e=d;null!=e;){d=e.nextSibling;if(e.nodeType==mxConstants.NODETYPE_ELEMENT){var f=e.getAttribute("id");null==a.lookup(f)&&a.decodeCell(e)}e.parentNode.removeChild(e);e=d}}else e=c.getAttribute("child"),d.child=a.getObject(e);return c};a.afterDecode=function(a,c,d){d.child.parent=d.previous;d.previous=d.parent;d.previousIndex=d.index;return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxTerminalChange,["model","previous"],["cell","terminal"]);a.afterDecode=function(a,c,d){d.previous=d.terminal;return d};return a}());var mxGenericChangeCodec=function(a,b){var c=new mxObjectCodec(a,["model","previous"],["cell"]);c.afterDecode=function(a,c,f){mxUtils.isNode(f.cell)&&(f.cell=a.decodeCell(f.cell,!1));f.previous=f[b];return f};return c};mxCodecRegistry.register(mxGenericChangeCodec(new mxValueChange,"value"));
mxCodecRegistry.register(mxGenericChangeCodec(new mxStyleChange,"style"));mxCodecRegistry.register(mxGenericChangeCodec(new mxGeometryChange,"geometry"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCollapseChange,"collapsed"));mxCodecRegistry.register(mxGenericChangeCodec(new mxVisibleChange,"visible"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCellAttributeChange,"value"));mxCodecRegistry.register(function(){return new mxObjectCodec(new mxGraph,"graphListeners,eventListeners,view,container,cellRenderer,editor,selection".split(","))}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxGraphView);a.encode=function(a,c){return this.encodeCell(a,c,c.graph.getModel().getRoot())};a.encodeCell=function(a,c,d){var e=c.graph.getModel(),f=c.getState(d),g=e.getParent(d);if(null==g||null!=f){var h=e.getChildCount(d),k=c.graph.getCellGeometry(d),l=null;g==e.getRoot()?l="layer":null==g?l="graph":e.isEdge(d)?l="edge":0<h&&null!=k?l="group":e.isVertex(d)&&(l="vertex");if(null!=l){var n=a.document.createElement(l);null!=c.graph.getLabel(d)&&
(n.setAttribute("label",c.graph.getLabel(d)),c.graph.isHtmlLabel(d)&&n.setAttribute("html",!0));if(null==g){var o=c.getGraphBounds();null!=o&&(n.setAttribute("x",Math.round(o.x)),n.setAttribute("y",Math.round(o.y)),n.setAttribute("width",Math.round(o.width)),n.setAttribute("height",Math.round(o.height)));n.setAttribute("scale",c.scale)}else if(null!=f&&null!=k){for(o in f.style)g=f.style[o],"function"==typeof g&&"object"==typeof g&&(g=mxStyleRegistry.getName(g)),null!=g&&"function"!=typeof g&&"object"!=
typeof g&&n.setAttribute(o,g);g=f.absolutePoints;if(null!=g&&0<g.length){k=Math.round(g[0].x)+","+Math.round(g[0].y);for(o=1;o<g.length;o++)k+=" "+Math.round(g[o].x)+","+Math.round(g[o].y);n.setAttribute("points",k)}else n.setAttribute("x",Math.round(f.x)),n.setAttribute("y",Math.round(f.y)),n.setAttribute("width",Math.round(f.width)),n.setAttribute("height",Math.round(f.height));o=f.absoluteOffset;null!=o&&(0!=o.x&&n.setAttribute("dx",Math.round(o.x)),0!=o.y&&n.setAttribute("dy",Math.round(o.y)))}for(o=
0;o<h;o++)f=this.encodeCell(a,c,e.getChildAt(d,o)),null!=f&&n.appendChild(f)}}return n};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxStylesheet);a.encode=function(a,c){var d=a.document.createElement(this.getName()),e;for(e in c.styles){var f=c.styles[e],g=a.document.createElement("add");if(null!=e){g.setAttribute("as",e);for(var h in f){var k=this.getStringValue(h,f[h]);if(null!=k){var l=a.document.createElement("add");l.setAttribute("value",k);l.setAttribute("as",h);g.appendChild(l)}}0<g.childNodes.length&&d.appendChild(g)}}return d};a.getStringValue=function(a,
c){var d=typeof c;"function"==d?c=mxStyleRegistry.getName(style[j]):"object"==d&&(c=null);return c};a.decode=function(a,c,d){var d=d||new this.template.constructor,e=c.getAttribute("id");null!=e&&(a.objects[e]=d);for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName&&(e=c.getAttribute("as"),null!=e)){var f=c.getAttribute("extend"),g=null!=f?mxUtils.clone(d.styles[f]):null;null==g&&(null!=f&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+f+" not found to extend"),g={});
for(f=c.firstChild;null!=f;){if(f.nodeType==mxConstants.NODETYPE_ELEMENT){var h=f.getAttribute("as");if("add"==f.nodeName){var k=mxUtils.getTextContent(f),l=null;null!=k&&0<k.length?l=mxUtils.eval(k):(l=f.getAttribute("value"),mxUtils.isNumeric(l)&&(l=parseFloat(l)));null!=l&&(g[h]=l)}else"remove"==f.nodeName&&delete g[h]}f=f.nextSibling}d.putCellStyle(e,g)}c=c.nextSibling}return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultKeyHandler);a.encode=function(){return null};a.decode=function(a,c,d){if(null!=d)for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName){var e=c.getAttribute("as"),f=c.getAttribute("action"),g=c.getAttribute("control");d.bindAction(e,f,g)}c=c.nextSibling}return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultToolbar);a.encode=function(){return null};a.decode=function(a,c,d){if(null!=d)for(var e=d.editor,c=c.firstChild;null!=c;){if(c.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,c,d))if("separator"==c.nodeName)d.addSeparator();else if("br"==c.nodeName)d.toolbar.addBreak();else if("hr"==c.nodeName)d.toolbar.addLine();else if("add"==c.nodeName){var f=c.getAttribute("as"),f=mxResources.get(f)||f,g=c.getAttribute("icon"),
h=c.getAttribute("pressedIcon"),k=c.getAttribute("action"),l=c.getAttribute("mode"),n=c.getAttribute("template"),o="0"!=c.getAttribute("toggle"),p=mxUtils.getTextContent(c),r=null;if(null!=k)r=d.addItem(f,g,k,h);else if(null!=l)var s=mxUtils.eval(p),r=d.addMode(f,g,l,h,s);else if(null!=n||null!=p&&0<p.length)r=e.templates[n],n=c.getAttribute("style"),null!=r&&null!=n&&(r=r.clone(),r.setStyle(n)),n=null,null!=p&&0<p.length&&(n=mxUtils.eval(p)),r=d.addPrototype(f,g,r,h,n,o);else if(h=mxUtils.getChildNodes(c),
0<h.length)if(null==g){n=d.addActionCombo(f);for(f=0;f<h.length;f++)o=h[f],"separator"==o.nodeName?d.addOption(n,"---"):"add"==o.nodeName&&(g=o.getAttribute("as"),o=o.getAttribute("action"),d.addActionOption(n,g,o))}else{var u=null,w=d.addPrototype(f,g,function(){var a=e.templates[u.value];if(null!=a){var a=a.clone(),b=u.options[u.selectedIndex].cellStyle;null!=b&&a.setStyle(b);return a}mxLog.warn("Template "+a+" not found");return null},null,null,o),u=d.addCombo();mxEvent.addListener(u,"change",
function(){d.toolbar.selectMode(w,function(a){a=mxUtils.convertPoint(e.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));return e.addVertex(null,s(),a.x,a.y)});d.toolbar.noReset=!1});for(f=0;f<h.length;f++)o=h[f],"separator"==o.nodeName?d.addOption(u,"---"):"add"==o.nodeName&&(g=o.getAttribute("as"),p=o.getAttribute("template"),d.addOption(u,g,p||n).cellStyle=o.getAttribute("style"))}null!=r&&(n=c.getAttribute("id"),null!=n&&0<n.length&&r.setAttribute("id",n))}c=c.nextSibling}return d};
return a}());mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultPopupMenu);a.encode=function(){return null};a.decode=function(a,c,d){var e=c.getElementsByTagName("include")[0];null!=e?this.processInclude(a,e,d):null!=d&&(d.config=c);return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxEditor,"modified,lastSnapshot,ignoredChanges,undoManager,graphContainer,toolbarContainer".split(","));a.afterDecode=function(a,c,d){a=c.getAttribute("defaultEdge");null!=a&&(c.removeAttribute("defaultEdge"),d.defaultEdge=d.templates[a]);a=c.getAttribute("defaultGroup");null!=a&&(c.removeAttribute("defaultGroup"),d.defaultGroup=d.templates[a]);return d};a.decodeChild=function(a,c,d){if("Array"==c.nodeName){if("templates"==c.getAttribute("as")){this.decodeTemplates(a,
c,d);return}}else if("ui"==c.nodeName){this.decodeUi(a,c,d);return}mxObjectCodec.prototype.decodeChild.apply(this,arguments)};a.decodeUi=function(a,c,d){for(a=c.firstChild;null!=a;){if("add"==a.nodeName){var c=a.getAttribute("as"),e=a.getAttribute("element"),f=a.getAttribute("style"),g=null;if(null!=e)g=document.getElementById(e),null!=g&&null!=f&&(g.style.cssText+=";"+f);else{var e=parseInt(a.getAttribute("x")),h=parseInt(a.getAttribute("y")),k=a.getAttribute("width"),l=a.getAttribute("height"),
g=document.createElement("div");g.style.cssText=f;(new mxWindow(mxResources.get(c)||c,g,e,h,k,l,!1,!0)).setVisible(!0)}"graph"==c?d.setGraphContainer(g):"toolbar"==c?d.setToolbarContainer(g):"title"==c?d.setTitleContainer(g):"status"==c?d.setStatusContainer(g):"map"==c&&d.setMapContainer(g)}else"resource"==a.nodeName?mxResources.add(a.getAttribute("basename")):"stylesheet"==a.nodeName&&mxClient.link("stylesheet",a.getAttribute("name"));a=a.nextSibling}};a.decodeTemplates=function(a,c,d){null==d.templates&&
(d.templates=[]);for(var c=mxUtils.getChildNodes(c),e=0;e<c.length;e++){for(var f=c[e].getAttribute("as"),g=c[e].firstChild;null!=g&&1!=g.nodeType;)g=g.nextSibling;null!=g&&(d.templates[f]=a.decodeCell(g))}};return a}());var CSS_PROP_BIT_QUANTITY=1,CSS_PROP_BIT_HASH_VALUE=2,CSS_PROP_BIT_NEGATIVE_QUANTITY=4,CSS_PROP_BIT_QSTRING_CONTENT=8,CSS_PROP_BIT_QSTRING_URL=16,CSS_PROP_BIT_HISTORY_INSENSITIVE=32,CSS_PROP_BIT_Z_INDEX=64,CSS_PROP_BIT_ALLOWED_IN_LINK=128,cssSchema=function(){var a=["rgb(?:\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)|a\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0(?:\\.\\d+)?|\\.\\d+|1(?:\\.0+)?|0|\\d+(?:\\.\\d+)?%)) *\\)"],
b=[/^ *$/i,RegExp("^ *(?:\\s*"+a[0]+"|(?:\\s*"+a[0]+")?)+ *$","i"),RegExp("^ *\\s*"+a[0]+" *$","i"),RegExp("^ *\\s*"+a[0]+"\\s*"+a[0]+" *$","i")],c=["aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen".split(","),
"all-scroll,col-resize,crosshair,default,e-resize,hand,help,move,n-resize,ne-resize,no-drop,not-allowed,nw-resize,pointer,progress,row-resize,s-resize,se-resize,sw-resize,text,vertical-text,w-resize,wait".split(","),"-moz-inline-box,-moz-inline-stack,block,inline,inline-block,inline-table,list-item,run-in,table,table-caption,table-cell,table-column,table-column-group,table-footer-group,table-header-group,table-row,table-row-group".split(","),"armenian,circle,decimal,decimal-leading-zero,disc,georgian,lower-alpha,lower-greek,lower-latin,lower-roman,square,upper-alpha,upper-latin,upper-roman".split(","),
"100,200,300,400,500,600,700,800,900,bold,bolder,lighter".split(","),"condensed,expanded,extra-condensed,extra-expanded,narrower,semi-condensed,semi-expanded,ultra-condensed,ultra-expanded,wider".split(","),"behind,center-left,center-right,far-left,far-right,left-side,leftwards,right-side,rightwards".split(","),"large,larger,small,smaller,x-large,x-small,xx-large,xx-small".split(","),"-moz-pre-wrap,-o-pre-wrap,-pre-wrap,nowrap,pre,pre-line,pre-wrap".split(","),"dashed,dotted,double,groove,outset,ridge,solid".split(","),
"baseline,middle,sub,super,text-bottom,text-top".split(","),"caption,icon,menu,message-box,small-caption,status-bar".split(","),"fast,faster,slow,slower,x-fast,x-slow".split(","),["above","below","higher","level","lower"],["border-box","contain","content-box","cover","padding-box"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["high","low","x-high",
"x-low"],["absolute","relative","static"],["capitalize","lowercase","uppercase"],["child","female","male"],["bidi-override","embed"],["bottom","top"],["clip","ellipsis"],["continuous","digits"],["hide","show"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["code"],["collapse"],["fixed"],["hidden"],["inherit"],["inset"],["invert"],
["justify"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["transparent"],["visible"]];return{"-moz-border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"-moz-border-radius-bottomleft":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-bottomright":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-topleft":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-topright":{cssExtra:b[0],cssPropBits:5},"-moz-box-shadow":{cssExtra:b[1],
cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"-moz-opacity":{cssPropBits:1,cssLitGroup:[c[47]]},"-moz-outline":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[49],c[52],c[54]]},"-moz-outline-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[49]]},"-moz-outline-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"-moz-outline-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"-o-text-overflow":{cssPropBits:0,
cssLitGroup:[c[25]]},"-webkit-border-bottom-left-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-border-bottom-right-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"-webkit-border-radius-bottom-left":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-bottom-right":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-top-left":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-top-right":{cssExtra:b[0],cssPropBits:5},"-webkit-border-top-left-radius":{cssExtra:b[0],
cssPropBits:5},"-webkit-border-top-right-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-box-shadow":{cssExtra:b[1],cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},azimuth:{cssPropBits:5,cssLitGroup:[c[6],c[30],c[42],c[47]]},background:{cssExtra:RegExp("^ *(?:\\s*"+a[0]+"){0,2} *$","i"),cssPropBits:23,cssLitGroup:[c[0],c[14],c[17],c[24],c[30],c[35],c[36],c[38],c[42],c[45],c[47],c[51],c[54],c[57],c[58],c[62]]},"background-attachment":{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[35],
c[45],c[51],c[58]]},"background-color":{cssExtra:b[2],cssPropBits:130,cssLitGroup:[c[0],c[47],c[62]]},"background-image":{cssExtra:b[0],cssPropBits:16,cssLitGroup:[c[35],c[54]]},"background-position":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[24],c[30],c[35],c[42]]},"background-repeat":{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[17],c[35],c[57]]},border:{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-bottom":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],
c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-bottom-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-bottom-left-radius":{cssExtra:b[0],cssPropBits:5},"border-bottom-right-radius":{cssExtra:b[0],cssPropBits:5},"border-bottom-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-collapse":{cssPropBits:0,cssLitGroup:[c[44],c[47],c[59]]},"border-color":{cssExtra:RegExp("^ *(?:\\s*"+
a[0]+"){1,4} *$","i"),cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-left":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-left-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-left-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-left-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"border-right":{cssExtra:b[3],
cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-right-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-right-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-right-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-spacing":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47]]},"border-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-top":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],
c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-top-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-top-left-radius":{cssExtra:b[0],cssPropBits:5},"border-top-right-radius":{cssExtra:b[0],cssPropBits:5},"border-top-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-top-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},bottom:{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"box-shadow":{cssExtra:b[1],
cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"caption-side":{cssPropBits:0,cssLitGroup:[c[24],c[47]]},clear:{cssPropBits:0,cssLitGroup:[c[30],c[40],c[47],c[54]]},clip:{cssExtra:/^ *\s*rect\(\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto) *\) *$/i,cssPropBits:0,cssLitGroup:[c[38],c[47]]},color:{cssExtra:b[2],
cssPropBits:130,cssLitGroup:[c[0],c[47]]},content:{cssPropBits:0},"counter-increment":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47],c[54]]},"counter-reset":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47],c[54]]},cue:{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"cue-after":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"cue-before":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},cursor:{cssExtra:b[0],cssPropBits:144,cssLitGroup:[c[1],c[35],c[38],c[47]]},direction:{cssPropBits:0,cssLitGroup:[c[31],c[47]]},display:{cssPropBits:32,
cssLitGroup:[c[2],c[47],c[54]]},elevation:{cssPropBits:5,cssLitGroup:[c[13],c[47]]},"empty-cells":{cssPropBits:0,cssLitGroup:[c[27],c[47]]},filter:{cssExtra:/^ *(?:\s*alpha\(\s*opacity\s*=\s*(?:0|\d+(?:\.\d+)?%|[+\-]?\d+(?:\.\d+)?) *\))+ *$/i,cssPropBits:32},"float":{cssAlternates:["cssFloat","styleFloat"],cssPropBits:32,cssLitGroup:[c[30],c[47],c[54]]},font:{cssExtra:b[0],cssPropBits:9,cssLitGroup:[c[4],c[7],c[11],c[15],c[29],c[35],c[36],c[47],c[52],c[55],c[60]]},"font-family":{cssExtra:b[0],cssPropBits:8,
cssLitGroup:[c[15],c[35],c[47]]},"font-size":{cssPropBits:1,cssLitGroup:[c[7],c[47],c[52]]},"font-stretch":{cssPropBits:0,cssLitGroup:[c[5],c[55]]},"font-style":{cssPropBits:0,cssLitGroup:[c[29],c[47],c[55]]},"font-variant":{cssPropBits:0,cssLitGroup:[c[47],c[55],c[60]]},"font-weight":{cssPropBits:0,cssLitGroup:[c[4],c[47],c[55]]},height:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},left:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},"letter-spacing":{cssPropBits:5,cssLitGroup:[c[47],c[55]]},"line-height":{cssPropBits:1,
cssLitGroup:[c[47],c[55]]},"list-style":{cssPropBits:16,cssLitGroup:[c[3],c[28],c[47],c[54]]},"list-style-image":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"list-style-position":{cssPropBits:0,cssLitGroup:[c[28],c[47]]},"list-style-type":{cssPropBits:0,cssLitGroup:[c[3],c[47],c[54]]},margin:{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-bottom":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-left":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-right":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},
"margin-top":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"max-height":{cssPropBits:1,cssLitGroup:[c[38],c[47],c[54]]},"max-width":{cssPropBits:1,cssLitGroup:[c[38],c[47],c[54]]},"min-height":{cssPropBits:1,cssLitGroup:[c[38],c[47]]},"min-width":{cssPropBits:1,cssLitGroup:[c[38],c[47]]},opacity:{cssPropBits:33,cssLitGroup:[c[47]]},outline:{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[49],c[52],c[54]]},"outline-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],
c[49]]},"outline-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"outline-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},overflow:{cssPropBits:32,cssLitGroup:[c[38],c[46],c[47],c[58],c[63]]},"overflow-x":{cssPropBits:0,cssLitGroup:[c[32],c[38],c[46],c[58],c[63]]},"overflow-y":{cssPropBits:0,cssLitGroup:[c[32],c[38],c[46],c[58],c[63]]},padding:{cssPropBits:1,cssLitGroup:[c[47]]},"padding-bottom":{cssPropBits:33,cssLitGroup:[c[47]]},"padding-left":{cssPropBits:33,cssLitGroup:[c[47]]},
"padding-right":{cssPropBits:33,cssLitGroup:[c[47]]},"padding-top":{cssPropBits:33,cssLitGroup:[c[47]]},"page-break-after":{cssPropBits:0,cssLitGroup:[c[30],c[37],c[38],c[39],c[47]]},"page-break-before":{cssPropBits:0,cssLitGroup:[c[30],c[37],c[38],c[39],c[47]]},"page-break-inside":{cssPropBits:0,cssLitGroup:[c[38],c[39],c[47]]},pause:{cssPropBits:5,cssLitGroup:[c[47]]},"pause-after":{cssPropBits:5,cssLitGroup:[c[47]]},"pause-before":{cssPropBits:5,cssLitGroup:[c[47]]},pitch:{cssPropBits:5,cssLitGroup:[c[19],
c[47],c[52]]},"pitch-range":{cssPropBits:5,cssLitGroup:[c[47]]},"play-during":{cssExtra:b[0],cssPropBits:16,cssLitGroup:[c[38],c[47],c[53],c[54],c[57]]},position:{cssPropBits:32,cssLitGroup:[c[20],c[47]]},quotes:{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[47],c[54]]},richness:{cssPropBits:5,cssLitGroup:[c[47]]},right:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},speak:{cssPropBits:0,cssLitGroup:[c[47],c[54],c[55],c[61]]},"speak-header":{cssPropBits:0,cssLitGroup:[c[37],c[47],c[56]]},"speak-numeral":{cssPropBits:0,
cssLitGroup:[c[26],c[47]]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[c[43],c[47],c[54]]},"speech-rate":{cssPropBits:5,cssLitGroup:[c[12],c[47],c[52]]},stress:{cssPropBits:5,cssLitGroup:[c[47]]},"table-layout":{cssPropBits:0,cssLitGroup:[c[38],c[45],c[47]]},"text-align":{cssPropBits:0,cssLitGroup:[c[30],c[42],c[47],c[50]]},"text-decoration":{cssPropBits:0,cssLitGroup:[c[18],c[47],c[54]]},"text-indent":{cssPropBits:5,cssLitGroup:[c[47]]},"text-overflow":{cssPropBits:0,cssLitGroup:[c[25]]},"text-shadow":{cssExtra:b[1],
cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"text-transform":{cssPropBits:0,cssLitGroup:[c[21],c[47],c[54]]},"text-wrap":{cssPropBits:0,cssLitGroup:[c[33],c[54],c[55]]},top:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},"unicode-bidi":{cssPropBits:0,cssLitGroup:[c[23],c[47],c[55]]},"vertical-align":{cssPropBits:5,cssLitGroup:[c[10],c[24],c[47]]},visibility:{cssPropBits:32,cssLitGroup:[c[44],c[46],c[47],c[63]]},"voice-family":{cssExtra:b[0],cssPropBits:8,cssLitGroup:[c[22],c[35],c[47]]},volume:{cssPropBits:1,
cssLitGroup:[c[16],c[47],c[52]]},"white-space":{cssPropBits:0,cssLitGroup:[c[8],c[47],c[55]]},width:{cssPropBits:33,cssLitGroup:[c[38],c[47]]},"word-spacing":{cssPropBits:5,cssLitGroup:[c[47],c[55]]},"word-wrap":{cssPropBits:0,cssLitGroup:[c[41],c[55]]},"z-index":{cssPropBits:69,cssLitGroup:[c[38],c[47]]},zoom:{cssPropBits:1,cssLitGroup:[c[55]]}}}(),decodeCss,html,html4,html_sanitize,lexCss,parseCssDeclarations,parseCssStylesheet,sanitizeCssProperty,sanitizeStylesheet;
"undefined"!==typeof window&&(window.cssSchema=cssSchema);
(function(){function a(a){var b=parseInt(a.substring(1),16);return 65535<b?(b-=65536,String.fromCharCode(55296+(b>>10),56320+(b&1023))):b==b?String.fromCharCode(b):" ">a[1]?"":a[1]}function b(a,b){return'"'+a.replace(/[\u0000-\u001f\\\"\x3c\x3e]/g,b)+'"'}function c(a){return f[a]||(f[a]="\\"+a.charCodeAt(0).toString(16)+" ")}function d(a){return g[a]||(g[a]=("\u0010">a?"%0":"%")+a.charCodeAt(0).toString(16))}var e,f,g;f={"\\":"\\\\"};g={"\\":"%5c"};e=RegExp("\\uFEFF|U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?|url[(][\\t\\n\\f ]*(?:\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)[\\t\\n\\f ]*[)]|(?!url[(])-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*[(]|(?:@?-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))|#)(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*|\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)(?:%|-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)?|<\!--|--\>|[\\t\\n\\f ]+|/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)|[~|^$*]=|[^\"'\\\\/]|/(?![/*])",
"gi");decodeCss=function(b){return b.replace(RegExp("\\\\(?:(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff])|[\\n\\f])","g"),a)};lexCss=function(a){var f,g,n,o,p,r,s;a=""+a;s=a.replace(/\r\n?/g,"\n").match(e)||[];g=0;n=" ";for(a=0,p=s.length;a<p;++a)r=decodeCss(s[a]),o=r.length,f=r.charCodeAt(0),r=34==f||39==f?b(r.substring(1,o-1),c):47==f&&1<o||"\\"==r||"--\>"==r||"<\!--"==r||"\ufeff"==r||32>=f?" ":/url\(/i.test(r)?"url("+b(r.replace(RegExp("^url\\([\\t\\n\\f ]*[\"']?|[\"']?[\\t\\n\\f ]*\\)$",
"gi"),""),d)+")":r,(n!=r||" "!=r)&&(s[g++]=n=r);return s.length=g,s}})();"undefined"!==typeof window&&(window.lexCss=lexCss,window.decodeCss=decodeCss);
sanitizeCssProperty=function(){function a(a){return"string"===typeof a?'url("'+a.replace(e,b)+'")':d}function b(a){return f[a]}function c(a,b,c){var d;return c?(d=(""+a).match(k),d&&(!d[1]||h.test(d[1]))?c(a,b):null):null}var d='url("about:blank")',e=/[\n\f\r\"\'()*\x3c\x3e]/g,f={"\n":"%0a","\u000c":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},g,h,k;k=/^(?:([^:/?# ]+):)?/;h=/^(?:https?|mailto)$/i;return g={},function(b,e,f,h){for(var k=e.cssPropBits,s=k&
(CSS_PROP_BIT_QSTRING_CONTENT|CSS_PROP_BIT_QSTRING_URL),u=NaN,w=0,v=0,x,B,z,A,J,y,D,E,C;w<f.length;++w){C=f[w].toLowerCase();x=C.charCodeAt(0);if(32===x)x="";else if(34===x)x=s===CSS_PROP_BIT_QSTRING_URL&&h?a(c(decodeCss(f[w].substring(1,C.length-1)),b,h)):s===CSS_PROP_BIT_QSTRING_CONTENT?C:"";else if(35===x&&/^#(?:[0-9a-f]{3}){1,2}$/.test(C))x=k&CSS_PROP_BIT_HASH_VALUE?C:"";else if(48<=x&&57>=x)x=k&CSS_PROP_BIT_QUANTITY?k&CSS_PROP_BIT_Z_INDEX?C.match(/^\d{1,7}$/)?C:"":C:"";else if(B=C.charCodeAt(1),
z=C.charCodeAt(2),J=48<=B&&57>=B,y=48<=z&&57>=z,43===x&&(J||46===B&&y))x=k&CSS_PROP_BIT_QUANTITY?k&CSS_PROP_BIT_Z_INDEX?C.match(/^\+\d{1,7}$/)?C:"":(J?"":"0")+C.substring(1):"";else if(45===x&&(J||46===B&&y))x=k&CSS_PROP_BIT_NEGATIVE_QUANTITY?k&CSS_PROP_BIT_Z_INDEX?C.match(/^\-\d{1,7}$/)?C:"":(J?"-":"-0")+C.substring(1):k&CSS_PROP_BIT_QUANTITY?"0":"";else if(46===x&&J)x=k&CSS_PROP_BIT_QUANTITY?"0"+C:"";else if("url("===C.substring(0,4))x=h&&s&CSS_PROP_BIT_QSTRING_URL?a(c(f[w].substring(5,C.length-
2),b,h)):"";else{if("("===C.charAt(C.length-1)){C=1;x=w+1;D=f.length;for(var F=void 0;x<D&&C;)F=f[x++],C+="("===F?1:")"===F?-1:0;A=x;f.splice(w,A-w,C=f.slice(w,A).join(" "))}if(D=e.cssLitGroup){if(!(x=e.cssLitMap)){x=e;for(var F={},I=void 0,P=void 0,H=void 0,P=D.length;0<=--P;){I=D[P];for(H=I.length;0<=--H;)F[I[H]]=g}x=x.cssLitMap=F}}else x=g;x=(E=x,E[C]===g||e.cssExtra&&e.cssExtra.test(C))?C:/^\w+$/.test(C)&&s===CSS_PROP_BIT_QSTRING_CONTENT?u+1===v?(f[u]=f[u].substring(0,f[u].length-1)+" "+C+'"',
C=""):(u=v,'"'+C+'"'):""}C=x;C&&(f[v++]=C)}1===v&&f[0]===d&&(v=0);f.length=v}}();
var sanitizeCssSelectors=function(a,b){function c(c,f){function g(c,d,e){var f,k,l;for(k="",c<d&&(l=a[c].toLowerCase(),("*"===l||"body"===l&&c+1!==d&&!e||"number"===typeof(f=html4.ELEMENTS[l])&&!(f&html4.eflags.UNSAFE))&&(++c,k=l)),e="";c<d;){l=a[c];if("#"===l.charAt(0)){if(/^#_|__$|[^#0-9A-Za-z:_\-]/.test(l))return null;e+=l+"-"+b}else if("."===l)if(++c<d&&/^[0-9A-Za-z:_\-]+$/.test(l=a[c])&&!/^_|__$/.test(l))e+="."+l;else return null;else break;++c}f="";if(c<d&&":"===a[c]&&(l=a[++c],"visited"===
l||"link"===l)){if(!/^[a*]?$/.test(k))return null;h=!0;f=":"+l;k="a";++c}return c===d?k+e+f:null}var h=!1,p,r,s,u,w,v,x;" "===a[c]&&++c;f-1!==c&&" "===a[f]&&--f;w=[];u=c;p="";for(r=c;r<f;++r)if(x=a[r],s=">"===x,s||" "===x){p=g(u,r,!1);if(!p||s&&/^html/i.test(p))return;u=r+1;w.push(p,s?" > ":" ")}if(p=g(u,f,!0))w.push(p),v=w.join(""),/^body\b/.test(v)?v=".vdoc-body___."+b+v.substring(4):v="."+b+" "+v,(h?d:e).push(v)}var d=[],e=[],f=0,g,h;for(g=0;g<a.length;++g)" "==a[g]&&(">"==a[g-1]||">"==a[g+1])||
(a[f++]=a[g]);a.length=f;f=a.length;h=0;for(g=0;g<f;++g)","==a[g]&&(c(h,g),h=g+1);c(h,f);return[e,d]};
sanitizeStylesheet=function(){function a(a){var b=!1,c,g,h;for(c=0,g=a.length;c<g-1;++c)h=a[c],":"===a[c+1]&&(b=!(cssSchema[h].cssPropBits&CSS_PROP_BIT_ALLOWED_IN_LINK)),b&&(a[c]=""),";"===h&&(b=!1);return a.join("")}var b={},c={braille:b,embossed:b,handheld:b,print:b,projection:b,screen:b,speech:b,tty:b,tv:b};return function(d,e,f){function g(){l=0!==k.length&&null!==k[k.length-1]}var h=void 0,k=[],l=!1;parseCssStylesheet(d,{startStylesheet:function(){h=[]},endStylesheet:function(){},startAtrule:function(a,
d){l?a=null:"@media"===a?(d=d.filter(function(a){return c[a]==b}),d.length?h.push(a,d.join(","),"{"):a=null):("@import"===a&&window.console&&window.console.log("@import "+d.join(" ")+" elided"),a=null);l=!a;k.push(a)},endAtrule:function(){k.pop();l||h.push(";");g()},startBlock:function(){l||h.push("{")},endBlock:function(){l||(h.push("}"),l=!0)},startRuleset:function(a){var b=void 0,c=!1,d,f,g;l||(g=sanitizeCssSelectors(a,e),d=g[0],b=g[1],!d.length&&!b.length?l=!0:(f=d.join(", "),f||(f="head > html",
c=!0),h.push(f,"{")));k.push(l?null:{historySensitiveSelectors:b,endOfSelectors:h.length-1,removeHistoryInsensitiveSelectors:c})},endRuleset:function(){var b=k.pop(),c=h.length,d,e;l||(h.push("}"),b&&(d=b.historySensitiveSelectors,d.length&&(e=h.slice(b.endOfSelectors),h.push(d.join(", "),a(e)))));b&&b.removeHistoryInsensitiveSelectors&&h.splice(b.endOfSelectors-1,c+1);g()},declaration:function(a,b){var c;l||(c=cssSchema[a],c&&(sanitizeCssProperty(a,c,b,f),b.length&&h.push(a,":",b.join(" "),";")))}});
return h.join("")}}();"undefined"!==typeof window&&(window.sanitizeCssProperty=sanitizeCssProperty,window.sanitizeCssSelectors=sanitizeCssSelectors,window.sanitizeStylesheet=sanitizeStylesheet);
(function(){function a(a,c,d,e,f){for(var o=c++,p,r;c<d&&"{"!==a[c]&&";"!==a[c];)++c;return c<d&&(f||";"===a[c])&&(r=o+1,p=c,r<d&&" "===a[r]&&++r,p>r&&" "===a[p-1]&&--p,e.startAtrule&&e.startAtrule(a[o].toLowerCase(),a.slice(r,p)),c="{"===a[c]?b(a,c,d,e):c+1,e.endAtrule&&e.endAtrule()),c}function b(d,e,f,l){var n;for(++e,l.startBlock&&l.startBlock();e<f;){n=d[e].charAt(0);if("}"==n){++e;break}" "===n||";"===n?e+=1:"@"===n?e=a(d,e,f,l,!1):"{"===n?e=b(d,e,f,l):e=c(d,e,f,l)}return l.endBlock&&l.endBlock(),
e}function c(a,b,c,f){var n=b,o=d(a,b,c,!0),p;if(0>o)return o=~o,b===o?o+1:o;b=o;o>n&&" "===a[o-1]&&--o;p=a[b];++b;if("{"!==p)return b;for(f.startRuleset&&f.startRuleset(a.slice(n,o));b<c;){p=a[b];if("}"===p){++b;break}" "===p?b+=1:b=e(a,b,c,f)}return f.endRuleset&&f.endRuleset(),b<c?b+1:b}function d(a,b,c,d){for(var e=[],f=-1,p;b<c;++b)if(p=a[b].charAt(0),"["===p||"("===p)e[++f]=p;else if("]"===p&&"["===e[f]||")"===p&&"("===e[f])--f;else if("{"===p||"}"===p||";"===p||"@"===p||":"===p&&!d)break;return 0<=
f&&(b=~(b+1)),b}function e(a,b,c,e){var n=a[b++],o,p,r,s;if(!f.test(n))return b+1;b<c&&" "===a[b]&&++b;if(b==c||":"!==a[b]){for(;b<c&&";"!==(p=a[b])&&"}"!==p;)++b;return b}++b;b<c&&" "===a[b]&&++b;o=b;b=d(a,b,c,!1);if(0>b)b=~b;else{for(r=[],s=0;o<b;++o)p=a[o]," "!==p&&(r[s++]=p);if(b<c){do{p=a[b];if(";"===p||"}"===p)break;s=0}while(++b<c);";"===p&&++b}s&&e.declaration&&e.declaration(n.toLowerCase(),r)}return b}var f;parseCssStylesheet=function(b,d){var e=lexCss(b),f,n;d.startStylesheet&&d.startStylesheet();
for(f=0,n=e.length;f<n;){var o;if(" "===e[f])o=f+1;else{o=e;var p=f,r=n,s=d;f=void 0;o=p<r?(f=o[p],"@"===f.charAt(0)?a(o,p,r,s,!0):c(o,p,r,s)):p}f=o}d.endStylesheet&&d.endStylesheet()};f=/^-?[a-z]/i;parseCssDeclarations=function(a,b){var c=lexCss(a),d,f;for(d=0,f=c.length;d<f;)d=" "!==c[d]?e(c,d,f,b):d+1}})();"undefined"!==typeof window&&(window.parseCssStylesheet=parseCssStylesheet,window.parseCssDeclarations=parseCssDeclarations);html4={};
html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10};
html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":0,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,
"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,
"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,
"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,
"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,
"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,
"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,
"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0};html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128};
html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,article:16,aside:16,audio:16,b:0,base:18,basefont:18,bdi:16,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,data:16,datalist:16,dd:1,del:0,details:16,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:16,figure:16,font:0,footer:16,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,header:16,hgroup:16,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,
label:0,legend:0,li:1,link:18,map:0,mark:16,menu:0,meta:18,meter:16,nav:0,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,output:16,p:1,param:18,pre:0,progress:16,q:0,s:0,samp:0,script:84,section:16,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,summary:16,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:16,title:24,tr:1,tt:0,u:0,ul:0,"var":0,video:16};html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};
html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0};html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0};html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};html4.ATTRIBS=html4.ATTRIBS;html4.ELEMENTS=html4.ELEMENTS;html4.URIEFFECTS=html4.URIEFFECTS;
html4.LOADERTYPES=html4.LOADERTYPES;html4.atype=html4.atype;html4.eflags=html4.eflags;html4.ltypes=html4.ltypes;html4.ueffects=html4.ueffects;"undefined"!==typeof window&&(window.html4=html4);
html=function(a){function b(a,b){var c=b,d;return c=c.toLowerCase(),B.hasOwnProperty(c)?B[c]:(d=c.match(E),d?String.fromCharCode(parseInt(d[1],10)):(d=c.match(P))?String.fromCharCode(parseInt(d[1],16)):"")}function c(a){return a.replace(F,b)}function d(a){return(""+a).replace(J,"&amp;").replace(L,"&lt;").replace(I,"&gt;").replace(Q,"&#34;")}function e(a){return a.replace(N,"&amp;$1").replace(L,"&lt;").replace(I,"&gt;")}function f(a){var b={cdata:a.cdata||a.cdata,comment:a.comment||a.comment,endDoc:a.endDoc||
a.endDoc,endTag:a.endTag||a.endTag,pcdata:a.pcdata||a.pcdata,rcdata:a.rcdata||a.rcdata,startDoc:a.startDoc||a.startDoc,startTag:a.startTag||a.startTag};return function(a,c){var d;var e=/(\x3c\/|\x3c\!--|\x3c[!?]|[\x26\x3c\x3e])/g,f,g,k;d=a+"";if(ba)d=d.split(e);else{for(k=[],f=0;null!==(g=e.exec(d));)k.push(d.substring(f,g.index)),k.push(g[0]),f=g.index+g[0].length;d=(k.push(d.substring(f)),k)}h(b,d,0,{noMoreGT:!1,noMoreEndComments:!1},c)}}function g(a,b,c,d,e){return function(){h(a,b,c,d,e)}}function h(b,
c,d,e,f){var h,n,o,p,q,D,s,r,u,C;try{b.startDoc&&0==d&&b.startDoc(f);for(r=d,p=c.length;r<p;)switch(n=c[r++],D=c[r],n){case "&":z.test(D)?(b.pcdata&&b.pcdata("&"+D,f,y,g(b,c,r,e,f)),++r):b.pcdata&&b.pcdata("&amp;",f,y,g(b,c,r,e,f));break;case "</":if(q=/^(\w+)[^\'\"]*/.exec(D))if(q[0].length===D.length&&">"===c[r+1])r+=2,C=q[1].toLowerCase(),b.endTag&&b.endTag(C,f,y,g(b,c,r,e,f));else{var d=c,E=r,w=b,v=f,I=y,F=e,B=l(d,E);r=B?(w.endTag&&w.endTag(B.name,v,I,g(w,d,E,F,v)),B.next):d.length}else b.pcdata&&
b.pcdata("&lt;/",f,y,g(b,c,r,e,f));break;case "<":if(q=/^(\w+)\s*\/?/.exec(D))if(q[0].length===D.length&&">"===c[r+1])r+=2,C=q[1].toLowerCase(),b.startTag&&b.startTag(C,[],f,y,g(b,c,r,e,f)),o=a.ELEMENTS[C],o&x&&(u={name:C,next:r,eflags:o},r=k(c,u,b,f,y,e));else{var d=c,E=b,w=f,v=y,I=e,H=l(d,r);r=H?(E.startTag&&E.startTag(H.name,H.attrs,w,v,g(E,d,H.next,I,w)),H.eflags&x?k(d,H,E,w,v,I):H.next):d.length}else b.pcdata&&b.pcdata("&lt;",f,y,g(b,c,r,e,f));break;case "<\!--":if(!e.noMoreEndComments){for(s=
r+1;s<p&&!(">"===c[s]&&/--$/.test(c[s-1]));++s);s<p?(b.comment&&(h=c.slice(r,s).join(""),b.comment(h.substr(0,h.length-2),f,y,g(b,c,s+1,e,f))),r=s+1):e.noMoreEndComments=!0}e.noMoreEndComments&&b.pcdata&&b.pcdata("&lt;!--",f,y,g(b,c,r,e,f));break;case "<!":if(/^\w/.test(D)){if(!e.noMoreGT){for(s=r+1;s<p&&!(">"===c[s]);++s);s<p?r=s+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;!",f,y,g(b,c,r,e,f))}else b.pcdata&&b.pcdata("&lt;!",f,y,g(b,c,r,e,f));break;case "<?":if(!e.noMoreGT){for(s=r+1;s<p&&
!(">"===c[s]);++s);s<p?r=s+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;?",f,y,g(b,c,r,e,f));break;case ">":b.pcdata&&b.pcdata("&gt;",f,y,g(b,c,r,e,f));break;case "":break;default:b.pcdata&&b.pcdata(n,f,y,g(b,c,r,e,f))}b.endDoc&&b.endDoc(f)}catch(A){if(A!==y)throw A;}}function k(b,c,d,f,h,k){var l=b.length,n,o,p;for(C.hasOwnProperty(c.name)||(C[c.name]=RegExp("^"+c.name+"(?:[\\s\\/]|$)","i")),p=C[c.name],n=c.next,o=c.next+1;o<l&&!("</"===b[o-1]&&p.test(b[o]));++o);o<l&&(o-=1);l=b.slice(n,o).join("");
if(c.eflags&a.eflags.CDATA)d.cdata&&d.cdata(l,f,h,g(d,b,o,k,f));else if(c.eflags&a.eflags.RCDATA)d.rcdata&&d.rcdata(e(l),f,h,g(d,b,o,k,f));else throw Error("bug");return o}function l(b,d){var e=/^(\w+)/.exec(b[d]),f={},g,h,k,l,n,o;for(f.name=e[1].toLowerCase(),f.eflags=a.ELEMENTS[f.name],k=b[d].substr(e[0].length),o=d+1,n=b.length;o<n&&!(">"===b[o]);++o)k+=b[o];if(!(n<=o)){for(l=[];""!==k;)if(e=v.exec(k))if(e[4]&&!e[5]||e[6]&&!e[7]){for(e=e[4]||e[6],g=!1,k=[k,b[o++]];o<n;++o){if(g){if(">"===b[o])break}else 0<=
b[o].indexOf(e)&&(g=!0);k.push(b[o])}if(n<=o)break;k=k.join("")}else{g=e[1].toLowerCase();var p;if(e[2]){var D=e[3];p=D.charCodeAt(0);p=((34===p||39===p)&&(D=D.substr(1,D.length-2)),c(D.replace(S,"")))}else p=g;h=p;l.push(g,h);k=k.substr(e[0].length)}else k=k.replace(/^[\s\S][^a-z\s]*/,"");return f.attrs=l,f.next=o+1,f}}function n(b){var c=function(a,b){e||b.push(a)},e,g;return f({startDoc:function(){g=[];e=!1},startTag:function(c,f,h){var k,l,n;if(!e&&a.ELEMENTS.hasOwnProperty(c)&&(l=a.ELEMENTS[c],
!(l&a.eflags.FOLDABLE))){f=b(c,f);if(!f)return e=!(l&a.eflags.EMPTY),void 0;l&a.eflags.EMPTY||g.push(c);h.push("<",c);for(c=0,l=f.length;c<l;c+=2)k=f[c],n=f[c+1],null!==n&&void 0!==n&&h.push(" ",k,'="',d(n),'"');h.push(">")}},endTag:function(b,c){var d,f,h;if(e)return e=!1,void 0;if(a.ELEMENTS.hasOwnProperty(b)&&(d=a.ELEMENTS[b],!(d&(a.eflags.EMPTY|a.eflags.FOLDABLE)))){if(d&a.eflags.OPTIONAL_ENDTAG)for(f=g.length;0<=--f;){h=g[f];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(f=
g.length;0<=--f&&!(g[f]===b););if(!(0>f)){for(d=g.length;--d>f;)h=g[d],a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||c.push("</",h,">");g.length=f;c.push("</",b,">")}}},pcdata:c,rcdata:c,cdata:c,endDoc:function(a){for(;g.length;--g.length)a.push("</",g[g.length-1],">")}})}function o(a,b){var c;return b?(c=(""+a).match(A),c&&(!c[1]||w.test(c[1]))?b(a):null):null}function p(a,b,c,d,e){var f;c||a(b+" removed",{change:"removed",tagName:b});d!==e&&(f="changed",d&&!e?f="removed":!d&&e&&(f="added"),a(b+"."+c+
" "+f,{change:f,tagName:b,attribName:c,oldValue:d,newValue:e}))}function r(b,c,d,e,f){var g,h,k,l,n,s,r;for(l=0;l<c.length;l+=2){h=c[l];r=c[l+1];n=r;k=null;((g=b+"::"+h,a.ATTRIBS.hasOwnProperty(g))||(g="*::"+h,a.ATTRIBS.hasOwnProperty(g)))&&(k=a.ATTRIBS[g]);if(null!==k)switch(k){case a.atype.NONE:break;case a.atype.SCRIPT:r=null;f&&p(f,b,h,n,r);break;case a.atype.STYLE:if("undefined"===typeof O){r=null;f&&p(f,b,h,n,r);break}s=[];O(r,{declaration:function(a,b){var c=a.toLowerCase(),e=D[c];e&&(K(c,
e,b,d),s.push(a+": "+b.join(" ")))}});r=0<s.length?s.join(" ; "):null;f&&p(f,b,h,n,r);break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:r=e?e(r):r;f&&p(f,b,h,n,r);break;case a.atype.URI:r=o(r,d);f&&p(f,b,h,n,r);break;case a.atype.URI_FRAGMENT:r&&"#"===r.charAt(0)?(r=r.substring(1),r=e?e(r):r,null!==r&&void 0!==r&&(r="#"+r)):r=null;f&&p(f,b,h,n,r);break;default:r=null,f&&p(f,b,h,n,r)}else r=null,f&&p(f,b,h,n,r);c[l+1]=
r}return c}function s(b,c,d){return function(e,f){if(!(a.ELEMENTS[e]&a.eflags.UNSAFE))return r(e,f,b,c,d);d&&p(d,e,void 0,void 0,void 0)}}function u(a,b){var c=[];return n(b)(a,c),c.join("")}var w,v,x,B,z,A,J,y,D,E,C,F,I,P,H,N,L,S,O,Q,K,ba;"undefined"!==typeof window&&(O=window.parseCssDeclarations,K=window.sanitizeCssProperty,D=window.cssSchema);B={lt:"<",gt:">",amp:"&",nbsp:"\u00a0",quot:'"',apos:"'"};E=/^#(\d+)$/;P=/^#x([0-9A-Fa-f]+)$/;S=/\0/g;F=/\x26(#\d+|#x[0-9A-Fa-f]+|\w+);/g;J=/\x26/g;N=/\x26([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;
L=/[\x3c]/g;I=/\x3e/g;Q=/\"/g;v=/^\s*([a-z][-\w]*)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i;z=/^(#[0-9]+|#x[0-9a-f]+|\w+);/i;ba=3==="a,b".split(/(,)/).length;x=a.eflags.CDATA|a.eflags.RCDATA;y={};C={};A=/^(?:([^:/?# ]+):)?/;w=/^(?:https?|mailto)$/i;return H={},H.escapeAttrib=H.escapeAttrib=d,H.makeHtmlSanitizer=H.makeHtmlSanitizer=n,H.makeSaxParser=H.makeSaxParser=f,H.makeTagPolicy=H.makeTagPolicy=s,H.normalizeRCData=H.normalizeRCData=e,H.sanitize=H.sanitize=function(a,
b,c,d){b=s(b,c,d);return u(a,b)},H.sanitizeAttribs=H.sanitizeAttribs=r,H.sanitizeWithPolicy=H.sanitizeWithPolicy=u,H.unescapeEntities=H.unescapeEntities=c,H}(html4);html_sanitize=html.sanitize;"undefined"!==typeof window&&(window.html=html,window.html_sanitize=html_sanitize);function clean(a){return a?html_sanitize(a,function(a){return a},function(a){return a}):a};Ext.onReady(function(){main()});Ext.override(Ext.form.HtmlEditor,{createLink:function(){var a=prompt(this.createLinkText,this.defaultLinkValue);if(a&&"http://"!=a){var b=this.win.getSelection();""==b&&(b=a);b='<a href="'+a+'" target="_blank">'+b+"</a>";if(Ext.isIE){if(range=this.getDoc().selection.createRange())range.pasteHTML(b),this.syncValue(),this.deferFocus()}else this.execCmd("InsertHTML",b),this.deferFocus()}}});window.addEventListener("message",callAPI,!1);
function callAPI(a){try{a.source.postMessage(eval(a.data))}catch(b){}}function isLocal(){return"localhost"==document.location.hostname||"insightmaker.dev"==document.location.hostname}mxGraph.prototype.stopEditing=function(a){null!==this.cellEditor&&this.cellEditor.stopEditing(a)};
var equationRenderer=function(a){/\\n/.test(a)&&(a=a.match(/(.*?)\\n/)[1]+"...");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\[(.*?)\]/g,"<font color='Green'>[$1]</font>");a=a.replace(/(&lt;&lt;.*?&gt;&gt;)/g,"<font color='Orange'>$1</font>");a=a.replace(/(\u00ab.*?\u00bb)/g,"<font color='Orange'>$1</font>");a=a.replace(/\b([\d\.e]+)\b/g,"<font color='DeepSkyBlue'>$1</font>");a=a.replace(/(\{.*?\})/g,"<font color='Orange'>$1</font>");return clean(a)};
isLocal()||(window.onerror=function(a,b,c){if(!/removeChild/.test(a))return a=[a,b,c].join(" : "),_gaq.push(["_trackEvent","Errors","App",a,null,!0]),console.log(a),!0});try{mxUtils.alert=function(a){Ext.example.msg("<table><tr><td valign='top'><img src='"+builder_path+"/images/stop.png' style='padding-right:.3em;' width=48px height=48px  /></td><td>"+a+"</td></tr></table>","")}}catch(err$$8){alert("Insight Maker failed to load all its resources. Check your network connection and try to reload Insight Maker.")}
var GraphEditor={},mainPanel,mxPanel,ribbonPanel,configPanel,sizeChanging,graph,sliders=[],settingCell,selectionChanged,primitiveBank={},clipboardListener,undoHistory;
function main(){function a(a){a.setAttribute("Units","Unitless");a.setAttribute("MaxConstraintUsed",!1);a.setAttribute("MinConstraintUsed",!1);a.setAttribute("MaxConstraint","100");a.setAttribute("MinConstraint","0");a.setAttribute("ShowSlider",!1);a.setAttribute("SliderMax",100);a.setAttribute("SliderMin",0);a.setAttribute("SliderStep","")}function b(){return new Ext.form.ComboBox({triggerAction:"all",store:new Ext.data.Store({fields:[{name:"text",type:"string"}],data:Ext.Array.map("None,Growth,Balance,Positive Feedback Clockwise,Positive Feedback Counterclockwise,Negative Feedback Clockwise,Negative Feedback Counterclockwise,Unknown Feedback Clockwise,Unknown Feedback Counterclockwise,Plus,Minus,Forwards,Backwards,Up,Down,Diagonal,Reload,Play,Pause,Stop,Info,Question,Warning,Checkmark,Prohibited,Idea,Home,Book,Clock,Computer,Dice,Gear,Hammer,Smiley,Heart,Key,Lock,Loudspeaker,Footprints,Mail,Network,Notes,Pushpin,Paperclip,People,Person,Wallet,Money,Flag,Trash".split(","),
function(a){return{text:a}})}),queryMode:"local",forceSelection:!1,selectOnFocus:!0,listConfig:{getInnerTpl:function(){return'<center><div class="x-combo-list-item" style="white-space:normal";><img src="'+builder_path+'/images/SD/{text}.png" width=48 height=48/></div></center>'}}})}Ext.QuickTips.init();try{mxEvent.disableContextMenu(document.body)}catch(c){return}mxConstants.DEFAULT_HOTSPOT=0.3;isTouch()&&(mxConstants.HANDLE_SIZE=14,mxConstants.DEFAULT_HOTSPOT=0.5);graph=new mxGraph;undoHistory=new mxUndoManager;
var d=mxUtils.parseXml('<mxStylesheet> \t<add as="defaultVertex" extend="defaultVertex"> \t\t<add as="strokeColor" value="#666666"/> \t\t<add as="fontColor" value="#333333"/> \t\t<add as="fontSize" value="14"/> \t\t<add as="fontFamily" value="Comic Sans MS"/> \t\t<add as="strokeWidth" value="2"/> \t</add> \t<add as="defaultEdge" extend="defaultEdge"> \t\t<add as="labelBackgroundColor" value="white"/> \t\t<add as="rounded" value="1"/> \t\t<add as="fontSize" value="14"/> \t\t<add as="edgeStyle" value="elbowEdgeStyle"/> \t\t<add as="fontFamily" value="Comic Sans MS"/> \t\t<add as="strokeWidth" value="4"/> \t</add> \t<add as="stock" extend="defaultVertex"> \t\t<add as="fillColor" value="#A6D3F8"/> \t</add> \t<add as="state" extend="defaultVertex"> \t\t<add as="fillColor" value="#ffffff"/> \t</add> \t<add as="transition" extend="defaultEdge"> \t\t<add as="strokeColor" value="#000000"/> \t\t<add as="fontColor" value="#000000"/> \t</add> \t<add as="agents" extend="defaultVertex"> \t\t<add as="fillColor" value="#F0E68C"/> \t\t<add as="shape" value="cloud"/> \t</add> \t<add as="textArea" extend="defaultVertex"> \t\t<add as="strokeColor" value="none"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="fontSize" value="30"/> \t\t<add as="fontStyle" value="4"/> \t</add> \t<add as="text" extend="defaultVertex"> \t\t<add as="strokeColor" value="none"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="fontSize" value="30"/> \t\t<add as="fontStyle" value="4"/> \t</add> \t \t<add as="parameter" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FDCDAC"/> \t</add> \t<add as="variable" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FDCDAC"/> \t</add> \t<add as="action" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FFFFFF"/> \t</add> \t<add as="converter" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#B3E2CD"/> \t</add> \t<add as="button" extend="defaultVertex"> \t\t<add as="rounded" value="1"/> \t\t<add as="glass" value="1"/> \t\t<add as="fillColor" value="#C0C0C0"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="strokeWidth" value="3"/> \t\t<add as="fontFamily" value="Helvetica"/> \t</add> \t<add as="display" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="fillColor" value="#FFFFFF"/> \t\t<add as="strokeColor" value="#FFFFFF"/> \t\t<add as="fontColor" value="#FFFFFF"/> \t\t<add as="opacity" value="0"/> \t</add> \t<add as="picture" extend="defaultVertex"> \t\t<add as="shape" value="image"/> \t\t<add as="verticalLabelPosition" value="bottom"/> \t\t<add as="verticalAlign" value="top"/> \t</add> \t \t<add as="entity" extend="defaultEdge"> \t\t<add as="strokeColor" value="#808080"/> \t\t<add as="fontColor" value="#808080"/> \t\t<add as="opacity" value="70"/> \t\t<add as="edgeStyle" value="straight"/> \t\t<add as="strokeWidth" value="2"/> \t\t<add as="dashed" value="1"/> \t\t<add as="noLabel" value="0"/> \t</add> \t<add as="flow" extend="defaultEdge"> \t</add> \t<add as="link" extend="defaultEdge"> \t\t<add as="strokeColor" value="#808080"/> \t\t<add as="fontColor" value="#808080"/> \t\t<add as="opacity" value="70"/> \t\t<add as="edgeStyle" value="straight"/> \t\t<add as="strokeWidth" value="2"/> \t\t<add as="dashed" value="1"/> \t\t<add as="noLabel" value="0"/> \t</add> \t \t<add as="line" extend="defaultVertex"> \t\t<add as="shape" value="line"/> \t\t<add as="strokeWidth" value="4"/> \t\t<add as="labelBackgroundColor" value="white"/> \t\t<add as="verticalAlign" value="top"/> \t\t<add as="spacingTop" value="8"/> \t</add> \t<add as="image" extend="defaultVertex"> \t\t<add as="shape" value="image"/> \t\t<add as="verticalLabelPosition" value="bottom"/> \t\t<add as="verticalAlign" value="top"/> \t</add> \t \t<add as="folder" extend="defaultVertex"> \t\t<add as="verticalAlign" value="top"/> \t\t<add as="dashed" value="1"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="rounded" value="1"/> \t</add> </mxStylesheet> '),
e=new mxCodec(d);e.decode(d.documentElement,graph.getStylesheet());graph.alternateEdgeStyle="vertical";graph.connectableEdges=!0;graph.disconnectOnMove=!1;graph.edgeLabelsMovable=!0;graph.enterStopsCellEditing=!0;graph.allowLoops=!1;mxEdgeHandler.prototype.addEnabled=!0;mxEdgeHandler.prototype.removeEnabled=!0;graph.isHtmlLabel=function(a){return null!=a&&null!=a.value&&"Flow"!=a.value.nodeName&&"Display"!=a.value.nodeName};graph.isWrapping=graph.isHtmlLabel;graph.isCellLocked=function(){return!is_editor};
graph.isCellSelectable=function(a){return"Setting"!=a.value.nodeName&&"Display"!=a.value.nodeName};graph.isCellEditable=function(a){return!is_editor?!1:"Display"!=a.value.nodeName&&"Setting"!=a.value.nodeName&&"Ghost"!=a.value.nodeName};graph.getCursorForCell=function(a){if("Button"==a.value.nodeName)return"pointer"};graph.convertValueToString=function(a){return mxUtils.isNode(a.value)&&!("Link"==a.value.nodeName&&"Link"==orig(a).getAttribute("name"))?clean(orig(a).getAttribute("name")):""};graph.labelChanged=
function(a,b){if(validPrimitiveName(b,a)){graph.model.beginUpdate();var c=new mxCellAttributeChange(a,"name",b);graph.getModel().execute(c);selectionChanged(!1);propogateGhosts(a);graph.model.endUpdate();return a}};graph.getEditingValue=function(a){if(mxUtils.isNode(a.value))return a.getAttribute("name")};setupHoverIcons();d=mxUtils.createXmlDocument();primitiveBank.text=d.createElement("Text");primitiveBank.text.setAttribute("name",getText("Text Area"));primitiveBank.text.setAttribute("LabelPosition",
"Middle");primitiveBank.folder=d.createElement("Folder");primitiveBank.folder.setAttribute("name",getText("New Folder"));primitiveBank.folder.setAttribute("Note","");primitiveBank.folder.setAttribute("Type","None");primitiveBank.folder.setAttribute("Image","None");primitiveBank.folder.setAttribute("FlipHorizontal",!1);primitiveBank.folder.setAttribute("FlipVertical",!1);primitiveBank.folder.setAttribute("LabelPosition","Middle");primitiveBank.ghost=d.createElement("Ghost");primitiveBank.ghost.setAttribute("Source",
"");primitiveBank.picture=d.createElement("Picture");primitiveBank.picture.setAttribute("name","");primitiveBank.picture.setAttribute("Note","");primitiveBank.picture.setAttribute("Image","Growth");primitiveBank.picture.setAttribute("FlipHorizontal",!1);primitiveBank.picture.setAttribute("FlipVertical",!1);primitiveBank.picture.setAttribute("LabelPosition","Bottom");primitiveBank.display=d.createElement("Display");primitiveBank.display.setAttribute("name",getText("Default Display"));primitiveBank.display.setAttribute("Note",
"");primitiveBank.display.setAttribute("Type","Time Series");primitiveBank.display.setAttribute("xAxis","Time (%u)");primitiveBank.display.setAttribute("yAxis","");primitiveBank.display.setAttribute("yAxis2","");primitiveBank.display.setAttribute("showMarkers",!1);primitiveBank.display.setAttribute("showLines",!0);primitiveBank.display.setAttribute("showArea",!1);primitiveBank.display.setAttribute("ThreeDimensional",!1);primitiveBank.display.setAttribute("Primitives","");primitiveBank.display.setAttribute("Primitives2",
"");primitiveBank.display.setAttribute("AutoAddPrimitives",!1);primitiveBank.display.setAttribute("ScatterplotOrder","X Primitive, Y Primitive");primitiveBank.display.setAttribute("Image","Display");primitiveBank.display.setAttribute("FlipHorizontal",!1);primitiveBank.display.setAttribute("FlipVertical",!1);primitiveBank.display.setAttribute("LabelPosition","Bottom");primitiveBank.display.setAttribute("legendPosition","Automatic");primitiveBank.stock=d.createElement("Stock");primitiveBank.stock.setAttribute("name",
getText("New Stock"));primitiveBank.stock.setAttribute("Note","");primitiveBank.stock.setAttribute("InitialValue","0");primitiveBank.stock.setAttribute("StockMode","Store");primitiveBank.stock.setAttribute("Delay","10");primitiveBank.stock.setAttribute("Volume","100");primitiveBank.stock.setAttribute("NonNegative",!1);a(primitiveBank.stock);primitiveBank.stock.setAttribute("Image","None");primitiveBank.stock.setAttribute("FlipHorizontal",!1);primitiveBank.stock.setAttribute("FlipVertical",!1);primitiveBank.stock.setAttribute("LabelPosition",
"Middle");primitiveBank.state=d.createElement("State");primitiveBank.state.setAttribute("name",getText("New State"));primitiveBank.state.setAttribute("Note","");primitiveBank.state.setAttribute("Active","false");primitiveBank.state.setAttribute("Image","None");primitiveBank.state.setAttribute("FlipHorizontal",!1);primitiveBank.state.setAttribute("FlipVertical",!1);primitiveBank.state.setAttribute("LabelPosition","Middle");primitiveBank.transition=d.createElement("Transition");primitiveBank.transition.setAttribute("name",
getText("Transition"));primitiveBank.transition.setAttribute("Note","");primitiveBank.transition.setAttribute("Trigger","Timeout");primitiveBank.transition.setAttribute("Value","0");a(primitiveBank.transition);primitiveBank.action=d.createElement("Action");primitiveBank.action.setAttribute("name",getText("New Action"));primitiveBank.action.setAttribute("Note","");primitiveBank.action.setAttribute("Trigger","Condition");primitiveBank.action.setAttribute("Value","true");primitiveBank.action.setAttribute("Action",
"Move([Self], <<rand, rand>>)");primitiveBank.agents=d.createElement("Agents");primitiveBank.agents.setAttribute("name",getText("New Agent Population"));primitiveBank.agents.setAttribute("Note","");primitiveBank.agents.setAttribute("Size",100);primitiveBank.agents.setAttribute("GeoWrap",!1);primitiveBank.agents.setAttribute("GeoDimUnits","Unitless");primitiveBank.agents.setAttribute("GeoWidth",200);primitiveBank.agents.setAttribute("GeoHeight",100);primitiveBank.agents.setAttribute("Placement","Random");
primitiveBank.agents.setAttribute("PlacementFunction","<<rand*width([Self]), rand*height([Self])>>");primitiveBank.agents.setAttribute("Network","None");primitiveBank.agents.setAttribute("NetworkFunction","randBoolean(0.02)");primitiveBank.agents.setAttribute("Agent","");primitiveBank.agents.setAttribute("Image","None");primitiveBank.agents.setAttribute("FlipHorizontal",!1);primitiveBank.agents.setAttribute("FlipVertical",!1);primitiveBank.agents.setAttribute("LabelPosition","Middle");primitiveBank.variable=
d.createElement("Variable");primitiveBank.variable.setAttribute("name",getText("New Variable"));primitiveBank.variable.setAttribute("Note","");primitiveBank.variable.setAttribute("Equation","0");a(primitiveBank.variable);primitiveBank.variable.setAttribute("Image","None");primitiveBank.variable.setAttribute("FlipHorizontal",!1);primitiveBank.variable.setAttribute("FlipVertical",!1);primitiveBank.variable.setAttribute("LabelPosition","Middle");primitiveBank.button=d.createElement("Button");primitiveBank.button.setAttribute("name",
getText("New Button"));primitiveBank.button.setAttribute("Note","");primitiveBank.button.setAttribute("Function",'showMessage("Button action triggered!\\n\\nIf you want to edit this Action, click on the button while holding down the Shift key on your keyboard.")');primitiveBank.button.setAttribute("Image","None");primitiveBank.button.setAttribute("FlipHorizontal",!1);primitiveBank.button.setAttribute("FlipVertical",!1);primitiveBank.button.setAttribute("LabelPosition","Middle");primitiveBank.converter=
d.createElement("Converter");primitiveBank.converter.setAttribute("name",getText("New Converter"));primitiveBank.converter.setAttribute("Note","");primitiveBank.converter.setAttribute("Source","Time");primitiveBank.converter.setAttribute("Data","0,0; 1,1; 2,4; 3,9");primitiveBank.converter.setAttribute("Interpolation","Linear");a(primitiveBank.converter);primitiveBank.converter.setAttribute("Image","None");primitiveBank.converter.setAttribute("FlipHorizontal",!1);primitiveBank.converter.setAttribute("FlipVertical",
!1);primitiveBank.converter.setAttribute("LabelPosition","Middle");primitiveBank.flow=d.createElement("Flow");primitiveBank.flow.setAttribute("name",getText("Flow"));primitiveBank.flow.setAttribute("Note","");primitiveBank.flow.setAttribute("FlowRate","0");primitiveBank.flow.setAttribute("OnlyPositive",!0);primitiveBank.flow.setAttribute("TimeIndependent",!1);a(primitiveBank.flow);primitiveBank.link=d.createElement("Link");primitiveBank.link.setAttribute("name",getText("Link"));primitiveBank.link.setAttribute("Note",
"");primitiveBank.link.setAttribute("BiDirectional",!1);primitiveBank.setting=d.createElement("Setting");primitiveBank.setting.setAttribute("Note","");primitiveBank.setting.setAttribute("Version","28");primitiveBank.setting.setAttribute("Throttle","1");primitiveBank.setting.setAttribute("TimeLength","100");primitiveBank.setting.setAttribute("TimeStart","0");primitiveBank.setting.setAttribute("TimeStep","1");primitiveBank.setting.setAttribute("TimeUnits","Years");primitiveBank.setting.setAttribute("Units",
"");primitiveBank.setting.setAttribute("HiddenUIGroups",["Validation","User Interface"]);primitiveBank.setting.setAttribute("SolutionAlgorithm","RK1");primitiveBank.setting.setAttribute("BackgroundColor","white");primitiveBank.setting.setAttribute("Macros","");primitiveBank.setting.setAttribute("SensitivityPrimitives","");primitiveBank.setting.setAttribute("SensitivityRuns",50);primitiveBank.setting.setAttribute("SensitivityBounds","50, 80, 95, 100");primitiveBank.setting.setAttribute("SensitivityShowRuns",
"false");primitiveBank.setting.setAttribute("StrictUnits","true");mxPanel=Ext.create("Ext.Panel",{border:!1});mainPanel=Ext.create("Ext.Panel",{region:"center",border:!1,layout:"fit",dockedItems:[{xtype:"toolbar",dock:"bottom",hidden:!1,id:"unfoldToolbar",items:[{iconCls:"units-add-icon",text:getText("Unfold Model"),scope:this,id:"unfoldUnfoldBut",handler:function(){revealUnfoldButtons(!0);beginUnfolding()}},{scale:"large",iconAlign:"top",iconCls:"reload-icon",text:getText("Start Over"),scope:this,
id:"reloadUnfoldBut",handler:function(){restartUnfolding()}},{scale:"large",iconAlign:"top",iconCls:"cancel-icon",text:getText("Exit Unfolding"),scope:this,id:"exitUnfoldBut",handler:function(){revealUnfoldButtons(!1);finishUnfolding()}},{html:"",id:"messageUnfoldBut",flex:1,xtype:"box",style:{"font-size":"larger"},margin:"4 10 4 10"},{scale:"large",iconAlign:"top",iconCls:"next-icon",text:getText("Step Forward"),scope:this,id:"nextUnfoldBut",handler:function(){doUnfoldStep()}}]}],items:[mxPanel]});
mainPanel.on("resize",function(){graph.sizeDidChange()});configPanel=Ext.create("Ext.Panel",ConfigPanel());ribbonPanel=Ext.create("Ext.Panel",RibbonPanel(graph,mainPanel,configPanel));new Ext.Viewport({layout:"border",padding:"19 5 5 5",items:[ribbonPanel]});graph.addListener(mxEvent.CELL_CONNECTED,function(a,b){var c=b.getProperty("edge");"Link"==c.value.nodeName&&linkBroken(c)});graph.addListener(mxEvent.CELLS_FOLDED,function(a,b){b.properties.collapse||a.orderCells(!1,b.properties.cells)});mainPanel.body.insertHtml("beforeBegin",
"<div id='mainGraph'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>");mxPanel.body.dom.style.overflow="auto";mxClient.IS_MAC&&mxClient.IS_SF&&graph.addListener(mxEvent.SIZE,function(a){a.container.style.overflow="auto"});graph.model.styleForCellChanged=function(a,b){var c=mxGraphModel.prototype.styleForCellChanged(a,b);propogateGhosts(a);return c};graph.model.addListener(mxEvent.CHANGED,function(){setSaveEnabled(!0)});graph.model.addListener(mxEvent.CHANGE,function(a,
b){var c=b.getProperty("changes");10>c.length&&c.animate&&mxEffects.animateChanges(graph,c)});graph.addListener(mxEvent.CELLS_REMOVED,function(a,b){for(var c=b.getProperty("cells"),d=0;d<c.length;d++)if(deletePrimitive(c[d]),"Folder"==c[d].value.nodeName){var e=childrenCells(c[d]);if(null!=e)for(var f=0;f<e.length;f++)deletePrimitive(e[f])}selectionChanged(!0)});graph.addListener(mxEvent.CLICK,function(a,b){var c=b.getProperty("cell"),d=b.getProperty("event");if(!b.isConsumed()){var e=ribbonPanelItems().getComponent("valued");
if((null==c||"Folder"==c.value.nodeName)&&nodeInsertSelected()){var d=graph.getPointForEvent(d),f,g;null!=c&&"Folder"==c.value.nodeName?(f=c,g=c.geometry.getPoint().x,c=c.geometry.getPoint().y):(f=graph.getDefaultParent(),c=g=0);var h;graph.getModel().beginUpdate();try{if(e.getComponent("stock").pressed?h=graph.insertVertex(f,null,primitiveBank.stock.cloneNode(!0),d.x-50-g,d.y-20-c,100,40,"stock"):e.getComponent("variable").pressed?h=graph.insertVertex(f,null,primitiveBank.variable.cloneNode(!0),
d.x-50-g,d.y-25-c,120,50,"variable"):e.getComponent("text").pressed?h=graph.insertVertex(f,null,primitiveBank.text.cloneNode(!0),d.x-100-g,d.y-25-c,200,50,"text"):e.getComponent("converter").pressed?h=graph.insertVertex(f,null,primitiveBank.converter.cloneNode(!0),d.x-50-g,d.y-25-c,120,50,"converter"):e.getComponent("buttonBut").pressed?h=graph.insertVertex(f,null,primitiveBank.button.cloneNode(!0),d.x-50-g,d.y-25-c,120,40,"button"):e.getComponent("picture").pressed&&(h=graph.insertVertex(f,null,
primitiveBank.picture.cloneNode(!0),d.x-24-g,d.y-24-c,64,64,"picture"),setPicture(h)),e.getComponent("stock").toggle(!1),e.getComponent("variable").toggle(!1),e.getComponent("text").toggle(!1),e.getComponent("converter").toggle(!1),e.getComponent("picture").toggle(!1),e.getComponent("buttonBut").toggle(!1),isValued(h)||"Agents"==h.value.nodeName)for(var k=primitives("Display"),e=0;e<k.length;e++){var l=k[e];if(isTrue(l.getAttribute("AutoAddPrimitives"))&&"Scatterplot"!=l.getAttribute("Type")&&("Map"!=
l.getAttribute("Type")||"Agents"==h.value.nodeName)){var n=l.getAttribute("Primitives");if("undefined"==typeof n)l.setAttribute("Primitives",h.id);else{var o=n.split(",");o.push(h.id);l.setAttribute("Primitives",o.join(","))}}}}finally{graph.setSelectionCell(h),graph.getModel().endUpdate(),b.consume(),graph.cellEditor.startEditing(h)}}else null==c&&graph.clearSelection()}});graph.init(mxPanel.body.dom);graph.setConnectable(is_editor);graph.setDropEnabled(!0);graph.setSplitEnabled(!1);graph.connectionHandler.connectImage=
new mxImage(builder_path+"/images/connector.gif",16,16);graph.connectionHandler.isConnectableCell=function(a){if(!a)return!1;var b=connectionType();if("Link"==a.value.nodeName||"None"==b)return!1;if("Link"==b)return!0;a=orig(a);return"Stock"==a.value.nodeName||"State"==a.value.nodeName};graph.setPanning(!0);graph.setTooltips(!1);graph.connectionHandler.setCreateTarget(!1);new mxRubberband(graph);e=graph.getDefaultParent();graph.panningHandler.popup=mxUtils.bind(mxPanel,function(a,b,c,d){d.shiftKey||
showContextMenu(null,d)});graph.model.addListener(mxEvent.CHANGED,clearPrimitiveCache);settingCell=graph.insertVertex(e,null,primitiveBank.setting,20,20,80,40);settingCell.visible=!1;e=graph.insertVertex(e,null,primitiveBank.display.cloneNode(!0),50,20,64,64,"roundImage;image="+builder_path+"/images/DisplayFull.png;");e.visible=!1;e.setAttribute("AutoAddPrimitives",!0);e.setAttribute("name",getText("Default Display"));graph.getEdgeValidationError=function(a,b,c){if(null!=a&&("Flow"==a.value.nodeName||
"Transition"==a.value.nodeName)||null==this.model.getValue(a)&&ribbonPanelItems().getComponent("connect").getComponent("flow").pressed){if(isDefined(b)&&null!==b&&b.isConnectable()&&!("Stock"==b.value.nodeName||"Ghost"==b.value.nodeName&&"Stock"==orig(b).value.nodeName||"State"==b.value.nodeName||"Ghost"==b.value.nodeName&&"State"==orig(b).value.nodeName))return getText("You cannot make that connection.");if(isDefined(c)&&null!==c&&c.isConnectable()){if(!("Stock"==c.value.nodeName||"Ghost"==c.value.nodeName&&
"Stock"==orig(c).value.nodeName||"State"==c.value.nodeName||"Ghost"==c.value.nodeName&&"State"==orig(c).value.nodeName))return getText("You cannot make that connection.");if(isDefined(b)&&null!==b&&b.isConnectable()&&orig(b).value.nodeName!=orig(c).value.nodeName)return getText("You cannot connect stocks to transitions.")}}if(null!=a&&"Link"==a.value.nodeName||null==this.model.getValue(a)&&ribbonPanelItems().getComponent("connect").getComponent("link").pressed)if(isDefined(b)&&null!==b&&"Link"==b.value.nodeName||
isDefined(c)&&null!==c&&"Link"==c.value.nodeName)return getText("Links cannot be connected to links.");return mxGraph.prototype.getEdgeValidationError.apply(this,arguments)};if(null!=graph_source_data&&0<graph_source_data.length||-1==drupal_node_ID){d=mxUtils.parseXml(-1==drupal_node_ID?blankGraphTemplate:graph_source_data);e=new mxCodec(d);e.decode(d.documentElement,graph.getModel());e=getSetting();if(3>e.getAttribute("Version")){for(var f=primitives("Converter"),d=0;d<f.length;d++){for(var g=f[d].getAttribute("Inputs").split(","),
h=f[d].getAttribute("Outputs").split(","),k="",l=0;l<g.length;l++)0<l&&(k+=";"),k=k+g[l]+","+h[l];f[d].setAttribute("Data",k)}e.setAttribute("Version",3)}4>e.getAttribute("Version")&&(e.setAttribute("SolutionAlgorithm","RK1"),e.setAttribute("Version",4));if(5>e.getAttribute("Version")){f=primitives("Stock");for(d=0;d<f.length;d++)f[d].setAttribute("NonNegative",!1);e.setAttribute("Version",5)}if(6>e.getAttribute("Version")){f=primitives("Picture");for(d=0;d<f.length;d++)f[d].setAttribute("FlipHorizontal",
!1),f[d].setAttribute("FlipVertical",!1);e.setAttribute("Version",6)}if(7>e.getAttribute("Version")){f=primitives("Link");for(d=0;d<f.length;d++)f[d].setAttribute("BiDirectional",!1);e.setAttribute("Version",7)}if(8>e.getAttribute("Version")){f=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"));for(d=0;d<f.length;d++)f[d].setAttribute("Image","None");f=primitives("Display");for(d=0;d<f.length;d++)f[d].setAttribute("Image","Display");e.setAttribute("Version",8)}9>e.getAttribute("Version")&&
(e.setAttribute("BackgroundColor","white"),e.setAttribute("Version",9));if(10>e.getAttribute("Version")){f=primitives("Display");for(d=0;d<f.length;d++)f[d].setVisible(!1);e.setAttribute("Version",10);graph.refresh()}11>e.getAttribute("Version")&&(f=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"),primitives("Text")),graph.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,mxConstants.NONE,f),e.setAttribute("Version",11));if(12>e.getAttribute("Version")){f=primitives("Stock").concat(primitives("Parameter"),
primitives("Converter"));g=primitives("Picture");for(d=0;d<g.length;d++)g[d].setAttribute("LabelPosition","Bottom");for(d=0;d<f.length;d++)f[d].setAttribute("LabelPosition","Middle");e.setAttribute("Version",12)}if(13>e.getAttribute("Version")){f=primitives("Folder");for(d=0;d<f.length;d++)f[d].setAttribute("Image","None"),f[d].setAttribute("LabelPosition","Middle");e.setAttribute("Version",13)}if(14>e.getAttribute("Version")){f=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"),
primitives("Folder"));for(d=0;d<f.length;d++)f[d].setAttribute("FlipHorizontal",!1),f[d].setAttribute("FlipVertical",!1);e.setAttribute("Version",14)}if(15>e.getAttribute("Version")){f=primitives("Button");for(d=0;d<f.length;d++)g=f[d].getAttribute("Function"),g=g.replace(/getName/g,"findName"),g=g.replace(/getType/g,"findType"),g=g.replace(/getAll/g,"findAll"),f[d].setAttribute("Function",g);e.setAttribute("Version",15)}if(16>e.getAttribute("Version")){f=primitives("Parameter");for(d=0;d<f.length;d++)f[d].value=
changeNodeName(f[d].value,"Variable");e.setAttribute("Version",16)}17>e.getAttribute("Version")&&(e.setAttribute("Throttle",-1),e.setAttribute("Version",17));if(18>e.getAttribute("Version")){f=primitives("Display");for(d=0;d<f.length;d++)f[d].setAttribute("yAxis2",""),f[d].setAttribute("Primitives2","");e.setAttribute("Version",18)}19>e.getAttribute("Version")&&(e.setAttribute("Macros",""),e.setAttribute("Version",19));20>e.getAttribute("Version")&&(d=e.getAttribute("Units"),isDefined(d)&&e.setAttribute("Units",
d.replace(/,/g,"*")),e.setAttribute("Version",20));if(21>e.getAttribute("Version")){f=primitives("Display");for(d=0;d<f.length;d++)"Scatterplot"==f[d].getAttribute("Type")?(f[d].setAttribute("showMarkers",!0),f[d].setAttribute("showLines",!1)):(f[d].setAttribute("showMarkers",!1),f[d].setAttribute("showLines",!0));e.setAttribute("Version",21)}22>e.getAttribute("Version")&&(e.setAttribute("SensitivityPrimitives",""),e.setAttribute("SensitivityRuns",50),e.setAttribute("SensitivityBounds","50, 80, 95, 100"),
e.setAttribute("SensitivityShowRuns","false"),e.setAttribute("Version",22));23>e.getAttribute("Version")&&(d=findValue([/\bmin\(\s*</i,/\bmax\(\s*</i,/\bmean\(\s*</i,/\bmedian\(\s*</i,/\bstddev\(\s*</i]),0<d.length&&(d="<p>Insight Maker has received an update that removes the need for the <i>&lt;Primitive&gt;</i> notation. You may now use the <i>[Primitive]</i> in place of it.</p> <br/><p>A side effect of this update is that the usage of the Min(), Max(), Mean(), Median() and StdDev() statistical functions for aggregating over a primitive's history have been renamed to PastMin(), PastMax(), etc... (the usage of these function for values is unchanged; e.g. Max(1, 4, 2) is still correct).</p><br/><p>To correct this you need to change equations like:</p><br/><b>Max(&lt;x&gt;)</b></p><br/>to</p><br/><b>PastMax([x])</b></p><br/><p>The following of your primitives appear to use these function and need to be updated to work correctly with this change. You can adjust their equations manually:</p>"+
("<br/><p><b>"+Ext.Array.map(d,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>"),Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:d,buttons:Ext.MessageBox.OK})),e.setAttribute("Version",23));if(24>e.getAttribute("Version")){f=primitives("Folder");for(d=0;d<f.length;d++)f[d].setAttribute("Type","None");f=primitives("Display");for(d=0;d<f.length;d++)f[d].setAttribute("showArea",!1);f=primitives("Text");for(d=0;d<f.length;d++)f[d].setAttribute("LabelPosition",
"Middle");e.setAttribute("Version",24)}25>e.getAttribute("Version")&&(setAllConnectable(),e.setAttribute("Version",25));if(26>e.getAttribute("Version")){f=primitives("Flow");for(d=0;d<f.length;d++)isTrue(f[d].getAttribute("OnlyPositive"))||(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[f[d]]),graph.setCellStyles("startFill",0,[f[d]]));e.setAttribute("Version",26)}if(27>e.getAttribute("Version")){f=primitives("Display");for(d=0;d<f.length;d++)f[d].setAttribute("legendPosition","Automatic");
e.setAttribute("Version",27)}if(28>e.getAttribute("Version")){f=primitives();for(d=0;d<f.length;d++)"ShowSlider"in f[d]&&f[d].setAttribute("SliderStep","");e.setAttribute("Version",28)}}loadBackgroundColor();is_editor&&(e=new mxAutoSaveManager(graph),e.autoSaveThreshold=0,e.save=function(){""!=graph_title&&!1==unfoldingManager.unfolding&&saveModel()});e=function(a,b){undoHistory.undoableEditHappened(b.getProperty("edit"))};graph.getModel().addListener(mxEvent.UNDO,e);graph.getView().addListener(mxEvent.UNDO,
e);graph.addListener(mxEvent.CELLS_FOLDED,function(a,b){for(var c=b.properties.cells,d=0;d<c.length;d++)setPicture(c[d]),setLabelPosition(c[d])});var n=ribbonPanelItems(),e=function(){var a=!graph.isSelectionEmpty(),b=a&&(1==graph.getSelectionCount()?"Ghost"!=graph.getSelectionCell().value.nodeName:!0);n.getComponent("valued").getComponent("folder").setDisabled(0>=graph.getSelectionCount());n.getComponent("valued").getComponent("ghostBut").setDisabled(1!=graph.getSelectionCount()||!isValued(graph.getSelectionCell())&&
"Picture"!=graph.getSelectionCell().value.nodeName&&"Agents"!=graph.getSelectionCell().value.nodeName||"Flow"==graph.getSelectionCell().value.nodeName||"Transition"==graph.getSelectionCell().value.nodeName||"Ghost"==graph.getSelectionCell().value.nodeName);n.getComponent("actions").getComponent("cut").setDisabled(!a);n.getComponent("actions").getComponent("copy").setDisabled(!a);n.getComponent("actions").getComponent("delete").setDisabled(!a);n.getComponent("style").getComponent("fillcolor").setDisabled(!(!a||
b));n.getComponent("style").getComponent("fontcolor").setDisabled(!b);n.getComponent("style").getComponent("linecolor").setDisabled(!b);n.getComponent("style").getComponent("bold").setDisabled(!b);n.getComponent("style").getComponent("italic").setDisabled(!b);n.getComponent("style").getComponent("underline").setDisabled(!b);fontCombo.setDisabled(!b);sizeCombo.setDisabled(!b);n.getComponent("style").getComponent("align").setDisabled(!b);n.getComponent("style").getComponent("movemenu").setDisabled(!a);
n.getComponent("style").getComponent("picturemenu").setDisabled(!a);n.getComponent("connect").getComponent("reverse").setDisabled(!(a&&(cellsContainNodename(graph.getSelectionCells(),"Link")||cellsContainNodename(graph.getSelectionCells(),"Flow")||cellsContainNodename(graph.getSelectionCells(),"Transition"))));setStyles()};graph.getSelectionModel().addListener(mxEvent.CHANGED,e);clipboardListener=function(){n.getComponent("actions").getComponent("paste").setDisabled(mxClipboard.isEmpty())};clipboardListener();
d=function(){n.getComponent("actions").getComponent("undo").setDisabled(!undoHistory.canUndo());n.getComponent("actions").getComponent("redo").setDisabled(!undoHistory.canRedo())};undoHistory.addListener(mxEvent.ADD,d);undoHistory.addListener(mxEvent.UNDO,d);undoHistory.addListener(mxEvent.REDO,d);e();d();var o=graph.createGroupCell;graph.createGroupCell=function(){var a=o.apply(this,arguments);a.setStyle("folder");a.setValue(primitiveBank.folder.cloneNode(!0));return a};graph.connectionHandler.factoryMethod=
function(a,b){var c,d;ribbonPanelItems().getComponent("connect").getComponent("link").pressed?(c="link",d=primitiveBank.link.cloneNode(!0)):null!=a&&"Stock"==a.value.nodeName||null!=b&&"Stock"==b.value.nodeName?(c="flow",d=primitiveBank.flow.cloneNode(!0)):(c="transition",d=primitiveBank.transition.cloneNode(!0));c=new mxCell(d,new mxGeometry(0,0,100,100),c);c.geometry.setTerminalPoint(new mxPoint(0,100),!0);c.geometry.setTerminalPoint(new mxPoint(100,0),!1);c.edge=!0;c.connectable=!0;return c};graph.getTooltipForCell=
function(a){return null!=a&&null!=a.value.getAttribute("Note")&&0<a.value.getAttribute("Note").length?a.value.getAttribute("Note"):""};var p=new Ext.ToolTip({html:"",hideDelay:0,dismissDelay:0,showDelay:0});graph.tooltipHandler.show=function(a,b,c){null!=a&&0<a.length?(p.update(a),p.showAt([b,c+mxConstants.TOOLTIP_VERTICAL_OFFSET])):p.hide()};graph.tooltipHandler.hide=function(){p.hide()};graph.tooltipHandler.hideTooltip=function(){p.hide()};mxGraphHandler.prototype.guidesEnabled=!0;mxGraphHandler.prototype.mouseDown=
function(a,b){var c=this.getInitialCellForEvent(b);if(null!==c&&"Button"==c.value.nodeName&&!graph.getSelectionModel().isSelected(c)&&!1==b.evt.shiftKey)return pressButton(c),b.consume(),!1;if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&!this.graph.isForceMarqueeEvent(b.getEvent())&&null!=b.getState()&&(c=this.getInitialCellForEvent(b),this.cell=null,this.delayedSelection=this.isDelayedSelection(c),this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(c,b.getEvent()),
this.isMoveEnabled())){var d=this.graph.model,e=d.getGeometry(c);this.graph.isCellMovable(c)&&(!d.isEdge(c)||1<this.graph.getSelectionCount()||null!=e.points&&0<e.points.length||null==d.getTerminal(c,!0)||null==d.getTerminal(c,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(b.getEvent())&&this.graph.isCellsCloneable())&&this.start(c,b.getX(),b.getY());this.cellWasClicked=!0;"SELECT"!=b.getSource().nodeName&&b.consume()}};graph.addListener(mxEvent.CLICK,function(a,b){b.consume()});mxGuide.prototype.isEnabledForEvent=
function(a){return!mxEvent.isAltDown(a)};e=function(a,b){var c=b.getProperty("edit").changes;graph.setSelectionCells(graph.getSelectionCellsForChanges(c))};undoHistory.addListener(mxEvent.UNDO,e);undoHistory.addListener(mxEvent.REDO,e);is_embed||graph.container.focus();setTopLinks();is_topBar||toggleTopBar();is_sideBar||configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1);Ext.FocusManager.enable();Ext.FocusManager.keyNav.disable();Ext.FocusManager.shouldShowFocusFrame=function(){return!1};mxKeyHandler.prototype.isGraphEvent=
function(a){if(a.altKey||a.shiftKey)return!1;a=Ext.WindowManager.getActive();return isDefined(a)&&null!==a&&a.modal?!1:isUndefined(Ext.FocusManager.focusedCmp)||"x-container"==Ext.FocusManager.focusedCmp.componentCls||"x-window"==Ext.FocusManager.focusedCmp.componentCls||"x-panel"==Ext.FocusManager.focusedCmp.componentCls||"x-panel-header"==Ext.FocusManager.focusedCmp.componentCls||"x-window-header"==Ext.FocusManager.focusedCmp.componentCls||"x-btn-group"==Ext.FocusManager.focusedCmp.componentCls};
e=new mxKeyHandler(graph);e.getFunction=function(a){return null!=a?mxEvent.isControlDown(a)||mxClient.IS_MAC&&a.metaKey?this.controlKeys[a.keyCode]:this.normalKeys[a.keyCode]:null};e.bindKey(13,function(){graph.foldCells(!1)});e.bindKey(8,function(){is_editor&&graph.removeCells(graph.getSelectionCells(),!1)});e.bindKey(46,function(){is_editor&&graph.removeCells(graph.getSelectionCells(),!1)});e.bindControlKey(65,function(){graph.selectAll()});e.bindControlKey(66,function(){is_editor&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,
mxConstants.FONT_BOLD,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});e.bindControlKey(73,function(){is_editor&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});e.bindControlKey(85,function(){is_editor&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});e.bindControlKey(89,function(){undoHistory.redo()});
e.bindControlKey(90,function(){undoHistory.undo()});e.bindControlKey(88,function(){is_editor&&(mxClipboard.cut(graph),clipboardListener())});e.bindControlKey(67,function(){mxClipboard.copy(graph);clipboardListener()});e.bindControlKey(13,function(){runModel()});e.bindControlKey(75,function(){scratchpadFn()});e.bindControlKey(69,function(){doSensitivity()});e.bindControlKey(70,function(){showFindAndReplace()});e.bindControlKey(71,function(){var a=Ext.getCmp("findNextBut");a&&!a.disabled&&findNext()});
e.bindControlKey(76,function(){timeSettingsFn()});e.bindControlKey(80,function(){var a=mxUtils.prompt(getText("Enter page count for printing")+":","1");null!=a&&(a=mxUtils.getScaleForPageCount(a,graph),(new mxPrintPreview(graph,a)).open())});e.bindControlKey(192,function(){var a=graph.getSelectionCell();isDefined(a)&&null!=a&&(new Ext.RichTextWindow({parent:"",cell:a,html:getNote(a)})).show()});e.bindControlKey(83,function(){is_editor&&saveModel()});e.bindControlKey(86,function(){is_editor&&(mxClipboard.paste(graph),
clipboardListener())});graph.getSelectionModel().addListener(mxEvent.CHANGE,function(){selectionChanged(!1)});var r=function(a){var a=a.split(","),b=primitives();if(null!=b)for(var c=0;c<b.length;c++)-1<Ext.Array.indexOf(a,b[c].id)&&(a[Ext.Array.indexOf(a,b[c].id)]=b[c].getAttribute("name"));return a.join(", ")};selectionChanged=function(a){isDefined(grid)&&(grid.plugins[0].completeEdit(),configPanel.removeAll());var c=graph.getSelectionCell();a&&(c=null);var a=[],d=[],e=[],f;null!=c&&(f=c.value.nodeName);
null!=c&&1==graph.getSelectionCells().length&&"Ghost"!=f?(configPanel.setTitle(f),e=[{name:"Note",text:getText("Note"),value:c.getAttribute("Note"),group:"  "+getText("General"),editor:new Ext.form.customFields.richText({})},{name:"name",text:getText("(name)"),value:c.getAttribute("name"),group:"  "+getText("General")}],is_editor&&-99!=c.getAttribute("Image",-99)&&e.push({name:"Image",text:getText("Image"),value:c.getAttribute("Image"),group:getText("User Interface"),editor:b()}),isValued(c)&&"State"!=
c.value.nodeName&&"Action"!=c.value.nodeName&&(is_editor&&"Converter"!=c.value.nodeName&&(e.push({name:"ShowSlider",text:getText("Show Value Slider"),value:isTrue(c.getAttribute("ShowSlider")),group:getText("User Interface")}),e.push({name:"SliderMax",text:getText("Slider Max"),value:parseFloat(c.getAttribute("SliderMax")),group:getText("User Interface"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"SliderMin",text:getText("Slider Min"),value:parseFloat(c.getAttribute("SliderMin")),
group:getText("User Interface"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"SliderStep",text:getText("Slider Step"),value:c.getAttribute("SliderStep"),group:getText("User Interface"),editor:{xtype:"numberfield",minValue:0,allowDecimals:!0,decimalPrecision:9}})),"Transition"!=c.value.nodeName&&e.push({name:"Units",text:getText("Units"),value:c.getAttribute("Units"),group:getText("Validation"),editor:new Ext.form.customFields.units({})}),is_editor&&(e.push({name:"MaxConstraintUsed",
text:getText("Max Constraint"),value:isTrue(c.getAttribute("MaxConstraintUsed")),group:getText("Validation")}),e.push({name:"MaxConstraint",text:getText("Max Constraint"),value:parseFloat(c.getAttribute("MaxConstraint")),group:getText("Validation")}),e.push({name:"MinConstraintUsed",text:getText("Min Constraint"),value:isTrue(c.getAttribute("MinConstraintUsed")),group:getText("Validation")}),e.push({name:"MinConstraint",text:getText("Min Constraint"),value:parseFloat(c.getAttribute("MinConstraint")),
group:getText("Validation")})))):configPanel.setTitle("");var g="<br/><img style='float:left; margin-right: 7px' src='"+builder_path+"/images/gui/help.png' width=32px height=32px />",h="",k="";if(null==c||1<graph.getSelectionCells().length)if(g=sliderPrimitives(),-1==drupal_node_ID&&0==g.length)h="<center><a href='"+builder_path+"/resources/QuickStart.pdf' target='_blank'><img src='"+builder_path+"/images/Help.jpg' width=217 height=164 /></a><br/><br/><br/>Or take a look at the <a href='http://InsightMaker.com/help' target='_blank'>Detailed Insight Maker Manual</a><br/><br/>There is also a <a href='http://www.systemswiki.org/index.php?title=Modeling_%26_Simulation_with_Insight_Maker' target='_blank'>free, on-line education course</a> which teaches you how to think in a systems manner using Insight Maker.</center>";
else{var h=clean(graph_description),l="";""==h&&is_editor&&(h="<span style='color: gray'>"+getText("You haven't entered a description for this Insight yet. Please enter one to help others understand it.")+"</span>");""!=graph_tags.trim()&&graph_tags.split(",").forEach(function(a){a=a.trim();l=l+"<a target='_blank' href='http://insightmaker.com/tag/"+clean(a.replace(/ /g,"-"))+"'>"+clean(a)+"</a> "});h="<big class='description'>"+h+"</big>";-1!=drupal_node_ID&&null==c&&(h=h+"<br/><br/> "+(is_editor?
'<a href="#" style="text-decoration:none" onclick="updateProperties()">'+getText("Edit description")+"</a>":"")+' <div style="float:right; vertical-align:middle"> '+getText("Share")+' <span  id="st_facebook_button" displayText="Facebook"></span><span  id="st_twitter_button" displayText="Tweet"></span><span  id="st_linkedin_button" displayText="LinkedIn"></span><span  id="st_mail_button" displayText="EMail"></span></div>');h+="<br/><br/>";""!=l&&(h=h+"Tags: "+l+"<br/><br/>");!is_editor&&""!=graph_author_name&&
(h=h+"Author: <a target='_blank' href='http://insightmaker.com/user/"+clean(graph_author_id)+"'>"+clean(graph_author_name)+"</a><br/><br/>");if(0<g.length){var n=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"}});a.push(n);a.push(Ext.create("Ext.Component",{html:"<br/>",padding:3}));g=sliderPrimitives();sliders=[];for(f=0;f<g.length;f++){isNaN(getValue(g[f]))&&setValue(g[f],(parseFloat(g[f].getAttribute("SliderMin"))+parseFloat(g[f].getAttribute("SliderMax")))/2);var o=parseFloat(g[f].getAttribute("SliderStep"))?
parseFloat(g[f].getAttribute("SliderStep")):void 0,p=o?Math.ceil(-Math.log(o)/Math.log(10)):Math.floor(-(Math.log(Math.max(0.1,g[f].getAttribute("SliderMax")-g[f].getAttribute("SliderMin")))/Math.log(10)-4)),o=Ext.create("Ext.slider.Single",{flex:1,minValue:parseFloat(g[f].getAttribute("SliderMin")),sliderCell:g[f],value:parseFloat(getValue(g[f])),maxValue:parseFloat(g[f].getAttribute("SliderMax")),decimalPrecision:p,increment:o});sliders.push(o);var C=Ext.create("Ext.form.field.Number",{slider:o,
width:60,decimalPrecision:p,ignoreChange:!1,id:"sliderVal"+g[f].id,hideTrigger:!0,keyNavEnabled:!1,selectOnFocus:!0,mouseWheelEnabled:!1,minValue:parseFloat(g[f].getAttribute("SliderMin")),maxValue:parseFloat(g[f].getAttribute("SliderMax")),listeners:{change:function(a){if(!a.ignoreChange&&a.validate()){a.ignoreChange=!0;var b=parseFloat(a.getValue(),10);isNaN(b)||a.slider.setValue(b);a.ignoreChange=!1}}}});o.addListener("change",function(a,b){var c=Ext.getCmp("sliderVal"+a.sliderCell.id);(!c.ignoreChange||
parseFloat(c.getValue())!=parseFloat(b))&&c.setRawValue(parseFloat(b));setValue(a.sliderCell,parseFloat(b))});p=g[f].getAttribute("Note");isUndefined(p)&&(p="");n.add(Ext.create("Ext.Component",{html:"<big> &bull; "+g[f].getAttribute("name")+"</big>"+(""==p?"":"<div style='font-size:small;color:grey'>"+p+"</div>"),padding:3}));n.add(Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"stretch"},margin:3,items:[o,C]}));C.setValue(parseFloat(getValue(g[f])))}}}else if("Stock"==f)k=g+"<p>A stock stores a material or a resource. Lakes and Bank Accounts are both examples of stocks. One stores water while the other stores money. The Initial Value defines how much material is initially in the Stock.</p>"+
(is_editor?' <br/><h1>Examples of valid Initial Values:</h1><center><table class="undefined"><tr><td align=center>Static Value</td></tr><tr><td align=center><i>10</i></td></tr><tr><td>Mathematical Equation</td></tr><tr><td align=center><i>cos(2.78)+7*2</i></td></tr><tr><td align=center>Referencing Other Primitives</td></tr><tr><td align=center><i>5+[My Variable]</i></td></tr></table></center>':""),e.push({name:"InitialValue",text:getText("Initial Value")+" =",value:c.getAttribute("InitialValue"),
group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"AllowNegatives",text:getText("Allow Negatives"),value:!isTrue(c.getAttribute("NonNegative")),group:" "+getText("Configuration")}),e.push({name:"StockMode",text:getText("Stock Type"),value:c.getAttribute("StockMode"),group:"Behavior",editor:new Ext.form.ComboBox({triggerAction:"all",store:["Store","Conveyor"],selectOnFocus:!0})}),e.push({name:"Delay",text:getText("Delay"),value:c.getAttribute("Delay").toString(),
group:"Behavior"});else if("Variable"==f)k=g+"<p>A variable is a dynamically updated object in your model that synthesizes available data or provides a constant value for use in your equations. The birth rate of a population or the maximum volume of water in a lake are both possible uses of variables.</p>"+(is_editor?"<br/><h1>Examples of valid Values:</h1><center><table class='undefined'><tr><td align=center>Static Value</td></tr><tr><td align=center><i>7.2</i></td></tr><tr><td>Using Current Simulation Time</td></tr><tr><td align=center><i>seconds^2+6</i></td></tr><tr><td align=center>Referencing Other Primitives</td></tr><tr><td align=center><i>[Lake Volume]*2</i></td></tr></table></center>":
""),e.push({name:"Equation",text:getText("Value/Equation")+" =",value:c.getAttribute("Equation"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("Link"==c.value.nodeName)k=g+"Links connect the different parts of your model. If one primitive in your model refers to another in its equation, the two primitives must either be directly connected or connected through a link. Once connected with links, square-brackets may be used to reference values of other primitives. So if you have a stock called <i>Bank Balance</i>, you could refer to it in another primitive's equation with <i>[Bank Balance]</i>.",
e.push({name:"BiDirectional",text:getText("Bi-Directional"),value:isTrue(c.getAttribute("BiDirectional")),group:" "+getText("Configuration")});else if("Folder"==c.value.nodeName)k=g+"Folders group together similar items in a logical way. You can collapse and expand folders to hide or reveal model complexity.",e.push({name:"Type",text:getText("Behavior"),value:c.getAttribute("Type"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["None","Agent"],editable:!1,
selectOnFocus:!0})});else if("Button"==c.value.nodeName)k=g+"Buttons are used for interactivity. To select a button without triggering its action, hold down the Shift key when you click the button. Buttons are currently in Beta and their implementation may change in later versions of Insight Maker. More button documentation is <a href='http://insightmaker.com/sites/default/files/API/' target='_blank'>available here</a>.",e.push({name:"Function",text:getText("Action"),value:c.getAttribute("Function"),
group:" "+getText("Configuration"),editor:new Ext.form.TextArea({grow:!0})});else if("Flow"==c.value.nodeName)k=g+"<p>Flows represent the transfer of material from one stock to another. For example given the case of a lake, the flows for the lake might be: River Inflow, River Outflow, Precipitation, and Evaporation. Flows are given a flow rate and they operator over one unit of time; in effect: flow per one second or per one minute.</p>"+(is_editor?"<br/><h1>Examples of valid Flow Rates:</h1><center><table class='undefined'><tr><td align=center>Constant Rate</td></tr><tr><td align=center><i>10</i></td></tr><tr><td align=center>Using the Current Simulation Time</td></tr><tr><td align=center><i>minutes/3</i></td></tr><tr><td align=center>Referencing Other Primitives</td></tr><tr><td align=center><i>[Lake Volume]*0.05+[Rain]/4</i></td></tr></table></center>":
""),e.push({name:"FlowRate",text:getText("Flow Rate")+" =",value:c.getAttribute("FlowRate"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"OnlyPositive",text:getText("Only Positive Rates"),value:isTrue(c.getAttribute("OnlyPositive")),group:" "+getText("Configuration")});else if("Transition"==c.value.nodeName)k=g+"<p>Transitions move agents between states. The probability is probability per time.</p>",e.push({name:"Trigger",text:getText("Triggered by"),
value:c.getAttribute("Trigger"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!0})}),e.push({name:"Value",text:getText("Value")+" =",value:c.getAttribute("Value"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("Action"==c.value.nodeName)k=g+"<p>Actions can be used to move agents or dynamically create connections between them.</p>",
e.push({name:"Trigger",text:getText("Triggered by"),value:c.getAttribute("Trigger"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!0})}),e.push({name:"Value",text:getText("Trigger Value")+" =",value:c.getAttribute("Value"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"Action",text:getText("Action")+" =",value:c.getAttribute("Action"),
group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("State"==c.value.nodeName)k=g+"<p>The current state of an agent.</p>",e.push({name:"Active",text:getText("Start Active")+" = ",value:c.getAttribute("Active"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("Agents"==c.value.nodeName){k=g+"<p>A collection of agents.</p>";g=[];n=primitives("Folder");for(f=0;f<n.length;f++)"Agent"==
n[f].getAttribute("Type")&&g.push([n[f].id,clean(n[f].getAttribute("name"))]);f=new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:g});e.push({name:"Agent",text:getText("Agent Base"),value:c.getAttribute("Agent"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",store:f,selectOnFocus:!0,valueField:"myId",editable:!1,displayField:"displayText"}),renderer:r});e.push({name:"Size",text:getText("Population Size"),value:c.getAttribute("Size"),
group:" "+getText("Configuration"),editor:{xtype:"numberfield",minValue:0,allowDecimals:!1}});e.push({name:"GeoWidth",text:getText("Width"),value:c.getAttribute("GeoWidth"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});e.push({name:"GeoHeight",text:getText("Height"),value:c.getAttribute("GeoHeight"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});e.push({name:"GeoDimUnits",text:getText("Dimension Units"),
value:c.getAttribute("GeoDimUnits"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.units({})});e.push({name:"GeoWrap",text:getText("Wrap Around"),value:isTrue(c.getAttribute("GeoWrap")),group:" "+getText("Geometry")});e.push({name:"Placement",text:getText("Placement Method"),value:c.getAttribute("Placement"),group:" "+getText("Geometry"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",selectOnFocus:!0,editable:!1,store:["Random","Grid","Ellipse","Network","Custom Function"]}),
renderer:r});e.push({name:"PlacementFunction",text:getText("Custom Function"),value:c.getAttribute("PlacementFunction"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});e.push({name:"Network",text:getText("Network Method"),value:c.getAttribute("Network"),group:" "+getText("Network"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",selectOnFocus:!0,editable:!1,store:["None","Custom Function"]})});e.push({name:"NetworkFunction",text:getText("Custom Function"),
value:c.getAttribute("NetworkFunction"),group:" "+getText("Network"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer})}else if("Ghost"==f)k=g+"This item is a 'Ghost' of another primitive. It mirrors the values and properties of its source primitive. You cannot edit the properties of the Ghost. You need to instead edit the properties of its source.<p><center><a href='#' onclick='var x = findID(getSelected()[0].getAttribute(\"Source\"));highlight(x);'>Show Source</a></center></p>";
else if("Converter"==f){k=g+"Converters store a table of input and output data. When the input source takes on one of the input values, the converter takes on the corresponding output value. If no specific input value exists for the current input source value, then the nearest input neighbors are averaged.";p=neighborhood(c);g=[["Time","Time"]];for(f=0;f<p.length;f++)p[f].linkHidden||g.push([p[f].item.id,clean(p[f].item.getAttribute("name"))]);f=new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],
data:g});e.push({name:"Source",text:getText("Input Source"),value:c.getAttribute("Source"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",store:f,selectOnFocus:!0,valueField:"myId",editable:!1,displayField:"displayText"}),renderer:r});e.push({name:"Data",text:getText("Data"),value:c.getAttribute("Data"),group:"Input/Output Table",editor:new Ext.form.customFields.converter({})});e.push({name:"Interpolation",text:getText("Interpolation"),value:c.getAttribute("Interpolation"),
group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["None","Linear"],editable:!1,selectOnFocus:!0})})}else"Picture"==f&&(k=g+"Pictures can make your model diagram come alive.");configPanel.removeAll();""!=h&&d.push(Ext.create("Ext.Component",{xtype:"component",html:h,margin:"5 5 5 5"}));""!=k&&a.push(Ext.create("Ext.Component",{xtype:"component",html:k,margin:"5 5 5 5"}));createGrid(e,d,a,c);if(-1!=drupal_node_ID)try{stWidget.addEntry({service:"twitter",element:document.getElementById("st_twitter_button"),
url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description}),stWidget.addEntry({service:"facebook",element:document.getElementById("st_facebook_button"),url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description}),stWidget.addEntry({service:"linkedin",element:document.getElementById("st_linkedin_button"),
url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description}),stWidget.addEntry({service:"email",element:document.getElementById("st_mail_button"),url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description})}catch(F){}};selectionChanged(!1);-1==drupal_node_ID?setSaveEnabled(!0):
setSaveEnabled(!1);updateWindowTitle();saved_enabled||ribbonPanelItems().getComponent("savegroup").setVisible(!1);handelCursors();handleUnfoldToolbar();!is_editor&&is_embed&&1==is_zoom&&(graph.getView().setScale(0.25),graph.fit(),graph.fit())}var surpressCloseWarning=!1;
function confirmClose(){if(surpressCloseWarning)surpressCloseWarning=!1;else if(saved_enabled&&!ribbonPanelItems().getComponent("savegroup").getComponent("savebut").disabled)return getText("You have made unsaved changes to this Insight. If you close now, they will be lost.")}
Ext.example=function(){var a;return{msg:function(b,c){a||(a=Ext.core.DomHelper.insertFirst(document.body,{id:"msg-div"},!0));var d=Ext.String.format.apply(String,Array.prototype.slice.call(arguments,1)),d=Ext.core.DomHelper.append(a,'<div class="msg"><h3>'+b+"</h3><p>"+d+"</p></div>",!0);d.hide();d.slideIn("t").ghost("t",{delay:4500,remove:!0})}}}();Ext.round=function(a,b){var c=Number(a);"number"==typeof b&&(b=Math.pow(10,b),c=Math.round(a*b)/b);return c};
var makeGhost=function(){var a=graph.getSelectionCell(),b=graph.getDefaultParent(),c=getPosition(a),d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",30);graph.getModel().beginUpdate();b=graph.insertVertex(b,null,primitiveBank.ghost.cloneNode(!0),c[0]+10,c[1]+10,a.getGeometry().width,a.getGeometry().height,d);b.value.setAttribute("Source",a.id);b.value.setAttribute("name",a.getAttribute("name"));graph.setSelectionCell(b);graph.getModel().endUpdate()},makeFolder=function(){var a=graph.groupCells(null,
20);a.setConnectable(!0);graph.setSelectionCell(a);graph.orderCells(!0)};
function showContextMenu(a,b){var c=getSelected(),d=!1;0<c.length&&(d="Folder"==c[0].value.nodeName&&!getCollapsed(c[0]));var e=0<c.length&&!d,f={text:getText("Create Folder"),iconCls:"folder-icon",disabled:!e,handler:makeFolder};(new Ext.menu.Menu({items:[{text:getText("Create Stock"),iconCls:"stock-icon-small",disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Stock"),"Stock",[a.x,a.y],[100,40]);graph.model.endUpdate();d&&setParent(e,
c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Variable"),iconCls:"parameter-icon-small",disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Variable"),"Variable",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Converter"),iconCls:"converter-icon",disabled:e,handler:function(){graph.model.beginUpdate();
var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Converter"),"Converter",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},"-",{text:getText("Create State"),disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New State"),"State",[a.x,a.y],[120,40]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},
20)}},{text:getText("Create Action"),disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Action"),"Action",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Agent Population"),disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("Agent Population"),"Agents",[a.x,
a.y],[170,80]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},"-",{text:getText("Create Text"),iconCls:"font-icon",disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Text"),"Text",[a.x,a.y],[200,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Picture"),iconCls:"picture-icon",
disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive("","Picture",[a.x,a.y],[64,64]);graph.model.endUpdate();d&&setParent(e,c[0]);setPicture(e);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Button"),iconCls:"button-icon",disabled:e,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Button"),"Button",[a.x,a.y],[120,40]);graph.model.endUpdate();
d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},"-",{text:getText("Ghost Primitive"),iconCls:"ghost-icon",disabled:1!=graph.getSelectionCount()||!isValued(graph.getSelectionCell())&&"Picture"!=graph.getSelectionCell().value.nodeName||"Flow"==graph.getSelectionCell().value.nodeName||"Ghost"==graph.getSelectionCell().value.nodeName,handler:makeGhost},f,,"-",{text:getText("Delete"),iconCls:"delete-icon",disabled:!e,handler:function(){graph.removeCells(graph.getSelectionCells(),
!1)}}]})).showAt([b.clientX+1,b.clientY+1])}var blankGraphTemplate='<mxGraphModel>\n  <root>\n    <mxCell id="0"/>\n    <mxCell id="1" parent="0"/>\n    <Picture name="" Note="" Image="http://insightmaker.com/builder/images/rabbit.jpg" FlipHorizontal="false" FlipVertical="false" LabelPosition="Bottom" id="17">\n      <mxCell style="picture;image=http://insightmaker.com/builder/images/rabbit.jpg;imageFlipV=0;imageFlipH=0;shape=image" parent="1" vertex="1">\n        <mxGeometry x="10" y="192.75" width="210" height="224.25" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Setting Note="" Version="25" TimeLength="20" TimeStart="0" TimeStep="1" TimeUnits="Years" StrictUnits="true" Units="" HiddenUIGroups="Validation,User Interface" SolutionAlgorithm="RK1" BackgroundColor="white" Throttle="1" Macros="" SensitivityPrimitives="" SensitivityRuns="50" SensitivityBounds="50, 80, 95, 100" SensitivityShowRuns="false" id="2">\n      <mxCell parent="1" vertex="1" visible="0">\n        <mxGeometry x="20" y="20" width="80" height="40" as="geometry"/>\n      </mxCell>\n    </Setting>\n    <Display name="Default Display" Note="" Type="Time Series" xAxis="Time (%u)" yAxis="" ThreeDimensional="false" Primitives="4" AutoAddPrimitives="true" ScatterplotOrder="X Primitive, Y Primitive" Image="Display" yAxis2="" Primitives2="" showMarkers="false" showLines="true" showArea="false" id="3">\n      <mxCell style="roundImage;image=/builder/images/DisplayFull.png;" parent="1" vertex="1" visible="0">\n        <mxGeometry x="50" y="20" width="64" height="64" as="geometry"/>\n      </mxCell>\n    </Display>\n    <Stock name="Rabbits" Note="The number of rabbits currently alive." InitialValue="200" StockMode="Store" Delay="10" Volume="100" NonNegative="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="1000" SliderMin="0" Image="None" AllowNegatives="true" LabelPosition="Middle" FlipHorizontal="false" FlipVertical="false" id="4">\n      <mxCell style="stock;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="407.5" y="422" width="100" height="40" as="geometry"/>\n      </mxCell>\n    </Stock>\n    <Flow name="Births" Note="The number of rabbits born each year." FlowRate="[Rabbits]*[Rabbit Birth Rate]" OnlyPositive="true" TimeIndependent="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" id="5">\n      <mxCell style="" parent="1" target="4" edge="1">\n        <mxGeometry x="47.5" y="32" width="100" height="100" as="geometry">\n          <mxPoint x="457.5" y="184.5" as="sourcePoint"/>\n          <mxPoint x="57.5" y="282" as="targetPoint"/>\n          <mxPoint x="-0.5" y="5" as="offset"/>\n        </mxGeometry>\n      </mxCell>\n    </Flow>\n    <Variable name="Rabbit Birth Rate" Note="The proportional increase in the number of rabbits per year." Equation="0.1" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="1" SliderMin="0" Image="None" LabelPosition="Middle" FlipHorizontal="false" FlipVertical="false" id="6">\n      <mxCell style="parameter;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="551.25" y="157" width="140" height="50" as="geometry"/>\n      </mxCell>\n    </Variable>\n    <Text name="&amp;larr; This is a Stock" LabelPosition="Middle" id="8">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="536.25" y="392" width="160" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Stocks store things like money or water or, in this case, rabbits." LabelPosition="Middle" id="9">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="516.25" y="428.5" width="210" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="This is a Flow &amp;rarr;" LabelPosition="Middle" id="10">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="267.5" y="182" width="150" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Flows move material between Stocks. In this case it represents the birth of new rabbits." LabelPosition="Middle" id="11">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="227.5" y="224.5" width="210" height="70" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="This is a Variable&#xa;" LabelPosition="Middle" id="12">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="496.25" y="62" width="245" height="35" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Link name="Link" Note="" BiDirectional="false" id="7">\n      <mxCell style="entity" parent="1" source="6" target="5" edge="1">\n        <mxGeometry x="47.5" y="32" width="100" height="100" as="geometry">\n          <mxPoint x="47.5" y="132" as="sourcePoint"/>\n          <mxPoint x="147.5" y="32" as="targetPoint"/>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Text name="&amp;larr; This is a Link" LabelPosition="Middle" id="13">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="511.25" y="247" width="210" height="30" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="It allows the equation for &lt;i&gt;Births&lt;/i&gt; to reference the &lt;i&gt;Rabbit Birth Rate&lt;/i&gt;." LabelPosition="Middle" id="14">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;align=center;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="516.25" y="271.5" width="210" height="70" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Here is a simple model to get you started. It simulates a rabbit population over the course of 20 years. Luckily for these rabbits, there is no rabbit mortality! &#xa;&#xa;Click the &lt;i&gt;Run Simulation&lt;/i&gt; button on the right of the toolbar to see how the rabbit population will grow over time." LabelPosition="Middle" id="15">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Times New Roman;fontSize=18;strokeColor=none;fontColor=#333300;align=left;fillColor=none;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="15" y="12.75" width="405" height="150" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name=" Move your mouse over it and click the &quot;=&quot; to inspect its value.&#xa;&amp;darr;" LabelPosition="Middle" id="18">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="492.5" y="92" width="257.5" height="60" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="&lt;b&gt;Adding Primitives:&lt;/b&gt; Select type in toolbar and then click in the canvas.&#xa;&lt;b&gt;Adding Connections:&lt;/b&gt; Select type in toolbar, hover mouse over connectable primitive and drag arrow." LabelPosition="Middle" id="21">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#808080;align=center;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="5" y="480" width="745" height="70" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Link name="Link" Note="" BiDirectional="false" id="22">\n      <mxCell style="entity" parent="1" source="4" target="5" edge="1">\n        <mxGeometry width="100" height="100" as="geometry">\n          <mxPoint y="100" as="sourcePoint"/>\n          <mxPoint x="100" as="targetPoint"/>\n          <Array as="points">\n            <mxPoint x="380" y="420"/>\n            <mxPoint x="360" y="380"/>\n            <mxPoint x="360" y="340"/>\n            <mxPoint x="380" y="310"/>\n            <mxPoint x="407" y="292"/>\n            <mxPoint x="440" y="290"/>\n          </Array>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Button name="Clear Sample Model" Note="" Function="clearModel()" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="23">\n      <mxCell style="button;fontSize=20;fillColor=#FFFF99;strokeColor=#FF9900;fontColor=#0000FF;fontStyle=5" parent="1" vertex="1">\n        <mxGeometry x="80" y="418.5" width="240" height="60" as="geometry"/>\n      </mxCell>\n    </Button>\n  </root>\n</mxGraphModel>\n';var analysisCount=0;function getGraphXml(a){a=(new mxCodec(mxUtils.createXmlDocument())).encode(a.getModel());return mxUtils.getPrettyXml(a)}
function sendGraphtoServer(a){Ext.Ajax.request({url:builder_path+"/save.php",method:"POST",params:{data:getGraphXml(a),nid:drupal_node_ID,title:graph_title,description:graph_description,tags:graph_tags},success:function(a){parseInt(a.responseText)!=a.responseText?console.log("Insight Save Issue:\n\n"+a.responseText):(drupal_node_ID=a.responseText,setSaveEnabled(!1),updateWindowTitle(),setTopLinks())},failure:function(a){console.log("Insight Not Saved:\n\n"+a.responseText)}})}
function validPrimitiveName(a,b){if("Stock"==b.value.nodeName||"Variable"==b.value.nodeName||"Converter"==b.value.nodeName||"Flow"==b.value.nodeName||"Display"==b.value.nodeName||"Agents"==b.value.nodeName||"Transition"==b.value.nodeName||"State"==b.value.nodeName){if(0<a.length&&!/[\[\]\(\)\{\}\<\>\'\"]/.test(a))return!0;mxUtils.alert(getText("Primitive names cannot contain brackets, parenthesis, or quotes."));return!1}return!0}
function isPrimitive(a){return!("Button"==a.value.nodeName||"Picture"==a.value.nodeName||"Text"==a.value.nodeName)}function cellsContainNodename(a,b){for(var c=0;c<a.length;c++)if(a[c].value.nodeName==b)return!0}
function nodeInsertSelected(){var a=ribbonPanelItems().getComponent("valued");return a.getComponent("stock").pressed||a.getComponent("variable").pressed||a.getComponent("text").pressed||a.getComponent("converter").pressed||a.getComponent("picture").pressed||a.getComponent("buttonBut").pressed}function connectionType(){return ribbonPanelItems().getComponent("connect").getComponent("link").pressed?"Link":ribbonPanelItems().getComponent("connect").getComponent("flow").pressed?"Flow":"None"}
function setAllConnectable(){graph.setConnectable(!0);for(var a=primitives(),b=0;b<a.length;b++)a[b].setConnectable(!0)}var primitiveCache={};function primitives(a){if(primitiveCache[" "+a])return primitiveCache[" "+a];var b=childrenCells(graph.getModel().getChildren(graph.getModel().getRoot())[0]);if(null==a)primitiveCache[" "+a]=b;else{for(var c=[],d=0;d<b.length;d++)b[d].value.nodeName==a&&c.push(b[d]);primitiveCache[" "+a]=c}return primitiveCache[" "+a]}
function childrenCells(a){a=graph.getModel().getChildren(a);if(null!=a){for(var b=[],c=0;c<a.length;c++)"Folder"==a[c].value.nodeName&&(b=b.concat(childrenCells(a[c])));a=a.concat(b);for(c=a.length-1;0<=c;c--)(null==a[c]||null==a[c].value)&&a.splice(c,1);return a}return null}var neighborhoodCache={};function clearPrimitiveCache(){primitiveCache={};neighborhoodCache={}}
function neighborhood(a){function b(a,b){var c=[];if("Agents"==orig(a).value.nodeName&&orig(a).getAttribute("Agent")){var d=orig(a).getAttribute("Agent");d&&getChildren(findID(d)).forEach(function(a){isValued(a)&&"Ghost"!=a.value.nodeName&&c.push({item:a,type:"agent",linkHidden:b,name:a.getAttribute("name")})})}return c.sort(function(a,b){return a.name==b.name?0:a.name>b.name?1:-1})}var c=inAgent(a);if(neighborhoodCache[a.id])return neighborhoodCache[a.id];var d=[],e=primitives();if(null!=e)if(null!=
a){var f=[],g=[];a.isEdge()&&(null!==orig(a.source)&&d.push({item:orig(a.source),type:"direct"}),null!==orig(a.target)&&d.push({item:orig(a.target),type:"direct"}));"Agents"==a.value.nodeName&&a.getAttribute("Agent")&&(d=d.concat(b(a)));for(var h=0;h<e.length;h++)"Flow"==e[h].value.nodeName?f.push(orig(e[h])):"Link"==e[h].value.nodeName&&g.push(orig(e[h]));for(h=0;h<f.length;h++)f[h].source==a&&d.push({item:f[h],type:"direct"}),f[h].target==a&&d.push({item:f[h],type:"direct"});for(h=0;h<g.length;h++)if(g[h].source==
a&&isDefined(g[h].target)&&null!==g[h].target&&(e=!isTrue(g[h].getAttribute("BiDirectional")),d.push({item:orig(g[h].target),type:"direct",linkHidden:e}),d=d.concat(b(g[h].target,e))),g[h].target==a&&isDefined(g[h].source)&&null!==g[h].source&&(!inAgent(orig(g[h].source))||c))d.push({item:orig(g[h].source),type:"direct"}),d=d.concat(b(g[h].source))}else for(h=0;h<e.length;h++)isValued(e[h])&&d.push({item:orig(e[h]),type:"direct"});d=Ext.Array.clean(d);c=[];for(h=0;h<d.length;h++){g=!1;for(e=0;e<c.length;e++)if(c[e].type==
d[h].type&&c[e].item.id==d[h].item.id){g=!0;break}g||(isValued(d[h].item)||"Agents"==d[h].item.value.nodeName)&&c.push(d[h])}return neighborhoodCache[a.id]=c}function doubleArray(a){for(var b=[],c=0;c<a.length;c++)b.push([a[c],a[c]]);return b}
function isValued(a){return isUndefined(a)||null==a||isUndefined(orig(a))?!1:"Converter"==orig(a).value.nodeName||"Flow"==orig(a).value.nodeName||"Stock"==orig(a).value.nodeName||"Variable"==orig(a).value.nodeName||"Transition"==orig(a).value.nodeName||"State"==orig(a).value.nodeName}
function setSaveEnabled(a){if(is_editor&&!is_embed){var b=ribbonPanelItems().getComponent("savegroup").getComponent("savebut");a&&!1==unfoldingManager.unfolding?(b.setDisabled(!1),b.setText("Save Insight")):(b.setDisabled(!0),b.setText("Insight Saved"))}}function updateWindowTitle(){is_embed||(document.title=""==graph_title?"Untitled Insight | Insight Maker":graph_title+" | Insight Maker")}function hasDisplay(){var a=primitives();return cellsContainNodename(a,"Display")}
function setPicture(a){var b=a.getStyle();"None"==a.getAttribute("Image")||""==a.getAttribute("Image")||" "==a.getAttribute("Image")||"null"==a.getAttribute("Image")||"Folder"==a.value.nodeName&&!a.isCollapsed()?(b=mxUtils.setStyle(b,"image","None"),b="Display"==a.value.nodeName||"Stock"==a.value.nodeName||"Folder"==a.value.nodeName?mxUtils.setStyle(b,"shape","rectangle"):"Button"==a.value.nodeName?mxUtils.setStyle(b,"shape","rectangle"):mxUtils.setStyle(b,"shape","ellipse")):(b="http"==a.getAttribute("Image").substring(0,
4).toLowerCase()?mxUtils.setStyle(b,"image",a.getAttribute("Image")):mxUtils.setStyle(b,"image",builder_path+"/images/SD/"+a.getAttribute("Image")+".png"),b=isTrue(a.getAttribute("FlipVertical"))?mxUtils.setStyle(b,"imageFlipV",1):mxUtils.setStyle(b,"imageFlipV",0),b=isTrue(a.getAttribute("FlipHorizontal"))?mxUtils.setStyle(b,"imageFlipH",1):mxUtils.setStyle(b,"imageFlipH",0),b=mxUtils.setStyle(b,"shape","image"));b=new mxStyleChange(graph.getModel(),a,b);graph.getModel().execute(b);propogateGhosts(a)}
function setLabelPosition(a){var b=a.getAttribute("LabelPosition"),c=a.getStyle();"Folder"==a.value.nodeName&&!a.isCollapsed()?(c=mxUtils.setStyle(c,"labelPosition",null),c=mxUtils.setStyle(c,"align",null),c=mxUtils.setStyle(c,"verticalLabelPosition",null),c=mxUtils.setStyle(c,"verticalAlign",null)):"Top"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","top"),c=mxUtils.setStyle(c,"verticalAlign","bottom")):"Bottom"==
b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","bottom"),c=mxUtils.setStyle(c,"verticalAlign","top")):"Middle"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle")):"Left"==b?(c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle"),
c=mxUtils.setStyle(c,"labelPosition","left"),c=mxUtils.setStyle(c,"align","right")):"Right"==b&&(c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle"),c=mxUtils.setStyle(c,"labelPosition","right"),c=mxUtils.setStyle(c,"align","left"));b=new mxStyleChange(graph.getModel(),a,c);graph.getModel().execute(b);propogateGhosts(a)}
function removeAgent(a){for(var b=primitives("Agents"),c=0;c<b.length;c++)b[c].getAttribute("Agent")==a.id&&b[c].setAttribute("Agent","")}
function deletePrimitive(a){var b=primitives(),c=getSetting();if(c.getAttribute("SensitivityPrimitives")){var d=c.getAttribute("SensitivityPrimitives").split(","),e=Ext.Array.indexOf(d,a.id);-1<e&&(d.splice(e,1),c.setAttribute("SensitivityPrimitives",d.join(",")))}"Folder"==a.value.nodeName&&"Agent"==a.getAttribute("Type")&&removeAgent(a);for(c=0;c<b.length;c++)"Display"==b[c].value.nodeName?b[c].getAttribute("Primitives")&&(d=b[c].getAttribute("Primitives").split(","),e=Ext.Array.indexOf(d,a.id),
-1<e&&(d.splice(e,1),b[c].setAttribute("Primitives",d.join(",")))):"Converter"==b[c].value.nodeName?b[c].getAttribute("Source")==a.id?b[c].setAttribute("Source","Time"):"Link"==a.value.nodeName&&testConverterSource(b[c]):"Ghost"==b[c].value.nodeName&&b[c].value.getAttribute("Source")==a.id&&(d=b[c],deletePrimitive(d),graph.removeCells([d],!1))}
function linkBroken(a){for(var b=primitives(),c=0;c<b.length;c++)"Converter"==b[c].value.nodeName&&testConverterSource(b[c]);null!==a.getTerminal(!1)&&"Converter"==a.getTerminal(!1).value.nodeName&&"undefined"!=typeof a.getTerminal(!0)&&isValued(a.getTerminal(!0))&&a.getTerminal(!1).setAttribute("Source",orig(a.getTerminal(!0)).id)}
function testConverterSource(a){for(var b=neighborhood(a),c=!1,d=0;d<b.length;d++)b[d].linkHidden||a.getAttribute("Source")==b[d].item.id&&(c=!0);c||a.setAttribute("Source","Time")}function downloadModel(){var a=getGraphXml(graph);surpressCloseWarning=!0;document.getElementById("downloader").title.value=encodeURIComponent(graph_title);document.getElementById("downloader").code.value=encodeURIComponent(a);document.getElementById("downloader").submit()}
function getSetting(){for(var a=primitives(),b=0;b<a.length;b++)if("Setting"==a[b].value.nodeName)return a[b];alert("Settings primitive could not be found.");return null}function handelCursors(){graph.container.style.cursor=!1==nodeInsertSelected()?"auto":"crosshair"}var propertiesWin;
function updateProperties(){var a;a=""==graph_title?"Untitled Insight":graph_title;propertiesWin?""!=graph_title&&(Ext.getCmp("sinsightTitle").setValue(graph_title),Ext.getCmp("sinsightTags").setValue(graph_tags),Ext.getCmp("sinsightDescription").setValue(graph_description)):propertiesWin=new Ext.Window({applyTo:"property-win",layout:{type:"vbox",align:"stretch"},modal:!0,width:500,title:"Save Insight",height:350,closable:!1,resizable:!0,closeAction:"hide",defaults:{width:230,labelWidth:150},items:[new Ext.form.TextField({fieldLabel:"Insight Title",
name:"sinsightTitle",id:"sinsightTitle",allowBlank:!1,selectOnFocus:!0,value:a,margin:2}),new Ext.form.TextField({fieldLabel:"Tags",name:"sinsightTags",id:"sinsightTags",allowBlank:!0,emptyText:"Environment, Unintended Consequences",value:graph_tags,margin:2}),new Ext.form.field.HtmlEditor({enableColors:!1,enableSourceEdit:!1,enableFont:!1,enableLists:!0,enableFontSize:!1,fieldLabel:"Description",name:"sinsightDescription",id:"sinsightDescription",allowBlank:!0,emptyText:"Enter a brief description of the Insight.",
value:graph_description,margin:2,flex:1})],buttons:[{text:"Cancel",scale:"large",iconCls:"cancel-icon",handler:function(){propertiesWin.hide()}},{iconCls:"apply-icon",scale:"large",text:"Save",handler:function(){if(Ext.getCmp("sinsightTitle").validate()){propertiesWin.hide();graph_title=Ext.String.trim(Ext.getCmp("sinsightTitle").getValue());graph_description=Ext.String.trim(Ext.getCmp("sinsightDescription").getValue());graph_description=graph_description.replace(/^(\u200b|&nbsp;)/g,"");graph_description=
graph_description.replace(/(\u200b|&nbsp;)$/g,"");if("<br>"==graph_description||"<br/>"==graph_description||"\u200b"==graph_description||"&nbsp;"==graph_description)graph_description="";graph_tags=Ext.getCmp("sinsightTags").getValue();setSaveEnabled(!0);sendGraphtoServer(graph);selectionChanged(!1)}else mxUtils.alert("You must specify a name for the Insight.")}}]});propertiesWin.show();Ext.getCmp("sinsightTitle").focus(!0,300)}
function isTrue(a){return"false"!=a&&"No"!=a&&0!=a&&(1==a||-1==a||"True"==a||"true"==a||!0==a||"Yes"==a)}function customUnits(){if("undefined"!=typeof getSetting().getAttribute("Units")){for(var a=getSetting().getAttribute("Units").split("\n"),b=0;b<a.length;b++)a[b]=a[b].split("<>");return a}return[]}function sliderPrimitives(){for(var a=primitives(),b=[],c=0;c<a.length;c++)isTrue(a[c].getAttribute("ShowSlider"))&&b.push(a[c]);return b}
function orig(a){return isUndefined(a)||null==a?null:"Ghost"==a.value.nodeName?graph.getModel().getCell(a.value.getAttribute("Source")):a}function currentStyleIs(a){for(var b=graph.getCellStyle(graph.getSelectionCell())[mxConstants.STYLE_FONTSTYLE],c=3;1<=c;c--)b-=a*Math.pow(2,c),0>b&&(b+=a*Math.pow(2,c));return b>=a}
function setStyles(){if(!is_embed&&is_editor)if(graph.isSelectionEmpty())ribbonPanelItems().getComponent("style").getComponent("bold").toggle(!1),ribbonPanelItems().getComponent("style").getComponent("italic").toggle(!1),ribbonPanelItems().getComponent("style").getComponent("underline").toggle(!1),sizeCombo.setValue(""),fontCombo.setValue("");else{ribbonPanelItems().getComponent("style").getComponent("bold").toggle(currentStyleIs(mxConstants.FONT_BOLD));ribbonPanelItems().getComponent("style").getComponent("italic").toggle(currentStyleIs(mxConstants.FONT_ITALIC));
ribbonPanelItems().getComponent("style").getComponent("underline").toggle(currentStyleIs(mxConstants.FONT_UNDERLINE));var a=graph.getCellStyle(graph.getSelectionCell());sizeCombo.setValue(a[mxConstants.STYLE_FONTSIZE]);fontCombo.setValue(a[mxConstants.STYLE_FONTFAMILY])}}function quickLabel(a,b,c){var d=getSetting();return processLabel(a,b,c,d.getAttribute("TimeUnits"),d.getAttribute("TimeStep"),d.getAttribute("SolutionAlgorithm"))}
function processLabel(a,b,c,d,e,f){a=replaceAll(a,"%%","<PERCENTSIGNPLACEHOLDER>");a=replaceAll(a,"%u",d);a=replaceAll(a,"%t",b);a=replaceAll(a,"%o",c);a=replaceAll(a,"%ts",e);a=replaceAll(a,"%a",f);a=replaceAll(a,"<PERCENTSIGNPLACEHOLDER>","%");return clean(a)}function replaceAll(a,b,c){return isUndefined(a)?"":a.replace(RegExp(b,"g"),c)}
function loadBackgroundColor(){mxPanel.body.dom.style["background-color"]=getSetting().getAttribute("BackgroundColor");mxPanel.body.dom.style.backgroundColor=getSetting().getAttribute("BackgroundColor")}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}function isTouch(){return mxClient.IS_TOUCH}
function propogateGhosts(a){for(var b=primitives("Ghost"),c=0;c<b.length;c++)if(b[c].getAttribute("Source")==a.id){var d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",30);b[c].setStyle(d);d=new mxCellAttributeChange(b[c],"name",a.getAttribute("name"));graph.getModel().execute(d)}}function map(a,b){return a instanceof Array?Ext.Array.map(a,b):b(a)}
function unitsUsedInModel(){for(var a=primitives(),b=[],c=0;c<a.length;c++){var d=a[c].getAttribute("Units");"Setting"!=a[c].value.nodeName&&isDefined(d)&&null!==d&&"Unitless"!=d&&b.push(d)}return Ext.Array.unique(b)}function changeNodeName(a,b){for(var c=mxUtils.createXmlDocument().createElement(b),d=a.attributes,e=0;e<d.length;e++)c.setAttribute(d[e].name,d[e].value);return c}
function cmd(a){return mxClient.IS_MAC?"<span style='color:grey'>(&#8984;"+a+")</span>":"<span style='color:grey'>(Ctrl-"+a+")</span>"}function inAgent(a){return!a||null==a?!1:(a=getParent(a))&&"Agent"==a.getAttribute("Type")?!0:inAgent(a)}
function isGray(a){if(isUndefined(a))return!0;a="#"==a[0]?a:colourNameToHex(a);if("#6482B9"==a)return!0;var b=a[1];if(4==a.length)for(var c=2;c<a.length;c++){if(a[c]!=b)return!1}else if(7==a.length){for(c=1;c<a.length;c+=2)if(a[c]!=b)return!1;b=a[2];for(c=2;c<a.length;c+=2)if(a[c]!=b)return!1}return!0}
function colourNameToHex(a){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",
darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",
goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",
lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",
olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return"undefined"!=typeof b[a.toLowerCase()]?b[a.toLowerCase()]:!1};var macrosWin,scratchPadStatus="";function ribbonPanelItems(){return ribbonPanel.getDockedItems()[0]}
var showMacros=function(){isUndefined(macrosWin)&&(macrosWin=new Ext.Window({layout:"fit",modal:!0,autoScroll:!0,width:440,title:getText("Insight Macros"),height:360,resizable:!1,closeAction:"close",plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:100},frame:!0,autoScroll:!0,bodyStyle:"padding:5px 5px 0",defaults:{width:405},items:[{xtype:"textareafield",fieldLabel:getText("Macros"),id:"macroTxt",name:"macroTxt",height:210},{xtype:"displayfield",labelAlign:"center",fieldLabel:getText("Example Macros"),
value:"g <- {9.80665 meters/seconds^2}<br/>TemperatureFtoC(f) <- (f+32)*5/9"}]})],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){macrosWin.hide()}},{iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){graph.getModel().beginUpdate();var a=new mxCellAttributeChange(getSetting(),"Macros",Ext.getCmp("macroTxt").getValue());graph.getModel().execute(a);graph.getModel().endUpdate();macrosWin.hide()}}]}));Ext.getCmp("macroTxt").setValue(getSetting().getAttribute("Macros"));
macrosWin.show()},scratchpadFn=function(){"shown"==scratchPadStatus?(Ext.get("mainGraph").setDisplayed("none"),scratchPadStatus="hidden"):("hidden"==scratchPadStatus?Ext.get("mainGraph").setDisplayed("block"):(Ext.get("mainGraph").setDisplayed("block"),Scratchpad($("#mainGraph"))),scratchPadStatus="shown")},config_columns;config_columns=!is_editor||is_embed?1:3;
var sizeCombo,fontCombo,RibbonPanel=function(a,b,c){Ext.Ajax.timeout=6E4;var d=function(a,b){var c=ribbonPanelItems();"flow"==a.id&&b?c.getComponent("connect").getComponent("link").toggle(!1):"link"==a.id&&b&&c.getComponent("connect").getComponent("flow").toggle(!1);"stock"==a.id&&b?(c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),
c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"variable"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"text"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),
c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"converter"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):
"picture"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"buttonBut"==a.id&&b&&(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),
c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1));handelCursors()},e="000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,969696,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,6482B9,993366,C0C0C0,FF99CC,FDCDAC,FFFF99,B3E2CD,CCFFFF,A6D3F8,CC99FF,FFFFFF".split(","),f=Ext.create("Ext.menu.ColorPicker",{colors:e,allowReselect:!0,handler:function(b,
c){if("string"==typeof c){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"));for(var d=a.getSelectionCells(),e=[],f=0;f<d.length;f++)("Link"==d[f].value.nodeName||"Flow"==d[f].value.nodeName)&&e.push(d[f]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#"+c,e,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&(a.getModel().execute(new mxCellAttributeChange(getSetting(),"BackgroundColor","#"+c)),loadBackgroundColor());
a.getModel().endUpdate()}}});f.add("-");f.add({text:"Transparent",handler:function(){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,mxConstants.NONE,excludeType(a.getSelectionCells(),"Ghost"));for(var b=a.getSelectionCells(),c=[],d=0;d<b.length;d++)("Link"==b[d].value.nodeName||"Flow"==b[d].value.nodeName)&&c.push(b[d]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,mxConstants.NONE,c,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&(a.getModel().execute(new mxCellAttributeChange(getSetting(),
"BackgroundColor","white")),loadBackgroundColor());a.getModel().endUpdate()}});var g=new Ext.menu.ColorPicker({colors:e,allowReselect:!0,handler:function(b,c){"string"==typeof c&&a.setCellStyles(mxConstants.STYLE_FONTCOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"))}}),e=new Ext.menu.ColorPicker({colors:e,allowReselect:!0,handler:function(b,c){"string"==typeof c&&a.setCellStyles(mxConstants.STYLE_STROKECOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"))}});e.add("-");e.add({text:"Transparent",
handler:function(){a.setCellStyles(mxConstants.STYLE_STROKECOLOR,mxConstants.NONE,excludeType(a.getSelectionCells(),"Ghost"))}});var h=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"label"},{type:"string",name:"font"}],data:[{label:"Comic",font:"Comic Sans MS"},{label:"Helvetica",font:"Helvetica"},{label:"Verdana",font:"Verdana"},{label:"Times New Roman",font:"Times New Roman"},{label:"Garamond",font:"Garamond"},{label:"Courier New",font:"Courier New"}]});fontCombo=new Ext.form.ComboBox({store:h,
displayField:"label",valueField:"font",queryMode:"local",width:120,colspan:3,triggerAction:"all",emptyText:getText("Select a font..."),selectOnFocus:!0,listeners:{select:function(b,c){null!=c&&a.setCellStyles(mxConstants.STYLE_FONTFAMILY,b.getValue(),excludeType(a.getSelectionCells(),"Ghost"))}}});fontCombo.on("specialkey",function(b,c){if(10==c.keyCode||13==c.keyCode){var d=b.getValue();null!=d&&0<d.length&&(a.setCellStyles(mxConstants.STYLE_FONTFAMILY,d,excludeType(a.getSelectionCells(),"Ghost")),
this.setValue(d))}});h=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"label"},{type:"float",name:"size"}],data:[{label:"6pt",size:6},{label:"8pt",size:8},{label:"9pt",size:9},{label:"10pt",size:10},{label:"12pt",size:12},{label:"14pt",size:14},{label:"18pt",size:18},{label:"24pt",size:24},{label:"30pt",size:30},{label:"36pt",size:36},{label:"48pt",size:48},{label:"60pt",size:60}]});sizeCombo=new Ext.form.ComboBox({colspan:2,store:h,displayField:"label",valueField:"size",queryMode:"local",
width:50,triggerAction:"all",emptyText:"",selectOnFocus:!0,listeners:{select:function(b,c){null!=c&&a.setCellStyles(mxConstants.STYLE_FONTSIZE,b.getValue(),excludeType(a.getSelectionCells(),"Ghost"))}}});sizeCombo.on("specialkey",function(b,c){if(10==c.keyCode||13==c.keyCode){var d=parseInt(b.getValue());!isNaN(d)&&0<d&&(this.setValue(d),a.setCellStyles(mxConstants.STYLE_FONTSIZE,d,excludeType(a.getSelectionCells(),"Ghost")))}});h={items:[{text:"400%",scope:this,handler:function(){a.getView().setScale(4)}},
{text:"200%",scope:this,handler:function(){a.getView().setScale(2)}},{text:"150%",scope:this,handler:function(){a.getView().setScale(1.5)}},{text:"100%",scope:this,handler:function(){a.getView().setScale(1)}},{text:"75%",scope:this,handler:function(){a.getView().setScale(0.75)}},{text:"50%",scope:this,handler:function(){a.getView().setScale(0.5)}},{text:"25%",scope:this,handler:function(){a.getView().setScale(0.25)}},"-",{text:"Zoom In",iconCls:"zoomin-icon",scope:this,handler:function(){a.zoomIn()}},
{text:"Zoom Out",iconCls:"zoomout-icon",scope:this,handler:function(){a.zoomOut()}},"-",{text:"Actual Size",iconCls:"zoomactual-icon",scope:this,handler:function(){a.zoomActual()}},{text:"Fit Window",iconCls:"fit-icon",scope:this,handler:function(){a.fit()}}]};!is_embed&&is_editor&&h.items.push("-",{text:getText("Organic Layout"),scope:this,handler:function(){layoutModel("organic")}},{text:getText("Circle Layout"),scope:this,handler:function(){layoutModel("circular")}});return{id:"ribbonPanel",xtype:"panel",
layout:"border",region:"center",split:!0,border:!1,items:[b,c],collapsible:!1,tbar:new Ext.toolbar.Toolbar({enableOverflow:!0,items:[{hidden:!is_editor||is_embed,xtype:"buttongroup",columns:4,height:95,title:getText("Primitives"),id:"valued",items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"stock",text:getText("Stock"),iconCls:"stock-icon",tooltip:getText("Create a new Stock by clicking on the canvas"),enableToggle:!0,toggleHandler:d,pressed:!1,scope:this},{iconAlign:"top",
scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"variable",text:getText("Variable"),iconCls:"parameter-icon",tooltip:getText("Create a new Variable by clicking on the canvas"),enableToggle:!0,toggleHandler:d,pressed:!1,scope:this},{id:"converter",text:getText("Converter"),iconCls:"converter-icon",tooltip:getText("Create a new Converter by clicking on the canvas"),enableToggle:!0,toggleHandler:d,pressed:!1,scope:this},{id:"text",text:getText("Text"),iconCls:"font-icon",tooltip:getText("Create a new Text Area by clicking on the canvas"),
enableToggle:!0,toggleHandler:d,pressed:!1,scope:this},{id:"ghostBut",text:getText("Ghost"),iconCls:"ghost-icon",tooltip:getText("Create a linked clone of the selected primitive which can help you organize your model"),scope:this,handler:makeGhost},{id:"picture",text:getText("Picture"),iconCls:"picture-icon",tooltip:getText("Create a new Picture by clicking on the canvas"),enableToggle:!0,toggleHandler:d,pressed:!1,scope:this},{id:"folder",text:getText("Folder"),iconCls:"folder-icon",tooltip:getText("Creates a new Folder containing the selected primitives"),
scope:this,handler:makeFolder},{id:"buttonBut",text:getText("Button"),iconCls:"button-icon",tooltip:getText("Creates a new Button with interactivity"),scope:this,enableToggle:!0,toggleHandler:d,pressed:!1}]},{hidden:!is_editor||is_embed,xtype:"buttongroup",columns:1,height:95,title:getText("Connections"),id:"connect",items:[{id:"link",text:getText("Link"),iconCls:"link-small-icon",tooltip:getText("Use Links to connect primitives"),enableToggle:!0,toggleHandler:d,pressed:!1,scope:this},{id:"flow",
text:getText("Flow"),iconCls:"flow-small-icon",tooltip:getText("Use Flows to connect primitives"),enableToggle:!0,toggleHandler:d,pressed:-1==drupal_node_ID,scope:this},{id:"reverse",text:getText("Reverse"),iconCls:"reverse-icon",tooltip:getText("Reverse connection direction"),handler:function(){a.getModel().beginUpdate();var b=a.getSelectionCells();if(null!=b)for(var c=0;c<b.length;c++)if(b[c].isEdge()){var d=b[c].getGeometry(),e=b[c].source,f=new mxTerminalChange(a.getModel(),b[c],b[c].target,!0);
a.getModel().execute(f);f=new mxTerminalChange(a.getModel(),b[c],e,!1);a.getModel().execute(f);e=d.sourcePoint;d.sourcePoint=d.targetPoint;d.targetPoint=e;null!=d.points&&d.points.reverse();f=new mxGeometryChange(a.getModel(),b[c],d);a.getModel().execute(f)}a.getModel().endUpdate()},scope:this}]},{hidden:!is_editor||is_embed,xtype:"buttongroup",columns:2,height:95,title:getText("Actions"),id:"actions",items:[{id:"undo",text:getText("Undo"),iconCls:"undo-icon",tooltip:getText("Undo change")+" "+cmd("Z"),
handler:function(){undoHistory.undo()},scope:this},{id:"redo",text:getText("Redo"),iconCls:"redo-icon",tooltip:getText("Redo change")+" "+cmd("Y"),handler:function(){undoHistory.redo()},scope:this},{id:"copy",text:getText("Copy"),iconCls:"copy-icon",tooltip:getText("Copy")+" "+cmd("C"),handler:function(){mxClipboard.copy(a);clipboardListener()},scope:this},{id:"cut",text:getText("Cut"),iconCls:"cut-icon",tooltip:getText("Cut")+" "+cmd("X"),handler:function(){mxClipboard.cut(a);clipboardListener()},
scope:this},{text:getText("Paste"),iconCls:"paste-icon",tooltip:getText("Paste")+" "+cmd("V"),id:"paste",handler:function(){mxClipboard.paste(a);clipboardListener()},scope:this},{id:"delete",text:getText("Delete"),iconCls:"delete-icon",tooltip:getText("Delete primitive"),handler:function(){a.removeCells(a.getSelectionCells(),!1)},scope:this}]},{hidden:!is_editor||is_embed,xtype:"buttongroup",columns:5,height:95,title:getText("Styles"),id:"style",items:[fontCombo,sizeCombo,{id:"fontcolor",text:"",
tooltip:getText("Font Color"),iconCls:"fontcolor-icon",menu:g},{id:"linecolor",text:"",tooltip:getText("Line Color"),iconCls:"linecolor-icon",menu:e},{id:"fillcolor",text:"",colspan:1,tooltip:getText("Fill Color"),iconCls:"fillcolor-icon",menu:f},{id:"movemenu",text:"",tooltip:getText("Change Order"),iconCls:"back-icon",handler:function(){},menu:{id:"move-menu",cls:"move-menu",items:[{id:"moveback",text:getText("Move to Back"),iconCls:"back-icon",handler:function(){a.orderCells(!0)},scope:this},{id:"movefront",
text:getText("Move to Front"),iconCls:"front-icon",handler:function(){a.orderCells(!1)},scope:this}]}},{id:"picturemenu",text:"",tooltip:getText("Adjust Picture"),iconCls:"picture-icon",handler:function(){},menu:{id:"picture-menu",cls:"picture-menu",items:[{id:"fliphitem",text:getText("Flip Horizontal"),iconCls:"fliph-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("FlipHorizontal"))){var d=new mxCellAttributeChange(b[c],
"FlipHorizontal",!isTrue(b[c].getAttribute("FlipHorizontal")));a.getModel().execute(d);setPicture(b[c])}a.getModel().endUpdate()},scope:this},{id:"flipvitem",text:getText("Flip Vertical"),iconCls:"flipv-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("FlipVertical"))){var d=new mxCellAttributeChange(b[c],"FlipVertical",!isTrue(b[c].getAttribute("FlipVertical")));a.getModel().execute(d);setPicture(b[c])}a.getModel().endUpdate()},
scope:this}]}},{id:"bold",text:"",iconCls:"bold-icon",tooltip:getText("Bold")+" "+cmd("B"),handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{id:"italic",text:"",tooltip:getText("Italic")+" "+cmd("I"),iconCls:"italic-icon",handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{id:"underline",
text:"",enableToggle:!0,tooltip:getText("Underline")+" "+cmd("U"),iconCls:"underline-icon",handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{id:"align",text:"",iconCls:"left-icon",tooltip:getText("Label Position"),handler:function(){},menu:{id:"reading-menu",cls:"reading-menu",items:[{text:getText("Align Left"),checked:!1,group:"rp-group",scope:this,iconCls:"left-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,
mxConstants.ALIGN_LEFT,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Align Center"),checked:!0,group:"rp-group",scope:this,iconCls:"center-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Align Right"),checked:!1,group:"rp-group",scope:this,iconCls:"right-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT,excludeType(a.getSelectionCells(),"Ghost"))}},
"-",{text:getText("Position Middle"),checked:!0,group:"vrp-group",scope:this,iconCls:"middle-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Middle");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Top"),checked:!1,group:"vrp-group",scope:this,iconCls:"top-icon",handler:function(){var b=
excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Top");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Right"),checked:!1,group:"vrp-group",scope:this,iconCls:"right-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=
new mxCellAttributeChange(b[c],"LabelPosition","Right");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Bottom"),checked:!1,group:"vrp-group",scope:this,iconCls:"bottom-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Bottom");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},
{text:getText("Position Left"),checked:!1,group:"vrp-group",scope:this,iconCls:"left-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Left");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}}]}},{id:"zoomMenuButton",text:"",iconCls:"zoom-icon",handler:function(){},menu:h}]},{hidden:is_editor||is_embed,
id:"control-no-edit",xtype:"buttongroup",columns:2,height:95,title:"Explore",items:[{iconAlign:"top",id:"scratchpadLarge",text:getText("Scratchpad"),iconCls:"scratchpad-large-icon",tooltip:getText("Draw a sketch on your diagram")+" "+cmd("K"),enableToggle:!0,scale:"large",cls:"button",rowspan:3,handler:scratchpadFn,scope:this},{iconAlign:"top",scale:"large",cls:"button",rowspan:3,text:getText("Zoom"),iconCls:"zoom-large-icon",tooltip:getText("Zoom Diagram"),id:"zoomlargebutgrouped",handler:function(){},
menu:h}]},{hidden:is_embed||!is_editor,xtype:"buttongroup",columns:config_columns,height:95,title:"Tools",id:"configgroup",items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"config",text:getText("Time Settings"),iconCls:"clock-icon",tooltip:getText("Configure time start and stop")+" "+cmd("L"),handler:timeSettingsFn,scope:this},{hidden:!is_editor||is_embed,id:"scratchpad",text:getText("Scratchpad"),iconCls:"scratchpad-icon",tooltip:getText("Draw notes on your diagram")+" "+cmd("K"),
enableToggle:!0,handler:scratchpadFn,scope:this},{hidden:!is_editor||is_embed,id:"macroBut",text:getText("Macros"),iconCls:"download-icon",tooltip:getText("Edit macro functions and constants for use anywhere in your equations"),handler:showMacros,scope:this},{hidden:!is_editor||is_embed,id:"sensitivityBut",text:getText("Sensitivity"),iconCls:"sensitivity-icon",tooltip:getText("Sensitivity testing"),handler:doSensitivity,scope:this},{id:"embed_but",text:getText("Embed"),hidden:!is_editor||is_embed,
iconCls:"embed-icon",tooltip:getText("Embed this Insight in another web page"),handler:function(){-1==drupal_node_ID?Ext.MessageBox.show({title:getText("Save the Insight"),msg:getText("You must save this Insight before you can embed it."),buttons:Ext.MessageBox.OK,animEl:"mb9",icon:Ext.MessageBox.ERROR}):Ext.MessageBox.show({title:getText("Embed"),msg:getText("To embed this Insight in another webpage (such as a blog or a private site), copy and paste the following code into the source HTML code of your webpage: %s",
'<br/><br/><center><tt>&lt;IFRAME SRC="http://InsightMaker.com/insight/'+drupal_node_ID+'/embed?topBar=1&sideBar=1&zoom=1" TITLE="Embedded Insight" width=600 height=420&gt;&lt;/IFRAME&gt;</tt></center><br/>'),buttons:Ext.MessageBox.OK,animEl:"mb9",icon:Ext.MessageBox.INFO})},scope:this},{hidden:!is_editor||is_embed,id:"textBut",text:getText("Equations"),iconCls:"equations-icon",tooltip:getText("A listing of all equations in the Insight"),handler:textEquations,scope:this},{hidden:!is_editor||is_embed,
id:"optimizeBut",text:getText("Optimize"),iconCls:"optimize-icon",tooltip:getText("Optimize model parameters"),handler:doOptimizer,scope:this}]},{hidden:!is_embed,iconAlign:"top",id:"scratchpadLargeEmbed",text:getText("Scratchpad"),iconCls:"scratchpad-large-icon",tooltip:getText("Draw notes on your diagram")+" "+cmd("K"),enableToggle:!0,scale:"large",cls:"button",rowspan:3,handler:scratchpadFn,scope:this},{hidden:!is_embed,iconAlign:"top",scale:"large",cls:"button",rowspan:3,text:getText("Zoom"),
iconCls:"zoom-large-icon",tooltip:getText("Zoom Diagram"),id:"zoomlargebutEmbed",handler:function(){},menu:h},"-",{hidden:!is_editor||is_embed,id:"savegroup",xtype:"buttongroup",columns:1,height:95,width:90,title:"Save",items:[{hidden:!is_editor||is_embed,iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,text:getText("Save Insight"),iconCls:"save-icon",tooltip:getText("Save Insight")+" "+cmd("S"),id:"savebut",handler:function(){saveModel()},scope:this}]},{hidden:!is_embed,iconAlign:"top",
scale:"large",cls:"button",rowspan:3,id:"run_embed",text:getText("Run Simulation"),iconCls:"run-icon",tooltip:getText("Run")+" "+cmd("Enter"),handler:function(){runModel()},scope:this},{hidden:is_embed,xtype:"buttongroup",columns:1,title:getText("Simulate"),height:95,items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"run",text:"Run Simulation",iconCls:"run-icon",tooltip:getText("Run")+" "+cmd("Enter"),handler:function(){runModel()},scope:this}]},"->",{scale:"large",iconAlign:"top",
cls:"button",width:154,id:"logo",text:"",iconCls:"logo-icon",tooltip:"InsightMaker.com",handler:function(){showURL("http://InsightMaker.com")},scope:this}]})}};Ext.onReady(function(){Ext.getBody().createChild({tag:"style",type:"text/css",html:".x-item-disabled .x-grid-cell-inner {color: gray !important; font-style: italic !important}"})});var converterStore=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"myId"},{type:"string",name:"displayText"}],data:[]}),grid;function getRenderer(a){return"renderer"in a?a.renderer:"boolean"==typeof a.value?function(a){return isTrue(a)?"Yes":"No"}:!1}
function getEditor(a){if("editor"in a)return a.editor;a=a.value;return a instanceof Date?new Ext.form.DateField({selectOnFocus:!0}):"number"==typeof a?Ext.create("Ext.form.field.Number",{selectOnFocus:!0}):"boolean"==typeof a?new Ext.form.ComboBox({triggerAction:"all",store:[["false","No"],["true","Yes"]],selectOnFocus:!0,editable:!1}):new Ext.form.TextField({selectOnFocus:!0})}
function createGrid(a,b,c,d){for(var e=0;e<b.length;e++)configPanel.add(b[e]);if(0<a.length){for(var f=[],b=[],g=[],h=[],e=0;e<a.length;e++)f.push({id:a[e].name,name:a[e].name,text:a[e].text,value:a[e].value,group:a[e].group}),"boolean"==typeof f[e].value&&(f[e].value=isTrue(f[e].value).toString()),b[a[e].name]=a[e].text,g[a[e].name]=getEditor(a[e]),!1!=getRenderer(a[e])&&(h[a[e].name]=getRenderer(a[e]));a=Ext.create("Ext.data.Store",{fields:[{name:"name",type:"string"},{name:"text",type:"string"},
{name:"value",type:"string"},{name:"group",type:"string"}],data:f,groupers:[{property:"group"}]});handleGridEnables(a,d);e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}",collapse:Ext.emptyFn});grid=Ext.create("Ext.grid.property.Grid",{selectedPrimitive:d,store:a,hideHeaders:!0,border:!1,id:"propGrid",features:[e],propertyNames:b,customEditors:g,customRenderers:h,viewConfig:{getRowClass:function(a){return!0==a.data.disabled?"x-item-disabled":""}},listeners:is_editor?{}:{beforeedit:{fn:function(){return!1}}}});
configPanel.add(grid);grid.plugins[0].on("edit",function(a,b){if(is_editor){var c=b.record.get("name");b.record.commit();graph.getModel().beginUpdate();try{if("name"!=c||!isPrimitive(d)||validPrimitiveName(""+b.value,d)){var e=new mxCellAttributeChange(d,c,""+b.value);graph.getModel().execute(e);"name"==c&&propogateGhosts(d)}"Folder"==d.value.nodeName&&"Type"==c&&"None"==""+b.value&&removeAgent(d);"Stock"==d.value.nodeName&&"AllowNegatives"==c&&(e=new mxCellAttributeChange(d,"NonNegative",""+!isTrue(b.value)),
graph.getModel().execute(e));"Flow"==d.value.nodeName&&(isTrue(d.getAttribute("OnlyPositive"))?graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[d]):(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[d]),graph.setCellStyles("startFill",0,[d])));"Link"==d.value.nodeName&&(isTrue(d.getAttribute("BiDirectional"))?graph.setCellStyles(mxConstants.STYLE_STARTARROW,mxConstants.ARROW_CLASSIC,[d]):graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[d]));("Image"==c||"FlipHorizontal"==c||"FlipVertical"==
c)&&setPicture(d);"LabelPosition"==c&&setLabelPosition(d)}finally{graph.getModel().endUpdate()}handleGridEnables(null,d)}})}for(e=0;e<c.length;e++)configPanel.add(c[e])}
function handleGridEnables(a,b){var c;c=null!=a?a:grid.getStore();"Stock"==b.value.nodeName&&("Store"==b.getAttribute("StockMode")?getGridRecord(c,"Delay").set("disabled",!0):"Conveyor"==b.getAttribute("StockMode")&&getGridRecord(c,"Delay").set("disabled",!1));"Agents"==b.value.nodeName&&("Custom Function"==b.getAttribute("Placement")?getGridRecord(c,"PlacementFunction").set("disabled",!1):getGridRecord(c,"PlacementFunction").set("disabled",!0),"Custom Function"==b.getAttribute("Network")?getGridRecord(c,
"NetworkFunction").set("disabled",!1):getGridRecord(c,"NetworkFunction").set("disabled",!0));is_editor&&isValued(b)&&"State"!=b.value.nodeName&&"Action"!=b.value.nodeName&&(getGridRecord(c,"MaxConstraint").set("disabled",!isTrue(b.getAttribute("MaxConstraintUsed"))),getGridRecord(c,"MinConstraint").set("disabled",!isTrue(b.getAttribute("MinConstraintUsed"))),"Converter"!=b.value.nodeName&&(getGridRecord(c,"SliderMax").set("disabled",!isTrue(b.getAttribute("ShowSlider"))),getGridRecord(c,"SliderMin").set("disabled",
!isTrue(b.getAttribute("ShowSlider"))),getGridRecord(c,"SliderStep").set("disabled",!isTrue(b.getAttribute("ShowSlider")))))}var ConfigPanel=function(){var a=300;is_embed&&(a=210);return{id:"configPanel",region:"east",width:a,split:!0,autoScroll:!0,listeners:{beforeexpand:function(){setSelected([])}},collapsible:!0,title:getText("Configuration"),border:!0,layout:{type:"vbox",align:"stretch"}}};function getGridRecord(a,b){return a.getAt(a.findBy(function(a){return a.data.name==b}))};var codeEditor;Ext.form.customFields={code:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0}),converter:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0,stripCharsRe:/[^0-9\;\,\. \-]/g}),units:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0,stripCharsRe:/[^A-Za-z 0-9\.\/\(\)\*\^]/g}),richText:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0})};
Ext.form.customFields.code=Ext.extend(Ext.form.customFields.code,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.EquationWindow({parent:this,code:this.getValue(),cell:getSelected()[0]});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!/\\n/.test(a.getValue()))},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.EquationWindow=function(a){function b(a){var b="<b>"+a[1].replace(/\$\$/g,"").replace(/##/g,"").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</b><br/>"+a[2];a[3]&&(b+="<br/><br/><b>Example:</b><br/>&nbsp;&nbsp;",b="string"==typeof a[3]?b+a[3].replace(/\</g,"&lt;").replace(/\>/g,"&gt;"):b+a[3][0].replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+" <b>&rarr;</b> "+a[3][1].replace(/\</g,"&lt;").replace(/\>/g,"&gt;"));k.push(new Ext.Button({text:a[0],margin:2,tooltip:b,handler:function(){insertAtCursor(a[1].replace(/\$\$/g,
"").replace(/##/g,""))}}))}var c=this;c.args=a;for(var d=c.args.code.replace(/\\n/g,"\n"),e=c.args.cell,f=[],g=neighborhood(e),a=0;a<g.length;a++)if(!g[a].linkHidden){var h='<big><img width=16 height=16 src="'+builder_path+'/images/add.png"/> '+clean(g[a].item.getAttribute("name"))+"</big>";"agent"==g[a].type&&(h="<i class='gray'>&nbsp;&nbsp;"+h+"</i>");f.push({name:g[a].item.getAttribute("name"),item:h})}a=new Ext.data.Store({autoDestroy:!0,idIndex:0,fields:[{type:"string",name:"name"},{type:"string",
name:"item"}],data:f});f=new Ext.grid.Panel({store:a,region:"east",width:200,margin:"3 3 3 3",columns:[{header:"References",flex:1,dataIndex:"item",sortable:!1}]});codeEditor=new Ext.form.TextArea({id:"myCode",name:"myCode",enterIsSpecial:!0,value:d,fieldStyle:"font-size:large;",width:200,margin:"3 3 3 3",region:"center",listeners:{specialkey:function(a,b){b.getKey()==b.TAB&&insertAtCursor(String.fromCharCode("      "))}}});g=[["Mathematical",[["Round","Round(##Value$$)","Rounds a number to the nearest integer.",
["Round(3.6)","4"]],["Round Up","Ceiling(##Value$$)","Rounds a number up to the nearest integer.",["Ceiling(3.6)","4"]],["Round Down","Floor(##Value$$)","Rounds a number down to the nearest integer.",["Floor(3.6)","3"]],["Cos","Cos(##Angle$$)","Finds the cosine of an angle.",["Cos({180 Degrees})","-1"]],["ArcCos","ArcCos(##Value$$)","Finds the arc-cosine of a value. The result includes units.",["ArcCos(0)","{90 Degrees}"]],["Sin","Sin(##Angle$$)","Finds the sine of an angle.",["Sin({180 Degrees})",
"0"]],["ArcSin","ArcSin(##Value$$)","Finds the arc-sine of a value.  The result includes units.",["ArcSin(1)","{90 Degrees}"]],["Tan","Tan(##Angle$$)","Finds the tangent of an angle.",["Tan({Pi/4 Radians})","1"]],["ArcTan","ArcTan(##Value$$)","Finds the arc-tangent of a value. The result includes units.",["ArcTan(1)","{45 Degrees}"]],["Log","Log(##Value$$)","Returns the base-10 logarithm of a number.",["Log(1000)","3"]],["Ln","Ln(##Value$$)","Returns the natural logarithm of a number.",["Ln(e^2)",
"2"]],["Exp","Exp(##Value$$)","Returns e taken to a power.",["Exp(1)","e"]],["Sum","Sum(##Values$$)","Returns the sum of a vector or list of numbers.",["Sum(7, 5, 6)","28"]],["Product","Product(##Values$$)","Returns the product of a vector or list of numbers.",["Product(2, 4, -1)","-8"]],["Maximum","Max(##Values$$)","Returns the largest of a vector or list of numbers.",["Max(2, 4, -1)","4"]],["Minimum","Min(##Values$$)","Returns the smallest of a vector or list of numbers.",["Min(2, 4, -1, 3)","-1"]],
["Mean","Mean(##Values$$)","Returns the mean of a vector or list of numbers.",["Mean(2, 7, 3)","4"]],["Median","Median(##Values$$)","Returns the median of a vector or list of numbers.",["Median(2, 7, 3)","3"]],["Standard Deviation","StdDev(##Values$$)","Returns the standard deviation of a vector or list of numbers.",["StdDev(1, 2, 3)","1"]],["Absolute Value","Abs(##Value$$)","Returns the absolute value of a number.",["Abs(-23)","23"]],["Mod","##(Value One)$$ mod ##(Value Two)$$","Returns the remainder of the division of two numbers.",
["13 mod 5","3"]],["Square Root","Sqrt(##Value$$)","Returns the square root of a number.",["Sqrt(9)","3"]],["Pi","pi","The value 3.14159265."],["e","e","The value 2.71828183."],["Logit","Logit(##Value$$)","Returns the logit transformation of the value. Converts values on a 0 to 1 scale to a -Infinity to Infinity scale.",["Logit(0.5)","0"]],["Expit","Expit(##Value$$)","Returns the expit transformation of the value. Converts values on a -Infinity to Infinity scale to a 0 to 1 scale.",["Expit(0)","0.5"]]]],
["Time",[["Seconds","Seconds","The current time in seconds.",["Seconds*1000","The time in milliseconds"]],["Minutes","Minutes","The current time in minutes.",["Seconds = Minutes*60","True"]],["Hours","Hours","The current time in hours."],["Days","Days","The current time in days."],["Weeks","Weeks","The current time in weeks."],["Months","Months","The current time in weeks."],["Years","Years","The current time in years.","IfThenElse(Years > 10, 15, 0)"],["Current Time","Time","The current time including units.",
"IfThenElse(Time > {10 Years}, 15, 0)"],["Time Start","TimeStart","The simulation start time including units."],["Time Step","TimeStep","The simulation time step including units."],["Time Length","TimeLength","The total length of the simulation including units."],["Time End","TimeEnd","The time at which the simulation ends including units.",["TimeStart + TimeLength = TimeEnd","True"]]]],["Historical",[["Delay","Delay(##[Primitive]$$, ##Delay Length$$, ##Default Value$$)","Returns the value of a primitive (referenced with <...>) for a Delay Length of time ago. Default Value stands in for the primitive value in the case of negative times.",
"Delay([Income], {5 Years})"],["Delay1","Delay1(##[Primitive]$$, ##Delay Length$$, ##Initial Value$$)","Returns a smoothed, first-order exponential delay of the value of a primitive. Initial Value is optional.","Delay1([Income], 5, 10000)"],["Delay3","Delay3(##[Primitive]$$, ##Delay Length$$, ##Initial Value$$)","Returns a smoothed, third-order exponential delay of the value of a primitive. Initial Value is optional.","Delay3([Income], {20 Months}, 10000)"],["Smooth","Smooth(##[Primitive]$$, ##Length$$, ##Initial Value$$)",
"Returns a smoothing of a primitive's past values. Results in an averaged curve fit. Length affects the weight of past values. Initial Value is optional."],["PastValues","PastValues(##[Primitive]$$)","Returns the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the depth of the history.",["Sum(PastValues([Income]))","Total past income"]],["Maximum","PastMax(##[Primitive]$$)","Returns the maximum of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation.",
["PastMax([Income], {10 Years})","The maximum income in the past 10 years"]],["Minimum","PastMin(##[Primitive]$$)","Returns the minimum of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation.",["PastMin([Income], 10)","The minimum income in the past 10 units of time"]],["Median","PastMedian(##[Primitive]$$)","Returns the median of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],
["Mean","PastMean(##[Primitive]$$)","Returns the mean of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Standard Deviation","PastStdDev(##[Primitive]$$)","Returns the standard deviation of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Correlation","PastCorrelation(##[Primitive]$$, ##[Primitive]$$)",
"Returns the correlation between the values of that two primitives have taken on over the course of the simulation. The third optional argument is an optional time window to limit the calculation.",["PastCorrelation([Income], [Expenditures], {10 Years})","The correlation between income and expenditures over the past 10 years."]],["Fix","Fix(##Value$$, ##Period=-1$$)","Takes the dynamic value and forces it to be fixed over the course of the period. If period is -1, the value is held constant over the course of the whole simulation.",
["Fix(Rand, {5 Years})","Chooses a new random value every five years"]]]],["Random Numbers",[["Uniform Distribution","Rand(##Minimum$$, ##Maximum$$)","Generates a uniformly distributed random number between the minimum and maximum. The minimum and maximum are optional and default to 0 and 1 respectively.",["Rand","0.7481"]],["Normal Distribution","RandNormal(##Mean$$, ##Standard Deviation$$)","Generates a normally distributed random number with a mean and a standard deviation. The mean and standard deviation are optional and default to 0 and 1 respectively.",
["RandNormal(10, 1)","11.23"]],["Lognormal Distribution","RandLognormal(##Mean$$, ##Standard Deviation$$)","Generates a lognormally distributed random number with a mean and a standard deviation."],["Binary Distribution","RandBoolean(##Probability$$)","Returns 1 with the specified probability, otherwise 0. The probability is optional and defaults to 0.5.",["RandBoolean(0.1)","False"]],["Binomial Distribution","RandBinomial(##Count$$, ##Probability$$)","Generates a binomially distributed random number. The number of successes in Count random events each with Probability of success."],
["Negative Binomial","RandNegativeBinomial(##Successes$$, ##Probability$$)","Generates a negative binomially distributed random number. The number of random events each with Probability of success required to generate the specified Successes."],["Poisson Distribution","RandPoisson(##Lambda$$)","Generates a Poisson distributed random number."],["Triangular Distribution","RandTriangular(##Minimum$$, ##Maximum$$, ##Peak$$)","Generates a triangularly distributed random number."],["Exponential Distribution",
"RandExp(##Lambda$$)","Generates an exponentially distributed random number with the specified rate parameter."],["Gamma Distribution","RandGamma(##Alpha$$, ##Beta$$)","Generates a gamma distributed random number."]]],["Agents",[["Find All","FindAll(##[Agent Population]$$)","Returns a vector of all the agents in the agent population."],["Find State","FindState(##[Agent Population]$$, ##[State]$$)","Returns an agent population of agents in the specified state.",["FindState([University], [Smoker])",
"All smokers in the University population"]],["Find Not State","FindNotState(##[Agent Population]$$, ##[State]$$)","Returns a vector of agents not in the specified state.",["FindNotState([University], [Smoker])","All non-smokers in the University population"]],["Find Index","FindIndex(##[Agent Population]$$, ##Index$$)","Returns an agent with the specified index. Agent indexes start at 1.",["FindIndex([Population], 1)","The first agent created"]],["Find Nearby","FindNearby(##[Agent Population]$$, ##[Target]$$, ##Distance$$)",
"Returns a vector of agents that are within the specified distance of a target agent.",["FindNearby(FindState([Population], [Infected]), [Self], 25)","All infected people who are near the agent"]],["Find Nearest","FindNearest(##[Agent Population]$$, ##[Target]$$, ##Count=1$$)","Returns the nearest agents to the target agent. The number of agents returned is specified by the optional Count.",["FindNearest([Population], [Target])","The nearest agent to the target"]],["Find Furthest","FindFurthest(##[Agent Population]$$, ##[Target]$$, ##Count=1$$)",
"Returns the agent farthest from the target agent. The number of agents returned is specified by the optional Count.",["FindFurthest([Population], [Target], 4)","The four furthest agents from the target"]],["Value","Value(##[Agent Population]$$, ##[Primitive]$$)","Returns the values of the specified primitive for each agent in the population as a vector.",["Mean(Value([University], [GPA]))","The average GPA of all students in the University population"]],["Set Value","SetValue(##[Agent Population]$$, ##[Primitive]$$, ##Value$$)",
"Sets the value of the specified primitive for each agent in the population to the given value.",["SetValue([University], [Smoker], false)","Make all the smokers quit smoking"]],["Location","Location(##[Agent]$$)","Returns the location of an agent as the vector <<x, y>>.",["Select(Location([Self]), 1)","The x-coordinate of the agent"]],["Distance","Distance(##[Agent 1]$$, ##[Agent 2]$$)","Returns the distance between two agents."],["Move","Move(##[Agent]$$, ##<<x, y>>$$)","Moves an agent the amount specified.",
["Move([Self], <<Rand, Rand>>)","Take a random walk"]],["MoveTowards","MoveTowards(##[Agent]$$, ##[Target]$$, ##Distance$$)","Moves an agent towards a target agent the distance specified.",["MoveTowards([Self], [Prey], 10)","Chase after the prey"]],["Connected","Connected(##[Agent]$$)","Returns the agents connected in the network to an agent.",["Count(Connected([Self]))","The number of connections an agent has"]],["Connect","Connect(##[Agent 1]$$, ##[Agent 2]$$)","Connects two agents in the network. The second parameter can also be a vector of agents.",
["Connect([Self], FindNearest([Population], [Self]))","Connects an agent to the nearest agent to it in the population"]],["Unconnect","Unconnect(##[Agent 1]$$, ##[Agent 2]$$)","Unconnects two agents in the network. The second parameter can also be a vector of agents.",["Unconnect([Self], Connected([Self]))","Removes an agent's connections"]],["PopulationSize","PopulationSize(##[Agent Population]$$)","The total number of agents in a population."],["Add","Add(##[Agent Population]$$, ##[Base]=Initial Agent$$)",
"Adds a new agent to the population. If [Base] is set, the new agent will be a clone of [Base]. Otherwise the agent will be like a newly created agent at the start of the simulation.",["Repeat(Add([University]), 200)","Enroll 200 new students in the University"]],["Remove","Remove(##[Agent]$$)",'Removes an agent from the population. The agent will no longer be simulated. Can be used to "Kill" an agent.',["Map(FindState([University], [Smoker]), Remove(x))","Expel all the smokers from the University"]],
["Width","Width(##[Agent Population]$$)","The width of the agent population geographic region."],["Height","Height(##[Agent Population]$$)","The height of the agent population geographic region."]]],["Vectors",[["Count","Count(##Vector$$)","Counts the number of elements in a vector.",["Count(<<1, 1, 2, 3>>)","4"]],["Join","Join(##Item 1$$, ##Item 2$$, ##Item N$$)","Merges items together into a combined vector.",["Join(<<0>>, <<1, 1, 2>>)","<<0, 1, 1, 2>>"]],["Flatten","Flatten(##Vector$$)","Flattens a vector removing and expanding all nested vectors.",
["Flatten(<< <<0>>, <<1, 1, 2>> >>)","<<0, 1, 1, 2>>"]],["Unique","Unique(##Vector$$)","Returns a vector with duplicates removed.",["Unique(<<1, 1, 2, 3>>)","<<1, 2, 3>>"]],["Union","Union(##Vector 1$$, ##Vector 2$$)","Returns the combined elements of two vectors (with duplicates removed).",["Union(<<1, 2>>, <<2, 3>>)","<<1, 2, 3>>"]],["Intersection","Intersection(##Vector 1$$, ##Vector 2$$)","Returns the elements that exist in both vectors.",["Intersection(<<1, 2>>, <<2, 3>>)","<<2>>"]],["Difference",
"Difference(##Vector 1$$, ##Vector 2$$)","Returns the elements that exist in only one of the two vectors.",["Difference(<<1, 2>>, <<2, 3>>)","<<1, 3>>"]],["Sort","Sort(##Vector$$)","Sorts a vector from smallest value to largest value.",["Sort(<<1, 3, 2>>)","<<1, 2, 3>>"]],["Reverse","Reverse(##Vector$$)","Reverses the ordering of elements in a vector.",["Reverse(<<1, 2, 3>>)","<<3, 2, 1>>"]],["Select","Select(##Vector$$, ##Items$$)","Subsets a vector. Items can be a single index (starting with index 1) or a vector of true/false values of equal length to the Vector.",
["Select(<<1, 4, 9>>, 2)","4"]],["Sample","Sample(##Vector$$, ##Sample Size$$, ##Allow Repeats=False$$)","Takes a random sample from a vector. Allow Repeats specified if the same index can be sampled multiple time and is false by default.",["Sample(<<1, 4, 9>>, 2)","<<9, 1>>"]],["IndexOf","IndexOf(##Vector$$, ##Needle$$)","Returns the position of the needle within the vector (starting with index 1). If the needle is not found, 0 is returned.",["IndexOf(<<1, 4, 9>>, 9)","3"]],["Contains","Contains(##Vector$$, ##Needle$$)",
"Returns true if the needle is in the vector. Otherwise returns false.",["Contains(<<1, 4, 9>>, 9)","true"]],["Repeat","Repeat(##x^2$$, ##Times$$)","Creates a new vector by repeating a function a specified expression a number of times. <i>x</i> refers to the current index.",["Repeat(x+1, 3)","<<2, 3, 4>>"]],["Map","Map(##Vector$$, ##x^2+1$$)","Applies a function to each element of a vector, denoted with <i>x</i>, and returns the result.",["Map(<<1, 2, 3>>, x*2)","<<2, 4, 6>>"]],["Filter","Filter(##Vector$$, ##x>7$$)",
"Tests each element of a vector using a function and returns the elements which evaluate to true.",["Filter(<<1, 2, 3>>, x >= 2)","<<2, 3>>"]]]],["General",[["If Then Else","IfThenElse(##Test Condition$$, ##Value if True$$, ##Value if False$$)","Tests a condition and returns one value if the condition is true and another value if the condition is false.",["IfThenElse(20 > 10, 7, 5)","7"]],["Pulse","Pulse(##Time$$, ##Height$$, ##Width=0$$, ##Repeat=-1$$)","Creates a pulse input at the specified time with the specified Height and Width. Height defaults to 1 and Width defaults to 0. Repeat is optional and will create a pulse train if specified.",
"Pulse({10 Years}, 5, 2)"],["Step","Step(##Start$$, ##Height=1$$)","Creates an input that is initially set to 0 and after the time of Start is set to Height. Height defaults to 1.","Step({10 Years}, 5)"],["Ramp","Ramp(##Start$$, ##Finish$$, ##Height=1$$)","Creates a ramp input which moves linearly from 0 to Height between the Start and Finish times. Before Start, the value is 0; after Finish, the value is Height. Height defaults to 1.","Ramp({10 Year}, {20 Years}, 5)"],["Stop","Stop()","Immediately terminates the simulation. Often used in combination with an IfThenElse statement.",
"IfThenElse(rand < 0.01, Stop(), 0)"]]]];d=[];for(a=0;a<g.length;a++){for(var k=[],h=0;h<g[a][1].length;h++)b(g[a][1][h]);d.push({title:g[a][0],items:k,layout:{type:"hbox",align:"stretch"},autoScroll:!0})}a=new Ext.Component({html:"<big><big><big>=</big></big></big>",region:"west",margin:"0 0 0 3"});d=new Ext.TabPanel({region:"south",height:85,activeTab:0,margin:"0 3 0 3",enableTabScroll:!0,items:d,border:!1});c.win=new Ext.Window({title:getText("Equation Editor")+": "+clean(e.getAttribute("name")),
layout:"border",closeAction:"destroy",border:!1,modal:!0,items:[codeEditor,f,d,a],width:600,height:400,resizable:!1,shadow:!0,buttonAlign:"left",buttons:[{disabled:!is_editor,scale:"large",text:getText("Units"),iconCls:"units-icon",tooltip:getText("Edit primitive units"),handler:function(){(new Ext.UnitsWindow({parent:"",cell:e,units:e.getAttribute("Units")})).show()}},"->",{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){c.win.close();""!=c.args.parent&&c.args.parent.resumeEvents()}},
{disabled:!is_editor,iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){var a=codeEditor.getValue(),a=a.replace(/\n|\r/g,"\\n");""!=c.args.parent&&c.args.parent.setValue(a);c.win.close();""!=c.args.parent?(c.args.parent.resumeEvents(),grid.plugins[0].completeEdit(),c.args.parent.setEditable(!/\\n/.test(a))):(graph.getModel().beginUpdate(),setValue(c.args.cell,a),graph.getModel().endUpdate(),selectionChanged(!1))}}]});f.on("beforeselect",function(a,b){insertAtCursor("["+b.data.name+
"]");codeEditor.focus(!1,!0);return!1});c.show=function(){c.win.show();codeEditor.focus(!0,!0)}};
function insertAtCursor(a){var b=codeEditor.getFocusEl().id,b=document.getElementById(b);b.focus();var c=getInputSelection(b).start,d=getInputSelection(b).end;codeEditor.setValue(codeEditor.getValue().substring(0,c)+a+codeEditor.getValue().substring(d,codeEditor.getValue().length));codeEditor.getFocusEl().focus();b.setSelectionRange?(b.focus(),b.setSelectionRange(d+a.length,d+a.length)):b.createTextRange&&(c=b.createTextRange(),c.collapse(!0),c.moveEnd("character",d+a.length),c.moveStart("character",
d+a.length),c.select());b.focus()}
function getInputSelection(a){var b=0,c=0,d,e,f;if("number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd)b=a.selectionStart,c=a.selectionEnd;else if((e=document.selection.createRange())&&e.parentElement()==a)f=a.value.length,d=a.value.replace(/\r\n/g,"\n"),c=a.createTextRange(),c.moveToBookmark(e.getBookmark()),a=a.createTextRange(),a.collapse(!1),-1<c.compareEndPoints("StartToEnd",a)?b=c=f:(b=-c.moveStart("character",-f),b+=d.slice(0,b).split("\n").length-1,-1<c.compareEndPoints("EndToEnd",
a)?c=f:(c=-c.moveEnd("character",-f),c+=d.slice(0,c).split("\n").length-1));return{start:b,end:c}};Ext.form.customFields.converter=Ext.extend(Ext.form.customFields.converter,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.ConverterWindow({parent:this,oldKeys:this.getValue(),interpolation:graph.getSelectionCell().getAttribute("Interpolation")});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.ConverterWindow=function(a){function b(){isUndefined(r)||(r.axes.items[1].minimum=d()[0],r.axes.items[1].maximum=d()[1]);for(var a="",b=0;b<n.getCount();b++)0<b&&(a+=";"),a=a+n.getAt(b).data.xVal+","+n.getAt(b).data.yVal;for(var c=[],a=a.split(";"),e=[],b=0;b<a.length;b++){var g=a[b].split(",");0<b&&c.push({xVal:parseFloat(g[0]),yVal:parseFloat(e[1])});c.push({xVal:parseFloat(g[0]),yVal:parseFloat(g[1])});e=g}null==f?f=new Ext.data.Store({fields:l,data:c}):(f.removeAll(),f.loadData(c))}function c(){for(var a=
"",b=0;b<n.getCount();b++)0<b&&(a+="; "),a=a+n.getAt(b).data.xVal+","+n.getAt(b).data.yVal;return a}function d(){return[n.getAt(0).data.xVal,n.getAt(n.getCount()-1).data.xVal]}var e=this;e.args=a;for(var f=null,a=[],g=e.args.oldKeys.split(";"),h=0;h<g.length;h++){var k=g[h].split(",");a.push({xVal:parseFloat(k[0]),yVal:parseFloat(k[1])})}var l=[{name:"xVal",type:"float"},{name:"yVal",type:"float"}],n=new Ext.data.Store({fields:l,data:a,sorters:["xVal"]}),o=new Ext.grid.plugin.CellEditing({clicksToEdit:1}),
p=new Ext.grid.GridPanel({store:n,width:600,region:"center",margins:"0 5 5 5",plugins:[o],viewConfig:{headersDisabled:!0,markDirty:!1},tbar:[{iconCls:"units-add-icon",text:getText("Add Point"),handler:function(){o.completeEdit();n.insert(0,{xVal:0,yVal:0});p.getView().refresh();p.getSelectionModel().selectRange(0,0);o.startEdit(0,0)}},{id:"converterRemoveBut",iconCls:"units-remove-icon",text:getText("Remove Point"),disabled:!0,handler:function(){o.completeEdit();for(var a=p.getSelectionModel().getSelection(),
b=0,c;c=a[b];b++)n.remove(c)}}],columns:[new Ext.grid.RowNumberer,{id:"xVal",header:getText("Input Value"),dataIndex:"xVal",flex:1,sortable:!1,menuDisabled:!0,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10,selectOnFocus:!0}},{header:getText("Output Value"),dataIndex:"yVal",flex:1,sortable:!1,menuDisabled:!0,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10,selectOnFocus:!0}}]});b();var a="Linear"==e.args.interpolation?n:f,g="",g=""!=e.args.parent?graph.getSelectionCell():
e.args.cell,g="Time"==g.getAttribute("Source")?"Time":findID(g.getAttribute("Source")).getAttribute("name"),r=new Ext.chart.Chart({xtype:"chart",store:a,animate:!1,shadow:!1,axes:[{type:"Numeric",position:"left",fields:["yVal"],title:getText("Output"),grid:!0,labelTitle:{font:"14px Verdana"}},{type:"Numeric",position:"bottom",fields:["xVal"],title:getText("Input")+" ("+clean(g)+")",grid:!0,maximum:d()[1],labelTitle:{font:"14px Verdana"}}],series:[{type:"line",axis:"left",showMarkers:!0,highlight:!1,
smooth:!1,style:{"stroke-width":3},xField:"xVal",yField:"yVal",tips:{trackMouse:!0,width:100,renderer:function(a,b){this.setTitle("<center>("+b.value[0]+", "+b.value[1]+")</center>")}}}]}),a=new Ext.Panel({width:490,height:200,layout:"fit",margins:"5 5 0",region:"north",split:!0,minHeight:100,maxHeight:500,items:r});e.win=new Ext.Window({title:getText("Converter Data Specification"),layout:"border",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},
width:508,height:500,items:[a,p],buttons:[{disabled:!is_editor,scale:"large",text:getText("Units"),iconCls:"units-icon",tooltip:getText("Edit primitive units"),handler:function(){(new Ext.UnitsWindow({parent:"",cell:e.args.cell,units:e.args.cell.getAttribute("Units")})).show()}},{disabled:!is_editor,scale:"large",text:getText("Import Data"),iconCls:"import-icon",tooltip:getText("Import data from a CSV or other text file"),handler:function(){importData(n)}},"->",{scale:"large",iconCls:"cancel-icon",
text:getText("Cancel"),handler:function(){e.win.close();""!=e.args.parent&&e.args.parent.resumeEvents()}},{disabled:!is_editor,scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){o.completeEdit();""!=e.args.parent?e.args.parent.setValue(c()):e.args.cell.setAttribute("Data",c());e.win.close();""!=e.args.parent?(e.args.parent.resumeEvents(),grid.plugins[0].completeEdit()):selectionChanged(!1)}}]});p.getSelectionModel().on("selectionchange",function(a){Ext.getCmp("converterRemoveBut").setDisabled(1>
a.getCount())});n.on("update",function(){n.sort("xVal","ASC");b()});n.on("dataChanged",function(){b()});e.show=function(){e.win.show()}};function importData(a){var b=new Ext.FormPanel({fieldDefaults:{labelWidth:130,width:355},autoScroll:!0,frame:!0,defaultType:"textfield",items:[{xtype:"displayfield",fieldLabel:"",value:"<center>"+getText("Copy and paste the contents from your CSV file or tab-delimited file into the data field below.")+"</center>"},{xtype:"textareafield",fieldLabel:"Data",name:"impData",id:"impData",allowBlank:!1,selectOnFocus:!0,value:getText("Example Input, Example Output")+"\n24, 62\n641, 12\n234, 56\n123, 19",
height:195},{xtype:"checkboxfield",fieldLabel:getText("Include First Row"),inputValue:"1",name:"impIncludeHeader",id:"impIncludeHeader"},new Ext.form.NumberField({fieldLabel:getText("Input Column Index"),name:"impInputIndex",id:"impInputIndex",allowBlank:!1,minValue:1,allowDecimals:!1,value:1}),new Ext.form.NumberField({fieldLabel:getText("Output Column Index"),name:"impOutputIndex",id:"impOutputIndex",allowBlank:!1,minValue:1,allowDecimals:!1,value:2})]}),c=new Ext.Window({title:getText("Import Converter Data"),
layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:380,height:400,items:[b],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){c.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Import"),handler:function(){try{var b=parseCSV(Ext.getCmp("impData").getValue())}catch(e){mxUtils.alert(getText("There was an error with your data file. It should be a valid CSV or tab-delimited text file."));
return}if(0>=b.length)mxUtils.alert(getText("Could not import as no data entered."));else{var f=Ext.getCmp("impInputIndex").getValue()-1,g=Ext.getCmp("impOutputIndex").getValue()-1;if(f<b[0].length&&g<b[0].length){a.removeAll();for(var h=[],k=0==Ext.getCmp("impIncludeHeader").getValue()?1:0;k<b.length;k++)try{var l=flexibleParseFloat(b[k][f]),n=flexibleParseFloat(b[k][g]);isNaN(l)||isNaN(n)?mxUtils.alert(getText("(%s, %s) is not a pair of numbers. Skipping row during import.",b[k][f],b[k][g])):h.push({xVal:l,
yVal:n})}catch(o){mxUtils.alert(getText("Skipping badly formed row (%s, %s) on import.",b[k][f],b[k][g]))}a.add(h);c.close()}else mxUtils.alert(getText("Invalid column index for data file. Maximum number of columns is %s.",b[0].length))}}}]});c.show()}function flexibleParseFloat(a){return parseFloat(a.replace(/\,/g,""))}
function parseCSV(a){var b=/([,\015\012\t;] *)/g,c=/("")*"([,\015\012\t;] *)/g,d=0,e=[],f=[];do{var g='"'==a.charAt(d)?c:b;g.lastIndex=d;var h=g.exec(a);if(!h||!h.length)break;d=a.substring(d,g.lastIndex-h[h.length-1].length);'"'==d.charAt(0)&&(d=d.substring(1,d.length-1).replace(/""/g,'"'));f.push(d);h=h[0];0>h.indexOf(",")&&0>h.indexOf("\t")&&(e.push(f),f=[]);d=g.lastIndex}while(1);d<a.length&&(a=a.substring(d).trim())&&f.push(a);0<f.length&&e.push(f);return e};Ext.form.customFields.units=Ext.extend(Ext.form.customFields.units,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.UnitsWindow({parent:this,units:this.getValue()});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.UnitsWindow=function(a){var b=this;b.setUnitsText=function(a){b.args.newUnits=a;Ext.get("unitsTxt").update("Units: "+clean(a))};b.args=a;a=Ext.create("Ext.Component",{html:"<big><big><big><center><div id='unitsTxt'>Units Label</div></center></big></big></big>",height:30,margin:"5,5,5,5"});b.args.tree=new Ext.tree.Panel({animate:!1,frame:!0,autoScroll:!0,useArrows:!0,flex:1,margin:"5,5,5,5",rootVisible:!1,listeners:{selectionchange:function(a,d){d[0].data.isFolder||b.setUnitsText(d[0].data.id)}}});
b.setupUnits=function(a){a.store.removeAll();a.setRootNode({text:getText("Units"),draggable:!1,id:"Units",leaf:!1,iconCls:"icon-folder",isFolder:!0});var a=[a.getRootNode()],b={};a[a.length-1].appendChild({text:"Unitless",draggable:!1,id:"Unitless",leaf:!0,expanded:!0});for(var b=a[a.length-1].appendChild({text:getText("Units Used in Model"),draggable:!1,id:"Custom",leaf:!1,expanded:!0,isFolder:!0}),e=unitsUsedInModel(),f=0;f<e.length;f++)b.appendChild({text:e[f],draggable:!1,id:e[f],leaf:!0,expanded:!0});
b=a[a.length-1].appendChild({text:getText("Custom Units"),draggable:!1,id:"Custom",leaf:!1,expanded:!0,isFolder:!0});e=customUnits();for(f=0;f<e.length;f++)b.appendChild({text:clean(e[f][0]),draggable:!1,id:e[f][0],leaf:!0,expanded:!1});for(var e=0,g="Distance, Area and Volume\r Metric\r  Millimeters\r  Centimeters\r  Meters\r  Kilometers\r  -\r  Square Millimeters\r  Square Centimeters\r  Square Meters\r  Hectares\r  Square Kilometers\r  -\r  Cubic Millimeters\r  Cubic Centimeters\r  Liters\r  Cubic Meters\r English\r  Inches\r  Feet\r  Yards\r  Miles\r  -\r  Square Inches\r  Square Feet\r  Square Yards\r  Acres\r  Square Miles\r  -\r  Fluid Ounces\r  Quarts\r  Gallons\r  Acre Feet\rVelocity, Acceleration and Flow\r Metric\r  Meters per Second\r  Meters per Second Squared\r  Kilometers per Hour\r  Kilometers per Hour Squared\r  -\r  Liters per Second\r  Cubic Meters per Second\r  -\r  Kilograms per Second\r English\r  Feet per Second\r  Feet per Second Squared\r  Miles per Hour\r  Miles per Hour Squared\r  -\r  Gallons per Second\r  Gallons per Minute\r  -\r  Pounds per Second\rMass, Force and Pressure\r Metric\r  Milligrams\r  Grams\r  Kilograms\r  Tonnes\r  -\r  Newtons\r  -\r  Pascals\r  Kilopascals\r  Bars\r  Atmospheres\r English\r  Ounces\r  Pounds\r  Tons\r  -\r  Pounds Force\r  -\r  Pounds per Square Inch\rTemperature and Energy\r Metric\r  Degrees Celsius\r  Degrees Kelvin\r  -\r  Joules\r  Kilojoules\r  -\r  Watts\r  Kilowatts\r  Megawatts\r  Gigawatts\r  -\r  Amperes\r  -\r  Millivolts\r  Volts\r  Kilovolts\r  -\r  Coulombs\r  -\r  Farads\r English\r  Degrees Fahrenheit\r  -\r  Calories\r  Kilocalories\r  British Thermal Units\rTime\r Milliseconds\r Seconds\r Minutes\r Hours\r Days\r Weeks\r Months\r Quarters\r Years\rMoney\r Dollars\r Flow of Dollars\r  Dollars per Second\r  Dollars per Hour\r  Dollars per Day\r  Dollars per Week\r  Dollars per Month\r  Dollars per Quarter\r  Dollars per Year\r -\r Euros\r Flow of Euros\r  Euros per Second\r  Euros per Hour\r  Euros per Day\r  Euros per Week\r  Euros per Month\r  Euros per Quarter\r  Euros per Year\rBusiness and Commerce\r People\r Customers\r Employees\r Workers\r -\r Factories\r Buildings\r -\r Units\r Widgets\r Parts\rEcology and Nature\r Individuals\r Animals\r Plants\r Trees\r Biomass\rChemistry\r Atoms\r Molecules\r -\r Moles".split(/[\n\r]/),
f=0;f<g.length;f++){var h=g[f].match(/^ *(.*?)$/);if("-"!=h[1]){var k=g[f].length-h[1].length;if(k>e)b.leaf=!1,b.iconCls="icon-folder",b.isFolder=!0,b=a[a.length-1].appendChild(b),a.push(b);else if(k<e){a[a.length-1].appendChild(b);for(b=0;b<e-k;b++)a.pop()}else a[a.length-1].appendChild(b);e=k;b={text:h[1],draggable:!1,id:h[1],leaf:!0,expanded:!1}}}a[a.length-1].appendChild(b)};b.setupUnits(b.args.tree);b.win=new Ext.Window({title:getText("Units Selection"),layout:{type:"vbox",align:"stretch"},closeAction:"destroy",
border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:508,height:400,items:[a,b.args.tree],buttons:[{id:"units_but",scale:"large",text:getText("Custom Units"),iconCls:"units-icon",tooltip:getText("Define custom units"),handler:function(){var a=getSetting(),d=Ext.create("Ext.data.Store",{fields:[{name:"name",type:"string"},{name:"synonym",type:"string"},{name:"scale",type:"float"}],data:function(){for(var a=[],b=customUnits(),c=0;c<b.length;c++){var d=b[c];a.push({name:d[0],
scale:d[1],synonym:d[2]})}return a}(),sorters:["name"]}),e=new Ext.grid.plugin.RowEditing({saveText:"Apply"}),f=[{header:getText("Name"),dataIndex:"name",flex:2,sortable:!0,editor:{xtype:"textfield",allowBlank:!1,regex:/^[a-zA-Z][a-z A-Z]*$/,regexText:getText("The unit name may only contain letters and spaces.")}},{xtype:"numbercolumn",header:getText("Scale"),dataIndex:"scale",width:100,sortable:!1,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10}},{header:getText("Synonym"),dataIndex:"synonym",
flex:3,sortable:!1,editor:{xtype:"textfield",allowBlank:!0,regex:/^([a-zA-Z][a-z A-Z]*(\^-?[\d\.]+)?[\*\/]?)*$/,regexText:getText("The unit synonym should be of the form: Meters*Seconds^2/Kilograms.")}}],g=new Ext.grid.GridPanel({store:d,plugins:[e],features:[],tbar:[{iconCls:"units-remove-icon",itemId:"removeBut",text:getText("Remove Units"),disabled:!0,handler:function(){e.completeEdit();for(var a=g.getSelectionModel().getSelection(),b=0,c;c=a[b];b++)d.remove(c)}},"->",{iconCls:"units-add-icon",
text:getText("Add Units"),handler:function(){var a={name:getText("New Unit"),synonym:"",scale:1};e.completeEdit();d.insert(0,a);d.getAt(0).setDirty();g.getView().refresh();g.getSelectionModel().selectRange(0,0);e.startEdit(0,0)}}],columns:f});g.getSelectionModel().on("selectionchange",function(a){g.getDockedItems()[0].getComponent("removeBut").setDisabled(1>a.getCount())});var h=new Ext.Window({layout:"fit",modal:!0,width:430,title:getText("Configure Custom Units"),height:330,resizable:!0,closeAction:"close",
plain:!0,closable:!1,items:[g],obj:b,buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){h.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){g.plugins[0].completeEdit();for(var e=d.getCount(),f=0;f<e;f++)d.getAt(f).commit();e="";0<d.getCount()&&(e=d.getAt(0).get("name")+"<>"+d.getAt(0).get("scale")+"<>"+d.getAt(0).get("synonym"));for(f=1;f<d.getCount();f++)e=e+"\n"+d.getAt(f).get("name")+"<>"+d.getAt(f).get("scale")+"<>"+d.getAt(f).get("synonym");
graph.getModel().beginUpdate();f=new mxCellAttributeChange(a,"Units",e);graph.getModel().execute(f);graph.getModel().endUpdate();b.setupUnits(b.args.tree);h.close()}}]});h.show()},scope:this},"->",{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){b.win.close();""!=b.args.parent&&b.args.parent.resumeEvents()}},{disabled:!is_editor,scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){""!=b.args.parent?(b.args.parent.setValue(b.args.newUnits),b.win.close(),
b.args.parent.resumeEvents(),grid.plugins[0].completeEdit()):(graph.getModel().beginUpdate(),b.args.cell.setAttribute("Units",b.args.newUnits),graph.getModel().endUpdate(),b.win.close())}}]});b.show=function(){b.win.show();b.setUnitsText(b.args.units)}};var sensitivityProgress,sensitivityController={};
function doSensitivity(){for(var a=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),b=[],c=primitives(),d=0;d<c.length;d++)isValued(c[d])&&!inAgent(c[d])&&b.push({pid:c[d].id,pname:c[d].getAttribute("name")});a.loadData(b);var b=getSetting(),a=new Ext.FormPanel({fieldDefaults:{labelWidth:145,width:355},autoScroll:!0,frame:!0,defaultType:"textfield",items:[Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:"Monitored Primitives",name:"monPrimitives",
id:"monPrimitives",displayField:"pname",valueField:"pid",queryMode:"local",store:a,emptyText:getText("Select primitives to monitor"),value:b.getAttribute("SensitivityPrimitives")?b.getAttribute("SensitivityPrimitives").split(","):[]}),new Ext.form.NumberField({fieldLabel:getText("Number of Runs"),name:"nRuns",id:"nRuns",allowBlank:!1,minValue:10,allowDecimals:!1,value:b.getAttribute("SensitivityRuns")}),{fieldLabel:getText("Confidence Regions")+" (%)",name:"confRegion",id:"confRegion",allowBlank:!1,
value:b.getAttribute("SensitivityBounds")},{xtype:"checkboxfield",fieldLabel:getText("Plot Each Run (slower)"),inputValue:"true",name:"plotEach",id:"plotEach",checked:isTrue(b.getAttribute("SensitivityShowRuns"))},{xtype:"displayfield",fieldLabel:"",value:"<div style='padding-top:1.2em; padding-left: 0.8em;padding-right: 0.8em'><img style='float:left; margin-right: 7px' src='"+builder_path+"/images/gui/help.png' width=32px height=32px />Sensitivity analysis runs your simulation multiple times with random inputs to see how the results vary (in a sense, how 'sensitive' the results are to the inputs).<br/><br/> In order to use sensitivity analysis you need to have sources of randomness in your model. For instance, you can use the <i>Rand()</i> function or other Insight Maker random generation functions to choose random variables or random starting values. Please note, that if you want to have a random variable value, you can use <i>Fix(Rand())</i> to set the variable to a random value at the start of the simualtion and keep it at the same value for the rest of that simulation.</div>"}]}),
e=new Ext.Window({title:getText("Sensitivity Analysis"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:380,height:425,items:[a],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){e.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Run Analysis"),handler:function(){var a=Ext.getCmp("nRuns").getValue(),b=Ext.getCmp("monPrimitives").getValue(),c=Ext.Array.map(Ext.getCmp("confRegion").getValue().split(","),
parseFloat),d=isTrue(Ext.getCmp("plotEach").getValue());if(1>b.length)mxUtils.alert(getText("You must select one or more primitives to monitor."));else if(1>c.length)mxUtils.alert(getText("You must specify one or more bounds as percentages."));else{for(var l=0;l<c.length;l++)if(0>=c[l]||100<c[l]){mxUtils.alert(getText("Bounds are percentage values that must be between 0 and 100."));return}l=getSetting();graph.getModel().beginUpdate();var n=new mxCellAttributeChange(l,"SensitivityPrimitives",b.join(","));
graph.getModel().execute(n);n=new mxCellAttributeChange(l,"SensitivityRuns",a);graph.getModel().execute(n);n=new mxCellAttributeChange(l,"SensitivityBounds",c.join(", "));graph.getModel().execute(n);n=new mxCellAttributeChange(l,"SensitivityShowRuns",d);graph.getModel().execute(n);graph.getModel().endUpdate();sensitivityProgress=Ext.MessageBox.show({msg:getText("Running Sensitivity Analysis..."),icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});sensitivityController={nRuns:a,
items:b,bounds:c,showRuns:d,results:[]};setTimeout("runSensitivity()",15);e.close()}}}]});e.show()}
function runSensitivity(){var a=runModel({silent:!0});if("none"!=a.error)mxUtils.alert(a.error),highlight(a.errorPrimitive),sensitivityProgress&&sensitivityProgress.close();else if(sensitivityController.results.push(a),sensitivityProgress.updateProgress(sensitivityController.results.length/sensitivityController.nRuns," "),sensitivityController.results.length<sensitivityController.nRuns)setTimeout("runSensitivity()",15);else{for(var a=sensitivityController.nRuns,b=sensitivityController.results,c=sensitivityController.bounds,
d=sensitivityController.items,e=[],f=0;f<d.length;f++){for(var g=findID(d[f]),h=[],k=0;k<a;k++)h.push(b[k].value(g));for(var l={median:[]},k=0;k<c.length;k++)l[c[k]+"_lower"]=[],l[c[k]+"_upper"]=[];for(var n=0;n<h[0].length;n++){for(var o=[],k=0;k<h.length;k++)o.push(h[k][n]);o=o.sort(function(a,b){return a-b});l.median.push(getQuantile(o,0.5));for(k=0;k<c.length;k++)l[c[k]+"_lower"].push(getQuantile(o,0.5-c[k]/100/2)),l[c[k]+"_upper"].push(getQuantile(o,0.5+c[k]/100/2))}var o={name:g.getAttribute("name")+
" Quantiles Table",type:"table"},p=[],r=[];p.push(getText("Time"));r.push(b[0].Time);p.push(getText("Median"));r.push(l.median);for(var s=[{name:getText("Median"),data:l.median,type:"line",color:"black"}],n="#ECC928,#425FCA,#8E630F,#007012,#CC2C33,#773A86".split(","),u=[],w=[],k=c.length-1;0<=k;k--)p.push(c[k]+"% "+getText("Lower")),r.push(l[c[k]+"_lower"]),p.push(c[k]+"% "+getText("Upper")),r.push(l[c[k]+"_upper"]),0<k&&w.push({name:"Lower "+c[k]+"%",data:l[c[k-1]+"_lower"],type:"line",color:n[k%
n.length],fill:!0,hideMarkers:!0,hideLegend:!0}),u.push({name:c[k]+"% "+getText("Region"),data:l[c[k]+"_upper"],type:"line",color:n[k%n.length],fill:!0,hideMarkers:!0});for(k=0;k<u.length;k++)s.push(u[k]);for(k=w.length-1;0<=k;k--)s.push(w[k]);s.push({name:"White Cover",data:l[c[c.length-1]+"_lower"],type:"line",color:"white",fill:!0,hideMarkers:!0,hideLegend:!0});o.header=p;o.data=r;e.push({legend:"right",data:s,name:g.getAttribute("name")+" "+getText("Quantiles Chart"),type:"chart",horizontalGrid:!1,
verticalGrid:!1,xType:"Numeric",xData:b[0].Time,xLabel:"Time",yLabel:g.getAttribute("name")});e.push(o);if(sensitivityController.showRuns){o={name:g.getAttribute("name")+" "+getText("Runs Table"),type:"table"};p=[];r=[];s=[];for(n=0;n<a;n++)p.push("Run "+(n+1)),r.push(h[n]),s.push({title:"",data:h[n],type:"line",hideMarkers:!0});o.header=p;o.data=r;e.push({legend:"none",data:s,name:g.getAttribute("name")+" "+getText("Runs Chart"),type:"chart",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:b[0].Time,
xLabel:"Time",yLabel:g.getAttribute("name")});e.push(o)}}sensitivityProgress.close();showData(getText("Sensitivity Analysis Results"),e)}}function getQuantile(a,b){var c=a.length*b;return Math.ceil(c)==a.length?a[a.length-1]:c==Math.ceil(c)?a[c]:(a[Math.floor(c)]+a[Math.ceil(c)])/2};var optimizerProgress,optimizerController={};
function doOptimizer(){for(var a=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),b=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),c=[],d=[],e=primitives(),f=0;f<e.length;f++)if(isValued(e[f])&&!inAgent(e[f])){var g={pid:e[f].id,pname:e[f].getAttribute("name")};c.push(g);("Stock"==e[f].value.nodeName||"Variable"==e[f].value.nodeName)&&d.push(g)}b.loadData(c);a.loadData(d);c=getSetting();d=c.getAttribute("OptimizerGridStore")?
JSON.parse(c.getAttribute("OptimizerGridStore")):[];for(f=d.length-1;0<=f;f--)findID(d[f].id)||d.splice(f,1);var h=Ext.create("Ext.data.Store",{fields:["id","minBound","maxBound","desiredAccuracy"],data:d}),f=Ext.create("Ext.grid.Panel",{store:h,columns:[{header:getText("Primitive Name"),sortable:!1,menuDisabled:!0,dataIndex:"id",flex:1,renderer:function(a){return getName(findID(a))}},{header:getText("Minimum Bound"),sortable:!1,menuDisabled:!0,dataIndex:"minBound",width:90,editor:{xtype:"numberfield",
allowBlank:!1}},{header:getText("Maximum Bound"),sortable:!1,menuDisabled:!0,dataIndex:"maxBound",width:90,editor:{xtype:"numberfield",allowBlank:!1}},{header:getText("Accuracy"),sortable:!1,menuDisabled:!0,dataIndex:"desiredAccuracy",width:65,editor:{xtype:"numberfield",allowBlank:!1,step:0.1,minValue:0}}],selType:"cellmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],flex:1,width:368}),a=new Ext.FormPanel({fieldDefaults:{labelWidth:145,width:355},autoScroll:!0,frame:!0,
items:[Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal Primitive"),name:"optGoalPrimitive",id:"optGoalPrimitive",displayField:"pname",valueField:"pid",queryMode:"local",store:b,forceSelection:!0,allowBlank:!1,emptyText:getText("Select primitive to target"),value:c.getAttribute("OptimizerGoalPrimitive")?c.getAttribute("OptimizerGoalPrimitive"):void 0}),Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal"),name:"optGoal",id:"optGoal",queryMode:"local",store:[["Minimize",getText("Minimize")],
["Maximize",getText("Maximize")]],forceSelection:!0,allowBlank:!1,value:c.getAttribute("OptimizerGoal")?c.getAttribute("OptimizerGoal"):"Minimize"}),Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal Type"),name:"optGoalType",id:"optGoalType",queryMode:"local",store:[["Integral of Value",getText("Integral of Value")],["Final Value",getText("Final Value")]],forceSelection:!0,allowBlank:!1,value:c.getAttribute("OptimizerGoalType")?c.getAttribute("OptimizerGoalType"):"Integral of Value"}),
Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Primitives to Change"),name:"optChangePrimitives",id:"optChangePrimitives",displayField:"pname",valueField:"pid",queryMode:"local",store:a,emptyText:getText("Select primitives to adjust"),listeners:{change:function(a,b,c){a=b.split?b.split(", "):[];c=c.split?c.split(", "):[];for(b=0;b<a.length;b++)""!=a[b].trim()&&-1==h.find("id",a[b])&&h.add({id:a[b],minBound:0,maxBound:1,desiredAccuracy:0.1});for(b=0;b<c.length;b++)""!=c[b].trim()&&-1==
a.indexOf(c[b])&&h.removeAt(h.find("id",c[b]))}},value:c.getAttribute("OptimizerPrimitives")?c.getAttribute("OptimizerPrimitives").split(","):[]})]}),b=new Ext.FormPanel({fieldDefaults:{labelWidth:195,width:355},autoScroll:!0,frame:!0,items:[new Ext.form.NumberField({fieldLabel:getText("Random Starts"),name:"nRandomStarts",id:"nRandomStarts",allowBlank:!1,minValue:0,allowDecimals:!1,value:c.getAttribute("OptimizerRandomStarts")?c.getAttribute("OptimizerRandomStarts"):0}),new Ext.form.NumberField({fieldLabel:getText("Maximum Number of Iterations"),
name:"nIterations",id:"nIterations",allowBlank:!1,minValue:1,allowDecimals:!1,value:c.getAttribute("OptimizerMaxIterations")?c.getAttribute("OptimizerMaxIterations"):100}),new Ext.form.NumberField({fieldLabel:getText("Step Reduction Factor"),name:"nStepReduction",id:"nStepReduction",allowBlank:!1,minValue:0,maxValue:1,step:0.1,allowDecimals:!0,value:c.getAttribute("OptimizerStepReduction")?c.getAttribute("OptimizerStepReduction"):0.5})]}),k=new Ext.Window({title:getText("Optimization"),layout:"fit",
closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:380,height:425,items:[Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"vbox",activeTab:0,plain:!0,flex:1,items:[{title:getText("General"),items:[a,f]},{title:getText("Advanced"),items:b}]})],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){k.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Run Optimization"),handler:function(){var a=
Ext.getCmp("nRandomStarts").getValue(),b=Ext.getCmp("nIterations").getValue(),c=Ext.getCmp("nStepReduction").getValue(),d=Ext.getCmp("optGoal").getValue(),e=Ext.getCmp("optGoalType").getValue(),f=Ext.getCmp("optGoalPrimitive").getValue(),g=Ext.getCmp("optChangePrimitives").getValue();if(1>g.length)mxUtils.alert(getText("You must select one or more primitives to change."));else if(f){var w=getSetting();graph.getModel().beginUpdate();var v=new mxCellAttributeChange(w,"OptimizerPrimitives",g.join(","));
graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerGoalPrimitive",f);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerGoal",d);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerGoalType",e);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerStepReduction",c);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerMaxIterations",b);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerRandomStarts",a);
graph.getModel().execute(v);var x=[];h.each(function(a){x.push(a.getData())});v=new mxCellAttributeChange(w,"OptimizerGridStore",JSON.stringify(x));graph.getModel().execute(v);graph.getModel().endUpdate();optimizerProgress=Ext.MessageBox.show({msg:getText("Optimizing Model..."),icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});optimizerController={runs:-1,randomStarts:a,optIterations:b,stepReduction:c,optGoal:d,goalType:e,goalPrimitive:f,changePrimitives:g,gridData:x};
k.close();setTimeout("runOptimizer()",30)}else mxUtils.alert(getText("You must select a goal primitive to optimize."))}}]});k.show()}
function runOptimizer(){-1==optimizerController.runs&&setupOptimizer();if(optimizerController.runs<=optimizerController.randomStarts){optimizerController.midRun||(optMsg("Run: "+optimizerController.runs),optimizerController.iterations=0,optimizerController.stepScale=1,optimizerController.metAccuracyConditions=!1,optimizerController.opts.push(new DataStore),setInitialPosition(0!=optimizerController.runs));var a=Date.now();for(optimizerController.midRun=!0;!metFinishedConditions();){optimizerController.currentPointMarker=
evaluateCurrentPoint();optimizerController.startPoints.length-1<optimizerController.runs&&(optimizerController.startPoints.push(optimizerController.currentPointMarker),optimizerController.opts[optimizerController.opts.length-1].data.push(optimizerController.solutionSpace[0][optimizerController.currentPointMarker]));var b=explore();if(b.stationary()){optMsg("Reducing Step Size");reduceStepSizes();for(var c=0;c<optimizerController.coreDimensions.length;c++)optimizerController.optDimensions[c]=optimizerController.coreDimensions[c];
optimizerController.dimensionsDiscarded=0}else if(optMsg("Moving"),isLocal()&&console.log(b),patternMove(b),!dimensionExists(b))if(optMsg("Inserting Dimension: "+b.toString()),optimizerController.optDimensions.splice(optimizerController.optDimensions.length-1),optimizerController.optDimensions=[b].concat(optimizerController.optDimensions),optimizerController.dimensionsDiscarded+=1,optimizerController.dimensionsDiscarded>optimizerController.coreDimensions.length){for(c=0;c<optimizerController.coreDimensions.length;c++)optimizerController.optDimensions[c]=
optimizerController.coreDimensions[c];optimizerController.dimensionsDiscarded=0}else optMsg("Dimension Already Exists:"+b.toString());optimizerController.iterations+=1;optimizerController.opts[optimizerController.opts.length-1].data.push(optimizerController.solutionSpace[0][optimizerController.currentPointMarker]);b=Math.log(optimizerController.stepScale*optimizerController.stepSizes[0]/optimizerController.accuracies[0]);for(c=1;c<optimizerController.stepSizes.length;c++){var d=Math.log(optimizerController.stepScale*
optimizerController.stepSizes[c]/optimizerController.accuracies[c]);d>b&&(b=d)}-1==optimizerController.maxAcc&&(optimizerController.maxAcc=b);c=1/(optimizerController.randomStarts+1);optimizerProgress.updateProgress((optimizerController.runs+1)*c+c*Math.min(0.95,Math.max(optimizerController.iterations/optimizerController.optIterations,(optimizerController.maxAcc-b)/optimizerController.maxAcc))," ");if(2<(Date.now()-a)/1E3){setTimeout("runOptimizer()",30);return}}optimizerController.bestPoints.push(optimizerController.currentPointMarker);
optimizerController.midRun=!1;optimizerController.runs++;setTimeout("runOptimizer()",30)}else finishOptimizer()}
function setupOptimizer(){optimizerController.startTime=Date.now();optimizerController.midRun=!1;optimizerController.goal=findID(optimizerController.goalPrimitive);optimizerController.targets=findID(optimizerController.changePrimitives);optimizerController.maximums=[];optimizerController.minimums=[];optimizerController.accuracies=[];for(var a=0;a<optimizerController.targets.length;a++)for(var b=0;b<optimizerController.gridData.length;b++){var c=optimizerController.gridData[b];if(c.id==optimizerController.targets[a].id){optimizerController.maximums.push(c.maxBound);
optimizerController.minimums.push(c.minBound);optimizerController.accuracies.push(c.desiredAccuracy);break}}optimizerController.reductionRate=optimizerController.stepReduction;optimizerController.minimize="Minimize"==optimizerController.optGoal?1:-1;optimizerController.stepScale=1;optimizerController.stepSizes=[];for(a=0;a<optimizerController.maximums.length;a++)optimizerController.stepSizes.push((optimizerController.maximums[a]-optimizerController.minimums[a])/4);optimizerController.evaluations=
0;optimizerController.currentPointMarker=0;optimizerController.iterations=0;optimizerController.solutionSpace=[];optimizerController.runs=0;optimizerController.bestPoints=[];optimizerController.startPoints=[];optimizerController.terminationReasons=[];optimizerController.opts=[];optimizerController.metAccuracyConditions=!1;optimizerController.maxAcc=-1;optimizerController.coreDimensions=[];for(a=0;a<optimizerController.targets.length;a++)optimizerController.coreDimensions.push(new OptDimension(a));
optimizerController.optDimensions=[];for(a=0;a<optimizerController.targets.length;a++)optimizerController.optDimensions.push(optimizerController.coreDimensions[a]);optimizerController.dimensionsDiscarded=0}
function finishOptimizer(){for(var a=optimizerController.bestPoints[0],b=1;b<optimizerController.bestPoints.length;b++)optimizerController.solutionSpace[0][optimizerController.bestPoints[b]]*optimizerController.minimize<optimizerController.solutionSpace[0][a]*optimizerController.minimize&&(a=optimizerController.bestPoints[b]);for(b=1;b<optimizerController.targets.length;b++)setValue(optimizerController.targets[b],optimizerController.solutionSpace[b+1][a]);a="<div style='padding: 1em; text-align: center;'><p>"+
getText("Your model has been set to the optimum solution.")+"</p><br/>"+optString(a);a=a+"<br/><p>"+getText("Please note that the optimization algorithm is unable to fully account for local minimums or maximums. If your solution space contains such features, the algorithm may have returned erroneous results.")+"</p>";if(0<optimizerController.randomStarts){a=a+"<hr><p>"+getText("You specified a total of %s random iterations. The optimums of the initial iteration and each random one are as follows",
optimizerController.randomStarts)+":<br/>";for(b=0;b<optimizerController.bestPoints.length;b++)a=a+"\n\n"+optString(optimizerController.bestPoints[b])}a=a+"<hr/><p>"+getText("Optimization Duration: %s seconds",(Date.now()-optimizerController.startTime)/1E3)+"</p></div>";a=[{name:"Summary",type:"html",data:a}];if(1==optimizerController.targets.length){for(var c=[],d=[],e=[],b=0;b<optimizerController.evaluations;b++)e.push({x:optimizerController.solutionSpace[1][b],y:optimizerController.solutionSpace[0][b]});
e.sort(function(a,b){return a.x-b.x});for(b=0;b<e.length;b++)c.push(e[b].x),d.push(e[b].y);a.push({name:getText("Explored Solution Space"),type:"chart",xLabel:getName(optimizerController.targets[0]),yLabel:getName(optimizerController.goal)+" "+optimizerController.goalType,legend:"none",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:c,data:[{data:d,type:"line",name:"Results"}]})}c=[];d=[];for(b=0;b<optimizerController.opts.length;b++)c=c.concat(optimizerController.opts[b].iterations()),d.push({data:optimizerController.opts[b].data,
type:"line",name:"Run "+(b+1)});c=Ext.Array.unique(c);a.push({name:getText("Iterations"),type:"chart",xLabel:getText("Iteration"),yLabel:getName(optimizerController.goal)+" "+optimizerController.goalType+" Optimum",legend:"none",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:c,data:d});c=[[],[]];d=[getName(optimizerController.goal)+" "+optimizerController.goalType];for(e=0;e<optimizerController.targets.length;e++)d.push(getName(optimizerController.targets[e])),c.push([]);d.push("Note");for(b=
0;b<optimizerController.evaluations;b++){for(e=0;e<=optimizerController.targets.length;e++)c[e].push(optimizerController.solutionSpace[e][b]);-1!=optimizerController.startPoints.indexOf(b)?c[c.length-1].push(getText("Iteration Start")):-1!=optimizerController.bestPoints.indexOf(b)?c[c.length-1].push(getText("Iteration Optimum")):c[c.length-1].push("")}a.push({name:getText("Results Table"),type:"table",data:c,header:d});showData(getText("Optimization Results"),a);optimizerProgress.close()}
var OptDimension=function(a){this.coords=[];if(null!=a)for(var b=0;b<optimizerController.targets.length;b++)b==a?this.coords.push(1):this.coords.push(0);else for(b=0;b<optimizerController.targets.length;b++)this.coords.push(0)};OptDimension.prototype.toString=function(){for(var a=[],b=0;b<this.coords.length;b++)a.push(this.coords[b]);return"<<"+a.join(", ")+">>"};OptDimension.prototype.append=function(a,b){for(var b=b?b:1,c=0;c<a.coords.length;c++)this.coords[c]+=a.coords[c]*b};
OptDimension.prototype.apply=function(a){for(var b=0;b<optimizerController.targets.length;b++){var c=parseFloat(getValue(optimizerController.targets[b]))+this.coords[b]*a*optimizerController.stepSizes[b]*optimizerController.stepScale;optMsg("Value "+b+": "+c);setValue(optimizerController.targets[b],c)}};OptDimension.prototype.stationary=function(){for(var a=0;a<this.coords.length;a++)if(0!=this.coords[a])return!1;return!0};
OptDimension.prototype.makeUnit=function(){for(var a=this.length(),b=0;b<this.coords.length;b++)this.coords[b]/=a};OptDimension.prototype.length=function(){for(var a=0,b=0;b<this.coords.length;b++)a+=Math.pow(this.coords[b],2);return Math.sqrt(a)};OptDimension.prototype.equalTo=function(a){for(var b=0,c=0;c<this.coords.length;c++)b+=Math.abs(a.coords[c]*this.coords[c]);b/=this.length()*a.length();return 0.99<b};
function dimensionExists(a){for(var b=0;b<optimizerController.optDimensions.length;b++)if(optimizerController.optDimensions[b].equalTo(a))return!0;return!1}function metFinishedConditions(){if(optimizerController.iterations>optimizerController.optIterations)return optimizerController.terminationReasons.push("Iterations"),!0;optimizerController.metAccuracyConditions&&optimizerController.terminationReasons.push("StepSize");return optimizerController.metAccuracyConditions}
function reduceStepSizes(){optimizerController.metAccuracyConditions=!0;for(i=0;i<optimizerController.stepSizes.length;i++)if(optimizerController.stepSizes[i]*optimizerController.stepScale>=optimizerController.accuracies[i]){optimizerController.metAccuracyConditions=!1;break}optimizerController.stepScale*=optimizerController.reductionRate;optMsg("Step scale: "+optimizerController.stepScale)}function restoreCurrentPoint(){restorePoint(optimizerController.currentPointMarker)}
function restorePoint(a){for(var b=0;b<optimizerController.targets.length;b++)setValue(optimizerController.targets[b],optimizerController.solutionSpace[b+1][a])}
function evaluateCurrentPoint(){testPointBounds();for(var a=[],b=0;b<optimizerController.targets.length;b++)a.push(parseFloat(getValue(optimizerController.targets[b])));for(var c=0;c<optimizerController.evaluations;c++){for(var d=!0,b=0;b<optimizerController.targets.length;b++)if(optimizerController.solutionSpace[b+1][c]!=a[b]){d=!1;break}if(d)return c}a=runModel({silent:!0});if("none"!=a.error)throw mxUtils.alert(a.error),highlight(a.errorPrimitive),optimizerProgress&&optimizerProgress.close(),"Opt Error";
optimizerController.evaluations+=1;optimizerController.solutionSpace.length=optimizerController.targets.length+1;for(b=0;b<optimizerController.solutionSpace.length;b++)optimizerController.solutionSpace[b]||(optimizerController.solutionSpace[b]=[]),optimizerController.solutionSpace[b].length=optimizerController.evaluations;if("Final Value"==optimizerController.goalType)optimizerController.solutionSpace[0][optimizerController.evaluations-1]=a.lastValue(optimizerController.goal);else if("Integral of Value"==
optimizerController.goalType){a=a.value(optimizerController.goal);for(b=c=0;b<a.length;b++)c+=a[b];optimizerController.solutionSpace[0][optimizerController.evaluations-1]=c}else alert("Unknonw optimizer goal type: "+optimizerController.goalType);for(b=0;b<optimizerController.targets.length;b++)optimizerController.solutionSpace[b+1][optimizerController.evaluations-1]=parseFloat(getValue(optimizerController.targets[b]));return optimizerController.evaluations-1}
function explore(){var a=new OptDimension,b=optimizerController.currentPointMarker,c;optMsg("Exploring");for(var d=0;d<optimizerController.optDimensions.length;d++)optMsg("Dimensions "+optimizerController.optDimensions[d].toString()),optimizerController.optDimensions[d].apply(1),c=evaluateCurrentPoint(),firstBetter(c,b)?(optMsg("Plus 1 Success"),a.append(optimizerController.optDimensions[d],1),b=c):(restorePoint(b),optimizerController.optDimensions[d].apply(-1),c=evaluateCurrentPoint(),firstBetter(c,
b)?(optMsg("Minus 1 Success"),a.append(optimizerController.optDimensions[d],-1),b=c):(optMsg("Static"),restorePoint(b)));return a}
function patternMove(a){optMsg("Pattern Move: "+a.toString());var b=evaluateCurrentPoint();a.apply(1);a=evaluateCurrentPoint();optMsg("Step One: "+optimizerController.solutionSpace[0][b]);optMsg("Step Two: "+optimizerController.solutionSpace[0][a]);firstBetter(b,a)?(optMsg("Chose 1"),optimizerController.currentPointMarker=b):(optMsg("Chose 2"),optimizerController.currentPointMarker=a);restoreCurrentPoint()}
function firstBetter(a,b){return optimizerController.solutionSpace[0][a]*optimizerController.minimize<optimizerController.solutionSpace[0][b]*optimizerController.minimize}
function testPointBounds(){for(var a=0;a<optimizerController.targets.length;a++)parseFloat(getValue(optimizerController.targets[a]))>optimizerController.maximums[a]&&setValue(optimizerController.targets[a],optimizerController.maximums[a]),parseFloat(getValue(optimizerController.targets[a]))<optimizerController.minimums[a]&&setValue(optimizerController.targets[a],optimizerController.minimums[a])}
function setInitialPosition(a){for(var b=0;b<optimizerController.targets.length;b++){var c;c=a?Math.random():0.5;setValue(optimizerController.targets[b],(optimizerController.maximums[b]-optimizerController.minimums[b])*c+optimizerController.minimums[b])}}
function optString(a){var b=optimizerController.terminationReasons[optimizerController.bestPoints.indexOf(a)],c;c="<br/><center><table border='1' cellpadding='4' align = 'center' style='text-align:center;background-color: #f8ffcf; border: solid 1px black;'><tr><td style='padding:.5em'><b>Primitive</b></td><td style='padding:.5em'><b>Optimum</b></td><td style='padding:.5em'><b>Range</b></td></tr><tr><td colspan=3 style='padding:.5em'><b>Goal Primitive</b></td></tr><tr><td style='padding:.5em'><b>["+getName(optimizerController.goal)+
"]</b></td><td style='padding:.5em'>"+optimizerController.solutionSpace[0][a]+"</td><td style='padding:.5em'>";c=("Iterations"==b?c+" optimization terminated due to exceeding maximum number of allowed iterations":c+"--")+"</td></tr><tr><td colspan=3 style='padding:.5em'><b>Changed Primitives</b></td></tr>";for(var d=0;d<optimizerController.targets.length;d++){var e=optimizerController.solutionSpace[d+1][a];c=c+"<tr><td style='padding:.5em'><b>["+getName(optimizerController.targets[d])+"]</></td><td style='padding:.5em'>"+
e+"</td><td style='padding:.5em'>";"StepSize"==b?(c=e==optimizerController.minimums[d]?c+"-Infinity":c+(e-optimizerController.accuracies[d]),c+=" - ",c=e==optimizerController.maximums[d]?c+"Infinity":c+(e+optimizerController.accuracies[d])):c+="--";c+="</td></tr>"}return c+"</table></center>"}var DataStore=function(){this.data=[]};DataStore.prototype.iterations=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(b);return a};function optMsg(a){isLocal()&&console.log(a)};var resultsWindows=[];function commaStr(a){if(1E9<=a||1.0E-9>=a&&0!=a)return a.toPrecision(3);for(var a=round(a,9)+"",b=a.split("."),a=b[0],b=1<b.length?"."+b[1]:"",c=/(\d+)(\d{3})/;c.test(a);)a=a.replace(c,"$1,$2");return a+b}
function round(a,b,c){var d,e,f,b=Math.pow(10,b|0),a=a*b;f=0<a|-(0>a);e=a%1===0.5*f;d=Math.floor(a);if(e)switch(c){case "PHP_ROUND_HALF_DOWN":a=d+(0>f);break;case "PHP_ROUND_HALF_EVEN":a=d+d%2*f;break;case "PHP_ROUND_HALF_ODD":a=d+!(d%2);break;default:a=d+(0<f)}return(e?a:Math.round(a))/b}
var unfilteredRange=function(){var a=this.chart,b=a.getChartStore().queryBy(function(){return!0}).items,c=a.series.items,d=this.position,e,f=Ext.chart.series,a=[],g=Infinity,h=-Infinity,k="left"===this.position||"right"===this.position,l,n,o,p,r=b.length,s={},u={},w=!0,v;e=this.fields;for(p=0,n=e.length;p<n;p++)u[e[p]]=!0;for(l=0,n=c.length;l<n;l++)if(!c[l].seriesIsHidden&&c[l].getAxesForXAndYFields&&(e=c[l].getAxesForXAndYFields(),!e.xAxis||!(e.xAxis!==d&&e.yAxis&&e.yAxis!==d))){e=f.Bar&&c[l]instanceof
f.Bar&&!c[l].column?k?Ext.Array.from(c[l].xField):Ext.Array.from(c[l].yField):k?Ext.Array.from(c[l].yField):Ext.Array.from(c[l].xField);if(this.fields.length){for(p=0,o=e.length;p<o&&!u[e[p]];p++);if(p==o)continue}if(p=c[l].stacked)f.Bar&&c[l]instanceof f.Bar?c[l].column!=k&&(w=p=!1):k||(w=p=!1);if(p){o={};for(p=0;p<e.length;p++)if(!w||!c[l].__excludes||!c[l].__excludes[p])u[e[p]]||Ext.Logger.warn("Field `"+e[p]+"` is not included in the "+d+" axis config."),u[e[p]]=o[e[p]]=!0;a.push({fields:o,value:0})}else{if(!e||
0==e.length)e=this.fields;for(p=0;p<e.length;p++)if(!w||!c[l].__excludes||!c[l].__excludes[p])u[e[p]]=s[e[p]]=!0}}for(l=0;l<r;l++){d=b[l];for(c=0;c<a.length;c++)a[c].value=0;for(v in u)if(f=d.get(v),!isNaN(f)){void 0===f&&(f=0);s[v]&&(g>f&&(g=f),h<f&&(h=f));for(c=0;c<a.length;c++)a[c].fields[v]&&(a[c].value+=f,0<g&&(g=0),h<a[c].value&&(h=a[c].value))}}isFinite(h)||(h=this.prevMax||0);isFinite(g)||(g=this.prevMin||0);g!=h&&h!=Math.floor(h)&&(h=Math.floor(h)+1);isNaN(this.minimum)||(g=this.minimum);
isNaN(this.maximum)||(h=this.maximum);g>=h&&(h=g+1);return{min:g,max:h}},displayConfigWin,displayConfigStore,displayConfigStore2;
function openDisplayConfigure(a){displayConfigWin||(displayConfigStore=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),displayConfigStore2=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),displayConfigWin=new Ext.Window({layout:"fit",modal:!0,autoScroll:!0,width:410,title:getText("Chart/Table Configuration"),height:580,resizable:!1,closeAction:"hide",plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:80},
frame:!0,autoScroll:!0,id:"displayConfigure",bodyStyle:"padding:5px 5px 0",defaults:{width:365},items:[{xtype:"fieldset",title:getText("General Settings"),defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[{fieldLabel:"Title",id:"chartTitle",name:"chartTitle",allowBlank:!1},Ext.create("Ext.form.ComboBox",{fieldLabel:"Type",name:"chartType",id:"chartType",allowBlank:!1,store:[["Time Series",getText("Time Series")],["Scatterplot",getText("Scatterplot")],["Tabular",getText("Tabular")],
["Map",getText("Map")]],queryMode:"local",forceSelection:!0,listeners:{change:function(a,b){a.validate()&&("Scatterplot"==b?(Ext.getCmp("xAxisLabel").setValue("%o"),Ext.getCmp("yAxisLabel").setValue("%o"),Ext.getCmp("showMarkers").setValue(!0),Ext.getCmp("showLines").setValue(!1)):"Time Series"==b?(Ext.getCmp("xAxisLabel").setValue("Time (%u)"),Ext.getCmp("yAxisLabel").setValue(""),Ext.getCmp("showMarkers").setValue(!1),Ext.getCmp("showLines").setValue(!0)):"Map"==b&&(Ext.getCmp("xAxisLabel").setValue("%o"),
Ext.getCmp("yAxisLabel").setValue("%o"),Ext.getCmp("showMarkers").setValue(!0),Ext.getCmp("showLines").setValue(!1)),Ext.getCmp("chartSettings").setDisabled("Tabular"==b),Ext.getCmp("chartSettings2").setDisabled("Time Series"!=b))}}}),Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Data"),name:"chartPrimitives",id:"chartPrimitives",displayField:"pname",valueField:"pid",queryMode:"local",store:displayConfigStore,emptyText:getText("Select which data to display")}),{xtype:"checkboxfield",
fieldLabel:getText("Add New"),name:"autoAdd",id:"autoAdd",boxLabel:getText("Add newly created primitives to the data")}]},{xtype:"fieldset",title:getText("Chart Settings"),defaultType:"textfield",id:"chartSettings",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"fieldcontainer",fieldLabel:getText("X-Axis"),layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"xAxisLabel",name:"xAxisLabel"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Min"),
width:50,id:"xAxisMin",name:"xAxisMin",margins:"0 0 0 5"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Max"),width:50,id:"xAxisMax",name:"xAxisMax",margins:"0 0 0 5"}]},{xtype:"fieldcontainer",fieldLabel:getText("Y-Axis"),layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"yAxisLabel",name:"yAxisLabel"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Min"),width:50,id:"yAxisMin",name:"yAxisMin",margins:"0 0 0 5"},{hidden:!0,
xtype:"numberfield",fieldLabel:getText("Max"),width:50,id:"yAxisMax",name:"yAxisMax",margins:"0 0 0 5"}]},{xtype:"combo",id:"legendPosition",fieldLabel:getText("Legend Position"),allowBlank:!1,store:[["Automatic",getText("Automatic")],["Top",getText("Top")],["Right",getText("Right")],["Bottom",getText("Bottom")],["Left",getText("Left")],["None",getText("None")]],queryMode:"local",forceSelection:!0},{xtype:"container",layout:"column",anchor:"100%",margin:7,items:[{columnWidth:0.33,xtype:"checkboxfield",
boxLabel:getText("Show Markers"),name:"showMarkers",inputValue:"1",id:"showMarkers"},{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Show Lines"),name:"showLines",inputValue:"1",id:"showLines"},{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Use Areas"),name:"showArea",inputValue:"1",id:"showArea"}]},{xtype:"fieldset",title:getText("Secondary Y-Axis"),defaultType:"textfield",id:"chartSettings2",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"fieldcontainer",fieldLabel:getText("Axis"),
layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"yAxisLabel2",name:"yAxisLabel2"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Min"),width:50,id:"yAxisMin2",name:"yAxisMin2",margins:"0 0 0 5"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Max"),width:50,id:"yAxisMax2",name:"yAxisMax2",margins:"0 0 0 5"}]},Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Data"),name:"chartPrimitives2",id:"chartPrimitives2",
displayField:"pname",valueField:"pid",queryMode:"local",store:displayConfigStore2,emptyText:getText("Select which data to display")})]}]}]})],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){displayConfigWin.hide()}},{iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){var a=displayConfigWin.myDisplay,b=displayConfigWin.myWin;if(Ext.getCmp("chartTitle").validate()&&Ext.getCmp("chartType").validate()&&Ext.getCmp("chartPrimitives").validate()){graph.getModel().beginUpdate();
graph.getModel().execute(new mxCellAttributeChange(a,"name",Ext.getCmp("chartTitle").getValue()));b.tabs.getActiveTab().setTitle(Ext.getCmp("chartTitle").getValue());var c=Ext.getCmp("chartType").getValue();graph.getModel().execute(new mxCellAttributeChange(a,"Type",c));graph.getModel().execute(new mxCellAttributeChange(a,"AutoAddPrimitives",Ext.getCmp("autoAdd").getValue().toString()));graph.getModel().execute(new mxCellAttributeChange(a,"legendPosition",Ext.getCmp("legendPosition").getValue()));
graph.getModel().execute(new mxCellAttributeChange(a,"xAxis",Ext.getCmp("xAxisLabel").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxis",Ext.getCmp("yAxisLabel").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxis2",Ext.getCmp("yAxisLabel2").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"xAxisMin",Ext.getCmp("xAxisMin").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMin",Ext.getCmp("yAxisMin").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,
"yAxisMin2",Ext.getCmp("yAxisMin2").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"xAxisMax",Ext.getCmp("xAxisMax").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMax",Ext.getCmp("yAxisMax").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMax2",Ext.getCmp("yAxisMax2").getValue()));var g=Ext.getCmp("chartPrimitives").getValue();if("Scatterplot"==c)2<g.length?(g.length=2,mxUtils.alert(getText("The primitive list for the scatterplot has been truncated to two items. One for the x-Axis and one for the y-Axis."))):
1==g.length&&mxUtils.alert(getText("You need two primitives to create a scatterplot. One for the x-Axis and one for the y-Axis."));else if("Map"==c){for(var c=!1,h=g.length-1;0<=h;h--)g[h]&&"Agents"!=findID(g[h]).value.nodeName?(g.splice(h,1),c=!0):g[h]||g.splice(h,1);c&&mxUtils.alert(getText("Map charts can only show agent population primitives."))}graph.getModel().execute(new mxCellAttributeChange(a,"Primitives",g.join(",")));graph.getModel().execute(new mxCellAttributeChange(a,"Primitives2",Ext.getCmp("chartPrimitives2").getValue().join(",")));
graph.getModel().execute(new mxCellAttributeChange(a,"showMarkers",Ext.getCmp("showMarkers").getValue().toString()));graph.getModel().execute(new mxCellAttributeChange(a,"showLines",Ext.getCmp("showLines").getValue().toString()));graph.getModel().execute(new mxCellAttributeChange(a,"showArea",Ext.getCmp("showArea").getValue().toString()));b.tabs.getActiveTab().removeAll();for(h=b.displayInformation.maps.length-1;0<=h;h--)b.displayInformation.maps[h].id==a.id&&b.displayInformation.maps.splice(h,1);
for(h=b.displayInformation.histograms.length-1;0<=h;h--)b.displayInformation.histograms[h].id==a.id&&b.displayInformation.histograms.splice(h,1);b.tabs.getActiveTab().add(renderDisplay(a,b.displayInformation));displayConfigWin.hide();graph.getModel().endUpdate()}else mxUtils.alert(getText("Correct the display configuration before applying."))}}]}));for(var b=[],c=0;c<a.displayInformation.displayedIds.length;c++)b.push({pid:a.displayInformation.displayedIds[c],pname:a.displayInformation.displayedHeaders[c]});
b.sort(function(a,b){return a.pname.localeCompare(b.pname)});displayConfigStore.loadData(b);displayConfigStore2.loadData(b);b=a.tabs.getActiveTab().display;Ext.getCmp("chartTitle").setValue(b.getAttribute("name"));Ext.getCmp("chartType").setValue(b.getAttribute("Type"));Ext.getCmp("xAxisLabel").setValue(b.getAttribute("xAxis"));Ext.getCmp("yAxisLabel").setValue(b.getAttribute("yAxis"));Ext.getCmp("yAxisLabel2").setValue(b.getAttribute("yAxis2"));Ext.getCmp("xAxisMin").setValue(b.getAttribute("xAxisMin"));
Ext.getCmp("yAxisMin").setValue(b.getAttribute("yAxisMin"));Ext.getCmp("yAxisMin2").setValue(b.getAttribute("yAxisMin2"));Ext.getCmp("xAxisMax").setValue(b.getAttribute("xAxisMax"));Ext.getCmp("yAxisMax").setValue(b.getAttribute("yAxisMax"));Ext.getCmp("yAxisMax2").setValue(b.getAttribute("yAxisMax2"));Ext.getCmp("legendPosition").setValue(b.getAttribute("legendPosition"));Ext.getCmp("showMarkers").setValue(b.getAttribute("showMarkers"));Ext.getCmp("showLines").setValue(b.getAttribute("showLines"));
Ext.getCmp("showArea").setValue(b.getAttribute("showArea"));Ext.getCmp("autoAdd").setValue(b.getAttribute("AutoAddPrimitives"));Ext.getCmp("chartPrimitives").setValue([]);isUndefined(b.getAttribute("Primitives"))||Ext.getCmp("chartPrimitives").setValue(b.getAttribute("Primitives").split(","));Ext.getCmp("chartPrimitives2").setValue([]);isUndefined(b.getAttribute("Primitives2"))||Ext.getCmp("chartPrimitives2").setValue(b.getAttribute("Primitives2").split(","));displayConfigWin.myDisplay=b;displayConfigWin.myWin=
a;displayConfigWin.show()}
function renderDisplay(a,b){for(var c=a.getAttribute("Type"),d=isDefined(a.getAttribute("Primitives"))?a.getAttribute("Primitives").split(","):[],e=d.length-1;0<=e;e--)inAgent(findID(d[e]))&&d.splice(e,1);for(var f=isDefined(a.getAttribute("Primitives2"))?a.getAttribute("Primitives2").split(","):[],e=f.length-1;0<=e;e--)inAgent(findID(f[e]))&&f.splice(e,1);if(0==d.length||"Scatterplot"==c&&2>d.length)return{xtype:"box",html:"<br/><br/><br/><b><big><center><span style='color:darkgray'>"+getText("No data to display")+
"<br/><br/>Press 'Configure' to select data</span></center></big></b>"};var g,h=[];if("Tabular"==c){h=[{header:getText("Time"),sortable:!0,flex:1,dataIndex:"TimeValue",renderer:function(a){return round(a,9)}}];for(g=0;g<d.length;g++)for(e=0;e<b.ids.length;e++)d[g]==b.ids[e]&&h.push({header:b.headers[e],sortable:!0,flex:1,dataIndex:"series"+e,renderer:b.renderers[e]});return new Ext.grid.GridPanel({store:b.store,columns:h,stripeRows:!0,border:!1,frame:!1,header:!1,dockedItems:[{xtype:"toolbar",dock:"bottom",
items:["->",{xtype:"exporterbutton",downloadName:a.getAttribute("name")}]}]})}if("Time Series"==c){var d=d.concat(f),k=[],l=[],n=[],o=[],p=[],r="#94ae0a,#115fa6,#a61120,#ff8809,#ffd13e,#a61187,#24ad9a,#7c7474,#a66111".split(","),s=0,u=[];if(isTrue(a.getAttribute("showArea"))){var w=[],v=[];for(g=0;g<d.length;g++)for(e=0;e<b.ids.length;e++)if(d[g]==b.ids[e])if(b.renderers[e]){var x=-1==f.indexOf(d[g]);x&&(isGray(b.colors[e])?(u.push(r[s]),s++,s%=r.length):u.push(b.colors[e]),w.push("series"+e),v.push(b.headers[e]))}else h.push(createHistogramChart(b,
e));p.push({highlight:!1,type:"area",axis:"left",xField:"Time",yField:w,title:v,smooth:!1});w="theme"+Math.random();Ext.chart.theme[w]=Ext.extend(Ext.chart.theme.Base,{constructor:function(a){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({colors:u},a))}})}else for(g=0;g<d.length;g++)for(e=0;e<b.ids.length;e++)if(d[g]==b.ids[e])if(b.renderers[e]){var x=-1==f.indexOf(d[g]),B="series"+e,v=null;isGray(b.colors[e])?(v=r[s],s++,s%=r.length):v=b.colors[e];v={stoke:v,fill:v,"stroke-width":3};
isTrue(a.getAttribute("showLines"))||(v.opacity=0,v.stroke="none");x?(n.push(b.headers[e]),k.push(B)):(o.push(b.headers[e]),l.push(B));p.push({type:"line",axis:x?"left":"right",xField:"Time",yField:x?k[k.length-1]:l[l.length-1],title:x?n[n.length-1]:o[o.length-1],showMarkers:isTrue(a.getAttribute("showMarkers")),smooth:!1,style:v,tips:{trackMouse:!0,width:160,renderer:function(a,c){this.setTitle(clean(c.series.title)+":<br/>"+b.times[c.value[0]]+", "+commaStr(c.value[1]))}}})}else h.push(createHistogramChart(b,
e));e=[{type:"Numeric",position:"bottom",fields:"Time",minimum:isUndefined(a.getAttribute("xAxisMin"))?void 0:a.getAttribute("xAxisMin")/(b.times[1]-b.times[0])-b.times[0],maximum:isUndefined(a.getAttribute("xAxisMax"))?void 0:a.getAttribute("xAxisMax")/(b.times[1]-b.times[0])-b.times[0],title:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),n.join(", ")),grid:!0,labelTitle:{font:"12px Verdana"},label:{renderer:function(a){return 1<b.times.length?round(b.times[0]+(b.times[1]-b.times[0])*
a,9):round(a,9)}},getRange:unfilteredRange}];d.length>f.length&&e.push({type:"Numeric",position:"left",minimum:a.getAttribute("yAxisMin"),maximum:a.getAttribute("yAxisMax"),fields:k,grid:!0,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),n.join(", ")),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange});0<f.length&&e.push({minimum:a.getAttribute("yAxis2Min"),maximum:a.getAttribute("yAxis2Max"),type:"Numeric",position:"right",fields:l,grid:d.length==
f.length,title:quickLabel(a.getAttribute("yAxis2"),a.getAttribute("name"),o.join(", ")),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange});g=Ext.create("Ext.chart.Chart",{flex:1,theme:isTrue(a.getAttribute("showArea"))?w:void 0,background:{fill:"#fff"},html:"<div id='scratchpad"+analysisCount+"_"+a.id+"' style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>",xtype:"chart",animate:!1,shadow:!1,store:b.store,axes:e,series:p});"None"!=
a.getAttribute("legendPosition")&&(g.legend=Ext.create("Ext.chart.Legend",{position:"Automatic"==a.getAttribute("legendPosition")?4<d.length?"right":"top":a.getAttribute("legendPosition").toLowerCase(),chart:g,boxStrokeWidth:0,boxStroke:"#fff",itemSpacing:4,padding:0,isVertical:!1}))}else if("Scatterplot"==c){p=[];r=[];for(g=0;g<d.length;g++)for(e=0;e<b.ids.length;e++)d[g]==b.ids[e]&&(b.renderers[e]?(p.push("series"+e),r.push(b.headers[e])):h.push(createHistogramChart(b,e)));v={"stroke-width":3};
isTrue(a.getAttribute("showLines"))||(v.opacity=0,v.stroke="none");g=Ext.create("Ext.chart.Chart",{flex:1,background:{fill:"#fff"},xtype:"chart",animate:!1,html:"<div id='scratchpad"+analysisCount+"_"+a.id+"'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>",shadow:!1,store:b.store,axes:[{minimum:a.getAttribute("xAxisMin"),maximum:a.getAttribute("xAxisMax"),type:"Numeric",position:"bottom",fields:p[0],grid:!0,title:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),
r[0]),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange},{minimum:a.getAttribute("yAxisMin"),maximum:a.getAttribute("yAxisMax"),type:"Numeric",position:"left",fields:p[1],grid:!0,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),r[1]),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange}],series:[{type:"line",axis:"left",xField:p[0],yField:p[1],showMarkers:isTrue(a.getAttribute("showMarkers")),style:v,smooth:!1,tips:{trackMouse:!0,
width:160,renderer:function(a,b){this.setTitle(commaStr(b.value[0])+", "+commaStr(b.value[1]))}}}]})}else if("Map"==c){r="#94ae0a,#115fa6,#a61120,#ff8809,#ffd13e,#a61187,#24ad9a,#7c7474,#a66111".split(",");s=0;u=[];o=[{type:"float",name:"agentIndex"},{type:"string",name:"states"}];p=[];f=[];l=[];n=[];k=[];x=function(a){return function(b,c){this.setTitle("<p><center>"+a+" "+b.get("agentIndex")+"</center></p></p>"+b.get("states")+"</p><p>"+commaStr(c.value[0])+", "+commaStr(c.value[1])+"</p>")}};for(g=
0;g<d.length;g++){var w=d[g],z=b.agents[w];if(isUndefined(z)){alert("Primitive is not an agent population!");return}k.push(z);v=getName(findID(z.item.getAttribute("Agent")));for(B=0;B<z.data.states.length;B++){var A="series_"+w+"_"+z.data.states[B]+"_",J=getName(findID(z.data.states[B]));f.push(A);l.push(A+"x");n.push(A+"y");o.push({type:"float",name:A+"x"});o.push({type:"float",name:A+"y"});for(e=e=0;e<b.colors.length&&!(b.ids[e]==w&&b.headers[e]==J);e++);var y=null;isGray(b.colors[e])?(y=r[s],s++,
s%=r.length):y=b.colors[e];p.push({title:J,animate:!1,type:"line",axis:"left",xField:A+"x",yField:A+"y",showMarkers:!0,style:{"stroke-width":0,opacity:0,stroke:"none"},markerConfig:{type:["circle","triangle","diamond","cross","plus"][g%6],fill:y,radius:5},smooth:!1,tips:{trackMouse:!0,width:160,renderer:x(v)}})}}d=new Ext.data.Store({fields:o});g=Ext.create("Ext.chart.Chart",{background:{fill:"#fff"},flex:1,legend:"None"==a.getAttribute("legendPosition")?!1:{position:"Automatic"==a.getAttribute("legendPosition")?
4<f.length?"right":"top":a.getAttribute("legendPosition").toLowerCase()},xtype:"chart",animate:!1,html:"<div id='scratchpad"+analysisCount+"_"+a.id+"'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>",shadow:!1,store:d,axes:[{type:"Numeric",position:"bottom",fields:l,grid:!1,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),"Position ("+z.item.getAttribute("GeoDimUnits")+")"),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:function(){return{min:0,
max:parseFloat(simpleNum(z.data.width,z.data.units))}}},{type:"Numeric",position:"left",fields:n,grid:!1,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),"Position ("+z.item.getAttribute("GeoDimUnits")+")"),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:function(){return{min:0,max:parseFloat(simpleNum(z.data.height,z.data.units))}}}],series:p});b.maps.push({id:a.id,store:d,agents:k,bases:f,chart:g});buildMapStore(b.maps[b.maps.length-1],b.scripter.time)}if("Tabular"!=
c)return c=[],0<g.series.length&&c.push(g),c=c.concat(h),{xtype:"panel",items:c,layout:1==c.length?"fit":{type:"vbox",align:"stretch"},dockedItems:[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",text:"Download",handler:function(){surpressCloseWarning=!0;this.up("panel").down("chart").save({type:"image/png"})}}]}]}}
function createResultsWindow(a){a.maps=[];a.histograms=[];analysisCount++;var b=primitives("Display"),c=[],d={time:0};a.scripter=d;for(var e=0;e<b.length;e++)c.push({xtype:"panel",title:b[e].getAttribute("name"),items:[renderDisplay(b[e],a)],layout:"fit",display:b[e]});c=new Ext.TabPanel({activeTab:0,flex:1,deferredRender:!1,frame:!1,border:!1,enableTabScroll:!0,defaults:{autoScroll:!0},items:c});d.store=a.store;d.maps=a.maps;d.histograms=a.histograms;d.updatingSlider=!1;d.timeIndex=0;d.maxTime=a.times.length-
1;d.minTime=0;d.timeStep=2;d.times=a.times;d.slider=Ext.create("Ext.form.SliderField",{minValue:0,animate:!1,hideLabel:!0,maxValue:d.maxTime,flex:1,step:d.timeStep,margins:"0 10 0 10",useTips:!0,tipText:function(a){return""+a.slider.s.times[a.slider.getValue()]}});d.combo=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",labelWidth:0,allowBlank:!1,store:[[0.2,"0.2 x Normal"],[0.5,"0.5 x Normal"],[1,"Normal Speed"],[1.5,"1.5 x Normal"],[2,"2 x Normal"],[5,"5 x Normal"],[10,"10 x Normal"],[-1,"Full Speed"]],
queryMode:"local",value:parseFloat(getSetting().getAttribute("Throttle")),width:102,forceSelection:!0,listeners:{select:function(a){graph.getModel().beginUpdate();a=new mxCellAttributeChange(getSetting(),"Throttle",a.getValue());graph.getModel().execute(a);graph.getModel().endUpdate()}}});d.slider.s=d;d.slider.on("change",function(a,b){this.s.updatingSlider||this.s.loadTime(b)});d.playBut=Ext.create("Ext.button.Button",{scale:"medium",allowDepress:!0,enableToggle:!0,pressed:!0,icon:builder_path+"/images/pause.png"});
d.playBut.s=d;d.animInter=-1;d.playBut.on("toggle",function(a,b){if(b){this.s.slider.getValue()==this.s.maxTime&&this.s.slider.setValue(this.s.minTime);this.s.playBut.setIcon(builder_path+"/images/pause.png");this.s.advanceTimer();var c=this;this.s.animInter=setInterval(function(){c.s.advanceTimer()},-1==this.s.combo.getValue()?200:100/Math.min(0.5,this.s.combo.getValue()))}else this.s.playBut.setIcon(builder_path+"/images/play.png"),clearInterval(this.s.animInter)});d.advanceTimer=function(){this.slider.getValue()<
this.maxTime?this.loadTime(Math.min(this.maxTime,this.slider.getValue()+this.timeStep*Math.max(0.5,this.combo.getValue()))):this.playBut.toggle()};d.loadTime=function(a){this.store.clearFilter(!0);this.time=a;this.store.filter([{filterFn:function(b){return b.get("Time")<=a}}]);this.maps.forEach(function(b){buildMapStore(b,a)});this.histograms.forEach(function(b){buildHistogramStore(b,a)});this.updatingSlider=!0;this.slider.setValue(a);this.updatingSlider=!1};-1!=d.combo.getValue()&&!doFullSpeed?(d.loadTime(1),
d.animInter=setInterval(function(){d.advanceTimer()},-1==d.combo.getValue()?200:100/Math.min(0.5,d.combo.getValue()))):(d.loadTime(d.maxTime),d.playBut.toggle());var f=new Ext.Window({title:"Simulation Results "+analysisCount,analysisCount:analysisCount,scratchPadStatus:{},closable:!0,displays:b,tabs:c,maximized:is_embed,expandedState:!0,displayInformation:a,minWidth:450,minHeight:400,width:580,height:is_embed?400:is_editor?500:490,resizable:!0,maximizable:!0,minimizable:!0,layout:{type:"vbox",align:"stretch"},
items:[c,{xtype:"container",layout:{type:"hbox",align:"middle"},margins:"5 3 10 10",items:[d.playBut,d.slider,d.combo]}],dockedItems:[{xtype:"toolbar",dock:"top",hidden:!is_editor,items:[{iconCls:"add-icon",scale:"large",text:"Add Display",handler:function(){var a=graph.getDefaultParent(),b=this.findParentByType("window");graph.getModel().beginUpdate();a=graph.insertVertex(a,null,primitiveBank.display.cloneNode(!0),10,10,64,64,"display");a.visible=!1;graph.getModel().endUpdate();b.displays.push(a);
b.tabs.add({title:a.getAttribute("name"),items:[renderDisplay(a,b.displayInformation)],layout:"fit",display:a});b.tabs.setActiveTab(primitives("Display").length-1);openDisplayConfigure(b)}},{scale:"large",iconCls:"big-delete-icon",text:"Delete Display",handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab());graph.getModel().beginUpdate();graph.removeCells([a.displays[c]],!1);graph.getModel().endUpdate();a.displays.splice(c,
1);b.remove(b.getActiveTab())}else mxUtils.alert(getText("No chart or table to delete."))}},{scale:"large",iconCls:"leftarrow-icon",text:"",tooltip:getText("Move display to the left."),handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab()),d=a.displays[c];graph.orderCells(!0,[d]);var e=b.getActiveTab();a.displays.splice(c,1);a.displays=[d].concat(a.displays);b.remove(e,!1);b.insert(0,e);b.setActiveTab(e)}else mxUtils.alert(getText("No chart or table to reorder."))}},
{scale:"large",iconCls:"rightarrow-icon",text:"",tooltip:getText("Move display to the right."),handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab()),d=a.displays[c];graph.orderCells(!1,[d]);a.displays.splice(c,1);a.displays.push(d);a=b.getActiveTab();b.remove(a,!1);b.add(a);b.setActiveTab(a)}else mxUtils.alert(getText("No chart or table to reorder."))}},"->",{scale:"large",iconCls:"scratchpad-large-icon",text:getText("Scratchpad"),
handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,b=b.items.indexOf(b.getActiveTab()),b=a.displays[b];if("Tabular"!=b.getAttribute("Type")){b="scratchpad"+a.analysisCount+"_"+b.id;"shown"==a.scratchPadStatus[b]?(Ext.get(b).setDisplayed("none"),a.scratchPadStatus[b]="hidden"):("hidden"==a.scratchPadStatus[b]?Ext.get(b).setDisplayed("block"):(Ext.get(b).setDisplayed("block"),Scratchpad($("#"+b))),a.scratchPadStatus[b]="shown");return}}mxUtils.alert(getText("Scratchpads can only be shown for charts."))}},
{scale:"large",iconCls:"configure-icon",text:getText("Configure"),handler:function(){var a=this.findParentByType("window");0<a.displays.length?openDisplayConfigure(a):mxUtils.alert(getText("Add a chart or table to configure it."))}}]}]});f.on("minimize",function(a){a.expandedState?(a.expandedState=!1,a.collapse()):(a.expandedState=!0,f.expand())});resultsWindows.push(f);f.show();return f}
function buildMapStore(a,b){function c(){for(var b={agentIndex:o+1,states:p},c=0;c<a.bases.length;c++)b[a.bases[c]+"x"]=k,b[a.bases[c]+"y"]=l;return b}for(var d=[],e={},f={},g=0;g<a.agents.length;g++)for(var h=a.agents[g],k=-parseFloat(simpleNum(h.data.width,h.data.units)),l=-parseFloat(simpleNum(h.data.height,h.data.units)),n=a.agents[g].results[b].current,o=0;o<n.length;o++)if(f[n[o].instanceId]=n[o].location,e[n[o].instanceId]=n[o].connected,null!==n[o].state)for(var p=n[o].state.map(function(a){return a.name}).join(", "),
r=0;r<n[o].state.length;r++){var s=c(),u="series_"+h.id+"_"+n[o].state[r].id+"_";s[u+"x"]=n[o].location.items[0];s[u+"y"]=n[o].location.items[1];d.push(s)}var h={},w;for(w in e)for(g=0;g<e[w].length;g++)n=[w,e[w][g]].sort().join("__"),h[n]||(h[n]=[f[w],f[e[w][g]]]);a.chart.links=h;a.store.loadData(d)}function buildHistogramStore(a,b){a.store.loadData(createHistogramData(a.data[b],a.min,a.max))}
function createHistogramChart(a,b){var c=new Ext.data.JsonStore({fields:[{name:"Label",type:"string"},{name:"Count",type:"float"}],data:[]}),d={store:c,data:a.res[a.ids[b]].results},e=d.data;try{d.min=Math.floor(0+functionBank.min(e).value),d.max=Math.ceil(0+functionBank.max(e).value)}catch(f){d.min=-1,d.max=1}isNaN(d.min)&&(d.min=-1,d.max=1);d.min==d.max&&(d.min-=1,d.max+=1);c=Ext.create("Ext.chart.Chart",{xtype:"chart",flex:1,animate:!1,shadow:!1,store:c,axes:[{type:"Category",position:"bottom",
fields:["Label"],labelTitle:{font:"12px Verdana"},title:a.headers[b]},{type:"Numeric",position:"left",fields:"Count",decimals:0,minimum:0}],series:[{type:"column",xField:"Label",yField:"Count",gutter:5,tips:{trackMouse:!0,width:80,renderer:function(a,b){this.setTitle("<center>"+commaStr(b.value[1])+"</center>")}}}]});buildHistogramStore(d,a.scripter.time);a.histograms.push(d);return c}
function createHistogramData(a,b,c){for(var d=[],c=(c-b)/20,e=0;20>e;e++)d.push({Label:round(b+c/2+c*e,9),Count:0});for(e=0;e<a.items.length;e++){var f=0+a.items[e].value;isNaN(f)||(f=Math.max(0,Math.min(19,Math.round((f-b)/c-0.5))),d[f].Count+=1)}return d};(function(a,b){function c(a){var b=cb[a]={};return q.each(a.split(ta),function(a,c){b[c]=!0}),b}function d(a,c,d){if(d===b&&1===a.nodeType)if(d="data-"+c.replace(db,"-$1").toLowerCase(),d=a.getAttribute(d),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:wb.test(d)?q.parseJSON(d):d}catch(e){}q.data(a,c,d)}else d=b;return d}function e(a){for(var b in a)if(!("data"===b&&q.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function f(){return!1}function g(){return!0}
function h(a){return!a||!a.parentNode||11===a.parentNode.nodeType}function k(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function l(a,b,c){b=b||0;if(q.isFunction(b))return q.grep(a,function(a,d){return!!b.call(a,d,a)===c});if(b.nodeType)return q.grep(a,function(a){return a===b===c});if("string"==typeof b){var d=q.grep(a,function(a){return 1===a.nodeType});if(xb.test(b))return q.filter(b,d,!c);b=q.filter(b,d)}return q.grep(a,function(a){return 0<=q.inArray(a,b)===c})}function n(a){var b=Ja.split("|"),
a=a.createDocumentFragment();if(a.createElement)for(;b.length;)a.createElement(b.pop());return a}function o(a,b){if(1===b.nodeType&&q.hasData(a)){var c,d,e;d=q._data(a);var f=q._data(b,d),g=d.events;if(g)for(c in delete f.handle,f.events={},g)for(d=0,e=g[c].length;d<e;d++)q.event.add(b,c,g[c][d]);f.data&&(f.data=q.extend({},f.data))}}function p(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?(b.parentNode&&
(b.outerHTML=a.outerHTML),q.support.html5Clone&&a.innerHTML&&!q.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&ja.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.selected=a.defaultSelected:"input"===c||"textarea"===c?b.defaultValue=a.defaultValue:"script"===c&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(q.expando))}function r(a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!=typeof a.querySelectorAll?
a.querySelectorAll("*"):[]}function s(a){ja.test(a.type)&&(a.defaultChecked=a.checked)}function u(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=eb.length;e--;)if(b=eb[e]+c,b in a)return b;return d}function w(a,b){return a=b||a,"none"===q.css(a,"display")||!q.contains(a.ownerDocument,a)}function v(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)c=a[f],c.style&&(e[f]=q._data(c,"olddisplay"),b?(!e[f]&&"none"===c.style.display&&(c.style.display=""),""===c.style.display&&w(c)&&
(e[f]=q._data(c,"olddisplay",A(c.nodeName)))):(d=ea(c,"display"),!e[f]&&"none"!==d&&q._data(c,"olddisplay",d)));for(f=0;f<g;f++)if(c=a[f],c.style&&(!b||"none"===c.style.display||""===c.style.display))c.style.display=b?e[f]||"":"none";return a}function x(a,b,c){return(a=ka.exec(b))?Math.max(0,a[1]-(c||0))+(a[2]||"px"):b}function B(a,b,c,d){for(var b=c===(d?"border":"content")?4:"width"===b?1:0,e=0;4>b;b+=2)"margin"===c&&(e+=q.css(a,c+ua[b],!0)),d?("content"===c&&(e-=parseFloat(ea(a,"padding"+ua[b]))||
0),"margin"!==c&&(e-=parseFloat(ea(a,"border"+ua[b]+"Width"))||0)):(e+=parseFloat(ea(a,"padding"+ua[b]))||0,"padding"!==c&&(e+=parseFloat(ea(a,"border"+ua[b]+"Width"))||0));return e}function z(a,b,c){var d="width"===b?a.offsetWidth:a.offsetHeight,e=!0,f=q.support.boxSizing&&"border-box"===q.css(a,"boxSizing");if(0>=d){d=ea(a,b);if(0>d||null==d)d=a.style[b];if(va.test(d))return d;e=f&&(q.support.boxSizingReliable||d===a.style[b]);d=parseFloat(d)||0}return d+B(a,b,c||(f?"border":"content"),e)+"px"}
function A(a){if(Ba[a])return Ba[a];var b=q("<"+a+">").appendTo(K.body),c=b.css("display");b.remove();if("none"===c||""===c){M=K.body.appendChild(M||q.extend(K.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!V||!M.createElement)V=(M.contentWindow||M.contentDocument).document,V.write("<!doctype html><html><body>"),V.close();b=V.body.appendChild(V.createElement(a));c=ea(b,"display");K.body.removeChild(M)}return Ba[a]=c,c}function J(a,b,c,d){var e;if(q.isArray(b))q.each(b,function(b,e){c||
Ra.test(a)?d(a,e):J(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(!c&&"object"===q.type(b))for(e in b)J(a+"["+e+"]",b[e],c,d);else d(a,b)}function y(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(ta),h=0,k=g.length;if(q.isFunction(c))for(;h<k;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function D(a,c,d,e,f,g){f=f||c.dataTypes[0];g=g||{};g[f]=!0;for(var h,f=a[f],k=0,l=f?f.length:0,n=a===yb;k<l&&(n||!h);k++)h=
f[k](c,d,e),"string"==typeof h&&(!n||g[h]?h=b:(c.dataTypes.unshift(h),h=D(a,c,d,e,h,g)));return(n||!h)&&!g["*"]&&(h=D(a,c,d,e,"*",g)),h}function E(a,c){var d,e,f=q.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&q.extend(!0,a,e)}function C(){try{return new a.XMLHttpRequest}catch(b){}}function F(){return setTimeout(function(){fb=b},0),fb=q.now()}function I(a,b){q.each(b,function(b,c){for(var d=(Sa[b]||[]).concat(Sa["*"]),e=0,f=d.length;e<f&&!d[e].call(a,b,c);e++);
})}function P(a,b,c){var d=0,e=gb.length,f=q.Deferred().always(function(){delete g.elem}),g=function(){for(var b=fb||F(),b=Math.max(0,h.startTime+h.duration-b),c=1-(b/h.duration||0),d=0,e=h.tweens.length;d<e;d++)h.tweens[d].run(c);return f.notifyWith(a,[h,c,b]),1>c&&e?b:(f.resolveWith(a,[h]),!1)},h=f.promise({elem:a,props:q.extend({},b),opts:q.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:fb||F(),duration:c.duration,tweens:[],createTween:function(b,c){var d=q.Tween(a,
h.opts,b,c,h.opts.specialEasing[b]||h.opts.easing);return h.tweens.push(d),d},stop:function(b){for(var c=0,d=b?h.tweens.length:0;c<d;c++)h.tweens[c].run(1);return b?f.resolveWith(a,[h,b]):f.rejectWith(a,[h,b]),this}}),c=h.props;for(H(c,h.opts.specialEasing);d<e;d++)if(b=gb[d].call(h,a,c,h.opts))return b;return I(h,c),q.isFunction(h.opts.start)&&h.opts.start.call(a,h),q.fx.timer(q.extend(g,{anim:h,queue:h.opts.queue,elem:a})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}
function H(a,b){var c,d,e,f,g;for(c in a)if(d=q.camelCase(c),e=b[d],f=a[c],q.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=q.cssHooks[d],g&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}function N(a,b,c,d,e){return new N.prototype.init(a,b,c,d,e)}function L(a,b){for(var c,d={height:a},e=0;4>e;e+=2-b)c=ua[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function S(a){return q.isWindow(a)?a:9===a.nodeType?a.defaultView||
a.parentWindow:!1}var O,Q,K=a.document,ba=a.location,X=a.navigator,G=a.jQuery,ca=a.$,T=Array.prototype.push,R=Array.prototype.slice,aa=Array.prototype.indexOf,na=Object.prototype.toString,oa=Object.prototype.hasOwnProperty,la=String.prototype.trim,q=function(a,b){return new q.fn.init(a,b,O)},sa=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,pa=/\S/,ta=/\s+/,Za=pa.test("\u00c2 ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,Aa=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,$a=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,tb=
/^[\],:{}\s]*$/,ub=/(?:^|:|,)(?:\s*\[)+/g,Oa=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ab=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,Pa=/^-ms-/,bb=/-([\da-z])/gi,Qa=function(a,b){return(b+"").toUpperCase()},wa=function(){K.addEventListener?(K.removeEventListener("DOMContentLoaded",wa,!1),q.ready()):"complete"===K.readyState&&(K.detachEvent("onreadystatechange",wa),q.ready())},Ca={};q.fn=q.prototype={constructor:q,init:function(a,c,d){var e,f;if(!a)return this;if(a.nodeType)return this.context=
this[0]=a,this.length=1,this;if("string"==typeof a){"<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?e=[null,a,null]:e=Aa.exec(a);if(e&&(e[1]||!c)){if(e[1])return c=c instanceof q?c[0]:c,f=c&&c.nodeType?c.ownerDocument||c:K,a=q.parseHTML(e[1],f,!0),$a.test(e[1])&&q.isPlainObject(c)&&this.attr.call(a,c,!0),q.merge(this,a);if((c=K.getElementById(e[2]))&&c.parentNode){if(c.id!==e[2])return d.find(a);this.length=1;this[0]=c}return this.context=K,this.selector=a,this}return!c||c.jquery?(c||d).find(a):
this.constructor(c).find(a)}return q.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),q.makeArray(a,this))},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return R.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a,b,c){a=q.merge(this.constructor(),a);return a.prevObject=this,a.context=this.context,"find"===b?a.selector=this.selector+(this.selector?" ":
"")+c:b&&(a.selector=this.selector+"."+b+"("+c+")"),a},each:function(a,b){return q.each(this,a,b)},ready:function(a){return q.ready.promise().done(a),this},eq:function(a){return a=+a,-1===a?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(R.apply(this,arguments),"slice",R.call(arguments).join(","))},map:function(a){return this.pushStack(q.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||
this.constructor(null)},push:T,sort:[].sort,splice:[].splice};q.fn.init.prototype=q.fn;q.extend=q.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},k=1,l=arguments.length,n=!1;for("boolean"==typeof h&&(n=h,h=arguments[1]||{},k=2),"object"!=typeof h&&!q.isFunction(h)&&(h={}),l===k&&(h=this,--k);k<l;k++)if(null!=(a=arguments[k]))for(c in a)d=h[c],e=a[c],h!==e&&(n&&e&&(q.isPlainObject(e)||(f=q.isArray(e)))?(f?(f=!1,g=d&&q.isArray(d)?d:[]):g=d&&q.isPlainObject(d)?d:{},h[c]=q.extend(n,g,e)):e!==
b&&(h[c]=e));return h};q.extend({noConflict:function(b){return a.$===q&&(a.$=ca),b&&a.jQuery===q&&(a.jQuery=G),q},isReady:!1,readyWait:1,holdReady:function(a){a?q.readyWait++:q.ready(!0)},ready:function(a){if(!(!0===a?--q.readyWait:q.isReady)){if(!K.body)return setTimeout(q.ready,1);q.isReady=!0;!0!==a&&0<--q.readyWait||(Q.resolveWith(K,[q]),q.fn.trigger&&q(K).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===q.type(a)},isArray:Array.isArray||function(a){return"array"===q.type(a)},
isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?""+a:Ca[na.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==q.type(a)||a.nodeType||q.isWindow(a))return!1;try{if(a.constructor&&!oa.call(a,"constructor")&&!oa.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var d in a);return d===b||oa.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw Error(a);
},parseHTML:function(a,b,c){var d;return!a||"string"!=typeof a?null:("boolean"==typeof b&&(c=b,b=0),b=b||K,(d=$a.exec(a))?[b.createElement(d[1])]:(d=q.buildFragment([a],b,c?null:[]),q.merge([],(d.cacheable?q.clone(d.fragment):d.fragment).childNodes)))},parseJSON:function(b){if(!b||"string"!=typeof b)return null;b=q.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(tb.test(b.replace(Oa,"@").replace(ab,"]").replace(ub,"")))return(new Function("return "+b))();q.error("Invalid JSON: "+b)},parseXML:function(c){var d,
e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&q.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&pa.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(Pa,"ms-").replace(bb,Qa)},nodeName:function(a,b){return a.nodeName&&
a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||q.isFunction(a);if(d)if(h)for(e in a){if(!1===c.apply(a[e],d))break}else for(;f<g&&!(!1===c.apply(a[f++],d)););else if(h)for(e in a){if(!1===c.call(a[e],e,a[e]))break}else for(;f<g&&!(!1===c.call(a[f],f,a[f++])););return a},trim:la?function(a){return null==a?"":la.call(a)}:function(a){return null==a?"":a.toString().replace(Za,"")},makeArray:function(a,b){var c,d=b||[];return null!=a&&(c=q.type(a),null==
a.length||"string"===c||"function"===c||"regexp"===c||q.isWindow(a)?T.call(d,a):q.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(aa)return aa.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;f<d;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,c=!!c;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);
return e},map:function(a,c,d){var e,f,g=[],h=0,k=a.length;if(a instanceof q||k!==b&&"number"==typeof k&&(0<k&&a[0]&&a[k-1]||0===k||q.isArray(a)))for(;h<k;h++)e=c(a[h],h,d),null!=e&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),null!=e&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),q.isFunction(a)?(e=R.call(arguments,2),f=function(){return a.apply(c,e.concat(R.call(arguments)))},f.guid=a.guid=a.guid||f.guid||q.guid++,f):
b},access:function(a,c,d,e,f,g,h){var k,l=null==d,n=0,o=a.length;if(d&&"object"==typeof d){for(n in d)q.access(a,c,n,d[n],1,g,e);f=1}else if(e!==b){k=h===b&&q.isFunction(e);l&&(k?(k=c,c=function(a,b,c){return k.call(q(a),c)}):(c.call(a,e),c=null));if(c)for(;n<o;n++)c(a[n],d,k?e.call(a[n],n,c(a[n],d)):e,h);f=1}return f?a:l?c.call(a):o?c(a[0],d):g},now:function(){return(new Date).getTime()}});q.ready.promise=function(b){if(!Q)if(Q=q.Deferred(),"complete"===K.readyState||"loading"!==K.readyState&&K.addEventListener)setTimeout(q.ready,
1);else if(K.addEventListener)K.addEventListener("DOMContentLoaded",wa,!1),a.addEventListener("load",q.ready,!1);else{K.attachEvent("onreadystatechange",wa);a.attachEvent("onload",q.ready);var c=!1;try{c=null==a.frameElement&&K.documentElement}catch(d){}c&&c.doScroll&&function Nb(){if(!q.isReady){try{c.doScroll("left")}catch(a){return setTimeout(Nb,50)}q.ready()}}()}return Q.promise(b)};q.each("Boolean,Number,String,Function,Array,Date,RegExp,Object".split(","),function(a,b){Ca["[object "+b+"]"]=
b.toLowerCase()});O=q(K);var cb={};q.Callbacks=function(a){var a="string"==typeof a?cb[a]||c(a):q.extend({},a),d,e,f,g,h,k,l=[],n=!a.once&&[],o=function(b){for(d=a.memory&&b,e=!0,k=g||0,g=0,h=l.length,f=!0;l&&k<h;k++)if(!1===l[k].apply(b[0],b[1])&&a.stopOnFalse){d=!1;break}f=!1;l&&(n?n.length&&o(n.shift()):d?l=[]:p.disable())},p={add:function(){if(l){var b=l.length;(function Ob(b){q.each(b,function(b,c){q.isFunction(c)&&(!a.unique||!p.has(c))?l.push(c):c&&c.length&&Ob(c)})})(arguments);f?h=l.length:
d&&(g=b,o(d))}return this},remove:function(){return l&&q.each(arguments,function(a,b){for(var c;-1<(c=q.inArray(b,l,c));)l.splice(c,1),f&&(c<=h&&h--,c<=k&&k--)}),this},has:function(a){return-1<q.inArray(a,l)},empty:function(){return l=[],this},disable:function(){return l=n=d=b,this},disabled:function(){return!l},lock:function(){return n=b,d||p.disable(),this},locked:function(){return!n},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],l&&(!e||n)&&(f?n.push(b):o(b)),this},fire:function(){return p.fireWith(this,
arguments),this},fired:function(){return!!e}};return p};q.extend({Deferred:function(a){var b=[["resolve","done",q.Callbacks("once memory"),"resolved"],["reject","fail",q.Callbacks("once memory"),"rejected"],["notify","progress",q.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return q.Deferred(function(c){q.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]](q.isFunction(g)?function(){var a=
g.apply(this,arguments);a&&q.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])});a=null}).promise()},promise:function(a){return"object"==typeof a?q.extend(a,d):d}},e={};return d.pipe=d.then,q.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add;h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock);e[f[0]]=g.fire;e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=R.call(arguments),d=c.length,
e=1!==d||a&&q.isFunction(a.promise)?d:0,f=1===e?a:q.Deferred(),g=function(a,b,c){return function(d){b[a]=this;c[a]=1<arguments.length?R.call(arguments):d;c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,k,l;if(1<d)for(h=Array(d),k=Array(d),l=Array(d);b<d;b++)c[b]&&q.isFunction(c[b].promise)?c[b].promise().done(g(b,l,c)).fail(f.reject).progress(g(b,k,h)):--e;return e||f.resolveWith(l,c),f.promise()}});q.support=function(){var b,c,d,e,f,g,h,k,l,n,o,p=K.createElement("div");p.setAttribute("className",
"t");p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";c=p.getElementsByTagName("*");d=p.getElementsByTagName("a")[0];d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length||!d)return{};e=K.createElement("select");f=e.appendChild(K.createElement("option"));g=p.getElementsByTagName("input")[0];b={leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),
hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:"on"===g.value,optSelected:f.selected,getSetAttribute:"t"!==p.className,enctype:!!K.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===K.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,
pixelPosition:!1};g.checked=!0;b.noCloneChecked=g.cloneNode(!0).checked;e.disabled=!0;b.optDisabled=!f.disabled;try{delete p.test}catch(M){b.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",o=function(){b.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",o));g=K.createElement("input");g.value="t";g.setAttribute("type","radio");b.radioValue="t"===g.value;g.setAttribute("checked","checked");g.setAttribute("name","t");p.appendChild(g);
h=K.createDocumentFragment();h.appendChild(p.lastChild);b.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked;b.appendChecked=g.checked;h.removeChild(g);h.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})k="on"+l,n=k in p,n||(p.setAttribute(k,"return;"),n="function"==typeof p[k]),b[l+"Bubbles"]=n;return q(function(){var c,d,e,f,g=K.getElementsByTagName("body")[0];g&&(c=K.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",
g.insertBefore(c,g.firstChild),d=K.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=d.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",n=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=n&&0===e[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",
b.boxSizing=4===d.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==g.offsetTop,a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(d,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(d,null)||{width:"4px"}).width,f=K.createElement("div"),f.style.cssText=d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((a.getComputedStyle(f,null)||{}).marginRight)),
"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),g.removeChild(c))}),h.removeChild(p),c=d=e=f=g=h=p=null,b}();var wb=/^(?:\{.*\}|\[.*\])$/,db=/([A-Z])/g;q.extend({cache:{},deletedIds:[],
uuid:0,expando:"jQuery"+(q.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?q.cache[a[q.expando]]:a[q.expando],!!a&&!e(a)},data:function(a,c,d,e){if(q.acceptData(a)){var f,g,h=q.expando,k="string"==typeof c,l=a.nodeType,n=l?q.cache:a,o=l?a[h]:a[h]&&h;if(o&&n[o]&&(e||n[o].data)||!(k&&d===b)){o||(l?a[h]=o=q.deletedIds.pop()||++q.uuid:o=h);n[o]||(n[o]={},l||(n[o].toJSON=q.noop));if("object"==
typeof c||"function"==typeof c)e?n[o]=q.extend(n[o],c):n[o].data=q.extend(n[o].data,c);return f=n[o],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[q.camelCase(c)]=d),k?(g=f[c],null==g&&(g=f[q.camelCase(c)])):g=f,g}}},removeData:function(a,b,c){if(q.acceptData(a)){var d,f,g,h=a.nodeType,k=h?q.cache:a,l=h?a[q.expando]:q.expando;if(k[l]){if(b&&(d=c?k[l]:k[l].data)){q.isArray(b)||(b in d?b=[b]:(b=q.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(f=0,g=b.length;f<g;f++)delete d[b[f]];if(!(c?e:q.isEmptyObject)(d))return}if(!c&&
(delete k[l].data,!e(k[l])))return;h?q.cleanData([a],!0):q.support.deleteExpando||k!=k.window?delete k[l]:k[l]=null}}},_data:function(a,b,c){return q.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&q.noData[a.nodeName.toLowerCase()];return!b||!0!==b&&a.getAttribute("classid")===b}});q.fn.extend({data:function(a,c){var e,f,g,h,k,l=this[0],n=0,o=null;if(a===b){if(this.length&&(o=q.data(l),1===l.nodeType&&!q._data(l,"parsedAttrs"))){g=l.attributes;for(k=g.length;n<k;n++)h=g[n].name,0===h.indexOf("data-")&&
(h=q.camelCase(h.substring(5)),d(l,h,o[h]));q._data(l,"parsedAttrs",!0)}return o}return"object"==typeof a?this.each(function(){q.data(this,a)}):(e=a.split(".",2),e[1]=e[1]?"."+e[1]:"",f=e[1]+"!",q.access(this,function(c){if(c===b)return o=this.triggerHandler("getData"+f,[e[0]]),o===b&&l&&(o=q.data(l,a),o=d(l,a,o)),o===b&&e[1]?this.data(e[0]):o;e[1]=c;this.each(function(){var b=q(this);b.triggerHandler("setData"+f,e);q.data(this,a,c);b.triggerHandler("changeData"+f,e)})},null,c,1<arguments.length,
null,!1))},removeData:function(a){return this.each(function(){q.removeData(this,a)})}});q.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=q._data(a,b),c&&(!d||q.isArray(c)?d=q._data(a,b,q.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){var b=b||"fx",c=q.queue(a,b),d=c.shift(),e=q._queueHooks(a,b),f=function(){q.dequeue(a,b)};"inprogress"===d&&(d=c.shift());d&&("fx"===b&&c.unshift("inprogress"),delete e.stop,d.call(a,f,e));!c.length&&e&&e.empty.fire()},_queueHooks:function(a,
b){var c=b+"queueHooks";return q._data(a,c)||q._data(a,c,{empty:q.Callbacks("once memory").add(function(){q.removeData(a,b+"queue",!0);q.removeData(a,c,!0)})})}});q.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?q.queue(this[0],a):c===b?this:this.each(function(){var b=q.queue(this,a,c);q._queueHooks(this,a);"fx"===a&&"inprogress"!==b[0]&&q.dequeue(this,a)})},dequeue:function(a){return this.each(function(){q.dequeue(this,a)})},delay:function(a,
b){return a=q.fx?q.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=q.Deferred(),g=this,h=this.length,k=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)(d=q._data(g[h],a+"queueHooks"))&&d.empty&&(e++,d.empty.add(k));return k(),f.promise(c)}});var qa,Ta,Ua,za=/[\t\r\n]/g,zb=/\r/g,hb=/^(?:button|input)$/i,ib=
/^(?:button|input|object|select|textarea)$/i,jb=/^a(?:rea|)$/i,Da=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,kb=q.support.getSetAttribute;q.fn.extend({attr:function(a,b){return q.access(this,q.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){q.removeAttr(this,a)})},prop:function(a,b){return q.access(this,q.prop,a,b,1<arguments.length)},removeProp:function(a){return a=q.propFix[a]||a,
this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(q.isFunction(a))return this.each(function(b){q(this).addClass(a.call(this,b,this.className))});if(a&&"string"==typeof a){b=a.split(ta);for(c=0,d=this.length;c<d;c++)if(e=this[c],1===e.nodeType)if(!e.className&&1===b.length)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=q.trim(f)}}return this},removeClass:function(a){var c,
d,e,f,g,h,k;if(q.isFunction(a))return this.each(function(b){q(this).removeClass(a.call(this,b,this.className))});if(a&&"string"==typeof a||a===b){c=(a||"").split(ta);for(h=0,k=this.length;h<k;h++)if(e=this[h],1===e.nodeType&&e.className){d=(" "+e.className+" ").replace(za," ");for(f=0,g=c.length;f<g;f++)for(;-1<d.indexOf(" "+c[f]+" ");)d=d.replace(" "+c[f]+" "," ");e.className=a?q.trim(d):""}}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return q.isFunction(a)?this.each(function(c){q(this).toggleClass(a.call(this,
c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=q(this),h=b,k=a.split(ta);e=k[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else if("undefined"===c||"boolean"===c)this.className&&q._data(this,"__className__",this.className),this.className=this.className||!1===a?"":q._data(this,"__className__")||""})},hasClass:function(a){for(var a=" "+a+" ",b=0,c=this.length;b<c;b++)if(1===this[b].nodeType&&-1<(" "+this[b].className+" ").replace(za," ").indexOf(a))return!0;
return!1},val:function(a){var c,d,e,f=this[0];if(arguments.length)return e=q.isFunction(a),this.each(function(d){var f,g=q(this);if(1===this.nodeType&&(e?f=a.call(this,d,g.val()):f=a,null==f?f="":"number"==typeof f?f+="":q.isArray(f)&&(f=q.map(f,function(a){return null==a?"":a+""})),c=q.valHooks[this.type]||q.valHooks[this.nodeName.toLowerCase()],!c||!("set"in c)||c.set(this,f,"value")===b))this.value=f});if(f)return c=q.valHooks[f.type]||q.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,
"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(zb,""):null==d?"":d)}});q.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d=a.selectedIndex,e=[],f=a.options,g="select-one"===a.type;if(0>d)return null;for(a=g?d:0,c=g?d+1:f.length;a<c;a++)if(b=f[a],b.selected&&(q.support.optDisabled?!b.disabled:null===b.getAttribute("disabled"))&&(!b.parentNode.disabled||!q.nodeName(b.parentNode,"optgroup"))){b=q(b).val();
if(g)return b;e.push(b)}return g&&!e.length&&f.length?q(f[d]).val():e},set:function(a,b){var c=q.makeArray(b);return q(a).find("option").each(function(){this.selected=0<=q.inArray(q(this).val(),c)}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,k=a.nodeType;if(a&&!(3===k||8===k||2===k)){if(e&&q.isFunction(q.fn[c]))return q(a)[c](d);if("undefined"==typeof a.getAttribute)return q.prop(a,c,d);h=1!==k||!q.isXMLDoc(a);h&&(c=c.toLowerCase(),g=q.attrHooks[c]||(Da.test(c)?
Ta:qa));if(d!==b){if(null===d){q.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&h&&null!==(f=g.get(a,c))?f:(f=a.getAttribute(c),null===f?b:f)}},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&1===a.nodeType)for(d=b.split(ta);g<d.length;g++)e=d[g],e&&(c=q.propFix[e]||e,f=Da.test(e),f||q.attr(a,e,""),a.removeAttribute(kb?e:c),f&&c in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(hb.test(a.nodeName)&&a.parentNode)q.error("type property can't be changed");
else if(!q.support.radioValue&&"radio"===b&&q.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return qa&&q.nodeName(a,"button")?qa.get(a,b):b in a?a.value:null},set:function(a,b,c){if(qa&&q.nodeName(a,"button"))return qa.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",
usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;return!a||3===h||8===h||2===h?void 0:(g=1!==h||!q.isXMLDoc(a),g&&(c=q.propFix[c]||c,f=q.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c])},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):ib.test(a.nodeName)||jb.test(a.nodeName)&&a.href?0:b}}}});Ta={get:function(a,
c){var d,e=q.prop(a,c);return!0===e||"boolean"!=typeof e&&(d=a.getAttributeNode(c))&&!1!==d.nodeValue?c.toLowerCase():b},set:function(a,b,c){var d;return!1===b?q.removeAttr(a,c):(d=q.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}};kb||(Ua={name:!0,id:!0,coords:!0},qa=q.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(Ua[c]?""!==d.value:d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=K.createAttribute(c),a.setAttributeNode(d)),
d.value=b+""}},q.each(["width","height"],function(a,b){q.attrHooks[b]=q.extend(q.attrHooks[b],{set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}})}),q.attrHooks.contenteditable={get:qa.get,set:function(a,b,c){""===b&&(b="false");qa.set(a,b,c)}});q.support.hrefNormalized||q.each(["href","src","width","height"],function(a,c){q.attrHooks[c]=q.extend(q.attrHooks[c],{get:function(a){a=a.getAttribute(c,2);return null===a?b:a}})});q.support.style||(q.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||
b},set:function(a,b){return a.style.cssText=""+b}});q.support.optSelected||(q.propHooks.selected=q.extend(q.propHooks.selected,{get:function(a){a=a.parentNode;return a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex),null}}));q.support.enctype||(q.propFix.enctype="encoding");q.support.checkOn||q.each(["radio","checkbox"],function(){q.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}});q.each(["radio","checkbox"],function(){q.valHooks[this]=q.extend(q.valHooks[this],
{set:function(a,b){if(q.isArray(b))return a.checked=0<=q.inArray(q(a).val(),b)}})});var xa=/^(?:textarea|input|select)$/i,Ea=/^([^\.]*|)(?:\.(.+)|)$/,Ab=/(?:^|\s)hover(\.\S+|)\b/,lb=/^key/,Bb=/^(?:mouse|contextmenu)|click/,Fa=/^(?:focusinfocus|focusoutblur)$/,mb=function(a){return q.event.special.hover?a:a.replace(Ab,"mouseenter$1 mouseleave$1")};q.event={add:function(a,c,d,e,f){var g,h,k,l,n,o,p,M,r,D;if(!(3===a.nodeType||8===a.nodeType||!c||!d||!(g=q._data(a)))){d.handler&&(M=d,d=M.handler,f=M.selector);
d.guid||(d.guid=q.guid++);k=g.events;k||(g.events=k={});h=g.handle;h||(g.handle=h=function(a){return"undefined"!=typeof q&&(!a||q.event.triggered!==a.type)?q.event.dispatch.apply(h.elem,arguments):b},h.elem=a);c=q.trim(mb(c)).split(" ");for(g=0;g<c.length;g++){l=Ea.exec(c[g])||[];n=l[1];o=(l[2]||"").split(".").sort();D=q.event.special[n]||{};n=(f?D.delegateType:D.bindType)||n;D=q.event.special[n]||{};p=q.extend({type:n,origType:l[1],data:e,handler:d,guid:d.guid,selector:f,namespace:o.join(".")},M);
r=k[n];if(!r&&(r=k[n]=[],r.delegateCount=0,!D.setup||!1===D.setup.call(a,e,o,h)))a.addEventListener?a.addEventListener(n,h,!1):a.attachEvent&&a.attachEvent("on"+n,h);D.add&&(D.add.call(a,p),p.handler.guid||(p.handler.guid=d.guid));f?r.splice(r.delegateCount++,0,p):r.push(p);q.event.global[n]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var f,g,h,k,l,n,o,p,M,r,D,V=q.hasData(a)&&q._data(a);if(V&&(p=V.events)){b=q.trim(mb(b||"")).split(" ");for(f=0;f<b.length;f++)if(g=Ea.exec(b[f])||[],h=k=g[1],
l=g[2],h){M=q.event.special[h]||{};h=(d?M.delegateType:M.bindType)||h;r=p[h]||[];n=r.length;l=l?RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(o=0;o<r.length;o++)D=r[o],(e||k===D.origType)&&(!c||c.guid===D.guid)&&(!l||l.test(D.namespace))&&(!d||d===D.selector||"**"===d&&D.selector)&&(r.splice(o--,1),D.selector&&r.delegateCount--,M.remove&&M.remove.call(a,D));0===r.length&&n!==r.length&&((!M.teardown||!1===M.teardown.call(a,l,V.handle))&&q.removeEvent(a,h,V.handle),
delete p[h])}else for(h in p)q.event.remove(a,h+b[f],c,d,!0);q.isEmptyObject(p)&&(delete V.handle,q.removeData(a,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||3!==e.nodeType&&8!==e.nodeType){var g,h,k,l,n,o,p,M,r=c.type||c;n=[];if(!Fa.test(r+q.event.triggered)&&(0<=r.indexOf("!")&&(r=r.slice(0,-1),g=!0),0<=r.indexOf(".")&&(n=r.split("."),r=n.shift(),n.sort()),e&&!q.event.customEvent[r]||q.event.global[r]))if(c="object"==typeof c?c[q.expando]?c:
new q.Event(r,c):new q.Event(r),c.type=r,c.isTrigger=!0,c.exclusive=g,c.namespace=n.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+n.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,g=0>r.indexOf(":")?"on"+r:"",e){if(c.result=b,c.target||(c.target=e),d=null!=d?q.makeArray(d):[],d.unshift(c),n=q.event.special[r]||{},!(n.trigger&&!1===n.trigger.apply(e,d))){p=[[e,n.bindType||r]];if(!f&&!n.noBubble&&!q.isWindow(e)){M=n.delegateType||r;k=Fa.test(M+r)?e:e.parentNode;for(l=e;k;k=k.parentNode)p.push([k,M]),
l=k;l===(e.ownerDocument||K)&&p.push([l.defaultView||l.parentWindow||a,M])}for(h=0;h<p.length&&!c.isPropagationStopped();h++)k=p[h][0],c.type=p[h][1],o=(q._data(k,"events")||{})[c.type]&&q._data(k,"handle"),o&&o.apply(k,d),o=g&&k[g],o&&q.acceptData(k)&&!1===o.apply(k,d)&&c.preventDefault();return c.type=r,!f&&!c.isDefaultPrevented()&&(!n._default||!1===n._default.apply(e.ownerDocument,d))&&("click"!==r||!q.nodeName(e,"a"))&&q.acceptData(e)&&g&&e[r]&&("focus"!==r&&"blur"!==r||0!==c.target.offsetWidth)&&
!q.isWindow(e)&&(l=e[g],l&&(e[g]=null),q.event.triggered=r,e[r](),q.event.triggered=b,l&&(e[g]=l)),c.result}}else for(h in e=q.cache,e)e[h].events&&e[h].events[r]&&q.event.trigger(c,d,e[h].handle.elem,!0)}},dispatch:function(c){var c=q.event.fix(c||a.event),d,e,f,g,h,k,l,n,o,p=(q._data(this,"events")||{})[c.type]||[],M=p.delegateCount,r=[].slice.call(arguments),D=!c.exclusive&&!c.namespace,V=q.event.special[c.type]||{},s=[];r[0]=c;c.delegateTarget=this;if(!(V.preDispatch&&!1===V.preDispatch.call(this,
c))){if(M&&(!c.button||"click"!==c.type)){f=q(this);f.context=this;for(e=c.target;e!=this;e=e.parentNode||this)if(!0!==e.disabled||"click"!==c.type){h={};l=[];f[0]=e;for(d=0;d<M;d++)n=p[d],o=n.selector,h[o]===b&&(h[o]=f.is(o)),h[o]&&l.push(n);l.length&&s.push({elem:e,matches:l})}}p.length>M&&s.push({elem:this,matches:p.slice(M)});for(d=0;d<s.length&&!c.isPropagationStopped();d++){k=s[d];c.currentTarget=k.elem;for(e=0;e<k.matches.length&&!c.isImmediatePropagationStopped();e++)if(n=k.matches[e],D||
!c.namespace&&!n.namespace||c.namespace_re&&c.namespace_re.test(n.namespace))c.data=n.data,c.handleObj=n,g=((q.event.special[n.origType]||{}).handle||n.handler).apply(k.elem,r),g!==b&&(c.result=g,!1===g&&(c.preventDefault(),c.stopPropagation()))}return V.postDispatch&&V.postDispatch.call(this,c),c.result}},props:"attrChange,attrName,relatedNode,srcElement,altKey,bubbles,cancelable,ctrlKey,currentTarget,eventPhase,metaKey,relatedTarget,shiftKey,target,timeStamp,view,which".split(","),fixHooks:{},keyHooks:{props:["char",
"charCode","key","keyCode"],filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button,buttons,clientX,clientY,fromElement,offsetX,offsetY,pageX,pageY,screenX,screenY,toElement".split(","),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||K,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=
c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[q.expando])return a;var b,c,d=a,e=q.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props,a=q.Event(d);for(b=f.length;b;)c=f[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||K),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,
e.filter?e.filter(a,d):a},special:{ready:{setup:q.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){q.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){a=q.extend(new q.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?q.event.trigger(a,null,b):q.event.dispatch.call(b,a);a.isDefaultPrevented()&&c.preventDefault()}};q.event.handle=
q.event.dispatch;q.removeEvent=K.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){b="on"+b;a.detachEvent&&("undefined"==typeof a[b]&&(a[b]=null),a.detachEvent(b,c))};q.Event=function(a,b){if(this instanceof q.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?g:f):this.type=a,b&&q.extend(this,b),this.timeStamp=a&&a.timeStamp||q.now(),
this[q.expando]=!0;else return new q.Event(a,b)};q.Event.prototype={preventDefault:function(){this.isDefaultPrevented=g;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=g;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g;this.stopPropagation()},isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f};
q.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){q.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=a.relatedTarget,e=a.handleObj;if(!d||d!==this&&!q.contains(this,d))a.type=e.origType,c=e.handler.apply(this,arguments),a.type=b;return c}}});q.support.submitBubbles||(q.event.special.submit={setup:function(){if(q.nodeName(this,"form"))return!1;q.event.add(this,"click._submit keypress._submit",function(a){a=a.target;(a=q.nodeName(a,"input")||q.nodeName(a,"button")?
a.form:b)&&!q._data(a,"_submit_attached")&&(q.event.add(a,"submit._submit",function(a){a._submit_bubble=!0}),q._data(a,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&q.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(q.nodeName(this,"form"))return!1;q.event.remove(this,"._submit")}});q.support.changeBubbles||(q.event.special.change={setup:function(){if(xa.test(this.nodeName)){if("checkbox"===this.type||
"radio"===this.type)q.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),q.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1);q.event.simulate("change",this,a,!0)});return!1}q.event.add(this,"beforeactivate._change",function(a){a=a.target;xa.test(a.nodeName)&&!q._data(a,"_change_attached")&&(q.event.add(a,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&
q.event.simulate("change",this.parentNode,a,!0)}),q._data(a,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type)return a.handleObj.handler.apply(this,arguments)},teardown:function(){return q.event.remove(this,"._change"),xa.test(this.nodeName)}});q.support.focusinBubbles||q.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){q.event.simulate(b,a.target,q.event.fix(a),!0)};q.event.special[b]=
{setup:function(){0===c++&&K.addEventListener(a,d,!0)},teardown:function(){0===--c&&K.removeEventListener(a,d,!0)}}});q.fn.extend({on:function(a,c,d,e,g){var h,k;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(k in a)this.on(k,c,d,a[k],g);return this}null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b));if(!1===e)e=f;else if(!e)return this;return 1===g&&(h=e,e=function(a){return q().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=q.guid++)),this.each(function(){q.event.add(this,
a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,g;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,q(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(g in a)this.off(g,c,a[g]);return this}if(!1===c||"function"==typeof c)d=c,c=b;return!1===d&&(d=f),this.each(function(){q.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,
null,b)},live:function(a,b,c){return q(this.context).on(a,this.selector,b,c),this},die:function(a,b){return q(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1==arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){q.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return q.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=
a.guid||q.guid++,d=0,e=function(c){var e=(q._data(this,"lastToggle"+a.guid)||0)%d;return q._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});q.each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),
function(a,b){q.fn[b]=function(a,c){return null==c&&(c=a,a=null),0<arguments.length?this.on(b,null,a,c):this.trigger(b)};lb.test(b)&&(q.event.fixHooks[b]=q.event.keyHooks);Bb.test(b)&&(q.event.fixHooks[b]=q.event.mouseHooks)});(function(a,b){function c(a,b,d,e){for(var f=0,g=b.length;f<g;f++)U(a,b[f],d,e)}function d(a,b,e,f,g,h){var k,l=L.setFilters[b.toLowerCase()];return l||U.error(b),(a||!(k=g))&&c(a||"*",f,k=[],g),0<k.length?l(k,e,h):[]}function e(a,f,g,h,k){for(var l,n,o,p,M,q,r,D=0,V=k.length,
s=ra.POS,fa=RegExp("^"+s.source+"(?!"+C+")","i"),vb=function(){for(var a=1,c=arguments.length-2;a<c;a++)arguments[a]===b&&(l[a]=b)};D<V;D++){for(s.exec(""),a=k[D],p=[],o=0,M=h;l=s.exec(a);)if(n=s.lastIndex=l.index+l[0].length,n>o){r=a.slice(o,l.index);o=n;q=[f];ga.test(r)&&(M&&(q=M),M=h);if(n=va.test(r))r=r.slice(0,-5).replace(ga,"$&*");1<l.length&&l[0].replace(fa,vb);M=d(r,l[1],l[2],q,M,n)}M?(p=p.concat(M),(r=a.slice(o))&&")"!==r?ga.test(r)?c(r,p,g,h):U(r,f,g,h?h.concat(M):M):da.apply(g,p)):U(a,
f,g,h)}return 1===V?g:U.uniqueSort(g)}function f(a,b,c){var d=b.dir,e=s++;return a||(a=function(a){return a===c}),b.first?function(b,c){for(;b=b[d];)if(1===b.nodeType)return a(b,c)&&b}:function(b,c){for(var f,g=e+"."+l,h=g+"."+k;b=b[d];)if(1===b.nodeType){if((f=b[y])===h)return b.sizset;if("string"==typeof f&&0===f.indexOf(g)){if(b.sizset)return b}else{b[y]=h;if(a(b,c))return b.sizset=!0,b;b.sizset=!1}}}}function g(a,b){return a?function(c,d){var e=b(c,d);return e&&a(!0===e?c:e,d)}:b}function h(a){return function(b,
c){for(var d,e=0;d=a[e];e++)if(d(b,c))return!0;return!1}}var k,l,n,o,p,M=a.document,r=M.documentElement,D=!1,V=!0,s=0,fa=[].slice,da=[].push,y=("sizcache"+Math.random()).replace(".",""),C="[\\x20\\t\\r\\n\\f]",E="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#"),E="\\["+C+"*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)"+C+"*(?:([*^$|!~]?=)"+C+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+E+")|)|)"+C+"*\\]",u=C+"*([\\x20\\t\\r\\n\\f>+~])"+C+"*",Z="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+E+"|"+":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)".replace(2,
7)+"|[^\\\\(),])+",ka=RegExp("^"+C+"+|((?:^|[^\\\\])(?:\\\\.)*)"+C+"+$","g"),ga=RegExp("^"+u),w=RegExp(Z+"?(?="+C+"*,|$)","g"),v=RegExp("^(?:(?!,)(?:(?:^|,)"+C+"*"+Z+")*?|"+C+"*(.*?))(\\)|$)"),I=RegExp(Z.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+u,"g"),F=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,x=/[\x20\t\r\n\f]*[+~]/,va=/:not\($/,H=/h\d/i,z=/input|select|textarea|button/i,A=/\\(?!\\)/g,ra={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,
TAG:RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("[-","[-\\*")+")"),ATTR:RegExp("^"+E),PSEUDO:RegExp("^:((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)"),CHILD:RegExp("^:(only|nth|last|first)-child(?:\\("+C+"*(even|odd|(([+-]|)(\\d*)n|)"+C+"*(?:([+-]|)"+C+"*(\\d+)|))"+C+"*\\)|)","i"),POS:RegExp(":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)","ig"),needsContext:RegExp("^"+C+"*[>+~]|:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",
"i")},P={},B=[],ca={},Ba=[],E=function(a){return a.sizzleFilter=!0,a},u=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}},Z=function(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}},T=function(a){var b=!1,c=M.createElement("div");try{b=a(c)}catch(d){}return b},Eb=T(function(a){a.innerHTML="<select></select>";a=typeof a.lastChild.getAttribute("multiple");return"boolean"!==a&&"string"!==a}),ua=T(function(a){a.id=
y+0;a.innerHTML="<a name='"+y+"'></a><div name='"+y+"'></div>";r.insertBefore(a,r.firstChild);var b=M.getElementsByName&&M.getElementsByName(y).length===2+M.getElementsByName(y+0).length;return p=!M.getElementById(y),r.removeChild(a),b}),N=T(function(a){return a.appendChild(M.createComment("")),0===a.getElementsByTagName("*").length}),R=T(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&"undefined"!==typeof a.firstChild.getAttribute&&"#"===a.firstChild.getAttribute("href")}),G=T(function(a){return a.innerHTML=
"<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||0===a.getElementsByClassName("e").length?!1:(a.lastChild.className="e",1!==a.getElementsByClassName("e").length)}),U=function(a,b,c,d){c=c||[];b=b||M;var e,f,g,h,k=b.nodeType;if(1!==k&&9!==k)return[];if(!a||"string"!=typeof a)return c;g=Ma(b);if(!g&&!d&&(e=F.exec(a)))if(h=e[1])if(9===k){f=b.getElementById(h);if(!f||!f.parentNode)return c;if(f.id===h)return c.push(f),c}else{if(b.ownerDocument&&(f=b.ownerDocument.getElementById(h))&&
eb(b,f)&&f.id===h)return c.push(f),c}else{if(e[2])return da.apply(c,fa.call(b.getElementsByTagName(a),0)),c;if((h=e[3])&&G&&b.getElementsByClassName)return da.apply(c,fa.call(b.getElementsByClassName(h),0)),c}return O(a,b,c,d,g)},L=U.selectors={cacheLength:50,match:ra,order:["ID","TAG"],attrHandle:{},createPseudo:E,find:{ID:p?function(a,b,c){if("undefined"!==typeof b.getElementById&&!c)return(a=b.getElementById(a))&&a.parentNode?[a]:[]}:function(a,c,d){if("undefined"!==typeof c.getElementById&&!d)return(c=
c.getElementById(a))?c.id===a||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===a?[c]:b:[]},TAG:N?function(a,b){if("undefined"!==typeof b.getElementsByTagName)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if("*"===a){for(var d,e=[],f=0;d=c[f];f++)1===d.nodeType&&e.push(d);return e}return c}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=
a[1].replace(A,""),a[3]=(a[4]||a[5]||"").replace(A,""),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1]?(a[2]||U.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*("even"===a[2]||"odd"===a[2])),a[4]=+(a[6]+a[7]||"odd"===a[2])):a[2]&&U.error(a[0]),a},PSEUDO:function(a){var b,c=a[4];return ra.CHILD.test(a[0])?null:(c&&(b=v.exec(c))&&b.pop()&&(a[0]=a[0].slice(0,b[0].length-c.length-1),c=b[0].slice(0,-1)),a.splice(2,3,c||a[3]),a)}},filter:{ID:p?function(a){return a=
a.replace(A,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(A,""),function(b){return(b="undefined"!==typeof b.getAttributeNode&&b.getAttributeNode("id"))&&b.value===a}},TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(A,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=P[a];return b||(b=P[a]=RegExp("(^|"+C+")"+a+"("+C+"|$)"),B.push(a),B.length>L.cacheLength&&delete P[B.shift()]),function(a){return b.test(a.className||
"undefined"!==typeof a.getAttribute&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return b?function(d){var d=U.attr(d,a),e=d+"";if(null==d)return"!="===b;switch(b){case "=":return e===c;case "!=":return e!==c;case "^=":return c&&0===e.indexOf(c);case "*=":return c&&-1<e.indexOf(c);case "$=":return c&&e.substr(e.length-c.length)===c;case "~=":return-1<(" "+e+" ").indexOf(c);case "|=":return e===c||e.substr(0,c.length+1)===c+"-"}}:function(b){return null!=U.attr(b,a)}},CHILD:function(a,b,c,d){if("nth"===
a){var e=s++;return function(a){var b,f,g=0,h=a;if(1===c&&0===d)return!0;if((b=a.parentNode)&&(b[y]!==e||!a.sizset)){for(h=b.firstChild;h&&!(1===h.nodeType&&(h.sizset=++g,h===a));h=h.nextSibling);b[y]=e}return f=a.sizset-d,0===c?0===f:0===f%c&&0<=f/c}}return function(b){var c=b;switch(a){case "only":case "first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===a)return!0;c=b;case "last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(a,b,c,d){var e=L.pseudos[a]||
L.pseudos[a.toLowerCase()];return e||U.error("unsupported pseudo: "+a),e.sizzleFilter?e(b,c,d):e}},pseudos:{not:E(function(a,b,c){var d=J(a.replace(ka,"$1"),b,c);return function(a){return!d(a)}}),enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},parent:function(a){return!L.pseudos.empty(a)},
empty:function(a){for(var b,a=a.firstChild;a;){if("@"<a.nodeName||3===(b=a.nodeType)||4===b)return!1;a=a.nextSibling}return!0},contains:E(function(a){return function(b){return-1<(b.textContent||b.innerText||Ra(b)).indexOf(a)}}),has:E(function(a){return function(b){return 0<U(a,b).length}}),header:function(a){return H.test(a.nodeName)},text:function(a){var b,c;return"input"===a.nodeName.toLowerCase()&&"text"===(b=a.type)&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===b)},radio:u("radio"),checkbox:u("checkbox"),
file:u("file"),password:u("password"),image:u("image"),submit:Z("submit"),reset:Z("reset"),button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return z.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b,c){return c?a.slice(1):[a[0]]},last:function(a,b,c){b=
a.pop();return c?a:[b]},even:function(a,b,c){for(var b=[],c=c?1:0,d=a.length;c<d;c+=2)b.push(a[c]);return b},odd:function(a,b,c){for(var b=[],c=c?0:1,d=a.length;c<d;c+=2)b.push(a[c]);return b},lt:function(a,b,c){return c?a.slice(+b):a.slice(0,+b)},gt:function(a,b,c){return c?a.slice(0,+b+1):a.slice(+b+1)},eq:function(a,b,c){b=a.splice(+b,1);return c?a:b}}};L.setFilters.nth=L.setFilters.eq;L.filters=L.pseudos;R||(L.attrHandle={href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}});
ua&&(L.order.push("NAME"),L.find.NAME=function(a,b){if("undefined"!==typeof b.getElementsByName)return b.getElementsByName(a)});G&&(L.order.splice(1,0,"CLASS"),L.find.CLASS=function(a,b,c){if("undefined"!==typeof b.getElementsByClassName&&!c)return b.getElementsByClassName(a)});try{fa.call(r.childNodes,0)[0].nodeType}catch(K){fa=function(a){for(var b,c=[];b=this[a];a++)c.push(b);return c}}var Ma=U.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1},eb=U.contains=
r.compareDocumentPosition?function(a,b){return!!(a.compareDocumentPosition(b)&16)}:r.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b.parentNode;return a===d||!(!d||!(1===d.nodeType&&c.contains&&c.contains(d)))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},Ra=U.getText=function(a){var b,c="",d=0;if(b=a.nodeType)if(1===b||9===b||11===b){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=Ra(a)}else{if(3===b||4===b)return a.nodeValue}else for(;b=
a[d];d++)c+=Ra(b);return c};U.attr=function(a,b){var c,d=Ma(a);return d||(b=b.toLowerCase()),L.attrHandle[b]?L.attrHandle[b](a):Eb||d?a.getAttribute(b):(c=a.getAttributeNode(b),c?"boolean"==typeof a[b]?a[b]?b:null:c.specified?c.value:null:null)};U.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};[0,0].sort(function(){return V=0});r.compareDocumentPosition?n=function(a,b){return a===b?(D=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:
a.compareDocumentPosition(b)&4)?-1:1}:(n=function(a,b){if(a===b)return D=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[];c=a.parentNode;d=b.parentNode;var g=c;if(c===d)return o(a,b);if(!c)return-1;if(!d)return 1;for(;g;)e.unshift(g),g=g.parentNode;for(g=d;g;)f.unshift(g),g=g.parentNode;c=e.length;d=f.length;for(g=0;g<c&&g<d;g++)if(e[g]!==f[g])return o(e[g],f[g]);return g===c?o(a,f[g],-1):o(e[g],b,1)},o=function(a,b,c){if(a===b)return c;for(a=a.nextSibling;a;){if(a===
b)return-1;a=a.nextSibling}return 1});U.uniqueSort=function(a){var b,c=1;if(n&&(D=V,a.sort(n),D))for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a};var J=U.compile=function(a,b,c){var d,e,k,l=ca[a];if(l&&l.context===b)return l;var n,o=[];d=0;for(var p=v.exec(a),q=!p.pop()&&!p.pop(),r=q&&a.match(w)||[""],D=L.preFilter,V=L.filter,s=!c&&b!==M;null!=(k=r[d])&&q;d++)for(o.push(e=[]),s&&(k=" "+k);k;){q=!1;if(p=ga.exec(k))k=k.slice(p[0].length),q=e.push({part:p.pop().replace(ka," "),captures:p});for(n in V)(p=
ra[n].exec(k))&&(!D[n]||(p=D[n](p,b,c)))&&(k=k.slice(p.shift().length),q=e.push({part:n,captures:p}));if(!q)break}e=(q||U.error(a),o);for(k=0;d=e[k];k++){n=e;o=k;p=b;q=c;D=r=void 0;for(V=0;r=d[V];V++)L.relative[r.part]?D=f(D,L.relative[r.part],p):(r.captures.push(p,q),D=g(D,L.filter[r.part].apply(null,r.captures)));n[o]=D}return l=ca[a]=h(e),l.context=b,l.runs=l.dirruns=0,Ba.push(a),Ba.length>L.cacheLength&&delete ca[Ba.shift()],l};U.matches=function(a,b){return U(a,null,null,b)};U.matchesSelector=
function(a,b){return 0<U(b,null,null,[a]).length};var O=function(a,b,c,d,f){var a=a.replace(ka,"$1"),g,h,n,o,p,M,q,r=a.match(w);n=a.match(I);o=b.nodeType;if(ra.POS.test(a))return e(a,b,c,d,r);if(d)g=fa.call(d,0);else if(r&&1===r.length){if(1<n.length&&9===o&&!f&&(r=ra.ID.exec(n[0]))){b=L.find.ID(r[1],b,f)[0];if(!b)return c;a=a.slice(n.shift().length)}d=(r=x.exec(n[0]))&&!r.index&&b.parentNode||b;q=n.pop();p=q.split(":not")[0];for(n=0,o=L.order.length;n<o;n++)if(M=L.order[n],r=ra[M].exec(p))if(g=L.find[M]((r[1]||
"").replace(A,""),d,f),null!=g){p===q&&(a=a.slice(0,a.length-q.length)+p.replace(ra[M],""),a||da.apply(c,fa.call(g,0)));break}}if(a){h=J(a,b,f);l=h.dirruns++;null==g&&(g=L.find.TAG("*",x.test(a)&&b.parentNode||b));for(n=0;a=g[n];n++)k=h.runs++,h(a,b)&&c.push(a)}return c};M.querySelectorAll&&function(){var a,b=O,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[],f=[":active"],g=r.matchesSelector||r.mozMatchesSelector||r.webkitMatchesSelector||r.oMatchesSelector||r.msMatchesSelector;T(function(a){a.innerHTML=
"<select><option selected></option></select>";a.querySelectorAll("[selected]").length||e.push("\\["+C+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");a.querySelectorAll(":checked").length||e.push(":checked")});T(function(a){a.innerHTML="<p test=''></p>";a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+C+"*(?:\"\"|'')");a.innerHTML="<input type='hidden'>";a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")});e=e.length&&RegExp(e.join("|"));O=function(a,d,f,
g,h){if(!g&&!h&&(!e||!e.test(a)))if(9===d.nodeType)try{return da.apply(f,fa.call(d.querySelectorAll(a),0)),f}catch(k){}else if(1===d.nodeType&&"object"!==d.nodeName.toLowerCase()){var l=d.getAttribute("id"),n=l||y,o=x.test(a)&&d.parentNode||d;l?n=n.replace(c,"\\$&"):d.setAttribute("id",n);try{return da.apply(f,fa.call(o.querySelectorAll(a.replace(w,"[id='"+n+"'] $&")),0)),f}catch(p){}finally{l||d.removeAttribute("id")}}return b(a,d,f,g,h)};g&&(T(function(b){a=g.call(b,"div");try{g.call(b,"[test!='']:sizzle"),
f.push(L.match.PSEUDO)}catch(c){}}),f=RegExp(f.join("|")),U.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!Ma(b)&&!f.test(c)&&(!e||!e.test(c)))try{var h=g.call(b,c);if(h||a||b.document&&11!==b.document.nodeType)return h}catch(k){}return 0<U(c,null,null,[b]).length})}();U.attr=q.attr;q.find=U;q.expr=U.selectors;q.expr[":"]=q.expr.pseudos;q.unique=U.uniqueSort;q.text=U.getText;q.isXMLDoc=U.isXML;q.contains=U.contains})(a);var Cb=/Until$/,Db=/^(?:parents|prev(?:Until|All))/,xb=/^.[^:#\[\.,]*$/,
nb=q.expr.match.needsContext,ma={children:!0,contents:!0,next:!0,prev:!0};q.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if("string"!=typeof a)return q(a).filter(function(){for(b=0,c=h.length;b<c;b++)if(q.contains(h[b],this))return!0});g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++)if(d=g.length,q.find(a,this[b],g),0<b)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}return g},has:function(a){var b,c=q(a,this),d=c.length;return this.filter(function(){for(b=
0;b<d;b++)if(q.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(l(this,a,!1),"not",a)},filter:function(a){return this.pushStack(l(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?nb.test(a)?0<=q(a,this.context).index(this[0]):0<q.filter(a,this).length:0<this.filter(a).length)},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=nb.test(a)||"string"!=typeof a?q(a,b||this.context):0;d<e;d++)for(c=this[d];c&&c.ownerDocument&&c!==b&&11!==c.nodeType;){if(g?
-1<g.index(c):q.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}return f=1<f.length?q.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?"string"==typeof a?q.inArray(this[0],q(a)):q.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c="string"==typeof a?q(a,b):q.makeArray(a&&a.nodeType?[a]:a),d=q.merge(this.get(),c);return this.pushStack(h(c[0])||h(d[0])?d:q.unique(d))},addBack:function(a){return this.add(null==a?
this.prevObject:this.prevObject.filter(a))}});q.fn.andSelf=q.fn.addBack;q.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return q.dir(a,"parentNode")},parentsUntil:function(a,b,c){return q.dir(a,"parentNode",c)},next:function(a){return k(a,"nextSibling")},prev:function(a){return k(a,"previousSibling")},nextAll:function(a){return q.dir(a,"nextSibling")},prevAll:function(a){return q.dir(a,"previousSibling")},nextUntil:function(a,b,c){return q.dir(a,"nextSibling",
c)},prevUntil:function(a,b,c){return q.dir(a,"previousSibling",c)},siblings:function(a){return q.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return q.sibling(a.firstChild)},contents:function(a){return q.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:q.merge([],a.childNodes)}},function(a,b){q.fn[a]=function(c,d){var e=q.map(this,b,c);return Cb.test(a)||(d=c),d&&"string"==typeof d&&(e=q.filter(d,e)),e=1<this.length&&!ma[a]?q.unique(e):e,1<this.length&&Db.test(a)&&
(e=e.reverse()),this.pushStack(e,a,R.call(arguments).join(","))}});q.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?q.find.matchesSelector(b[0],a)?[b[0]]:[]:q.find.matches(a,b)},dir:function(a,c,d){for(var e=[],a=a[c];a&&9!==a.nodeType&&(d===b||1!==a.nodeType||!q(a).is(d));)1===a.nodeType&&e.push(a),a=a[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ja="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
Va=/ jQuery\d+="(?:null|\d+)"/g,W=/^\s+/,Wa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ka=/<([\w:]+)/,La=/<tbody/i,Xa=/<|&#?\w+;/,ob=/<(?:script|style|link)/i,pb=/<(?:script|object|embed|option|style)/i,Ga=RegExp("<(?:"+Ja+")[\\s/>]","i"),ja=/^(?:checkbox|radio)$/,Y=/checked\s*(?:[^=]|=\s*.checked.)/i,qb=/\/(java|ecma)script/i,Ya=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,ia={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],
thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ya=n(K),ha=ya.appendChild(K.createElement("div"));ia.optgroup=ia.option;ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead;ia.th=ia.td;q.support.htmlSerialize||(ia._default=[1,"X<div>","</div>"]);q.fn.extend({text:function(a){return q.access(this,function(a){return a===
b?q.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(q.isFunction(a))return this.each(function(b){q(this).wrapAll(a.call(this,b))});if(this[0]){var b=q(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return q.isFunction(a)?this.each(function(b){q(this).wrapInner(a.call(this,
b))}):this.each(function(){var b=q(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=q.isFunction(a);return this.each(function(c){q(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){q.nodeName(this,"body")||q(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,
!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=q.clean(arguments);return this.pushStack(q.merge(a,this),"before",this.selector)}},after:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=q.clean(arguments);return this.pushStack(q.merge(this,
a),"after",this.selector)}},remove:function(a,b){for(var c,d=0;null!=(c=this[d]);d++)if(!a||q.filter(a,[c]).length)!b&&1===c.nodeType&&(q.cleanData(c.getElementsByTagName("*")),q.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)for(1===a.nodeType&&q.cleanData(a.getElementsByTagName("*"));a.firstChild;)a.removeChild(a.firstChild);return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return q.clone(this,
a,b)})},html:function(a){return q.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Va,""):b;if("string"==typeof a&&!ob.test(a)&&(q.support.htmlSerialize||!Ga.test(a))&&(q.support.leadingWhitespace||!W.test(a))&&!ia[(Ka.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Wa,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},1===c.nodeType&&(q.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},
replaceWith:function(a){return h(this[0])?this.length?this.pushStack(q(q.isFunction(a)?a():a),"replaceWith",a):this:q.isFunction(a)?this.each(function(b){var c=q(this),d=c.html();c.replaceWith(a.call(this,b,d))}):("string"!=typeof a&&(a=q(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;q(this).remove();b?q(b).before(a):q(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var a=[].concat.apply([],a),e,f,g,h=0,k=a[0],l=[],n=this.length;
if(!q.support.checkClone&&1<n&&"string"==typeof k&&Y.test(k))return this.each(function(){q(this).domManip(a,c,d)});if(q.isFunction(k))return this.each(function(e){var f=q(this);a[0]=k.call(this,e,c?f.html():b);f.domManip(a,c,d)});if(this[0]){e=q.buildFragment(a,this,l);g=e.fragment;f=g.firstChild;1===g.childNodes.length&&(g=f);if(f){c=c&&q.nodeName(f,"tr");for(e=e.cacheable||n-1;h<n;h++)d.call(c&&q.nodeName(this[h],"table")?this[h].getElementsByTagName("tbody")[0]||this[h].appendChild(this[h].ownerDocument.createElement("tbody")):
this[h],h===e?g:q.clone(g,!0,!0))}g=f=null;l.length&&q.each(l,function(a,b){b.src?q.ajax?q.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):q.error("no ajax"):q.globalEval((b.text||b.textContent||b.innerHTML||"").replace(Ya,""));b.parentNode&&b.parentNode.removeChild(b)})}return this}});q.buildFragment=function(a,c,d){var e,f,g,h=a[0];return c=c||K,c=(c[0]||c).ownerDocument||c[0]||c,"undefined"==typeof c.createDocumentFragment&&(c=K),1===a.length&&"string"==typeof h&&
512>h.length&&c===K&&"<"===h.charAt(0)&&!pb.test(h)&&(q.support.checkClone||!Y.test(h))&&(q.support.html5Clone||!Ga.test(h))&&(f=!0,e=q.fragments[h],g=e!==b),e||(e=c.createDocumentFragment(),q.clean(a,c,e,d),f&&(q.fragments[h]=g&&e)),{fragment:e,cacheable:f}};q.fragments={};q.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){q.fn[a]=function(c){var d,e=0,f=[],c=q(c),g=c.length,h=1===this.length&&this[0].parentNode;if((null==
h||h&&11===h.nodeType&&1===h.childNodes.length)&&1===g)return c[b](this[0]),this;for(;e<g;e++)d=(0<e?this.clone(!0):this).get(),q(c[e])[b](d),f=f.concat(d);return this.pushStack(f,a,c.selector)}});q.extend({clone:function(a,b,c){var d,e,f,g;q.support.html5Clone||q.isXMLDoc(a)||!Ga.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(ha.innerHTML=a.outerHTML,ha.removeChild(g=ha.firstChild));if((!q.support.noCloneEvent||!q.support.noCloneChecked)&&(1===a.nodeType||11===a.nodeType)&&!q.isXMLDoc(a)){p(a,g);d=
r(a);e=r(g);for(f=0;d[f];++f)e[f]&&p(d[f],e[f])}if(b&&(o(a,g),c)){d=r(a);e=r(g);for(f=0;d[f];++f)o(d[f],e[f])}return g},clean:function(a,b,c,d){var e,f,g,h,k,l,o,p,M,r=0,D=[];if(!b||"undefined"==typeof b.createDocumentFragment)b=K;for(f=b===K&&ya;null!=(g=a[r]);r++)if("number"==typeof g&&(g+=""),g){if("string"==typeof g)if(Xa.test(g)){for(f=f||n(b),l=l||f.appendChild(b.createElement("div")),g=g.replace(Wa,"<$1></$2>"),h=(Ka.exec(g)||["",""])[1].toLowerCase(),k=ia[h]||ia._default,e=k[0],l.innerHTML=
k[1]+g+k[2];e--;)l=l.lastChild;if(!q.support.tbody){o=La.test(g);p="table"===h&&!o?l.firstChild&&l.firstChild.childNodes:"<table>"===k[1]&&!o?l.childNodes:[];for(e=p.length-1;0<=e;--e)q.nodeName(p[e],"tbody")&&!p[e].childNodes.length&&p[e].parentNode.removeChild(p[e])}!q.support.leadingWhitespace&&W.test(g)&&l.insertBefore(b.createTextNode(W.exec(g)[0]),l.firstChild);g=l.childNodes;l=f.lastChild}else g=b.createTextNode(g);g.nodeType?D.push(g):D=q.merge(D,g)}l&&(f.removeChild(l),g=l=f=null);if(!q.support.appendChecked)for(r=
0;null!=(g=D[r]);r++)q.nodeName(g,"input")?s(g):"undefined"!=typeof g.getElementsByTagName&&q.grep(g.getElementsByTagName("input"),s);if(c){a=function(a){if(!a.type||qb.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)};for(r=0;null!=(g=D[r]);r++)if(!q.nodeName(g,"script")||!a(g))c.appendChild(g),"undefined"!=typeof g.getElementsByTagName&&(M=q.grep(q.merge([],g.getElementsByTagName("script")),a),D.splice.apply(D,[r+1,0].concat(M)),r+=M.length)}return D},cleanData:function(a,
b){for(var c,d,e,f,g=0,h=q.expando,k=q.cache,l=q.support.deleteExpando,n=q.event.special;null!=(e=a[g]);g++)if(b||q.acceptData(e))if(d=e[h],c=d&&k[d],c){if(c.events)for(f in c.events)n[f]?q.event.remove(e,f):q.removeEvent(e,f,c.handle);k[d]&&(delete k[d],l?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,q.deletedIds.push(d))}}});(function(){var a,b;q.uaMatch=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||
/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}};a=q.uaMatch(X.userAgent);b={};a.browser&&(b[a.browser]=!0,b.version=a.version);b.webkit&&(b.safari=!0);q.browser=b;q.sub=function(){function a(b,c){return new a.fn.init(b,c)}q.extend(!0,a,this);a.superclass=this;a.fn=a.prototype=this();a.fn.constructor=a;a.sub=this.sub;a.fn.init=function(c,d){return d&&d instanceof q&&!(d instanceof a)&&(d=a(d)),q.fn.init.call(this,
c,d,b)};a.fn.init.prototype=a.fn;var b=a(K);return a}})();var ea,M,V,fa=/alpha\([^)]*\)/i,da=/opacity=([^)]*)/,Z=/^(top|right|bottom|left)$/,ga=/^margin/,ka=RegExp("^("+sa+")(.*)$","i"),va=RegExp("^("+sa+")(?!px)[a-z%]+$","i"),ra=RegExp("^([-+])=("+sa+")","i"),Ba={},Pb={position:"absolute",visibility:"hidden",display:"block"},Ma={letterSpacing:0,fontWeight:400,lineHeight:1},ua=["Top","Right","Bottom","Left"],eb=["Webkit","O","Moz","ms"],Qb=q.fn.toggle;q.fn.extend({css:function(a,c){return q.access(this,
function(a,c,d){return d!==b?q.style(a,c,d):q.css(a,c)},a,c,1<arguments.length)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(a,b){var c="boolean"==typeof a;return q.isFunction(a)&&q.isFunction(b)?Qb.apply(this,arguments):this.each(function(){(c?a:w(this))?q(this).show():q(this).hide()})}});q.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=ea(a,"opacity");return""===c?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,
widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":q.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&!(3===a.nodeType||8===a.nodeType||!a.style)){var f,g,h,k=q.camelCase(c),l=a.style;c=q.cssProps[k]||(q.cssProps[k]=u(l,k));h=q.cssHooks[c]||q.cssHooks[k];if(d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:l[c];g=typeof d;"string"===g&&(f=ra.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(q.css(a,c)),g="number");if(!(null==d||"number"===g&&isNaN(d)))if("number"===g&&!q.cssNumber[k]&&(d+=
"px"),!h||!("set"in h)||(d=h.set(a,d,e))!==b)try{l[c]=d}catch(n){}}},css:function(a,c,d,e){var f,g,h,k=q.camelCase(c);return c=q.cssProps[k]||(q.cssProps[k]=u(a.style,k)),h=q.cssHooks[c]||q.cssHooks[k],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=ea(a,c)),"normal"===f&&c in Ma&&(f=Ma[c]),d||e!==b?(g=parseFloat(f),d||q.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e={};for(d in b)e[d]=a.style[d],a.style[d]=b[d];c=c.call(a);for(d in b)a.style[d]=e[d];return c}});a.getComputedStyle?ea=function(a,b){var c,
d,e,f,g=getComputedStyle(a,null),h=a.style;return g&&(c=g[b],""===c&&!q.contains(a.ownerDocument.documentElement,a)&&(c=q.style(a,b)),va.test(c)&&ga.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=c,c=g.width,h.width=d,h.minWidth=e,h.maxWidth=f)),c}:K.documentElement.currentStyle&&(ea=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return null==e&&f&&f[b]&&(e=f[b]),va.test(e)&&!Z.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=
a.currentStyle.left),f.left="fontSize"===b?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),""===e?"auto":e});q.each(["height","width"],function(a,b){q.cssHooks[b]={get:function(a,c,d){if(c)return 0!==a.offsetWidth||"none"!==ea(a,"display")?z(a,b,d):q.swap(a,Pb,function(){return z(a,b,d)})},set:function(a,c,d){return x(a,c,d?B(a,b,d,q.support.boxSizing&&"border-box"===q.css(a,"boxSizing")):0)}}});q.support.opacity||(q.cssHooks.opacity={get:function(a,b){return da.test((b&&a.currentStyle?
a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=q.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(1<=b&&""===q.trim(f.replace(fa,""))&&c.removeAttribute&&(c.removeAttribute("filter"),d&&!d.filter))return;c.filter=fa.test(f)?f.replace(fa,e):f+" "+e}});q(function(){q.support.reliableMarginRight||(q.cssHooks.marginRight={get:function(a,b){return q.swap(a,{display:"inline-block"},function(){if(b)return ea(a,
"marginRight")})}});!q.support.pixelPosition&&q.fn.position&&q.each(["top","left"],function(a,b){q.cssHooks[b]={get:function(a,c){if(c){var d=ea(a,b);return va.test(d)?q(a).position()[b]+"px":d}}}})});q.expr&&q.expr.filters&&(q.expr.filters.hidden=function(a){return 0===a.offsetWidth&&0===a.offsetHeight||!q.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||ea(a,"display"))},q.expr.filters.visible=function(a){return!q.expr.filters.hidden(a)});q.each({margin:"",padding:"",border:"Width"},
function(a,b){q.cssHooks[a+b]={expand:function(c){for(var d="string"==typeof c?c.split(" "):[c],e={},c=0;4>c;c++)e[a+ua[c]+b]=d[c]||d[c-2]||d[0];return e}};ga.test(a)||(q.cssHooks[a+b].set=x)});var Eb=/%20/g,Ra=/\[\]$/,U=/\r?\n/g,Rb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Sb=/^(?:select|textarea)/i;q.fn.extend({serialize:function(){return q.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?
q.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Sb.test(this.nodeName)||Rb.test(this.type))}).map(function(a,b){var c=q(this).val();return null==c?null:q.isArray(c)?q.map(c,function(a){return{name:b.name,value:a.replace(U,"\r\n")}}):{name:b.name,value:c.replace(U,"\r\n")}}).get()}});q.param=function(a,c){var d,e=[],f=function(a,b){b=q.isFunction(b)?b():null==b?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=q.ajaxSettings&&
q.ajaxSettings.traditional);if(q.isArray(a)||a.jquery&&!q.isPlainObject(a))q.each(a,function(){f(this.name,this.value)});else for(d in a)J(d,a[d],c,f);return e.join("&").replace(Eb,"+")};var Ha,Ia,Tb=/#.*$/,Ub=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Vb=/^(?:GET|HEAD)$/,Wb=/^\/\//,Gb=/\?/,Xb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Yb=/([?&])_=[^&]*/,Hb=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ib=q.fn.load,yb={},Jb={},Kb=["*/"]+["*"];try{Ha=ba.href}catch(ec){Ha=K.createElement("a"),Ha.href=
"",Ha=Ha.href}Ia=Hb.exec(Ha.toLowerCase())||[];q.fn.load=function(a,c,d){if("string"!=typeof a&&Ib)return Ib.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,k=a.indexOf(" ");return 0<=k&&(e=a.slice(k,a.length),a=a.slice(0,k)),q.isFunction(c)?(d=c,c=b):"object"==typeof c&&(f="POST"),q.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments;h.html(e?q("<div>").append(a.replace(Xb,"")).find(e):a)}),this};
q.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(a,b){q.fn[b]=function(a){return this.on(b,a)}});q.each(["get","post"],function(a,c){q[c]=function(a,d,e,f){return q.isFunction(d)&&(f=f||e,e=d,d=b),q.ajax({type:c,url:a,data:d,success:e,dataType:f})}});q.extend({getScript:function(a,c){return q.get(a,b,c,"script")},getJSON:function(a,b,c){return q.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?E(a,q.ajaxSettings):(b=a,a=q.ajaxSettings),E(a,b),a},ajaxSettings:{url:Ha,
isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Ia[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Kb},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":q.parseJSON,"text xml":q.parseXML},
flatOptions:{context:!0,url:!0}},ajaxPrefilter:y(yb),ajaxTransport:y(Jb),ajax:function(a,c){function d(a,c,g,l){var o,D,y,da,E,Z=c;if(2!==C){C=2;k&&clearTimeout(k);h=b;f=l||"";u.readyState=0<a?4:0;if(g){var ka;da=p;var l=u,ga,w,v,I,F=da.contents,x=da.dataTypes,va=da.responseFields;for(w in va)w in g&&(l[va[w]]=g[w]);for(;"*"===x[0];)x.shift(),ga===b&&(ga=da.mimeType||l.getResponseHeader("content-type"));if(ga)for(w in F)if(F[w]&&F[w].test(ga)){x.unshift(w);break}if(x[0]in g)v=x[0];else{for(w in g){if(!x[0]||
da.converters[w+" "+x[0]]){v=w;break}I||(I=w)}v=v||I}v&&(ka=(v!==x[0]&&x.unshift(v),g[v]));da=ka}if(200<=a&&300>a||304===a)if(p.ifModified&&(E=u.getResponseHeader("Last-Modified"),E&&(q.lastModified[e]=E),E=u.getResponseHeader("Etag"),E&&(q.etag[e]=E)),304===a)Z="notmodified",o=!0;else{var H;a:{g=p;D=da;var z;ka=g.dataTypes.slice();ga=ka[0];w={};v=0;g.dataFilter&&(D=g.dataFilter(D,g.dataType));if(ka[1])for(H in g.converters)w[H.toLowerCase()]=g.converters[H];for(;E=ka[++v];)if("*"!==E){if("*"!==ga&&
ga!==E){H=w[ga+" "+E]||w["* "+E];if(!H)for(z in w)if(Z=z.split(" "),Z[1]===E&&(H=w[ga+" "+Z[0]]||w["* "+Z[0]])){!0===H?H=w[z]:!0!==w[z]&&(E=Z[0],ka.splice(v--,0,E));break}if(!0!==H)if(H&&g["throws"])D=H(D);else try{D=H(D)}catch(vb){H={state:"parsererror",error:H?vb:"No conversion from "+ga+" to "+E};break a}}ga=E}H={state:"success",data:D}}o=H;Z=o.state;D=o.data;y=o.error;o=!y}else if(y=Z,!Z||a)Z="error",0>a&&(a=0);u.status=a;u.statusText=""+(c||Z);o?V.resolveWith(M,[D,Z,u]):V.rejectWith(M,[u,Z,y]);
u.statusCode(fa);fa=b;n&&r.trigger("ajax"+(o?"Success":"Error"),[u,p,o?D:y]);s.fireWith(M,[u,Z]);n&&(r.trigger("ajaxComplete",[u,p]),--q.active||q.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=b);c=c||{};var e,f,g,h,k,l,n,o,p=q.ajaxSetup({},c),M=p.context||p,r=M!==p&&(M.nodeType||M instanceof q)?q(M):q.event,V=q.Deferred(),s=q.Callbacks("once memory"),fa=p.statusCode||{},y={},da={},C=0,E="canceled",u={readyState:0,setRequestHeader:function(a,b){if(!C){var c=a.toLowerCase();a=da[c]=da[c]||
a;y[a]=b}return this},getAllResponseHeaders:function(){return 2===C?f:null},getResponseHeader:function(a){var c;if(2===C){if(!g)for(g={};c=Ub.exec(f);)g[c[1].toLowerCase()]=c[2];c=g[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return C||(p.mimeType=a),this},abort:function(a){return a=a||E,h&&h.abort(a),d(0,a),this}};V.promise(u);u.success=u.done;u.error=u.fail;u.complete=s.add;u.statusCode=function(a){if(a){var b;if(2>C)for(b in a)fa[b]=[fa[b],a[b]];else b=a[u.status],u.always(b)}return this};
p.url=((a||p.url)+"").replace(Tb,"").replace(Wb,Ia[1]+"//");p.dataTypes=q.trim(p.dataType||"*").toLowerCase().split(ta);null==p.crossDomain&&(l=Hb.exec(p.url.toLowerCase()),p.crossDomain=!(!l||l[1]==Ia[1]&&l[2]==Ia[2]&&(l[3]||("http:"===l[1]?80:443))==(Ia[3]||("http:"===Ia[1]?80:443))));p.data&&p.processData&&"string"!=typeof p.data&&(p.data=q.param(p.data,p.traditional));D(yb,p,c,u);if(2===C)return u;n=p.global;p.type=p.type.toUpperCase();p.hasContent=!Vb.test(p.type);n&&0===q.active++&&q.event.trigger("ajaxStart");
if(!p.hasContent&&(p.data&&(p.url+=(Gb.test(p.url)?"&":"?")+p.data,delete p.data),e=p.url,!1===p.cache)){l=q.now();var Z=p.url.replace(Yb,"$1_="+l);p.url=Z+(Z===p.url?(Gb.test(p.url)?"&":"?")+"_="+l:"")}(p.data&&p.hasContent&&!1!==p.contentType||c.contentType)&&u.setRequestHeader("Content-Type",p.contentType);p.ifModified&&(e=e||p.url,q.lastModified[e]&&u.setRequestHeader("If-Modified-Since",q.lastModified[e]),q.etag[e]&&u.setRequestHeader("If-None-Match",q.etag[e]));u.setRequestHeader("Accept",p.dataTypes[0]&&
p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Kb+"; q=0.01":""):p.accepts["*"]);for(o in p.headers)u.setRequestHeader(o,p.headers[o]);if(!p.beforeSend||!1!==p.beforeSend.call(M,u,p)&&2!==C){E="abort";for(o in{success:1,error:1,complete:1})u[o](p[o]);if(h=D(Jb,p,c,u)){u.readyState=1;n&&r.trigger("ajaxSend",[u,p]);p.async&&0<p.timeout&&(k=setTimeout(function(){u.abort("timeout")},p.timeout));try{C=1,h.send(y,d)}catch(ka){if(2>C)d(-1,ka);else throw ka;}}else d(-1,"No Transport");
return u}return u.abort()},active:0,lastModified:{},etag:{}});var Lb=[],Zb=/\?/,rb=/(=)\?(?=&|$)|\?\?/,$b=q.now();q.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Lb.pop()||q.expando+"_"+$b++;return this[a]=!0,a}});q.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,k=c.data,l=c.url,n=!1!==c.jsonp,o=n&&rb.test(l),p=n&&!o&&"string"==typeof k&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&rb.test(k);if("jsonp"===c.dataTypes[0]||o||p)return f=c.jsonpCallback=q.isFunction(c.jsonpCallback)?
c.jsonpCallback():c.jsonpCallback,g=a[f],o?c.url=l.replace(rb,"$1"+f):p?c.data=k.replace(rb,"$1"+f):n&&(c.url+=(Zb.test(l)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||q.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g;c[f]&&(c.jsonpCallback=d.jsonpCallback,Lb.push(f));h&&q.isFunction(g)&&g(h[0]);h=g=b}),"script"});q.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return q.globalEval(a),a}}});q.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1);a.crossDomain&&(a.type="GET",a.global=!1)});q.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=K.head||K.getElementsByTagName("head")[0]||K.documentElement;return{send:function(e,f){c=K.createElement("script");c.async="async";a.scriptCharset&&(c.charset=a.scriptCharset);c.src=a.url;c.onload=c.onreadystatechange=function(a,
e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")};d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Na,Fb=a.ActiveXObject?function(){for(var a in Na)Na[a](0,1)}:!1,ac=0;q.ajaxSettings.xhr=a.ActiveXObject?function(){var b;if(!(b=!this.isLocal&&C()))a:{try{b=new a.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}b=void 0}return b}:C;(function(a){q.extend(q.support,{ajax:!!a,
cors:!!a&&"withCredentials"in a})})(q.ajaxSettings.xhr());q.support.ajax&&q.ajaxTransport(function(c){if(!c.crossDomain||q.support.cors){var d;return{send:function(e,f){var g,h,k=c.xhr();c.username?k.open(c.type,c.url,c.async,c.username,c.password):k.open(c.type,c.url,c.async);if(c.xhrFields)for(h in c.xhrFields)k[h]=c.xhrFields[h];c.mimeType&&k.overrideMimeType&&k.overrideMimeType(c.mimeType);!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)k.setRequestHeader(h,
e[h])}catch(l){}k.send(c.hasContent&&c.data||null);d=function(a,e){var h,l,n,o,p;try{if(d&&(e||4===k.readyState))if(d=b,g&&(k.onreadystatechange=q.noop,Fb&&delete Na[g]),e)4!==k.readyState&&k.abort();else{h=k.status;n=k.getAllResponseHeaders();o={};p=k.responseXML;p&&p.documentElement&&(o.xml=p);try{o.text=k.responseText}catch(M){}try{l=k.statusText}catch(r){l=""}!h&&c.isLocal&&!c.crossDomain?h=o.text?200:404:1223===h&&(h=204)}}catch(D){e||f(-1,D)}o&&f(h,l,o,n)};c.async?4===k.readyState?setTimeout(d,
0):(g=++ac,Fb&&(Na||(Na={},q(a).unload(Fb)),Na[g]=d),k.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var fb,sb,bc=/^(?:toggle|show|hide)$/,cc=RegExp("^(?:([-+])=|)("+sa+")([a-z%]*)$","i"),dc=/queueHooks$/,gb=[function(a,b,c){var d,e,f,g,h,k,l=this,n=a.style,o={},p=[],M=a.nodeType&&w(a);c.queue||(h=q._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,k=h.empty.fire,h.empty.fire=function(){h.unqueued||k()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--;q.queue(a,"fx").length||
h.empty.fire()})}));1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],"inline"===q.css(a,"display")&&"none"===q.css(a,"float")&&(!q.support.inlineBlockNeedsLayout||"inline"===A(a.nodeName)?n.display="inline-block":n.zoom=1));c.overflow&&(n.overflow="hidden",q.support.shrinkWrapBlocks||l.done(function(){n.overflow=c.overflow[0];n.overflowX=c.overflow[1];n.overflowY=c.overflow[2]}));for(d in b)f=b[d],bc.exec(f)&&(delete b[d],f!==(M?"hide":"show")&&p.push(d));
if(b=p.length){f=q._data(a,"fxshow")||q._data(a,"fxshow",{});M?q(a).show():l.done(function(){q(a).hide()});l.done(function(){var b;q.removeData(a,"fxshow",!0);for(b in o)q.style(a,b,o[b])});for(d=0;d<b;d++)e=p[d],g=l.createTween(e,M?f[e]:0),o[e]=f[e]||q.style(a,e),e in f||(f[e]=g.start,M&&(g.end=g.start,g.start="width"===e||"height"===e?1:0))}}],Sa={"*":[function(a,b){var c,d,e,f=this.createTween(a,b),g=cc.exec(b),h=f.cur(),k=+h||0,l=1;if(g){c=+g[2];d=g[3]||(q.cssNumber[a]?"":"px");if("px"!==d&&k){k=
q.css(f.elem,a,!0)||c||1;do e=l=l||".5",k/=l,q.style(f.elem,a,k+d),l=f.cur()/h;while(1!==l&&l!==e)}f.unit=d;f.start=k;f.end=g[1]?k+(g[1]+1)*c:c}return f}]};q.Animation=q.extend(P,{tweener:function(a,b){q.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;d<e;d++)c=a[d],Sa[c]=Sa[c]||[],Sa[c].unshift(b)},prefilter:function(a,b){b?gb.unshift(a):gb.push(a)}});q.Tween=N;N.prototype={constructor:N,init:function(a,b,c,d,e,f){this.elem=a;this.prop=c;this.easing=e||"swing";this.options=b;
this.start=this.now=this.cur();this.end=d;this.unit=f||(q.cssNumber[c]?"":"px")},cur:function(){var a=N.propHooks[this.prop];return a&&a.get?a.get(this):N.propHooks._default.get(this)},run:function(a){var b,c=N.propHooks[this.prop];return this.pos=b=q.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration),this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):N.propHooks._default.set(this),this}};N.prototype.init.prototype=
N.prototype;N.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=q.css(a.elem,a.prop,!1,""),!b||"auto"===b?0:b):a.elem[a.prop]},set:function(a){q.fx.step[a.prop]?q.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[q.cssProps[a.prop]]||q.cssHooks[a.prop])?q.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};
q.each(["toggle","show","hide"],function(a,b){var c=q.fn[b];q.fn[b]=function(d,e,f){return null==d||"boolean"==typeof d||!a&&q.isFunction(d)&&q.isFunction(e)?c.apply(this,arguments):this.animate(L(b,!0),d,e,f)}});q.fn.extend({fadeTo:function(a,b,c,d){return this.filter(w).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=q.isEmptyObject(a),f=q.speed(b,c,d),b=function(){var b=P(this,q.extend({},a),f);e&&b.stop(!0)};return e||!1===f.queue?this.each(b):this.queue(f.queue,
b)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop;b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=q.timers,g=q._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&dc.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(null==a||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&q.dequeue(this,a)})}});q.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),
fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){q.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});q.speed=function(a,b,c){var d=a&&"object"==typeof a?q.extend({},a):{complete:c||!c&&b||q.isFunction(a)&&a,duration:a,easing:c&&b||b&&!q.isFunction(b)&&b};d.duration=q.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in q.fx.speeds?q.fx.speeds[d.duration]:q.fx.speeds._default;if(null==d.queue||!0===d.queue)d.queue="fx";return d.old=d.complete,
d.complete=function(){q.isFunction(d.old)&&d.old.call(this);d.queue&&q.dequeue(this,d.queue)},d};q.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}};q.timers=[];q.fx=N.prototype.init;q.fx.tick=function(){for(var a,b=q.timers,c=0;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||q.fx.stop()};q.fx.timer=function(a){a()&&q.timers.push(a)&&!sb&&(sb=setInterval(q.fx.tick,q.fx.interval))};q.fx.interval=13;q.fx.stop=function(){clearInterval(sb);sb=null};
q.fx.speeds={slow:600,fast:200,_default:400};q.fx.step={};q.expr&&q.expr.filters&&(q.expr.filters.animated=function(a){return q.grep(q.timers,function(b){return a===b.elem}).length});var Mb=/^(?:body|html)$/i;q.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){q.offset.setOffset(this,a,b)});var c,d,e,f,g,h,k,l,n,o,p=this[0],M=p&&p.ownerDocument;return!M?void 0:(e=M.body)===p?q.offset.bodyOffset(p):(d=M.documentElement,q.contains(d,p)?(c=p.getBoundingClientRect(),f=
S(M),g=d.clientTop||e.clientTop||0,h=d.clientLeft||e.clientLeft||0,k=f.pageYOffset||d.scrollTop,l=f.pageXOffset||d.scrollLeft,n=c.top+k-g,o=c.left+l-h,{top:n,left:o}):{top:0,left:0})};q.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return q.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(q.css(a,"marginTop"))||0,c+=parseFloat(q.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=q.css(a,"position");"static"===d&&(a.style.position="relative");var e=q(a),
f=e.offset(),g=q.css(a,"top"),h=q.css(a,"left"),k={},l={},n,o;("absolute"===d||"fixed"===d)&&-1<q.inArray("auto",[g,h])?(l=e.position(),n=l.top,o=l.left):(n=parseFloat(g)||0,o=parseFloat(h)||0);q.isFunction(b)&&(b=b.call(a,c,f));null!=b.top&&(k.top=b.top-f.top+n);null!=b.left&&(k.left=b.left-f.left+o);"using"in b?b.using.call(a,k):e.css(k)}};q.fn.extend({position:function(){if(this[0]){var a=this[0],b=this.offsetParent(),c=this.offset(),d=Mb.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=
parseFloat(q.css(a,"marginTop"))||0,c.left-=parseFloat(q.css(a,"marginLeft"))||0,d.top+=parseFloat(q.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(q.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||K.body;a&&!Mb.test(a.nodeName)&&"static"===q.css(a,"position");)a=a.offsetParent;return a||K.body})}});q.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);q.fn[a]=
function(e){return q.access(this,function(a,e,f){var g=S(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?q(g).scrollLeft():f,d?f:q(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}});q.each({Height:"height",Width:"width"},function(a,c){q.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){q.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(!0===e||!0===f?"margin":"border");return q.access(this,function(c,d,e){var f;return q.isWindow(c)?
c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?q.css(c,d,e,h):q.style(c,d,e,h)},c,g?e:b,g)}})});a.jQuery=a.$=q;"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return q})})(window);(function(a){var b=/[\.\/]/,c=function(){},d=function(a,b){return a-b},e,f,g={n:{}},h=function(a,b){var c=f,g=Array.prototype.slice.call(arguments,2),p=h.listeners(a),r=0,s,u=[],w={},v=[];e=a;f=0;for(var x=0,B=p.length;x<B;x++)"zIndex"in p[x]&&(u.push(p[x].zIndex),0>p[x].zIndex&&(w[p[x].zIndex]=p[x]));for(u.sort(d);0>u[r];)if(s=w[u[r++]],v.push(s.apply(b,g)),f)return f=c,v;for(x=0;x<B;x++)if(s=p[x],"zIndex"in s)if(s.zIndex==u[r]){v.push(s.apply(b,g));if(f)return f=c,v;do if(r++,s=w[u[r]],s&&v.push(s.apply(b,
g)),f)return f=c,v;while(s)}else w[s.zIndex]=s;else if(v.push(s.apply(b,g)),f)return f=c,v;f=c;return v.length?v:null};h.listeners=function(a){var a=a.split(b),c=g,d,e,f,h,s,u,w,v,x=[c],B=[];for(h=0,s=a.length;h<s;h++){v=[];for(u=0,w=x.length;u<w;u++)for(c=x[u].n,e=[c[a[h]],c["*"]],f=2;f--;)d=e[f],d&&(v.push(d),B=B.concat(d.f||[]));x=v}return B};h.on=function(a,d){for(var e=a.split(b),f=g,h=0,r=e.length;h<r;h++)f=f.n,!f[e[h]]&&(f[e[h]]={n:{}}),f=f[e[h]];f.f=f.f||[];for(h=0,r=f.f.length;h<r;h++)if(f.f[h]==
d)return c;f.f.push(d);return function(a){+a==+a&&(d.zIndex=+a)}};h.stop=function(){f=1};h.nt=function(a){return a?RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(e):e};h.unbind=function(a,c){for(var d=a.split(b),e,f,h,s=[g],u=0,w=d.length;u<w;u++)for(var v=0;v<s.length;v+=h.length-2){h=[v,1];e=s[v].n;if("*"!=d[u])e[d[u]]&&h.push(e[d[u]]);else for(f in e)e.hasOwnProperty(f)&&h.push(e[f]);s.splice.apply(s,h)}for(u=0,w=s.length;u<w;u++)for(e=s[u];e.n;){if(c){if(e.f){for(v=0,jj=e.f.length;v<jj;v++)if(e.f[v]==
c){e.f.splice(v,1);break}!e.f.length&&delete e.f}for(f in e.n)if(e.n.hasOwnProperty(f)&&e.n[f].f){d=e.n[f].f;for(v=0,jj=d.length;v<jj;v++)if(d[v]==c){d.splice(v,1);break}!d.length&&delete e.n[f].f}}else for(f in delete e.f,e.n)e.n.hasOwnProperty(f)&&e.n[f].f&&delete e.n[f].f;e=e.n}};h.version="0.3.2";h.toString=function(){return"You are running Eve 0.3.2"};"undefined"!=typeof module&&module.exports?module.exports=h:a.eve=h})(this);
(function(){function a(a,b,d,f,g,h){var d=T(d),l,o,p,q,s,C,E=a.ms,u={},w={},v={};if(f)for(F=0,x=Y.length;F<x;F++){var I=Y[F];if(I.el.id==b.id&&I.anim==a){I.percent!=d?(Y.splice(F,1),p=1):o=I;b.attr(I.totalOrigin);break}}else f=+w;for(var F=0,x=a.percents.length;F<x;F++){if(a.percents[F]==d||a.percents[F]>f*a.top){d=a.percents[F];s=a.percents[F-1]||0;E=E/a.top*(d-s);q=a.percents[F+1];l=a.anim[d];break}f&&b.attr(a.anim[a.percents[F]])}if(l){if(o)o.initstatus=f,o.start=new Date-o.ms*f;else{for(attr in l)if(l[r](attr)&&
(oa[r](attr)||b.paper.customAttributes[r](attr)))switch(u[attr]=b.attr(attr),null==u[attr]&&(u[attr]=na[attr]),w[attr]=l[attr],oa[attr]){case O:v[attr]=(w[attr]-u[attr])/E;break;case "colour":u[attr]=k.getRGB(u[attr]);F=k.getRGB(w[attr]);v[attr]={r:(F.r-u[attr].r)/E,g:(F.g-u[attr].g)/E,b:(F.b-u[attr].b)/E};break;case "path":var F=xa(u[attr],w[attr]),H=F[1];u[attr]=F[0];v[attr]=[];for(F=0,x=u[attr].length;F<x;F++){v[attr][F]=[0];for(var A=1,P=u[attr][F].length;A<P;A++)v[attr][F][A]=(H[F][A]-u[attr][F][A])/
E}break;case "transform":F=b._;if(H=Bb(F[attr],w[attr])){u[attr]=H.from;w[attr]=H.to;v[attr]=[];v[attr].real=!0;for(F=0,x=u[attr].length;F<x;F++){v[attr][F]=[u[attr][F][0]];for(A=1,P=u[attr][F].length;A<P;A++)v[attr][F][A]=(w[attr][F][A]-u[attr][F][A])/E}}else H=b.matrix||new e,F={_:{transform:F.transform},getBBox:function(){return b.getBBox(1)}},u[attr]=[H.a,H.b,H.c,H.d,H.e,H.f],Ab(F,w[attr]),w[attr]=F._.transform,v[attr]=[(F.matrix.a-H.a)/E,(F.matrix.b-H.b)/E,(F.matrix.c-H.c)/E,(F.matrix.d-H.d)/
E,(F.matrix.e-H.e)/E,(F.matrix.e-H.f)/E];break;case "csv":H=y(l[attr])[D](n);x=y(u[attr])[D](n);if("clip-rect"==attr)for(u[attr]=x,v[attr]=[],F=x.length;F--;)v[attr][F]=(H[F]-u[attr][F])/E;w[attr]=H;break;default:for(H=[][z](l[attr]),x=[][z](u[attr]),v[attr]=[],F=b.paper.customAttributes[attr].length;F--;)v[attr][F]=((H[F]||0)-(x[F]||0))/E}F=l.easing;H=k.easing_formulas[F];if(!H)if((H=y(F).match(G))&&5==H.length)var B=H,H=function(a){return c(a,+B[1],+B[2],+B[3],+B[4],E)};else H=ub;C=l.start||a.start||
+new Date;I={anim:a,percent:d,timestamp:C,start:C+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:E,easing:H,from:u,diff:v,to:w,el:b,callback:l.callback,prev:s,next:q,repeat:h||a.times,origin:b.attr(),totalOrigin:g};Y.push(I);if(f&&!o&&!p&&(I.stop=!0,I.start=new Date-E*f,1==Y.length))return Ya();p&&(I.start=new Date-I.ms*f);1==Y.length&&qb(Ya)}eve("anim.start."+b.id,b,a)}}function b(a,b){var c=[],d={};this.ms=b;this.times=1;if(a){for(var e in a)a[r](e)&&(d[T(e)]=a[e],c.push(T(e)));c.sort($a)}this.anim=
d;this.top=c[c.length-1];this.percents=c}function c(a,b,c,d,e,f){function g(a,b){var c,d,e,f;for(e=a,d=0;8>d;d++){f=((l*e+k)*e+h)*e-a;if(N(f)<b)return e;c=(3*l*e+2*k)*e+h;if(1.0E-6>N(c))break;e-=f/c}c=0;d=1;e=a;if(e<c)return c;if(e>d)return d;for(;c<d;){f=((l*e+k)*e+h)*e;if(N(f-a)<b)break;a>f?c=e:d=e;e=(d-c)/2+c}return e}var h=3*b,k=3*(d-b)-h,l=1-h-k,n=3*c,o=3*(e-c)-n,p=1-n-o;return function(a,b){var c=g(a,b);return((p*c+o)*c+n)*c}(a,1/(200*f))}function d(){return this.x+J+this.y+J+this.width+" \u00d7 "+
this.height}function e(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function f(a){for(var b=[],c=0,d=a.length;d-2>c;c+=2){var e=[{x:+a[c],y:+a[c+1]},{x:+a[c],y:+a[c+1]},{x:+a[c+2],y:+a[c+3]},{x:+a[c+4],y:+a[c+5]}];d-4==c?(e[0]={x:+a[c-2],y:+a[c-1]},e[3]=e[2]):c&&(e[0]={x:+a[c-2],y:+a[c-1]});b.push(["C",(-e[0].x+6*e[1].x+e[2].x)/6,(-e[0].y+6*e[1].y+e[2].y)/6,(e[1].x+6*e[2].x-e[3].x)/6,(e[1].y+6*e[2].y-e[3].y)/
6,e[2].x,e[2].y])}return b}function g(){return this.hex}function h(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("\u2400"),g=d.cache=d.cache||{},h=d.count=d.count||[];if(g[r](f)){a:for(var e=h,h=f,k=0,l=e.length;k<l;k++)if(e[k]===h){e.push(e.splice(k,1)[0]);break a}return c?c(g[f]):g[f]}1E3<=h.length&&delete g[h.shift()];h.push(f);g[f]=a[B](b,e);return c?c(g[f]):g[f]}return d}function k(a){if(k.is(a,"function"))return l?a():eve.on("DOMload",a);if(k.is(a,Q)){for(var b=
a,c=k._engine.create[B](k,b.splice(0,3+k.is(b[0],O))),d=c.set(),e=0,f=b.length,g;e<f;e++)g=b[e]||{},o[r](g.type)&&d.push(c[g.type]().attr(g));return d}var h=Array.prototype.slice.call(arguments,0);if(k.is(h[h.length-1],"function")){var n=h.pop();return l?n.call(k._engine.create[B](k,h)):eve.on("DOMload",function(){n.call(k._engine.create[B](k,h))})}return k._engine.create[B](k,arguments)}k.version="2.0.0";k.eve=eve;var l,n=/[, ]+/,o={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},p=/\{(\d+)\}/g,
r="hasOwnProperty",s={doc:document,win:window},u=Object.prototype[r].call(s.win,"Raphael"),w=s.win.Raphael,v=function(){this.ca=this.customAttributes={}},x,B="apply",z="concat",A="createTouch"in s.doc,J=" ",y=String,D="split",E="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[D](J),C={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},F=y.prototype.toLowerCase,I=Math,P=I.max,H=I.min,N=I.abs,L=I.pow,S=I.PI,O="number",Q="array",
K=Object.prototype.toString;k._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i;var ba=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,X={NaN:1,Infinity:1,"-Infinity":1},G=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,ca=I.round,T=parseFloat,
R=parseInt,aa=y.prototype.toUpperCase,na=k._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,
"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},oa=k._availableAnimAttrs={blur:O,"clip-rect":"csv",cx:O,cy:O,fill:"colour","fill-opacity":O,"font-size":O,height:O,opacity:O,path:"path",r:O,rx:O,ry:O,stroke:"colour","stroke-opacity":O,"stroke-width":O,transform:"transform",width:O,x:O,y:O},la=/\s*,\s*/,q={hs:1,rg:1},sa=/,?([achlmqrstvxz]),?/gi,pa=/([achlmrqstvz])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,ta=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,
Za=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)\s*,?\s*/ig;k._radial_gradient=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/;var Aa={},$a=function(a,b){return T(a)-T(b)},tb=function(){},ub=function(a){return a},Oa=k._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},ab=function(a,b,c,d){null==d&&(d=c);return[["M",a,b],["m",0,
-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},Pa=k._getPath={path:function(a){return a.attr("path")},circle:function(a){a=a.attrs;return ab(a.cx,a.cy,a.r)},ellipse:function(a){a=a.attrs;return ab(a.cx,a.cy,a.rx,a.ry)},rect:function(a){a=a.attrs;return Oa(a.x,a.y,a.width,a.height,a.r)},image:function(a){a=a.attrs;return Oa(a.x,a.y,a.width,a.height)},text:function(a){a=a._getBBox();return Oa(a.x,a.y,a.width,a.height)}},bb=k.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,a=xa(a);for(e=
0,ii=a.length;e<ii;e++){g=a[e];for(f=1,jj=g.length;f<jj;f+=2)c=b.x(g[f],g[f+1]),d=b.y(g[f],g[f+1]),g[f]=c,g[f+1]=d}return a};k._g=s;k.type=s.win.SVGAngle||s.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if("VML"==k.type){var Qa=s.doc.createElement("div"),wa;Qa.innerHTML='<v:shape adj="1"/>';wa=Qa.firstChild;wa.style.behavior="url(#default#VML)";if(!wa||"object"!=typeof wa.adj)return k.type="";Qa=null}k.svg=!(k.vml="VML"==k.type);k._Paper=v;k.fn=
x=v.prototype=k.prototype;k._id=0;k._oid=0;k.is=function(a,b){b=F.call(b);return"finite"==b?!X[r](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||K.call(a).slice(8,-1).toLowerCase()==b};k.angle=function(a,b,c,d,e,f){return null==e?(a-=c,b-=d,!a&&!b?0:(180*I.atan2(-b,-a)/S+540)%360):k.angle(a,b,e,f)-k.angle(c,d,e,f)};k.rad=function(a){return a%360*S/180};k.deg=function(a){return 180*a/S%360};k.snapTo=
function(a,b,c){c=k.is(c,"finite")?c:10;if(k.is(a,Q))for(var d=a.length;d--;){if(N(a[d]-b)<=c)return a[d]}else{a=+a;d=b%a;if(d<c)return b-d;if(d>a-c)return b-d+a}return b};k.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*I.random()|0;return("x"==a?b:b&3|8).toString(16)});k.setWindow=function(a){eve("setWindow",k,s.win,a);s.win=a;s.doc=s.win.document;initWin&&initWin(s.win)};var Ca=function(a){if(k.vml){var b=
/^\s+|\s+$/g,c;try{var d=new ActiveXObject("htmlfile");d.write("<body>");d.close();c=d.body}catch(e){c=createPopup().document.body}var f=c.createTextRange();Ca=h(function(a){try{c.style.color=y(a).replace(b,"");var d=f.queryCommandValue("ForeColor");return"#"+("000000"+((d&255)<<16|d&65280|(d&16711680)>>>16).toString(16)).slice(-6)}catch(e){return"none"}})}else{var g=s.doc.createElement("i");g.title="Rapha\u00ebl Colour Picker";g.style.display="none";s.doc.body.appendChild(g);Ca=h(function(a){g.style.color=
a;return s.doc.defaultView.getComputedStyle(g,"").getPropertyValue("color")})}return Ca(a)},cb=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},db=function(){return this.hex},qa=function(a,b,c){null==b&&k.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(c=a.b,b=a.g,a=a.r);null==b&&k.is(a,"string")&&(c=k.getRGB(a),a=c.r,b=c.g,c=c.b);if(1<a||1<b||1<c)a/=255,b/=255,c/=255;return[a,b,c]},Ta=function(a,b,c,d){a*=255;b*=255;c*=255;a={r:a,g:b,b:c,hex:k.rgb(a,
b,c),toString:db};k.is(d,"finite")&&(a.opacity=d);return a};k.color=function(a){var b;k.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=k.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):k.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=k.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(k.is(a,"string")&&(a=k.getRGB(a)),k.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=k.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=k.rgb2hsb(a),a.v=b.b):(a={hex:"none"},crl.r=a.g=a.b=a.h=a.s=a.v=a.l=-1));a.toString=db;return a};k.hsb2rgb=
function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o);a*=360;var e,f,g,h,k;a=a%360/60;k=c*b;h=k*(1-N(a%2-1));e=f=g=c-k;a=~~a;e+=[k,h,0,0,h,k][a];f+=[h,k,k,h,0,0][a];g+=[0,0,h,k,k,h][a];return Ta(e,f,g,d)};k.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h);if(1<a||1<b||1<c)a/=360,b/=100,c/=100;var a=360*a,e,f,g,h,k;a=a%360/60;k=2*b*(0.5>c?c:1-c);h=k*(1-N(a%2-1));e=f=g=c-k/2;a=~~a;e+=[k,h,0,0,h,k][a];f+=[h,k,k,h,0,0][a];
g+=[0,0,h,k,k,h][a];return Ta(e,f,g,d)};k.rgb2hsb=function(a,b,c){c=qa(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f;e=P(a,b,c);f=e-H(a,b,c);d=0==f?null:e==a?(b-c)/f:e==b?(c-a)/f+2:(a-b)/f+4;d=60*((d+360)%6)/360;a=0==f?0:f/e;return{h:d,s:a,b:e,toString:cb}};k.rgb2hsl=function(a,b,c){c=qa(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f,g,h;f=P(a,b,c);g=H(a,b,c);h=f-g;d=0==h?null:f==a?(b-c)/h:f==b?(c-a)/h+2:(a-b)/h+4;d=60*((d+360)%6)/360;e=(f+g)/2;a=0==h?0:0.5>e?h/(2*e):h/(2-2*e);return{h:d,s:a,l:e,toString:wb}};k._path2string=
function(){return this.join(",").replace(sa,"$1")};k._preload=function(a,b){var c=s.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top-9999em";c.onload=function(){b.call(this);this.onload=null;s.doc.body.removeChild(this)};c.onerror=function(){s.doc.body.removeChild(this)};s.doc.body.appendChild(c);c.src=a};k.getRGB=h(function(a){if(!a||(a=y(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!q[r](a.toLowerCase().substring(0,
2))&&"#"!=a.charAt()&&(a=Ca(a));var b,c,d,e,f,h;if(a=a.match(ba)){a[2]&&(d=R(a[2].substring(5),16),c=R(a[2].substring(3,5),16),b=R(a[2].substring(1,3),16));a[3]&&(d=R((f=a[3].charAt(3))+f,16),c=R((f=a[3].charAt(2))+f,16),b=R((f=a[3].charAt(1))+f,16));a[4]&&(h=a[4][D](la),b=T(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),c=T(h[1]),"%"==h[1].slice(-1)&&(c*=2.55),d=T(h[2]),"%"==h[2].slice(-1)&&(d*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(e=T(h[3])),h[3]&&"%"==h[3].slice(-1)&&(e/=100));if(a[5])return h=a[5][D](la),
b=T(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),c=T(h[1]),"%"==h[1].slice(-1)&&(c*=2.55),d=T(h[2]),"%"==h[2].slice(-1)&&(d*=2.55),("deg"==h[0].slice(-3)||"\u00b0"==h[0].slice(-1))&&(b/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(e=T(h[3])),h[3]&&"%"==h[3].slice(-1)&&(e/=100),k.hsb2rgb(b,c,d,e);if(a[6])return h=a[6][D](la),b=T(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),c=T(h[1]),"%"==h[1].slice(-1)&&(c*=2.55),d=T(h[2]),"%"==h[2].slice(-1)&&(d*=2.55),("deg"==h[0].slice(-3)||"\u00b0"==h[0].slice(-1))&&(b/=360),
"hsla"==a[1].toLowerCase().slice(0,4)&&(e=T(h[3])),h[3]&&"%"==h[3].slice(-1)&&(e/=100),k.hsl2rgb(b,c,d,e);a={r:b,g:c,b:d,toString:g};a.hex="#"+(16777216|d|c<<8|b<<16).toString(16).slice(1);k.is(e,"finite")&&(a.opacity=e);return a}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},k);k.hsb=h(function(a,b,c){return k.hsb2rgb(a,b,c).hex});k.hsl=h(function(a,b,c){return k.hsl2rgb(a,b,c).hex});k.rgb=h(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});k.getColor=function(a){var a=
this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75},b=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;1<a.h&&(a.h=0,a.s-=0.2,0>=a.s&&(this.getColor.start={h:0,s:1,b:a.b}));return b.hex};k.getColor.reset=function(){delete this.start};k.parsePathString=h(function(a){if(!a)return null;var b={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},c=[];k.is(a,Q)&&k.is(a[0],Q)&&(c=za(a));c.length||y(a).replace(pa,function(a,d,e){var f=[],a=d.toLowerCase();e.replace(Za,function(a,b){b&&f.push(+b)});"m"==a&&2<f.length&&
(c.push([d][z](f.splice(0,2))),a="l",d="m"==d?"l":"L");if("r"==a)c.push([d][z](f));else for(;f.length>=b[a]&&!(c.push([d][z](f.splice(0,b[a]))),!b[a]););});c.toString=k._path2string;return c});k.parseTransformString=h(function(a){if(!a)return null;var b=[];k.is(a,Q)&&k.is(a[0],Q)&&(b=za(a));b.length||y(a).replace(ta,function(a,c,d){var e=[];F.call(c);d.replace(Za,function(a,b){b&&e.push(+b)});b.push([c][z](e))});b.toString=k._path2string;return b});k.findDotsAtSegment=function(a,b,c,d,e,f,g,h,k){var l=
1-k,n=L(l,3),o=L(l,2),p=k*k,q=p*k,r=n*a+3*o*k*c+3*l*k*k*e+q*g,n=n*b+3*o*k*d+3*l*k*k*f+q*h,o=a+2*k*(c-a)+p*(e-2*c+a),q=b+2*k*(d-b)+p*(f-2*d+b),D=c+2*k*(e-c)+p*(g-2*e+c),p=d+2*k*(f-d)+p*(h-2*f+d),a=l*a+k*c,b=l*b+k*d,e=l*e+k*g,f=l*f+k*h,h=90-180*I.atan2(o-D,q-p)/S;(o>D||q<p)&&(h+=180);return{x:r,y:n,m:{x:o,y:q},n:{x:D,y:p},start:{x:a,y:b},end:{x:e,y:f},alpha:h}};var Ua=h(function(a){if(!a)return{x:0,y:0,width:0,height:0};for(var a=xa(a),b=0,c=0,d=[],e=[],f,g=0,h=a.length;g<h;g++)f=a[g],"M"==f[0]?(b=
f[1],c=f[2],d.push(b),e.push(c)):(b=kb(b,c,f[1],f[2],f[3],f[4],f[5],f[6]),d=d[z](b.min.x,b.max.x),e=e[z](b.min.y,b.max.y),b=f[5],c=f[6]);a=H[B](0,d);f=H[B](0,e);return{x:a,y:f,width:P[B](0,d)-a,height:P[B](0,e)-f}},null,function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}}),za=function(a){var b=[];if(!k.is(a,Q)||!k.is(a&&a[0],Q))a=k.parsePathString(a);for(var c=0,d=a.length;c<d;c++){b[c]=[];for(var e=0,f=a[c].length;e<f;e++)b[c][e]=a[c][e]}b.toString=k._path2string;return b},zb=k._pathToRelative=
h(function(a){if(!k.is(a,Q)||!k.is(a&&a[0],Q))a=k.parsePathString(a);var b=[],c=0,d=0,e=0,f=0,g=0;"M"==a[0][0]&&(c=a[0][1],d=a[0][2],e=c,f=d,g++,b.push(["M",c,d]));for(var h=a.length;g<h;g++){var l=b[g]=[],n=a[g];if(n[0]!=F.call(n[0]))switch(l[0]=F.call(n[0]),l[0]){case "a":l[1]=n[1];l[2]=n[2];l[3]=n[3];l[4]=n[4];l[5]=n[5];l[6]=+(n[6]-c).toFixed(3);l[7]=+(n[7]-d).toFixed(3);break;case "v":l[1]=+(n[1]-d).toFixed(3);break;case "m":e=n[1],f=n[2];default:for(var o=1,p=n.length;o<p;o++)l[o]=+(n[o]-(o%
2?c:d)).toFixed(3)}else{b[g]=[];"m"==n[0]&&(e=n[1]+c,f=n[2]+d);l=0;for(o=n.length;l<o;l++)b[g][l]=n[l]}n=b[g].length;switch(b[g][0]){case "z":c=e;d=f;break;case "h":c+=+b[g][n-1];break;case "v":d+=+b[g][n-1];break;default:c+=+b[g][n-2],d+=+b[g][n-1]}}b.toString=k._path2string;return b},0,za),hb=k._pathToAbsolute=h(function(a){if(!k.is(a,Q)||!k.is(a&&a[0],Q))a=k.parsePathString(a);if(!a||!a.length)return[["M",0,0]];var b=[],c=0,d=0,e=0,g=0,h=0;"M"==a[0][0]&&(c=+a[0][1],d=+a[0][2],e=c,g=d,h++,b[0]=
["M",c,d]);for(var l,n=h,o=a.length;n<o;n++){b.push(h=[]);l=a[n];if(l[0]!=aa.call(l[0]))switch(h[0]=aa.call(l[0]),h[0]){case "A":h[1]=l[1];h[2]=l[2];h[3]=l[3];h[4]=l[4];h[5]=l[5];h[6]=+(l[6]+c);h[7]=+(l[7]+d);break;case "V":h[1]=+l[1]+d;break;case "H":h[1]=+l[1]+c;break;case "R":for(var p=[c,d][z](l.slice(1)),q=2,r=p.length;q<r;q++)p[q]=+p[q]+c,p[++q]=+p[q]+d;b.pop();b=b[z](f(p));break;case "M":e=+l[1]+c,g=+l[2]+d;default:for(q=1,r=l.length;q<r;q++)h[q]=+l[q]+(q%2?c:d)}else if("R"==l[0])p=[c,d][z](l.slice(1)),
b.pop(),b=b[z](f(p)),h=["R"][z](l.slice(-2));else{q=0;for(r=l.length;q<r;q++)h[q]=l[q]}switch(h[0]){case "Z":c=e;d=g;break;case "H":c=h[1];break;case "V":d=h[1];break;case "M":e=h[h.length-2],g=h[h.length-1];default:c=h[h.length-2],d=h[h.length-1]}}b.toString=k._path2string;return b},null,za),ib=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},jb=function(a,b,c,d,e,f,g,k,l,n){var o=120*S/180,p=S/180*(+e||0),q=[],r,s=h(function(a,b,c){var d=a*I.cos(c)-b*I.sin(c),a=
a*I.sin(c)+b*I.cos(c);return{x:d,y:a}});if(n)E=n[0],r=n[1],f=n[2],y=n[3];else{r=s(a,b,-p);a=r.x;b=r.y;r=s(k,l,-p);k=r.x;l=r.y;I.cos(S/180*e);I.sin(S/180*e);r=(a-k)/2;E=(b-l)/2;y=r*r/(c*c)+E*E/(d*d);1<y&&(y=I.sqrt(y),c*=y,d*=y);var y=c*c,C=d*d,y=(f==g?-1:1)*I.sqrt(N((y*C-y*E*E-C*r*r)/(y*E*E+C*r*r))),f=y*c*E/d+(a+k)/2,y=y*-d*r/c+(b+l)/2,E=I.asin(((b-y)/d).toFixed(9));r=I.asin(((l-y)/d).toFixed(9));E=a<f?S-E:E;r=k<f?S-r:r;0>E&&(E=2*S+E);0>r&&(r=2*S+r);g&&E>r&&(E-=2*S);!g&&r>E&&(r-=2*S)}if(N(r-E)>o){var q=
r,C=k,u=l;r=E+o*(g&&r>E?1:-1);k=f+c*I.cos(r);l=y+d*I.sin(r);q=jb(k,l,c,d,e,0,g,C,u,[r,q,f,y])}f=r-E;e=I.cos(E);o=I.sin(E);g=I.cos(r);r=I.sin(r);f=I.tan(f/4);c=4/3*c*f;f*=4/3*d;d=[a,b];a=[a+c*o,b-f*e];b=[k+c*r,l-f*g];k=[k,l];a[0]=2*d[0]-a[0];a[1]=2*d[1]-a[1];if(n)return[a,b,k][z](q);q=[a,b,k][z](q).join()[D](",");n=[];k=0;for(l=q.length;k<l;k++)n[k]=k%2?s(q[k-1],q[k],p).y:s(q[k],q[k+1],p).x;return n},Da=function(a,b,c,d,e,f,g,h,k){var l=1-k;return{x:L(l,3)*a+3*L(l,2)*k*c+3*l*k*k*e+L(k,3)*g,y:L(l,3)*
b+3*L(l,2)*k*d+3*l*k*k*f+L(k,3)*h}},kb=h(function(a,b,c,d,e,f,g,h){var k=e-2*c+a-(g-2*e+c),l=2*(c-a)-2*(e-c),n=a-c,o=(-l+I.sqrt(l*l-4*k*n))/2/k,p=(-l-I.sqrt(l*l-4*k*n))/2/k,q=[b,h],r=[a,g],D;"1e12"<N(o)&&(o=0.5);"1e12"<N(p)&&(p=0.5);0<o&&1>o&&(D=Da(a,b,c,d,e,f,g,h,o),r.push(D.x),q.push(D.y));0<p&&1>p&&(D=Da(a,b,c,d,e,f,g,h,p),r.push(D.x),q.push(D.y));k=f-2*d+b-(h-2*f+d);l=2*(d-b)-2*(f-d);n=b-d;o=(-l+I.sqrt(l*l-4*k*n))/2/k;p=(-l-I.sqrt(l*l-4*k*n))/2/k;"1e12"<N(o)&&(o=0.5);"1e12"<N(p)&&(p=0.5);0<o&&
1>o&&(D=Da(a,b,c,d,e,f,g,h,o),r.push(D.x),q.push(D.y));0<p&&1>p&&(D=Da(a,b,c,d,e,f,g,h,p),r.push(D.x),q.push(D.y));return{min:{x:H[B](0,r),y:H[B](0,q)},max:{x:P[B](0,r),y:P[B](0,q)}}}),xa=k._path2curve=h(function(a,b){var c=hb(a),d=b&&hb(b),e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g=function(a,b){var c,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null);switch(a[0]){case "M":b.X=a[1];b.Y=a[2];break;case "A":a=["C"][z](jb[B](0,
[b.x,b.y][z](a.slice(1))));break;case "S":c=b.x+(b.x-(b.bx||b.x));d=b.y+(b.y-(b.by||b.y));a=["C",c,d][z](a.slice(1));break;case "T":b.qx=b.x+(b.x-(b.qx||b.x));b.qy=b.y+(b.y-(b.qy||b.y));a=["C"][z](ib(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case "Q":b.qx=a[1];b.qy=a[2];a=["C"][z](ib(b.x,b.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"][z]([b.x,b.y,a[1],a[2],a[1],a[2]]);break;case "H":a=["C"][z]([b.x,b.y,a[1],b.y,a[1],b.y]);break;case "V":a=["C"][z]([b.x,b.y,b.x,a[1],b.x,a[1]]);break;case "Z":a=["C"][z]([b.x,
b.y,b.X,b.Y,b.X,b.Y])}return a},h=function(a,b){if(7<a[b].length){a[b].shift();for(var e=a[b];e.length;)a.splice(b++,0,["C"][z](e.splice(0,6)));a.splice(b,1);n=P(c.length,d&&d.length||0)}},k=function(a,b,e,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),e.bx=0,e.by=0,e.x=a[g][1],e.y=a[g][2],n=P(c.length,d&&d.length||0))},l=0,n=P(c.length,d&&d.length||0);for(;l<n;l++){c[l]=g(c[l],e);h(c,l);d&&(d[l]=g(d[l],f));d&&h(d,l);k(c,d,e,f,l);k(d,c,f,e,l);var o=c[l],p=d&&d[l],q=o.length,r=
d&&p.length;e.x=o[q-2];e.y=o[q-1];e.bx=T(o[q-4])||e.x;e.by=T(o[q-3])||e.y;f.bx=d&&(T(p[r-4])||f.x);f.by=d&&(T(p[r-3])||f.y);f.x=d&&p[r-2];f.y=d&&p[r-1]}return d?[c,d]:c},null,za);k._parseDots=h(function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e={},f=a[c].match(/^([^:]*):?([\d\.]*)/);e.color=k.getRGB(f[1]);if(e.color.error)return null;e.color=e.color.hex;f[2]&&(e.offset=f[2]+"%");b.push(e)}for(c=1,d=b.length-1;c<d;c++)if(!b[c].offset){a=T(b[c-1].offset||0);f=0;for(e=c+1;e<d;e++)if(b[e].offset){f=
b[e].offset;break}f||(f=100,e=d);f=T(f);for(f=(f-a)/(e-c+1);c<e;c++)a+=f,b[c].offset=a+"%"}return b});var Ea=k._tear=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)};k._tofront=function(a,b){b.top!==a&&(Ea(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)};k._toback=function(a,b){b.bottom!==a&&(Ea(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)};k._insertafter=function(a,b,c){Ea(a,c);b==c.top&&(c.top=a);
b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=a};k._insertbefore=function(a,b,c){Ea(a,c);b==c.bottom&&(c.bottom=a);b.prev&&(b.prev.next=a);a.prev=b.prev;b.prev=a;a.next=b};var Ab=k._extractTransform=function(a,b){if(null==b)return a._.transform;var b=y(b).replace(/\.{3}|\u2026/g,a._.transform||""),c=k.parseTransformString(b),d=0,f=0,g=0,h=1,l=1,n=a._,o=new e;n.transform=c||[];if(c)for(var p=0,q=c.length;p<q;p++){var r=c[p],D=r.length,s=y(r[0]).toLowerCase(),E=r[0]!=s,C=E?o.invert():0,u,F,
w,v,I;"t"==s&&3==D?E?(u=C.x(0,0),F=C.y(0,0),w=C.x(r[1],r[2]),v=C.y(r[1],r[2]),o.translate(w-u,v-F)):o.translate(r[1],r[2]):"r"==s?2==D?(I=I||a.getBBox(1),o.rotate(r[1],I.x+I.width/2,I.y+I.height/2),d+=r[1]):4==D&&(E?(w=C.x(r[2],r[3]),v=C.y(r[2],r[3]),o.rotate(r[1],w,v)):o.rotate(r[1],r[2],r[3]),d+=r[1]):"s"==s?2==D||3==D?(I=I||a.getBBox(1),o.scale(r[1],r[D-1],I.x+I.width/2,I.y+I.height/2),h*=r[1],l*=r[D-1]):5==D&&(E?(w=C.x(r[3],r[4]),v=C.y(r[3],r[4]),o.scale(r[1],r[2],w,v)):o.scale(r[1],r[2],r[3],
r[4]),h*=r[1],l*=r[2]):"m"==s&&7==D&&o.add(r[1],r[2],r[3],r[4],r[5],r[6]);n.dirtyT=1;a.matrix=o}a.matrix=o;n.sx=h;n.sy=l;n.deg=d;n.dx=f=o.e;n.dy=g=o.f;1==h&&1==l&&!d&&n.bbox?(n.bbox.x+=+f,n.bbox.y+=+g):n.dirtyT=1},lb=function(a){var b=a[0];switch(b.toLowerCase()){case "t":return[b,0,0];case "m":return[b,1,0,0,1,0,0];case "r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case "s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Bb=k._equaliseTransform=function(a,b){b=y(b).replace(/\.{3}|\u2026/g,
a);a=k.parseTransformString(a)||[];b=k.parseTransformString(b)||[];for(var c=P(a.length,b.length),d=[],e=[],f=0,g,h,l,n;f<c;f++){l=a[f]||lb(b[f]);n=b[f]||lb(l);if(l[0]!=n[0]||"r"==l[0].toLowerCase()&&(l[2]!=n[2]||l[3]!=n[3])||"s"==l[0].toLowerCase()&&(l[3]!=n[3]||l[4]!=n[4]))return;d[f]=[];e[f]=[];for(g=0,h=P(l.length,n.length);g<h;g++)g in l&&(d[f][g]=l[g]),g in n&&(e[f][g]=n[g])}return{from:d,to:e}};k._getContainer=function(a,b,c,d){var e;e=null==d&&!k.is(a,"object")?s.doc.getElementById(a):a;if(null!=
e)return e.tagName?null==b?{container:e,width:e.style.pixelWidth||e.offsetWidth,height:e.style.pixelHeight||e.offsetHeight}:{container:e,width:b,height:c}:{container:1,x:a,y:b,width:c,height:d}};k.pathToRelative=zb;k._engine={};k.path2curve=xa;k.matrix=function(a,b,c,d,f,g){return new e(a,b,c,d,f,g)};(function(a){function b(a){var d=I.sqrt(c(a));a[0]&&(a[0]/=d);a[1]&&(a[1]/=d)}function c(a){return a[0]*a[0]+a[1]*a[1]}a.add=function(a,b,c,d,f,g){var h=[[],[],[]],k=[[this.a,this.c,this.e],[this.b,this.d,
this.f],[0,0,1]],b=[[a,c,f],[b,d,g],[0,0,1]];a&&a instanceof e&&(b=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]);for(a=0;3>a;a++)for(c=0;3>c;c++){for(d=f=0;3>d;d++)f+=k[a][d]*b[d][c];h[a][c]=f}this.a=h[0][0];this.b=h[1][0];this.c=h[0][1];this.d=h[1][1];this.e=h[0][2];this.f=h[1][2]};a.invert=function(){var a=this.a*this.d-this.b*this.c;return new e(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*this.f)/a)};a.clone=function(){return new e(this.a,this.b,this.c,
this.d,this.e,this.f)};a.translate=function(a,b){this.add(1,0,0,1,a,b)};a.scale=function(a,b,c,d){null==b&&(b=a);(c||d)&&this.add(1,0,0,1,c,d);this.add(a,0,0,b,0,0);(c||d)&&this.add(1,0,0,1,-c,-d)};a.rotate=function(a,b,c){a=k.rad(a);b=b||0;c=c||0;var d=+I.cos(a).toFixed(9),a=+I.sin(a).toFixed(9);this.add(d,a,-a,d,b,c);this.add(1,0,0,1,-b,-c)};a.x=function(a,b){return a*this.a+b*this.c+this.e};a.y=function(a,b){return a*this.b+b*this.d+this.f};a.get=function(a){return+this[y.fromCharCode(97+a)].toFixed(4)};
a.toString=function(){return k.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};a.split=function(){var a=
{};a.dx=this.e;a.dy=this.f;var d=[[this.a,this.c],[this.b,this.d]];a.scalex=I.sqrt(c(d[0]));b(d[0]);a.shear=d[0][0]*d[1][0]+d[0][1]*d[1][1];d[1]=[d[1][0]-d[0][0]*a.shear,d[1][1]-d[0][1]*a.shear];a.scaley=I.sqrt(c(d[1]));b(d[1]);a.shear/=a.scaley;var e=-d[0][1],d=d[1][1];0>d?(a.rotate=k.deg(I.acos(d)),0>e&&(a.rotate=360-a.rotate)):a.rotate=k.deg(I.asin(e));a.isSimple=!+a.shear.toFixed(9)&&(a.scalex.toFixed(9)==a.scaley.toFixed(9)||!a.rotate);a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==
a.scaley.toFixed(9)&&!a.rotate;a.noRotation=!+a.shear.toFixed(9)&&!a.rotate;return a};a.toTransformString=function(a){a=a||this[D]();return a.isSimple?"t"+[a.dx,a.dy]+"s"+[a.scalex,a.scaley,0,0]+"r"+[a.rotate,0,0]:"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}})(e.prototype);var Fa=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(Fa&&4>Fa[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==
navigator.vendor&&Fa&&8>Fa[1]?x.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:x.safari=tb;for(var mb=function(){this.returnValue=!1},Cb=function(){return this.originalEvent.preventDefault()},Db=function(){this.cancelBubble=!0},xb=function(){return this.originalEvent.stopPropagation()},nb=function(){if(s.doc.addEventListener)return function(a,b,c,d){var e=A&&C[b]?C[b]:b,f=function(e){var f=e.clientX+(s.doc.documentElement.scrollLeft||
s.doc.body.scrollLeft),g=e.clientY+(s.doc.documentElement.scrollTop||s.doc.body.scrollTop);if(A&&C[r](b))for(var h=0,k=e.targetTouches&&e.targetTouches.length;h<k;h++)if(e.targetTouches[h].target==a){k=e;e=e.targetTouches[h];e.originalEvent=k;e.preventDefault=Cb;e.stopPropagation=xb;break}return c.call(d,e,f,g)};a.addEventListener(e,f,!1);return function(){a.removeEventListener(e,f,!1);return!0}};if(s.doc.attachEvent)return function(a,b,c,d){var e=function(a){var a=a||s.win.event,b=a.clientX+(s.doc.documentElement.scrollLeft||
s.doc.body.scrollLeft),e=a.clientY+(s.doc.documentElement.scrollTop||s.doc.body.scrollTop);a.preventDefault=a.preventDefault||mb;a.stopPropagation=a.stopPropagation||Db;return c.call(d,a,b,e)};a.attachEvent("on"+b,e);return function(){a.detachEvent("on"+b,e);return!0}}}(),ma=[],Ja=function(a){for(var b=a.clientX,c=a.clientY,d=s.doc.documentElement.scrollTop||s.doc.body.scrollTop,e=s.doc.documentElement.scrollLeft||s.doc.body.scrollLeft,f,g=ma.length;g--;){f=ma[g];if(A)for(var h=a.touches.length,k;h--;){if(k=
a.touches[h],k.identifier==f.el._drag.id){b=k.clientX;c=k.clientY;(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var h=f.el.node,l;k=h.nextSibling;var n=h.parentNode,o=h.style.display;s.win.opera&&n.removeChild(h);h.style.display="none";l=f.el.paper.getElementByPoint(b,c);h.style.display=o;s.win.opera&&(k?n.insertBefore(h,k):n.appendChild(h));l&&eve("drag.over."+f.el.id,f.el,l);b+=e;c+=d;eve("drag.move."+f.el.id,f.move_scope||f.el,b-f.el._drag.x,c-f.el._drag.y,
b,c,a)}},Va=function(a){k.unmousemove(Ja).unmouseup(Va);for(var b=ma.length,c;b--;)c=ma[b],c.el._drag={},eve("drag.end."+c.el.id,c.end_scope||c.start_scope||c.move_scope||c.el,a);ma=[]},W=k.el={},Wa=E.length;Wa--;)(function(a){k[a]=W[a]=function(b,c){k.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:nb(this.shape||this.node||s.doc,a,b,c||this)}));return this};k["un"+a]=W["un"+a]=function(b){for(var c=this.events,d=c.length;d--;)if(c[d].name==a&&c[d].f==b){c[d].unbind();
c.splice(d,1);!c.length&&delete this.events;break}return this}})(E[Wa]);W.data=function(a,b){var c=Aa[this.id]=Aa[this.id]||{};if(1==arguments.length){if(k.is(a,"object")){for(var d in a)a[r](d)&&this.data(d,a[d]);return this}eve("data.get."+this.id,this,c[a],a);return c[a]}c[a]=b;eve("data.set."+this.id,this,b,a);return this};W.removeData=function(a){null==a?Aa[this.id]={}:Aa[this.id]&&delete Aa[this.id][a];return this};W.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)};W.unhover=
function(a,b){return this.unmouseover(a).unmouseout(b)};W.drag=function(a,b,c,d,e,f){this._drag={};this.mousedown(function(g){(g.originalEvent||g).preventDefault();var h=s.doc.documentElement.scrollTop||s.doc.body.scrollTop,l=s.doc.documentElement.scrollLeft||s.doc.body.scrollLeft;this._drag.x=g.clientX+l;this._drag.y=g.clientY+h;this._drag.id=g.identifier;!ma.length&&k.mousemove(Ja).mouseup(Va);ma.push({el:this,move_scope:d,start_scope:e,end_scope:f});b&&eve.on("drag.start."+this.id,b);a&&eve.on("drag.move."+
this.id,a);c&&eve.on("drag.end."+this.id,c);eve("drag.start."+this.id,e||d||this,g.clientX+l,g.clientY+h,g)});return this};W.onDragOver=function(a){a?eve.on("drag.over."+this.id,a):eve.unbind("drag.over."+this.id)};W.undrag=function(){for(var a=ma.length;a--;)ma[a].el==this&&(k.unmousedown(ma[a].start),ma.splice(a++,1),eve.unbind("drag.*."+this.id));!ma.length&&k.unmousemove(Ja).unmouseup(Va)};x.circle=function(a,b,c){a=k._engine.circle(this,a||0,b||0,c||0);this.__set__&&this.__set__.push(a);return a};
x.rect=function(a,b,c,d,e){a=k._engine.rect(this,a||0,b||0,c||0,d||0,e||0);this.__set__&&this.__set__.push(a);return a};x.ellipse=function(a,b,c,d){a=k._engine.ellipse(this,a||0,b||0,c||0,d||0);this.__set__&&this.__set__.push(a);return a};x.path=function(a){a&&!k.is(a,"string")&&!k.is(a[0],Q)&&(a+="");var b=k._engine.path(k.format[B](k,arguments),this);this.__set__&&this.__set__.push(b);return b};x.image=function(a,b,c,d,e){a=k._engine.image(this,a||"about:blank",b||0,c||0,d||0,e||0);this.__set__&&
this.__set__.push(a);return a};x.text=function(a,b,c){a=k._engine.text(this,a||0,b||0,y(c));this.__set__&&this.__set__.push(a);return a};x.set=function(a){!k.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new ya(a);this.__set__&&this.__set__.push(b);return b};x.setStart=function(a){this.__set__=a||this.set()};x.setFinish=function(){var a=this.__set__;delete this.__set__;return a};x.setSize=function(a,b){return k._engine.setSize.call(this,a,b)};x.setViewBox=function(a,
b,c,d,e){return k._engine.setViewBox.call(this,a,b,c,d,e)};x.top=x.bottom=null;x.raphael=k;x.getElementByPoint=function(a,b){var c,d,e=this.canvas,f=s.doc.elementFromPoint(a,b);if(s.win.opera&&"svg"==f.tagName){d=e.getBoundingClientRect();c=e.ownerDocument;var g=c.body,h=c.documentElement;c=d.top+(s.win.pageYOffset||h.scrollTop||g.scrollTop)-(h.clientTop||g.clientTop||0);d=d.left+(s.win.pageXOffset||h.scrollLeft||g.scrollLeft)-(h.clientLeft||g.clientLeft||0);g=e.createSVGRect();g.x=a-d;g.y=b-c;g.width=
g.height=1;c=e.getIntersectionList(g,null);c.length&&(f=c[c.length-1])}if(!f)return null;for(;f.parentNode&&f!=e.parentNode&&!f.raphael;)f=f.parentNode;f==this.canvas.parentNode&&(f=e);f=f&&f.raphael?this.getById(f.raphaelid):null;return f};x.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null};x.forEach=function(a,b){for(var c=this.bottom;c&&!(!1===a.call(b,c));)c=c.next;return this};W.getBBox=function(a){if(this.removed)return{};var b=this._;if(a){if(b.dirty||
!b.bboxwt)this.realPath=Pa[this.type](this),b.bboxwt=Ua(this.realPath),b.bboxwt.toString=d,b.dirty=0;return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath)b.bboxwt=0,this.realPath=Pa[this.type](this);b.bbox=Ua(bb(this.realPath,this.matrix));b.bbox.toString=d;b.dirty=b.dirtyT=0}return b.bbox};W.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(a);return a};W.glow=function(a){if("text"==this.type)return null;
for(var a=a||{},b=(a.width||10)+(+this.attr("stroke-width")||1),c=a.fill||!1,d=a.opacity||0.5,e=a.offsetx||0,f=a.offsety||0,a=a.color||"#000",g=b/2,h=this.paper,k=h.set(),l=this.realPath||Pa[this.type](this),l=this.matrix?bb(l,this.matrix):l,n=1;n<g+1;n++)k.push(h.path(l).attr({stroke:a,fill:c?a:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b/g*n).toFixed(3),opacity:+(d/g).toFixed(3)}));return k.insertBefore(this).translate(e,f)};var Ka={},La=function(a,b,c,d,e,f,g,h,
l){var n=0,o=100,p=[a,b,c,d,e,f,g,h].join(),r=Ka[p],q,D;!r&&(Ka[p]=r={data:[]});r.timer&&clearTimeout(r.timer);r.timer=setTimeout(function(){delete Ka[p]},2E3);if(null!=l&&!r.precision){var s=La(a,b,c,d,e,f,g,h);r.precision=10*~~s;r.data=[]}o=r.precision||o;for(s=0;s<o+1;s++){r.data[s*o]?D=r.data[s*o]:(D=k.findDotsAtSegment(a,b,c,d,e,f,g,h,s/o),r.data[s*o]=D);s&&(n+=L(L(q.x-D.x,2)+L(q.y-D.y,2),0.5));if(null!=l&&n>=l)return D;q=D}if(null==l)return n},Xa=function(a,b){return function(c,d,e){for(var c=
xa(c),f,g,h,l,n="",o={},p,r=0,q=0,D=c.length;q<D;q++){h=c[q];if("M"==h[0])f=+h[1],g=+h[2];else{l=La(f,g,h[1],h[2],h[3],h[4],h[5],h[6]);if(r+l>d){if(b&&!o.start){p=La(f,g,h[1],h[2],h[3],h[4],h[5],h[6],d-r);n+=["C"+p.start.x,p.start.y,p.m.x,p.m.y,p.x,p.y];if(e)return n;o.start=n;n=["M"+p.x,p.y+"C"+p.n.x,p.n.y,p.end.x,p.end.y,h[5],h[6]].join();r+=l;f=+h[5];g=+h[6];continue}if(!a&&!b)return p=La(f,g,h[1],h[2],h[3],h[4],h[5],h[6],d-r),{x:p.x,y:p.y,alpha:p.alpha}}r+=l;f=+h[5];g=+h[6]}n+=h.shift()+h}o.end=
n;p=a?r:b?o:k.findDotsAtSegment(f,g,h[0],h[1],h[2],h[3],h[4],h[5],1);p.alpha&&(p={x:p.x,y:p.y,alpha:p.alpha});return p}},ob=Xa(1),pb=Xa(),Ga=Xa(0,1);k.getTotalLength=ob;k.getPointAtLength=pb;k.getSubpath=function(a,b,c){if(1.0E-6>this.getTotalLength(a)-c)return Ga(a,b).end;a=Ga(a,c,1);return b?Ga(a,b).end:a};W.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?this.node.getTotalLength():ob(this.attrs.path)};W.getPointAtLength=function(a){if("path"==this.type)return pb(this.attrs.path,
a)};W.getSubpath=function(a,b){if("path"==this.type)return k.getSubpath(this.attrs.path,a,b)};var ja=k.easing_formulas={linear:function(a){return a},"<":function(a){return L(a,1.7)},">":function(a){return L(a,0.48)},"<>":function(a){var b=0.48-a/1.04,c=I.sqrt(0.1734+b*b),a=c-b,a=L(N(a),1/3)*(0>a?-1:1),b=-c-b,b=L(N(b),1/3)*(0>b?-1:1),a=a+b+0.5;return 3*(1-a)*a*a+a*a*a},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==
!!a?a:L(2,-10*a)*I.sin(2*(a-0.075)*S/0.3)+1},bounce:function(a){var b;a<1/2.75?b=7.5625*a*a:a<2/2.75?(a-=1.5/2.75,b=7.5625*a*a+0.75):a<2.5/2.75?(a-=2.25/2.75,b=7.5625*a*a+0.9375):(a-=2.625/2.75,b=7.5625*a*a+0.984375);return b}};ja.easeIn=ja["ease-in"]=ja["<"];ja.easeOut=ja["ease-out"]=ja[">"];ja.easeInOut=ja["ease-in-out"]=ja["<>"];ja["back-in"]=ja.backIn;ja["back-out"]=ja.backOut;var Y=[],qb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){setTimeout(a,16)},Ya=function(){for(var b=+new Date,c=0;c<Y.length;c++){var d=Y[c];if(!d.el.removed&&!d.paused){var e=b-d.start,f=d.ms,g=d.easing,h=d.from,l=d.diff,n=d.to,o=d.el,p={},q,D={},s;d.initstatus?(e=(d.initstatus*d.anim.top-d.prev)/(d.percent-d.prev)*f,d.status=d.initstatus,delete d.initstatus,d.stop&&Y.splice(c--,1)):d.status=(d.prev+(d.percent-d.prev)*(e/f))/d.anim.top;if(!(0>e))if(e<f){var y=g(e/f),C;for(C in h)if(h[r](C)){switch(oa[C]){case O:q=
+h[C]+y*f*l[C];break;case "colour":q="rgb("+[ia(ca(h[C].r+y*f*l[C].r)),ia(ca(h[C].g+y*f*l[C].g)),ia(ca(h[C].b+y*f*l[C].b))].join()+")";break;case "path":q=[];e=0;for(g=h[C].length;e<g;e++){q[e]=[h[C][e][0]];n=1;for(D=h[C][e].length;n<D;n++)q[e][n]=+h[C][e][n]+y*f*l[C][e][n];q[e]=q[e].join(J)}q=q.join(J);break;case "transform":if(l[C].real){q=[];for(e=0,g=h[C].length;e<g;e++){q[e]=[h[C][e][0]];for(n=1,D=h[C][e].length;n<D;n++)q[e][n]=h[C][e][n]+y*f*l[C][e][n]}}else q=function(a){return+h[C][a]+y*f*
l[C][a]},q=[["m",q(0),q(1),q(2),q(3),q(4),q(5)]];break;case "csv":if("clip-rect"==C)for(q=[],e=4;e--;)q[e]=+h[C][e]+y*f*l[C][e];break;default:g=[][z](h[C]);for(q=[],e=o.paper.customAttributes[C].length;e--;)q[e]=+g[e]+y*f*l[C][e]}p[C]=q}o.attr(p);(function(a,b,c){setTimeout(function(){eve("anim.frame."+a,b,c)})})(o.id,o,d.anim)}else{(function(a,b,c){setTimeout(function(){eve("anim.frame."+b.id,b,c);eve("anim.finish."+b.id,b,c);k.is(a,"function")&&a.call(b)})})(d.callback,o,d.anim);o.attr(n);Y.splice(c--,
1);if(1<d.repeat&&!d.next){for(s in n)n[r](s)&&(D[s]=d.totalOrigin[s]);d.el.attr(D);a(d.anim,d.el,d.anim.percents[0],null,d.totalOrigin,d.repeat-1)}d.next&&!d.stop&&a(d.anim,d.el,d.next,null,d.totalOrigin,d.repeat)}}}k.svg&&o&&o.paper&&o.paper.safari();Y.length&&qb(Ya)},ia=function(a){return 255<a?255:0>a?0:a};W.animateWith=function(a,b,c,d,e,f){c=c?k.animation(c,d,e,f):b;status=a.status(b);return this.animate(c).status(c,status*b.ms/c.ms)};W.onAnimation=function(a){a?eve.on("anim.frame."+this.id,
a):eve.unbind("anim.frame."+this.id);return this};b.prototype.delay=function(a){var c=new b(this.anim,this.ms);c.times=this.times;c.del=+a||0;return c};b.prototype.repeat=function(a){var c=new b(this.anim,this.ms);c.del=this.del;c.times=I.floor(P(a,0))||1;return c};k.animation=function(a,c,d,e){if(a instanceof b)return a;if(k.is(d,"function")||!d)e=e||d||null,d=null;a=Object(a);c=+c||0;var f={},g,h;for(h in a)a[r](h)&&T(h)!=h&&T(h)+"%"!=h&&(g=!0,f[h]=a[h]);if(!g)return new b(a,c);d&&(f.easing=d);
e&&(f.callback=e);return new b({100:f},c)};W.animate=function(c,d,e,f){if(this.removed)return f&&f.call(this),this;c=c instanceof b?c:k.animation(c,d,e,f);a(c,this,c.percents[0],null,this.attr());return this};W.setTime=function(a,b){a&&null!=b&&this.status(a,H(b,a.ms)/a.ms);return this};W.status=function(b,c){var d=[],e=0,f,g;if(null!=c)return a(b,this,-1,H(c,1)),this;for(f=Y.length;e<f;e++)if(g=Y[e],g.el.id==this.id&&(!b||g.anim==b)){if(b)return g.status;d.push({anim:g.anim,status:g.status})}return b?
0:d};W.pause=function(a){for(var b=0;b<Y.length;b++)Y[b].el.id==this.id&&(!a||Y[b].anim==a)&&!1!==eve("anim.pause."+this.id,this,Y[b].anim)&&(Y[b].paused=!0);return this};W.resume=function(a){for(var b=0;b<Y.length;b++)if(Y[b].el.id==this.id&&(!a||Y[b].anim==a)){var c=Y[b];!1!==eve("anim.resume."+this.id,this,c.anim)&&(delete c.paused,this.status(c.anim,c.status))}return this};W.stop=function(a){for(var b=0;b<Y.length;b++)Y[b].el.id==this.id&&(!a||Y[b].anim==a)&&!1!==eve("anim.stop."+this.id,this,
Y[b].anim)&&Y.splice(b--,1);return this};W.toString=function(){return"Rapha\u00ebl\u2019s object"};var ya=function(a){this.items=[];this.length=0;this.type="set";if(a)for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].constructor==W.constructor||a[b].constructor==ya)&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},ha=ya.prototype;ha.push=function(){for(var a,b,c=0,d=arguments.length;c<d;c++)a=arguments[c],a&&(a.constructor==W.constructor||a.constructor==ya)&&(b=this.items.length,
this[b]=this.items[b]=a,this.length++);return this};ha.pop=function(){this.length&&delete this[this.length--];return this.items.pop()};ha.forEach=function(a,b){for(var c=0,d=this.items.length;c<d&&!(!1===a.call(b,this.items[c],c));c++);return this};for(var ea in W)W[r](ea)&&(ha[ea]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][B](c,b)})}}(ea));ha.attr=function(a,b){if(a&&k.is(a,Q)&&k.is(a[0],"object"))for(var c=0,d=a.length;c<d;c++)this.items[c].attr(a[c]);else{c=
0;for(d=this.items.length;c<d;c++)this.items[c].attr(a,b)}return this};ha.clear=function(){for(;this.length;)this.pop()};ha.splice=function(a,b,c){a=0>a?P(this.length+a,0):a;b=P(0,H(this.length-a,b));var d=[],e=[],f=[],g;for(g=2;g<arguments.length;g++)f.push(arguments[g]);for(g=0;g<b;g++)e.push(this[a+g]);for(;g<this.length-a;g++)d.push(this[a+g]);var h=f.length;for(g=0;g<h+d.length;g++)this.items[a+g]=this[a+g]=g<h?f[g]:d[g-h];for(g=this.items.length=this.length-=b-h;this[g];)delete this[g++];return new ya(e)};
ha.exclude=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]==a)return this.splice(b,1),!0};ha.animate=function(a,b,c,d){(k.is(c,"function")||!c)&&(d=c||null);var e=this.items.length,f=e,g=this,h;if(!e)return this;d&&(h=function(){!--e&&d.call(g)});c=k.is(c,"string")?c:h;b=k.animation(a,b,c,h);for(a=this.items[--f].animate(b);f--;)this.items[f]&&!this.items[f].removed&&this.items[f].animateWith(a,b);return this};ha.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);
return this};ha.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x);b.push(f.y);c.push(f.x+f.width);d.push(f.y+f.height)}a=H[B](0,a);b=H[B](0,b);return{x:a,y:b,width:P[B](0,c)-a,height:P[B](0,d)-b}};ha.clone=function(a){for(var a=new ya,b=0,c=this.items.length;b<c;b++)a.push(this.items[b].clone());return a};ha.toString=function(){return"Rapha\u00ebl\u2018s set"};k.registerFont=function(a){if(!a.face)return a;
this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"],d;for(d in a.face)a.face[r](d)&&(b.face[d]=a.face[d]);this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b];if(!a.svg){b.face["units-per-em"]=R(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[r](e)&&(c=a.glyphs[e],b.glyphs[e]={w:c.w,k:{},d:c.d&&"M"+c.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},c.k))for(var f in c.k)c[r](f)&&(b.glyphs[e].k[f]=c.k[f])}return a};
x.getFont=function(a,b,c,d){d=d||"normal";c=c||"normal";b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400;if(k.fonts){var e=k.fonts[a];if(!e){var a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i"),f;for(f in k.fonts)if(k.fonts[r](f)&&a.test(f)){e=k.fonts[f];break}}var g;if(e){f=0;for(a=e.length;f<a&&!(g=e[f],g.face["font-weight"]==b&&(g.face["font-style"]==c||!g.face["font-style"])&&g.face["font-stretch"]==d);f++);}return g}};x.print=function(a,b,c,d,e,f,g){f=f||"middle";
g=P(H(g||0,1),-1);var h=this.set(),l=y(c)[D](""),o=0;k.is(d,c)&&(d=this.getFont(d));if(d){for(var c=(e||16)/d.face["units-per-em"],p=d.face.bbox[D](n),e=+p[0],f=+p[1]+("baseline"==f?p[3]-p[1]+ +d.face.descent:(p[3]-p[1])/2),p=0,r=l.length;p<r;p++){var q=p&&d.glyphs[l[p-1]]||{},s=d.glyphs[l[p]];o+=p?(q.w||d.w)+(q.k&&q.k[l[p]]||0)+d.w*g:0;s&&s.d&&h.push(this.path(s.d).attr({fill:"#000",stroke:"none",transform:[["t",o*c,0]]}))}h.transform(["...s",c,c,e,f,"t",(a-e)/c,(b-f)/c])}return h};k.format=function(a,
b){var c=k.is(b,Q)?[0][z](b):arguments;a&&k.is(a,"string")&&c.length-1&&(a=a.replace(p,function(a,b){return null==c[++b]?"":c[b]}));return a||""};k.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;c.replace(b,function(a,b,c,d,f){b=b||d;e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))});e=(null==e||e==d?a:e)+"";return e};return function(b,d){return(""+b).replace(a,function(a,b){return c(a,b,d)})}}();k.ninja=function(){u?
s.win.Raphael=w:delete Raphael;return k};k.st=ha;(function(a,b,c){function d(){/in/.test(a.readyState)?setTimeout(d,9):k.eve("DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,c=function(){a.removeEventListener(b,c,!1);a.readyState="complete"},!1),a.readyState="loading");d()})(document,"DOMContentLoaded");u?s.win.Raphael=k:Raphael=k;eve.on("DOMload",function(){l=!0})})();
window.Raphael.svg&&function(a){var b=String,c=parseFloat,d=parseInt,e=Math,f=e.max,g=e.abs,h=e.pow,k=/[, ]+/,l=a.eve,n={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},o={};a.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var p=function(c,d){if(d){"string"==typeof c&&(c=p(c));for(var e in d)d.hasOwnProperty(e)&&("xlink:"==
e.substring(0,6)?c.setAttributeNS("http://www.w3.org/1999/xlink",e.substring(6),b(d[e])):c.setAttribute(e,b(d[e])))}else c=a._g.doc.createElementNS("http://www.w3.org/2000/svg",c),c.style&&(c.style.webkitTapHighlightColor="rgba(0,0,0,0)");return c},r=function(d,k){var l="linear",n=d.id+k,o=0.5,r=0.5,s=d.node,y=d.paper,u=s.style,w=a._g.doc.getElementById(n);if(!w){k=b(k).replace(a._radial_gradient,function(a,b,d){l="radial";b&&d&&(o=c(b),r=c(d),a=2*(0.5<r)-1,0.25<h(o-0.5,2)+h(r-0.5,2)&&(r=e.sqrt(0.25-
h(o-0.5,2))*a+0.5)&&0.5!=r&&(r=r.toFixed(5)-1.0E-5*a));return""});k=k.split(/\s*\-\s*/);if("linear"==l){var v=k.shift(),v=-c(v);if(isNaN(v))return null;var x=[0,0,e.cos(a.rad(v)),e.sin(a.rad(v))],v=1/(f(g(x[2]),g(x[3]))||1);x[2]*=v;x[3]*=v;0>x[2]&&(x[0]=-x[2],x[2]=0);0>x[3]&&(x[1]=-x[3],x[3]=0)}v=a._parseDots(k);if(!v)return null;d.gradient&&(y.defs.removeChild(d.gradient),delete d.gradient);n=n.replace(/[\(\)\s,\xb0#]/g,"-");w=p(l+"Gradient",{id:n});d.gradient=w;p(w,"radial"==l?{fx:o,fy:r}:{x1:x[0],
y1:x[1],x2:x[2],y2:x[3],gradientTransform:d.matrix.invert()});y.defs.appendChild(w);y=0;for(x=v.length;y<x;y++)w.appendChild(p("stop",{offset:v[y].offset?v[y].offset:y?"100%":"0%","stop-color":v[y].color||"#fff"}))}p(s,{fill:"url(#"+n+")",opacity:1,"fill-opacity":1});u.fill="";u.opacity=1;u.fillOpacity=1;return 1},s=function(a){var b=a.getBBox(1);p(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},u=function(c,d,e){if("path"==c.type){for(var f=b(d).toLowerCase().split("-"),
g=c.paper,h=e?"end":"start",k=c.node,l=c.attrs,r=l["stroke-width"],s=f.length,y="classic",u,w,v,x,z,A=3,B=3,R=5;s--;)switch(f[s]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":y=f[s];break;case "wide":B=5;break;case "narrow":B=2;break;case "long":A=5;break;case "short":A=2}"open"==y?(A+=2,B+=2,R+=2,v=1,x=e?4:1,z={fill:"none",stroke:l.stroke}):(x=v=A/2,z={fill:l.stroke,stroke:"none"});c._.arrows?e?(c._.arrows.endPath&&o[c._.arrows.endPath]--,c._.arrows.endMarker&&o[c._.arrows.endMarker]--):
(c._.arrows.startPath&&o[c._.arrows.startPath]--,c._.arrows.startMarker&&o[c._.arrows.startMarker]--):c._.arrows={};if("none"!=y){f="raphael-marker-"+y;s="raphael-marker-"+h+y+A+B;a._g.doc.getElementById(f)?o[f]++:(g.defs.appendChild(p(p("path"),{"stroke-linecap":"round",d:n[y],id:f})),o[f]=1);var J=a._g.doc.getElementById(s),na;J?(o[s]++,na=J.getElementsByTagName("use")[0]):(J=p(p("marker"),{id:s,markerHeight:B,markerWidth:A,orient:"auto",refX:x,refY:B/2}),na=p(p("use"),{"xlink:href":"#"+f,transform:(e?
" rotate(180 "+A/2+" "+B/2+") ":" ")+"scale("+A/R+","+B/R+")","stroke-width":1/((A/R+B/R)/2)}),J.appendChild(na),g.defs.appendChild(J),o[s]=1);p(na,z);g=v*("diamond"!=y&&"oval"!=y);e?(u=c._.arrows.startdx*r||0,w=a.getTotalLength(l.path)-g*r):(u=g*r,w=a.getTotalLength(l.path)-(c._.arrows.enddx*r||0));z={};z["marker-"+h]="url(#"+s+")";if(w||u)z.d=Raphael.getSubpath(l.path,u,w);p(k,z);c._.arrows[h+"Path"]=f;c._.arrows[h+"Marker"]=s;c._.arrows[h+"dx"]=g;c._.arrows[h+"Type"]=y;c._.arrows[h+"String"]=d}else e?
(u=c._.arrows.startdx*r||0,w=a.getTotalLength(l.path)-u):(u=0,w=a.getTotalLength(l.path)-(c._.arrows.enddx*r||0)),c._.arrows[h+"Path"]&&p(k,{d:Raphael.getSubpath(l.path,u,w)}),delete c._.arrows[h+"Path"],delete c._.arrows[h+"Marker"],delete c._.arrows[h+"dx"],delete c._.arrows[h+"Type"],delete c._.arrows[h+"String"];for(z in o)o.hasOwnProperty(z)&&!o[z]&&(c=a._g.doc.getElementById(z))&&c.parentNode.removeChild(c)}},w={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,
3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=w[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",d={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,f=[],g=c.length;g--;)f[g]=c[g]*e+(g%2?1:-1)*d;p(a.node,{"stroke-dasharray":f.join(",")})}},x=function(c,e){var h=c.node,l=c.attrs,n=h.style.visibility;h.style.visibility="hidden";for(var o in e)if(e.hasOwnProperty(o)&&a._availableAttrs.hasOwnProperty(o)){var y=
e[o];l[o]=y;switch(o){case "blur":c.blur(y);break;case "href":case "title":case "target":var w=h.parentNode;if("a"!=w.tagName.toLowerCase()){var x=p("a");w.insertBefore(x,h);x.appendChild(h);w=x}"target"==o&&"blank"==y?w.setAttributeNS("http://www.w3.org/1999/xlink","show","new"):w.setAttributeNS("http://www.w3.org/1999/xlink",o,y);break;case "cursor":h.style.cursor=y;break;case "transform":c.transform(y);break;case "arrow-start":u(c,y);break;case "arrow-end":u(c,y,1);break;case "clip-rect":w=b(y).split(k);
if(4==w.length){c.clip&&c.clip.parentNode.parentNode.removeChild(c.clip.parentNode);var x=p("clipPath"),z=p("rect");x.id=a.createUUID();p(z,{x:w[0],y:w[1],width:w[2],height:w[3]});x.appendChild(z);c.paper.defs.appendChild(x);p(h,{"clip-path":"url(#"+x.id+")"});c.clip=z}y||(y=a._g.doc.getElementById(h.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,"")),y&&y.parentNode.removeChild(y),p(h,{"clip-path":""}),delete c.clip);break;case "path":"path"==c.type&&(p(h,{d:y?l.path=a._pathToAbsolute(y):"M0,0"}),
c._.dirty=1,c._.arrows&&("startString"in c._.arrows&&u(c,c._.arrows.startString),"endString"in c._.arrows&&u(c,c._.arrows.endString,1)));break;case "width":if(h.setAttribute(o,y),c._.dirty=1,l.fx)o="x",y=l.x;else break;case "x":l.fx&&(y=-l.x-(l.width||0));case "rx":if("rx"==o&&"rect"==c.type)break;case "cx":h.setAttribute(o,y);c.pattern&&s(c);c._.dirty=1;break;case "height":if(h.setAttribute(o,y),c._.dirty=1,l.fy)o="y",y=l.y;else break;case "y":l.fy&&(y=-l.y-(l.height||0));case "ry":if("ry"==o&&"rect"==
c.type)break;case "cy":h.setAttribute(o,y);c.pattern&&s(c);c._.dirty=1;break;case "r":"rect"==c.type?p(h,{rx:y,ry:y}):h.setAttribute(o,y);c._.dirty=1;break;case "src":"image"==c.type&&h.setAttributeNS("http://www.w3.org/1999/xlink","href",y);break;case "stroke-width":if(1!=c._.sx||1!=c._.sy)y/=f(g(c._.sx),g(c._.sy))||1;c.paper._vbSize&&(y*=c.paper._vbSize);h.setAttribute(o,y);l["stroke-dasharray"]&&v(c,l["stroke-dasharray"],e);c._.arrows&&("startString"in c._.arrows&&u(c,c._.arrows.startString),"endString"in
c._.arrows&&u(c,c._.arrows.endString,1));break;case "stroke-dasharray":v(c,y,e);break;case "fill":var A=b(y).match(a._ISURL);if(A){var x=p("pattern"),J=p("image");x.id=a.createUUID();p(x,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});p(J,{x:0,y:0,"xlink:href":A[1]});x.appendChild(J);(function(b){a._preload(A[1],function(){var a=this.offsetWidth,d=this.offsetHeight;p(b,{width:a,height:d});p(J,{width:a,height:d});c.paper.safari()})})(x);c.paper.defs.appendChild(x);h.style.fill="url(#"+x.id+
")";p(h,{fill:"url(#"+x.id+")"});c.pattern=x;c.pattern&&s(c);break}var K=a.getRGB(y);if(K.error){if(("circle"==c.type||"ellipse"==c.type||"r"!=b(y).charAt())&&r(c,y)){if("opacity"in l||"fill-opacity"in l){var ba=a._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,""));if(ba){var X=ba.getElementsByTagName("stop");p(X[X.length-1],{"stop-opacity":("opacity"in l?l.opacity:1)*("fill-opacity"in l?l["fill-opacity"]:1)})}}l.gradient=y;l.fill="none";break}}else delete e.gradient,delete l.gradient,
!a.is(l.opacity,"undefined")&&a.is(e.opacity,"undefined")&&p(h,{opacity:l.opacity}),!a.is(l["fill-opacity"],"undefined")&&a.is(e["fill-opacity"],"undefined")&&p(h,{"fill-opacity":l["fill-opacity"]});K.hasOwnProperty("opacity")&&p(h,{"fill-opacity":1<K.opacity?K.opacity/100:K.opacity});case "stroke":K=a.getRGB(y);h.setAttribute(o,K.hex);"stroke"==o&&K.hasOwnProperty("opacity")&&p(h,{"stroke-opacity":1<K.opacity?K.opacity/100:K.opacity});"stroke"==o&&c._.arrows&&("startString"in c._.arrows&&u(c,c._.arrows.startString),
"endString"in c._.arrows&&u(c,c._.arrows.endString,1));break;case "gradient":("circle"==c.type||"ellipse"==c.type||"r"!=b(y).charAt())&&r(c,y);break;case "opacity":l.gradient&&!l.hasOwnProperty("stroke-opacity")&&p(h,{"stroke-opacity":1<y?y/100:y});case "fill-opacity":if(l.gradient){ba=a._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,""));ba&&(X=ba.getElementsByTagName("stop"),p(X[X.length-1],{"stop-opacity":y}));break}default:"font-size"==o&&(y=d(y,10)+"px"),w=o.replace(/(\-.)/g,
function(a){return a.substring(1).toUpperCase()}),h.style[w]=y,c._.dirty=1,h.setAttribute(o,y)}}B(c,e);h.style.visibility=n},B=function(c,e){if("text"==c.type&&(e.hasOwnProperty("text")||e.hasOwnProperty("font")||e.hasOwnProperty("font-size")||e.hasOwnProperty("x")||e.hasOwnProperty("y"))){var f=c.attrs,g=c.node,h=g.firstChild?d(a._g.doc.defaultView.getComputedStyle(g.firstChild,"").getPropertyValue("font-size"),10):10;if(e.hasOwnProperty("text")){for(f.text=e.text;g.firstChild;)g.removeChild(g.firstChild);
for(var k=b(e.text).split("\n"),l=[],n,o=0,r=k.length;o<r;o++)n=p("tspan"),o&&p(n,{dy:1.2*h,x:f.x}),n.appendChild(a._g.doc.createTextNode(k[o])),g.appendChild(n),l[o]=n}else{l=g.getElementsByTagName("tspan");for(o=0,r=l.length;o<r;o++)o?p(l[o],{dy:1.2*h,x:f.x}):p(l[0],{dy:0})}p(g,{x:f.x,y:f.y});c._.dirty=1;g=c._getBBox();(f=f.y-(g.y+g.height/2))&&a.is(f,"finite")&&p(l[0],{dy:f})}},z=function(b,c){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.matrix=a.matrix();this.realPath=
null;this.paper=c;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!c.bottom&&(c.bottom=this);this.prev=c.top;c.top&&(c.top.next=this);c.top=this;this.next=null},A=a.el;z.prototype=A;A.constructor=z;a._engine.path=function(a,b){var c=p("path");b.canvas&&b.canvas.appendChild(c);c=new z(c,b);c.type="path";x(c,{fill:"none",stroke:"#000",path:a});return c};A.rotate=function(a,d,e){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]));a=c(a[0]);
null==e&&(d=e);if(null==d||null==e)e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2;this.transform(this._.transform.concat([["r",a,d,e]]));return this};A.scale=function(a,d,e,f){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]),f=c(a[3]));a=c(a[0]);null==d&&(d=a);null==f&&(e=f);if(null==e||null==f)var g=this.getBBox(1);e=null==e?g.x+g.width/2:e;f=null==f?g.y+g.height/2:f;this.transform(this._.transform.concat([["s",a,d,e,f]]));return this};A.translate=function(a,d){if(this.removed)return this;
a=b(a).split(k);a.length-1&&(d=c(a[1]));a=c(a[0])||0;d=+d||0;this.transform(this._.transform.concat([["t",a,d]]));return this};A.transform=function(b){var c=this._;if(null==b)return c.transform;a._extractTransform(this,b);this.clip&&p(this.clip,{transform:this.matrix.invert()});this.pattern&&s(this);this.node&&p(this.node,{transform:this.matrix});if(1!=c.sx||1!=c.sy)this.attr({"stroke-width":this.attrs.hasOwnProperty("stroke-width")?this.attrs["stroke-width"]:1});return this};A.hide=function(){!this.removed&&
this.paper.safari(this.node.style.display="none");return this};A.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};A.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this);l.unbind("*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);for(var b in this)delete this[b];this.removed=!0}};A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=
b||{}}a&&this.hide();return b};A.attr=function(b,c){if(this.removed)return this;if(null==b){var d={},e;for(e in this.attrs)this.attrs.hasOwnProperty(e)&&(d[e]=this.attrs[e]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==c&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;e=b.split(k);for(var d={},f=0,g=e.length;f<g;f++)b=e[f],b in this.attrs?
d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return g-1?d:d[e[0]]}if(null==c&&a.is(b,"array")){d={};for(f=0,g=b.length;f<g;f++)d[b[f]]=this.attr(b[f]);return d}null!=c?(d={},d[b]=c):null!=b&&a.is(b,"object")&&(d=b);for(f in d)l("attr."+f+"."+this.id,this,d[f]);for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&d.hasOwnProperty(f)&&a.is(this.paper.customAttributes[f],"function"))for(g in e=
this.paper.customAttributes[f].apply(this,[].concat(d[f])),this.attrs[f]=d[f],e)e.hasOwnProperty(g)&&(d[g]=e[g]);x(this,d);return this};A.toFront=function(){if(this.removed)return this;this.node.parentNode.appendChild(this.node);var b=this.paper;b.top!=this&&a._tofront(this,b);return this};A.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};
A.insertAfter=function(b){if(this.removed)return this;var c=b.node||b[b.length-1].node;c.nextSibling?c.parentNode.insertBefore(this.node,c.nextSibling):c.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};A.insertBefore=function(b){if(this.removed)return this;var c=b.node||b[0].node;c.parentNode.insertBefore(this.node,c);a._insertbefore(this,b,this.paper);return this};A.blur=function(b){if(0!==+b){var c=p("filter"),d=p("feGaussianBlur");this.attrs.blur=b;c.id=a.createUUID();
p(d,{stdDeviation:+b||1.5});c.appendChild(d);this.paper.defs.appendChild(c);this._blur=c;p(this.node,{filter:"url(#"+c.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")};a._engine.circle=function(a,b,c,d){var e=p("circle");a.canvas&&a.canvas.appendChild(e);a=new z(e,a);a.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"};a.type="circle";p(e,a.attrs);return a};a._engine.rect=function(a,b,c,d,e,f){var g=
p("rect");a.canvas&&a.canvas.appendChild(g);a=new z(g,a);a.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"};a.type="rect";p(g,a.attrs);return a};a._engine.ellipse=function(a,b,c,d,e){var f=p("ellipse");a.canvas&&a.canvas.appendChild(f);a=new z(f,a);a.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"};a.type="ellipse";p(f,a.attrs);return a};a._engine.image=function(a,b,c,d,e,f){var g=p("image");p(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"});g.setAttributeNS("http://www.w3.org/1999/xlink",
"href",b);a.canvas&&a.canvas.appendChild(g);a=new z(g,a);a.attrs={x:c,y:d,width:e,height:f,src:b};a.type="image";return a};a._engine.text=function(b,c,d,e){var f=p("text");b.canvas&&b.canvas.appendChild(f);b=new z(f,b);b.attrs={x:c,y:d,"text-anchor":"middle",text:e,font:a._availableAttrs.font,stroke:"none",fill:"#000"};b.type="text";x(b,b.attrs);return b};a._engine.setSize=function(a,b){this.width=a||this.width;this.height=b||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",
this.height);this._viewBox&&this.setViewBox.apply(this,this._viewBox);return this};a._engine.create=function(){var b=a._getContainer.apply(0,arguments),c=b&&b.container,d=b.x,e=b.y,f=b.width,b=b.height;if(!c)throw Error("SVG container not found.");var g=p("svg"),h;d=d||0;e=e||0;f=f||512;b=b||342;p(g,{height:b,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"});1==c?(g.style.cssText="overflow:hidden;position:absolute;left:"+d+"px;top:"+e+"px",a._g.doc.body.appendChild(g),h=1):(g.style.cssText=
"overflow:hidden;position:relative",c.firstChild?c.insertBefore(g,c.firstChild):c.appendChild(g));c=new a._Paper;c.width=f;c.height=b;c.canvas=g;c.clear();c._left=c._top=0;h&&(c.renderfix=function(){});c.renderfix();return c};a._engine.setViewBox=function(a,b,c,d,e){l("setViewBox",this,this._viewBox,[a,b,c,d,e]);var g=f(c/this.width,d/this.height),h=this.top,k,n;for(null==a?(this._vbSize&&(g=1),delete this._vbSize,k="0 0 "+this.width+" "+this.height):(this._vbSize=g,k=a+" "+b+" "+c+" "+d),p(this.canvas,
{viewBox:k,preserveAspectRatio:e?"meet":"xMinYMin"});g&&h;)n="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":n}),h._.dirty=1,h._.dirtyT=1,h=h.prev;this._viewBox=[a,b,c,d,!!e];return this};a.prototype.renderfix=function(){var a=this.canvas,b=a.style,c=a.getScreenCTM()||a.createSVGMatrix(),a=-c.e%1,c=-c.f%1;if(a||c)a&&(this._left=(this._left+a)%1,b.left=this._left+"px"),c&&(this._top=(this._top+c)%1,b.top=this._top+"px")};a.prototype.clear=function(){a.eve("clear",this);for(var b=
this.canvas;b.firstChild;)b.removeChild(b.firstChild);this.bottom=this.top=null;(this.desc=p("desc")).appendChild(a._g.doc.createTextNode("Created with Rapha\u00ebl "+a.version));b.appendChild(this.desc);b.appendChild(this.defs=p("defs"))};a.prototype.remove=function(){l("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=removed(a)};var J=a.st,y;for(y in A)A.hasOwnProperty(y)&&!J.hasOwnProperty(y)&&(J[y]=function(a){return function(){var b=
arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(y))}(window.Raphael);
window.Raphael.vml&&function(a){var b=String,c=parseFloat,d=Math,e=d.round,f=d.max,g=d.min,h=d.abs,k=/[, ]+/,l=a.eve,n={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},o=/([clmz]),?([^clmz]*)/gi,p=/ progid:\S+Blur\([^\)]+\)/g,r=/-?[^,\s-]+/g,s={path:1,rect:1,image:1},u={circle:1,ellipse:1},w=function(c){var d=/[ahqstv]/ig,f=a._pathToAbsolute;b(c).match(d)&&(f=a._path2curve);d=/[clmz]/g;if(f==a._pathToAbsolute&&!b(c).match(d))return c=b(c).replace(o,function(a,b,c){var d=[],f="m"==b.toLowerCase(),
g=n[b];c.replace(r,function(a){f&&2==d.length&&(g+=d+n["m"==b?"l":"L"],d=[]);d.push(e(21600*a))});return g+d});for(var d=f(c),g,c=[],h=0,k=d.length;h<k;h++){f=d[h];g=d[h][0].toLowerCase();"z"==g&&(g="x");for(var l=1,p=f.length;l<p;l++)g+=e(21600*f[l])+(l!=p-1?",":"");c.push(g)}return c.join(" ")},v=function(b,c,d){var e=a.matrix();e.rotate(-b,0.5,0.5);return{dx:e.x(c,d),dy:e.y(c,d)}},x=function(a,b,c,d,e,f){var g=a._,k=a.matrix,l=g.fillpos,a=a.node,n=a.style,o=1,p="",r=21600/b,s=21600/c;n.visibility=
"hidden";if(b&&c){a.coordsize=h(r)+" "+h(s);n.rotation=f*(0>b*c?-1:1);if(f){var u=v(f,d,e);d=u.dx;e=u.dy}0>b&&(p+="x");0>c&&(p+=" y")&&(o=-1);n.flip=p;a.coordorigin=d*-r+" "+e*-s;if(l||g.fillsize)d=a.getElementsByTagName("fill"),d=d&&d[0],a.removeChild(d),l&&(u=v(f,k.x(l[0],l[1]),k.y(l[0],l[1])),d.position=u.dx*o+" "+u.dy*o),g.fillsize&&(d.size=g.fillsize[0]*h(b)+" "+g.fillsize[1]*h(c)),a.appendChild(d);n.visibility="visible"}};a.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+
this.version};addArrow=function(a,c,d){for(var c=b(c).toLowerCase().split("-"),d=d?"end":"start",e=c.length,f="classic",g="medium",h="medium";e--;)switch(c[e]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":f=c[e];break;case "wide":case "narrow":h=c[e];break;case "long":case "short":g=c[e]}a=a.node.getElementsByTagName("stroke")[0];a[d+"arrow"]=f;a[d+"arrowlength"]=g;a[d+"arrowwidth"]=h};setFillAndStroke=function(d,h){d.attrs=d.attrs||{};var l=d.node,n=d.attrs,o=l.style,
p=s[d.type]&&(h.x!=n.x||h.y!=n.y||h.width!=n.width||h.height!=n.height||h.cx!=n.cx||h.cy!=n.cy||h.rx!=n.rx||h.ry!=n.ry||h.r!=n.r),r=u[d.type]&&(n.cx!=h.cx||n.cy!=h.cy||n.r!=h.r||n.rx!=h.rx||n.ry!=h.ry),v;for(v in h)h.hasOwnProperty(v)&&(n[v]=h[v]);p&&(n.path=a._getPath[d.type](d),d._.dirty=1);h.href&&(l.href=h.href);h.title&&(l.title=h.title);h.target&&(l.target=h.target);h.cursor&&(o.cursor=h.cursor);"blur"in h&&d.blur(h.blur);if(h.path&&"path"==d.type||p)l.path=w(~b(n.path).toLowerCase().indexOf("r")?
a._pathToAbsolute(n.path):n.path),"image"==d.type&&(d._.fillpos=[n.x,n.y],d._.fillsize=[n.width,n.height],x(d,1,1,0,0,0));"transform"in h&&d.transform(h.transform);if(r){p=+n.cx;r=+n.cy;v=+n.rx||+n.r||0;var A=+n.ry||+n.r||0;l.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",e(21600*(p-v)),e(21600*(r-A)),e(21600*(p+v)),e(21600*(r+A)),e(21600*p))}"clip-rect"in h&&(p=b(h["clip-rect"]).split(k),4==p.length&&(p[2]=+p[2]+ +p[0],p[3]=+p[3]+ +p[1],r=l.clipRect||a._g.doc.createElement("div"),v=r.style,v.clip=
a.format("rect({1}px {2}px {3}px {0}px)",p),l.clipRect||(v.position="absolute",v.top=0,v.left=0,v.width=d.paper.width+"px",v.height=d.paper.height+"px",l.parentNode.insertBefore(r,l),r.appendChild(l),l.clipRect=r)),h["clip-rect"]||l.clipRect&&(l.clipRect.style.clip=""));d.textpath&&(p=d.textpath.style,h.font&&(p.font=h.font),h["font-family"]&&(p.fontFamily='"'+h["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),h["font-size"]&&(p.fontSize=h["font-size"]),h["font-weight"]&&(p.fontWeight=
h["font-weight"]),h["font-style"]&&(p.fontStyle=h["font-style"]));"arrow-start"in h&&addArrow(d,h["arrow-start"]);"arrow-end"in h&&addArrow(d,h["arrow-end"],1);if(null!=h.opacity||null!=h["stroke-width"]||null!=h.fill||null!=h.src||null!=h.stroke||null!=h["stroke-width"]||null!=h["stroke-opacity"]||null!=h["fill-opacity"]||null!=h["stroke-dasharray"]||null!=h["stroke-miterlimit"]||null!=h["stroke-linejoin"]||null!=h["stroke-linecap"]){p=l.getElementsByTagName("fill");p=p&&p[0];!p&&(p=z("fill"));"image"==
d.type&&h.src&&(p.src=h.src);h.fill&&(p.on=!0);if(null==p.on||"none"==h.fill||null===h.fill)p.on=!1;p.on&&h.fill&&((r=b(h.fill).match(a._ISURL))?(p.parentNode==l&&l.removeChild(p),p.rotate=!0,p.src=r[1],p.type="tile",v=d.getBBox(1),p.position=v.x+" "+v.y,d._.fillpos=[v.x,v.y],a._preload(r[1],function(){d._.fillsize=[this.offsetWidth,this.offsetHeight]})):(p.color=a.getRGB(h.fill).hex,p.src="",p.type="solid",a.getRGB(h.fill).error&&(d.type in{circle:1,ellipse:1}||"r"!=b(h.fill).charAt())&&addGradientFill(d,
h.fill,p)&&(n.fill="none",n.gradient=h.fill,p.rotate=!1)));if("fill-opacity"in h||"opacity"in h)v=((+n["fill-opacity"]+1||2)-1)*((+n.opacity+1||2)-1)*((+a.getRGB(h.fill).o+1||2)-1),v=g(f(v,0),1),p.opacity=v,p.src&&(p.color="none");l.appendChild(p);p=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0];r=!1;!p&&(r=p=z("stroke"));if(h.stroke&&"none"!=h.stroke||h["stroke-width"]||null!=h["stroke-opacity"]||h["stroke-dasharray"]||h["stroke-miterlimit"]||h["stroke-linejoin"]||h["stroke-linecap"])p.on=
!0;("none"==h.stroke||null===h.stroke||null==p.on||0==h.stroke||0==h["stroke-width"])&&(p.on=!1);v=a.getRGB(h.stroke);p.on&&h.stroke&&(p.color=v.hex);v=((+n["stroke-opacity"]+1||2)-1)*((+n.opacity+1||2)-1)*((+v.o+1||2)-1);A=0.75*(c(h["stroke-width"])||1);v=g(f(v,0),1);null==h["stroke-width"]&&(A=n["stroke-width"]);h["stroke-width"]&&(p.weight=A);A&&1>A&&(v*=A)&&(p.weight=1);p.opacity=v;h["stroke-linejoin"]&&(p.joinstyle=h["stroke-linejoin"]||"miter");p.miterlimit=h["stroke-miterlimit"]||8;h["stroke-linecap"]&&
(p.endcap="butt"==h["stroke-linecap"]?"flat":"square"==h["stroke-linecap"]?"square":"round");h["stroke-dasharray"]&&(v={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},p.dashstyle=v.hasOwnProperty(h["stroke-dasharray"])?v[h["stroke-dasharray"]]:"");r&&l.appendChild(p)}if("text"==d.type){d.paper.canvas.style.display="";l=d.paper.span;p=n.font&&n.font.match(/\d+(?:\.\d*)?(?=px)/);
o=l.style;n.font&&(o.font=n.font);n["font-family"]&&(o.fontFamily=n["font-family"]);n["font-weight"]&&(o.fontWeight=n["font-weight"]);n["font-style"]&&(o.fontStyle=n["font-style"]);p=c(p?p[0]:n["font-size"]);o.fontSize=100*p+"px";d.textpath.string&&(l.innerHTML=b(d.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));o=l.getBoundingClientRect();d.W=n.w=(o.right-o.left)/100;d.H=n.h=(o.bottom-o.top)/100;d.X=n.x;d.Y=n.y+d.H/2;("x"in h||"y"in h)&&(d.path.v=a.format("m{0},{1}l{2},{1}",
e(21600*n.x),e(21600*n.y),e(21600*n.x)+1));o="x,y,text,font,font-family,font-weight,font-style,font-size".split(",");l=0;for(p=o.length;l<p;l++)if(o[l]in h){d._.dirty=1;break}switch(n["text-anchor"]){case "start":d.textpath.style["v-text-align"]="left";d.bbx=d.W/2;break;case "end":d.textpath.style["v-text-align"]="right";d.bbx=-d.W/2;break;default:d.textpath.style["v-text-align"]="center",d.bbx=0}d.textpath.style["v-text-kern"]=!0}};addGradientFill=function(e,f,g){e.attrs=e.attrs||{};var h=Math.pow,
k="linear",l=".5 .5";e.attrs.gradient=f;f=b(f).replace(a._radial_gradient,function(a,b,e){k="radial";b&&e&&(b=c(b),e=c(e),0.25<h(b-0.5,2)+h(e-0.5,2)&&(e=d.sqrt(0.25-h(b-0.5,2))*(2*(0.5<e)-1)+0.5),l=b+" "+e);return""});f=f.split(/\s*\-\s*/);if("linear"==k){var n=f.shift(),n=-c(n);if(isNaN(n))return null}f=a._parseDots(f);if(!f)return null;e=e.shape||e.node;if(f.length){e.removeChild(g);g.on=!0;g.method="none";g.color=f[0].color;g.color2=f[f.length-1].color;for(var o=[],p=0,r=f.length;p<r;p++)f[p].offset&&
o.push(f[p].offset+" "+f[p].color);g.colors=o.length?o.join():"0% "+g.color;"radial"==k?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=l,g.angle=0):(g.type="gradient",g.angle=(270-n)%360);e.appendChild(g)}return 1};Element=function(b,c){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=c;this.matrix=a.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!c.bottom&&(c.bottom=this);this.prev=
c.top;c.top&&(c.top.next=this);c.top=this;this.next=null};var B=a.el;Element.prototype=B;B.constructor=Element;B.transform=function(c){if(null==c)return this._.transform;var d=this.paper._viewBoxShift,e=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:"",f;d&&(f=c=b(c).replace(/\.{3}|\u2026/g,this._.transform||""));a._extractTransform(this,e+c);var d=this.matrix.clone(),g=this.skew,c=this.node,e=~b(this.attrs.fill).indexOf("-"),h=!b(this.attrs.fill).indexOf("url(");d.translate(-0.5,-0.5);h||e||"image"==
this.type?(g.matrix="1 0 0 1",g.offset="0 0",g=d.split(),e&&g.noRotation||!g.isSimple?(c.style.filter=d.toFilter(),e=this.getBBox(),g=this.getBBox(1),d=e.x-g.x,e=e.y-g.y,c.coordorigin=-21600*d+" "+-21600*e,x(this,1,1,d,e,0)):(c.style.filter="",x(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate))):(c.style.filter="",g.matrix=b(d),g.offset=d.offset());f&&(this._.transform=f);return this};B.rotate=function(a,d,e){if(this.removed)return this;if(null!=a){a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]));a=c(a[0]);
null==e&&(d=e);if(null==d||null==e)e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2;this._.dirtyT=1;this.transform(this._.transform.concat([["r",a,d,e]]));return this}};B.translate=function(a,d){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]));a=c(a[0])||0;d=+d||0;this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=d);this.transform(this._.transform.concat([["t",a,d]]));return this};B.scale=function(a,d,e,f){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]),
f=c(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null));a=c(a[0]);null==d&&(d=a);null==f&&(e=f);if(null==e||null==f)var g=this.getBBox(1);e=null==e?g.x+g.width/2:e;f=null==f?g.y+g.height/2:f;this.transform(this._.transform.concat([["s",a,d,e,f]]));this._.dirtyT=1;return this};B.hide=function(){!this.removed&&(this.node.style.display="none");return this};B.show=function(){!this.removed&&(this.node.style.display="");return this};B._getBBox=function(){return this.removed?{}:"text"==this.type?{x:this.X+(this.bbx||
0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}:pathDimensions(this.attrs.path)};B.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this);a.eve.unbind("*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this)delete this[b];this.removed=!0}};B.attr=function(b,c){if(this.removed)return this;if(null==b){var d={},e;for(e in this.attrs)this.attrs.hasOwnProperty(e)&&
(d[e]=this.attrs[e]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==c&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;e=b.split(k);for(var d={},f=0,g=e.length;f<g;f++)b=e[f],b in this.attrs?d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return g-1?d:d[e[0]]}if(this.attrs&&null==c&&a.is(b,"array")){d=
{};for(f=0,g=b.length;f<g;f++)d[b[f]]=this.attr(b[f]);return d}null!=c&&(d={},d[b]=c);null==c&&a.is(b,"object")&&(d=b);for(f in d)l("attr."+f+"."+this.id,this,d[f]);if(d){for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&d.hasOwnProperty(f)&&a.is(this.paper.customAttributes[f],"function"))for(g in e=this.paper.customAttributes[f].apply(this,[].concat(d[f])),this.attrs[f]=d[f],e)e.hasOwnProperty(g)&&(d[g]=e[g]);d.text&&"text"==this.type&&(this.textpath.string=d.text);
setFillAndStroke(this,d)}return this};B.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&a._tofront(this,this.paper);return this};B.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};B.insertAfter=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[b.length-
1]);b.node.nextSibling?b.node.parentNode.insertBefore(this.node,b.node.nextSibling):b.node.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};B.insertBefore=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[0]);b.node.parentNode.insertBefore(this.node,b.node);a._insertbefore(this,b,this.paper);return this};B.blur=function(b){var c=this.node.runtimeStyle,d=c.filter;d=d.replace(p,"");0!==+b?(this.attrs.blur=b,c.filter=d+"  progid:DXImageTransform.Microsoft.Blur(pixelradius="+
(+b||1.5)+")",c.margin=a.format("-{0}px 0 0 -{0}px",e(+b||1.5))):(c.filter=d,c.margin=0,delete this.attrs.blur)};a._engine.path=function(a,b){var c=z("shape");c.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";c.coordsize="21600 21600";c.coordorigin=b.coordorigin;var d=new Element(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a);d.type="path";d.path=[];d.Path="";setFillAndStroke(d,e);b.canvas.appendChild(c);e=z("skew");e.on=!0;c.appendChild(e);d.skew=e;d.transform("");return d};
a._engine.rect=function(b,c,d,e,f,g){var h=a._rectPath(c,d,e,f,g),b=b.path(h),k=b.attrs;b.X=k.x=c;b.Y=k.y=d;b.W=k.width=e;b.H=k.height=f;k.r=g;k.path=h;b.type="rect";return b};a._engine.ellipse=function(a,b,c,d,e){a=a.path();a.X=b-d;a.Y=c-e;a.W=2*d;a.H=2*e;a.type="ellipse";setFillAndStroke(a,{cx:b,cy:c,rx:d,ry:e});return a};a._engine.circle=function(a,b,c,d){a=a.path();a.X=b-d;a.Y=c-d;a.W=a.H=2*d;a.type="circle";setFillAndStroke(a,{cx:b,cy:c,r:d});return a};a._engine.image=function(b,c,d,e,f,g){var h=
a._rectPath(d,e,f,g),b=b.path(h).attr({stroke:"none"}),k=b.attrs,l=b.node,n=l.getElementsByTagName("fill")[0];k.src=c;b.X=k.x=d;b.Y=k.y=e;b.W=k.width=f;b.H=k.height=g;k.path=h;b.type="image";n.parentNode==l&&l.removeChild(n);n.rotate=!0;n.src=c;n.type="tile";b._.fillpos=[d,e];b._.fillsize=[f,g];l.appendChild(n);x(b,1,1,0,0,0);return b};a._engine.text=function(c,d,f,g){var h=z("shape"),k=z("path"),l=z("textpath");d=d||0;f=f||0;g=g||"";k.v=a.format("m{0},{1}l{2},{1}",e(21600*d),e(21600*f),e(21600*d)+
1);k.textpathok=!0;l.string=b(g);l.on=!0;h.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";h.coordsize="21600 21600";h.coordorigin="0 0";var n=new Element(h,c),o={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:g};n.shape=h;n.path=k;n.textpath=l;n.type="text";n.attrs.text=b(g);n.attrs.x=d;n.attrs.y=f;n.attrs.w=1;n.attrs.h=1;setFillAndStroke(n,o);h.appendChild(l);h.appendChild(k);c.canvas.appendChild(h);c=z("skew");c.on=!0;h.appendChild(c);n.skew=c;n.transform("");return n};
a._engine.setSize=function(a,b){var c=this.canvas.style;this.width=a;this.height=b;a==+a&&(a+="px");b==+b&&(b+="px");c.width=a;c.height=b;c.clip="rect(0 "+a+" "+b+" 0)";this._viewBox&&setViewBox.apply(this,this._viewBox);return this};a._engine.setViewBox=function(b,c,d,e,g){a.eve("setViewBox",this,this._viewBox,[b,c,d,e,g]);var h=this.width,k=this.height,l=1/f(d/h,e/k),n,o;g&&(n=k/e,o=h/d,d*n<h&&(b-=(h-d*n)/2/n),e*o<k&&(c-=(k-e*o)/2/o));this._viewBox=[b,c,d,e,!!g];this._viewBoxShift={dx:-b,dy:-c,
scale:l};this.forEach(function(a){a.transform("...")});return this};var z;(function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),z=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){z=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}})(a._g.win);a._engine.create=function(){var b=a._getContainer.apply(0,arguments),
c=b.container,d=b.height,e=b.width,f=b.x,b=b.y;if(!c)throw Error("VML container not found.");var g=new a._Paper,h=g.canvas=a._g.doc.createElement("div"),k=h.style;f=f||0;b=b||0;e=e||512;d=d||342;g.width=e;g.height=d;e==+e&&(e+="px");d==+d&&(d+="px");g.coordsize="21600000 21600000";g.coordorigin="0 0";g.span=a._g.doc.createElement("span");g.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";h.appendChild(g.span);k.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",
e,d);1==c?(a._g.doc.body.appendChild(h),k.left=f+"px",k.top=b+"px",k.position="absolute"):c.firstChild?c.insertBefore(h,c.firstChild):c.appendChild(h);g.renderfix=function(){};return g};a.prototype.clear=function(){a.eve("clear",this);this.canvas.innerHTML="";this.span=a._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};a.prototype.remove=function(){a.eve("remove",
this);this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]=removed(b);return!0};var A=a.st,J;for(J in B)B.hasOwnProperty(J)&&!A.hasOwnProperty(J)&&(A[J]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(J))}(window.Raphael);function Scratchpad(a){function b(){for(var a=0,b=[];a<v.length;a++)v[a].removed||"path"==v[a].type&&b.push({path:v[a].attr("path").toString(),stroke:v[a].attr("stroke"),type:"path"});x.push(b)}function c(){u.animate({y:2},100);B="draw"}function d(){u.animate({y:32},100);B="erase"}function e(){var a=x.pop();v.remove();for(var b=0;b<a.length;b++)"path"==a[b].type&&v.push(o.path(a[b].path).attr(w).attr("stroke",a[b].stroke))}function f(a,c,d){a&&c&&d&&(J&&(J.remove(),J=null),b(),d=v.length,40<a&&("draw"==
B?(z=o.path("M"+a+","+c).attr(w).attr({stroke:r}),A=z.attr("path"),v.push(z)):"erase"==B&&(J=o.rect(a,c,0,0).attr({"fill-opacity":0.15,"stroke-opacity":0.5,fill:"#ff0000",stroke:"#ff0000"}),J.sx=a,J.sy=c)),v.length==d&&x.pop())}function g(a,b){return b.x<a.x+a.width&&b.x+b.width>a.x&&b.y<a.y+a.height&&b.y+b.height>a.y}function h(a){for(var a=a.toString().split("L"),b=a[0].substr(1).split(","),c=+b[0],b=+b[1],d=a[0],e=0,f=1;f<a.length;f++){var g=a[f].split(","),h=Math.pow(+g[0]-c,2)+Math.pow(+g[1]-
b,2);if(10<h||h<e||f==a.length-1)d+="L"+a[f],b=g[1],c=g[0];e=h}return d}function k(){z&&z.attr("path",h(A));z=null;if("erase"==B&&J){b();for(var a=J.getBBox(),c=0;c<v.length;c++)g(a,v[c].getBBox())&&v[c].remove();J.animate({"fill-opacity":0},100,function(){J.remove();J=null})}}function l(a,b){if(!(40>=a))if(z&&"draw"==B)A+="L"+a+","+b,z.attr("path",A);else if("erase"==B&&J){var c=Math.min(a,J.sx),d=Math.min(b,J.sy),e=Math.max(a,J.sx),f=Math.max(b,J.sy);J.attr({x:c,y:d,width:e-c,height:f-d})}}/AppleWebKit.*Mobile/.test(navigator.userAgent);
var n=jQuery(a),o=Raphael(n[0],n.width(),n.height());n.bind("resize",function(){o.setSize(n.width(),n.height())});$("body").bind("selectstart",function(){return!1});for(var p=o.set(),r="#000000",a="#000000,#3f3f3f,#7f7f7f,#bfbfbf,#ff0000,#ff7f00,#ffff00,#00ff00,#00ffff,#007fff,#0000ff,#7f00ff".split(","),s=0;s<a.length;s++)(function(a){var b=function(){r=a;p.animate({x:7},100);this.animate({x:15},100);c()};p.push(o.rect(7,90+24*s,24,24).attr({fill:a,stroke:""}).touchstart(b).click(b))})(a[s]);p[0].attr({x:15});
var u=o.rect(2,2,30,30).attr({r:5,stroke:"",fill:"rgba(30, 157, 186, 0.5)"}),w={"stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},v=o.set(),x=[[]],a=o.set();a.push(o.path("M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z").scale(0.8).translate(0,0));a.push(o.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248").translate(0,
30));a.push(o.path("M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z").scale(0.7).translate(1,60));var B="draw";o.rect(2,2,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(c).touchstart(c);o.rect(2,32,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(d).touchstart(d);o.rect(2,62,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(e).touchstart(e);
a.attr({fill:"#000",stroke:"none"});var z=null,A="",J=null;n.mousemove(function(a){var b=jQuery(n).offset();l(a.pageX-b.left,a.pageY-b.top);a.preventDefault()});n.mousedown(function(a){var b=jQuery(n).offset();f(a.pageX-b.left,a.pageY-b.top,a);a.preventDefault();$(document).one("mouseup",function(a){k();a.preventDefault()})});n.bind("touchstart",function(a){var b=jQuery(n).offset();f(a.originalEvent.touches[0].pageX-b.left,a.originalEvent.touches[0].pageY-b.top,a.originalEvent);a.preventDefault()});
n.bind("touchmove",function(a){var b=jQuery(n).offset();l(a.originalEvent.touches[0].pageX-b.left,a.originalEvent.touches[0].pageY-b.top);a.preventDefault()});n.bind("touchend",function(a){k();a.preventDefault()})}
(function(a,b,c){function d(){g=b[h](function(){e.each(function(){var b=a(this),c=b.width(),d=b.height(),e=a.data(this,l);if(c!==e.w||d!==e.h)b.trigger(k,[e.w=c,e.h=d])});d()},f[n])}var e=a([]),f=a.resize=a.extend(a.resize,{}),g,h="setTimeout",k="resize",l=k+"-special-event",n="delay";f[n]=1E3;f.throttleWindow=!0;a.event.special[k]={setup:function(){if(!f.throttleWindow&&this[h])return!1;var b=a(this);e=e.add(b);a.data(this,l,{w:b.width(),h:b.height()});1===e.length&&d()},teardown:function(){if(!f.throttleWindow&&
this[h])return!1;var b=a(this);e=e.not(b);b.removeData(l);e.length||clearTimeout(g)},add:function(b){function d(b,f,g){var h=a(this),k=a.data(this,l);k.w=f!==c?f:h.width();k.h=g!==c?g:h.height();e.apply(this,arguments)}if(!f.throttleWindow&&this[h])return!1;var e;if(a.isFunction(b))return e=b,d;e=b.handler;b.handler=d}}})(jQuery,this);Ext.define("Ext.ux.form.field.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],multiSelect:!0,forceSelection:!0,createNewOnEnter:!1,createNewOnBlur:!1,encodeSubmitValue:!1,triggerOnClick:!0,stacked:!1,pinList:!0,filterPickList:!1,selectOnFocus:!0,grow:!0,growMin:!1,growMax:!1,fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls}">','<ul id="{cmpId}-itemList" class="x-boxselect-list">',
'<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:!0,disableFormats:!0}],childEls:["listWrapper","itemList","inputEl","inputElCt"],componentLayout:"boxselectfield",
initComponent:function(){var a=this.typeAhead;a&&!this.editable&&Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings.");Ext.apply(this,{typeAhead:!1});this.callParent();this.typeAhead=a;this.selectionModel=new Ext.selection.Model({store:this.valueStore,mode:"MULTI",onSelectChange:function(a,c,d,e){e()}});!Ext.isEmpty(this.delimiter)&&this.multiSelect&&(this.delimiterRegexp=RegExp((""+this.delimiter).replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&")))},
initEvents:function(){this.callParent(arguments);this.enableKeyEvents||this.mon(this.inputEl,"keydown",this.onKeyDown,this);this.mon(this.inputEl,"paste",this.onPaste,this);this.mon(this.listWrapper,"click",this.onItemListClick,this);this.mon(this.selectionModel,"selectionchange",this.applyMultiselectItemMarkup,this)},onBindStore:function(a){a&&(this.valueStore=new Ext.data.Store({model:a.model,proxy:{type:"memory"}}),this.mon(this.valueStore,"datachanged",this.applyMultiselectItemMarkup,this),this.selectionModel&&
this.selectionModel.bindStore(this.valueStore))},onUnbindStore:function(a){var b=this.valueStore;b&&(this.selectionModel&&(this.selectionModel.deselectAll(),this.selectionModel.bindStore(null)),this.mun(b,"datachanged",this.applyMultiselectItemMarkup,this),b.destroy(),this.valueStore=null);this.callParent(arguments)},createPicker:function(){var a=this.callParent(arguments);this.mon(a,{beforerefresh:this.onBeforeListRefresh,scope:this});this.filterPickList&&a.addCls("x-boxselect-hideselections");return a},
onDestroy:function(){Ext.destroyMembers(this,"selectionModel","valueStore");this.callParent(arguments)},getSubTplData:function(){var a=this.callParent();a.value=this.emptyText&&1>a.value.length?this.emptyText:"";a.inputElCls=a.fieldCls.match(this.emptyCls)?this.emptyCls:"";return a},afterRender:function(){Ext.supports.Placeholder&&this.inputEl&&this.emptyText&&delete this.inputEl.dom.placeholder;this.bodyEl.applyStyles("vertical-align:top");this.grow&&(Ext.isNumber(this.growMin)&&0<this.growMin&&
this.listWrapper.applyStyles("min-height:"+this.growMin+"px"),Ext.isNumber(this.growMax)&&0<this.growMax&&this.listWrapper.applyStyles("max-height:"+this.growMax+"px"));!0===this.stacked&&this.itemList.addCls("x-boxselect-stacked");this.multiSelect||this.itemList.addCls("x-boxselect-singleselect");this.applyMultiselectItemMarkup();this.callParent(arguments)},findRecord:function(a,b){var c=this.store;if(!c)return!1;c=c.queryBy(function(c){return c.isEqual(c.get(a),b)});return 0<c.getCount()?c.first():
!1},onLoad:function(){var a=this,b=a.valueField,c=a.valueStore,d=!1;c&&(!Ext.isEmpty(a.value)&&0==c.getCount()&&a.setValue(a.value,!1,!0),c.suspendEvents(),c.each(function(e){var f=a.findRecord(b,e.get(b)),e=f?c.indexOf(e):-1;0<=e&&(c.removeAt(e),c.insert(e,f),d=!0)}),c.resumeEvents(),d&&c.fireEvent("datachanged",c));a.callParent(arguments)},isFilteredRecord:function(a){var b=this.store,c=this.valueField,d,e=!1;d=b.findExact(c,a.get(c));return e=(e=-1===d&&(!b.snapshot||!1!==this.findRecord(c,a.get(c))))||
!e&&-1===d&&!0!==this.forceSelection&&0<=this.valueStore.findExact(c,a.get(c))},doRawQuery:function(){var a=this.inputEl.dom.value;this.multiSelect&&(a=a.split(this.delimiter).pop());this.doQuery(a,!1,!0)},onBeforeListRefresh:function(){this.ignoreSelection++},onListRefresh:function(){this.callParent(arguments);0<this.ignoreSelection&&--this.ignoreSelection},onListSelectionChange:function(a,b){var c=this,d=c.valueStore,e=[],f;if(0>=c.ignoreSelection&&c.isExpanded){d.each(function(a){(Ext.Array.contains(b,
a)||c.isFilteredRecord(a))&&e.push(a)});e=Ext.Array.merge(e,b);f=Ext.Array.intersect(e,d.getRange()).length;if(f!=e.length||f!=c.valueStore.getCount())c.setValue(e,!1),(!c.multiSelect||!c.pinList)&&Ext.defer(c.collapse,1,c),0<d.getCount()&&c.fireEvent("select",c,d.getRange());c.inputEl.focus();c.pinList||(c.inputEl.dom.value="");c.selectOnFocus&&c.inputEl.dom.select()}},syncSelection:function(){var a=this.picker,b=this.valueField,c,d;a&&(c=a.store,d=[],this.valueStore&&this.valueStore.each(function(a){a=
c.findExact(b,a.get(b));0<=a&&d.push(c.getAt(a))}),this.ignoreSelection++,a=a.getSelectionModel(),a.deselectAll(),0<d.length&&a.select(d),0<this.ignoreSelection&&--this.ignoreSelection)},doAlign:function(){var a=this.picker,b;this.picker.alignTo(this.listWrapper,this.pickerAlign,this.pickerOffset);b=a.el.getY()<this.inputEl.getY();this.bodyEl[b?"addCls":"removeCls"](this.openCls+"-above");a[b?"addCls":"removeCls"](a.baseCls+"-above")},alignPicker:function(){var a=this.picker,b=a.getTargetEl().dom.scrollTop;
this.callParent(arguments);this.isExpanded&&(this.matchFieldWidth&&a.setWidth(this.listWrapper.getWidth()),a.getTargetEl().dom.scrollTop=b)},getCursorPosition:function(){var a;Ext.isIE?(a=document.selection.createRange(),a.collapse(!0),a.moveStart("character",-this.inputEl.dom.value.length),a=a.text.length):a=this.inputEl.dom.selectionStart;return a},hasSelectedText:function(){var a;return Ext.isIE?(a=document.selection,a=a.createRange(),a.parentElement()==this.inputEl.dom):this.inputEl.dom.selectionStart!=
this.inputEl.dom.selectionEnd},onKeyDown:function(a,b){var c=a.getKey(),d=this.inputEl.dom.value,e=this.valueStore,f=this.selectionModel,g=!1,h;if(!this.readOnly&&!this.disabled&&this.editable){if(this.isExpanded&&c==a.A&&a.ctrlKey)this.select(this.getStore().getRange()),f.deselectAll(!0),this.collapse(),this.inputEl.focus(),g=!0;else if(0<e.getCount()&&(""==d||0===this.getCursorPosition()&&!this.hasSelectedText())){if(c==a.BACKSPACE||c==a.DELETE)0<f.getCount()?this.valueStore.remove(f.getSelection()):
this.valueStore.remove(this.valueStore.last()),this.setValue(this.valueStore.getRange()),f.deselectAll(),g=!0;else if(c==a.RIGHT||c==a.LEFT)if(0===f.getCount()&&c==a.LEFT)f.select(e.last()),g=!0;else{if(0<f.getCount()&&(d=f.getLastFocused()||f.getLastSelected()))h=e.indexOf(d),c==a.RIGHT?h<e.getCount()-1?(f.select(h+1,a.shiftKey),g=!0):a.shiftKey||(f.deselect(d),g=!0):c==a.LEFT&&0<h&&(f.select(h-1,a.shiftKey),g=!0)}else c==a.A&&a.ctrlKey&&(f.selectAll(),g=a.A);this.inputEl.focus()}g?(this.preventKeyUpEvent=
g,a.stopEvent()):(this.isExpanded&&c==a.ENTER&&this.picker.highlightedItem&&(this.preventKeyUpEvent=!0),this.enableKeyEvents&&this.callParent(arguments),!a.isSpecialKey()&&!a.hasModifier()&&(this.selectionModel.deselectAll(),this.inputEl.focus()))}},onKeyUp:function(a,b){var c=this.inputEl.dom.value;if(this.preventKeyUpEvent)a.stopEvent(),(!0===this.preventKeyUpEvent||a.getKey()===this.preventKeyUpEvent)&&delete this.preventKeyUpEvent;else{if(this.multiSelect&&this.delimiterRegexp&&this.delimiterRegexp.test(c)||
!0===this.createNewOnEnter&&a.getKey()==a.ENTER)c=Ext.Array.clean(c.split(this.delimiterRegexp)),this.inputEl.dom.value="",this.setValue(this.valueStore.getRange().concat(c)),this.inputEl.focus();this.callParent([a,b])}},onPaste:function(a){var b=this.inputEl.dom.value,a=a&&a.browserEvent&&a.browserEvent.clipboardData?a.browserEvent.clipboardData:!1;this.multiSelect&&this.delimiterRegexp&&this.delimiterRegexp.test(b)&&(a&&a.getData&&(/text\/plain/.test(a.types)?b=a.getData("text/plain"):/text\/html/.test(a.types)&&
(b=a.getData("text/html"))),b=Ext.Array.clean(b.split(this.delimiterRegexp)),this.inputEl.dom.value="",this.setValue(this.valueStore.getRange().concat(b)),this.inputEl.focus())},onExpand:function(){var a=this.listKeyNav;this.callParent(arguments);!a&&this.filterPickList&&(a=this.listKeyNav,a.highlightAt=function(a){var c=this.boundList,d=c.all.item(a),e=c.all.getCount(),f;if(d&&d.hasCls("x-boundlist-selected")){f=0==a||!c.highlightedItem||c.indexOf(c.highlightedItem)<a?1:-1;do a+=f,d=c.all.item(a);
while(0<a&&a<e&&d.hasCls("x-boundlist-selected"));if(d.hasCls("x-boundlist-selected"))return}d&&(d=d.dom,c.highlightItem(d),c.getTargetEl().scrollChildIntoView(d,!1))})},onTypeAhead:function(){var a=this.displayField,b=this.inputEl.dom,c=this.valueStore,d=this.getPicker(),e,f,g;if(this.filterPickList){var h=this.createFilterFn(a,b.value);e=this.store.findBy(function(a){return-1===c.indexOfId(a.getId())&&h(a)});e=-1===e?!1:this.store.getAt(e)}else e=this.store.findRecord(a,b.value);e&&(a=e.get(a),
f=a.length,g=b.value.length,d.highlightItem(d.getNode(e)),0!==g&&g!==f&&(b.value=a,this.selectText(g,a.length)))},onItemListClick:function(a){var b=a.getTarget(".x-boxselect-item"),c=b?a.getTarget(".x-boxselect-item-close"):!1;if(!this.readOnly&&!this.disabled)if(a.stopPropagation(),b)c?this.removeByListItemNode(b):this.toggleSelectionByListItemNode(b,a.shiftKey),this.inputEl.focus();else if(this.triggerOnClick)this.onTriggerClick()},getMultiSelectItemMarkup:function(){var a=this;if(!a.multiSelectItemTpl){if(a.labelTpl){if(Ext.isString(a.labelTpl)||
Ext.isArray(a.labelTpl))a.labelTpl=Ext.create("Ext.XTemplate",a.labelTpl)}else a.labelTpl=Ext.create("Ext.XTemplate","{[values."+a.displayField+"]}");a.multiSelectItemTpl=['<tpl for=".">','<li class="x-boxselect-item ','<tpl if="this.isSelected(values.'+a.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : values.'+a.displayField+']}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',
"</li>","</tpl>",{compile:!0,disableFormats:!0,isSelected:function(b){b=a.valueStore.findExact(a.valueField,b);if(0<=b)return a.selectionModel.isSelected(a.valueStore.getAt(b))},getItemLabel:function(b){return a.getTpl("labelTpl").apply(b)}}]}return this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))},applyMultiselectItemMarkup:function(){var a=this,b;if(a.itemList){for(;null!=(b=a.inputElCt.prev());)b.remove();a.inputElCt.insertHtml("beforeBegin",a.getMultiSelectItemMarkup())}Ext.Function.defer(function(){a.picker&&
a.isExpanded&&a.alignPicker();a.hasFocus&&a.inputElCt.scrollIntoView(a.listWrapper)},15)},getRecordByListItemNode:function(a){for(var b=0,c=this.itemList.dom.firstChild;c&&c.nextSibling&&!(c==a);){b++;c=c.nextSibling}b=c==a?b:!1;return!1===b?!1:this.valueStore.getAt(b)},toggleSelectionByListItemNode:function(a,b){var c=this.getRecordByListItemNode(a);c&&(this.selectionModel.isSelected(c)?this.selectionModel.deselect(c):this.selectionModel.select(c,b))},removeByListItemNode:function(a){if(a=this.getRecordByListItemNode(a))this.valueStore.remove(a),
this.setValue(this.valueStore.getRange())},getRawValue:function(){var a=this.inputEl,b;this.inputEl=!1;b=this.callParent(arguments);this.inputEl=a;return b},setRawValue:function(a){var b=this.inputEl;this.inputEl=!1;a=this.callParent([a]);this.inputEl=b;return a},addValue:function(a){a&&this.setValue(Ext.Array.merge(this.value,Ext.Array.from(a)))},removeValue:function(a){a&&this.setValue(Ext.Array.difference(this.value,Ext.Array.from(a)))},setValue:function(a,b,c){var d=this,e=d.valueStore,f=d.valueField,
g,h,k,l,n=[];Ext.isEmpty(a)&&(a=null);Ext.isString(a)&&d.multiSelect&&(a=a.split(d.delimiter));a=Ext.Array.from(a,!0);for(k=0,h=a.length;k<h;k++)if(g=a[k],!g||!g.isModel)l=e.findExact(f,g),0<=l?a[k]=e.getAt(l):(l=d.findRecord(f,g),l||(d.forceSelection?n.push(g):(l={},l[d.valueField]=g,l[d.displayField]=g,l=new d.valueStore.model(l))),l&&(a[k]=l));if(!0!==c&&0<n.length&&"remote"===d.queryMode)return c={},c[d.valueField]=n.join(d.delimiter),d.store.load({params:c,callback:function(){d.itemList&&d.itemList.unmask();
d.setValue(a,b,!0);d.autoSize()}}),!1;if(!d.multiSelect&&0<a.length){for(k=a.length-1;0<=k;k--)if(a[k].isModel){a=a[k];break}Ext.isArray(a)&&(a=a[a.length-1])}return d.callParent([a,b])},getValueRecords:function(){return this.valueStore.getRange()},getSubmitData:function(){var a=this.callParent(arguments);this.multiSelect&&this.encodeSubmitValue&&a&&a[this.name]&&(a[this.name]=Ext.encode(a[this.name]));return a},mimicBlur:function(){this.selectOnTab&&this.picker&&this.picker.highlightedItem&&(this.inputEl.dom.value=
"");this.callParent(arguments)},assertValue:function(){var a=this.inputEl.dom.value,b=!Ext.isEmpty(a)?this.findRecordByDisplay(a):!1,c=!1;!b&&!this.forceSelection&&this.createNewOnBlur&&!Ext.isEmpty(a)?c=a:b&&(c=b);c&&this.addValue(c);this.inputEl.dom.value="";this.collapse()},checkChange:function(){if(!this.suspendCheckChange&&!this.isDestroyed){var a=this.valueStore,b=this.lastValue,c=this.valueField,d=Ext.Array.map(Ext.Array.from(this.value),function(a){return a.isModel?a.get(c):a},this).join(this.delimiter),
e=this.isEqual(d,b);if(!e||0<d.length&&a.getCount()<d.length)a.suspendEvents(),a.removeAll(),Ext.isArray(this.valueModels)&&a.add(this.valueModels),a.resumeEvents(),a.fireEvent("datachanged",a),e||(this.lastValue=d,this.fireEvent("change",this,d,b),this.onChange(d,b))}},isEqual:function(a,b){var c=Ext.Array.from,d=this.valueField,e,f,g,a=c(a),b=c(b);e=a.length;if(e!==b.length)return!1;for(c=0;c<e;c++)if(f=a[c].isModel?a[c].get(d):a[c],g=b[c].isModel?b[c].get(d):b[c],f!==g)return!1;return!0},applyEmptyText:function(){var a=
this.emptyText,b,c;this.rendered&&a&&(c=Ext.isEmpty(this.value)&&!this.hasFocus,b=this.inputEl,c?(b.dom.value=a,b.addCls(this.emptyCls),this.listWrapper.addCls(this.emptyCls)):(b.dom.value===a&&(b.dom.value=""),this.listWrapper.removeCls(this.emptyCls),b.removeCls(this.emptyCls)),this.autoSize())},preFocus:function(){var a=this.inputEl,b=this.emptyText,c;b&&a.dom.value===b&&(a.dom.value="",c=!0,a.removeCls(this.emptyCls),this.listWrapper.removeCls(this.emptyCls));(this.selectOnFocus||c)&&a.dom.select()},
onFocus:function(){var a=this.focusCls,b=this.itemList;a&&b&&b.addCls(a);this.callParent(arguments)},onBlur:function(){var a=this.focusCls,b=this.itemList;a&&b&&b.removeCls(a);this.callParent(arguments)},renderActiveError:function(){var a=this.invalidCls,b=this.itemList,c=this.hasActiveError();if(a&&b)b[c?"addCls":"removeCls"](this.invalidCls+"-field");this.callParent(arguments)},autoSize:function(){this.grow&&this.rendered&&(this.autoSizing=!0,this.updateLayout());return this},afterComponentLayout:function(){this.autoSizing&&
(height=this.getHeight(),height!==this.lastInputHeight&&(this.isExpanded&&this.alignPicker(),this.fireEvent("autosize",this,height),this.lastInputHeight=height,delete this.autoSizing))}});
Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Trigger",type:"boxselectfield",beginLayout:function(a){var b=this.owner;this.callParent(arguments);a.inputElCt=a.getEl("inputElCt");a.itemList=a.getEl("itemList");this.skipInputGrowth=!b.grow||!b.multiSelect},beginLayoutFixed:function(a,b,c){var d=a.target;d.triggerEl.setStyle("height","24px");this.callParent(arguments);a.heightModel.fixed&&a.lastBox&&(d.listWrapper.setStyle("height",
a.lastBox.height+"px"),d.itemList.setStyle("height","100%"));var e=d.itemList.getBox(!0,!0).width,f=d.inputElCt.dom.previousSibling,g=e-10;f&&(g-=f.offsetLeft+Ext.fly(f).getWidth()+Ext.fly(f).getPadding("lr"));!this.skipInputGrowth&&35>g?g=e-10:1>g&&(g=1);d.inputElCt.setStyle("width",g+"px")}});function mxIconSet(a){this.images=[];var b=mxClient.IS_TOUCH?"touchstart":"mousedown",c=orig(a.cell);if(isValued(c)||"Action"==c.value.nodeName){var d=mxUtils.createImage(builder_path+"/images/equal.png");d.setAttribute("title","");d.style.position="absolute";d.style.cursor="pointer";d.style.width="16px";d.style.height="16px";d.style.left=a.x+2+"px";d.style.top=a.y+2+"px";2>a.width&&(d.style.left=a.x+a.width-20);mxEvent.addListener(d,b,mxUtils.bind(this,function(a){mxEvent.consume(a)}));mxEvent.addListener(d,
"click",mxUtils.bind(this,function(a){showEditor(c);mxEvent.consume(a)}));a.view.graph.container.appendChild(d);this.images.push(d)}null!=c.value.getAttribute("Note")&&""!=Ext.String.trim(c.value.getAttribute("Note"))&&(d=mxUtils.createImage(builder_path+"/images/note.png"),d.setAttribute("title",""),d.style.position="absolute",d.style.cursor="pointer",d.style.width="16px",d.style.height="16px",d.style.left=a.x+a.width-18+"px",d.style.top=a.y+2+"px",2>a.width&&(d.style.left=a.x+2),mxEvent.addListener(d,
b,mxUtils.bind(this,function(a){mxEvent.consume(a)})),mxEvent.addListener(d,"click",mxUtils.bind(this,function(a){var b=Ext.getCmp("note"+c.id);isUndefined(b)?((new Ext.ToolTip({html:"<big>"+clean(c.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:250,draggable:!0,id:"note"+c.id,title:clean(c.value.getAttribute("name")),closeAction:"destroy"})).showAt([a.clientX+17,a.clientY-8]),mxEvent.consume(a)):b.destroy()})),a.view.graph.container.appendChild(d),this.images.push(d))}
mxIconSet.prototype.destroy=function(){if(null!=this.images)for(var a=0;a<this.images.length;a++){var b=this.images[a];b.parentNode.removeChild(b)}this.images=null};
function setupHoverIcons(){graph.addMouseListener({currentState:null,currentIconSet:null,mouseDown:function(a,b){null!=this.currentState&&(this.dragLeave(b.getEvent(),this.currentState),this.currentState=null)},mouseMove:function(a,b){if(null!=this.currentState&&(b.getState()==this.currentState||null==b.getState())){var c=new mxRectangle(b.getGraphX()-20,b.getGraphY()-20,40,40);if(mxUtils.intersects(c,this.currentState))return}c=graph.view.getState(b.getCell());if(graph.isMouseDown||null!=c&&!graph.getModel().isEdge(c.cell)&&
!graph.getModel().isVertex(c.cell))c=null;c!=this.currentState&&(null!=this.currentState&&this.dragLeave(b.getEvent(),this.currentState),this.currentState=c,null!=this.currentState&&this.dragEnter(b.getEvent(),this.currentState))},mouseUp:function(){},dragEnter:function(a,b){null==this.currentIconSet&&(this.currentIconSet=new mxIconSet(b))},dragLeave:function(){null!=this.currentIconSet&&(this.currentIconSet.destroy(),this.currentIconSet=null)}})};var findAndReplaceWin;
function showFindAndReplace(){if(!findAndReplaceWin){var a=new Ext.FormPanel({fieldDefaults:{labelWidth:100,width:375},autoScroll:!0,frame:!0,defaultType:"textfield",items:[{xtype:"textareafield",fieldLabel:getText("Search Text"),name:"frSearchData",id:"frSearchData",allowBlank:!1,selectOnFocus:!0,height:60,listeners:{change:function(){Ext.getCmp("findNextBut").setDisabled(!0)}}},{xtype:"textareafield",fieldLabel:getText("Replace Text"),name:"frReplaceData",id:"frReplaceData",allowBlank:!0,selectOnFocus:!0,
height:60},{xtype:"checkboxgroup",fieldLabel:getText("Search in"),items:[{boxLabel:getText("Names"),inputValue:"1",name:"frSearchNames",id:"frSearchNames",value:"1",checked:!0},{boxLabel:getText("Notes"),inputValue:"1",name:"frSearchNotes",id:"frSearchNotes"},{boxLabel:getText("Equations"),inputValue:"1",name:"frSearchValues",id:"frSearchValues"}]},{xtype:"checkboxfield",fieldLabel:getText("Case Sensitive"),inputValue:"1",name:"frCaseSensitive",id:"frCaseSensitive"}]});findAndReplaceWin=new Ext.Window({title:getText("Find and Replace"),
layout:"fit",closeAction:"hide",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:404,height:275,items:[a],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){findAndReplaceWin.hide()}},"->",{scale:"large",iconCls:"replace-icon",text:getText("Replace All"),handler:function(){var a=primitives(),c=Ext.getCmp("frSearchData").getValue().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),d=Ext.getCmp("frReplaceData").getValue(),
e=Ext.getCmp("frSearchNames").getValue(),f=Ext.getCmp("frSearchValues").getValue(),g=Ext.getCmp("frSearchNotes").getValue(),c=Ext.getCmp("frCaseSensitive").getValue()?RegExp(c,"g"):RegExp(c,"ig");if(!e&&!f&&!g)mxUtils.alert(getText("You must search within at least one category."));else{graph.getModel().beginUpdate();for(var h=0;h<a.length;h++){var k=a[h];k.isVisible()&&(e&&getName(k)&&setName(k,getName(k).replace(c,d)),g&&getNote(k)&&setNote(k,getNote(k).replace(c,d)),f&&getValue(k)&&setValue(k,getValue(k).replace(c,
d)))}graph.getModel().endUpdate();findAndReplaceWin.hide()}}},{scale:"large",iconCls:"find-icon",text:getText("Find Next"),disabled:!0,id:"findNextBut",tooltip:cmd("G"),handler:function(){findNext()}},{scale:"large",iconCls:"find-icon",text:getText("Find"),handler:function(){findFirst()}}]})}findAndReplaceWin.show();Ext.getCmp("frSearchData").focus(!0,100)}var currentFindPrimitive;
function findNext(){var a=primitives(),b=Ext.getCmp("frSearchData").getValue().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),c=Ext.getCmp("frSearchNames").getValue(),d=Ext.getCmp("frSearchValues").getValue(),e=Ext.getCmp("frSearchNotes").getValue(),b=Ext.getCmp("frCaseSensitive").getValue()?RegExp(b):RegExp(b,"i");if(!c&&!d&&!e)mxUtils.alert("You must search within at least one category.");else{var f=0;if(currentFindPrimitive)for(var g=0;g<a.length;g++)if(currentFindPrimitive.id==a[g].id){f=
g+1;break}f>=a.length&&(f=0);var h=2;for(0==f&&(h=1);0<h;){for(g=f;g<a.length;g++)if(currentFindPrimitive=f=a[g],f.isVisible()){if(c&&getName(f)&&-1!=getName(f).search(b)){highlight(f);findAndReplaceWin.hide();return}if(e&&getNote(f)&&-1!=getNote(f).search(b)){highlight(f);findAndReplaceWin.hide();showNote(f);return}if(d&&getValue(f)&&-1!=getValue(f).replace("/\\n/g","\n").search(b)){highlight(f);findAndReplaceWin.hide();showEditor(f);return}}h--;f=0}mxUtils.alert("Search text not found in model.")}}
function findFirst(){Ext.getCmp("findNextBut").setDisabled(!1);currentFindPrimitive=null;findNext()};var configWin,timeSettingsFn=function(){var a=Ext.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"RK1",name:getText("Fast (Euler)")},{abbr:"RK4",name:getText("Accurate (RK4)")}]});configWin||(configWin=new Ext.Window({layout:"fit",modal:!0,width:370,title:getText("Simulation Time Settings"),height:380,resizable:!1,closeAction:"hide",plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:150},frame:!0,id:"timeForm",bodyStyle:"padding:5px 5px 0",width:450,defaults:{width:330},defaultType:"textfield",
items:[new Ext.form.NumberField({fieldLabel:getText("Simulation Start"),name:"stimestart",id:"stimestart",allowBlank:!1,minValue:0,decimalPrecision:12}),new Ext.form.NumberField({fieldLabel:getText("Simulation Length"),name:"stimelength",id:"stimelength",allowBlank:!1,minValue:0,decimalPrecision:12}),new Ext.form.NumberField({fieldLabel:getText("Simulation Time Step"),name:"stimestep",id:"stimestep",allowBlank:!1,minValue:1.0E-12,step:0.1,decimalPrecision:12}),{xtype:"radiogroup",id:"tunits",fieldLabel:getText("Time Units"),
columns:1,items:[{boxLabel:getText("Seconds"),name:"tunits",inputValue:"Seconds"},{boxLabel:getText("Minutes"),name:"tunits",inputValue:"Minutes"},{boxLabel:getText("Hours"),name:"tunits",inputValue:"Hours"},{boxLabel:getText("Days"),name:"tunits",inputValue:"Days"},{boxLabel:getText("Weeks"),name:"tunits",inputValue:"Weeks"},{boxLabel:getText("Months"),name:"tunits",inputValue:"Months"},{boxLabel:getText("Years"),name:"tunits",inputValue:"Years"}]},new Ext.form.ComboBox({fieldLabel:getText("Analysis Algorithm"),
typeAhead:!0,triggerAction:"all",queryMode:"local",selectOnFocus:!0,forceSelection:!0,store:a,displayField:"name",valueField:"abbr",id:"sSolutionAlgo",editable:!1})],buttons:[{xtype:"button",scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),id:"timeCancleBut",handler:function(){configWin.hide()}},{id:"timeApplyBut",xtype:"button",iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){var a=getSetting();graph.getModel().beginUpdate();var c=new mxCellAttributeChange(a,
"SolutionAlgorithm",Ext.getCmp("sSolutionAlgo").getValue());graph.getModel().execute(c);c=new mxCellAttributeChange(a,"TimeLength",Ext.getCmp("stimelength").getValue().toString());graph.getModel().execute(c);c=new mxCellAttributeChange(a,"TimeStart",Ext.getCmp("stimestart").getValue().toString());graph.getModel().execute(c);c=new mxCellAttributeChange(a,"TimeStep",Ext.getCmp("stimestep").getValue().toString());graph.getModel().execute(c);c=new mxCellAttributeChange(a,"TimeUnits",Ext.getCmp("timeForm").getForm().getValues().tunits);
graph.getModel().execute(c);graph.getModel().endUpdate();configWin.hide()}}]})]}));a=getSetting();Ext.getCmp("stimestart").setValue(a.getAttribute("TimeStart"));Ext.getCmp("tunits").items.items["Seconds,Minutes,Hours,Days,Weeks,Months,Years".split(",").indexOf(a.getAttribute("TimeUnits"))].setValue(!0);Ext.getCmp("stimelength").setValue(a.getAttribute("TimeLength"));Ext.getCmp("stimestep").setValue(a.getAttribute("TimeStep"));Ext.getCmp("sSolutionAlgo").setValue(a.getAttribute("SolutionAlgorithm"));
configWin.show()};function textEquations(){function a(a){for(var b="",c=0;c<a.length;c++)b=b+"<li><b>"+a[c][0]+":</b> "+a[c][1]+"</li>";return"<ul>"+b+"</ul>"}function b(a,b){g=g+"<tr class='textRow"+(h?"Odd":"Even")+"'><td class='textName'>"+a+"</td><td>"+b+"</td></tr>";h=!h}function c(a){g=g+"<tr class='textDivider'><td colspan=2>"+a+"</td></tr>";h=!0}function d(a){return a&&null!=a?clean(a.getAttribute("name")):"<i>"+getText("None")+"</i>"}function e(a,b){b.getAttribute("Note")&&a.push([getText("Note"),clean(b.getAttribute("Note"))]);
return a}function f(a){a=primitives(a);a.sort(function(a,b){return d(a).toUpperCase()>d(b).toUpperCase()?1:-1});return a}var g="<table style='width:100%'>",h=!0,k=getSetting();b("Simulation Settings",a([[getText("Time Start"),clean(k.getAttribute("TimeStart"))],[getText("Time Length"),clean(k.getAttribute("TimeLength"))],[getText("Time Step"),clean(k.getAttribute("TimeStep"))],[getText("Time Units"),clean(k.getAttribute("TimeUnits"))],[getText("Algorithm"),clean(k.getAttribute("SolutionAlgorithm"))]]));
l=f("Variable");if(0<l.length){c(getText("Model Variables"));for(k=0;k<l.length;k++)b(d(l[k]),a(e([[getText("Value"),equationRenderer(getValue(l[k]))],[getText("Units"),clean(l[k].getAttribute("Units"))]],l[k])))}var l=f("Stock");if(0<l.length){c(getText("Model Stocks"));for(k=0;k<l.length;k++)b(d(l[k]),a(e([[getText("Initial Value"),equationRenderer(getValue(l[k]))],[getText("Non-Negative"),clean(l[k].getAttribute("NonNegative"))],[getText("Units"),clean(l[k].getAttribute("Units"))]],l[k])))}l=f("Flow");
if(0<l.length){c(getText("Model Flows"));for(k=0;k<l.length;k++)b(d(l[k]),a(e([[getText("Rate"),equationRenderer(getValue(l[k]))],[getText("Alpha"),clean(d(l[k].source))],[getText("Omega"),clean(d(l[k].target))],[getText("Positive Only"),clean(l[k].getAttribute("OnlyPositive"))],[getText("Units"),clean(l[k].getAttribute("Units"))]],l[k])))}l=f("Converter");if(0<l.length){c(getText("Model Converters"));for(k=0;k<l.length;k++)b(d(l[k]),a(e([[getText("Data"),clean(getValue(l[k]).replace(/\;/g,"; "))],
[getText("Source"),clean("Time"==l[k].getAttribute("Source")?"Time":d(findID(l[k].getAttribute("Source"))))],[getText("Interpolation"),clean(l[k].getAttribute("Interpolation"))],[getText("Units"),clean(l[k].getAttribute("Units"))]],l[k])))}l=f("State");if(0<l.length){c(getText("Model States"));for(k=0;k<l.length;k++)b(d(l[k]),a(e([[getText("Initial Active"),equationRenderer(getValue(l[k]))]],l[k])))}l=f("Transition");if(0<l.length){c(getText("Model Transitions"));for(k=0;k<l.length;k++)b(d(l[k]),
a(e([[getText("Trigger"),clean(l[k].getAttribute("Trigger"))],[getText("Value"),equationRenderer(getValue(l[k]))]],l[k])))}l=f("Action");if(0<l.length){c(getText("Model Actions"));for(k=0;k<l.length;k++)b(d(l[k]),a(e([[getText("Trigger"),clean(l[k].getAttribute("Trigger"))],[getText("Trigger Value"),equationRenderer(l[k].getAttribute("Value"))],[getText("Action"),equationRenderer(getValue(l[k]))]],l[k])))}var g=g+"</table>",k=Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"fit",activeTab:0,plain:!0,
flex:1,items:[{title:getText("Insight Equations"),xtype:"box",html:g,style:"background-color: white",autoScroll:!0},{padding:4,title:getText("Full Insight Specification"),xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",height:40,fieldLabel:"",value:getText("Complete Insight specification including equations and styling. You may use this to fully backup the Insight to your computer.")},{flex:1,readOnly:!0,xtype:"textareafield",hideLabel:!0,value:getGraphXml(graph).replace(/mxGraphModel/g,
"InsightMakerModel")}]}]}),n=new Ext.Window({title:getText("Complete Model Equation List"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,maximizable:!0,resizable:!0,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:500,height:400,items:k,buttons:[{scale:"large",iconCls:"import-icon",text:getText("Import Equations"),handler:function(){importModel();n.close()}},"->",{scale:"large",iconCls:"apply-icon",text:getText("Done"),handler:function(){n.close()}}]});n.show()};Ext.form.customFields.richText=Ext.extend(Ext.form.customFields.richText,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.RichTextWindow({parent:this,html:this.getValue()});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.RichTextWindow=function(a){var b=this;b.args=a;b.win=new Ext.Window({title:getText("Note Editor"),layout:{type:"fit"},closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",width:420,height:350,items:[new Ext.form.field.HtmlEditor({enableColors:!1,enableSourceEdit:!0,enableFont:!1,enableLists:!0,enableFontSize:!1,fieldLabel:"",name:"richTextItem",id:"richTextItem",allowBlank:!0,emptyText:getText("Enter a Note..."),value:b.args.html})],buttons:[{scale:"large",iconCls:"cancel-icon",
text:getText("Cancel"),handler:function(){b.win.close();""!=b.args.parent&&b.args.parent.resumeEvents()}},{scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){""!=b.args.parent?(b.args.parent.setValue(Ext.getCmp("richTextItem").getValue()),b.win.close(),b.args.parent.resumeEvents(),grid.plugins[0].completeEdit()):(graph.getModel().beginUpdate(),setNote(b.args.cell,Ext.getCmp("richTextItem").getValue()),graph.getModel().endUpdate(),selectionChanged(!1),b.win.close())}}]});b.show=
function(){b.win.show()}};function importModel(){var a=Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"fit",activeTab:0,plain:!0,flex:1,items:[{padding:4,title:"Insight Maker",xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",height:40,fieldLabel:"",value:getText('Enter an Insight Maker Insight specification. This specification should begin with "&lt;InsightMakerModel&gt;" and end with "&lt;/InsightMakerModel&gt;".')},{flex:1,xtype:"textareafield",hideLabel:!0,name:"impIM",id:"impIM",
selectOnFocus:!0}]},{padding:4,hidden:!0,title:"Simgua",xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",height:40,fieldLabel:"",value:'Enter a Simgua export file created using <a href="#">this macro</a>.'},{flex:1,xtype:"textareafield",hideLabel:!0,name:"impSimgua",id:"impSimgua",selectOnFocus:!0}]},{padding:4,hidden:!0,title:"STELLA",xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{height:40,xtype:"displayfield",fieldLabel:"",value:'Copy and paste the STELLA equation list. Equations preferences should be set to "Order by execution".'},
{flex:1,xtype:"textareafield",hideLabel:!0,name:"impSTELLA",id:"impSTELLA",selectOnFocus:!0}]}]}),b={padding:8,xtype:"container",frame:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",fieldLabel:"",value:getText("Select the type of import. Warning: your current model will be cleared on import.")},a]},c=new Ext.Window({title:getText("Import Insight Equations"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",width:480,height:420,items:[b],
buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){c.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Import Equations"),handler:function(){if("Insight Maker"==a.getActiveTab().title){if(""==Ext.getCmp("impIM").getValue().trim()){alert(getText("No Insight Equations were entered."));return}try{importMXGraph(Ext.getCmp("impIM").getValue())}catch(b){isLocal()&&console.log(b);mxUtils.alert(getText("Import could not be completed as an error was encountered."));
return}}else if("Simgua"==a.getActiveTab().title)try{importSimgua(Ext.getCmp("impSimgua").getValue())}catch(e){isLocal()&&console.log(e);mxUtils.alert(getText("Import could not be completed as an error was encountered."));return}else if("STELLA"==a.getActiveTab().title)try{importSTELLA(Ext.getCmp("impSTELLA").getValue())}catch(f){isLocal()&&console.log(f);mxUtils.alert(getText("Import could not be completed as an error was encountered."));return}clearPrimitiveCache();setAllConnectable();c.close()}}]});
c.show()}function importMXGraph(a){graph_source_data=a.replace(/InsightMakerModel/g,"mxGraphModel");a=mxUtils.parseXml(graph_source_data);(new mxCodec(a)).decode(a.documentElement,graph.getModel());clearPrimitiveCache();setAllConnectable()}
function importSimgua(a){function b(a){return null==a?c:a}clearModel();graph.getModel().beginUpdate();for(var c=createPrimitive("temp stock xyzz","Stock",[200,200],[100,100]),a=a.split("\n"),d=0;d<a.length;d++){var e=a[d].split(" --- "),f=e[0];if("STOCK"==f){var g=createPrimitive(e[1],"Stock",[500*Math.random(),500*Math.random()],[100,40]);setValue(g,e[3]);setNonNegative(g,"true"==e[2])}else"VARIABLE"==f?(g=createPrimitive(e[1],"Variable",[500*Math.random(),500*Math.random()],[120,50]),setValue(g,
e[2])):"CONVERTER"==f?(g=createPrimitive(e[1],"Converter",[500*Math.random(),500*Math.random()],[120,50]),setData(g,e[4]),setInterpolation(g,1==e[2]?"Linear":"Discrete")):"SETTING"==f&&(setTimeStart(e[1]),setTimeLength(e[2]),setTimeStep(e[3]))}for(d=0;d<a.length;d++)e=a[d].split(" --- "),f=e[0],"FLOW"==f&&(g=createConnector(e[1],"Flow",b(findName(e[2])),b(findName(e[3]))),setValue(g,e[5]),setNonNegative(g,"true"==e[4]));for(d=0;d<a.length;d++)e=a[d].split(" --- "),f=e[0],"LINK"==f?g=createConnector(e[1],
"Link",findName(e[2]),findName(e[3])):"CONVERTER"==f&&setConverterInput(findName(e[1]),findName(e[3]));layoutModel("organic");graph.getModel().endUpdate()}
function importSTELLA(a){for(var b=a.split(/\r?\n/g),a=[],c,d,e,f=void 0,g=0;g<b.length;g++){var h=b[g],k=h.split(" ");if("{"==k[0])"INITIALIZATION"==k[1]?f="init":"RUNTIME"==k[1]?f="run":"TIME"==k[1]&&(f="config");else if("init"==f)if(":"==k[0])"s"==k[1]||"S"==k[1]?(h=!0,"S"==k[1]&&(h=!1),a.push({type:"stock",name:k[2],equation:k[4],nonNegative:h})):"c"==k[1]?a.push({type:"variable",name:k[2],equation:k.slice(4).join(" ")}):"f"==k[1]&&a.push({type:"flow",name:k[2],equation:k.slice(4).join(" ")});
else if("("==h[0]){var l=a[a.length-1];a.push({type:"converter",name:l.name,data:h,equation:l.name+"_Input"});l.name+="_Input"}else"DOCUMENT:"==k[0]&&(l=a[a.length-1],l.note=k.slice(1).join(" "));else if("run"==f){if(":"==k[0]&&("s"==k[1]||"S"==k[1])){l=k.slice(8,k.length-2);l[0]=l[0].substr(1);l[l.length-1]=l[l.length-1].substr(0,l[l.length-1].length-1);for(var n="in",o=0;o<l.length;o++)if("-"==l[o])n="out";else if("+"==l[o])n="in";else for(var h=l[o],p=0;p<a.length;p++)"flow"==a[p].type&&a[p].name==
h&&("in"==n?a[p].omega=k[2].split("(")[0]:a[p].alpha=k[2].split("(")[0])}}else"config"==f&&(k=h.split("="),"STARTTIME"==k[0]?c=k[1]:"STOPTIME"==k[0]?d=k[1]:"DT"==k[0]&&(e=k[1]))}clearModel();setTimeStart(c);setTimeLength(d-c);setTimeStep(e);c=a.map(function(){return null});for(g=0;g<a.length;g++)d=a[g],"stock"==d.type?(e=createPrimitive(fixStellaName(d.name),"Stock",[100,100],[140,40]),setValue(e,fixStellaEquation(d.equation)),setNonNegative(e,d.nonNegative),c[g]=e):"variable"==d.type?(e=createPrimitive(fixStellaName(d.name),
"Variable",[100,100],[140,40]),setValue(e,fixStellaEquation(d.equation)),c[g]=e):"converter"==d.type&&(e=createPrimitive(fixStellaName(d.name),"Converter",[100,100],[140,40]),setData(e,convertStellaConverter(d.data)),c[g]=e);for(g=0;g<a.length;g++)d=a[g],"flow"==d.type&&(h=fixStellaName(d.name),e=c[getStellaPrimitive(a,d.alpha)],b=c[getStellaPrimitive(a,d.omega)],e=createConnector(h,"Flow",e,b),setValue(e,fixStellaEquation(d.equation)),c[g]=e);for(g=0;g<a.length;g++)if(d=a[g],d.note&&setNote(c[g],
d.note),d.equation)if("converter"==d.type)d=c[getStellaPrimitive(a,d.equation)],createConnector("Link","Link",d,c[g]),setConverterInput(c[g],d);else{e=RegExp("([A-Za-z][A-Za-z0-9\\\\_]+)($|[^(A-Za-z])","g");for(h=e.exec(d.equation.replace(/ /g,""));null!=h;)createConnector("Link","Link",c[getStellaPrimitive(a,h[1])],c[g]),h=e.exec(d.equation.replace(/ /g,""))}setMacros("#STELLA Compatibility Functions\nGRAPH(x) <- x\nINIT(x) <- Delay(x, (timeLength/timeStep)*10)");layoutModel("organic")}
function getStellaPrimitive(a,b){for(var c=0;c<a.length;c++)if(a[c].name==b)return c}function convertStellaConverter(a){a=a.split("), (");a[0]=a[0].substr(1);a[a.length-1]=a[a.length-1].substr(0,a[a.length-1].length-1);for(var b=0;b<a.length;b++)a[b]=a[b].replace(", ",",");return a.join(";")}function fixStellaName(a){return a.replace(/[\/\\\*\+\-_]/g," ")}
function fixStellaEquation(a){a=a.replace(/ /g,"").replace(/([A-Za-z][A-Za-z0-9\\_]+)($|\b[^(A-Za-z])/g,"[$1]$2");a=a.replace(/_/g," ");return a=a.replace(/\\/g," ")}
function cleanMXGraphSnippet(a){var b=""+Math.floor(1E4*Math.random()),a=a.replace(/parent=\"1\"/g,"XXXROOT PARENTXXX"),a=a.replace(/id=\"(\d+)\"/g,'id="'+b+'$1"'),a=a.replace(/source=\"(\d+)\"/g,'source="'+b+'$1"'),a=a.replace(/Source=\"(\d+)\"/g,'Source="'+b+'$1"'),a=a.replace(/target=\"(\d+)\"/g,'target="'+b+'$1"'),a=a.replace(/parent=\"(\d+)\"/g,'parent="'+b+'$1"'),a=a.replace(/Agent=\"(\d+)\"/g,'Agent="'+b+'$1"'),a=a.replace(/Primitives=\"([\d\,]+)\"/g,'Primitives="'+b+'$1"'),a=a.replace(/Primitives2=\"([\d\,]+)\"/g,
'Primitives2="'+b+'$1"');return a=a.replace(/XXXROOT PARENTXXX/g,'parent="1"')}function cleanMXGraph(){var a=prompt("Enter mxGraphXML:");console.log(cleanMXGraphSnippet(a))};var recordingRes;
function generateRecording(){recordingRes=[];for(var a=undoHistory.history.map(function(a){return a.changes}),b=[],c=0;c<a.length;c++)b=b.concat(a[c]);for(c=0;c<b.length;c++){console.log("Item: "+c);a=serializeChange(b[c]);if(capture&&null!==a&&(a.id!=capture.id||("attribute"!=a.type||"name"!=a.attribute)&&"geometry"!=a.type&&"terminal"!=a.type))console.log("Removing capture"),console.log(a.id),console.log(capture.id),console.log(a.type),capture=!1;console.log(a);capture&&null!==a?(console.log("Inserting into capture"),
"attribute"==a.type?capture[a.attribute]=a.value:"terminal"==a.type?(isDefined(a.alpha)&&(capture.alpha=a.alpha),isDefined(a.omega)&&(capture.omega=a.omega)):"geometry"==a.type&&(capture.geometry=a.geometry)):(console.log("Adding change"),null!==a&&recordingRes.push(a))}return JSON.stringify(cleanIds(recordingRes)).replace(/\}\,\{/g,"},\n\n{")}
function cleanIds(a){for(var b=0;b<a.length;b++)a[b].id=void 0,"attribute"==a[b].type&&(a[b].type=void 0,"Agent"==a[b].attribute&&(a[b].value=getName(findID(a[b].value)))),"create"==a[b].type&&(a[b].create=a[b].primitive,a[b].primitive=void 0,a[b].type=void 0),"geometry"==a[b].type&&(a[b].type=void 0),"remove"==a[b].type&&(a[b].remove=a[b].target,a[b].target=void 0,a[b].type=void 0);return a}var capture=!1,folderItems=[];
function serializeChange(a){if(a instanceof mxCellAttributeChange){if(a.value==a.previous||""==a.value&&isUndefined(a.previous))return null;var b={type:"attribute",id:a.cell.id,attribute:a.attribute};b.target="name"==a.attribute?a.previous:"Display"==a.cell.value.nodeName?"DISPLAY":a.cell.getAttribute("name");b.value="Primitives"==a.attribute?getName(findID(a.value.split(","))):a.value;return b}if(a instanceof mxChildChange){if(isUndefined(a.index))return{type:"remove",target:a.child.getAttribute("name")};
if(a.parent.value)folderItems.push(a.child);else{b=a.child.geometry;capture={type:"create",id:a.child.id,primitive:a.child.value.nodeName,geometry:{x:b.x,y:b.y,width:b.width,height:b.height}};if(b.sourcePoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))capture.geometry.sourcePoint={x:b.sourcePoint.x,y:b.sourcePoint.y};if(b.targetPoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))capture.geometry.targetPoint={x:b.targetPoint.x,
y:b.targetPoint.y};if("Folder"==a.child.value.nodeName){if(0==folderItems.length)return null;capture.items=getName(folderItems);folderItems=[]}recordingRes.push(capture)}return null}if(a instanceof mxGeometryChange){if(0<folderItems.length)return null;b=a.cell.geometry;a={type:"geometry",id:a.cell.id,target:a.cell.getAttribute("name"),geometry:{x:b.x,y:b.y,width:b.width,height:b.height}};if(b.sourcePoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))a.geometry.sourcePoint=
{x:b.sourcePoint.x,y:b.sourcePoint.y};if(b.targetPoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))a.geometry.targetPoint={x:b.targetPoint.x,y:b.targetPoint.y};return a}if(a instanceof mxTerminalChange){b={type:"terminal",id:a.cell.id,target:a.cell.getAttribute("name")};a.source&&(b.alpha=a.terminal?a.terminal.getAttribute("name"):null);a.source||(b.omega=a.terminal?a.terminal.getAttribute("name"):null);return!1==capture||capture.id!=b.id?(capture=b,recordingRes.push(capture),
null):b}return null};var unfoldingManager={unfolding:!1};function beginUnfolding(){unfoldingManager.unfolding=!0;unfoldingManager.init=getGraphXml(graph);initUnfolding()}function restartUnfolding(a){loadStoredUnfolding();a&&(saveUnfoldingStatus(a),unfoldingManager.init=getGraphXml(graph));initUnfolding()}
function saveUnfoldingStatus(a){var b=unfoldingManager.unfolding;unfoldingManager.unfolding=!1;graph.getModel().beginUpdate();var c=new mxCellAttributeChange(getSetting(),"unfolding",a.steps);graph.getModel().execute(c);c=new mxCellAttributeChange(getSetting(),"unfoldingStatus",a.enabled);graph.getModel().execute(c);c=new mxCellAttributeChange(getSetting(),"unfoldingAuto",a.auto);graph.getModel().execute(c);graph.getModel().endUpdate();unfoldingManager.unfolding=b}
function finishUnfolding(){unfoldingManager.unfolding=!1;loadStoredUnfolding()}function loadStoredUnfolding(){importMXGraph(unfoldingManager.init);!is_editor&&is_embed&&1==is_zoom&&(graph.getView().setScale(0.25),graph.fit(),graph.fit())}function initUnfolding(){unfoldingManager.steps=JSON.parse(getSetting().getAttribute("unfolding"));unfoldingManager.step=0;Ext.getCmp("messageUnfoldBut").update("");Ext.getCmp("nextUnfoldBut").setDisabled(!1);doUnfoldStep()}
function doUnfoldStep(){unfoldingManager.steps.children.length>unfoldingManager.step&&(executeUnfoldAction(unfoldingManager.steps.children[unfoldingManager.step]),unfoldingManager.step++);unfoldingManager.steps.children.length<=unfoldingManager.step&&Ext.getCmp("nextUnfoldBut").setDisabled(!0)}
function executeUnfoldAction(a){if("group"==a.type)for(var b=0;b<a.children.length;b++)executeUnfoldAction(a.children[b]);else"note"==a.type?Ext.getCmp("messageUnfoldBut").update(a.data):"visibility"==a.type?(a=JSON.parse(a.data),setOpacity(findID(a.ids).filter(function(a){return null!==a}),a.opacity)):"action"==a.type?runAction(a.data):(alert("Unknown action!"),console.log(a))}
var handleUnfoldToolbar=function(a){var b="on"==getSetting().getAttribute("unfoldingStatus"),c=Ext.getCmp("unfoldToolbar");if(!a||b&&c.isHidden()||!b&&!c.isHidden())b?c.show():c.hide(),a=!1,b=getSetting().getAttribute("unfoldingAuto"),isUndefined(b)&&(b="non-editors"),"never"!=b&&("always"==b?a=!0:is_embed&&"editors"!=b?a=!0:"editors"==b&&is_editor?a=!0:"non-editors"==b&&!is_editor&&(a=!0)),revealUnfoldButtons(a),a&&beginUnfolding()},revealUnfoldButtons=function(a){a?(Ext.getCmp("unfoldUnfoldBut").hide(),
Ext.getCmp("reloadUnfoldBut").show(),Ext.getCmp("exitUnfoldBut").show(),Ext.getCmp("messageUnfoldBut").show(),Ext.getCmp("nextUnfoldBut").show()):(Ext.getCmp("unfoldUnfoldBut").show(),Ext.getCmp("reloadUnfoldBut").hide(),Ext.getCmp("exitUnfoldBut").hide(),Ext.getCmp("messageUnfoldBut").hide(),Ext.getCmp("nextUnfoldBut").hide())};
function showUnfoldingWin(){function a(){if(Ext.getCmp("opacitySlider")){var a=Ext.getCmp("opacitySlider").getValue(),b=Ext.getCmp("unfoldingPrimitives").getValue();e.set("data",JSON.stringify({opacity:a,ids:b}))}}function b(a){var b=function(c){var d=c.data,e={text:d.text,data:d.data,type:d.type,leaf:d.leaf,expanded:d.expanded};a&&(e.flag=d.flag);e.children=[];for(d=0;d<c.childNodes.length;d++)e.children.push(b(c.childNodes[d]));return e};return b(f.getRootNode())}var c=!1,d=getSetting(),e,f=new Ext.data.TreeStore({fields:[{name:"text",
type:"string"},{name:"type",type:"string"},{name:"data",type:"string"},{name:"flag",type:"string"}],proxy:{type:"memory"}});d.getAttribute("unfolding")?f.setRootNode(JSON.parse(d.getAttribute("unfolding"))):f.setRootNode({text:"Root Node",type:"root",id:"src",expanded:!0});for(var g=Ext.create("Ext.tree.Panel",{title:getText("Unfolding Steps"),disabled:"on"!=d.getAttribute("unfoldingStatus"),useArrows:!0,flex:1,rootVisible:!1,id:"stepsTree",store:f,viewConfig:{plugins:{ptype:"treeviewdragdrop",containerScroll:!0}},
listeners:{select:{fn:function(a,b){c=!0;e&&e.set("flag","");e=b;var d=e.get("type");e.set("flag","selected");"visibility"==d?(o.getLayout().setActiveItem(1),d=JSON.parse(e.get("data")),Ext.getCmp("opacitySlider").setValue(d.opacity),Ext.getCmp("unfoldingPrimitives").setValue(d.ids)):"note"==d?(Ext.getCmp("actionNote").setValue(e.get("data")),o.getLayout().setActiveItem(2)):"action"==d?(Ext.getCmp("actionCode").setValue(e.get("data")),o.getLayout().setActiveItem(3)):"group"==d&&(Ext.getCmp("groupName").setValue(e.get("text")),
o.getLayout().setActiveItem(4));c=!1}}},bbar:[{iconCls:"units-remove-icon",text:getText("Remove"),scope:this,handler:function(){function a(b){for(var c=0;c<b.children.length;c++)"selected"==b.children[c].flag?(b.children.splice(c,1),c--):a(b.children[c])}var c=b(!0);a(c);f.setRootNode(c);o.getLayout().setActiveItem(0)}},"->",{iconCls:"units-add-icon",text:getText("Add Step"),scope:this,menu:{xtype:"menu",items:[{text:getText("Change Visibility"),handler:function(){var a=g.getRootNode().appendChild({text:getText("Visibility Change"),
data:'{"opacity": 100, "ids": []}',type:"visibility",leaf:!0});g.getSelectionModel().select(a)}},{text:getText("Show Message"),handler:function(){var a=g.getRootNode().appendChild({text:getText("Show Message"),data:getText("Enter your message..."),type:"note",leaf:!0});g.getSelectionModel().select(a)}},"-",{text:getText("Run Action"),handler:function(){var a=g.getRootNode().appendChild({text:getText("Run Action"),data:"",type:"action",leaf:!0});g.getSelectionModel().select(a)}},"-",{text:getText("Group Steps"),
handler:function(){var a=g.getRootNode().appendChild({text:getText("New Group"),type:"group",leaf:!1});g.getSelectionModel().select(a)}}]}}]}),h=[],k=findAll(),l=0;l<k.length;l++){var n=getName(k[l]);h.push({pid:getID(k[l]),pname:isDefined(n)?n:"--"})}h.sort(function(a,b){return a.pname.localeCompare(b.pname)});displayConfigStore=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:h});var o=Ext.create("Ext.container.Container",{flex:1,layout:"card",items:[{xtype:"form",
padding:8,bodyStyle:"background:none",border:!1},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Opacity")+":"},{xtype:"slider",id:"opacitySlider",value:100,increment:1,minValue:0,animate:!1,listeners:{change:a}},{xtype:"displayfield",value:getText("Primitives")+":"},Ext.create("Ext.ux.form.field.BoxSelect",{hideLabel:!0,name:"unfoldingPrimitives",id:"unfoldingPrimitives",displayField:"pname",
valueField:"pid",queryMode:"local",store:displayConfigStore,emptyText:getText("Data"),listeners:{change:a}}),{xtype:"button",text:getText("Select from Diagram"),handler:function(){Ext.getCmp("unfoldingPrimitives").setValue(getSelected().map(function(a){return getID(a)}))}}]},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Message")+":"},{xtype:"htmleditor",enableColors:!1,enableSourceEdit:!0,enableFont:!1,
enableLists:!0,enableFontSize:!1,id:"actionNote",hideLabel:!0,height:200,listeners:{change:function(a,b){c||e.set("data",b)}}}]},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Action Code")+":"},{xtype:"textareafield",id:"actionCode",rows:16,hideLabel:!0,listeners:{change:function(a,b){e.set("data",b)}}}]},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,plain:!0,items:[{xtype:"textfield",
id:"groupName",fieldLabel:getText("Name"),labelWidth:60,allowBlank:!1,listeners:{change:function(a,b){e.set("text",b)}}}]}]}),h={padding:8,xtype:"container",frame:!1,layout:{type:"hbox",align:"stretch"},items:[g,o]},p=new Ext.Window({title:getText("Model Unfolding Designer"),layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!1,shadow:!0,buttonAlign:"right",width:480,height:420,items:[h],tbar:[{xtype:"checkbox",id:"enabledChk",labelWidth:70,hideLabel:!0,boxLabel:getText("Enabled"),checked:"on"==
d.getAttribute("unfoldingStatus"),listeners:{change:function(a,b){b?Ext.getCmp("stepsTree").setDisabled(!1):Ext.getCmp("stepsTree").setDisabled(!0)}}},"->",{xtype:"combo",id:"autoCombo",fieldLabel:getText("Automatically Unfold")+":",labelWidth:130,store:[["never",getText("Never")],["editors",getText("For Editors")],["non-editors",getText("For Non-Editors")],["always",getText("Always")]],forceSelection:!0,value:d.getAttribute("unfoldingAuto")||"non-editors",listeners:{select:function(){}}}],buttons:[{scale:"large",
iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){p.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){var a={steps:JSON.stringify(b()),enabled:Ext.getCmp("enabledChk").getValue()?"on":"off",auto:Ext.getCmp("autoCombo").getValue()};unfoldingManager.unfolding?restartUnfolding(a):saveUnfoldingStatus(a);handleUnfoldToolbar(!0);p.close()}}]});p.show()};Ext.Loader.setConfig({enabled:!0});Ext.Loader.setPath("Ext.ux.exporter","/builder/js/exporter");
Ext.define("Ext.ux.exporter.Exporter",{uses:["Ext.ux.exporter.Base64","Ext.ux.exporter.Button","Ext.ux.exporter.csvFormatter.CsvFormatter"],statics:{exportAny:function(a,b,c){var d="export";a.is?a.is("gridpanel")?d+="Grid":a.is("treepanel")?d+="Tree":(d+="Store",a=a.getStore()):d+="Store";return this[d](a,this.getFormatterByName(b),c)},exportGrid:function(a,b,c){var c=c||{},b=this.getFormatterByName(b),d=Ext.Array.filter(a.columns,function(a){return!a.hidden});Ext.applyIf(c,{title:a.title,columns:d});
return b.format(a.store,c)},exportStore:function(a,b,c){c=c||{};b=this.getFormatterByName(b);Ext.applyIf(c,{columns:a.fields?a.fields.items:a.model.prototype.fields.items});return b.format(a,c)},exportTree:function(a,b,c){var c=c||{},b=this.getFormatterByName(b),d=a.store||c.store;Ext.applyIf(c,{title:a.title});return b.format(d,c)},getFormatterByName:function(a){a=a?a:"csv";return a=!Ext.isString(a)?a:Ext.create("Ext.ux.exporter."+a+"Formatter."+Ext.String.capitalize(a)+"Formatter")}}});(function(){Downloadify=window.Downloadify={queue:{},uid:(new Date).getTime(),getTextForSave:function(a){return(a=Downloadify.queue[a])?a.getData():""},getFileNameForSave:function(a){return(a=Downloadify.queue[a])?a.getFilename():""},getDataTypeForSave:function(a){return(a=Downloadify.queue[a])?a.getDataType():""},saveComplete:function(a){(a=Downloadify.queue[a])&&a.complete();return!0},saveCancel:function(a){(a=Downloadify.queue[a])&&a.cancel();return!0},saveError:function(a){(a=Downloadify.queue[a])&&
a.error();return!0},addToQueue:function(a){Downloadify.queue[a.queue_name]=a},getUID:function(a){""==a.id&&(a.id="downloadify_"+Downloadify.uid++);return a.id}};Downloadify.create=function(a,b){var c="string"==typeof a?document.getElementById(a):a;return new Downloadify.Container(c,b)};Downloadify.Container=function(a,b){var c=this;c.el=a;c.enabled=!0;c.dataCallback=null;c.filenameCallback=null;c.data=null;c.filename=null;c.enable=function(){document.getElementById(c.flashContainer.id).setEnabled(!0);
c.enabled=!0};c.disable=function(){document.getElementById(c.flashContainer.id).setEnabled(!1);c.enabled=!1};c.getData=function(){return!c.enabled?"":c.dataCallback?c.dataCallback():c.data?c.data:""};c.getFilename=function(){return c.filenameCallback?c.filenameCallback():c.filename?c.filename:""};c.getDataType=function(){return c.options.dataType?c.options.dataType:"string"};c.complete=function(){if("function"===typeof c.options.onComplete)c.options.onComplete()};c.cancel=function(){if("function"===
typeof c.options.onCancel)c.options.onCancel()};c.error=function(){if("function"===typeof c.options.onError)c.options.onError()};(function(){c.options=b;c.options.append||(c.el.innerHTML="");c.flashContainer=document.createElement("span");c.el.appendChild(c.flashContainer);c.queue_name=Downloadify.getUID(c.flashContainer);"function"===typeof c.options.filename?c.filenameCallback=c.options.filename:c.options.filename&&(c.filename=c.options.filename);"function"===typeof c.options.data?c.dataCallback=
c.options.data:c.options.data&&(c.data=c.options.data);var a={queue_name:c.queue_name,width:c.options.width,height:c.options.height},e={allowScriptAccess:"always"},f={id:c.flashContainer.id,name:c.flashContainer.id};!1===c.options.enabled&&(c.enabled=!1);!0===c.options.transparent&&(e.wmode="transparent");c.options.downloadImage&&(a.downloadImage=c.options.downloadImage);swfobject.embedSWF(c.options.swf,c.flashContainer.id,c.options.width,c.options.height,"10",null,a,e,f);Downloadify.addToQueue(c)})()};
Downloadify.defaultOptions={swf:"media/downloadify.swf",downloadImage:"images/download.png",width:100,height:30,transparent:!0,append:!1,dataType:"string"}})();"undefined"!=typeof jQuery&&function(a){a.fn.downloadify=function(b){return this.each(function(){b=a.extend({},Downloadify.defaultOptions,b);var c=Downloadify.create(this,b);a(this).data("Downloadify",c)})}}(jQuery);
"undefined"!=typeof MooTools&&Element.implement({downloadify:function(a){a=$merge(Downloadify.defaultOptions,a);return this.store("Downloadify",Downloadify.create(this,a))}});var swfobject=function(){function a(){if(!O){try{var a=y.getElementsByTagName("body")[0].appendChild(y.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}O=!0;for(var a=C.length,c=0;c<a;c++)C[c]()}}function b(a){O?a():C[C.length]=a}function c(a){if(typeof J.addEventListener!=x)J.addEventListener("load",a,!1);else if(typeof y.addEventListener!=x)y.addEventListener("load",a,!1);else if(typeof J.attachEvent!=x)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=
function(){b();a()}}else J.onload=a}function d(){var a=y.getElementsByTagName("body")[0],b=y.createElement(B);b.setAttribute("type",z);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=x){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),G.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;e()})()}else e()}function e(){var a=F.length;if(0<a)for(var b=0;b<a;b++){var c=F[b].id,
d=F[b].callbackFn,e={success:!1,id:c};if(0<G.pv[0]){var l=p(c);if(l)if(s(F[b].swfVersion)&&!(G.wk&&312>G.wk))w(c,!0),d&&(e.success=!0,e.ref=f(c),d(e));else if(F[b].expressInstall&&g()){e={};e.data=F[b].expressInstall;e.width=l.getAttribute("width")||"0";e.height=l.getAttribute("height")||"0";l.getAttribute("class")&&(e.styleclass=l.getAttribute("class"));l.getAttribute("align")&&(e.align=l.getAttribute("align"));for(var n={},l=l.getElementsByTagName("param"),o=l.length,r=0;r<o;r++)"movie"!=l[r].getAttribute("name").toLowerCase()&&
(n[l[r].getAttribute("name")]=l[r].getAttribute("value"));h(e,n,c,d)}else k(l),d&&d(e)}else if(w(c,!0),d){if((c=f(c))&&typeof c.SetVariable!=x)e.success=!0,e.ref=c;d(e)}}}function f(a){var b=null;if((a=p(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=x?b=a:(a=a.getElementsByTagName(B)[0])&&(b=a);return b}function g(){return!Q&&s("6.0.65")&&(G.win||G.mac)&&!(G.wk&&312>G.wk)}function h(a,b,c,d){Q=!0;L=d||null;S={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(H=l(e),N=null):(H=e,N=c);a.id=
A;if(typeof a.width==x||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==x||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";y.title=y.title.slice(0,47)+" - Flash Player Installation";d=G.ie&&G.win?"ActiveX":"PlugIn";d="MMredirectURL="+J.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+y.title;b.flashvars=typeof b.flashvars!=x?b.flashvars+("&"+d):d;G.ie&&G.win&&4!=e.readyState&&(d=y.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",
c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());n(a,b,c)}}function k(a){if(G.ie&&G.win&&4!=a.readyState){var b=y.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(l(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(l(a),a)}function l(a){var b=y.createElement("div");if(G.win&&
G.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(B)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function n(a,b,c){var d,e=p(c);if(G.wk&&312>G.wk)return d;if(e)if(typeof a.id==x&&(a.id=c),G.ie&&G.win){var f="",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+
g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";I[I.length]=a.id;d=p(a.id)}else{h=y.createElement(B);h.setAttribute("type",z);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?h.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&h.setAttribute(k,a[k]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&
(a=h,g=f,k=b[f],c=y.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",k),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function o(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(G.ie&&G.win?(b.style.display="none",function(){if(4==b.readyState){var c=p(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function p(a){var b=null;try{b=y.getElementById(a)}catch(c){}return b}
function r(a,b,c){a.attachEvent(b,c);P[P.length]=[a,b,c]}function s(a){var b=G.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function u(a,b,c,d){if(!G.ie||!G.mac){var e=y.getElementsByTagName("head")[0];if(e){c=c&&"string"==typeof c?c:"screen";d&&(ba=K=null);if(!K||ba!=c)d=y.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),K=e.appendChild(d),
G.ie&&G.win&&typeof y.styleSheets!=x&&0<y.styleSheets.length&&(K=y.styleSheets[y.styleSheets.length-1]),ba=c;G.ie&&G.win?K&&typeof K.addRule==B&&K.addRule(a,b):K&&typeof y.createTextNode!=x&&K.appendChild(y.createTextNode(a+" {"+b+"}"))}}}function w(a,b){if(X){var c=b?"visible":"hidden";O&&p(a)?p(a).style.visibility=c:u("#"+a,"visibility:"+c)}}function v(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=x?encodeURIComponent(a):a}var x="undefined",B="object",z="application/x-shockwave-flash",
A="SWFObjectExprInst",J=window,y=document,D=navigator,E=!1,C=[function(){E?d():e()}],F=[],I=[],P=[],H,N,L,S,O=!1,Q=!1,K,ba,X=!0,G=function(){var a=typeof y.getElementById!=x&&typeof y.getElementsByTagName!=x&&typeof y.createElement!=x,b=D.userAgent.toLowerCase(),c=D.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\v1",f=[0,0,0],g=null;if(typeof D.plugins!=x&&typeof D.plugins["Shockwave Flash"]==
B){if((g=D.plugins["Shockwave Flash"].description)&&!(typeof D.mimeTypes!=x&&D.mimeTypes[z]&&!D.mimeTypes[z].enabledPlugin))E=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof J.ActiveXObject!=x)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(h&&(g=h.GetVariable("$version")))e=!0,g=g.split(" ")[1].split(","),
f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}catch(k){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();(function(){G.w3&&((typeof y.readyState!=x&&"complete"==y.readyState||typeof y.readyState==x&&(y.getElementsByTagName("body")[0]||y.body))&&a(),O||(typeof y.addEventListener!=x&&y.addEventListener("DOMContentLoaded",a,!1),G.ie&&G.win&&(y.attachEvent("onreadystatechange",function(){"complete"==y.readyState&&(y.detachEvent("onreadystatechange",arguments.callee),a())}),J==top&&function(){if(!O){try{y.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),G.wk&&function(){O||(/loaded|complete/.test(y.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)))})();(function(){G.ie&&G.win&&window.attachEvent("onunload",function(){for(var a=P.length,b=0;b<a;b++)P[b][0].detachEvent(P[b][1],P[b][2]);a=I.length;for(b=0;b<a;b++)o(I[b]);for(var c in G)G[c]=null;G=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(a,b,c,d){if(G.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=
d;F[F.length]=e;w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(G.w3)return f(a)},embedSWF:function(a,c,d,e,f,k,l,o,p,r){var u={success:!1,id:c};G.w3&&!(G.wk&&312>G.wk)&&a&&c&&d&&e&&f?(w(c,!1),b(function(){d+="";e+="";var b={};if(p&&typeof p===B)for(var v in p)b[v]=p[v];b.data=a;b.width=d;b.height=e;v={};if(o&&typeof o===B)for(var y in o)v[y]=o[y];if(l&&typeof l===B)for(var z in l)v.flashvars=typeof v.flashvars!=x?v.flashvars+("&"+z+"="+l[z]):z+"="+l[z];if(s(f))y=n(b,v,c),b.id==
c&&w(c,!0),u.success=!0,u.ref=y;else{if(k&&g()){b.data=k;h(b,v,c,r);return}w(c,!0)}r&&r(u)})):r&&r(u)},switchOffAutoHideShow:function(){X=!1},ua:G,getFlashPlayerVersion:function(){return{major:G.pv[0],minor:G.pv[1],release:G.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){if(G.w3)return n(a,b,c)},showExpressInstall:function(a,b,c,d){G.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){G.w3&&o(a)},createCSS:function(a,b,c,d){G.w3&&u(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=
y.location.search||y.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return v(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return v(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Q){var a=p(A);a&&H&&(a.parentNode.replaceChild(H,a),N&&(w(N,!0),G.ie&&G.win&&(H.style.display="block")),L&&L(S));Q=!1}}}}();Ext.define("Ext.ux.exporter.Formatter",{format:Ext.emptyFn,constructor:function(a){a=a||{};Ext.applyIf(a,{})}});(function(){Ext.define("Ext.ux.exporter.Base64",{statics:{encode:function(a){var b="",c,d,e,f,g,h,k=0,a=a.replace(/\r\n/g,"\n");d="";for(e=0;e<a.length;e++)f=a.charCodeAt(e),128>f?d+=String.fromCharCode(f):(127<f&&2048>f?d+=String.fromCharCode(f>>6|192):(d+=String.fromCharCode(f>>12|224),d+=String.fromCharCode(f>>6&63|128)),d+=String.fromCharCode(f&63|128));for(a=d;k<a.length;)c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),f=c>>2,c=(c&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:
isNaN(e)&&(h=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return b}}})})();Ext.define("Ext.ux.exporter.Button",{extend:"Ext.Component",alias:"widget.exporterbutton",html:"<p></p>",config:{swfPath:"/builder/resources/exporter/downloadify.swf",downloadImage:"/builder/resources/exporter/download.png",width:62,height:22,downloadName:"download"},constructor:function(a){a=a||{};this.initConfig();Ext.ux.exporter.Button.superclass.constructor.call(this,a);var b=this;this.on("afterrender",function(){b.setComponent(b.store||b.component||b.up("gridpanel")||b.up("treepanel"),a)})},
setComponent:function(a,b){this.component=a;this.store=!a.is?a:a.getStore();this.setDownloadify(b)},setDownloadify:function(a){var b=this;Downloadify.create(this.el.down("p").id,{filename:function(){return b.getDownloadName()+"."+Ext.ux.exporter.Exporter.getFormatterByName(b.formatter).extension},data:function(){return Ext.ux.exporter.Exporter.exportAny(b.component,b.formatter,a)},transparent:!1,swf:this.getSwfPath(),downloadImage:this.getDownloadImage(),width:this.getWidth(),height:this.getHeight(),
transparent:!0,append:!1})}});Ext.define("Ext.ux.exporter.csvFormatter.CsvFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/csv;base64,",separator:",",extension:"csv",format:function(a,b){this.columns=b.columns||(a.fields?a.fields.items:a.model.prototype.fields.items);return this.getHeaders()+"\n"+this.getRows(a)},getHeaders:function(){var a=[];Ext.each(this.columns,function(b){var c;void 0!=b.text?c=b.text:b.name&&(c=b.name.replace(/_/g," "),c=Ext.String.capitalize(c));a.push(c)},this);return a.join(this.separator)},
getRows:function(a){var b=[];a.each(function(a,d){b.push(this.geCell(a,d))},this);return b.join("\n")},geCell:function(a){var b=[];Ext.each(this.columns,function(c){if(c=c.name||c.dataIndex)c=a.get(c),b.push(c)});return b.join(this.separator)}});function showMessage(a){alert(a)}function showPrompt(a,b){return prompt(a,b)}function showChoice(a){return confirm(a)}function showURL(a){window.open(a,"","scrollbars=yes,menubar=yes,height=500,width=700,resizable=yes,toolbar=yes,location=yes,status=yes")}
function showData(a,b,c){c||(c=[640,480]);for(var d=[],e=0;e<b.length;e++){var f={layout:"fit"};f.title=b[e].name;if("text"==b[e].type.toLowerCase())f.items=[{xtype:"textareafield",value:b[e].data,readOnly:!0}];else if("html"==b[e].type.toLowerCase())f.items=[{title:"Insight Equations",xtype:"box",html:b[e].data,style:"background-color: white",autoScroll:!0}];else if("table"==b[e].type.toLowerCase()){for(var g={xtype:"grid"},h=[],k=[],l=[],n=0;n<b[e].data.length;n++){h.push({dataIndex:"a"+n,text:b[e].header?
b[e].header[n]:""});for(var o="float",p=0;p<b[e].data[n].length;p++)"string"==typeof b[e].data[n][e]&&(o="string");k.push({name:"a"+n,type:o})}for(p=0;p<b[e].data[0].length;p++)l.push({});for(n=0;n<b[e].data.length;n++)for(p=0;p<b[e].data[0].length;p++)l[p]["a"+n]=b[e].data[n][p];g.columns=h;g.store=new Ext.data.JsonStore({fields:k,data:l});b[e].header||(g.hideHeaders=!0);g.dockedItems=[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"exporterbutton",downloadName:b[e].name}]}];f.items=[g]}else if("chart"==
b[e].type.toLowerCase()){for(var k="#94ae0a,#115fa6,#a61120,#ff8809,#ffd13e,#a61187,#24ad9a,#7c7474,#a66111".split(","),l=0,r=[],n=0;n<b[e].data.length;n++)b[e].data[n].color?r.push(b[e].data[n].color):(r.push(k[l]),l++,l%=k.length);n="theme"+Math.random();Ext.chart.theme[n]=Ext.extend(Ext.chart.theme.Base,{constructor:function(a){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({colors:r},a))}});g=[];k=[{name:"x",type:"Numeric"==b[e].xType?"float":"string"}];h=[];l=[];for(n=0;n<b[e].xData.length;n++)l.push({x:b[e].xData[n]});
for(n=0;n<b[e].data.length;n++){k.push({name:"a"+n,type:"float"});g.push({type:b[e].data[n].type,title:b[e].data[n].name,axis:"left",xField:"x",yField:"a"+n,showInLegend:b[e].data[n].hideLegend?!1:!0,fill:b[e].data[n].fill?b[e].data[n].fill:!1,showMarkers:b[e].data[n].hideMarkers?!1:!0,style:{opacity:1}});b[e].data[n].color&&(g[g.length-1].style={stroke:b[e].data[n].color,fill:b[e].data[n].color,opacity:1});h.push("a"+n);for(p=0;p<b[e].data[n].data.length;p++)l[p]["a"+n]=b[e].data[n].data[p]}n={xtype:"chart",
background:{fill:"#fff"},animate:!1,shadow:!1,legend:{position:b[e].legend,visible:b[e].legend&&"none"!=b[e].legend},store:new Ext.data.JsonStore({fields:k,data:l}),axes:[{position:"bottom",type:b[e].xType?b[e].xType:"Numeric",grid:b[e].verticalGrid?b[e].verticalGrid:!1,title:b[e].xLabel?b[e].xLabel:"",fields:["x"]},{position:"left",type:"Numeric",grid:b[e].horizontalGrid?b[e].horizontalGrid:!1,title:b[e].yLabel?b[e].yLabel:"",fields:h}],series:g};f.items=[n]}else alert("Unknown tab type: "+b[e].type);
d.push(f)}var s=new Ext.Window({title:a,layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!0,closable:!0,maximizable:!0,minimizable:!0,shadow:!0,width:c[0],height:c[1],items:[{xtype:"tabpanel",layout:"fit",items:d}]});s.on("minimize",function(a){a.expandedState?(a.expandedState=!1,a.collapse()):(a.expandedState=!0,s.expand())});s.show();return s}function runModel(a){isUndefined(a)?a={}:"boolean"==typeof a&&(a={silent:a});return runSimulation(a)}
function saveModel(a){a||""==graph_title?updateProperties():sendGraphtoServer(graph)}function clearModel(){graph.getModel().beginUpdate();graph.selectAll();graph.removeCells(graph.getSelectionCells(),!1);graph.getModel().endUpdate()}
function layoutModel(a){"organic"==a?(a=new mxFastOrganicLayout(graph),a.forceConstant=50,executeLayout(a,!0)):"circular"==a?executeLayout(new mxCircleLayout(graph),!0):"hierarchical"==a?(a=new mxCompactTreeLayout(graph),a.horizontal=!1,a.resizeParent=!1,a.moveTree=!1,executeLayout(a,!0)):alert("Unknown layout algorithm: "+a)}
var executeLayout=function(a,b,c){var d=graph.getSelectionCell();if(null==d||!c&&0==graph.getModel().getChildCount(d))d=graph.getDefaultParent();graph.getModel().beginUpdate();try{a.execute(d)}catch(e){throw e;}finally{b&&0>navigator.userAgent.indexOf("Camino")?(a=new mxMorphing(graph),a.addListener(mxEvent.DONE,function(){graph.getModel().endUpdate()}),a.startAnimation()):graph.getModel().endUpdate()}};function getTimeStep(){return getSetting().getAttribute("TimeStep")}
function setTimeStep(a){a=new mxCellAttributeChange(getSetting(),"TimeStep",a);graph.getModel().execute(a)}function getTimeStart(){return getSetting().getAttribute("TimeStart")}function setTimeStart(a){a=new mxCellAttributeChange(getSetting(),"TimeStart",a);graph.getModel().execute(a)}function getTimeLength(){return getSetting().getAttribute("TimeLength")}function setTimeLength(a){a=new mxCellAttributeChange(getSetting(),"TimeLength",a);graph.getModel().execute(a)}
function getTimeUnits(){return getSetting().getAttribute("TimeUnits")}function setTimeUnits(a){a=new mxCellAttributeChange(getSetting(),"TimeUnits",a);graph.getModel().execute(a)}function getAlgorithm(){return getSetting().getAttribute("SolutionAlgorithm")}function setAlgorithm(a){a=new mxCellAttributeChange(getSetting(),"SolutionAlgorithm",a);graph.getModel().execute(a)}function getMacros(){return getSetting().getAttribute("Macros")}
function setMacros(a){a=new mxCellAttributeChange(getSetting(),"Macros",a);graph.getModel().execute(a)}function findName(a){var b=map(a,function(a){for(var b=[],e=findAll(),f=0;f<e.length;f++)isDefined(e[f].getAttribute("name"))&&e[f].getAttribute("name").toLowerCase()==a.toLowerCase()&&b.push(e[f]);return b}),b=Ext.Array.flatten(b),b=Ext.Array.filter(b,function(a){return null!==a});return a instanceof Array?b:0==b.length?null:1==b.length?b[0]:b}
function findAll(){for(var a=primitives(),b=[],c=0;c<a.length;c++)"Setting"==a[c].value.nodeName||"Display"==a[c].value.nodeName||b.push(a[c]);return b}function findType(a){a=map(a,function(a){return primitives(a)});return a=Ext.Array.flatten(a)}function findID(a){var b=primitives(),c=map(a,function(a){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null});return null===c?c:a instanceof Array?c:1==c.length?c[0]:c}
function findValue(a){var b=findAll(),a=map(a,function(a){for(var d=[],e=0;e<b.length;e++)a instanceof RegExp?a.test(getValue(b[e]))&&d.push(b[e]):getValue(b[e])==a&&d.push(b[e]);return d});return uniquePrimitives(Ext.Array.flatten(a))}function findNote(a){var b=findAll(),a=map(a,function(a){for(var d=[],e=0;e<b.length;e++)a instanceof RegExp?a.test(getNote(b[e]))&&d.push(b[e]):getNote(b[e])==a&&d.push(b[e]);return d});return uniquePrimitives(Ext.Array.flatten(a))}
function createPrimitive(a,b,c,d){var e=graph.getDefaultParent(),b=b.toLowerCase(),c=graph.insertVertex(e,null,primitiveBank[b].cloneNode(!0),c[0],c[1],d[0],d[1],b);setName(c,a);if(isValued(c)||"Agents"==c.value.nodeName){a=primitives("Display");for(d=0;d<a.length;d++)if(e=a[d],isTrue(e.getAttribute("AutoAddPrimitives"))&&"Scatterplot"!=e.getAttribute("Type")&&("Map"!=e.getAttribute("Type")||"Agents"==c.value.nodeName))b=e.getAttribute("Primitives"),"undefined"==typeof b?e.setAttribute("Primitives",
c.id):(b=b.split(","),b.push(c.id),e.setAttribute("Primitives",b.join(",")))}return c}function createConnector(a,b,c,d){var e=graph.getDefaultParent(),f,g=!1;if(null==c||null==d)g=!0,f=createPrimitive("temp stock xyz","Stock",[300,300],[10,10]),null==c&&(c=f),null==d&&(d=f);b=b.toLowerCase();c=graph.insertEdge(e,null,primitiveBank[b].cloneNode(!0),c,d,b);setName(c,a);g&&removePrimitive(f);return c}function removePrimitive(a){a instanceof Array?graph.removeCells(a,!1):graph.removeCells([a],!1)}
function highlight(a){for(var b=getParent(a);b;)getCollapsed(b)&&expandFolder(b),b=getParent(b);setSelected(a);graph.scrollCellToVisible(a)}function getSelected(){return graph.getSelectionCells()}function setSelected(a){a instanceof Array?graph.setSelectionCells(a):graph.setSelectionCells([a])}function isSelected(a){var b=getSelected();return map(a,function(a){return-1<primitiveIndex(b,a)})}function getID(a){return map(a,function(a){return a.id})}
function getType(a){return map(a,function(a){return a.value.nodeName})}function getName(a){return map(a,function(a){return a.getAttribute("name")})}function setName(a,b){map(a,function(a){if(validPrimitiveName(""+b,a)){var d=new mxCellAttributeChange(a,"name",""+b);graph.getModel().execute(d);propogateGhosts(a)}})}function getUnits(a){return map(a,function(a){return a.getAttribute("Units")})}
function setUnits(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Units",""+b);graph.getModel().execute(a)})}function getConstraints(a){return map(a,function(a){return[a.getAttribute("MinConstraint"),isTrue(a.getAttribute("MinConstraintUsed")),a.getAttribute("MaxConstraint"),isTrue(a.getAttribute("MaxConstraintUsed"))]})}
function setConstraints(a,b){map(a,function(a){var d=new mxCellAttributeChange(a,"MinConstraint",b[0]);graph.getModel().execute(d);d=new mxCellAttributeChange(a,"MinConstraintUsed",b[1]);graph.getModel().execute(d);d=new mxCellAttributeChange(a,"MaxConstraint",b[2]);graph.getModel().execute(d);d=new mxCellAttributeChange(a,"MaxConstraintUsed",b[3]);graph.getModel().execute(d)})}function getNote(a){return map(a,function(a){return a.getAttribute("Note")})}
function setNote(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Note",""+b);graph.getModel().execute(a)})}
function showNote(a){return map(a,function(a){if(!(null===a.value.getAttribute("Note",null)||""==a.value.getAttribute("Note"))){var c=Ext.getCmp("note"+a.id);isUndefined(c)&&(c=new Ext.ToolTip({html:"<big>"+clean(a.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:250,draggable:!0,id:"note"+a.id,title:clean(a.value.getAttribute("name")),closeAction:"destroy"}),a=graph.view.getState(a),c.showAt([a.x+mxPanel.getEl().getLeft()+a.width+4-graph.container.scrollLeft,
a.y+mxPanel.getEl().getTop()-graph.container.scrollTop]))}})}function hideNote(a){return map(a,function(a){a=Ext.getCmp("note"+a.id);isUndefined(a)||a.destroy()})}function showEditor(a){("Converter"==a.value.nodeName?new Ext.ConverterWindow({parent:"",cell:a,oldKeys:a.getAttribute("Data"),interpolation:a.getAttribute("Interpolation")}):new Ext.EquationWindow({parent:"",cell:a,code:getValue(a)})).show()}
function getValue(a){return map(a,function(a){var c=a.value.nodeName,d;"Stock"==c?d=a.getAttribute("InitialValue"):"Flow"==c?d=a.getAttribute("FlowRate"):"Transition"==c?d=a.getAttribute("Value"):"State"==c?d=a.getAttribute("Active"):"Variable"==c?d=a.getAttribute("Equation"):"Button"==c?d=a.getAttribute("Function"):"Converter"==c?d=a.getAttribute("Data"):"Action"==c&&(d=a.getAttribute("Action"));return isDefined(d)?d:""})}
function setValue(a,b){map(a,function(a){if(getValue(a)!=b){var d=a.value.nodeName,e;"Stock"==d?e=new mxCellAttributeChange(a,"InitialValue",""+b):"Flow"==d?e=new mxCellAttributeChange(a,"FlowRate",""+b):"Transition"==d?e=new mxCellAttributeChange(a,"Value",""+b):"State"==d?e=new mxCellAttributeChange(a,"Active",""+b):"Variable"==d?e=new mxCellAttributeChange(a,"Equation",""+b):"Button"==d?e=new mxCellAttributeChange(a,"Function",""+b):"Converter"==d?e=new mxCellAttributeChange(a,"Data",""+b):"Action"==
d&&(e=new mxCellAttributeChange(a,"Action",""+b));graph.getModel().execute(e)}})}function getPosition(a){return map(a,function(a){var a=graph.view.getState(a),c=graph.view.getScale();return[a.x/c,a.y/c]})}function setPosition(a,b){map(a,function(a){var d=graph.view.getState(a),e=graph.view.getScale(),f=a.geometry,g=d.x/e-f.x,d=d.y/e-f.y,f=f.clone();f.x=b[0]-g;f.y=b[1]-d;graph.getModel().setGeometry(a,f)})}function getOpacity(a){return map(a,function(a){return graph.getCellStyle(a).opacity})}
function setOpacity(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",b),d=mxUtils.setStyle(d,mxConstants.STYLE_TEXT_OPACITY,b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getLineColor(a){return map(a,function(a){return graph.getCellStyle(a).strokeColor})}
function setLineColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"strokeColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getFontColor(a){return map(a,function(a){return graph.getCellStyle(a).fontColor})}function setFontColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"fontColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}
function getFillColor(a){return map(a,function(a){return graph.getCellStyle(a).fillColor})}function setFillColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"fillColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getImage(a){return map(a,function(a){return a.getAttribute("Image")})}function setImage(a,b){map(a,function(a){a.setAttribute("Image",b);setPicture(a)})}
function getNonNegative(a){return map(a,function(a){return"Stock"==a.value.nodeName?isTrue(a.getAttribute("NonNegative")):isTrue(a.getAttribute("OnlyPositive"))})}function setNonNegative(a,b){map(a,function(a){a="Stock"==a.value.nodeName?new mxCellAttributeChange(a,"NonNegative",b):new mxCellAttributeChange(a,"OnlyPositive",b);graph.getModel().execute(a)})}function getStockType(a){return map(a,function(a){return a.getAttribute("StockMode")})}
function setStockType(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"StockMode",b);graph.getModel().execute(a)})}function getDelay(a){return map(a,function(a){return a.getAttribute("Delay")})}function setDelay(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Delay",b);graph.getModel().execute(a)})}function getEnds(a){return map(a,function(a){return[a.getTerminal(!0),a.getTerminal(!1)]})}
function setEnds(a,b){map(a,function(a){var d=new mxTerminalChange(graph.model,a,b[0],!0);graph.getModel().execute(d);d=new mxTerminalChange(graph.model,a,b[1],!1);graph.getModel().execute(d)})}
function connected(a,b){if(a.isEdge&&(null!==a.source&&a.source.id===b.id||null!==a.target&&a.target.id===b.id)||b.isEdge&&(null!==b.source&&b.source.id===a.id||null!==b.target&&b.target.id===a.id))return!0;for(var c=findType(["Flow","Link","Transition"]),d=0;d<c.length;d++)if(null!==c[d].source&&null!==c[d].target&&(c[d].source.id===a.id&&c[d].target.id===b.id||c[d].target.id===a.id&&c[d].source.id===b.id))return!0;return!1}
function getTriggerType(a){return map(a,function(a){return a.getAttribute("Trigger")})}function setTriggerType(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Trigger",b);graph.getModel().execute(a)})}function getTriggerValue(a){return map(a,function(a){return a.getAttribute("Value")})}function setTriggerValue(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Value",b);graph.getModel().execute(a)})}function getData(a){return map(a,function(a){return a.getAttribute("Data")})}
function setData(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Data",b);graph.getModel().execute(a)})}function getConverterInput(a){return map(a,function(a){a=a.getAttribute("Source");return"Time"==a?null:findID(a)})}function setConverterInput(a,b){map(a,function(a){a=null==b?new mxCellAttributeChange(a,"Source","Time"):new mxCellAttributeChange(a,"Source",b.id);graph.getModel().execute(a)})}function getInterpolation(a){return map(a,function(a){return a.getAttribute("Interpolation")})}
function setInterpolation(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Interpolation",b);graph.getModel().execute(a)})}function pressButton(a){graph.getModel().beginUpdate();map(a,function(a){runAction(a.getAttribute("Function"),"<p>There was error with the Action for the button <i>"+a.getAttribute("name")+"</i>.</p><br/>")});graph.getModel().endUpdate()}
function runAction(a,b){try{eval('"use strict;"\n\n'+a)}catch(c){b=b||"",Ext.Msg.show({title:getText("Action Error"),msg:b+"<p><tt>"+c+"</tt></p>",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}function getPopulationSize(a){return map(a,function(a){return a.getAttribute("Size")})}function setPopulationSize(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Size",b);graph.getModel().execute(a)})}function getAgentBase(a){return map(a,function(a){return findID(a.getAttribute("Agent"))})}
function setAgentBase(a,b){map(a,function(a){connected(a,b)?(a=new mxCellAttributeChange(a,"Agent",b.id),graph.getModel().execute(a)):mxUtils.alert("Agent Population and Folder must be connected by a Link.")})}function getGeometryWrap(a){return map(a,function(a){return isTrue(a.getAttribute("GeoWrap"))})}function setGeometryWrap(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoWrap",b);graph.getModel().execute(a)})}
function getGeometryUnits(a){return map(a,function(a){return a.getAttribute("GeoDimUnits")})}function setGeometryUnits(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoDimUnits",b);graph.getModel().execute(a)})}function getGeometryWidth(a){return map(a,function(a){return a.getAttribute("GeoWidth")})}function setGeometryWidth(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoWidth",b);graph.getModel().execute(a)})}
function getGeometryHeight(a){return map(a,function(a){return a.getAttribute("GeoHeight")})}function setGeometryHeight(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoHeight",b);graph.getModel().execute(a)})}function getAgentPlacement(a){return map(a,function(a){return a.getAttribute("Placement")})}function setAgentPlacement(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Placement",b);graph.getModel().execute(a)})}
function getAgentPlacementFunction(a){return map(a,function(a){return a.getAttribute("PlacementFunction")})}function setAgentPlacementFunction(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"PlacementFunction",b);graph.getModel().execute(a)})}function getAgentNetwork(a){return map(a,function(a){return a.getAttribute("Network")})}function setAgentNetwork(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Network",b);graph.getModel().execute(a)})}
function getAgentNetworkFunction(a){return map(a,function(a){return a.getAttribute("NetworkFunction")})}function setAgentNetworkFunction(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"NetworkFunction",b);graph.getModel().execute(a)})}function collapseFolder(a){map(a,function(a){graph.foldCells(!0,!1,[a])})}function expandFolder(a){map(a,function(a){graph.foldCells(!1,!1,[a])})}function getCollapsed(a){return map(a,function(a){return a.isCollapsed()})}
function getParent(a){var b=graph.getDefaultParent().id;return map(a,function(a){a=a.getParent();return a.id==b?null:a})}function setParent(a,b){var c=null==b?graph.getDefaultParent():b;map(a,function(a){var b=getPosition(a),f=new mxChildChange(graph.getModel(),c,a);graph.getModel().execute(f);setPosition(a,b)})}function getChildren(a,b){isUndefined(b)&&(b=!0);return b?Ext.Array.flatten(map(a.children,function(a){return"Folder"==a.value.nodeName?a.children.concat([a]):a})):a.children}
function getFolderType(a){return map(a,function(a){return a.getAttribute("Type")})}function setFolderType(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Type",b);graph.getModel().execute(a)})}function excludeType(a,b){if(a instanceof Array){for(var c=[],d=0;d<a.length;d++)a[d].value.nodeName!=b&&c.push(a[d]);return c}return null==a?a:a.value.nodeName==b?null:a}function primitiveIndex(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b.id)return c;return-1}
function uniquePrimitives(a){for(var b=[],c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)if(b[e].id==a[c].id){d=!0;break}d||b.push(a[c])}return b}var globalVars={};function setGlobal(a,b){globalVars[a]=b}function getGlobal(a){return globalVars[a]}function topBarShown(){return ribbonPanel.getDockedItems()[0].isVisible()}
function toggleTopBar(){var a=ribbonPanel.getDockedItems()[0];a.isVisible()?(a.hide(),Ext.get("toolbarToggle").update("&darr;")):(a.show(),Ext.get("toolbarToggle").update("&uarr;"))}function sideBarShown(){return!configPanel.collapsed}function toggleSideBar(){sideBarShown()?configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1):configPanel.expand(!1)}function updateSideBar(){selectionChanged(!0)};function testTests(){test="Test"}var test,errorCount=0,testCount=0;function runTests(){errorCount=testCount=0;testTests();testUI();testCreate();testClearModel();testFolders();testPrimitiveGetSet();testFind();testUnitFunctions();testSimulationGetSet();testSimulation();testUnitsAndConstraints();testMacros();testRunModel();clearModel();alert("Tests complete! \n\n Errors: "+errorCount+"/"+testCount)}function testError(a){console.log(a);errorCount++}
function assertEqual(a,b,c){testCount++;console.log("- "+test+" - "+a);b!=c&&testError(" *** FAILED  ***  "+test+" "+a+". Found ("+b+") expected ("+c+")")}function assertUnequal(a,b,c){testCount++;console.log("- "+test+" - "+a);b==c&&testError(" *** FAILED ***  "+test+" "+a+". Found ("+b+") expected not ("+c+")")}function assertNull(a,b){testCount++;console.log("- "+test+" - "+a);null!==b&&testError(" *** FAILED *** "+test+" "+a+". Found ("+b+") expected null.")}
function assertNotNull(a,b){testCount++;console.log("- "+test+" - "+a);null===b&&testError(" *** FAILED *** "+test+" "+a+". Found null expected ("+b+").")}
function testRunModel(){test="RunModel";clearModel();var a=createPrimitive("Var","Variable",[100,100],[100,100]);setTimeUnits("Years");setTimeStep(1);setTimeLength(10);setValue(a,"Years()^2");var b=runModel(!0);assertEqual("Old Silent",b.value(a)[2],4);runModel({silent:!0,onSuccess:function(b){assertEqual("Silent Callback",b.value(a)[2],4)}});runModel({silent:!1,onSuccess:function(b){assertEqual("Non-Silent Callback",b.value(a)[2],4);b.window.close()}});setValue(a,"sds");b=runModel(!0);assertUnequal("Old Silent Error",
b.error,"none");runModel({silent:!0,onError:function(a){assertUnequal("Silent Callback Error",a.error,"none")}});runModel({silent:!1,onError:function(a){assertUnequal("Non-Silent Callback Error",a.error,"none")}});clearModel()}function testBothAgents(){setAlgorithm("RK1");console.log("---RK1---");testAgents();setAlgorithm("RK4");console.log("---RK4---");testAgents()}
function testAgents(){var a=test;test="Agents";getAlgorithm();clearModel();var b=createPrimitive("My State","State",[100,100],[100,100]),c=createPrimitive("My State 2","State",[100,100],[100,100]);setValue(b,"false || true");setValue(c,"false || 0");var d=runModel(!0);assertEqual("State Start 1",d.value(b)[0],1);assertEqual("State Start 2",d.value(c)[0],0);assertEqual("State Start 3",d.value(b)[10],1);assertEqual("State Start 4",d.value(c)[10],0);setValue(b,"true");setValue(c,"false");var e=createPrimitive("Action",
"Action",[100,100],[100,100]);setValue(e,"[My State] <- false");setTriggerType(e,"Timeout");setTriggerValue(e,5);var f=createPrimitive("Action","Action",[100,100],[100,100]);setTriggerType(f,"Timeout");setTriggerValue(f,100);setValue(f,"[My State 2] <- true");var g=createConnector("Link","Link",e,b),h=createConnector("Link","Link",f,c),d=runModel(!0);assertEqual("State Start 5",d.value(b)[0],1);assertEqual("State Start 6",d.value(c)[0],0);assertEqual("State Start 7",d.value(b)[10],0);assertEqual("State Start 8",
d.value(c)[10],0);removePrimitive(e);removePrimitive(f);removePrimitive(g);removePrimitive(h);setValue(b,"false || true");setValue(c,"false || 0");var k=createConnector("My Transition","Transition",null,c),l=createConnector("My Transition","Transition",c,null);setTriggerType(k,"Timeout");setTriggerValue(k,"{2 years}");setTriggerType(l,"Timeout");setTriggerValue(l,"{3 years}");d=runModel(!0);assertEqual("Transition T Dangle 1",d.value(b)[0],1);assertEqual("Transition T Dangle 2",d.value(c)[0],0);assertEqual("Transition T Dangle 3",
d.value(b)[3],1);assertEqual("Transition T Dangle 4",d.value(c)[3],1);assertEqual("Transition T Dangle 5",d.value(c)[8],0);removePrimitive(k);removePrimitive(l);k=createConnector("My Transition","Transition",b,c);l=createConnector("My Transition","Transition",c,b);setTriggerType(k,"Timeout");setTriggerValue(k,"{2 years}");setTriggerType(l,"Timeout");setTriggerValue(l,"{3 years}");d=runModel(!0);assertEqual("Transition T 1",d.value(b)[0],1);assertEqual("Transition T 2",d.value(c)[0],0);assertEqual("Transition T 3",
d.value(b)[3],0);assertEqual("Transition T 4",d.value(c)[3],1);assertEqual("Transition T 5",d.value(b)[6],1);assertEqual("Transition T 6",d.value(c)[6],0);assertEqual("State Transition Val 1",d.value(k)[0],2);assertEqual("State Transition Val 2",d.value(l)[3],3);setTriggerValue(k,"2");setTriggerValue(l,"3");d=runModel(!0);assertEqual("Transition T 1.2",d.value(b)[0],1);assertEqual("Transition T 2.2",d.value(c)[0],0);assertEqual("Transition T 3.2",d.value(b)[3],0);assertEqual("Transition T 4.2",d.value(c)[3],
1);assertEqual("Transition T 5.2",d.value(b)[6],1);assertEqual("Transition T 6.2",d.value(c)[6],0);assertEqual("State Transition Val 1.2",d.value(k)[0],2);assertEqual("State Transition Val 2.2",d.value(l)[3],3);setTriggerType(k,"Probability");setTriggerValue(k,"1");setTriggerType(l,"Timeout");setTriggerValue(l,"{100 years}");d=runModel(!0);assertEqual("Transition P 1",d.value(b)[0],1);assertEqual("Transition P 2",d.value(c)[0],0);assertEqual("Transition P 3",d.value(b)[2],0);assertEqual("Transition P 4",
d.value(c)[2],1);assertEqual("Transition P 5",d.value(b)[10],0);assertEqual("Transition P 6",d.value(c)[10],1);setTriggerValue(k,"100");d=runModel(!0);assertEqual("Transition P 1.2",d.value(b)[0],1);assertEqual("Transition P 2.2",d.value(c)[0],0);assertEqual("Transition P 3.2",d.value(b)[2],0);assertEqual("Transition P 4.2",d.value(c)[2],1);assertEqual("Transition P 5.2",d.value(b)[10],0);assertEqual("Transition P 6.2",d.value(c)[10],1);setTriggerValue(k,"-2");d=runModel(!0);assertEqual("Transition P 1.3",
d.value(b)[0],1);assertEqual("Transition P 2.3",d.value(c)[0],0);assertEqual("Transition P 3.2",d.value(b)[2],1);assertEqual("Transition P 4.2",d.value(c)[2],0);setTriggerType(k,"Condition");setTriggerValue(k,"years=5");setTriggerType(l,"Condition");setTriggerValue(l,"years=7");d=runModel(!0);assertEqual("Transition C 1",d.value(b)[0],1);assertEqual("Transition C 2",d.value(c)[0],0);assertEqual("Transition C 3",d.value(b)[6],0);assertEqual("Transition C 4",d.value(c)[6],1);assertEqual("Transition C 5",
d.value(b)[7],0);assertEqual("Transition C 6",d.value(c)[7],1);assertEqual("Transition C 7",d.value(b)[8],1);assertEqual("Transition C 8",d.value(c)[8],0);clearModel();b=createPrimitive("State","State",[100,100],[100,100]);c=createPrimitive("Variable","State",[300,100],[100,100]);createConnector("My Link","Link",b,c);setValue(b,"true");setValue(c,"ifThenElse([State], 1, 0)");d=runModel(!0);assertEqual("State Values 1",d.value(b)[0],1);assertEqual("State Values 2",d.value(c)[0],1);setValue(b,"false");
d=runModel(!0);assertEqual("State Values 3",d.value(b)[0],0);assertEqual("State Values 4",d.value(c)[0],0);setValue(c,"if [State] then\n 1\nelse\n 0\nend if");d=runModel(!0);assertEqual("State Values 5",d.value(b)[0],0);assertEqual("State Values 6",d.value(c)[0],0);setValue(b,"true");d=runModel(!0);assertEqual("State Values 7",d.value(b)[5],1);assertEqual("State Values 8",d.value(c)[5],1);clearModel();b=createPrimitive("State 1","State",[100,100],[100,100]);c=createPrimitive("State 2","State",[100,
100],[100,100]);g=createConnector("My Link","Link",b,c);k=createConnector("My Transition","Transition",b,c);l=createConnector("My Transition","Transition",c,b);setTriggerType(k,"Timeout");setTriggerValue(k,"{2 years}");setTriggerType(l,"Condition");setTriggerValue(l,"false");setValue(b,"1");setValue(c,"! [State 1]");f=createPrimitive("My Agent","Folder",[200,150],[400,400]);setParent([b,c,g,k,l],f);setFolderType(f,"Agent");var n=createPrimitive("Population","Agents",[1210,0],[200,200]);createConnector("Link",
"Link",f,n);setAgentBase(n,f);setPopulationSize(n,10);var c=createPrimitive("My Variable","Variable",[1200,150],[150,100]),o=createPrimitive("My Variable 2","Variable",[1200,150],[150,100]);setValue(c,"Count(FindAll([Population]))");setValue(o,"PopulationSize([Population])+1");createConnector("My Link","Link",n,c);createConnector("My Link","Link",n,o);d=runModel(!0);assertEqual("Pop 1",d.value(c)[0],10);assertEqual("Pop 2",d.value(c)[8],10);assertEqual("Pop 2.1",d.value(o)[0],11);assertEqual("Pop 2.2",
d.value(o)[8],11);setValue(c,"Count(FindState([Population], [State 1]))");setValue(o,"Count(FindState([Population], [State 2]))");d=runModel(!0);assertEqual("Pop 3",d.value(c)[0],10);assertEqual("Pop 4",d.value(o)[0],0);assertEqual("Pop 5",d.value(c)[8],0);assertEqual("Pop 6",d.value(o)[8],10);var p=createPrimitive("My Variable 3","Variable",[1200,150],[150,100]);createConnector("My Link","Link",n,p);createConnector("My Link","Link",p,o);setValue(p,"FindState([Population], [State 2])");setValue(o,
"Count([My Variable 3])");d=runModel(!0);assertEqual("Pop 6.1",d.value(c)[0],10);assertEqual("Pop 6.2",d.value(o)[0],0);assertEqual("Pop 6.3",d.value(c)[8],0);assertEqual("Pop 6.4",d.value(o)[8],10);assertEqual("Pop 6.5",d.error,"none");setValue(c,"Count(FindNotState([Population], [State 1]))");setValue(o,"Count(FindNotState([Population], [State 2]))");d=runModel(!0);assertEqual("Pop 6.6",d.error,"none");setValue(p,"FindState([Population], [State 2])+1");d=runModel(!0);assertUnequal("Pop 6.7",d.error,
"none");setValue(p,"[Population]+1");d=runModel(!0);assertUnequal("Pop 6.8",d.error,"none");removePrimitive(p);setTriggerType(l,"Timeout");setTriggerValue(l,"5");setTriggerType(l,"Condition");setTriggerValue(l,"index([self])=1 and years=7");d=runModel(!0);assertEqual("Pop 7",d.value(c)[0],0);assertEqual("Pop 8",d.value(o)[0],10);assertEqual("Pop 9",d.value(c)[8],9);assertEqual("Pop 10",d.value(o)[8],1);p=createPrimitive("Var","Variable",[200,150],[150,100]);setParent(p,f);setValue(c,"Min(Value([Population], [Var]))");
setValue(o,"Max(Value([Population], [Var]))");d=createPrimitive("Outside Var","Variable",[200,150],[150,100]);setParent(d,f);setValue(d,"IfThenElse(years<5, 1, 0)");createConnector("Link","Link",d,p);setValue(p,"[Outside Var]*2");d=runModel(!0);assertEqual("Pop 10.1",d.value(c)[0],2);assertEqual("Pop 10.2",d.value(c)[8],0);setMacros("counter <- 0");e=createPrimitive("Action","Action",[200,150],[150,100]);setTriggerType(e,"Condition");setTriggerValue(e,"true");setValue(e,"Counter <- counter + 1");
setValue(p,"counter*3");d=runModel(!0);assertEqual("Pop 10.3",d.value(c)[0],0);assertEqual("Pop 10.4",d.value(c)[8],24);setTriggerValue(e,"false");d=runModel(!0);assertEqual("Pop 10.5",d.value(c)[0],0);assertEqual("Pop 10.6",d.value(c)[8],0);setTriggerType(e,"Probability");setTriggerValue(e,"1.1");d=runModel(!0);assertEqual("Pop 10.7",d.value(c)[0],0);assertEqual("Pop 10.8",d.value(c)[8],24);setTriggerValue(e,"-.4");d=runModel(!0);assertEqual("Pop 10.9",d.value(c)[0],0);assertEqual("Pop 10.10",d.value(c)[8],
0);setTriggerType(e,"Timeout");setTriggerValue(e,"100");d=runModel(!0);assertEqual("Pop 10.11",d.value(c)[0],0);assertEqual("Pop 10.12",d.value(c)[8],0);setTriggerValue(e,"{100 years}");d=runModel(!0);assertEqual("Pop 10.13",d.value(c)[0],0);assertEqual("Pop 10.14",d.value(c)[8],0);setTriggerValue(e,"0");setValue(e,"counter <- counter+1\\nresetTimer([Self])");d=runModel(!0);assertEqual("Pop 10.15",d.value(c)[0],0);assertEqual("Pop 10.16",d.value(c)[8],24);var r=createPrimitive("Count","Stock",[200,
150],[150,100]);setParent([e,r],f);setValue(r,10);setValue(e,"[Count] <- [Count] + 2");g=createConnector("Link","Link",r,p);h=createConnector("Link","Link",r,e);setValue(p,"[Count]");d=runModel(!0);assertEqual("Pop 10.17",d.value(c)[0],10);assertEqual("Pop 10.18",d.value(c)[8],26);removePrimitive(e);removePrimitive(r);removePrimitive(g);removePrimitive(h);setValue(p,"index([self])");d=runModel(!0);assertEqual("Pop 11",d.value(c)[0],1);assertEqual("Pop 12",d.value(o)[8],10);setValue(c,"PopulationSize([Population])");
setValue(o,"Count(Value([Population], [Var]))");d=runModel(!0);assertEqual("Pop 12.1",d.value(c)[0],d.value(o)[0]);assertEqual("Pop 12.2",d.value(c)[8],d.value(o)[8]);setValue(c,"Count(Join(FindState([Population], [State 1]), FindState([Population], [State 2])))");setValue(o,"Min(Value(Join(FindState([Population], [State 1]), FindState([Population], [State 2])), [Var]))");d=runModel(!0);assertEqual("Pop 13",d.value(c)[0],10);assertEqual("Pop 14",d.value(o)[8],1);setValue(c,"Count(Join(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)))");
setValue(o,"Count(Union(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)))");d=runModel(!0);assertEqual("Pop 14.1",d.value(c)[0],5);assertEqual("Pop 14.2",d.value(o)[8],5);setValue(c,"Count(Intersection(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var])<=3)))");setValue(o,"Count(Difference(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var])<=3)))");d=runModel(!0);
assertEqual("Pop 14.3",d.value(c)[0],0);assertEqual("Pop 14.4",d.value(o)[8],5);setValue(c,"Distance(FindNearest([Population], FindIndex([population], 1)), FindIndex([population], 1)) = Min(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");setValue(o,"Distance(FindFurthest([Population], FindIndex([population], 1)), FindIndex([population], 1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");
d=runModel(!0);assertEqual("Pop 14.5",d.value(c)[0],1);assertEqual("Pop 14.6",d.value(o)[8],1);setValue(c,"Distance(select(FindNearest([Population], FindIndex([population], 1),2),2), FindIndex([population], 1)) = Min(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");setValue(o,"Distance(select(FindFurthest([Population], FindIndex([population], 1),3),2), FindIndex([population], 1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");
d=runModel(!0);assertEqual("Pop 14.5.2",d.value(c)[0],0);assertEqual("Pop 14.6.2",d.value(o)[8],0);setValue(c,"Count(FindNearby([Population], FindIndex([Population], 1), 400))");setValue(o,"Count(FindNearby([Population], FindIndex([Population], 1), 0))");d=runModel(!0);assertEqual("Pop 14.7",d.value(c)[0],9);assertEqual("Pop 14.8",d.value(o)[8],0);setValue(c,"width([Population])");setValue(o,"height([Population])");d=runModel(!0);assertEqual("Pop 14.9",d.value(c)[0],200);assertEqual("Pop 14.10",d.value(o)[8],
100);setAgentPlacement(n,"Grid");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(o,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Grid Loc 15",d.value(c)[0],0);assertEqual("Grid Loc 16",d.value(o)[8],1);setAgentPlacement(n,"Ellipse");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");
setValue(o,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Grid Loc 16.1",d.value(c)[0],0);assertEqual("Grid Loc 16.2",d.value(o)[8],0);setAgentPlacement(n,"Network");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(o,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");
d=runModel(!0);assertEqual("Network Loc 17",d.value(c)[0],0);assertEqual("Network Loc 18",d.value(o)[8],0);setAgentPlacement(n,"Custom Function");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(o,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Custom Loc 19",d.value(c)[0],0);assertEqual("Custom Loc 20",d.value(o)[8],
0);setAgentPlacementFunction(n,"<<index([Self])*10,index([Self])*20>>");setValue(c,"Select(Location(FindIndex([Population], 1)),1)");setValue(o,"Select(Location(FindIndex([Population], 2)),2)");d=runModel(!0);assertEqual("Custom Loc 21",d.value(c)[0],10);assertEqual("Custom Loc 22",d.value(o)[8],40);e=createPrimitive("Mover","Action",[200,150],[150,100]);setParent(e,f);setTriggerType(e,"Condition");setTriggerValue(e,"true");setValue(e,"move([Self], <<10,20>>)");d=runModel(!0);assertEqual("Custom Move 22",
d.value(c)[2],30);assertEqual("Custom Move 23",d.value(o)[9],220);setGeometryWrap(n,!0);d=runModel(!0);assertEqual("Custom Move 24",d.value(c)[2],30);assertEqual("Custom Move 25",d.value(o)[9],20);createConnector("Link","Link",n,e);setAgentPlacementFunction(n,"<<index([Self])*10, 1>>");setValue(e,"moveTowards([Self], findIndex([Population], 1), 1)");setValue(o,"Select(Location(FindIndex([Population], 2)),1)");d=runModel(!0);assertEqual("Custom Move 26",d.value(c)[2],10);assertEqual("Custom Move 27",
d.value(c)[9],10);assertEqual("Custom Move 27.1",d.value(o)[2],18);assertEqual("Custom Move 27.2",d.value(o)[9],11);setValue(e,"1");setAgentNetwork(n,"Custom Function");setAgentNetworkFunction(n,"ifThenElse(index(a)=1 || index(b)=1, true, false)");setValue(c,"count(connected(findIndex([Population], 1)))");setValue(o,"count(connected(findIndex([Population], 3)))");d=runModel(!0);assertEqual("Custom Network 28",d.value(c)[0],9);assertEqual("Custom Network 29",d.value(o)[8],1);setValue(e,"ifthenelse( index([self])==3, unconnect([self], findIndex([population], 1)), 0)");
d=runModel(!0);assertEqual("Custom Network 30",d.value(c)[0],9);assertEqual("Custom Network 31",d.value(o)[0],1);assertEqual("Custom Network 32",d.value(c)[8],8);assertEqual("Custom Network 33",d.value(o)[8],0);setValue(e,"ifthenelse(index([self])==3, connect([self], findIndex([population], 2)),0)");d=runModel(!0);assertEqual("Custom Network 34",d.value(c)[0],9);assertEqual("Custom Network 35",d.value(o)[0],1);assertEqual("Custom Network 36",d.value(c)[8],9);assertEqual("Custom Network 37",d.value(o)[8],
2);setTriggerType(e,"Condition");setTriggerValue(e,"((index([self])==3 && years==2) || (index([self])==5 && years==5))");setValue(e,"remove([self])");setValue(c,"populationSize([Population])");setValue(o,"count(connected(findIndex([Population], 1)))");d=runModel(!0);assertEqual("Add/Remove 1",d.value(c)[0],10);assertEqual("Add/Remove 2",d.value(c)[4],9);assertEqual("Add/Remove 3",d.value(c)[8],8);setTriggerValue(e,"((index([self])==3 && years==2) || (index([self])==5 && years==5))");setValue(e,"add([Population])");
setValue(c,"populationSize([Population])");setValue(o,"count(connected(findIndex([Population], 3)))");d=runModel(!0);assertEqual("Add/Remove 5",d.value(c)[0],10);assertEqual("Add/Remove 6",d.value(c)[4],11);assertEqual("Add/Remove 7",d.value(c)[8],12);setTriggerValue(e,"((index([self])==3 && years==2) || (index([self])==5 && years==5))");setValue(e,"add([Population], [Self])");setValue(c,"populationSize([Population])");d=runModel(!0);assertEqual("Add/Remove 8",d.value(c)[0],10);assertEqual("Add/Remove 9",
d.value(c)[4],11);assertEqual("Add/Remove 10",d.value(c)[8],12);setAgentPlacement(n,"Random");setPopulationSize(n,1);setTriggerValue(e,"years == 5 ");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(o,"IfThenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 11",d.value(c)[0],1);assertEqual("Add/Remove 12",d.value(c)[8],2);assertEqual("Add/Remove 13",
d.value(o)[0],-1);assertEqual("Add/Remove 14",d.value(o)[7],0);setPopulationSize(n,1);setValue(e,"add([Population], [Self])");setValue(c,"populationSize([Population])");setValue(o,"ifthenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 15",d.value(c)[0],1);assertEqual("Add/Remove 16",d.value(c)[8],2);assertEqual("Add/Remove 17",d.value(o)[0],-1);assertEqual("Add/Remove 18",
d.value(o)[7],1);setPopulationSize(n,0);setParent(e);setTriggerValue(e,"years == 5 or years==3");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(o,"IfThenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 19",d.value(c)[0],0);assertEqual("Add/Remove 20",d.value(c)[8],2);assertEqual("Add/Remove 21",d.value(o)[0],-1);assertEqual("Add/Remove 22",
d.value(o)[7],0);setPopulationSize(n,2);removePrimitive(k);removePrimitive(l);setParent(e);setValue(b,"false");setTriggerValue(e,"years == 5 ");setValue(e,"SetValue([Population], [State 1], true)");setValue(c,"select(value([Population], [State 1]), 1)");setValue(o,"select(value([Population],[State 1]), 2)");d=runModel(!0);assertEqual("SetValue 1",d.value(c)[3],0);assertEqual("SetValue 2",d.value(c)[8],1);assertEqual("SetValue 3",d.value(o)[3],0);assertEqual("SetValue 4",d.value(o)[8],1);clearModel();
c=createPrimitive("Var","Variable",[350,350],[200,200]);o=createPrimitive("Var2","Variable",[0,300],[200,100]);f=createPrimitive("Agent","Folder",[300,300],[300,300]);setFolderType(f,"Agent");setParent(c,f);b=createPrimitive("Population","Agents",[0,0],[200,100]);d=createPrimitive("Action","Action",[300,0],[200,100]);createConnector("Link","Link",f,b);createConnector("Link","Link",b,c);createConnector("Link","Link",b,o);createConnector("Link","Link",b,d);setAgentBase(b,f);setPopulationSize(b,5);setValue(c,
"PopulationSize([Population])");setTriggerType(d,"Condition");setTriggerValue(d,"years=5");setValue(d,"repeat(add([Population]),10)");setValue(o,"Count(unique(Value([Population],[Var])))");d=runModel(!0);assertEqual("Additional Add 1",d.value(o)[0],1);assertEqual("Additional Add 2",d.value(o)[5],1);assertEqual("Additional Add 3",d.value(o)[6],1);assertEqual("Additional Add 4",d.value(o)[7],1);setValue(o,"max(Value([Population],[Var]))");d=runModel(!0);assertEqual("Additional Add 5",d.value(o)[0],
5);assertEqual("Additional Add 6",d.value(o)[5],5);assertEqual("Additional Add 7",d.value(o)[6],15);assertEqual("Additional Add 8",d.value(o)[7],15);clearModel();test=a}function testUI(){test="UI";var a=topBarShown();toggleTopBar();assertEqual("Top bar 1",topBarShown(),!a);toggleTopBar();assertEqual("Top bar 2",topBarShown(),a);a=sideBarShown();toggleSideBar();assertEqual("Side bar 1",sideBarShown(),!a);toggleSideBar();assertEqual("Side bar 2",sideBarShown(),a)}
function testMacros(){test="Macros";clearModel();setMacros("a <- 52\nf(x)<-x^2");assertEqual("Get Macros",getMacros(),"a <- 52\nf(x)<-x^2");var a=createPrimitive("p1","Variable",[200,0],[100,100]),b=createPrimitive("p2","Variable",[0,0],[100,100]);setValue(a,"a");setValue(b,"f(2)");var c=runModel(!0);assertEqual("Constant",c.value(a)[3],52);assertEqual("Function",c.value(b)[3],4)}
function testUnitFunctions(){test="Units Functions";clearModel();var a=createPrimitive("p1","Variable",[200,0],[100,100]),b=createPrimitive("p2","Variable",[0,0],[100,100]),c=createPrimitive("p3","Variable",[0,0],[100,100]),d=createPrimitive("p4","Variable",[0,0],[100,100]),e=createPrimitive("p5","Variable",[0,0],[100,100]),f=createPrimitive("p6","Variable",[0,0],[100,100]),g=createPrimitive("p7","Variable",[0,0],[100,100]);setValue(a,"Years");setValue(b,"Months");setValue(c,"Weeks");setValue(d,"Days");
setValue(e,"Hours");setValue(f,"Minutes");setValue(g,"Seconds");var h=runModel(!0);assertEqual("Y",h.value(a)[3],3);assertEqual("Mo",h.value(b)[3],36);assertEqual("W",Math.floor(h.value(c)[3]),156);assertEqual("D",h.value(d)[3],1095);assertEqual("H",h.value(e)[3],26280);assertEqual("Mi",h.value(f)[3],1576800);assertEqual("S",h.value(g)[3],94608E3);setValue(a,"Years(time*2)");setValue(b,"Months(time*2)");setValue(c,"Weeks(time*2)");setValue(d,"Days(time*2)");setValue(e,"Hours(time*2)");setValue(f,
"Minutes(time*2)");setValue(g,"Seconds(time*2)");h=runModel(!0);assertEqual("Y",h.value(a)[3],6);assertEqual("Mo",h.value(b)[3],72);assertEqual("W",Math.floor(h.value(c)[3]),312);assertEqual("D",h.value(d)[3],2190);assertEqual("H",h.value(e)[3],52560);assertEqual("Mi",h.value(f)[3],3153600);assertEqual("S",h.value(g)[3],189216E3);setValue(a,"unitless(TimeStart)");setValue(b,"unitless(TimeLength)");setValue(c,"unitless(TimeStep)");setValue(d,"unitless(TimeEnd)");h=runModel(!0);assertEqual("Time Start",
h.value(a)[3],getTimeStart());assertEqual("Time Length",h.value(b)[3],getTimeLength());assertEqual("Time Step",h.value(c)[3],getTimeStep());assertEqual("Time End",h.value(d)[3],getTimeStart()+getTimeLength())}
function testUnitsAndConstraints(){test="Units and Constraints";clearModel();var a=createPrimitive("tester","Variable",[0,0],[100,10]);setValue(a,"time");setUnits(a,"Seconds");assertEqual("No error",runModel(!0).error,"none");setUnits(a,"Qubits");assertUnequal("Units Error",runModel(!0).error,"none");setUnits(a,"Minutes");assertEqual("No error Units",runModel(!0).error,"none");setConstraints(a,[10,!0,5,!1]);assertUnequal("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!1]);
assertEqual("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!0]);assertUnequal("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!1]);assertEqual("Constraints Error",runModel(!0).error,"none")}
function testPrimitiveGetSet(){test="Primitive Get Set";setupComplexDummy();var a=findName("x");setName(a,"xyz");assertEqual("Name",getName(a),"xyz");setNote(a,"abc");assertEqual("Note",getNote(a),"abc");setValue(a,"123");assertEqual("SetValue",getValue(a),"123");setValue(findName("My Flow"),"098");assertEqual("SetValue",getValue(findName("My Flow")),"098");setUnits(findName("My Flow"),"Qubits");assertEqual("SetUnits",getUnits(findName("My Flow")),"Qubits");setFillColor(a,"green");assertEqual("Fill Color",
getFillColor(a),"green");setFontColor(a,"red");assertEqual("Font Color",getFontColor(a),"red");setLineColor(a,"yellow");assertEqual("Line Color",getLineColor(a),"yellow");setOpacity(a,50);assertEqual("Opacity",getOpacity(a),50);setImage(a,"http://testimage.com/image.png");assertEqual("Image",getImage(a),"http://testimage.com/image.png");a=findName("My Flow");setConstraints(a,[-10,!0,10,!1]);assertEqual("SetConstraints",getConstraints(a)[0],-10);assertEqual("SetConstraints",getConstraints(a)[1],!0);
assertEqual("SetConstraints",getConstraints(a)[2],10);assertEqual("SetConstraints",getConstraints(a)[3],!1);setConstraints(findName("My Flow"),[-10,!1,10,!0]);assertEqual("SetConstraints",getConstraints(a)[1],!1);assertEqual("SetConstraints",getConstraints(a)[3],!0);setNonNegative(a,!0);assertEqual("Set NonNegative Flow",getNonNegative(a),!0);setNonNegative(a,!1);assertEqual("Set NonNegative Flow",getNonNegative(a),!1);a=findName("My Stock");setNonNegative(a,!0);assertEqual("Set NonNegative Stock",
getNonNegative(a),!0);setNonNegative(a,!1);assertEqual("Set NonNegative Stock",getNonNegative(a),!1);setDelay(a,5);assertEqual("Set Delay",getDelay(a),5);setStockType(a,"Conveyor");assertEqual("Set Type",getStockType(a),"Conveyor");setStockType(a,"Store");assertEqual("Set Type",getStockType(a),"Store");var b=findName("My Converter");setData(b,"fdsgsdg");assertEqual("Set Data",getData(b),"fdsgsdg");setConverterInput(b,a);assertEqual("Set Source",getConverterInput(b).id,a.id);setConverterInput(b,null);
assertNull("Set Source 2",getConverterInput(b));setInterpolation(b,"fdsf");assertEqual("Set Interpolation",getInterpolation(b),"fdsf");a=createPrimitive("My State","State",[100,60],[100,100]);setValue(a,"abc");assertEqual("State Set Value",getValue(a),"abc");a=createConnector("My Transition","Transition",a,null);setValue(a,"abc1");assertEqual("Transition Set Value",getValue(a),"abc1");setTriggerValue(a,"abc12");assertEqual("Transition Set Value 2",getTriggerValue(a),"abc12");assertEqual("Transition Get Trigger 1",
getTriggerType(a),"Timeout");setTriggerType(a,"Condition");assertEqual("Transition Get Trigger 2",getTriggerType(a),"Condition");a=createPrimitive("My Action","Action",[100,60],[100,100]);setValue(a,"abc1");assertEqual("Action Set Value",getValue(a),"abc1");setTriggerValue(a,"abc123");assertEqual("Action Set Value 2",getTriggerValue(a),"abc123");assertEqual("Action Set Value 3",getValue(a),"abc1");assertEqual("Action Get Trigger 1",getTriggerType(a),"Condition");setTriggerType(a,"Timeout");assertEqual("Action Get Trigger 2",
getTriggerType(a),"Timeout");b=createPrimitive("My Agents","Agents",[300,300],[200,100]);setPopulationSize(b,123);assertEqual("Agents Size",getPopulationSize(b),123);setGeometryUnits(b,"foo bar");assertEqual("Agents Units",getGeometryUnits(b),"foo bar");setGeometryHeight(b,"foo bar 1");assertEqual("Agents Height",getGeometryHeight(b),"foo bar 1");setGeometryWidth(b,"foo bar 2");assertEqual("Agents Width",getGeometryWidth(b),"foo bar 2");setAgentPlacement(b,"foo bar 3");assertEqual("Agents Placement",
getAgentPlacement(b),"foo bar 3");setAgentPlacementFunction(b,"foo bar 4");assertEqual("Agents Placement Function",getAgentPlacementFunction(b),"foo bar 4");setAgentNetwork(b,"foo bar 5");assertEqual("Agents Network",getAgentNetwork(b),"foo bar 5");setAgentNetworkFunction(b,"foo bar 6");assertEqual("Agents Network Function",getAgentNetworkFunction(b),"foo bar 6");setGeometryWrap(b,!0);assertEqual("Agents Wrap 1",getGeometryWrap(b),!0);setGeometryWrap(b,!1);assertEqual("Agents Wrap 2",getGeometryWrap(b),
!1);a=createPrimitive("f","Folder",[200,150],[150,100]);createConnector("Link","Link",a,b);setAgentBase(b,a);assertEqual("Agents Base",getAgentBase(b).id,a.id)}
function testSimulationGetSet(){test="Simulation Get Set";setAlgorithm("x");assertEqual("Algorithm",getAlgorithm(),"x");setTimeStep(72);assertEqual("Time Step",getTimeStep(),72);setTimeLength(43);assertEqual("Time Length",getTimeLength(),43);setTimeStart(32);assertEqual("Time Start",getTimeStart(),32);setTimeUnits("foo");assertEqual("Time Units",getTimeUnits(),"foo")}
function testSimulation(){test="Simulation Test";setTimeUnits("Years");setTimeStep(1);setTimeStart(0);setTimeLength(10);for(var a=["RK1","RK4"],b=0;b<a.length;b++){console.log("--- Using Algorithm: "+a[b]);setAlgorithm(a[b]);setTimeLength(10);clearModel();var c=createPrimitive("My Stock","Stock",[10,10],[140,50]),d=createConnector("My Flow","Flow",c,null);setValue(c,"100");setValue(d,"0.1*[Alpha]");var e=runModel(!0);assertEqual("Length",e.Time.length,11);assertEqual("Time Start",e.Time[0],0);assertEqual("Time End",
e.Time[10],10);assertEqual("Stock Start",e.value(c)[0],100);assertEqual("Flow Start",Math.round(1E3*e.value(d)[0]),1E4);clearModel();setTimeLength(100);clearModel();var f=createPrimitive("Y","Stock",[10,10],[140,50]),c=createConnector("My Flow","Flow",null,f);setValue(f,"100");setValue(c,"0.04*[Y]");e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica ExpGrow",Math.round(1E5*e.value(f)[100]),Math.round(5.05049481843E8)):"RK4"==a[b]&&assertEqual("Mathematica ExpGrow",Math.round(1E5*e.value(f)[100]),
Math.round(5.45981455268E8));setValue(c,"0.02*[Y]*(1-[Y]/100)*Sin(Years/3)^2");setValue(f,2);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LogGrow",Math.round(1E5*e.value(f)[100]),Math.round(522332.33648999996)):"RK4"==a[b]&&assertEqual("Mathematica LogGrow",Math.round(1E5*e.value(f)[100]),Math.round(530387.612074));setValue(c,"0.02*[Y]*(1-[Y]/100)*Sin({Years/3 Radians})^2");setValue(f,2);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LogGrow 2",Math.round(1E5*e.value(f)[100]),Math.round(522332.33648999996)):
"RK4"==a[b]&&assertEqual("Mathematica LogGrow 2",Math.round(1E5*e.value(f)[100]),Math.round(530387.612074));var e=createPrimitive("X","Stock",[10,10],[140,50]),d=createConnector("My Flow","Flow",null,e),g=createConnector("My Flow","Flow",e,null),h=createConnector("My Flow","Flow",f,null);createConnector("Link","Link",e,c);createConnector("Link","Link",f,g);setValue(c,"[Y]*0.001*[X]");setValue(h,"[Y]*0.1");setValue(d,"[X]*0.1");setValue(g,"[X]*0.0001*[Y]");setValue(e,200);setValue(f,100);e=runModel(!0);
"RK1"==a[b]?assertEqual("Mathematica LV",Math.round(1E5*e.value(f)[100]),Math.round(1525172.07902)):"RK4"==a[b]&&assertEqual("Mathematica LV",Math.round(1E5*e.value(f)[100]),Math.round(4.1183764750399995E8));setTimeLength(10);clearModel();f=createPrimitive("p","Variable",[0,0],[100,100]);setValue(f,"years");e=runModel(!0);assertEqual("Generic Units 1",e.value(f)[4],4);setValue(f,"months");e=runModel(!0);assertEqual("Generic Units 2",e.value(f)[4],48);clearModel();setTimeLength(100);"RK1"==a[b]&&(f=
createPrimitive("My Variable","Variable",[100,100],[140,50]),d=createConnector("My Flow","Flow",null,null),createConnector("link","Link",d,f),setUnits(d,"euros/seconds"),setUnits(f,"euros"),setValue(d,"years*{1 euros/seconds}"),setValue(f,"[My Flow]*{1 seconds}"),e=runModel(!0),assertEqual("More Flow Scaling 1",e.value(f)[20],20),setUnits(d,"euros/years"),e=runModel(!0),assertEqual("More Flow Scaling 2",e.value(f)[20],20),setUnits(d,"euros per years"),e=runModel(!0),assertEqual("More Flow Scaling 2",
e.value(f)[20],20),setValue(d,"years"),setUnits(f,"euros/years"),setValue(f,"[My Flow]"),e=runModel(!0),assertEqual("More Flow Scaling 3",e.value(f)[20],20),clearModel(),f=createPrimitive("My Variable","Variable",[100,100],[140,50]),d=createConnector("My Flow","Flow",null,null),createConnector("link","Link",d,f),setUnits(d,"unitless"),setUnits(f,"unitless"),setNonNegative(d,!1),setValue(d,"10-years"),setValue(f,"[My Flow]"),e=runModel(!0),assertEqual("PositiveOnly with Units",e.value(f)[20],-10),
clearModel());testAgents();clearModel();f=createPrimitive("My Variable","Variable",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,null);createConnector("link","Link",d,f);setUnits(d,"euros/seconds");setUnits(f,"euros/seconds");setValue(d,"10-years");setValue(f,"[My Flow]");e=runModel(!0);assertEqual("PositiveOnly with Units",e.value(f)[20],0);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);setUnits(d,"euros/year");setUnits(c,
"euros");setValue(d,"10");setValue(c,"1");e=runModel(!0);assertEqual("Unit Flows 1",e.value(c)[10],101);setValue(d,"{10 Euros/years}");setValue(c,"{1 Euros}");e=runModel(!0);assertEqual("Unit Flows 2",e.value(c)[10],101);clearModel();f=createPrimitive("My Variable","Variable",[100,100],[140,50]);setValue(f,"Fix(years+12)");e=runModel(!0);assertEqual("Fix 1",e.value(f)[15],12);setValue(f,"Fix(years+12, 5)");e=runModel(!0);assertEqual("Fix 2",e.value(f)[14],22);setValue(f,"Fix(years+13, {5 years})");
e=runModel(!0);assertEqual("Fix 3",e.value(f)[14],23);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);f=createPrimitive("My Variable","Variable",[100,100],[140,50]);createConnector("My Link","Link",c,f);setValue(d,"1");setValue(c,"0");setStockType(c,"Conveyor");setDelay(c,5);setValue(f,"[[My Stock]]");e=runModel(!0);assertEqual("SS 1",e.value(c)[2],0);assertEqual("SS 2",e.value(c)[4],0);assertEqual("SS 3",e.value(c)[12],8);assertEqual("SS 4",
e.value(f)[2],2);assertEqual("SS 5",e.value(f)[12],12);setDelay(c,"{5 years}");e=runModel(!0);assertEqual("SS Units 1",e.value(c)[2],0);assertEqual("SS Units 2",e.value(c)[4],0);assertEqual("SS Units 3",e.value(c)[12],8);assertEqual("SS Units 4",e.value(f)[2],2);assertEqual("SS Units 5",e.value(f)[12],12);setDelay(c,"{365 days}*5");e=runModel(!0);assertEqual("SS Units 6",e.value(c)[2],0);assertEqual("SS Units 7",e.value(c)[4],0);assertEqual("SS Units 8",e.value(c)[12],8);assertEqual("SS Units 9",
e.value(f)[2],2);assertEqual("SS Units 10",e.value(f)[12],12);setValue(f,"[[My Stock]]-[My Stock]");g=createConnector("Outflow","Flow",c,null);setValue(g,"[Alpha]");setValue(d,"2");e=runModel(!0);assertEqual("FSF 1",Math.round(1E3*e.lastValue(c)),2E3);assertEqual("FSF 2",e.lastValue(f),8);assertEqual("FSF 3",e.value(f)[3],6);assertEqual("FSF 4",Math.round(1E3*e.lastValue(g)),2E3);assertEqual("FSF 5",e.value(g)[3],0);assertEqual("FSF 6",e.lastValue(d),2);clearModel();c=createPrimitive("My Stock","Stock",
[100,100],[140,50]);f=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",c,f);setValue(d,"1");setValue(c,"0");setValue(f,"0");e=runModel(!0);assertEqual("Same Name 1",e.value(c)[5],-5);assertEqual("Same Name 2",e.value(f)[5],5);assertEqual("Same Name 3",e.value(c)[10],-10);assertEqual("Same Name 4",e.value(f)[10],10);clearModel();f=createPrimitive("My Variable","Variable",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,null);createConnector("link",
"Link",d,f);setValue(d,10);setValue(f,"[My Flow]");e=runModel(!0);assertEqual("Flow Value Default",e.value(f)[20],10);clearModel();var c=createPrimitive("Stock 1","Stock",[100,100],[140,50]),f=createPrimitive("Stock 2","Stock",[100,100],[140,50]),d=createPrimitive("Stock 3","Stock",[100,100],[140,50]),g=createPrimitive("Stock 4","Stock",[100,100],[140,50]),h=createPrimitive("Stock 5","Stock",[100,100],[140,50]),k=createConnector("Flow 1","Flow",null,c),l=createConnector("Flow 2","Flow",null,f),n=
createConnector("Flow 3","Flow",null,d),o=createConnector("Flow 4","Flow",null,g),p=createConnector("Flow 5","Flow",null,h);setValue(k,1);setUnits(l,"unitless");setValue(l,7);setUnits(l,"1/years");setValue(n,3);setUnits(n,"dollars/years");setUnits(d,"dollars");setValue(o,"{200 centimeters/year}");setUnits(o,"meters/years");setUnits(g,"centimeters");setValue(p,5);setUnits(p,"1/days");e=runModel(!0);assertEqual("Flow Value 1",Math.round(1E3*e.value(k)[20]),1E3);assertEqual("Flow Value 2",Math.round(1E3*
e.value(l)[20]),7E3);assertEqual("Flow Value 3",Math.round(1E3*e.value(n)[20]),3E3);assertEqual("Flow Value 4",Math.round(1E3*e.value(o)[20]),2E3);assertEqual("Flow Value 5",Math.round(1E3*e.value(p)[20]),5E3);assertEqual("Flow Stock Value 1",e.value(c)[2],2);assertEqual("Flow Stock Value 2",Math.round(e.value(f)[2]),14);assertEqual("Flow Stock Value 3",e.value(d)[2],6);assertEqual("Flow Stock Value 4",e.value(g)[2],400);assertEqual("Flow Stock Value 5",e.value(h)[2],3650);clearModel();c=createPrimitive("My Stock",
"Stock",[100,100],[140,50]);f=createPrimitive("My Stock 2","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",c,f);setValue(c,10);setValue(f,0);setValue(d,1);e=runModel(!0);assertEqual("NonNegative Stock 1",e.value(c)[20],-10);assertEqual("NonNegative Stock 2",e.value(f)[20],20);setNonNegative(c,!0);e=runModel(!0);assertEqual("NonNegative Stock 3",e.value(c)[20],0);assertEqual("NonNegative Stock 4",e.value(f)[20],10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);
setValue(c,"years+10");e=runModel(!0);assertEqual("Stock Function Value 1",e.value(c)[20],10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);setValue(c,10);setValue(d,"years-10");setNonNegative(d,!1);e=runModel(!0);"RK1"==a[b]&&assertEqual("NonNegative Flow 1 - stock",e.value(c)[1],0);assertEqual("NonNegative Flow 2",Math.round(1E3*e.value(d)[0]),-1E4);setNonNegative(d,!0);e=runModel(!0);assertEqual("NonNegative Flow 3 -stock",e.value(c)[2],
10);assertEqual("NonNegative Flow 4",e.value(d)[1],0);clearModel();c=createPrimitive("my converter","Converter",[0,0],[100,40]);setData(c,"1,1.1;1.5,4;2,4;3,9;4,16;100,200");f=createPrimitive("Param","Variable",[0,0],[100,40]);createConnector("link","Link",f,c);setValue(f,"years+40");setConverterInput(c,f);e=runModel(!0);assertEqual("Primitive Input Value",200,e.value(c)[60]);setConverterInput(c,null);e=runModel(!0);assertEqual("Time Input Value",1.1,e.value(c)[1]);setData(c,"0,2;20,4");e=runModel(!0);
assertEqual("Interpolation",e.value(c)[10],3);setInterpolation(c,"Discrete");e=runModel(!0);assertEqual("No Interpolation",e.value(c)[10],2);setInterpolation(c,"Linear");e=runModel(!0);assertEqual("Interpolation 2",e.value(c)[10],3);setValue(f,"[my converter]+[my converter]");e=runModel(!0);assertEqual("Converter Addition",e.value(f)[10],6);assertEqual("Converter Addition",e.value(f)[20],8);assertEqual("Converter Addition",e.value(f)[21],8);setUnits(f,"Years");setUnits(c,"Years");e=runModel(!0);assertEqual("Converter Addition",
e.value(f)[10],6);assertEqual("Converter Addition",e.value(f)[20],8);assertEqual("Converter Addition",e.value(f)[21],8);clearModel();f=createPrimitive("My Stock 1","Stock",[0,0],[100,100]);c=createPrimitive("My Stock 2","Stock",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"10");setValue(c,"[My Stock 1]");e=runModel(!0);assertEqual("Stock Init 1",e.value(f)[0],10);assertEqual("Stock Init 2",e.value(c)[0],10);setValue(f,"[My Stock 2]");setValue(c,"20");e=runModel(!0);assertEqual("Stock Init 3",
e.value(f)[0],20);assertEqual("Stock Init 4",e.value(c)[0],20);clearModel();f=createPrimitive("My Variable 1","Variable",[0,0],[100,100]);c=createPrimitive("My Variable 2","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"10");setUnits(c,"Rabbits");setValue(c,"[My Variable 1]");e=runModel(!0);assertEqual("Unit Conversion Vars 1",e.value(f)[3],10);assertEqual("Unit Conversion Vars 2",e.value(c)[3],10);clearModel();f=createPrimitive("My Param","Variable",[0,0],[100,100]);c=
createPrimitive("Delayed","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"Years");setValue(c,"Delay(<My Param>, 5, -3)");e=runModel(!0);assertEqual("Initial Value",e.value(c)[3],-3);assertEqual("End Delay",e.value(f)[e.periods-6],e.lastValue(c));setValue(c,"Delay(<My Param>, 0)");e=runModel(!0);assertEqual("0 Delay",e.value(c)[3],e.value(f)[3]);setValue(f,"Years");setValue(c,"Delay([My Param], 5, -3)");e=runModel(!0);assertEqual("[ Initial Value",e.value(c)[3],-3);assertEqual("[ End Delay",
e.value(f)[e.periods-6],e.lastValue(c));setValue(c,"Delay([My Param], 0)");e=runModel(!0);assertEqual("[ 0 Delay",e.value(c)[3],e.value(f)[3]);clearModel();f=createPrimitive("My Param","Variable",[0,0],[100,100]);setValue(f,"Pulse(10,2,5)");e=runModel(!0);assertEqual("Pulse 1",e.value(f)[5],0);assertEqual("Pulse 2",e.value(f)[12],2);assertEqual("Pulse 3",e.value(f)[16],0);setValue(f,"Pulse(20,.5,2,10)");e=runModel(!0);assertEqual("Pulse 4",e.value(f)[28],0);assertEqual("Pulse 5",e.value(f)[20],0.5);
assertEqual("Pulse 6",e.value(f)[30],0.5);setValue(f,"IfThenElse(Years<20 and Years >= 10, 1, 0)");e=runModel(!0);assertEqual("IfThenElse 1",e.value(f)[5],0);assertEqual("IfThenElse 2",e.value(f)[11],1);setValue(f,"Ramp(10, 15, 10)");e=runModel(!0);assertEqual("Ramp 1",e.value(f)[5],0);assertEqual("Ramp 2",e.value(f)[12],4);assertEqual("Ramp 3",e.value(f)[16],10);setValue(f,"Step(10,3)");e=runModel(!0);assertEqual("Step 1",e.value(f)[5],0);assertEqual("Step 2",e.value(f)[12],3);assertEqual("Step 3",
e.value(f)[16],3);clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);c=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"(Years-60)^2");setValue(c,"PastMean(<x>)");e=runModel(!0);assertEqual("Mean",e.lastValue(c),950);setValue(c,"PastMedian(<x>)");e=runModel(!0);assertEqual("Median",Math.round(e.lastValue(c)),625);setValue(c,"Median(PastValues([x]))");e=runModel(!0);assertEqual("Median 2",Math.round(e.lastValue(c)),625);setValue(c,"PastStdDev(<x>)");
e=runModel(!0);assertEqual("StdDev",Math.round(10*e.lastValue(c)),Math.round(9628));setValue(c,"PastMax(<x>)");e=runModel(!0);assertEqual("Max",Math.round(e.lastValue(c)),3600);setValue(c,"PastMin([x])");e=runModel(!0);assertEqual("Min",e.lastValue(c),0);setValue(f,"(Years-60)^2");setValue(c,"Mean(1,2,3)");e=runModel(!0);assertEqual("Mean",e.lastValue(c),2);setValue(c,"Median(1,2,4)");e=runModel(!0);assertEqual("Median",Math.round(e.lastValue(c)),2);setValue(c,"Max(1,5,7,6)");e=runModel(!0);assertEqual("Max",
Math.round(e.lastValue(c)),7);setValue(c,"Min(1,0,7,6)");e=runModel(!0);assertEqual("Min",e.lastValue(c),0);clearModel();f=createPrimitive("My Param","Variable",[0,0],[100,100]);c=createPrimitive("Smoothed","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"StairCase(40, 3)");setValue(c,"Smooth(<My Param>,20, 5)");e=runModel(!0);assertEqual("Smooth 1",Math.round(100*e.value(c)[0]),500);assertEqual("Smooth 2",Math.round(100*e.value(c)[40]),Math.round(67.63));assertEqual("Smooth 3",
Math.round(10*e.value(c)[59]),21);clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);c=createPrimitive("ExpValue","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"Staircase(20)");setValue(c,"Delay3(<x>,10,2)");e=runModel(!0);"RK1"==a[b]?(assertEqual("ExpDelay 1",Math.round(100*e.value(c)[3]),Math.round(194.6)),assertEqual("ExpDelay 0",Math.round(100*e.value(c)[2]),Math.round(200)),assertEqual("ExpDelay 2",Math.round(100*e.value(c)[26]),Math.round(0.269*100))):
"RK4"==a[b]&&assertEqual("ExpDelay 1",Math.floor(10*e.value(c)[3]),Math.floor(19.46));clearModel();f=createPrimitive("RandParam","Variable",[0,0],[100,100]);c=createPrimitive("HalfRand","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"Rand");setValue(c,"[RandParam]/2");e=runModel(!0);assertEqual("RK1 Cached Value",Math.round(1E4*e.lastValue(f)),Math.round(2E4*e.lastValue(c)));e=runModel(!0);d=e.lastValue(f);e=runModel(!0);assertUnequal("Set Rand Seed 1",e.lastValue(f),d);
setMacros("SetRandSeed(1)");e=runModel(!0);d=e.lastValue(f);e=runModel(!0);assertEqual("Set Rand Seed 2",e.lastValue(f),d);setMacros("SetRandSeed(3)");e=runModel(!0);assertUnequal("Set Rand Seed 3",e.lastValue(c),d);setMacros("");clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);c=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("Link","Link",f,c);setValue(f,"Years");setValue(c,"Delay(<x>, {3 Years} )");e=runModel(!0);assertEqual("Time Units Delay 1",Math.round(1E4*e.value(c)[6]),
Math.round(3E4));setValue(c,"Delay(<x>, {48 Months})");e=runModel(!0);assertEqual("Time Units Delay 2",Math.round(1E4*e.value(c)[6]),Math.round(2E4));setValue(c,"PastMean(<x>, {48 Months})");e=runModel(!0);assertEqual("Time Units Mean 1",Math.round(1E4*e.value(c)[6]),Math.round(4E4));setValue(c,"Mean(PastValues([x], {48 Months}))");e=runModel(!0);assertEqual("Time Units Mean 2",Math.round(1E4*e.value(c)[6]),Math.round(4E4));setValue(c,"PastMean(<x>, {3 Years})");e=runModel(!0);assertEqual("Time Units Mean 3",
Math.round(1E4*e.value(c)[6]),Math.round(45E3));setValue(c,"PastCorrelation([x],[x])");e=runModel(!0);assertEqual("Correlation",Math.round(1E4*e.value(c)[6]),1E4);clearModel();f=createPrimitive("x1","Variable",[0,0],[100,100]);c=createPrimitive("x2","Variable",[0,0],[100,100]);d=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("l","Link",f,d);createConnector("l2","Link",c,d);setUnits(f,"Centimeters");setUnits(c,"Meters^2");setUnits(d,"Meters^3");setValue(f,"200");setValue(c,"3");setValue(d,
"[x1]*[x2]");e=runModel(!0);assertEqual("Variable Units Conversion 1",e.value(d)[50],6);setUnits(f,"Seconds");e=runModel(!0);assertUnequal("Variable Units Conversion 2",e.error,"none");clearModel();f=createPrimitive("y1","Variable",[0,0],[100,100]);c=createPrimitive("y2","Variable",[0,0],[100,100]);d=createPrimitive("x","Variable",[0,0],[100,100]);createConnector("l","Link",d,f);createConnector("l2","Link",d,c);setUnits(c,"Centimeters");setValue(d,"years");setValue(f,"delay([x],3)");setValue(c,"delay([x],5)");
e=runModel(!0);assertEqual("Past Values Clone Check 1",e.value(f)[10],7);assertEqual("Past Values Clone Check 2",e.value(c)[10],5);assertEqual("Past Values Clone Check 3",e.value(d)[10],10);setValue(f,"delay1([x],2)");setValue(c,"delay1([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 4",e.error,"none");setValue(f,"delay3([x],2)");setValue(c,"delay3([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 5",e.error,"none");setValue(f,"smooth([x],2)");setValue(c,"smooth([x],2)");e=
runModel(!0);assertEqual("Past Values Clone Check 6",e.error,"none");clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);c=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("l","Link",f,c);setValue(f,"{36 Meters}");setValue(c,"1");setUnits(c,"Qubits");e=runModel(!0);assertUnequal("Variable Units Scaling 1",e.error,"none");setUnits(f,"Meters");e=runModel(!0);assertEqual("Variable Units Scaling 2",e.error,"none");setValue(c,"[x]");e=runModel(!0);assertUnequal("Variable Units Scaling 3",
e.error,"none")}}function testClearModel(){test="ClearModel";setupDummy();assertUnequal("Initial",findAll().length,0);clearModel();assertEqual("Final",findAll().length,0)}
function testFolders(){test="Folders";var a=createPrimitive("s","Stock",[300,200],[140,30]),b=createPrimitive("f","Folder",[200,150],[150,100]);assertNull("Parent Null",getParent(a));setParent(a,b);assertEqual("Set Parent",getID(getParent(a)),getID(b));assertEqual("Default Folder",getCollapsed(b),!1);collapseFolder(b);assertEqual("Collapse Folder",getCollapsed(b),!0);expandFolder(b);assertEqual("Expand Folder",getCollapsed(b),!1);setParent(a,null);assertNull("Set Parent Null",getParent(a));assertEqual("Get Initial Type 1",
getFolderType(b),"None");setFolderType(b,"Agent");assertEqual("Get Initial Type 2",getFolderType(b),"Agent");clearModel()}
function testCreate(){test="Create";var a=createPrimitive("Test Stock","Stock",[300,200],[140,30]);assertEqual("Name",getName(a),"Test Stock");assertEqual("Type",getType(a),"Stock");var b=getPosition(a);assertEqual("Position x",b[0],300);assertEqual("Position y",b[1],200);setPosition(a,[100,400]);b=getPosition(a);assertEqual("Position x 2",b[0],100);assertEqual("Position y 2",b[1],400);a=createPrimitive("Test Variable","Variable",[400,200],[140,30]);assertEqual("Type",getType(a),"Variable");a=createConnector("Test Link",
"Link",findName("Test Stock"),findName("Test Variable"));assertEqual("Type",getType(a),"Link")}
function testFind(){test="Find";setupComplexDummy();assertEqual("findType",findType("Stock").length,4);assertEqual("findNote",findNote("foo").length,0);setNote(findType("Stock"),"foo");assertEqual("findNote",findNote("foo").length,4);assertEqual("findType",findType(["Stock","Variable"]).length,6);assertEqual("findType",findType(["dsfsdf"]).length,0);assertEqual("findType",findType("dsfsdf").length,0);assertEqual("findAll",findAll().length,10);assertNull("findName",findName("fdfsdgfg"));assertNotNull("findName",
findName("y"));assertEqual("findName",findName("y").length,2);assertEqual("findName",findName(["x","y","fvdf"]).length,3);var a=getID(findName("x"));assertNotNull("findID",findID(a));assertNotNull("findID",findID([a]));assertNull("findID",findID("gfdgdfg"))}function setupDummy(){clearModel();createPrimitive("x","Stock",[200,200],[140,30])}
function setupComplexDummy(){clearModel();createPrimitive("My Converter","Converter",[200,200],[140,30]);createPrimitive("x","Stock",[200,200],[140,30]);createPrimitive("y","Stock",[100,200],[140,30]);createPrimitive("My Stock","Stock",[200,100],[140,30]);createPrimitive("y","Stock",[200,100],[140,30]);createPrimitive("a","Variable",[300,200],[140,30]);createPrimitive("b","Variable",[300,100],[140,30]);createConnector("Link","Link",findName("x"),findName("b"));createConnector("Link 2","Link",findName("x"),
findName("My Converter"));createConnector("My Flow","Flow",findName("x"),findName("My Stock"))};Function.prototype.method=function(a,b){this.prototype[a]=b;return this};Function.method("inherits",function(a){var b={},c=this.prototype=new a;this.method("uber",function(d){d in b||(b[d]=0);var e,f;e=b[d];f=a.prototype;if(e){for(;e;)f=f.constructor.prototype,e-=1;e=f[d]}else e=c[d],e==this[d]&&(e=f[d]);b[d]+=1;f=e.apply(this,Array.prototype.slice.apply(arguments,[1]));b[d]-=1;return f});return this});function UnitStore(a,b){this.names=a?a:[];this.exponents=b?b:[]}UnitStore.prototype.clone=function(){return new UnitStore(this.names.slice(),this.exponents.slice())};UnitStore.prototype.multiplyUnitStore=function(a,b){for(var c=0;c<a.names.length;c++){var d=this.names.indexOf(a.names[c]);-1!=d?this.exponents[d]+=a.exponents[c]*b:(this.names.push(a.names[c]),this.exponents.push(a.exponents[c]*b))}};
UnitStore.prototype.unitless=function(){if(0==this.names.length||1==this.names.length&&""==this.names[0])return!0;for(var a=this.names.length-1;0<=a;a--)""==this.names[a]&&1<this.exponents[a]?this.exponents[a]=1:0==this.exponents[a]&&(this.exponents.splice(a,1),this.names.splice(a,1));return 0==this.names.length||1==this.names.length&&""==this.names[0]};
UnitStore.prototype.fromString=function(a){this.names=[];this.exponents=[];if(""!=a)for(var a=a.split(","),b=0;b<a.length;b++)this.names.push(a[b].split("^")[0]),-1!=a[b].indexOf("^")?this.exponents.push(parseFloat(a[b].split("^")[1])):this.exponents.push(1)};UnitStore.prototype.id=function(){return this.names.join(",")+this.exponents.join(",")};
UnitStore.prototype.toStringShort=function(){if(this.unitless())return"";for(var a="",b=0;b<this.names.length;b++)""!=a&&(a+=","),a+=this.names[b],1!=this.exponents[b]&&(a=a+"^"+this.exponents[b]);return a};var titleCaseReg=/\w\S*/g,titleCaseFunc=function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()};function toTitleCase(a){return a.replace(titleCaseReg,titleCaseFunc)}
UnitStore.prototype.toString=function(){for(var a="",b="",c=0,d=0,e=0;e<this.names.length;e++)if(""!=this.names[e]&&""!=this.names[e]){var f=null,f='<span class="unit">'+toTitleCase(this.names[e])+"</span>";1!=this.exponents[e]&&-1!=this.exponents[e]&&(f=f+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[e])+"</sup>");0<this.exponents[e]?(0<c&&(a+="<span class='markup'>*</span>"),a+=f,c+=1):(0<d&&(b+="<span class='markup'>*</span>"),b+=f,d+=1)}""==a&&(a="Unitless");if(""==b)return'<div class="units">'+
a+"</div>";"Unitless"==a&&(a="1");return'<span class="units">'+a+"<hr/><span class='markup'>/(</span>"+b+"<span class='markup'>)</span></span>"};function Quantities(a){this.toBase=1;this.unitless=!0;a&&(this.units=a.clone(),this.ApplyConversions())}
Quantities.prototype.ApplyConversions=function(){for(var a=!0;a;){for(var a=!1,b=this.units.names.length-1;0<=b;b--)if(0==this.units.exponents[b]||""==this.units.names[b])this.units.names.splice(b,1),this.units.exponents.splice(b,1);else{var c=findSourceIndex(this.units.names[b]);-1!=c&&(this.toBase=fn["*"](this.toBase,fn.expt(conScalings[c],this.units.exponents[b])),this.units.multiplyUnitStore(conUnitTargets[c],this.units.exponents[b]),this.units.names.splice(b,1),this.units.exponents.splice(b,
1),a=!0)}for(b=this.units.names.length-2;0<=b;b--){for(c=this.units.names.length-1;c>=b+1;c--)this.units.names[c]==this.units.names[b]&&(this.units.exponents[b]+=this.units.exponents[c],this.units.exponents.splice(c,1),this.units.names.splice(c,1));0==this.units.exponents[b]&&(this.units.exponents.splice(b,1),this.units.names.splice(b,1))}}this.unitless=0==this.units.names.length};Quantities.prototype.equal=function(a){return null==a||!unitsEqual(a.units,this.units)?!1:!0};
function convertUnits(a,b,c){if(unitsEqual(a,b,c))return 1;a=new Quantities(a);b=new Quantities(b);return!a.equal(b)?0:fn["/"](a.toBase,b.toBase)}function unitsEqual(a,b,c){if(strictUnits&&!0!==c){if(unitless(b)&&unitless(a))return!0;if(unitless(b)!=unitless(a))return!1}else if(unitless(b)||unitless(a))return!0;if(b.names.length!=a.names.length)return!1;for(c=0;c<a.names.length;c++)if(-1==b.names.indexOf(a.names[c])||a.exponents[c]!=b.exponents[b.names.indexOf(a.names[c])])return!1;return!0};var baseSources=",Degree,Radians?,Ampere,Gram,Second,Meter,(Meters? ?Squared?|Squared? ?Meters?),(Centimeters? ?Squared?|Squared? ?Centimeters?),(Centimeters? ?Cubed?|Cubic ?Centimeters?),(Meters? Cubed?|Cubic ?Meters?),(Kilometers? ?Cubed?|Cubic ?Kilometers?),(Inches? Squared?|Squared? ?Inches?),(Miles? ?Squared?|Squared? ?Miles?),(Kilometers? Squared?|Squared? ?Kilometers?),Acre? ?(Feet|Foot),Meters? ?per ?Seconds?,Meters? ?per ?Seconds? ?Squared?,(Foot|Feet) ?per ?Seconds?,(Foot|Feet) ?per ?Seconds? ?Squared?,Miles? ?per ?Hours?,Miles? ?per ?Hours? ?Squared?,Kilometers? ?per ?Hours?,Kilometers? ?per ?Hours? ?Squared?,Liters? ?per ?Seconds?,(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?,(Squared? ?Yards?|Yards? ?Squared?),(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?),(Squared? Millimeters?|Millimeters? ?Squared?),(Millimeters? ?Cubed?|Cubic ?Millimeters?),Gallons? ?per ?Seconds?,Gallons? ?per ?Minutes?,Pounds? ?per ?Seconds?,Kilograms? ?per ?Seconds?,Dollars? ?per ?Seconds?,Dollars? ?per ?Hours?,Dollars? ?per ?Days?,Dollars? ?per ?Weeks?,Dollars? ?per ?Months?,Dollars? ?per ?Quarters?,Dollars? ?per ?Years?,Euros? ?per ?Seconds?,Euros? ?per ?Hours?,Euros? ?per ?Days?,Euros? ?per ?Weeks?,Euros? ?per ?Months?,Euros? ?per ?Quarters?,Euros? ?per ?Years?,Centimeters?,Millimeters?,Kilometers?,Inch(es)?,(Foot|Feet),Yards?,Miles?,Acres?,Hectares?,Liters?,Gallons?,Quarts?,Fluid ?Ounces?,Years?,Quarters?,Months?,Weeks?,Days?,Hours?,Minutes?,Kilograms?,Milligrams?,Ounces?,Pounds?,Tonnes?,Tons?,Watts?,Kilowatts?,Megawatts?,Gigawatts?,Calories?,Kilocalories?,(BTUs?|British ?Thermal ?units?),Kilojoules?,Joules?,Coulombs?,Volts?,Millivolts?,Kilovolts?,Newtons?,Pounds? ?Force,Atoms?,Molecules?,Farads?,Pascals?,Kilopascals?,Bars?,Atmospheres?,Pounds? ?per ?Squared? ?Inch(es)?".split(","),
baseTargets=";Degrees;Degrees;Amperes;Grams;Seconds;Meters;Meters^2;Centimeters^2;Centimeters^3;Meters^3;Kilometers^3;Inches^2;Miles^2;Kilometers^2;Acres,Feet;Meters,Seconds^-1;Meters,Seconds^-2;Feet,Seconds^-1;Feet,Seconds^-2;Miles,Hours^-1;Miles,Hours^-2;Kilometers,Hours^-1;Kilometers,Hours^-2;Liters,Seconds^-1;Meters^3,Seconds^-1;Yards^2;Feet^2;Millimeters^2;Millimeters^3;Gallons,Seconds^-1;Gallons,Minutes^-1;Pounds,Seconds^-1;Kilograms,Seconds^-1;Dollars,Seconds^-1;Dollars,Hours^-1;Dollars,Days^-1;Dollars,Weeks^-1;Dollars,Months^-1;Dollars,Quarters^-1;Dollars,Years^-1;Euros,Seconds^-1;Euros,Hours^-1;Euros,Days^-1;Euros,Weeks^-1;Euros,Months^-1;Euros,Quarters^-1;Euros,Years^-1;Meters;Meters;Meters;Meters;Meters;Meters;Meters;Meters^2;Meters^2;Meters^3;Meters^3;Meters^3;Meters^3;Seconds;Seconds;Seconds;Seconds;Seconds;Seconds;Seconds;Grams;Grams;Grams;Grams;Grams;Grams;Joules,Seconds^-1;Watts;Watts;Watts;Joules;Joules;Joules;Joules;Newtons,Meters;Amperes,Seconds;Watts,Amperes^-1;Volts;Volts;Kilograms,Meters,Seconds^-1;Pounds,Feet per Second Squared;Moles;Moles;Joules,Volts^-2;Newton,Meters^-2;Pascals;Pascals;Pascals;Pascals".split(";"),
baseScalings=[0,1,180/Math.PI,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.01,0.0010,1E3,0.0254,0.3048,0.9144,1609.344,4046.85642,1E4,0.0010,0.003785,9.46E-4,3.0E-5,31536E3,7884E3,2628E3,604800,86400,3600,60,1E3,0.0010,28.349523,453.59237,1E6,907184.74,1,1E3,1E6,1E9,4.184,4184,1055.05585,1E3,1,1,1,0.0010,1E3,1,32.17405,0,0,1,1,1E3,1E5,101325,6894],conScalings=[],conTargets=[],conSourceNames=[],conUnitTargets=[],conSourceRegEx=[];
function loadUnits(a,b,c){conScalings=c;conTargets=b;conSourceNames=a;for(a=0;a<baseSources.length;a++)conScalings.push(baseScalings[a]),conTargets.push(baseTargets[a]),conSourceNames.push(baseSources[a]);conSourceRegEx=[];conUnitTargets=[];for(a=0;a<conTargets.length;a++)conUnitTargets.push(new UnitStore(null,1)),conUnitTargets[conUnitTargets.length-1].fromString(conTargets[a].toLowerCase()),conSourceRegEx.push(RegExp("^"+conSourceNames[a]+"$","i"))}loadUnits([],[],[]);
var findSourceIndex=function(a){if(a in findSourceIndex)return findSourceIndex[a];for(var b=conSourceNames.length-1;0<=b;b--)if(""!=conSourceNames[b]&&conSourceRegEx[b].test(a))return findSourceIndex[a]=b;return findSourceIndex[a]=-1};function Material(a,b){this.value=a;this.units=b}Material.prototype.toNum=function(){return this};Material.prototype.simplify=function(){if(!unitless(this.units)){var a=new Quantities(this.units);this.value=fn["*"](this.value,a.toBase);this.units=a.units}};
Material.prototype.toString=function(){return unitless(this.units)?this.value+"":"<span class='markup'>{</span>"+this.value+"&nbsp"+this.units.toString()+"<span class='markup'>}</span>"};Material.prototype.fullClone=function(){return new Material(this.value,this.units?this.units.clone():void 0)};
Material.prototype.forceUnits=function(a){if(unitless(this.units))return this.units=a.clone(),this;var b=convertUnits(this.units,a);0==b?unitAlert(this.units,a,"forceUnits"):(this.value=fn["*"](this.value,b),this.units=a.clone());return this};function unitAlert(a,b,c){throw"MSG: Incompatible units for the "+c+" of "+(a?a.toString():(new UnitStore).toString())+" and "+(b?b.toString():(new UnitStore).toString())+".";}function unitless(a){return null===a||!a||a.unitless()};var notsupportedfn=function(){console.log("Not supported")},sn=function(a){return"#"==a[0]?parseFloat(a.substr(2)):parseFloat(a)},fn={"+":function(a,b){return a+b},"-":function(a,b){return isDefined(b)?a-b:-a},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"=":function(a,b){return a==b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},mod:function(a,b){return a%b},expt:function(a,b){return Math.pow(a,b)},abs:Math.abs,
sin:Math.sin,asin:Math.asin,cos:Math.cos,acos:Math.acos,tan:Math.tan,atan:Math.atan,sqrt:Math.sqrt,log:function(a,b){return isDefined(b)?Math.log(a)/Math.log(b):Math.log(a)},exp:Math.exp,round:Math.round,floor:Math.floor,ceiling:Math.ceil,angle:notsupportedfn,magnitude:notsupportedfn,"real-part":function(a){return a}};if("undefined"==typeof org||!org)var org={};if("undefined"==typeof org.antlr||!org.antlr)org.antlr={};org.antlr.global=function(){return this}.call(null);org.antlr.namespace=function(){var a=arguments,b=null,c,d,e;for(c=0;c<a.length;c+=1){e=a[c].split(".");b=org.antlr.global;for(d=0;d<e.length;d+=1)b[e[d]]=b[e[d]]||{},b=b[e[d]]}return b};org.antlr.env=org.antlr.env||{};
org.antlr.env.ua=function(){var a={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1},b,c;try{b=navigator.userAgent;/KHTML/.test(b)&&(a.webkit=1);if((c=b.match(/AppleWebKit\/([^\s]*)/))&&c[1]){a.webkit=parseFloat(c[1]);if(/ Mobile\//.test(b))a.mobile="Apple";else if(c=b.match(/NokiaN[^\/]*/))a.mobile=c[0];if(c=b.match(/AdobeAIR\/([^\s]*)/))a.air=c[0]}if(!a.webkit)if((c=b.match(/Opera[\s\/]([^\s]*)/))&&c[1]){if(a.opera=parseFloat(c[1]),c=b.match(/Opera Mini[^;]*/))a.mobile=c[0]}else if((c=b.match(/MSIE\s([^;]*)/))&&
c[1])a.ie=parseFloat(c[1]);else if(c=b.match(/Gecko\/([^\s]*)/))if(a.gecko=1,(c=b.match(/rv:([^\s\)]*)/))&&c[1])a.gecko=parseFloat(c[1])}catch(d){}try{"undefined"==typeof window&&loadClass&&(a.rhino=!0)}catch(e){}return a}();org.antlr.namespace("org.antlr.runtime.tree");
org.antlr.lang=org.antlr.lang||{isArray:function(a){if(a){var b=org.antlr.lang;return b.isNumber(a.length)&&b.isFunction(a.splice)}return!1},isBoolean:function(a){return"boolean"===typeof a},isFunction:function(a){return"function"===typeof a},isNull:function(a){return null===a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},isObject:function(a){return a&&("object"===typeof a||org.antlr.lang.isFunction(a))||!1},isString:function(a){return"string"===typeof a},isUndefined:function(a){return"undefined"===
typeof a},_IEEnumFix:function(a,b){if(org.antlr.env.ua.ie){var c=["toString","valueOf"],d;for(d=0;d<c.length;d+=1){var e=c[d],f=b[e];org.antlr.lang.isFunction(f)&&f!=Object.prototype[e]&&(a[e]=f)}}},extend:function(a,b,c){if(!b||!a)throw Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.superclass=b.prototype;b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=
b);if(c){for(var e in c)a.prototype[e]=c[e];org.antlr.lang._IEEnumFix(a.prototype,c)}},augmentObject:function(a,b){if(!b||!a)throw Error("Absorb failed, verify dependencies.");var c=arguments,d,e=c[2];if(e&&!0!==e)for(d=2;d<c.length;d+=1)a[c[d]]=b[c[d]];else{for(d in b)if(e||!a[d])a[d]=b[d];org.antlr.lang._IEEnumFix(a,b)}},augmentProto:function(a,b){if(!b||!a)throw Error("Augment failed, verify dependencies.");for(var c=[a.prototype,b.prototype],d=2;d<arguments.length;d+=1)c.push(arguments[d]);org.antlr.lang.augmentObject.apply(this,
c)},merge:function(){for(var a={},b=arguments,c=0,d=b.length;c<d;c+=1)org.antlr.lang.augmentObject(a,b[c],!0);return a},isValue:function(a){var b=org.antlr.lang;return b.isObject(a)||b.isString(a)||b.isNumber(a)||b.isBoolean(a)},array:{peek:function(a){if(!org.antlr.lang.isArray(a))throw Error("org.antlr.lang.array.peek: a is not an array.");var b=a.length;if(0>=b)throw Error("org.antlr.lang.array.peek: a is empty.");return a[b-1]}}};
org.antlr.runtime.RecognizerSharedState=function(){this.following=[];this._fsp=-1;this.errorRecovery=!1;this.lastErrorIndex=-1;this.failed=!1;this.backtracking=this.syntaxErrors=0;this.token=this.ruleMemo=null;this.tokenStartCharIndex=-1;this.text=null};org.antlr.runtime.IndexOutOfBoundsException=function(a){org.antlr.runtime.IndexOutOfBoundsException.superclass.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.IndexOutOfBoundsException,Error,{name:"org.antlr.runtime.IndexOutOfBoundsException"});
org.antlr.runtime.RecognitionException=function(a){org.antlr.runtime.RecognitionException.superclass.constructor.call(this);this.input=a;this.index=a.index();a instanceof org.antlr.runtime.CommonTokenStream&&(this.token=a.LT(1),this.line=this.token.getLine(),this.charPositionInLine=this.token.getCharPositionInLine());a instanceof org.antlr.runtime.tree.TreeNodeStream?this.extractInformationFromTreeNodeStream(a):a instanceof org.antlr.runtime.ANTLRStringStream?(this.c=a.LA(1),this.line=a.getLine(),
this.charPositionInLine=a.getCharPositionInLine()):this.c=a.LA(1);this.message=this.toString()};
org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(a){var b,c,d;this.node=a.LT(1);c=a.getTreeAdaptor();if(b=c.getToken(this.node))if(this.token=b,0>=b.getLine()){d=-1;for(b=a.LT(d);b;){if((priorPayload=c.getToken(b))&&0<priorPayload.getLine()){this.line=priorPayload.getLine();this.charPositionInLine=
priorPayload.getCharPositionInLine();this.approximateLineInfo=!0;break}--d;b=a.LT(d)}}else this.line=b.getLine(),this.charPositionInLine=b.getCharPositionInLine();else this.node instanceof org.antlr.runtime.tree.CommonTree?(this.line=this.node.getLine(),this.charPositionInLine=this.node.getCharPositionInLine(),this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)):(a=c.getType(this.node),c=c.getText(this.node),this.token=new org.antlr.runtime.CommonToken(a,c))},getUnexpectedType:function(){return this.input instanceof
org.antlr.runtime.CommonTokenStream?this.token.getType():this.input instanceof org.antlr.runtime.tree.TreeNodeStream?this.input.getTreeAdaptor().getType(this.node):this.c}});org.antlr.runtime.MismatchedTokenException=function(a,b){0===arguments.length?this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE:(org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,b),this.expecting=a)};
org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(a,b){0<arguments.length&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,a,b)};
org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var a=", expected "+this.expecting;this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(a="");return!org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+a+")":"UnwantedTokenException(found="+this.token.getText()+a+")"},name:"org.antlr.runtime.UnwantedTokenException"});
org.antlr.runtime.MissingTokenException=function(a,b,c){0<arguments.length&&(org.antlr.runtime.MissingTokenException.superclass.constructor.call(this,a,b),this.inserted=c)};
org.antlr.lang.extend(org.antlr.runtime.MissingTokenException,org.antlr.runtime.MismatchedTokenException,{getMissingType:function(){return this.expecting},toString:function(){return org.antlr.lang.isValue(this.inserted)&&org.antlr.lang.isValue(this.token)?"MissingTokenException(inserted "+this.inserted+" at "+this.token.getText()+")":org.antlr.lang.isValue(this.token)?"MissingTokenException(at "+this.token.getText()+")":"MissingTokenException"},name:"org.antlr.runtime.MissingTokenException"});
org.antlr.runtime.NoViableAltException=function(a,b,c,d){org.antlr.runtime.NoViableAltException.superclass.constructor.call(this,d);this.grammarDecisionDescription=a;this.decisionNumber=b;this.stateNumber=c};
org.antlr.lang.extend(org.antlr.runtime.NoViableAltException,org.antlr.runtime.RecognitionException,{toString:function(){return this.input instanceof org.antlr.runtime.ANTLRStringStream?"NoViableAltException('"+this.getUnexpectedType()+"'@["+this.grammarDecisionDescription+"])":"NoViableAltException("+this.getUnexpectedType()+"@["+this.grammarDecisionDescription+"])"},name:"org.antlr.runtime.NoViableAltException"});
org.antlr.runtime.EarlyExitException=function(a,b){org.antlr.runtime.EarlyExitException.superclass.constructor.call(this,b);this.decisionNumber=a};org.antlr.lang.extend(org.antlr.runtime.EarlyExitException,org.antlr.runtime.RecognitionException,{name:"org.antlr.runtime.EarlyExitException"});org.antlr.runtime.MismatchedSetException=function(a,b){org.antlr.runtime.MismatchedSetException.superclass.constructor.call(this,b);this.expecting=a};
org.antlr.lang.extend(org.antlr.runtime.MismatchedSetException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedSetException"});org.antlr.runtime.MismatchedNotSetException=function(a,b){org.antlr.runtime.MismatchedNotSetException.superclass.constructor.call(this,a,b)};
org.antlr.lang.extend(org.antlr.runtime.MismatchedNotSetException,org.antlr.runtime.MismatchedSetException,{toString:function(){return"MismatchedNotSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedNotSetException"});org.antlr.runtime.MismatchedRangeException=function(a,b,c){if(0===arguments.length)return this;org.antlr.runtime.MismatchedRangeException.superclass.constructor.call(this,c);this.a=a;this.b=b};
org.antlr.lang.extend(org.antlr.runtime.MismatchedRangeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedRangeException("+this.getUnexpectedType()+" not in ["+this.a+","+this.b+"])"},name:"org.antlr.runtime.MismatchedRangeException"});org.antlr.runtime.FailedPredicateException=function(a,b,c){org.antlr.runtime.FailedPredicateException.superclass.constructor.call(this,a);this.ruleName=b;this.predicateText=c};
org.antlr.lang.extend(org.antlr.runtime.FailedPredicateException,org.antlr.runtime.RecognitionException,{toString:function(){return"FailedPredicateException("+this.ruleName+",{"+this.predicateText+"}?)"},name:"org.antlr.runtime.FailedPredicateException"});org.antlr.runtime.BitSet=function(a){a||(a=org.antlr.runtime.BitSet.BITS);org.antlr.lang.isArray(a)?this.bits=a:org.antlr.lang.isNumber(a)&&(this.bits=[])};
org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(a){return 1<<(a&org.antlr.runtime.BitSet.MOD_MASK)},numWordsToHold:function(a){return(a>>org.antlr.runtime.BitSet.LOG_BITS)+1},wordNumber:function(a){return a>>org.antlr.runtime.BitSet.LOG_BITS},of:function(a,b){var c,d,e;if(org.antlr.lang.isNumber(a)){if(org.antlr.lang.isNumber(b)){e=new org.antlr.runtime.BitSet(b+1);for(c=a;c<=b;c++)d=org.antlr.runtime.BitSet.wordNumber(c),e.bits[d]|=org.antlr.runtime.BitSet.bitMask(c)}else e=
new org.antlr.runtime.BitSet(a+1),e.add(a);return e}if(org.antlr.lang.isArray(a)){e=new org.antlr.runtime.BitSet;for(c=a.length-1;0<=c;c--)e.add(a[c]);return e}if(a instanceof org.antlr.runtime.BitSet)return!a?null:a;if(a instanceof org.antlr.runtime.IntervalSet){if(!a)return null;e=new org.antlr.runtime.BitSet;e.addAll(a);return e}if(org.antlr.lang.isObject(a)){d=[];for(c in a)org.antlr.lang.isNumber(c)&&d.push(c);return org.antlr.runtime.BitSet.of(d)}}});
org.antlr.runtime.BitSet.prototype={add:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);b>=this.bits.length&&this.growToInclude(a);this.bits[b]|=org.antlr.runtime.BitSet.bitMask(a)},addAll:function(a){var b,c;if(a instanceof org.antlr.runtime.BitSet)this.orInPlace(a);else if(!(a instanceof org.antlr.runtime.IntervalSet)&&org.antlr.lang.isArray(a))for(b=0;b<a.length;b++)c=a[b],this.add(c)},and:function(a){var b=this.clone();b.andInPlace(a);return b},andInPlace:function(a){var b=Math.min(this.bits.length,
a.bits.length),c;for(c=b-1;0<=c;c--)this.bits[c]&=a.bits[c];for(c=b;c<this.bits.length;c++)this.bits[c]=0},clear:function(a){if(0===arguments.length){var b;for(b=this.bits.length-1;0<=b;b--)this.bits[b]=0}else b=org.antlr.runtime.BitSet.wordNumber(a),b>=this.bits.length&&this.growToInclude(a),this.bits[b]&=~org.antlr.runtime.BitSet.bitMask(a)},clone:function(){var a,b,c=[];for(a=0,b=this.bits.length;a<b;a++)c[a]=this.bits[a];return new org.antlr.runtime.BitSet(c)},size:function(){var a=0,b,c,d;for(b=
this.bits.length-1;0<=b;b--)if(c=this.bits[b],0!==c)for(d=org.antlr.runtime.BitSet.BITS-1;0<=d;d--)0!==(c&1<<d)&&a++;return a},equals:function(a){if(!a||!(a instanceof org.antlr.runtime.BitSet))return!1;var b,c=Math.min(this.bits.length,a.bits.length);for(b=0;b<c;b++)if(this.bits[b]!=a.bits[b])return!1;if(this.bits.length>c)for(b=c+1;b<this.bits.length;b++){if(0!==this.bits[b])return!1}else if(a.bits.length>c)for(b=c+1;b<a.bits.length;b++)if(0!==a.bits[b])return!1;return!0},growToInclude:function(a){Math.max(this.bits.length<<
1,org.antlr.runtime.BitSet.numWordsToHold(a));var a=[],b;for(b=0,len=this.bits.length;b<len;b++)a[b]=this.bits[b];this.bits=a},member:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);return b>=this.bits.length?!1:0!==(this.bits[b]&org.antlr.runtime.BitSet.bitMask(a))},getSingleElement:function(){var a;for(a=0;a<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;a++)if(this.member(a))return a;return-1},isNil:function(){var a;for(a=this.bits.length-1;0<=a;a--)if(0!==this.bits[a])return!1;return!0},
complement:function(a){if(a)return a.subtract(this);a=this.clone();a.notInPlace();return a},notInPlace:function(){var a,b,c;if(0===arguments.length)for(a=this.bits.length-1;0<=a;a--)this.bits[a]=~this.bits[a];else{1===arguments.length?(a=0,b=arguments[0]):(a=arguments[0],b=arguments[1]);for(this.growToInclude(b);a<=b;a++)c=org.antlr.runtime.BitSet.wordNumber(a),this.bits[c]^=org.antlr.runtime.BitSet.bitMask(a)}},or:function(a){if(!a)return this;var b=this.clone();b.orInPlace(a);return b},orInPlace:function(a){if(a){a.bits.length>
this.bits.length&&this.setSize(a.bits.length);var b;for(b=Math.min(this.bits.length,a.bits.length)-1;0<=b;b--)this.bits[b]|=a.bits[b]}},remove:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);b>=this.bits.length&&this.growToInclude(a);this.bits[b]&=~org.antlr.runtime.BitSet.bitMask(a)},setSize:function(a){for(a-=this.bits.length;0<=a;)this.bits.push(0),a--},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},
subset:function(a){return!a?!1:this.and(a).equals(this)},subtractInPlace:function(a){if(a){var b;for(b=0;b<this.bits.length&&b<a.bits.length;b++)this.bits[b]&=~a.bits[b]}},subtract:function(a){if(!a||!(a instanceof org.antlr.runtime.BitSet))return null;var b=this.clone();b.subtractInPlace(a);return b},toArray:function(){var a=[],b,c=0;for(b=0;b<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;b++)this.member(b)&&(a[c++]=b);return a},toPackedArray:function(){return this.bits},toString:function(){return 0===
arguments.length?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(a){var b="{",c,d=!1;for(c=0;c<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;c++)this.member(c)&&(0<c&&d&&(b+=","),b=a?b+a.getTokenDisplayName(c):b+c.toString(),d=!0);return b+"}"},toString2:function(a,b){var c="",d;for(d=0;d<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;d++)this.member(d)&&
(0<c.length&&(c+=a),c=d>=b.size()?c+("'"+d+"'"):org.antlr.lang.isValue(b.get(d))?c+b.get(d):c+("'"+d+"'"));return c}};org.antlr.runtime.CharStream={EOF:-1};
org.antlr.runtime.CommonToken=function(){var a;this.charPositionInLine=-1;this.channel=0;this.index=-1;1==arguments.length?org.antlr.lang.isNumber(arguments[0])?this.type=arguments[0]:(a=arguments[0],this.text=a.getText(),this.type=a.getType(),this.line=a.getLine(),this.index=a.getTokenIndex(),this.charPositionInLine=a.getCharPositionInLine(),this.channel=a.getChannel(),a instanceof org.antlr.runtime.CommonToken&&(this.start=a.start,this.stop=a.stop)):2==arguments.length?(this.type=arguments[0],this.text=
arguments[1],this.channel=0):5==arguments.length&&(this.input=arguments[0],this.type=arguments[1],this.channel=arguments[2],this.start=arguments[3],this.stop=arguments[4])};
org.antlr.runtime.CommonToken.prototype={getType:function(){return this.type},setLine:function(a){this.line=a},getText:function(){if(org.antlr.lang.isString(this.text))return this.text;return!this.input?null:this.text=this.input.substring(this.start,this.stop)},setText:function(a){this.text=a},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(a){this.charPositionInLine=a},getChannel:function(){return this.channel},
setChannel:function(a){this.channel=a},setType:function(a){this.type=a},getStartIndex:function(){return this.start},setStartIndex:function(a){this.start=a},getStopIndex:function(){return this.stop},setStopIndex:function(a){this.stop=a},getTokenIndex:function(){return this.index},setTokenIndex:function(a){this.index=a},getInputStream:function(){return this.input},setInputStream:function(a){this.input=a},toString:function(){var a="";0<this.channel&&(a=",channel="+this.channel);var b=this.getText();
org.antlr.lang.isNull(b)?b="<no text>":(b=b.replace(/\n/g,"\\\\n"),b=b.replace(/\r/g,"\\\\r"),b=b.replace(/\t/g,"\\\\t"));return"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+b+"',<"+this.type+">"+a+","+this.line+":"+this.getCharPositionInLine()+"]"}};org.antlr.runtime.Token=function(){};
org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN_TYPE:0,INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0),DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.lang.augmentObject(org.antlr.runtime.CommonToken,org.antlr.runtime.Token);
org.antlr.runtime.tree.RewriteCardinalityException=function(a){this.elementDescription=a};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteCardinalityException,Error,{getMessage:function(){return org.antlr.lang.isString(this.elementDescription)?this.elementDescription:null},name:function(){return"org.antlr.runtime.tree.RewriteCardinalityException"}});
org.antlr.runtime.tree.RewriteEmptyStreamException=function(a){org.antlr.runtime.tree.RewriteEmptyStreamException.superclass.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEmptyStreamException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEmptyStreamException"}});
org.antlr.runtime.tree.RewriteEarlyExitException=function(a){var b=org.antlr.runtime.tree.RewriteEarlyExitException.superclass;org.antlr.lang.isUndefined(a)&&(a=null);b.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEarlyExitException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEarlyExitException"}});
org.antlr.runtime.MismatchedTreeNodeException=function(a,b){a&&b&&(org.antlr.runtime.MismatchedTreeNodeException.superclass.constructor.call(this,b),this.expecting=a)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTreeNodeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTreeNodeException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTreeNodeException"});org.antlr.runtime.tree.BaseTree=function(){};
org.antlr.runtime.tree.BaseTree.prototype={getChild:function(a){return!this.children||a>=this.children.length?null:this.children[a]},getChildren:function(){return this.children},getFirstChildWithType:function(a){var b,c;for(b=0;this.children&&b<this.children.length;b++)if(c=this.children[b],c.getType()===a)return c;return null},getChildCount:function(){return!this.children?0:this.children.length},addChild:function(a){if(org.antlr.lang.isValue(a)){var b,c,d;if(a.isNil()){if(this.children&&this.children==
a.children)throw Error("attempt to add child list to itself");if(a.children)if(this.children){b=a.children.length;for(c=0;c<b;c++)d=a.children[c],this.children.push(d),d.setParent(this),d.setChildIndex(this.children.length-1)}else this.children=a.children,this.freshenParentAndChildIndexes()}else this.children||(this.children=this.createChildrenList()),this.children.push(a),a.setParent(this),a.setChildIndex(this.children.length-1)}},addChildren:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],this.addChild(c)},
setChild:function(a,b){if(b){if(b.isNil())throw Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList());this.children[a]=b;b.setParent(this);b.setChildIndex(a)}},deleteChild:function(a){if(!this.children)return null;if(0>a||a>=this.children.length)throw Error("Index out of bounds.");var b=this.children.splice(a,1)[0];this.freshenParentAndChildIndexes(a);return b},replaceChildren:function(a,b,c){if(!this.children)throw Error("indexes invalid; no children in list");
var d=b-a+1,e,f=null;c.isNil()?f=c.children:(f=[],f.push(c));var g=e=f.length,c=d-e;if(0===c)for(c=0;a<=b;a++)d=f[c],this.children[a]=d,d.setParent(this),d.setChildIndex(a),c++;else{if(0<c){for(c=0;c<g;c++)this.children[a+c]=f[c];for(d=f=a+g;d<=b;d++)this.children.splice(f,1)}else{for(c=0;c<d;c++)this.children[a+c]=f[c];for(c=d;c<e;c++)this.children.splice(a+c,0,f[c])}this.freshenParentAndChildIndexes(a)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(a){org.antlr.lang.isNumber(a)||
(a=0);for(var b=this.getChildCount(),c;a<b;a++)c=this.getChild(a),c.setChildIndex(a),c.setParent(this)},sanityCheckParentAndChildIndexes:function(a,b){0===arguments.length&&(a=null,b=-1);if(a!==this.getParent())throw Error("parents don't match; expected "+a+" found "+this.getParent());if(b!==this.getChildIndex())throw Error("child indexes don't match; expected "+b+" found "+this.getChildIndex());var c=this.getChildCount(),d,e;for(d=0;d<c;d++)e=this.getChild(d),e.sanityCheckParentAndChildIndexes(this,
d)},getChildIndex:function(){return 0},setChildIndex:function(){},getParent:function(){return null},setParent:function(){},getTree:function(){return this},toStringTree:function(){if(!this.children||0===this.children.length)return this.toString();var a="",b,c;this.isNil()||(a=a+"("+this.toString(),a+=" ");for(b=0;this.children&&b<this.children.length;b++)c=this.children[b],0<b&&(a+=" "),a+=c.toStringTree();this.isNil()||(a+=")");return a},getLine:function(){return 0},getCharPositionInLine:function(){return 0}};
org.antlr.runtime.tree.CommonTree=function(a){this.childIndex=this.stopIndex=this.startIndex=-1;this.token=this.parent=null;a instanceof org.antlr.runtime.tree.CommonTree?(org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,a),this.token=a.token,this.startIndex=a.startIndex,this.stopIndex=a.stopIndex):a instanceof org.antlr.runtime.CommonToken&&(this.token=a)};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return!this.token?org.antlr.runtime.Token.INVALID_TOKEN_TYPE:this.token.getType()},getText:function(){return!this.token?null:this.token.getText()},getLine:function(){return!this.token||0===this.token.getLine()?0<this.getChildCount()?this.getChild(0).getLine():
0:this.token.getLine()},getCharPositionInLine:function(){return!this.token||-1===this.token.getCharPositionInLine()?0<this.getChildCount()?this.getChild(0).getCharPositionInLine():0:this.token.getCharPositionInLine()},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(a){this.startIndex=a},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(a){this.stopIndex=a},getChildIndex:function(){return this.childIndex},
getParent:function(){return this.parent},setParent:function(a){this.parent=a},setChildIndex:function(a){this.childIndex=a},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":!this.token?null:this.token.getText()}});org.antlr.runtime.tree.Tree={INVALID_NODE:new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN)};
org.antlr.runtime.tree.CommonErrorNode=function(a,b,c,d){if(!c||c.getTokenIndex()<b.getTokenIndex()&&c.getType()!=org.antlr.runtime.Token.EOF)c=b;this.input=a;this.start=b;this.stop=c;this.trappedException=d};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonErrorNode,org.antlr.runtime.tree.CommonTree,{isNil:function(){return!1},getType:function(){return org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){var a=null;if(this.start instanceof org.antlr.runtime.CommonToken){var a=this.start.getTokenIndex(),b=this.stop.getTokenIndex();this.stop.getType()===org.antlr.runtime.Token.EOF&&(b=this.input.size());a=this.input.toString(a,b)}else a=this.start instanceof org.antlr.runtime.tree.CommonTree?
this.input.toString(this.start,this.stop):"<unknown>";return a},toString:function(){return this.trappedException instanceof org.antlr.runtime.MissingTokenException?"<missing type: "+this.trappedException.getMissingType()+">":this.trappedException instanceof org.antlr.runtime.UnwantedTokenException?"<extraneous: "+this.trappedException.getUnexpectedToken()+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.MismatchedTokenException?"<mismatched token: "+this.trappedException.token+
", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.NoViableAltException?"<unexpected: "+this.trappedException.token+", resync="+this.getText()+">":"<error: "+this.getText()+">"}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};
org.antlr.runtime.tree.BaseTreeAdaptor.prototype={nil:function(){return this.create(null)},errorNode:function(a,b,c,d){return new org.antlr.runtime.tree.CommonErrorNode(a,b,c,d)},isNil:function(a){return a.isNil()},dupTree:function(a,b){1===arguments.length&&(b=null);if(!a)return null;var c=this.dupNode(a);this.setChildIndex(c,this.getChildIndex(a));this.setParent(c,b);var d=this.getChildCount(a),e,f;for(e=0;e<d;e++)f=this.getChild(a,e),f=this.dupTree(f,a),this.addChild(c,f);return c},addChild:function(a,
b){a&&org.antlr.lang.isValue(b)&&a.addChild(b)},becomeRoot:function(a,b){if(a instanceof org.antlr.runtime.CommonToken||!a)a=this.create(a);var c=a;if(!b)return a;if(c.isNil()){if(1<c.getChildCount())throw Error("more than one node as root (TODO: make exception hierarchy)");c=c.getChild(0)}c.addChild(b);return c},rulePostProcessing:function(a){a&&a.isNil()&&(0===a.getChildCount()?a=null:1===a.getChildCount()&&(a=a.getChild(0),a.setParent(null),a.setChildIndex(-1)));return a},create:function(a,b){var c;
if(2===arguments.length)return org.antlr.lang.isString(arguments[1])?(c=arguments[1],b=this.createToken(a,c)):(b=this.createToken(b),b.setType(a)),c=this.create(b);if(3===arguments.length)return c=arguments[2],b=this.createToken(b),b.setType(a),b.setText(c),c=this.create(b)},getType:function(a){a.getType();return 0},setType:function(){throw Error("don't know enough about Tree node");},getText:function(a){return a.getText()},setText:function(){throw Error("don't know enough about Tree node");},getChild:function(a,
b){return a.getChild(b)},setChild:function(a,b,c){a.setChild(b,c)},deleteChild:function(a,b){return a.deleteChild(b)},getChildCount:function(a){return a.getChildCount()},getUniqueID:function(a){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var b=this.treeToUniqueIDMap[a];if(org.antlr.lang.isValue(b))return b;b=this.uniqueNodeID;this.treeToUniqueIDMap[a]=b;this.uniqueNodeID++;return b}};org.antlr.runtime.tree.CommonTreeAdaptor=function(){};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(a){return!org.antlr.lang.isValue(a)?null:a.dupNode()},create:function(a){return 1<arguments.length?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(a)},createToken:function(a){return 2===arguments.length?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},
setTokenBoundaries:function(a,b,c){if(org.antlr.lang.isValue(a)){var d=0,e=0;org.antlr.lang.isValue(b)&&(d=b.getTokenIndex?b.getTokenIndex():b.getStartIndex?b.getStartIndex():b.getTokenStartIndex());org.antlr.lang.isValue(c)&&(e=e.getTokenIndex?c.getTokenIndex():c.getStopIndex?c.getStopIndex():c.getTokenStopIndex());a.setTokenStartIndex(d);a.setTokenStopIndex(e)}},getTokenStartIndex:function(a){return!a?-1:a.getTokenStartIndex()},getTokenStopIndex:function(a){return!a?-1:a.getTokenStopIndex()},getText:function(a){return!a?
null:a.getText()},getType:function(a){return!a?org.antlr.runtime.Token.INVALID_TOKEN_TYPE:a.getType()},getToken:function(a){return a instanceof org.antlr.runtime.tree.CommonTree?a.getToken():null},getChild:function(a,b){return!a?null:a.getChild(b)},getChildCount:function(a){return!a?0:a.getChildCount()},getParent:function(a){return a.getParent()},setParent:function(a,b){a.setParent(b)},getChildIndex:function(a){return a.getChildIndex()},setChildIndex:function(a,b){a.setChildIndex(b)},replaceChildren:function(a,
b,c,d){a&&a.replaceChildren(b,c,d)}});org.antlr.runtime.ANTLRStringStream=function(a){this.p=0;this.line=1;this.markDepth=this.charPositionInLine=0;this.lastMarker=this.markers=null;this.data=a;this.n=a.length};
org.antlr.runtime.ANTLRStringStream.prototype={reset:function(){this.p=0;this.line=1;this.markDepth=this.charPositionInLine=0},consume:function(){this.p<this.n&&(this.charPositionInLine++,"\n"===this.data.charAt(this.p)&&(this.line++,this.charPositionInLine=0),this.p++)},LA:function(a){0>a&&a++;a=this.p+a-1;return a>=this.n||0>a?org.antlr.runtime.CharStream.EOF:this.data.charAt(a)},index:function(){return this.p},size:function(){return this.n},mark:function(){this.markers||(this.markers=[],this.markers.push(null));
this.markDepth++;var a=null;this.markDepth>=this.markers.length?(a={},this.markers.push(a)):a=this.markers[this.markDepth];a.p=this.p;a.line=this.line;a.charPositionInLine=this.charPositionInLine;return this.lastMarker=this.markDepth},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);var b=this.markers[a];this.seek(b.p);this.line=b.line;this.charPositionInLine=b.charPositionInLine;this.release(a)},release:function(a){this.markDepth=a;this.markDepth--},seek:function(a){if(a<=this.p)this.p=
a;else for(;this.p<a;)this.consume()},substring:function(a,b){return this.data.substr(a,b-a+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(a){this.line=a},setCharPositionInLine:function(a){this.charPositionInLine=a},getSourceName:function(){return null}};org.antlr.runtime.ANTLRStringStream.LT=org.antlr.runtime.ANTLRStringStream.LA;
org.antlr.runtime.CommonTokenStream=function(a,b){this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.v_discardOffChannelTokens=!1;this.tokens=[];2<=arguments.length?this.channel=b:1===arguments.length&&(this.tokenSource=a)};
org.antlr.runtime.CommonTokenStream.prototype={setTokenSource:function(a){this.tokenSource=a;this.tokens=[];this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var a=0,b=this.tokenSource.nextToken(),c,d;org.antlr.lang.isValue(b)&&b.getType()!=org.antlr.runtime.CharStream.EOF;)c=!1,this.channelOverrideMap&&(d=this.channelOverrideMap[b.getType()],org.antlr.lang.isValue(d)&&b.setChannel(d)),this.discardSet&&this.discardSet[b.getType()]?c=!0:this.v_discardOffChannelTokens&&
b.getChannel()!=this.channel&&(c=!0),c||(b.setTokenIndex(a),this.tokens.push(b),a++),b=this.tokenSource.nextToken();this.p=0;this.p=this.skipOffTokenChannels(this.p)},consume:function(){this.p<this.tokens.length&&(this.p++,this.p=this.skipOffTokenChannels(this.p))},skipOffTokenChannels:function(a){for(var b=this.tokens.length;a<b&&this.tokens[a].getChannel()!=this.channel;)a++;return a},skipOffTokenChannelsReverse:function(a){for(;0<=a&&this.tokens[a].getChannel()!=this.channel;)a--;return a},setTokenTypeChannel:function(a,
b){this.channelOverrideMap||(this.channelOverrideMap={});this.channelOverrideMap[a]=b},discardTokenType:function(a){this.discardSet||(this.discardSet={});this.discardSet[a]=!0},discardOffChannelTokens:function(a){this.v_discardOffChannelTokens=a},getTokens:function(a,b,c){-1===this.p&&this.fillBuffer();if(0===arguments.length)return this.tokens;org.antlr.lang.isArray(c)?c=new org.antlr.runtime.BitSet(c):org.antlr.lang.isNumber(c)&&(c=org.antlr.runtime.BitSet.of(c));b>=this.tokens.length&&(b=this.tokens.length-
1);0>a&&(a=0);if(a>b)return null;var d=[],e,f;for(e=a;e<=b;e++)f=this.tokens[e],(!this.types||c.member(f.getType()))&&d.push(f);0===d.length&&(d=null);return d},LT:function(a){-1===this.p&&this.fillBuffer();if(0===a)return null;if(0>a)return this.LB(-1*a);if(this.p+a-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var b=this.p,c=1;c<a;)b=this.skipOffTokenChannels(b+1),c++;return b>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[b]},LB:function(a){-1===this.p&&
this.fillBuffer();if(0===a||0>this.p-a)return null;for(var b=this.p,c=1;c<=a;)b=this.skipOffTokenChannelsReverse(b-1),c++;return 0>b?null:this.tokens[b]},get:function(a){return this.tokens[a]},LA:function(a){return this.LT(a).getType()},mark:function(){-1===this.p&&this.fillBuffer();return this.lastMarker=this.index()},release:function(){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);this.seek(a)},reset:function(){this.p=
-1;this.lastMarker=0},seek:function(a){this.p=a},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(a,b){0===arguments.length&&(-1===this.p&&this.fillBuffer(),a=0,b=this.tokens.length-1);if(!org.antlr.lang.isNumber(a)&&!org.antlr.lang.isNumber(b))if(org.antlr.lang.isValue(a)&&org.antlr.lang.isValue(b))a=a.getTokenIndex(),b=b.getTokenIndex();else return null;var c="",d;if(0>a||0>b)return null;-1==this.p&&this.fillBuffer();
b>=this.tokens.length&&(b=this.tokens.length-1);for(d=a;d<=b;d++)t=this.tokens[d],c+=this.tokens[d].getText();return c}};org.antlr.runtime.TokenRewriteStream=function(){var a=org.antlr.runtime.TokenRewriteStream.superclass;this.lastRewriteTokenIndexes=this.programs=null;0!==arguments.length&&a.constructor.apply(this,arguments);this.init()};
(function(){var a=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(a,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0});a.RewriteOperation=function(a,c){this.index=a;this.text=c};a.RewriteOperation.prototype={execute:function(){return this.index},toString:function(){return this.text}};a.InsertBeforeOp=function(b,c){a.InsertBeforeOp.superclass.constructor.call(this,b,c)};org.antlr.lang.extend(a.InsertBeforeOp,a.RewriteOperation,{execute:function(a){a.push(this.text);
return this.index}});a.ReplaceOp=function(b,c,d){a.ReplaceOp.superclass.constructor.call(this,b,d);this.lastIndex=c};org.antlr.lang.extend(a.ReplaceOp,a.RewriteOperation,{execute:function(a){org.antlr.lang.isValue(this.text)&&a.push(this.text);return this.lastIndex+1}});a.DeleteOp=function(b,c){a.DeleteOp.superclass.constructor.call(this,b,c)};org.antlr.lang.extend(a.DeleteOp,a.ReplaceOp);org.antlr.lang.extend(a,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={};this.programs[a.DEFAULT_PROGRAM_NAME]=
[];this.lastRewriteTokenIndexes={}},rollback:function(){var b;1===arguments.length?b=a.DEFAULT_PROGRAM_NAME:2===arguments.length&&(b=arguments[0]);var c=this.programs[b];c&&(programs[b]=c.slice(a.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(b){b=b||a.DEFAULT_PROGRAM_NAME;this.rollback(b,a.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var b,c;1===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0]):2===arguments.length&&(b=arguments[0],c=arguments[1]);b=this.getProgram(b);
var d,e,f,g,h;for(e=0,d=b.length;e<d;e++)if(f=b[e],f.index===c.index){if(c instanceof a.ReplaceOp){f=!1;for(h=e;h<b.length;h++){g=b[e];if(g.index!==c.index)break;if(g instanceof a.ReplaceOp){b[e]=c;f=!0;break}}f||b.splice(h,0,c)}else b.splice(e,0,c);break}else if(f.index>c.index){b.splice(e,0,c);break}e===d&&b.push(c)},insertAfter:function(){var b,c,d;2===arguments.length?(c=a.DEFAULT_PROGRAM_NAME,b=arguments[0],d=arguments[1]):3===arguments.length&&(c=arguments[0],b=arguments[1],d=arguments[2]);
b instanceof org.antlr.runtime.CommonToken&&(b=b.index);this.insertBefore(c,b+1,d)},insertBefore:function(){var b,c,d;2===arguments.length?(c=a.DEFAULT_PROGRAM_NAME,b=arguments[0],d=arguments[1]):3===arguments.length&&(c=arguments[0],b=arguments[1],d=arguments[2]);b instanceof org.antlr.runtime.CommonToken&&(b=b.index);this.addToSortedRewriteList(c,new a.InsertBeforeOp(b,d))},replace:function(){var b,c,d,e;2===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[0],e=arguments[1]):
3===arguments.length&&(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[1],e=arguments[2]);4===arguments.length&&(b=arguments[0],c=arguments[1],d=arguments[2],e=arguments[3]);c instanceof org.antlr.runtime.CommonToken&&(c=c.index);d instanceof org.antlr.runtime.CommonToken&&(d=d.index);c>d||0>d||0>c||this.addToSortedRewriteList(b,new a.ReplaceOp(c,d,e))},remove:function(){for(var a=[],c=arguments.length-1;0<=c;)a[c]=arguments[c],c--;a.push("");this.replace.apply(this,a)},getLastRewriteTokenIndex:function(b){b=
b||a.DEFAULT_PROGRAM_NAME;return this.lastRewriteTokenIndexes[b]||-1},setLastRewriteTokenIndex:function(a,c){this.lastRewriteTokenIndexes[a]=c},getProgram:function(a){var c=this.programs[a];c||(c=this.initializeProgram(a));return c},initializeProgram:function(a){var c=[];return this.programs[a]=c},toOriginalString:function(b,c){org.antlr.lang.isNumber(b)||(b=a.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(c)||(c=this.size()-1);var d=[],e;for(e=b;e>=a.MIN_TOKEN_INDEX&&e<=c&&e<this.tokens.length;e++)d.push(this.get(e).getText());
return d.join("")},toString:function(){var b,c,d;0===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=a.MIN_TOKEN_INDEX,d=this.size()-1):1===arguments.length?(b=arguments[0],c=a.MIN_TOKEN_INDEX,d=this.size()-1):2===arguments.length&&(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[1]);b=this.programs[b];if(!b||0===b.length)return this.toOriginalString(c,d);var e=0,f=c;c=[];for(var g;f>=a.MIN_TOKEN_INDEX&&f<=d&&f<this.tokens.length;){if(e<b.length){for(g=b[e];g.index<f&&e<b.length;)e++,e<b.length&&
(g=b[e]);for(;f===g.index&&e<b.length;)f=g.execute(c),e++,e<b.length&&(g=b[e])}f<=d&&(c.push(this.get(f).getText()),f++)}for(d=e;d<b.length;d++)g=b[d],g.index>=this.size()&&g.execute(c);return c.join("")},toDebugString:function(b,c){org.antlr.lang.isNumber(b)||(b=a.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(c)||(c=this.size()-1);var d=[],e;for(e=b;e>=a.MIN_TOKEN_INDEX&&e<=c&&e<this.tokens.length;e++)d.push(this.get(e));return d.join("")}})})();org.antlr.runtime.tree.TreeNodeStream=function(){};
org.antlr.runtime.tree.CommonTreeNodeStream=function(a,b,c){1===arguments.length&&(b=a,a=new org.antlr.runtime.tree.CommonTreeAdaptor);2>=arguments.length&&(c=org.antlr.runtime.tree.CommonTreeNodeStream.DEFAULT_INITIAL_BUFFER_SIZE);this.uniqueNavigationNodes=!1;this.p=-1;var d=org.antlr.runtime.Token;this.root=b;this.adaptor=a;this.nodes=[];this.down=this.adaptor.create(d.DOWN,"DOWN");this.up=this.adaptor.create(d.UP,"UP");this.eof=this.adaptor.create(d.EOF,"EOF")};
org.antlr.lang.augmentObject(org.antlr.runtime.tree.CommonTreeNodeStream,{DEFAULT_INITIAL_BUFFER_SIZE:100,INITIAL_CALL_STACK_SIZE:10});
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeNodeStream,org.antlr.runtime.tree.TreeNodeStream,{StreamIterator:function(){var a=0,b=this.nodes,c=this.eof;return{hasNext:function(){return a<b.length},next:function(){var d=a;a++;return d<b.length?b[d]:c},remove:function(){throw Error("cannot remove nodes from stream");}}},fillBuffer:function(a){var b=!1;org.antlr.lang.isUndefined(a)&&(a=this.root,b=!0);var c=this.adaptor.isNil(a);c||this.nodes.push(a);var d=this.adaptor.getChildCount(a);!c&&
0<d&&this.addNavigationNode(org.antlr.runtime.Token.DOWN);var e,f;for(e=0;e<d;e++)f=this.adaptor.getChild(a,e),this.fillBuffer(f);!c&&0<d&&this.addNavigationNode(org.antlr.runtime.Token.UP);b&&(this.p=0)},getNodeIndex:function(a){-1==this.p&&this.fillBuffer();var b,c;for(b=0;b<this.nodes.length;b++)if(c=this.nodes[b],c===a)return b;return-1},addNavigationNode:function(a){var b=null,b=a===org.antlr.runtime.Token.DOWN?this.hasUniqueNavigationNodes()?this.adaptor.create(org.antlr.runtime.Token.DOWN,
"DOWN"):this.down:this.hasUniqueNavigationNodes()?this.adaptor.create(org.antlr.runtime.Token.UP,"UP"):this.up;this.nodes.push(b)},get:function(a){-1===this.p&&this.fillBuffer();return this.nodes[a]},LT:function(a){-1===this.p&&this.fillBuffer();return 0===a?null:0>a?this.LB(-1*a):this.p+a-1>=this.nodes.length?this.eof:this.nodes[this.p+a-1]},getCurrentSymbol:function(){return this.LT(1)},LB:function(a){return 0===a||0>this.p-a?null:this.nodes[this.p-a]},getTreeSource:function(){return this.root},
getSourceName:function(){return this.getTokenStream().getSourceName()},getTokenStream:function(){return this.tokens},setTokenStream:function(a){this.tokens=a},getTreeAdaptor:function(){return this.adaptor},setTreeAdaptor:function(a){this.adaptor=a},hasUniqueNavigationNodes:function(){return this.uniqueNavigationNodes},setUniqueNavigationNodes:function(a){this.uniqueNavigationNodes=a},consume:function(){-1===this.p&&this.fillBuffer();this.p++},LA:function(a){return this.adaptor.getType(this.LT(a))},
mark:function(){-1===this.p&&this.fillBuffer();return this.lastMarker=this.index()},release:function(){},index:function(){return this.p},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);this.seek(a)},seek:function(a){-1===this.p&&this.fillBuffer();this.p=a},push:function(a){this.calls||(this.calls=[]);this.calls.push(this.p);this.seek(a)},pop:function(){var a=this.calls.pop();this.seek(a);return a},reset:function(){this.p=-1;this.lastMarker=0;this.calls&&(this.calls=[])},size:function(){-1===
this.p&&this.fillBuffer();return this.nodes.length},iterator:function(){-1===this.p&&this.fillBuffer();return this.StreamIterator()},replaceChildren:function(a,b,c,d){a&&this.adaptor.replaceChildren(a,b,c,d)},toTokenString:function(a,b){-1===this.p&&this.fillBuffer();var c="",d,e;for(d=a;d<this.nodes.length&&d<=b;d++)e=this.nodes[d],c+=" "+this.adaptor.getToken(e);return c},toString:function(a,b){var c="",d,e,f;if(0===arguments.length){-1===this.p&&this.fillBuffer();for(f=0;f<this.nodes.length;f++)e=
this.nodes[f],c+=" ",c+=this.adaptor.getType(e)}else{if(!org.antlr.lang.isNumber(a)||!org.antlr.lang.isNumber(b))return null;-1===this.p&&this.fillBuffer();if(this.tokens)return c=this.adaptor.getTokenStartIndex(a),d=this.adaptor.getTokenStopIndex(b),this.adaptor.getType(b)===org.antlr.runtime.Token.UP?d=this.adaptor.getTokenStopIndex(a):this.adaptor.getType(b)==org.antlr.runtime.Token.EOF&&(d=this.size()-2),this.tokens.toString(c,d);for(f=0;f<this.nodes.length&&!(e=this.nodes[f],e===a);f++);c="";
for(e=this.nodes[f];e!==b;)d=this.adaptor.getText(e),org.antlr.lang.isString(d)||(d=" "+this.adaptor.getType(e).toString()),c+=d,f++,e=nodes[f];d=this.adaptor.getText(b);org.antlr.lang.isString(d)||(d=" "+this.adaptor.getType(b).toString());c+=d}return c}});org.antlr.runtime.tree.RewriteRuleElementStream=function(a,b,c){this.cursor=0;this.dirty=!1;this.elementDescription=b;this.adaptor=a;c&&(org.antlr.lang.isArray(c)?(this.singleElement=null,this.elements=c):this.add(c))};
org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0;this.dirty=!0},add:function(a){org.antlr.lang.isValue(a)&&(this.elements?this.elements.push(a):org.antlr.lang.isValue(this.singleElement)?(this.elements=[],this.elements.push(this.singleElement),this.singleElement=null,this.elements.push(a)):this.singleElement=a)},nextTree:function(){var a=this.size();return this.dirty||this.cursor>=a&&1==a?(a=this._next(),this.dup(a)):a=this._next()},_next:function(){var a=
this.size();if(0===a)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=a){if(1===a)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription);}if(org.antlr.lang.isValue(this.singleElement))return this.cursor++,this.toTree(this.singleElement);a=this.toTree(this.elements[this.cursor]);this.cursor++;return a},toTree:function(a){return a&&a.getTree?a.getTree():a},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&
1>this.cursor||this.elements&&this.cursor<this.elements.length},size:function(){var a=0;org.antlr.lang.isValue(this.singleElement)&&(a=1);return this.elements?this.elements.length:a},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleNodeStream=function(a,b,c){org.antlr.runtime.tree.RewriteRuleNodeStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleNodeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this._next()},toTree:function(a){return this.adaptor.dupNode(a)},dup:function(){throw Error("dup can't be called for a node stream.");}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(a,b,c){org.antlr.runtime.tree.RewriteRuleTokenStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this.adaptor.create(this._next())},nextToken:function(){return this._next()},toTree:function(a){return a},dup:function(){throw Error("dup can't be called for a token stream.");}});org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var a=this.size();return this.dirty||this.cursor>=a&&1===a?(a=this._next(),this.adaptor.dupNode(a)):a=this._next()},dup:function(a){return this.adaptor.dupTree(a)}});org.antlr.runtime.BaseRecognizer=function(a){this.state=a||new org.antlr.runtime.RecognizerSharedState};
org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});
org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var a,b;if(this.state&&(this.state._fsp=-1,this.state.errorRecovery=!1,this.state.lastErrorIndex=-1,this.state.failed=!1,this.state.syntaxErrors=0,this.state.backtracking=0,this.state.ruleMemo))for(a=0,b=this.state.ruleMemo.length;a<b;a++)this.state.ruleMemo[a]=null},match:function(a,b,c){var d=this.getCurrentInputSymbol(a);if(a.LA(1)===b)return a.consume(),this.state.errorRecovery=!1,this.state.failed=!1,d;return 0<this.state.backtracking?
(this.state.failed=!0,d):d=this.recoverFromMismatchedToken(a,b,c)},matchAny:function(a){this.state.errorRecovery=!1;this.state.failed=!1;a.consume()},mismatchIsUnwantedToken:function(a,b){return a.LA(2)===b},mismatchIsMissingToken:function(a,b){if(!b)return!1;b.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)&&(0<=this.state._fsp&&b.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE),this.computeContextSensitiveRuleFOLLOW(),b=b.or(this.viableTokensFollowingThisRule));return b.member(a.LA(1))||b.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)?
!0:!1},mismatch:function(a,b,c){if(this.mismatchIsUnwantedToken(a,b))throw new org.antlr.runtime.UnwantedTokenException(b,a);if(this.mismatchIsMissingToken(a,c))throw new org.antlr.runtime.MissingTokenException(b,a,null);throw new org.antlr.runtime.MismatchedTokenException(b,a);},reportError:function(a){this.state.errorRecovery||(this.state.syntaxErrors++,this.state.errorRecovery=!0,this.displayRecognitionError(this.getTokenNames(),a))},displayRecognitionError:function(a,b){var c=this.getErrorHeader(b),
d=this.getErrorMessage(b,a);this.emitErrorMessage(c+" "+d)},getErrorHeader:function(a){org.antlr.lang.isNumber(a.line)||(a.line=0);return"line "+a.line+":"+a.charPositionInLine},emitErrorMessage:function(a){if("undefined"!=typeof window&&window.alert)throw a;print(a)},getErrorMessage:function(a,b){var c=a&&a.getMessage?a.getMessage():null;a instanceof org.antlr.runtime.UnwantedTokenException?(c=a.expecting==org.antlr.runtime.Token.EOF?"EOF":b[a.expecting],c="extraneous input "+this.getTokenErrorDisplay(a.getUnexpectedToken())+
" expecting "+c):a instanceof org.antlr.runtime.MissingTokenException?(c=a,c=c.expecting==org.antlr.runtime.Token.EOF?"EOF":b[c.expecting],c="missing "+c+" at "+this.getTokenErrorDisplay(a.token)):a instanceof org.antlr.runtime.MismatchedTokenException?(c=a,c=c.expecting==org.antlr.runtime.Token.EOF?"EOF":b[c.expecting],c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting "+c):a instanceof org.antlr.runtime.NoViableAltException?c="no viable alternative at input "+this.getTokenErrorDisplay(a.token):
a instanceof org.antlr.runtime.EarlyExitException?c="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(a.token):a instanceof org.antlr.runtime.MismatchedSetException?c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedNotSetException?c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.FailedPredicateException&&(c="rule "+a.ruleName+
" failed predicate: {"+a.predicateText+"}?");return c},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(a){var b=a.getText();org.antlr.lang.isValue(b)||(b=a.getType()==org.antlr.runtime.Token.EOF?"<EOF>":"<"+a.getType()+">");b=b.replace(/\n/g,"\\n");b=b.replace(/\r/g,"\\r");b=b.replace(/\t/g,"\\t");return"'"+b+"'"},recover:function(a){this.state.lastErrorIndex==a.index()&&a.consume();this.state.lastErrorIndex=a.index();var b=this.computeErrorRecoverySet();
this.beginResync();this.consumeUntil(a,b);this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(a){for(var b=this.state._fsp,c,d=new org.antlr.runtime.BitSet;0<=b;b--)if(c=this.state.following[b],d.orInPlace(c),a)if(c.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))0<b&&d.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE);else break;
return d},recoverFromMismatchedToken:function(a,b,c){var d=null;if(this.mismatchIsUnwantedToken(a,b))return d=new org.antlr.runtime.UnwantedTokenException(b,a),this.beginResync(),a.consume(),this.endResync(),this.reportError(d),b=this.getCurrentInputSymbol(a),a.consume(),b;if(this.mismatchIsMissingToken(a,c))return c=this.getMissingSymbol(a,d,b,c),d=new org.antlr.runtime.MissingTokenException(b,a,c),this.reportError(d),c;d=new org.antlr.runtime.MismatchedTokenException(b,a);throw d;},recoverFromMismatchedSet:function(a,
b,c){if(this.mismatchIsMissingToken(a,c))return this.reportError(b),this.getMissingSymbol(a,b,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,c);throw b;},getCurrentInputSymbol:function(){return null},getMissingSymbol:function(){return null},consumeUntil:function(a,b){for(var c=a.LA(1);c!=org.antlr.runtime.Token.EOF&&!b.member(c);)a.consume(),c=a.LA(1)},pushFollow:function(a){if(this.state._fsp+1>=this.state.following.length){var b=[],c;for(c=this.state.following.length-1;0<=c;c--)b[c]=this.state.following[c];
this.state.following=b}this.state._fsp++;this.state.following[this.state._fsp]=a},getRuleInvocationStack:function(){throw Error("Not implemented.");},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(a){if(!a)return null;var b=[],c;for(c=0;c<a.length;c++)b.push(a[c].getText());return b},getRuleMemoization:function(a,b){this.state.ruleMemo[a]||(this.state.ruleMemo[a]={});var c=this.state.ruleMemo[a][b];
return!org.antlr.lang.isNumber(c)?org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN:c},alreadyParsedRule:function(a,b){var c=this.getRuleMemoization(b,a.index());if(c==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN)return!1;c==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:a.seek(c+1);return!0},memoize:function(a,b,c){a=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:a.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw Error("!!!!!!!!! memo array is null for "+
this.getGrammarFileName());if(b>=this.state.ruleMemo.length)throw Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+b);org.antlr.lang.isValue(this.state.ruleMemo[b])&&(this.state.ruleMemo[b][c]=a)},getRuleMemoizationCacheSize:function(){var a=0,b;for(b=0;this.state.ruleMemo&&b<this.state.ruleMemo.length;b++){var c=this.state.ruleMemo[b];c&&(a+=c.length)}return a},traceIn:function(a,b,c){this.emitErrorMessage("enter "+a+" "+c);this.state.failed&&this.emitErrorMessage(" failed="+
this.failed);0<this.state.backtracking&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(a,b,c){this.emitErrorMessage("exit "+a+" "+c);this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed);0<this.state.backtracking&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(a,b){b&&org.antlr.runtime.Lexer.superclass.constructor.call(this,b);a&&(this.input=a)};
org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0);org.antlr.lang.isValue(this.state)&&(this.state.token=null,this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=-1,this.state.tokenStartCharPositionInLine=-1,this.state.tokenStartLine=-1,this.state.text=
null)},nextToken:function(){for(;;){this.state.token=null;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=this.input.index();this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine();this.state.tokenStartLine=this.input.getLine();this.state.text=null;if(this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{this.mTokens();if(org.antlr.lang.isValue(this.state.token)){if(this.state.token==org.antlr.runtime.Token.SKIP_TOKEN)continue}else this.emit();
return this.state.token}catch(a){if(a instanceof org.antlr.runtime.RecognitionException)this.reportError(a);else if(a instanceof org.antlr.runtime.NoViableAltException)this.reportError(a),this.recover(a);else throw a;}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(a){this.input=null;this.reset();this.input=a},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},emit:function(){if(0===arguments.length){var a=
new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);a.setLine(this.state.tokenStartLine);a.setText(this.state.text);a.setCharPositionInLine(this.state.tokenStartCharPositionInLine);return this.state.token=a}this.state.token=arguments[0]},match:function(a){var b=0;if(org.antlr.lang.isString(a))for(;b<a.length;){if(this.input.LA(1)!=a.charAt(b)){if(0<this.state.backtracking){this.state.failed=!0;break}a=new org.antlr.runtime.MismatchedTokenException(a.charAt(b),
this.input);this.recover(a);throw a;}b++;this.input.consume();this.state.failed=!1}else if(org.antlr.lang.isNumber(a)){if(this.input.LA(1)!=a){if(0<this.state.backtracking){this.state.failed=!0;return}a=new org.antlr.runtime.MismatchedTokenException(a,this.input);this.recover(a);throw a;}this.input.consume();this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(a,b){if(this.input.LA(1)<a||this.input.LA(1)>b){if(0<this.state.backtracking){this.state.failed=!0;return}mre=
new org.antlr.runtime.MismatchedRangeException(a,b,this.input);this.recover(mre);throw mre;}this.input.consume();this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,this.getCharIndex()-1)},setText:function(a){this.state.text=
a},reportError:function(a){this.displayRecognitionError(this.getTokenNames(),a)},getErrorMessage:function(a,b){var c=null;return c=a instanceof org.antlr.runtime.MismatchedTokenException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting "+this.getCharErrorDisplay(a.expecting):a instanceof org.antlr.runtime.NoViableAltException?"no viable alternative at character "+this.getCharErrorDisplay(a.c):a instanceof org.antlr.runtime.EarlyExitException?"required (...)+ loop did not match anything at character "+
this.getCharErrorDisplay(a.c):a instanceof org.antlr.runtime.MismatchedNotSetException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedSetException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedRangeException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+this.getCharErrorDisplay(a.a)+".."+this.getCharErrorDisplay(a.b):
org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,a,b)},getCharErrorDisplay:function(a){switch(a){case org.antlr.runtime.Token.EOF:a="<EOF>";break;case "\n":a="\\n";break;case "\t":a="\\t";break;case "\r":a="\\r"}return"'"+a+"'"},recover:function(){this.input.consume()},traceIn:function(a,b){var c=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,a,b,c)},traceOut:function(a,b){var c=String.fromCharCode(this.input.LT(1))+
" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,a,b,c)}});org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.ParserRuleReturnScope.prototype={getStart:function(){return this.start},getStop:function(){return this.stop}};org.antlr.runtime.tree.TreeRuleReturnScope=function(){};org.antlr.runtime.tree.TreeRuleReturnScope.prototype={getStart:function(){return this.start}};
org.antlr.runtime.Parser=function(a,b){org.antlr.runtime.Parser.superclass.constructor.call(this,b);this.setTokenStream(a)};
org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(a){return a.LT(1)},getMissingSymbol:function(a,b,c){var b="<missing "+this.getTokenNames()[c]+">",c=new org.antlr.runtime.CommonToken(c,b),b=a.LT(1),d;b.getType()===org.antlr.runtime.Token.EOF&&(d=b,(b=a.LT(-1))||(b=d));c.line=b.getLine();c.charPositionInLine=b.getCharPositionInLine();
c.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;return c},setTokenStream:function(a){this.input=null;this.reset();this.input=a},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(a,b){org.antlr.runtime.Parser.superclass.traceIn.call(this,a,b,this.input.LT(1))},traceOut:function(a,b){org.antlr.runtime.Parser.superclass.traceOut.call(this,a,b,this.input.LT(1))}});org.antlr.runtime.DFA=function(){};
org.antlr.runtime.DFA.prototype={predict:function(a){var b=a.mark(),c=0,d,e,f;try{for(;;)if(d=this.special[c],0<=d){c=this.specialStateTransition(d,a);if(-1===c)return this.noViableAlt(c,a),0;a.consume()}else{if(1<=this.accept[c])return this.accept[c];e=a.LA(1);e===org.antlr.runtime.Token.EOF?e=-1:org.antlr.lang.isString(e)&&(e=e.charCodeAt(0));if(e>=this.min[c]&&e<=this.max[c]){f=this.transition[c][e-this.min[c]];if(0>f){if(0<=this.eot[c]){c=this.eot[c];a.consume();continue}this.noViableAlt(c,a);
return 0}c=f;a.consume()}else if(0<=this.eot[c])c=this.eot[c],a.consume();else{if(e==org.antlr.runtime.Token.EOF&&0<=this.eof[c])return this.accept[this.eof[c]];this.noViableAlt(c,a);return 0}}}finally{a.rewind(b)}},noViableAlt:function(a,b){if(0<this.recognizer.state.backtracking)this.recognizer.state.failed=!0;else{var c=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,a,b);this.error(c);throw c;}},error:function(){},specialStateTransition:function(){return-1},
getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(a){var b,c=[],d=0,e,f,g;for(b=0;b<a.length;b+=2){e=a.charCodeAt(b);f=a.charCodeAt(b+1);65535===f&&(f=-1);for(g=1;g<=e;g++)c[d++]=f}return c},unpackEncodedStringToUnsignedChars:function(a){return org.antlr.runtime.DFA.unpackEncodedString(a)}});org.antlr.runtime.tree.TreeParser=function(a,b){org.antlr.runtime.tree.TreeParser.superclass.constructor.call(this,b);this.setTreeNodeStream(a)};
(function(){var a=org.antlr.runtime.tree.TreeParser;org.antlr.lang.augmentObject(a,{DOWN:org.antlr.runtime.Token.DOWN,UP:org.antlr.runtime.Token.UP});org.antlr.lang.extend(a,org.antlr.runtime.BaseRecognizer,{reset:function(){a.superclass.reset.call(this);this.input&&this.input.seek(0)},setTreeNodeStream:function(a){this.input=a},getTreeNodeStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},getCurrentInputSymbol:function(a){return a.LT(1)},getMissingSymbol:function(a,
c,d){a="<missing "+this.getTokenNames()[d]+">";return new org.antlr.runtime.tree.CommonTree(new org.antlr.runtime.CommonToken(d,a))},matchAny:function(){this.state.errorRecovery=!1;this.state.failed=!1;var b=this.input.LT(1);if(0!==this.input.getTreeAdaptor().getChildCount(b))for(var c=0,b=this.input.getTreeAdaptor().getType(b);b!==org.antlr.runtime.Token.EOF&&!(b===a.UP&&0===c);)this.input.consume(),b=this.input.LT(1),b=this.input.getTreeAdaptor().getType(b),b===a.DOWN?c++:b===a.UP&&c--;this.input.consume()},
mismatch:function(a,c){throw new org.antlr.runtime.MismatchedTreeNodeException(c,a);},getErrorHeader:function(a){return this.getGrammarFileName()+": node from "+(a.approximateLineInfo?"after ":"")+"line "+a.line+":"+a.charPositionInLine},getErrorMessage:function(b,c){var d;this instanceof a&&(d=b.input.getTreeAdaptor(),b.token=d.getToken(b.node),org.antlr.lang.isValue(b.token)||(b.token=new org.antlr.runtime.CommonToken(d.getType(b.node),d.getText(b.node))));return a.superclass.getErrorMessage.call(this,
b,c)},traceIn:function(b,c){a.superclass.traceIn.call(this,b,c,this.input.LT(1))},traceOut:function(b,c){a.superclass.traceOut.call(this,b,c,this.input.LT(1))}})})();var FormulaLexer=function(a,b){b||(b=new org.antlr.runtime.RecognizerSharedState);this.dfa31=new FormulaLexer.DFA31(this);FormulaLexer.superclass.constructor.call(this,a,b)};
org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__92:92,T__93:93,T__94:94,T__95:95,T__96:96,T__97:97,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,NUMBER:21,NEWLINE:22,W:23,H:24,I:25,L:26,E:27,WHILESTATEMENT:28,F:29,O:30,R:31,FORSTATEMENT:32,M:33,FROMSTATEMENT:34,N:35,INSTATEMENT:36,T:37,TOSTATEMENT:38,B:39,Y:40,BYSTATEMENT:41,P:42,LOOPSTATEMENT:43,IFSTATEMENT:44,THENSTATEMENT:45,
S:46,ELSESTATEMENT:47,U:48,C:49,FUNCTIONSTATEMENT:50,D:51,ENDBLOCK:52,RETURNSTATEMENT:53,IDENT:54,EQUALS:55,PRIMITIVE:56,OR:57,AND:58,A:59,NOTEQUALS:60,LT:61,LTEQ:62,GT:63,GTEQ:64,PLUS:65,MINUS:66,MULT:67,DIV:68,MOD:69,POW:70,NOT:71,LARR:72,RARR:73,INTEGER:74,FLOAT:75,TRUE:76,FALSE:77,PER:78,CUBED:79,SQUARED:80,Q:81,COMMENT:82,LINE_COMMENT:83,WS:84,G:85,J:86,K:87,V:88,X:89,Z:90,STRING:91});
(function(){var a=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__92:92,T__93:93,T__94:94,T__95:95,T__96:96,T__97:97,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,NUMBER:21,NEWLINE:22,W:23,H:24,I:25,L:26,E:27,WHILESTATEMENT:28,F:29,O:30,R:31,FORSTATEMENT:32,M:33,FROMSTATEMENT:34,N:35,INSTATEMENT:36,T:37,TOSTATEMENT:38,
B:39,Y:40,BYSTATEMENT:41,P:42,LOOPSTATEMENT:43,IFSTATEMENT:44,THENSTATEMENT:45,S:46,ELSESTATEMENT:47,U:48,C:49,FUNCTIONSTATEMENT:50,D:51,ENDBLOCK:52,RETURNSTATEMENT:53,IDENT:54,EQUALS:55,PRIMITIVE:56,OR:57,AND:58,A:59,NOTEQUALS:60,LT:61,LTEQ:62,GT:63,GTEQ:64,PLUS:65,MINUS:66,MULT:67,DIV:68,MOD:69,POW:70,NOT:71,LARR:72,RARR:73,INTEGER:74,FLOAT:75,TRUE:76,FALSE:77,PER:78,CUBED:79,SQUARED:80,Q:81,COMMENT:82,LINE_COMMENT:83,WS:84,G:85,J:86,K:87,V:88,X:89,Z:90,STRING:91,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});
org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__92:function(){var a=this.T__92,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("(");this.state.type=a;this.state.channel=c},mT__93:function(){var a=this.T__93,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(",");this.state.type=a;this.state.channel=c},mT__94:function(){var a=this.T__94,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")");this.state.type=a;this.state.channel=c},mT__95:function(){var a=
this.T__95,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-");this.state.type=a;this.state.channel=c},mT__96:function(){var a=this.T__96,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{");this.state.type=a;this.state.channel=c},mT__97:function(){var a=this.T__97,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}");this.state.type=a;this.state.channel=c},mNEWLINE:function(){var a=this.NEWLINE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,
d=2;"\r"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("\r")}this.match("\n");this.state.type=a;this.state.channel=c},mWHILESTATEMENT:function(){var a=this.WHILESTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW();this.mH();this.mI();this.mL();this.mE();this.state.type=a;this.state.channel=c},mFORSTATEMENT:function(){var a=this.FORSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mO();this.mR();this.state.type=a;this.state.channel=c},
mFROMSTATEMENT:function(){var a=this.FROMSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mR();this.mO();this.mM();this.state.type=a;this.state.channel=c},mINSTATEMENT:function(){var a=this.INSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mN();this.state.type=a;this.state.channel=c},mTOSTATEMENT:function(){var a=this.TOSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mO();this.state.type=a;this.state.channel=
c},mBYSTATEMENT:function(){var a=this.BYSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB();this.mY();this.state.type=a;this.state.channel=c},mLOOPSTATEMENT:function(){var a=this.LOOPSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL();this.mO();this.mO();this.mP();this.state.type=a;this.state.channel=c},mIFSTATEMENT:function(){var a=this.IFSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mF();this.state.type=a;this.state.channel=
c},mTHENSTATEMENT:function(){var a=this.THENSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mE();this.mN();this.state.type=a;this.state.channel=c},mELSESTATEMENT:function(){var a=this.ELSESTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mL();this.mS();this.mE();this.state.type=a;this.state.channel=c},mFUNCTIONSTATEMENT:function(){var a=this.FUNCTIONSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();
this.mU();this.mN();this.mC();this.mT();this.mI();this.mO();this.mN();this.state.type=a;this.state.channel=c},mENDBLOCK:function(){var a=this.ENDBLOCK,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mN();this.mD();this.state.type=a;this.state.channel=c},mRETURNSTATEMENT:function(){var a=this.RETURNSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR();this.mE();this.mT();this.mU();this.mR();this.mN();this.state.type=a;this.state.channel=c},mOR:function(){var a=
this.OR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("|"==d)d=1;else if("O"==d||"o"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",2,0,this.input);switch(d){case 1:this.match("||");break;case 2:this.mO(),this.mR()}this.state.type=a;this.state.channel=c},mAND:function(){var a=this.AND,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("&"==d)d=1;else if("A"==d||"a"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",
3,0,this.input);switch(d){case 1:this.match("&&");break;case 2:this.mA(),this.mN(),this.mD()}this.state.type=a;this.state.channel=c},mEQUALS:function(){var a=this.EQUALS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2;if("="==this.input.LA(1))d="="==this.input.LA(2)?2:1;else throw new org.antlr.runtime.NoViableAltException("",4,0,this.input);switch(d){case 1:this.match("=");break;case 2:this.match("==")}this.state.type=a;this.state.channel=c},mNOTEQUALS:function(){var a=this.NOTEQUALS,
c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("!"==d)d=1;else if("<"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",5,0,this.input);switch(d){case 1:this.match("!=");break;case 2:this.match("<>")}this.state.type=a;this.state.channel=c},mLT:function(){var a=this.LT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<");this.state.type=a;this.state.channel=c},mLTEQ:function(){var a=this.LTEQ,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;
this.match("<=");this.state.type=a;this.state.channel=c},mGT:function(){var a=this.GT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">");this.state.type=a;this.state.channel=c},mGTEQ:function(){var a=this.GTEQ,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">=");this.state.type=a;this.state.channel=c},mPLUS:function(){var a=this.PLUS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+");this.state.type=a;this.state.channel=c},mMINUS:function(){var a=
this.MINUS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-");this.state.type=a;this.state.channel=c},mMULT:function(){var a=this.MULT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*");this.state.type=a;this.state.channel=c},mDIV:function(){var a=this.DIV,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/");this.state.type=a;this.state.channel=c},mMOD:function(){var a=this.MOD,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,
d=2,d=this.input.LA(1);if("%"==d)d=1;else if("M"==d||"m"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",6,0,this.input);switch(d){case 1:this.match("%");break;case 2:this.mM(),this.mO(),this.mD()}this.state.type=a;this.state.channel=c},mPOW:function(){var a=this.POW,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^");this.state.type=a;this.state.channel=c},mNOT:function(){var a=this.NOT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);
if("!"==d)d=1;else if("N"==d||"n"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",7,0,this.input);switch(d){case 1:this.match("!");break;case 2:this.mN(),this.mO(),this.mT()}this.state.type=a;this.state.channel=c},mLARR:function(){var a=this.LARR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("\u00ab"==d)d=1;else if("<"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",8,0,this.input);switch(d){case 1:this.match("\u00ab");break;case 2:this.match("<<")}this.state.type=
a;this.state.channel=c},mRARR:function(){var a=this.RARR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("\u00bb"==d)d=1;else if(">"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",9,0,this.input);switch(d){case 1:this.match("\u00bb");break;case 2:this.match(">>")}this.state.type=a;this.state.channel=c},mINTEGER:function(){var a=this.INTEGER,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=0;a:do{var e=2,f=this.input.LA(1);"0"<=f&&"9">=
f&&(e=1);switch(e){case 1:this.matchRange("0","9");break;default:if(1<=d)break a;throw new org.antlr.runtime.EarlyExitException(10,this.input);}d++}while(1);d=2;"e"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("e");d=2;e=this.input.LA(1);if("+"==e||"-"==e)d=1;switch(d){case 1:if("+"==this.input.LA(1)||"-"==this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break}a:do switch(d=2,e=this.input.LA(1),"0"<=e&&"9">=
e&&(d=1),d){case 1:this.matchRange("0","9");break;default:break a}while(1)}this.state.type=a;this.state.channel=c},mFLOAT:function(){var a=this.FLOAT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;a:do{var d=2,e=this.input.LA(1);"0"<=e&&"9">=e&&(d=1);switch(d){case 1:this.matchRange("0","9");break;default:break a}}while(1);this.match(".");d=0;a:do{var e=2,f=this.input.LA(1);"0"<=f&&"9">=f&&(e=1);switch(e){case 1:this.matchRange("0","9");break;default:if(1<=d)break a;throw new org.antlr.runtime.EarlyExitException(15,
this.input);}d++}while(1);d=2;"e"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("e");d=2;e=this.input.LA(1);if("+"==e||"-"==e)d=1;switch(d){case 1:if("+"==this.input.LA(1)||"-"==this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break}a:do switch(d=2,e=this.input.LA(1),"0"<=e&&"9">=e&&(d=1),d){case 1:this.matchRange("0","9");break;default:break a}while(1)}this.state.type=a;this.state.channel=c},mTRUE:function(){var a=
this.TRUE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mU();this.mE();this.state.type=a;this.state.channel=c},mFALSE:function(){var a=this.FALSE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mA();this.mL();this.mS();this.mE();this.state.type=a;this.state.channel=c},mPER:function(){var a=this.PER,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP();this.mE();this.mR();this.state.type=a;this.state.channel=c},mSQUARED:function(){var a=
this.SQUARED,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS();this.mQ();this.mU();this.mA();this.mR();this.mE();this.mD();this.state.type=a;this.state.channel=c},mCUBED:function(){var a=this.CUBED,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mU();this.mB();this.mE();this.mD();this.state.type=a;this.state.channel=c},mIDENT:function(){var a=this.IDENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if("A"<=this.input.LA(1)&&"Z">=this.input.LA(1)||
"a"<=this.input.LA(1)&&"z">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;a:do{var d=2,e=this.input.LA(1);if("0"<=e&&"9">=e||"A"<=e&&"Z">=e||"_"==e||"a"<=e&&"z">=e)d=1;switch(d){case 1:if("0"<=this.input.LA(1)&&"9">=this.input.LA(1)||"A"<=this.input.LA(1)&&"Z">=this.input.LA(1)||"_"==this.input.LA(1)||"a"<=this.input.LA(1)&&"z">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,
this.input),this.recover(a),a;break;default:break a}}while(1);this.state.type=a;this.state.channel=c},mPRIMITIVE:function(){var a=this.PRIMITIVE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=3,d=this.input.LA(1);if("["==d)if(d=this.input.LA(2),"\x00"<=d&&"Z">=d||"\\"<=d&&"\uffff">=d)d=1;else if("["==d)d=2;else throw a=new org.antlr.runtime.NoViableAltException("",23,1,this.input),a;else if("<"==d)d=3;else throw a=new org.antlr.runtime.NoViableAltException("",23,0,this.input),a;switch(d){case 1:this.match("[");
if("\x00"<=this.input.LA(1)&&"Z">=this.input.LA(1)||"\\"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;a:do{var d=2,e=this.input.LA(1);if("]"==e)d=2;else if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.match("]");break;case 2:this.match("[");this.match("[");a:do{d=2;e=this.input.LA(1);if("]"==e)if(e=this.input.LA(2),
"]"==e)d=2;else{if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=e)d=1}else if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.match("]");this.match("]");break;case 3:this.match("<");this.mIDENT();a:do{d=6;switch(this.input.LA(1)){case "A":case "B":case "C":case "D":case "E":case "F":case "G":case "H":case "I":case "J":case "K":case "L":case "M":case "N":case "O":case "P":case "Q":case "R":case "S":case "T":case "U":case "V":case "W":case "X":case "Y":case "Z":case "a":case "b":case "c":case "d":case "e":case "f":case "g":case "h":case "i":case "j":case "k":case "l":case "m":case "n":case "o":case "p":case "q":case "r":case "s":case "t":case "u":case "v":case "w":case "x":case "y":case "z":d=
1;break;case " ":d=2;break;case "-":d=3;break;case "_":d=4;break;case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":d=5}switch(d){case 1:this.mIDENT();break;case 2:this.match(" ");break;case 3:this.match("-");break;case 4:this.match("_");break;case 5:this.mINTEGER();break;default:break a}}while(1);this.match(">")}this.state.type=a;this.state.channel=c},mCOMMENT:function(){var b=this.COMMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");
a:do{var c=2,d=this.input.LA(1);if("*"==d)if(d=this.input.LA(2),"/"==d)c=2;else{if("\x00"<=d&&".">=d||"0"<=d&&"\uffff">=d)c=1}else if("\x00"<=d&&")">=d||"+"<=d&&"\uffff">=d)c=1;switch(c){case 1:this.matchAny();break;default:break a}}while(1);this.match("*/");c=a;this.state.type=b;this.state.channel=c},mLINE_COMMENT:function(){var b=this.LINE_COMMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,c=2,c=this.input.LA(1);if("/"==c)c=1;else if("#"==c)c=2;else throw new org.antlr.runtime.NoViableAltException("",
25,0,this.input);switch(c){case 1:this.match("//");break;case 2:this.match("#");break}a:do{var c=2,d=this.input.LA(1);if("\x00"<=d&&"\t">=d||"\x0B"<=d&&"\u000c">=d||"\u000e"<=d&&"\uffff">=d)c=1;switch(c){case 1:if("\x00"<=this.input.LA(1)&&"\t">=this.input.LA(1)||"\x0B"<=this.input.LA(1)&&"\u000c">=this.input.LA(1)||"\u000e"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw b=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(b),b;break;default:break a}}while(1);
c=a;this.state.type=b;this.state.channel=c},mWS:function(){var b=this.WS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,c=0;a:do{var d=2,e=this.input.LA(1);if("\t"==e||"\u000c"==e||" "==e)d=1;switch(d){case 1:if("\t"==this.input.LA(1)||"\u000c"==this.input.LA(1)||" "==this.input.LA(1))this.input.consume();else throw b=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(b),b;break;default:if(1<=c)break a;throw new org.antlr.runtime.EarlyExitException(27,this.input);
}c++}while(1);c=a;this.state.type=b;this.state.channel=c},mA:function(){if("A"==this.input.LA(1)||"a"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mB:function(){if("B"==this.input.LA(1)||"b"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mC:function(){if("C"==this.input.LA(1)||"c"==this.input.LA(1))this.input.consume();
else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mD:function(){if("D"==this.input.LA(1)||"d"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mE:function(){if("E"==this.input.LA(1)||"e"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mF:function(){if("F"==this.input.LA(1)||
"f"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mG:function(){if("G"==this.input.LA(1)||"g"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mH:function(){if("H"==this.input.LA(1)||"h"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;
}},mI:function(){if("I"==this.input.LA(1)||"i"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mJ:function(){if("J"==this.input.LA(1)||"j"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mK:function(){if("K"==this.input.LA(1)||"k"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mL:function(){if("L"==this.input.LA(1)||"l"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mM:function(){if("M"==this.input.LA(1)||"m"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mN:function(){if("N"==this.input.LA(1)||"n"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mO:function(){if("O"==this.input.LA(1)||"o"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mP:function(){if("P"==this.input.LA(1)||"p"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mQ:function(){if("Q"==this.input.LA(1)||"q"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mR:function(){if("R"==this.input.LA(1)||"r"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mS:function(){if("S"==this.input.LA(1)||"s"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mT:function(){if("T"==this.input.LA(1)||"t"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mU:function(){if("U"==this.input.LA(1)||"u"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mV:function(){if("V"==this.input.LA(1)||"v"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mW:function(){if("W"==this.input.LA(1)||"w"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mX:function(){if("X"==this.input.LA(1)||"x"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mY:function(){if("Y"==this.input.LA(1)||"y"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mZ:function(){if("Z"==this.input.LA(1)||"z"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mSTRING:function(){var a=this.STRING,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("'"==d)d=1;else if('"'==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",30,0,this.input);switch(d){case 1:this.match("'");a:do{var d=2,e=this.input.LA(1);if("'"==e)d=2;else if("\x00"<=e&&"&">=e||"("<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.match("'");break;case 2:this.match('"');
a:do{d=2;e=this.input.LA(1);if('"'==e)d=2;else if("\x00"<=e&&"!">=e||"#"<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.match('"')}this.state.type=a;this.state.channel=c},mTokens:function(){var a=50,a=this.dfa31.predict(this.input);switch(a){case 1:this.mT__92();break;case 2:this.mT__93();break;case 3:this.mT__94();break;case 4:this.mT__95();break;case 5:this.mT__96();break;case 6:this.mT__97();break;case 7:this.mNEWLINE();break;case 8:this.mWHILESTATEMENT();
break;case 9:this.mFORSTATEMENT();break;case 10:this.mFROMSTATEMENT();break;case 11:this.mINSTATEMENT();break;case 12:this.mTOSTATEMENT();break;case 13:this.mBYSTATEMENT();break;case 14:this.mLOOPSTATEMENT();break;case 15:this.mIFSTATEMENT();break;case 16:this.mTHENSTATEMENT();break;case 17:this.mELSESTATEMENT();break;case 18:this.mFUNCTIONSTATEMENT();break;case 19:this.mENDBLOCK();break;case 20:this.mRETURNSTATEMENT();break;case 21:this.mOR();break;case 22:this.mAND();break;case 23:this.mEQUALS();
break;case 24:this.mNOTEQUALS();break;case 25:this.mLT();break;case 26:this.mLTEQ();break;case 27:this.mGT();break;case 28:this.mGTEQ();break;case 29:this.mPLUS();break;case 30:this.mMINUS();break;case 31:this.mMULT();break;case 32:this.mDIV();break;case 33:this.mMOD();break;case 34:this.mPOW();break;case 35:this.mNOT();break;case 36:this.mLARR();break;case 37:this.mRARR();break;case 38:this.mINTEGER();break;case 39:this.mFLOAT();break;case 40:this.mTRUE();break;case 41:this.mFALSE();break;case 42:this.mPER();
break;case 43:this.mSQUARED();break;case 44:this.mCUBED();break;case 45:this.mIDENT();break;case 46:this.mPRIMITIVE();break;case 47:this.mCOMMENT();break;case 48:this.mLINE_COMMENT();break;case 49:this.mWS();break;case 50:this.mSTRING()}}},!0);org.antlr.lang.augmentObject(FormulaLexer,{DFA31_eotS:"\u0004\uffff\u0001.\u0003\uffff\u0008&\u0001\uffff\u0001&\u0001\uffff\u0001&\u0001\uffff\u0001@\u0001B\u0003\uffff\u0001D\u0001\uffff\u0001&\u0001\uffff\u0001&\u0002\uffff\u0001G\u0001\uffff\u0003&\t\uffff\u0005&\u0001P\u0001Q\u0001R\u0002&\u0001U\u0004&\u0001\u0010\u0001&\u0005\uffff\u0002&\u0001\uffff\u0004&\u0001a\u0003&\u0003\uffff\u0002&\u0001\uffff\u0002&\u0001i\u0001&\u0001\u0012\u0001\u001b\u0001@\u0001k\u0003&\u0001\uffff\u0001o\u0002&\u0001r\u0001s\u0001t\u0001u\u0001\uffff\u0001&\u0001\uffff\u0002&\u0001y\u0001\uffff\u0001&\u0001{\u0004\uffff\u0002&\u0001~\u0001\uffff\u0001&\u0001\uffff\u0001\u0080\u0001&\u0001\uffff\u0001&\u0001\uffff\u0001\u0083\u0001\u0084\u0002\uffff",
DFA31_eofS:"\u0085\uffff",DFA31_minS:"\u0001\t\u0003\uffff\u0001-\u0003\uffff\u0001H\u0001A\u0001F\u0001H\u0001Y\u0001O\u0001L\u0001E\u0001\uffff\u0001R\u0001\uffff\u0001N\u0001\uffff\u0002=\u0003\uffff\u0001*\u0001\uffff\u0001O\u0001\uffff\u0001O\u0002\uffff\u0001.\u0001\uffff\u0001E\u0001Q\u0001U\t\uffff\u0001I\u0001R\u0001O\u0001N\u0001L\u00030\u0001E\u0001U\u00010\u0001O\u0001S\u0001D\u0001T\u00010\u0001D\u0005\uffff\u0001D\u0001T\u0001\uffff\u0001R\u0001U\u0001B\u0001L\u00010\u0001M\u0001C\u0001S\u0003\uffff\u0001N\u0001E\u0001\uffff\u0001P\u0001E\u00010\u0001U\u00040\u0001A\u0002E\u0001\uffff\u00010\u0001T\u0001E\u00040\u0001\uffff\u0001R\u0001\uffff\u0001R\u0001D\u00010\u0001\uffff\u0001I\u00010\u0004\uffff\u0001N\u0001E\u00010\u0001\uffff\u0001O\u0001\uffff\u00010\u0001D\u0001\uffff\u0001N\u0001\uffff\u00020\u0002\uffff",
DFA31_maxS:"\u0001\u00bb\u0003\uffff\u0001z\u0003\uffff\u0001h\u0001u\u0001n\u0001r\u0001y\u0001o\u0001n\u0001e\u0001\uffff\u0001r\u0001\uffff\u0001n\u0001\uffff\u0001=\u0001>\u0003\uffff\u0001/\u0001\uffff\u0001o\u0001\uffff\u0001o\u0002\uffff\u00019\u0001\uffff\u0001e\u0001q\u0001u\t\uffff\u0001i\u0001r\u0001o\u0001n\u0001l\u0003z\u0001e\u0001u\u0001z\u0001o\u0001s\u0001d\u0001t\u0001z\u0001d\u0005\uffff\u0001d\u0001t\u0001\uffff\u0001r\u0001u\u0001b\u0001l\u0001z\u0001m\u0001c\u0001s\u0003\uffff\u0001n\u0001e\u0001\uffff\u0001p\u0001e\u0001z\u0001u\u0004z\u0001a\u0002e\u0001\uffff\u0001z\u0001t\u0001e\u0004z\u0001\uffff\u0001r\u0001\uffff\u0001r\u0001d\u0001z\u0001\uffff\u0001i\u0001z\u0004\uffff\u0001n\u0001e\u0001z\u0001\uffff\u0001o\u0001\uffff\u0001z\u0001d\u0001\uffff\u0001n\u0001\uffff\u0002z\u0002\uffff",
DFA31_acceptS:"\u0001\uffff\u0001\u0001\u0001\u0002\u0001\u0003\u0001\uffff\u0001\u0005\u0001\u0006\u0001\u0007\u0008\uffff\u0001\u0015\u0001\uffff\u0001\u0016\u0001\uffff\u0001\u0017\u0002\uffff\u0001\u001d\u0001\u001e\u0001\u001f\u0001\uffff\u0001!\u0001\uffff\u0001\"\u0001\uffff\u0001$\u0001%\u0001\uffff\u0001'\u0003\uffff\u0001-\u0001.\u00010\u00011\u00012\u0001\u0004\u0001\u0018\u0001\u001a\u0001\u0019\u0011\uffff\u0001#\u0001\u001c\u0001\u001b\u0001/\u0001 \u0002\uffff\u0001&\u0008\uffff\u0001\x0B\u0001\u000f\u0001\u000c\u0002\uffff\u0001\r\x0B\uffff\u0001\t\u0007\uffff\u0001\u0013\u0001\uffff\u0001*\u0003\uffff\u0001\n\u0002\uffff\u0001\u0010\u0001(\u0001\u000e\u0001\u0011\u0003\uffff\u0001\u0008\u0001\uffff\u0001)\u0002\uffff\u0001,\u0001\uffff\u0001\u0014\u0002\uffff\u0001+\u0001\u0012",
DFA31_specialS:"\u0085\uffff}>",DFA31_transitionS:"\u0001)\u0001\u0007\u0001\uffff\u0001)\u0001\u0007\u0012\uffff\u0001)\u0001\u0015\u0001*\u0001(\u0001\uffff\u0001\u001b\u0001\u0012\u0001*\u0001\u0001\u0001\u0003\u0001\u0019\u0001\u0017\u0001\u0002\u0001\u0018\u0001\"\u0001\u001a\n!\u0002\uffff\u0001\u0004\u0001\u0014\u0001\u0016\u0002\uffff\u0001\u0013\u0001\u000c\u0001%\u0001&\u0001\u000e\u0001\t\u0002&\u0001\n\u0002&\u0001\r\u0001\u001c\u0001\u001e\u0001\u0011\u0001#\u0001&\u0001\u000f\u0001$\u0001\x0B\u0002&\u0001\u0008\u0003&\u0001'\u0002\uffff\u0001\u001d\u0002\uffff\u0001\u0013\u0001\u000c\u0001%\u0001&\u0001\u000e\u0001\t\u0002&\u0001\n\u0002&\u0001\r\u0001\u001c\u0001\u001e\u0001\u0011\u0001#\u0001&\u0001\u000f\u0001$\u0001\x0B\u0002&\u0001\u0008\u0003&\u0001\u0005\u0001\u0010\u0001\u0006-\uffff\u0001\u001f\u000f\uffff\u0001 {{{{\u0001+\u000e\uffff\u0001\u001f\u0001-\u0001,\u0002\uffff\u001a'\u0006\uffff\u001a'{{{{\u0001/\u001f\uffff\u0001/{\u00013\r\uffff\u00010\u0002\uffff\u00011\u0002\uffff\u00012\x0B\uffff\u00013\r\uffff\u00010\u0002\uffff\u00011\u0002\uffff\u00012{\u00015\u0007\uffff\u00014\u0017\uffff\u00015\u0007\uffff\u00014{\u00017\u0006\uffff\u00016\u0002\uffff\u00018\u0015\uffff\u00017\u0006\uffff\u00016\u0002\uffff\u00018{\u00019\u001f\uffff\u00019{\u0001:\u001f\uffff\u0001:{\u0001;\u0001\uffff\u0001<\u001d\uffff\u0001;\u0001\uffff\u0001<{\u0001=\u001f\uffff\u0001={{\u0001>\u001f\uffff\u0001>{{\u0001?\u001f\uffff\u0001?{{\u0001,{\u0001A\u0001 {{{{\u0001C\u0004\uffff\u0001({{\u0001E\u001f\uffff\u0001E{{\u0001F\u001f\uffff\u0001F{{{\u0001\"\u0001\uffff\n!{{\u0001H\u001f\uffff\u0001H{\u0001I\u001f\uffff\u0001I{\u0001J\u001f\uffff\u0001J{{{{{{{{{{\u0001K\u001f\uffff\u0001K{\u0001L\u001f\uffff\u0001L{\u0001M\u001f\uffff\u0001M{\u0001N\u001f\uffff\u0001N{\u0001O\u001f\uffff\u0001O{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001S\u001f\uffff\u0001S{\u0001T\u001f\uffff\u0001T{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001V\u001f\uffff\u0001V{\u0001W\u001f\uffff\u0001W{\u0001X\u001f\uffff\u0001X{\u0001Y\u001f\uffff\u0001Y{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001Z\u001f\uffff\u0001Z{{{{{{\u0001[\u001f\uffff\u0001[{\u0001\\\u001f\uffff\u0001\\{{\u0001]\u001f\uffff\u0001]{\u0001^\u001f\uffff\u0001^{\u0001_\u001f\uffff\u0001_{\u0001`\u001f\uffff\u0001`{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001b\u001f\uffff\u0001b{\u0001c\u001f\uffff\u0001c{\u0001d\u001f\uffff\u0001d{{{{\u0001e\u001f\uffff\u0001e{\u0001f\u001f\uffff\u0001f{{\u0001g\u001f\uffff\u0001g{\u0001h\u001f\uffff\u0001h{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001j\u001f\uffff\u0001j{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001l\u001f\uffff\u0001l{\u0001m\u001f\uffff\u0001m{\u0001n\u001f\uffff\u0001n{{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001p\u001f\uffff\u0001p{\u0001q\u001f\uffff\u0001q{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{{\u0001v\u001f\uffff\u0001v{{\u0001w\u001f\uffff\u0001w{\u0001x\u001f\uffff\u0001x{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{{\u0001z\u001f\uffff\u0001z{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{{{{{\u0001|\u001f\uffff\u0001|{\u0001}\u001f\uffff\u0001}{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{{\u0001\u007f\u001f\uffff\u0001\u007f{{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\u0001\u0081\u001f\uffff\u0001\u0081{{\u0001\u0082\u001f\uffff\u0001\u0082{{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&{{".split("{")});
org.antlr.lang.augmentObject(FormulaLexer,{DFA31_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA31_eotS),DFA31_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA31_eofS),DFA31_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA31_minS),DFA31_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA31_maxS),DFA31_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA31_acceptS),DFA31_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA31_specialS),
DFA31_transition:function(){var a=[],c,d=FormulaLexer.DFA31_transitionS.length;for(c=0;c<d;c++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA31_transitionS[c]));return a}()});FormulaLexer.DFA31=function(a){this.recognizer=a;this.decisionNumber=31;this.eot=FormulaLexer.DFA31_eot;this.eof=FormulaLexer.DFA31_eof;this.min=FormulaLexer.DFA31_min;this.max=FormulaLexer.DFA31_max;this.accept=FormulaLexer.DFA31_accept;this.special=FormulaLexer.DFA31_special;this.transition=FormulaLexer.DFA31_transition};
org.antlr.lang.extend(FormulaLexer.DFA31,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__92 | T__93 | T__94 | T__95 | T__96 | T__97 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | OR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | COMMENT | LINE_COMMENT | WS | STRING );"},
dummy:null})})();var FormulaParser=function(a,b){b||(b=new org.antlr.runtime.RecognizerSharedState);FormulaParser.superclass.constructor.call(this,a,b);this.dfa5=new FormulaParser.DFA5(this);this.dfa40=new FormulaParser.DFA40(this);this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor};
org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__92:92,T__93:93,T__94:94,T__95:95,T__96:96,T__97:97,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,NUMBER:21,NEWLINE:22,W:23,H:24,I:25,L:26,E:27,WHILESTATEMENT:28,F:29,O:30,R:31,FORSTATEMENT:32,M:33,FROMSTATEMENT:34,N:35,INSTATEMENT:36,T:37,TOSTATEMENT:38,B:39,Y:40,BYSTATEMENT:41,P:42,LOOPSTATEMENT:43,IFSTATEMENT:44,THENSTATEMENT:45,
S:46,ELSESTATEMENT:47,U:48,C:49,FUNCTIONSTATEMENT:50,D:51,ENDBLOCK:52,RETURNSTATEMENT:53,IDENT:54,EQUALS:55,PRIMITIVE:56,OR:57,AND:58,A:59,NOTEQUALS:60,LT:61,LTEQ:62,GT:63,GTEQ:64,PLUS:65,MINUS:66,MULT:67,DIV:68,MOD:69,POW:70,NOT:71,LARR:72,RARR:73,INTEGER:74,FLOAT:75,TRUE:76,FALSE:77,PER:78,CUBED:79,SQUARED:80,Q:81,COMMENT:82,LINE_COMMENT:83,WS:84,G:85,J:86,K:87,V:88,X:89,Z:90,STRING:91});
(function(){org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(a){this.adaptor=a},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){};org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),lines:function(){var a=new FormulaParser.lines_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{a:do{var n=2;22==this.input.LA(1)&&(n=1);switch(n){case 1:c=this.match(this.input,22,
FormulaParser.FOLLOW_NEWLINE_in_lines116);if(this.state.failed)return a;0===this.state.backtracking&&h.add(c);break;default:break a}}while(1);a:do{var c=2,o=this.input.LA(1);if(28==o||32==o||44==o||50==o||53<=o&&54>=o||56==o||66==o||71<=o&&72>=o||74<=o&&77>=o||91<=o&&92>=o||96==o)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_lines120);g=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(g.getTree());var c=2,p=this.input.LA(1);
if(22==p)c=1;else if(-1==p)c=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",3,0,this.input);}switch(c){case 1:c=0;b:do{n=2;22==this.input.LA(1)&&(n=1);switch(n){case 1:d=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_lines124);if(this.state.failed)return a;0===this.state.backtracking&&h.add(d);break;default:if(1<=c)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(2,
this.input);}c++}while(1);break;case 2:e=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines127);if(this.state.failed)return a;0===this.state.backtracking&&k.add(e)}break;default:break a}}while(1);f=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines132);if(this.state.failed)return a;0===this.state.backtracking&&k.add(f);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),
r=this.adaptor.nil(),r=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),r);l.hasNext();)this.adaptor.addChild(r,l.nextTree());l.reset();this.adaptor.addChild(b,r);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(s){if(s instanceof org.antlr.runtime.RecognitionException)this.reportError(s),this.recover(this.input,s),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),
s);else throw s;}finally{}return a},expression_return:function(){FormulaParser.expression_return=function(){};org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var a=new FormulaParser.expression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null;try{var n=8,n=this.dfa5.predict(this.input);switch(n){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression394);
c=this.assignment();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression400);d=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression406);e=this.whileLoop();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression412);f=this.forLoop();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 5:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression418);g=this.forInLoop();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,g.getTree());break;case 6:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression424);h=this.ifThenElse();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,h.getTree());break;case 7:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression430);k=this.functionDef();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());
break;case 8:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression436);l=this.returnExp();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(o){if(o instanceof org.antlr.runtime.RecognitionException)this.reportError(o),this.recover(this.input,o),a.tree=
this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),o);else throw o;}finally{}return a},returnExp_return:function(){FormulaParser.returnExp_return=function(){};org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var a=new FormulaParser.returnExp_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();c=this.match(this.input,53,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp448);
if(this.state.failed)return a;0===this.state.backtracking&&(e=this.adaptor.create(c),b=this.adaptor.becomeRoot(e,b));this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp451);d=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(f){if(f instanceof
org.antlr.runtime.RecognitionException)this.reportError(f),this.recover(this.input,f),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),f);else throw f;}finally{}return a},innerBlock_return:function(){FormulaParser.innerBlock_return=function(){};org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var a=new FormulaParser.innerBlock_return;a.start=this.input.LT(1);var b=null,c=
null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{a:do{var g=2,h=this.input.LA(1);if(28==h||32==h||44==h||50==h||53<=h&&54>=h||56==h||66==h||71<=h&&72>=h||74<=h&&77>=h||91<=h&&92>=h||96==h)g=1;switch(g){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock464);d=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
f.add(d.getTree());g=0;b:do{var k=2;22==this.input.LA(1)&&(k=1);switch(k){case 1:c=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_innerBlock468);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);break;default:if(1<=g)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(6,this.input);}g++}while(1);break;default:break a}}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),l);if(!f.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;f.hasNext();)this.adaptor.addChild(l,f.nextTree());f.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),
this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},whileLoop_return:function(){FormulaParser.whileLoop_return=function(){};org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var a=new FormulaParser.whileLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token NEWLINE"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),p=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),r=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,28,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop493);
if(this.state.failed)return a;0===this.state.backtracking&&o.add(c);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop495);g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&r.add(g.getTree());c=0;a:do{g=2;22==this.input.LA(1)&&(g=1);switch(g){case 1:d=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_whileLoop497);if(this.state.failed)return a;0===this.state.backtracking&&k.add(d);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.EarlyExitException(8,this.input);}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop500);h=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&p.add(h.getTree());e=this.match(this.input,52,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop503);if(this.state.failed)return a;0===this.state.backtracking&&l.add(e);f=this.match(this.input,43,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop505);if(this.state.failed)return a;
0===this.state.backtracking&&n.add(f);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),s=this.adaptor.nil(),s=this.adaptor.becomeRoot(this.adaptor.create(15,"WHILE"),s);this.adaptor.addChild(s,r.nextTree());this.adaptor.addChild(s,p.nextTree());this.adaptor.addChild(b,s);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,
a.start,a.stop))}catch(u){if(u instanceof org.antlr.runtime.RecognitionException)this.reportError(u),this.recover(this.input,u),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),u);else throw u;}finally{}return a},forLoop_return:function(){FormulaParser.forLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var a=new FormulaParser.forLoop_return;a.start=this.input.LT(1);
var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null,o=null,p=null,r=null,s=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),
B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),J=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),y=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,32,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop526);
if(this.state.failed)return a;0===this.state.backtracking&&s.add(c);d=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_forLoop528);if(this.state.failed)return a;0===this.state.backtracking&&u.add(d);e=this.match(this.input,34,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop530);if(this.state.failed)return a;0===this.state.backtracking&&w.add(e);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop532);n=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
y.add(n.getTree());f=this.match(this.input,38,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop534);if(this.state.failed)return a;0===this.state.backtracking&&x.add(f);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop536);o=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&y.add(o.getTree());c=2;41==this.input.LA(1)&&(c=1);switch(c){case 1:g=this.match(this.input,41,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop539);if(this.state.failed)return a;
0===this.state.backtracking&&A.add(g);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop541);p=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&y.add(p.getTree())}g=0;a:do{p=2;22==this.input.LA(1)&&(p=1);switch(p){case 1:h=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_forLoop545);if(this.state.failed)return a;0===this.state.backtracking&&v.add(h);break;default:if(1<=g)break a;if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.EarlyExitException(10,this.input);}g++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop548);r=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(r.getTree());k=this.match(this.input,52,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop551);if(this.state.failed)return a;0===this.state.backtracking&&B.add(k);l=this.match(this.input,43,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop553);if(this.state.failed)return a;
0===this.state.backtracking&&z.add(l);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),D=this.adaptor.nil(),D=this.adaptor.becomeRoot(this.adaptor.create(18,"FOR"),D);this.adaptor.addChild(D,u.nextNode());for(var E=this.adaptor.nil(),E=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),E);y.hasNext();)this.adaptor.addChild(E,y.nextTree());y.reset();this.adaptor.addChild(D,E);
this.adaptor.addChild(D,J.nextTree());this.adaptor.addChild(b,D);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(C){if(C instanceof org.antlr.runtime.RecognitionException)this.reportError(C),this.recover(this.input,C),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),C);else throw C;}finally{}return a},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){};
org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var a=new FormulaParser.forInLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token NEWLINE"),r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),s=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),w=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),v=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,32,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop581);
if(this.state.failed)return a;0===this.state.backtracking&&n.add(c);d=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_forInLoop583);if(this.state.failed)return a;0===this.state.backtracking&&o.add(d);e=this.match(this.input,36,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop585);if(this.state.failed)return a;0===this.state.backtracking&&u.add(e);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop587);k=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===
this.state.backtracking&&v.add(k.getTree());c=0;a:do{d=2;22==this.input.LA(1)&&(d=1);switch(d){case 1:f=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_forInLoop589);if(this.state.failed)return a;0===this.state.backtracking&&p.add(f);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(11,this.input);}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop592);l=this.innerBlock();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&w.add(l.getTree());g=this.match(this.input,52,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop595);if(this.state.failed)return a;0===this.state.backtracking&&r.add(g);h=this.match(this.input,43,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop597);if(this.state.failed)return a;0===this.state.backtracking&&s.add(h);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:
null);var b=this.adaptor.nil(),x=this.adaptor.nil(),x=this.adaptor.becomeRoot(this.adaptor.create(19,"FORIN"),x);this.adaptor.addChild(x,o.nextNode());this.adaptor.addChild(x,v.nextTree());this.adaptor.addChild(x,w.nextTree());this.adaptor.addChild(b,x);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(B){if(B instanceof org.antlr.runtime.RecognitionException)this.reportError(B),this.recover(this.input,
B),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),B);else throw B;}finally{}return a},ifThenElse_return:function(){FormulaParser.ifThenElse_return=function(){};org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var a=new FormulaParser.ifThenElse_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null,o=null,p=null,r=null,
s=null,u=null,w=null,v=null,x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),J=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),y=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"rule innerBlock"),D=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,44,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse622);if(this.state.failed)return a;0===this.state.backtracking&&x.add(c);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse624);r=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&D.add(r.getTree());d=this.match(this.input,45,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse626);
if(this.state.failed)return a;0===this.state.backtracking&&J.add(d);c=0;a:do{d=2;22==this.input.LA(1)&&(d=1);switch(d){case 1:e=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse629);if(this.state.failed)return a;0===this.state.backtracking&&B.add(e);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;var E=new org.antlr.runtime.EarlyExitException(12,this.input);throw E;}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse632);
s=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&y.add(s.getTree());a:do switch(e=2,47==this.input.LA(1)&&44==this.input.LA(2)&&(e=1),e){case 1:f=this.match(this.input,47,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse636);if(this.state.failed)return a;0===this.state.backtracking&&A.add(f);g=this.match(this.input,44,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse638);if(this.state.failed)return a;0===this.state.backtracking&&x.add(g);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse640);
u=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&D.add(u.getTree());h=this.match(this.input,45,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse642);if(this.state.failed)return a;0===this.state.backtracking&&J.add(h);e=0;b:do{s=2;22==this.input.LA(1)&&(s=1);switch(s){case 1:k=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse644);if(this.state.failed)return a;0===this.state.backtracking&&B.add(k);break;default:if(1<=e)break b;
if(0<this.state.backtracking)return this.state.failed=!0,a;E=new org.antlr.runtime.EarlyExitException(13,this.input);throw E;}e++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse647);w=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&y.add(w.getTree());break;default:break a}while(1);f=2;47==this.input.LA(1)&&(f=1);switch(f){case 1:l=this.match(this.input,47,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse652);if(this.state.failed)return a;
0===this.state.backtracking&&A.add(l);l=0;a:do{A=2;22==this.input.LA(1)&&(A=1);switch(A){case 1:n=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse654);if(this.state.failed)return a;0===this.state.backtracking&&B.add(n);break;default:if(1<=l)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;E=new org.antlr.runtime.EarlyExitException(15,this.input);throw E;}l++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse657);v=this.innerBlock();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&y.add(v.getTree())}o=this.match(this.input,52,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse661);if(this.state.failed)return a;0===this.state.backtracking&&z.add(o);p=this.match(this.input,44,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse663);if(this.state.failed)return a;0===this.state.backtracking&&x.add(p);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:
null);var b=this.adaptor.nil(),C=this.adaptor.nil(),C=this.adaptor.becomeRoot(this.adaptor.create(16,"IFTHENELSE"),C),F=this.adaptor.nil(),F=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),F);if(!D.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;D.hasNext();)this.adaptor.addChild(F,D.nextTree());D.reset();this.adaptor.addChild(C,F);F=this.adaptor.nil();F=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),F);if(!y.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;
for(;y.hasNext();)this.adaptor.addChild(F,y.nextTree());y.reset();this.adaptor.addChild(C,F);this.adaptor.addChild(b,C);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(I){if(I instanceof org.antlr.runtime.RecognitionException)this.reportError(I),this.recover(this.input,I),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),I);else throw I;}finally{}return a},functionDef_return:function(){FormulaParser.functionDef_return=
function(){};org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var a=new FormulaParser.functionDef_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null,o=null,p=null,r=null,s=null,u=null,w=null,v=null,x=null,B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 94"),J=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 93"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 92"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),F=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"rule innerBlock"),I=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,50,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef694);if(this.state.failed)return a;0===this.state.backtracking&&B.add(c);d=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_functionDef696);if(this.state.failed)return a;0===this.state.backtracking&&z.add(d);e=this.match(this.input,92,FormulaParser.FOLLOW_92_in_functionDef698);if(this.state.failed)return a;
0===this.state.backtracking&&D.add(e);c=2;54==this.input.LA(1)&&(c=1);switch(c){case 1:f=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_functionDef701);if(this.state.failed)return a;0===this.state.backtracking&&z.add(f);var f=2,P=this.input.LA(1);if(55==P)f=1;else if(93<=P&&94>=P)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",18,0,this.input);}switch(f){case 1:g=this.match(this.input,55,FormulaParser.FOLLOW_EQUALS_in_functionDef705);
if(this.state.failed)return a;0===this.state.backtracking&&J.add(g);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef708);w=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&I.add(w.getTree());break;case 2:a:do{g=2;if(93==this.input.LA(1)&&54==this.input.LA(2)){var H=this.input.LA(3);93<=H&&94>=H&&(g=1)}switch(g){case 1:h=this.match(this.input,93,FormulaParser.FOLLOW_93_in_functionDef713);if(this.state.failed)return a;0===this.state.backtracking&&
y.add(h);k=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_functionDef715);if(this.state.failed)return a;0===this.state.backtracking&&z.add(k);break;default:break a}}while(1);break}a:do switch(h=2,93==this.input.LA(1)&&(h=1),h){case 1:l=this.match(this.input,93,FormulaParser.FOLLOW_93_in_functionDef722);if(this.state.failed)return a;0===this.state.backtracking&&y.add(l);n=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_functionDef724);if(this.state.failed)return a;0===this.state.backtracking&&
z.add(n);o=this.match(this.input,55,FormulaParser.FOLLOW_EQUALS_in_functionDef726);if(this.state.failed)return a;0===this.state.backtracking&&J.add(o);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef728);v=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&I.add(v.getTree());break;default:break a}while(1)}p=this.match(this.input,94,FormulaParser.FOLLOW_94_in_functionDef735);if(this.state.failed)return a;0===this.state.backtracking&&A.add(p);
l=0;a:do{n=2;22==this.input.LA(1)&&(n=1);switch(n){case 1:r=this.match(this.input,22,FormulaParser.FOLLOW_NEWLINE_in_functionDef737);if(this.state.failed)return a;0===this.state.backtracking&&E.add(r);break;default:if(1<=l)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(21,this.input);}l++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef740);x=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&F.add(x.getTree());s=this.match(this.input,52,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef743);if(this.state.failed)return a;0===this.state.backtracking&&C.add(s);u=this.match(this.input,50,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef745);if(this.state.failed)return a;0===this.state.backtracking&&B.add(u);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),
N=this.adaptor.nil(),N=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),N),L=this.adaptor.nil(),L=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),L);z.hasNext();)this.adaptor.addChild(L,z.nextNode());z.reset();this.adaptor.addChild(N,L);L=this.adaptor.nil();for(L=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),L);I.hasNext();)this.adaptor.addChild(L,I.nextTree());I.reset();this.adaptor.addChild(N,L);this.adaptor.addChild(N,F.nextTree());this.adaptor.addChild(b,N);a.tree=
b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(S){if(S instanceof org.antlr.runtime.RecognitionException)this.reportError(S),this.recover(this.input,S),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),S);else throw S;}finally{}return a},assignment_return:function(){FormulaParser.assignment_return=function(){};org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),assignment:function(){var a=new FormulaParser.assignment_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null,o=null,p=null,r=null,s=null,u=null,w=null,v=null,x=null,B=null,z=null,A=null,J=null,y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 95"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 94"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 93"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 92"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),H=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),N=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");
try{var L=2,S=this.input.LA(1);if(54==S){var O=this.input.LA(2);if(92==O)L=1;else if(93==O||95==O)L=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;var Q=new org.antlr.runtime.NoViableAltException("",29,1,this.input);throw Q;}}else if(56==S)L=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;Q=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw Q;}switch(L){case 1:c=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_assignment780);if(this.state.failed)return a;
0===this.state.backtracking&&y.add(c);d=this.match(this.input,92,FormulaParser.FOLLOW_92_in_assignment782);if(this.state.failed)return a;0===this.state.backtracking&&I.add(d);u=2;54==this.input.LA(1)&&(u=1);switch(u){case 1:e=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_assignment785);if(this.state.failed)return a;0===this.state.backtracking&&y.add(e);var u=2,K=this.input.LA(1);if(55==K)u=1;else if(93<=K&&94>=K)u=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;Q=new org.antlr.runtime.NoViableAltException("",
23,0,this.input);throw Q;}switch(u){case 1:f=this.match(this.input,55,FormulaParser.FOLLOW_EQUALS_in_assignment789);if(this.state.failed)return a;0===this.state.backtracking&&C.add(f);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment791);B=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&H.add(B.getTree());break;case 2:a:do{Q=2;if(93==this.input.LA(1)&&54==this.input.LA(2)){var ba=this.input.LA(3);93<=ba&&94>=ba&&(Q=1)}switch(Q){case 1:g=
this.match(this.input,93,FormulaParser.FOLLOW_93_in_assignment796);if(this.state.failed)return a;0===this.state.backtracking&&F.add(g);h=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_assignment798);if(this.state.failed)return a;0===this.state.backtracking&&y.add(h);break;default:break a}}while(1);break}a:do switch(Q=2,93==this.input.LA(1)&&(Q=1),Q){case 1:k=this.match(this.input,93,FormulaParser.FOLLOW_93_in_assignment805);if(this.state.failed)return a;0===this.state.backtracking&&F.add(k);
l=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_assignment807);if(this.state.failed)return a;0===this.state.backtracking&&y.add(l);n=this.match(this.input,55,FormulaParser.FOLLOW_EQUALS_in_assignment809);if(this.state.failed)return a;0===this.state.backtracking&&C.add(n);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment811);z=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&H.add(z.getTree());break;default:break a}while(1)}o=this.match(this.input,
94,FormulaParser.FOLLOW_94_in_assignment818);if(this.state.failed)return a;0===this.state.backtracking&&E.add(o);p=this.match(this.input,95,FormulaParser.FOLLOW_95_in_assignment820);if(this.state.failed)return a;0===this.state.backtracking&&D.add(p);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment822);A=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&N.add(A.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),X=this.adaptor.nil(),X=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),X),G=this.adaptor.nil(),G=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),G);y.hasNext();)this.adaptor.addChild(G,y.nextNode());y.reset();this.adaptor.addChild(X,G);G=this.adaptor.nil();for(G=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),G);H.hasNext();)this.adaptor.addChild(G,H.nextTree());H.reset();this.adaptor.addChild(X,G);this.adaptor.addChild(X,
N.nextTree());this.adaptor.addChild(b,X);a.tree=b}break;case 2:var k=2,ca=this.input.LA(1);if(56==ca)k=1;else if(54==ca)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;Q=new org.antlr.runtime.NoViableAltException("",26,0,this.input);throw Q;}switch(k){case 1:r=this.match(this.input,56,FormulaParser.FOLLOW_PRIMITIVE_in_assignment850);if(this.state.failed)return a;0===this.state.backtracking&&P.add(r);break;case 2:s=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_assignment854);
if(this.state.failed)return a;0===this.state.backtracking&&y.add(s);break}a:do switch(k=2,93==this.input.LA(1)&&(k=1),k){case 1:u=this.match(this.input,93,FormulaParser.FOLLOW_93_in_assignment858);if(this.state.failed)return a;0===this.state.backtracking&&F.add(u);var k=2,T=this.input.LA(1);if(56==T)k=1;else if(54==T)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;Q=new org.antlr.runtime.NoViableAltException("",27,0,this.input);throw Q;}switch(k){case 1:w=this.match(this.input,
56,FormulaParser.FOLLOW_PRIMITIVE_in_assignment861);if(this.state.failed)return a;0===this.state.backtracking&&P.add(w);break;case 2:v=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_assignment865);if(this.state.failed)return a;0===this.state.backtracking&&y.add(v)}break;default:break a}while(1);x=this.match(this.input,95,FormulaParser.FOLLOW_95_in_assignment871);if(this.state.failed)return a;0===this.state.backtracking&&D.add(x);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment873);
J=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&N.add(J.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);b=this.adaptor.nil();X=this.adaptor.nil();for(X=this.adaptor.becomeRoot(this.adaptor.create(5,"ASSIGN"),X);P.hasNext();)this.adaptor.addChild(X,P.nextNode());for(P.reset();y.hasNext();)this.adaptor.addChild(X,y.nextNode());y.reset();this.adaptor.addChild(X,
N.nextTree());this.adaptor.addChild(b,X);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(R){if(R instanceof org.antlr.runtime.RecognitionException)this.reportError(R),this.recover(this.input,R),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),R);else throw R;}finally{}return a},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){};
org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),logicalExpression:function(){var a=new FormulaParser.logicalExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_logicalExpression900);d=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,d.getTree());a:do switch(d=2,57==this.input.LA(1)&&(d=1),d){case 1:c=this.match(this.input,57,FormulaParser.FOLLOW_OR_in_logicalExpression903);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_logicalExpression906);e=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());
break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var a=new FormulaParser.booleanAndExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression937);d=this.equalityExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,58==
this.input.LA(1)&&(d=1),d){case 1:c=this.match(this.input,58,FormulaParser.FOLLOW_AND_in_booleanAndExpression940);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression943);e=this.equalityExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);
0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){};org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),equalityExpression:function(){var a=new FormulaParser.equalityExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression974);d=this.relationalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);if(55==f||60==f)d=1;switch(d){case 1:c=
this.input.LT(1);if(55==this.input.LA(1)||60==this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression984);e=this.relationalExpression();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},relationalExpression_return:function(){FormulaParser.relationalExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var a=new FormulaParser.relationalExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1026);d=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);61<=f&&64>=f&&(d=1);switch(d){case 1:c=this.input.LT(1);if(61<=this.input.LA(1)&&64>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1041);
e=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),
g);else throw g;}finally{}return a},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){};org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var a=new FormulaParser.additiveExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1084);
d=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);65<=f&&66>=f&&(d=1);switch(d){case 1:c=this.input.LT(1);if(65<=this.input.LA(1)&&66>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,
this.input);}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1095);e=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),
this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var a=new FormulaParser.multiplicativeExpression_return;a.start=this.input.LT(1);var b=
null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_multiplicativeExpression1125);d=this.negationExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);67<=f&&69>=f&&(d=1);switch(d){case 1:c=this.input.LT(1);if(67<=this.input.LA(1)&&69>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),
b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_multiplicativeExpression1138);e=this.negationExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){};org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),negationExpression:function(){var a=new FormulaParser.negationExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var h=2,k=this.input.LA(1);if(66==k)h=1;else if(54==k||56==k||71<=k&&72>=k||74<=k&&77>=k||91<=k&&92>=k||96==k)h=2;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.NoViableAltException("",36,0,this.input);}switch(h){case 1:c=this.match(this.input,66,FormulaParser.FOLLOW_MINUS_in_negationExpression1183);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1185);d=this.powerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),l);this.adaptor.addChild(l,g.nextTree());this.adaptor.addChild(b,l);a.tree=b}break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1199);e=this.powerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
powerExpression:function(){var a=new FormulaParser.powerExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),h=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1210);d=this.unaryExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&h.add(d.getTree());a:do switch(d=2,70==this.input.LA(1)&&(d=1),d){case 1:c=this.match(this.input,70,FormulaParser.FOLLOW_POW_in_powerExpression1213);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1215);e=this.unaryOrNegate();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(e.getTree());break;default:break a}while(1);
if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),k=this.adaptor.nil(),k=this.adaptor.becomeRoot(this.adaptor.create(9,"POWER"),k);for(this.adaptor.addChild(k,h.nextTree());g.hasNext();)this.adaptor.addChild(k,g.nextTree());g.reset();this.adaptor.addChild(b,k);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,
a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){};org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var a=new FormulaParser.unaryOrNegate_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var h=2,k=this.input.LA(1);if(54==k||56==k||71<=k&&72>=k||74<=k&&77>=k||91<=k&&92>=k||96==k)h=1;else if(66==k)h=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",38,0,this.input);}switch(h){case 1:b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1242);d=this.unaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:c=this.match(this.input,66,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1248);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1250);e=this.unaryExpression();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&g.add(e.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),l);this.adaptor.addChild(l,g.nextTree());this.adaptor.addChild(b,l);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,
a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryExpression:function(){var a=new FormulaParser.unaryExpression_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{var g=2,h=this.input.LA(1);if(71==h)g=1;else if(54==h||56==h||72==h||74<=h&&77>=h||91<=h&&92>=h||96==h)g=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",39,0,this.input);}switch(g){case 1:b=this.adaptor.nil();c=this.match(this.input,71,FormulaParser.FOLLOW_NOT_in_unaryExpression1278);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),
b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_unaryExpression1281);d=this.primaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_unaryExpression1293);e=this.primaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=
this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},primaryExpression_return:function(){FormulaParser.primaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.primaryExpression_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var a=new FormulaParser.primaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{var f=2,f=this.dfa40.predict(this.input);switch(f){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_primaryExpression1334);c=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,
c.getTree());this.pushFollow(FormulaParser.FOLLOW_array_in_primaryExpression1337);d=this.array();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_primaryExpression1343);e=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=this.input.LT(-1);
0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var a=new FormulaParser.innerPrimaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{var e=2,f=this.input.LA(1);if(92==f)e=1;else if(54==f||56==f||72==f||74<=f&&77>=f||91==f||96==f)e=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",41,0,this.input);}switch(e){case 1:b=this.adaptor.nil();this.match(this.input,
92,FormulaParser.FOLLOW_92_in_innerPrimaryExpression1353);if(this.state.failed)return a;this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_innerPrimaryExpression1356);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());this.match(this.input,94,FormulaParser.FOLLOW_94_in_innerPrimaryExpression1358);if(this.state.failed)return a;break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_value_in_innerPrimaryExpression1364);
d=this.value();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},value_return:function(){FormulaParser.value_return=
function(){};org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var a=new FormulaParser.value_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null;try{var l=7;switch(this.input.LA(1)){case 74:case 75:l=1;break;case 76:case 77:l=2;break;case 91:l=3;break;case 96:l=4;break;case 54:l=5;break;case 56:l=6;break;case 72:l=7;break;default:if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.NoViableAltException("",42,0,this.input);}switch(l){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_number_in_value1378);c=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_value1384);d=this.bool();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,
d.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_value1390);e=this.string();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_material_in_value1396);f=this.material();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 5:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_funOrIdent_in_value1401);
g=this.funOrIdent();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree());break;case 6:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1406);h=this.primitive();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,h.getTree());break;case 7:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_value1411);k=this.array();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){};
org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var a=new FormulaParser.defaultValue_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{var g=4;switch(this.input.LA(1)){case 66:g=1;break;case 74:case 75:g=2;break;case 76:case 77:g=3;break;case 91:g=4;break;default:if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
43,0,this.input);}switch(g){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1427);c=this.negnumber();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1433);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 3:b=
this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1439);e=this.bool();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1445);f=this.string();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=
this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(h){if(h instanceof org.antlr.runtime.RecognitionException)this.reportError(h),this.recover(this.input,h),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),h);else throw h;}finally{}return a},array_return:function(){FormulaParser.array_return=function(){};org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
array:function(){var a=new FormulaParser.array_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 93"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LARR"),n=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,72,FormulaParser.FOLLOW_LARR_in_array1457);
if(this.state.failed)return a;0===this.state.backtracking&&l.add(c);var c=2,o=this.input.LA(1);if(54==o||56==o||66==o||71<=o&&72>=o||74<=o&&77>=o||91<=o&&92>=o||96==o)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_array1460);f=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(f.getTree());a:do switch(f=2,93==this.input.LA(1)&&(f=1),f){case 1:d=this.match(this.input,93,FormulaParser.FOLLOW_93_in_array1463);if(this.state.failed)return a;
0===this.state.backtracking&&h.add(d);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_array1465);g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(g.getTree());break;default:break a}while(1)}e=this.match(this.input,73,FormulaParser.FOLLOW_RARR_in_array1471);if(this.state.failed)return a;0===this.state.backtracking&&k.add(e);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),p=this.adaptor.nil(),p=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),p);n.hasNext();)this.adaptor.addChild(p,n.nextTree());n.reset();this.adaptor.addChild(b,p);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(r){if(r instanceof org.antlr.runtime.RecognitionException)this.reportError(r),this.recover(this.input,
r),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),r);else throw r;}finally{}return a},number_return:function(){FormulaParser.number_return=function(){};org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var a=new FormulaParser.number_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(74<=this.input.LA(1)&&75>=this.input.LA(1))this.input.consume(),
0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),this.recover(this.input,
d),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),d);else throw d;}finally{}return a},negnumber_return:function(){FormulaParser.negnumber_return=function(){};org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var a=new FormulaParser.negnumber_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),
f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{c=this.match(this.input,66,FormulaParser.FOLLOW_MINUS_in_negnumber1524);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber1526);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),g=this.adaptor.nil(),g=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),g);this.adaptor.addChild(g,f.nextTree());this.adaptor.addChild(b,g);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(h){if(h instanceof org.antlr.runtime.RecognitionException)this.reportError(h),this.recover(this.input,h),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),h);else throw h;}finally{}return a},bool_return:function(){FormulaParser.bool_return=function(){};org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var a=new FormulaParser.bool_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(76<=this.input.LA(1)&&77>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,
this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),d);else throw d;}finally{}return a},material_return:function(){FormulaParser.material_return=function(){};org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var a=new FormulaParser.material_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 97"),h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 96"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{c=this.match(this.input,96,FormulaParser.FOLLOW_96_in_material1678);if(this.state.failed)return a;0===this.state.backtracking&&h.add(c);this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material1680);e=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===
this.state.backtracking&&l.add(e.getTree());this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material1682);f=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&k.add(f.getTree());d=this.match(this.input,97,FormulaParser.FOLLOW_97_in_material1684);if(this.state.failed)return a;0===this.state.backtracking&&g.add(d);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),n=this.adaptor.nil(),n=this.adaptor.becomeRoot(this.adaptor.create(7,"MATERIAL"),n);this.adaptor.addChild(n,k.nextTree());this.adaptor.addChild(n,l.nextTree());this.adaptor.addChild(b,n);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(o){if(o instanceof org.antlr.runtime.RecognitionException)this.reportError(o),this.recover(this.input,
o),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),o);else throw o;}finally{}return a},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var a=new FormulaParser.unitMultiplicativeExpression_return;a.start=this.input.LT(1);var b=
null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression1721);d=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,78==this.input.LA(1)&&(d=1),d){case 1:c=this.match(this.input,78,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression1725);if(this.state.failed)return a;0===this.state.backtracking&&
(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression1728);e=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof
org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var a=
new FormulaParser.unitInnerMultiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression1744);d=this.unitClump();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);67<=f&&68>=f&&(d=1);switch(d){case 1:c=this.input.LT(1);if(67<=this.input.LA(1)&&68>=this.input.LA(1))this.input.consume(),
0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression1755);e=this.unitClump();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);
a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},unitClump_return:function(){FormulaParser.unitClump_return=function(){};org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),unitClump:function(){var a=new FormulaParser.unitClump_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token SQUARED"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token CUBED"),s=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var u=2,w=this.input.LA(1);if(74==w)u=1;else if(54==w||92==w)u=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",52,0,this.input);}switch(u){case 1:c=this.match(this.input,74,FormulaParser.FOLLOW_INTEGER_in_unitClump1771);if(this.state.failed)return a;0===this.state.backtracking&&n.add(c);d=this.match(this.input,68,FormulaParser.FOLLOW_DIV_in_unitClump1773);
if(this.state.failed)return a;0===this.state.backtracking&&p.add(d);this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump1776);k=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&s.add(k.getTree());h=2;79==this.input.LA(1)&&(h=1);switch(h){case 1:e=this.match(this.input,79,FormulaParser.FOLLOW_CUBED_in_unitClump1778);if(this.state.failed)return a;0===this.state.backtracking&&r.add(e)}h=2;80==this.input.LA(1)&&(h=1);switch(h){case 1:f=
this.match(this.input,80,FormulaParser.FOLLOW_SQUARED_in_unitClump1781);if(this.state.failed)return a;0===this.state.backtracking&&o.add(f)}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),v=this.adaptor.nil(),v=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),v);this.adaptor.addChild(v,s.nextTree());for(this.adaptor.addChild(v,this.adaptor.create(4,"NEGATE"));r.hasNext();)this.adaptor.addChild(v,
r.nextNode());for(r.reset();o.hasNext();)this.adaptor.addChild(v,o.nextNode());o.reset();this.adaptor.addChild(b,v);a.tree=b}break;case 2:this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump1804);l=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&s.add(l.getTree());f=2;79==this.input.LA(1)&&(f=1);switch(f){case 1:g=this.match(this.input,79,FormulaParser.FOLLOW_CUBED_in_unitClump1806);if(this.state.failed)return a;0===this.state.backtracking&&
r.add(g)}f=2;80==this.input.LA(1)&&(f=1);switch(f){case 1:h=this.match(this.input,80,FormulaParser.FOLLOW_SQUARED_in_unitClump1809);if(this.state.failed)return a;0===this.state.backtracking&&o.add(h)}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);b=this.adaptor.nil();v=this.adaptor.nil();v=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),v);for(this.adaptor.addChild(v,s.nextTree());r.hasNext();)this.adaptor.addChild(v,
r.nextNode());for(r.reset();o.hasNext();)this.adaptor.addChild(v,o.nextNode());o.reset();this.adaptor.addChild(b,v);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(x){if(x instanceof org.antlr.runtime.RecognitionException)this.reportError(x),this.recover(this.input,x),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),x);else throw x;}finally{}return a},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var a=new FormulaParser.unitPowerExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression1871);f=this.unit();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,f.getTree());a:do switch(f=2,70==this.input.LA(1)&&(f=1),f){case 1:c=this.match(this.input,70,FormulaParser.FOLLOW_POW_in_unitPowerExpression1875);if(this.state.failed)return a;0===this.state.backtracking&&(g=this.adaptor.create(c),b=this.adaptor.becomeRoot(g,b));f=2;66==this.input.LA(1)&&(f=1);switch(f){case 1:d=this.match(this.input,66,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression1878);if(this.state.failed)return a;0===this.state.backtracking&&(h=this.adaptor.create(d),
this.adaptor.addChild(b,h))}e=this.input.LT(1);if(74<=this.input.LA(1)&&75>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(e)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},unit_return:function(){FormulaParser.unit_return=function(){};org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var a=new FormulaParser.unit_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 94"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 92"),n=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var o=2,p=this.input.LA(1);if(54==p)o=1;else if(92==p)o=2;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.NoViableAltException("",56,0,this.input);}switch(o){case 1:c=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_unit1899);if(this.state.failed)return a;0===this.state.backtracking&&h.add(c);a:do switch(c=2,54==this.input.LA(1)&&(c=1),c){case 1:d=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_unit1902);if(this.state.failed)return a;0===this.state.backtracking&&h.add(d);break;default:break a}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),r=this.adaptor.nil(),r=this.adaptor.becomeRoot(this.adaptor.create(8,"UNIT"),r);if(!h.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;h.hasNext();)this.adaptor.addChild(r,h.nextNode());h.reset();this.adaptor.addChild(b,r);a.tree=b}break;case 2:e=this.match(this.input,92,FormulaParser.FOLLOW_92_in_unit1919);if(this.state.failed)return a;0===this.state.backtracking&&l.add(e);this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit1921);
g=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(g.getTree());f=this.match(this.input,94,FormulaParser.FOLLOW_94_in_unit1923);if(this.state.failed)return a;0===this.state.backtracking&&k.add(f);0===this.state.backtracking&&(a.tree=b,new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null),b=this.adaptor.nil(),r=this.adaptor.nil(),r=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),
r),this.adaptor.addChild(r,n.nextTree()),this.adaptor.addChild(b,r),a.tree=b)}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(s){if(s instanceof org.antlr.runtime.RecognitionException)this.reportError(s),this.recover(this.input,s),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),s);else throw s;}finally{}return a},funOrIdent_return:function(){FormulaParser.funOrIdent_return=
function(){};org.antlr.lang.extend(FormulaParser.funOrIdent_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funOrIdent:function(){var a,b=new FormulaParser.funOrIdent_return;b.start=this.input.LT(1);var c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,n=null,o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 94"),r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 93"),s=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 92"),u=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var w=2;if(54==this.input.LA(1))this.input.LA(2),w=this.synpred2_Formula()?1:2;else{if(0<this.state.backtracking)return this.state.failed=!0,b;a=new org.antlr.runtime.NoViableAltException("",59,0,this.input);throw a;}switch(w){case 1:d=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_funOrIdent1969);if(this.state.failed)return b;
0===this.state.backtracking&&o.add(d);e=this.match(this.input,92,FormulaParser.FOLLOW_92_in_funOrIdent1971);if(this.state.failed)return b;0===this.state.backtracking&&s.add(e);a=2;var v=this.input.LA(1);if(54==v||56==v||66==v||71<=v&&72>=v||74<=v&&77>=v||91<=v&&92>=v||96==v)a=1;switch(a){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funOrIdent1975);k=this.logicalExpression();this.state._fsp--;if(this.state.failed)return b;0===this.state.backtracking&&u.add(k.getTree());a:do switch(k=
2,93==this.input.LA(1)&&(k=1),k){case 1:f=this.match(this.input,93,FormulaParser.FOLLOW_93_in_funOrIdent1978);if(this.state.failed)return b;0===this.state.backtracking&&r.add(f);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funOrIdent1980);l=this.logicalExpression();this.state._fsp--;if(this.state.failed)return b;0===this.state.backtracking&&u.add(l.getTree());break;default:break a}while(1)}g=this.match(this.input,94,FormulaParser.FOLLOW_94_in_funOrIdent1987);if(this.state.failed)return b;
0===this.state.backtracking&&p.add(g);if(0===this.state.backtracking){b.tree=c;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=b?b.tree:null);var c=this.adaptor.nil(),x=this.adaptor.nil(),x=this.adaptor.becomeRoot(this.adaptor.create(6,"FUNCALL"),x);for(this.adaptor.addChild(x,o.nextNode());u.hasNext();)this.adaptor.addChild(x,u.nextTree());u.reset();this.adaptor.addChild(c,x);b.tree=c}break;case 2:c=this.adaptor.nil();h=this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_funOrIdent2004);
if(this.state.failed)return b;0===this.state.backtracking&&(n=this.adaptor.create(h),this.adaptor.addChild(c,n))}b.stop=this.input.LT(-1);0===this.state.backtracking&&(b.tree=this.adaptor.rulePostProcessing(c),this.adaptor.setTokenBoundaries(b.tree,b.start,b.stop))}catch(B){if(B instanceof org.antlr.runtime.RecognitionException)this.reportError(B),this.recover(this.input,B),b.tree=this.adaptor.errorNode(this.input,b.start,this.input.LT(-1),B);else throw B;}finally{}return b},primitive_return:function(){FormulaParser.primitive_return=
function(){};org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var a=new FormulaParser.primitive_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{b=this.adaptor.nil();c=this.match(this.input,56,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2060);if(this.state.failed)return a;0===this.state.backtracking&&(d=this.adaptor.create(c),this.adaptor.addChild(b,d));a.stop=this.input.LT(-1);0===
this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(e){if(e instanceof org.antlr.runtime.RecognitionException)this.reportError(e),this.recover(this.input,e),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),e);else throw e;}finally{}return a},string_return:function(){FormulaParser.string_return=function(){};org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
string:function(){var a=new FormulaParser.string_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{b=this.adaptor.nil();c=this.match(this.input,91,FormulaParser.FOLLOW_STRING_in_string2520);if(this.state.failed)return a;0===this.state.backtracking&&(d=this.adaptor.create(c),b=this.adaptor.becomeRoot(d,b));a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(e){if(e instanceof org.antlr.runtime.RecognitionException)this.reportError(e),
this.recover(this.input,e),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),e);else throw e;}finally{}return a},synpred1_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_synpred1_Formula1326);this.innerPrimaryExpression();this.state._fsp--;this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_array_in_synpred1_Formula1329),this.array(),this.state._fsp--)},synpred2_Formula_fragment:function(){this.match(this.input,54,FormulaParser.FOLLOW_IDENT_in_synpred2_Formula1948);
if(!this.state.failed&&(this.match(this.input,92,FormulaParser.FOLLOW_92_in_synpred2_Formula1950),!this.state.failed)){var a=2,b=this.input.LA(1);if(54==b||56==b||66==b||71<=b&&72>=b||74<=b&&77>=b||91<=b&&92>=b||96==b)a=1;switch(a){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred2_Formula1954);this.logicalExpression();this.state._fsp--;if(this.state.failed)return;a:do switch(a=2,93==this.input.LA(1)&&(a=1),a){case 1:this.match(this.input,93,FormulaParser.FOLLOW_93_in_synpred2_Formula1957);
if(this.state.failed)return;this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred2_Formula1959);this.logicalExpression();this.state._fsp--;if(this.state.failed)return;break;default:break a}while(1)}this.match(this.input,94,FormulaParser.FOLLOW_94_in_synpred2_Formula1966)}},synpred1_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred1_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;
this.state.failed=!1;return c},synpred2_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred2_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c}},!0);org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:" \uffff",DFA5_eofS:"\u0001\uffff\u0002\u0003\n\uffff\u0001\u0003\u0012\uffff",DFA5_minS:'\u0001\u001c\u0002\u0016\u0002\uffff\u00016\u0003\uffff\u00016\u0001\uffff\u0001"\u00017\u0001\u0016\u0002\uffff\u00036\u00057\u00026\u00017\u00016\u00047',
DFA5_maxS:"\u0001`\u0002_\u0002\uffff\u00016\u0003\uffff\u0001`\u0001\uffff\u0001$\u0001^\u0001_\u0002\uffff\u0003`\u0005^\u0002`\u0001^\u0001`\u0004^",DFA5_acceptS:"\u0003\uffff\u0001\u0002\u0001\u0003\u0001\uffff\u0001\u0006\u0001\u0007\u0001\u0008\u0001\uffff\u0001\u0001\u0003\uffff\u0001\u0004\u0001\u0005\u0010\uffff",DFA5_specialS:" \uffff}>",DFA5_transitionS:"\u0001\u0004\u0003\uffff\u0001\u0005\x0B\uffff\u0001\u0006\u0005\uffff\u0001\u0007\u0002\uffff\u0001\u0008\u0001\u0001\u0001\uffff\u0001\u0002\t\uffff\u0001\u0003\u0004\uffff\u0002\u0003\u0001\uffff\u0004\u0003\r\uffff\u0002\u0003\u0003\uffff\u0001\u0003,\u0001\u0003 \uffff\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0013\uffff\u0001\t\u0001\n\u0001\uffff\u0001\n,\u0001\u0003 \uffff\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\n\u0001\uffff\u0001\n,,,\u0001\x0B,,,,\u0001\u000c\u0001\uffff\u0001\u0003\t\uffff\u0001\u0003\u0004\uffff\u0002\u0003\u0001\uffff\u0004\u0003\r\uffff\u0002\u0003\u0001\uffff\u0001\r\u0001\uffff\u0001\u0003,,\u0001\u000e\u0001\uffff\u0001\u000f,\u0001\u0010\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0013\uffff\u0001\u0003\u0001\u0011\u0001\r,\u0001\u0003 \uffff\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0016\uffff\u0001\n,,,\u0001\u0003\u0001\uffff\u0001\u0003\t\uffff\u0001\u0012\u0004\uffff\u0002\u0003\u0001\uffff\u0002\u0013\u0002\u0014\r\uffff\u0001\u0015\u0001\u0003\u0003\uffff\u0001\u0003,\u0001\u0016\u0001\uffff\u0001\u0003\t\uffff\u0001\u0003\u0004\uffff\u0002\u0003\u0001\uffff\u0004\u0003\r\uffff\u0002\u0003\u0003\uffff\u0001\u0003,\u0001\u0003\u0001\uffff\u0001\u0003\u000e\uffff\u0002\u0003\u0001\uffff\u0002\u0017\u0002\u0003\r\uffff\u0002\u0003\u0003\uffff\u0001\u0003,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u0019\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0013\uffff\u0001\u0003\u0001\u0011\u0001\r,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u001a\u0001\uffff\u0001\u0003\t\uffff\u0001\u0003\u0004\uffff\u0002\u0003\u0001\uffff\u0004\u0003\r\uffff\u0002\u0003\u0003\uffff\u0001\u0003,\u0001\u0003\u0001\uffff\u0001\u0003\t\uffff\u0001\u001b\u0004\uffff\u0002\u0003\u0001\uffff\u0002\u001c\u0002\u001d\r\uffff\u0001\u001e\u0001\u0003\u0003\uffff\u0001\u0003,\u0001\u0019\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0013\uffff\u0003\u0003,\u0001\u0003\u0001\uffff\u0001\u0003\u000e\uffff\u0002\u0003\u0001\uffff\u0002\u001f\u0002\u0003\r\uffff\u0002\u0003\u0003\uffff\u0001\u0003,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r,\u0001\u0003\u0001\uffff\u0002\u0003\u0001\uffff\x0B\u0003\u0001\uffff\u0001\u0003\u0014\uffff\u0001\u0018\u0001\r".split(",")});
org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),
DFA5_transition:function(){var a=[],b,c=FormulaParser.DFA5_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[b]));return a}()});FormulaParser.DFA5=function(a){this.recognizer=a;this.decisionNumber=5;this.eot=FormulaParser.DFA5_eot;this.eof=FormulaParser.DFA5_eof;this.min=FormulaParser.DFA5_min;this.max=FormulaParser.DFA5_max;this.accept=FormulaParser.DFA5_accept;this.special=FormulaParser.DFA5_special;this.transition=FormulaParser.DFA5_transition};
org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"93:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp );"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA40_eotS:"\x0B\uffff",DFA40_eofS:"\x0B\uffff",DFA40_minS:"\u00016\u0008\x00\u0002\uffff",DFA40_maxS:"\u0001`\u0008\x00\u0002\uffff",DFA40_acceptS:"\t\uffff\u0001\u0001\u0001\u0002",DFA40_specialS:"\u0001\uffff\u0001\x00\u0001\u0001\u0001\u0002\u0001\u0003\u0001\u0004\u0001\u0005\u0001\u0006\u0001\u0007\u0002\uffff}>",
DFA40_transitionS:"\u0001\u0006\u0001\uffff\u0001\u0007\u000f\uffff\u0001\u0008\u0001\uffff\u0002\u0002\u0002\u0003\r\uffff\u0001\u0004\u0001\u0001\u0003\uffff\u0001\u0005,\u0001\uffff,\u0001\uffff,\u0001\uffff,\u0001\uffff,\u0001\uffff,\u0001\uffff,\u0001\uffff,\u0001\uffff,,".split(",")});org.antlr.lang.augmentObject(FormulaParser,{DFA40_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA40_eotS),DFA40_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA40_eofS),DFA40_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA40_minS),
DFA40_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA40_maxS),DFA40_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA40_acceptS),DFA40_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA40_specialS),DFA40_transition:function(){var a=[],b,c=FormulaParser.DFA40_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA40_transitionS[b]));return a}()});FormulaParser.DFA40=function(a){this.recognizer=
a;this.decisionNumber=40;this.eot=FormulaParser.DFA40_eot;this.eof=FormulaParser.DFA40_eof;this.min=FormulaParser.DFA40_min;this.max=FormulaParser.DFA40_max;this.accept=FormulaParser.DFA40_accept;this.special=FormulaParser.DFA40_special;this.transition=FormulaParser.DFA40_transition};org.antlr.lang.extend(FormulaParser.DFA40,org.antlr.runtime.DFA,{getDescription:function(){return"209:1: primaryExpression : ( ( innerPrimaryExpression array )=> innerPrimaryExpression array | innerPrimaryExpression );"},
specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 1:b.LA(1);c=b.index();b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 2:b.LA(1);c=b.index();b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 3:b.LA(1);c=b.index();b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 4:b.LA(1);c=b.index();
b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 5:b.LA(1);c=b.index();b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 6:b.LA(1);c=b.index();b.rewind();a=this.synpred1_Formula()?9:10;b.seek(c);if(0<=a)return a;break;case 7:if(b.LA(1),c=b.index(),b.rewind(),a=this.synpred1_Formula()?9:10,b.seek(c),0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),40,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{tokenNames:"<invalid> <EOR> <DOWN> <UP> NEGATE ASSIGN FUNCALL MATERIAL UNIT POWER DEFAULTS PARAMS UNITCLUMP ARRAY LINES WHILE IFTHENELSE ELSE FOR FORIN FUNCTION NUMBER NEWLINE W H I L E WHILESTATEMENT F O R FORSTATEMENT M FROMSTATEMENT N INSTATEMENT T TOSTATEMENT B Y BYSTATEMENT P LOOPSTATEMENT IFSTATEMENT THENSTATEMENT S ELSESTATEMENT U C FUNCTIONSTATEMENT D ENDBLOCK RETURNSTATEMENT IDENT EQUALS PRIMITIVE OR AND A NOTEQUALS LT LTEQ GT GTEQ PLUS MINUS MULT DIV MOD POW NOT LARR RARR INTEGER FLOAT TRUE FALSE PER CUBED SQUARED Q COMMENT LINE_COMMENT WS G J K V X Z STRING '(' ',' ')' '<-' '{' '}'".split(" "),
FOLLOW_NEWLINE_in_lines116:new org.antlr.runtime.BitSet([272629760,23334913,402668932,1]),FOLLOW_expression_in_lines120:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_lines124:new org.antlr.runtime.BitSet([272629760,23334913,402668932,1]),FOLLOW_EOF_in_lines127:new org.antlr.runtime.BitSet([268435456,23334913,402668932,1]),FOLLOW_EOF_in_lines132:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression394:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression400:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_whileLoop_in_expression406:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression412:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression418:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression424:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression430:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression436:new org.antlr.runtime.BitSet([2,0]),FOLLOW_RETURNSTATEMENT_in_returnExp448:new org.antlr.runtime.BitSet([0,20971520,
402668932,1]),FOLLOW_logicalExpression_in_returnExp451:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock464:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_innerBlock468:new org.antlr.runtime.BitSet([272629762,23334913,402668932,1]),FOLLOW_WHILESTATEMENT_in_whileLoop493:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_whileLoop495:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_whileLoop497:new org.antlr.runtime.BitSet([272629760,
24383489,402668932,1]),FOLLOW_innerBlock_in_whileLoop500:new org.antlr.runtime.BitSet([0,1048576]),FOLLOW_ENDBLOCK_in_whileLoop503:new org.antlr.runtime.BitSet([0,2048]),FOLLOW_LOOPSTATEMENT_in_whileLoop505:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop526:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IDENT_in_forLoop528:new org.antlr.runtime.BitSet([0,4]),FOLLOW_FROMSTATEMENT_in_forLoop530:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_forLoop532:new org.antlr.runtime.BitSet([0,
64]),FOLLOW_TOSTATEMENT_in_forLoop534:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_forLoop536:new org.antlr.runtime.BitSet([4194304,512]),FOLLOW_BYSTATEMENT_in_forLoop539:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_forLoop541:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_forLoop545:new org.antlr.runtime.BitSet([272629760,24383489,402668932,1]),FOLLOW_innerBlock_in_forLoop548:new org.antlr.runtime.BitSet([0,
1048576]),FOLLOW_ENDBLOCK_in_forLoop551:new org.antlr.runtime.BitSet([0,2048]),FOLLOW_LOOPSTATEMENT_in_forLoop553:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop581:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IDENT_in_forInLoop583:new org.antlr.runtime.BitSet([0,16]),FOLLOW_INSTATEMENT_in_forInLoop585:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_forInLoop587:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_forInLoop589:new org.antlr.runtime.BitSet([272629760,
24383489,402668932,1]),FOLLOW_innerBlock_in_forInLoop592:new org.antlr.runtime.BitSet([0,1048576]),FOLLOW_ENDBLOCK_in_forInLoop595:new org.antlr.runtime.BitSet([0,2048]),FOLLOW_LOOPSTATEMENT_in_forInLoop597:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse622:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_ifThenElse624:new org.antlr.runtime.BitSet([0,8192]),FOLLOW_THENSTATEMENT_in_ifThenElse626:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_ifThenElse629:new org.antlr.runtime.BitSet([272629760,
24416257,402668932,1]),FOLLOW_innerBlock_in_ifThenElse632:new org.antlr.runtime.BitSet([0,1081344]),FOLLOW_ELSESTATEMENT_in_ifThenElse636:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_IFSTATEMENT_in_ifThenElse638:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_ifThenElse640:new org.antlr.runtime.BitSet([0,8192]),FOLLOW_THENSTATEMENT_in_ifThenElse642:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_ifThenElse644:new org.antlr.runtime.BitSet([272629760,
24416257,402668932,1]),FOLLOW_innerBlock_in_ifThenElse647:new org.antlr.runtime.BitSet([0,1081344]),FOLLOW_ELSESTATEMENT_in_ifThenElse652:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_ifThenElse654:new org.antlr.runtime.BitSet([272629760,24383489,402668932,1]),FOLLOW_innerBlock_in_ifThenElse657:new org.antlr.runtime.BitSet([0,1048576]),FOLLOW_ENDBLOCK_in_ifThenElse661:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_IFSTATEMENT_in_ifThenElse663:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef694:new org.antlr.runtime.BitSet([0,
4194304]),FOLLOW_IDENT_in_functionDef696:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_92_in_functionDef698:new org.antlr.runtime.BitSet([0,4194304,1073741824,0]),FOLLOW_IDENT_in_functionDef701:new org.antlr.runtime.BitSet([0,8388608,1610612736,0]),FOLLOW_EQUALS_in_functionDef705:new org.antlr.runtime.BitSet([0,0,134233092,0]),FOLLOW_defaultValue_in_functionDef708:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_93_in_functionDef713:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IDENT_in_functionDef715:new org.antlr.runtime.BitSet([0,
0,1610612736,0]),FOLLOW_93_in_functionDef722:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IDENT_in_functionDef724:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_EQUALS_in_functionDef726:new org.antlr.runtime.BitSet([0,0,134233092,0]),FOLLOW_defaultValue_in_functionDef728:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_94_in_functionDef735:new org.antlr.runtime.BitSet([4194304,0]),FOLLOW_NEWLINE_in_functionDef737:new org.antlr.runtime.BitSet([272629760,24383489,402668932,1]),FOLLOW_innerBlock_in_functionDef740:new org.antlr.runtime.BitSet([0,
1048576]),FOLLOW_ENDBLOCK_in_functionDef743:new org.antlr.runtime.BitSet([0,262144]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef745:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment780:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_92_in_assignment782:new org.antlr.runtime.BitSet([0,4194304,1073741824,0]),FOLLOW_IDENT_in_assignment785:new org.antlr.runtime.BitSet([0,8388608,1610612736,0]),FOLLOW_EQUALS_in_assignment789:new org.antlr.runtime.BitSet([0,0,134233092,0]),FOLLOW_defaultValue_in_assignment791:new org.antlr.runtime.BitSet([0,
0,1610612736,0]),FOLLOW_93_in_assignment796:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IDENT_in_assignment798:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_93_in_assignment805:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IDENT_in_assignment807:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_EQUALS_in_assignment809:new org.antlr.runtime.BitSet([0,0,134233092,0]),FOLLOW_defaultValue_in_assignment811:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_94_in_assignment818:new org.antlr.runtime.BitSet([0,
0,2147483648,0]),FOLLOW_95_in_assignment820:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_assignment822:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment850:new org.antlr.runtime.BitSet([0,0,2684354560,0]),FOLLOW_IDENT_in_assignment854:new org.antlr.runtime.BitSet([0,0,2684354560,0]),FOLLOW_93_in_assignment858:new org.antlr.runtime.BitSet([0,20971520]),FOLLOW_PRIMITIVE_in_assignment861:new org.antlr.runtime.BitSet([0,0,2684354560,0]),FOLLOW_IDENT_in_assignment865:new org.antlr.runtime.BitSet([0,
0,2684354560,0]),FOLLOW_95_in_assignment871:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_assignment873:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanAndExpression_in_logicalExpression900:new org.antlr.runtime.BitSet([2,33554432]),FOLLOW_OR_in_logicalExpression903:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_booleanAndExpression_in_logicalExpression906:new org.antlr.runtime.BitSet([2,33554432]),FOLLOW_equalityExpression_in_booleanAndExpression937:new org.antlr.runtime.BitSet([2,
67108864]),FOLLOW_AND_in_booleanAndExpression940:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_equalityExpression_in_booleanAndExpression943:new org.antlr.runtime.BitSet([2,67108864]),FOLLOW_relationalExpression_in_equalityExpression974:new org.antlr.runtime.BitSet([2,276824064]),FOLLOW_set_in_equalityExpression977:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_relationalExpression_in_equalityExpression984:new org.antlr.runtime.BitSet([2,276824064]),FOLLOW_additiveExpression_in_relationalExpression1026:new org.antlr.runtime.BitSet([2,
3758096384,1,0]),FOLLOW_set_in_relationalExpression1030:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_additiveExpression_in_relationalExpression1041:new org.antlr.runtime.BitSet([2,3758096384,1,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1084:new org.antlr.runtime.BitSet([2,0,6,0]),FOLLOW_set_in_additiveExpression1088:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_multiplicativeExpression_in_additiveExpression1095:new org.antlr.runtime.BitSet([2,0,6,0]),
FOLLOW_negationExpression_in_multiplicativeExpression1125:new org.antlr.runtime.BitSet([2,0,56,0]),FOLLOW_set_in_multiplicativeExpression1129:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_negationExpression_in_multiplicativeExpression1138:new org.antlr.runtime.BitSet([2,0,56,0]),FOLLOW_MINUS_in_negationExpression1183:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_powerExpression_in_negationExpression1185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_powerExpression_in_negationExpression1199:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_unaryExpression_in_powerExpression1210:new org.antlr.runtime.BitSet([2,0,64,0]),FOLLOW_POW_in_powerExpression1213:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_unaryOrNegate_in_powerExpression1215:new org.antlr.runtime.BitSet([2,0,64,0]),FOLLOW_unaryExpression_in_unaryOrNegate1242:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1248:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_unaryExpression_in_unaryOrNegate1250:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_NOT_in_unaryExpression1278:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_primaryExpression_in_unaryExpression1281:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_unaryExpression1293:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_primaryExpression1334:new org.antlr.runtime.BitSet([0,20971520,402668800,1]),FOLLOW_array_in_primaryExpression1337:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_primaryExpression1343:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_92_in_innerPrimaryExpression1353:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_innerPrimaryExpression1356:new org.antlr.runtime.BitSet([0,0,1073741824,0]),FOLLOW_94_in_innerPrimaryExpression1358:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_innerPrimaryExpression1364:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1378:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1384:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_value1390:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_material_in_value1396:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funOrIdent_in_value1401:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1406:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1411:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1427:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1433:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1439:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1445:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_LARR_in_array1457:new org.antlr.runtime.BitSet([0,20971520,402669444,1]),FOLLOW_logicalExpression_in_array1460:new org.antlr.runtime.BitSet([0,0,536871424,0]),FOLLOW_93_in_array1463:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_array1465:new org.antlr.runtime.BitSet([0,0,536871424,0]),FOLLOW_RARR_in_array1471:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber1524:new org.antlr.runtime.BitSet([0,
0,3072,0]),FOLLOW_number_in_negnumber1526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_96_in_material1678:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_additiveExpression_in_material1680:new org.antlr.runtime.BitSet([0,4194304,268436480,0]),FOLLOW_unitMultiplicativeExpression_in_material1682:new org.antlr.runtime.BitSet([0,0,0,2]),FOLLOW_97_in_material1684:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression1721:new org.antlr.runtime.BitSet([2,
0,16384,0]),FOLLOW_PER_in_unitMultiplicativeExpression1725:new org.antlr.runtime.BitSet([0,4194304,268436480,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression1728:new org.antlr.runtime.BitSet([2,0,16384,0]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression1744:new org.antlr.runtime.BitSet([2,0,24,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression1748:new org.antlr.runtime.BitSet([0,4194304,268436480,0]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression1755:new org.antlr.runtime.BitSet([2,
0,24,0]),FOLLOW_INTEGER_in_unitClump1771:new org.antlr.runtime.BitSet([0,0,16,0]),FOLLOW_DIV_in_unitClump1773:new org.antlr.runtime.BitSet([0,4194304,268436480,0]),FOLLOW_unitPowerExpression_in_unitClump1776:new org.antlr.runtime.BitSet([2,0,98304,0]),FOLLOW_CUBED_in_unitClump1778:new org.antlr.runtime.BitSet([2,0,65536,0]),FOLLOW_SQUARED_in_unitClump1781:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump1804:new org.antlr.runtime.BitSet([2,0,98304,0]),FOLLOW_CUBED_in_unitClump1806:new org.antlr.runtime.BitSet([2,
0,65536,0]),FOLLOW_SQUARED_in_unitClump1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression1871:new org.antlr.runtime.BitSet([2,0,64,0]),FOLLOW_POW_in_unitPowerExpression1875:new org.antlr.runtime.BitSet([0,0,3076,0]),FOLLOW_MINUS_in_unitPowerExpression1878:new org.antlr.runtime.BitSet([0,0,3072,0]),FOLLOW_set_in_unitPowerExpression1881:new org.antlr.runtime.BitSet([2,0,64,0]),FOLLOW_IDENT_in_unit1899:new org.antlr.runtime.BitSet([2,4194304]),FOLLOW_IDENT_in_unit1902:new org.antlr.runtime.BitSet([2,
4194304]),FOLLOW_92_in_unit1919:new org.antlr.runtime.BitSet([0,4194304,268436480,0]),FOLLOW_unitMultiplicativeExpression_in_unit1921:new org.antlr.runtime.BitSet([0,0,1073741824,0]),FOLLOW_94_in_unit1923:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_funOrIdent1969:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_92_in_funOrIdent1971:new org.antlr.runtime.BitSet([0,20971520,1476410756,1]),FOLLOW_logicalExpression_in_funOrIdent1975:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_93_in_funOrIdent1978:new org.antlr.runtime.BitSet([0,
20971520,402668932,1]),FOLLOW_logicalExpression_in_funOrIdent1980:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_94_in_funOrIdent1987:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_funOrIdent2004:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2060:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_synpred1_Formula1326:new org.antlr.runtime.BitSet([0,20971520,402668800,1]),FOLLOW_array_in_synpred1_Formula1329:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_IDENT_in_synpred2_Formula1948:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_92_in_synpred2_Formula1950:new org.antlr.runtime.BitSet([0,20971520,1476410756,1]),FOLLOW_logicalExpression_in_synpred2_Formula1954:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_93_in_synpred2_Formula1957:new org.antlr.runtime.BitSet([0,20971520,402668932,1]),FOLLOW_logicalExpression_in_synpred2_Formula1959:new org.antlr.runtime.BitSet([0,0,1610612736,0]),FOLLOW_94_in_synpred2_Formula1966:new org.antlr.runtime.BitSet([2,
0])})})();function RandList(){this.vals=[]}RandList.prototype.get=function(a){if(a>this.vals.length-1)for(var b=this.vals.length;b<=a;b++)this.vals.push(Math.random());return this.vals[a]};var PreviousRandLists=[],RandLoc=-1,lastRandPos=-1,RKOrder=1;function getRandPos(){return void 0===window.timeStep?0:Math.floor(time.value/timeStep.value)}
function Rand(a,b){if(null!=a)return Rand()*(b-a)+parseFloat(a);if(1==RKOrder)return Math.random();var c=getRandPos();c!=lastRandPos&&(RandLoc=-1,lastRandPos=c);for(;PreviousRandLists.length<=c;)PreviousRandLists.push(new RandList);RandLoc+=1;return PreviousRandLists[c].get(RandLoc)}function RandNormal(a,b){null==a&&(a=0);null==b&&(b=1);return Math.sqrt(-2*Math.log(1-Rand()))*Math.cos(6.283186*Rand())*b+parseFloat(a)}function RandExp(a){null==a&&(a=1);return-a*Math.log(Rand())}
function RandLognormal(a,b){var c=Math.log(a)-0.5*Math.log(1+Math.pow(b/a,2)),d=Math.sqrt(Math.log(1+Math.pow(b/a,2)));return Math.exp(RandNormal(c,d))}function RandBinomial(a,b){for(var c=0,d=1;d<=a;d++)Rand()<=b&&(c+=1);return c}function RandNegativeBinomial(a,b){for(var c=0,d=0;d<a;)Rand()<=b&&(d+=1),c+=1;return c}function RandPoisson(a){for(var a=Math.exp(-a),b=0,c=1;!(b+=1,c*=Rand(),!(c>a)););return b-1}function RandGamma(a,b){for(var c=1,d=1;d<=a;d++)c*=Rand();return-b*Math.log(c)}
function RandTriangular(a,b,c){if(a==b)throw"MSG: Maximum can't equal the minimum for the triangular distribution.";var a=parseFloat(a),b=parseFloat(b),c=parseFloat(c),d=(c-a)/(b-a),e=Rand();return e<d?a+Math.sqrt(e*(b-a)*(c-a)):b-Math.sqrt((1-e)*(b-a)*(b-c))};(function(a,b,c,d,e,f,g){function h(a){var b,d,e=this,f=a.length,g=0,h=e.i=e.j=e.m=0;e.S=[];e.c=[];for(f||(a=[f++]);g<c;)e.S[g]=g++;for(g=0;g<c;g++)b=e.S[g],h=h+b+a[g%f]&c-1,d=e.S[h],e.S[g]=d,e.S[h]=b;e.g=function(a){var b=e.S,d=e.i+1&c-1,f=b[d],g=e.j+f&c-1,h=b[g];b[d]=h;b[g]=f;for(var k=b[f+h&c-1];--a;)d=d+1&c-1,f=b[d],g=g+f&c-1,h=b[g],b[d]=h,b[g]=f,k=k*c+b[f+h&c-1];e.i=d;e.j=g;return k};e.g(c)}function k(a,b,c,d,e){c=[];e=typeof a;if(b&&"object"==e)for(d in a)if(5>d.indexOf("S"))try{c.push(k(a[d],
b-1))}catch(f){}return c.length?c:a+("string"!=e?"\x00":"")}function l(a,b,d,e){a+="";for(e=d=0;e<a.length;e++){var f=b,g=e&c-1,h=(d^=19*b[e&c-1])+a.charCodeAt(e);f[g]=h&c-1}a="";for(e in b)a+=String.fromCharCode(b[e]);return a}b.seedrandom=function(n,o){var p=[],r,n=l(k(o?[n,a]:arguments.length?n:[(new Date).getTime(),a,window],3),p);r=new h(p);l(r.S,a);b.random=function(){for(var a=r.g(d),b=g,h=0;a<e;)a=(a+h)*c,b*=c,h=r.g(1);for(;a>=f;)a/=2,b/=2,h>>>=1;return(a+h)/b};return n};g=b.pow(c,d);e=b.pow(2,
e);f=2*e;l(b.random(),a)})([],Math,256,6,52);if(!sn){var sn=SchemeNumber,fn=sn.fn,ns=fn["number->string"];sn.raise=function(a,b){if("division by exact zero"==b)throw"MSG: You cannot divide by 0.";throw"BigNum Error: "+b;}}var varBank={},functionBank={},primitiveBank={};varBank["-parent"]=null;varBank.e=new Material(2.718281828459045);varBank.pi=new Material(3.141592653589793);varBank.phi=new Material(1.61803399);Agent||(Agent=function(){});Agents||(Agents=function(){});var PrimitiveStore=function(a,b){this.primitive=a;this.type=b};
Boolean.prototype.toNum=function(){return this.valueOf()};String.prototype.toNum=function(){return this.valueOf()};Number.prototype.toNum=function(){return this.valueOf()};var Vector=function(a){this.items=a};Vector.prototype.toNum=function(){if(this.isNum)return this;for(var a=0;a<this.items.length;a++)this.items[a]=this.items[a].toNum();this.isNum=!0;return this};
Vector.prototype.toString=function(){return"&laquo;"+this.items.map(function(a){return prepareDisplay(a.toNum().toString())}).join(", ")+"&raquo;"};Vector.prototype.length=function(){return this.items.length};Vector.prototype.combine=function(a,b,c){if(a instanceof Vector&&this.length()!=a.length())throw"MSG: Vectors must have equal length when combined.";for(var d=0;d<this.length();d++){var e;e=a instanceof Vector?a.items[d]:a;this.items[d]=c?b(e,this.items[d]):b(this.items[d],e)}return this};
Vector.prototype.apply=function(a){for(var b=0;b<this.items.length;b++)this.items[b]=a(this.items[b]);return this};Vector.prototype.clone=function(){for(var a=[],b=0;b<this.items.length;b++)this.items[b]instanceof Vector?a.push(this.items[b].clone()):a.push(this.items[b]);return new Vector(a)};Vector.prototype.fullClone=Vector.prototype.clone;
Vector.prototype.equals=function(a){if(this.length()!=a.length())return!1;for(var b=0;b<this.items.length;b++)if(!strictEquals(this.items[b],a.items[b]))return!1;return!0};
Primitive||(Primitive=function(a){this.v=a},Primitive.prototype.value=function(){return this.v.fullClone()},Primitive.prototype.setValue=function(a){return this.v=a},Primitive.prototype.toNum=function(){return this.v.fullClone()},Primitive.prototype.toString=function(){return"Primitive Reference"},primitiveBank.test=new Primitive(new Material(3)),primitiveBank["test vector"]=new Primitive(new Vector([new Material(1),new Material(2),new Material(3)])));
function strictEquals(a,b){if(a instanceof Agent||b instanceof Agent){if(a instanceof Agent&&b instanceof Agent&&a.instanceId==b.instanceId)return!0}else if(a instanceof Vector||b instanceof Vector){if(a instanceof Vector&&b instanceof Vector&&a.equals(b))return!0}else if(eq(a,b))return!0;return!1}
function createTree(a){var a=new org.antlr.runtime.ANTLRStringStream(a.replace(/\\n/g,"\n")),a=new FormulaLexer(a),a=new org.antlr.runtime.CommonTokenStream(a),a=new FormulaParser(a),b=a.lines(),a=convertToObject(b.tree,a);isLocal();return a}function trimTree(a,b){return trimNode(a,b)}function evaluateTree(a,b){evaluatingLine=void 0;try{return evaluateNode(a,b)}catch(c){if(c.returnVal)return c.data;throw c;}}
function evaluate(a){var a=trimTree(createTree(a),primitiveBank),b;try{b=evaluateTree(a,varBank)}catch(c){if("PLOT"==c){b={isPlot:!0,data:[]};var d={};d["-parent"]=varBank;for(var e=-100;100>=e;e+=1)d.x=new Material(e/10),b.data.push([e/10,0+evaluateTree(a,d).value]);return b}throw c;}b instanceof Material&&(a=new Quantities(b.units),b.value=fn["*"](b.value,sn("#e"+a.toBase)).toPrecision(21),b.units=a.units,"."==b.value.substr(b.value.length-1,1)&&(b.value=b.value.substring(0,b.value.length-1)),b.value=
b.value.replace(/\.?\+\.?/g,"+"),b.value=b.value.replace(/\.?\-\.?/g,"-"),b.value=b.value.replace(/\.i/g,"i"),b.value=b.value.replace(/(\d)i/g,"$1*<i>i</i>"),b.value=b.value.replace(/\.e/g,"e"),b.value=b.value.replace(/e\+/g,"e"),"+inf.0"==b.value?b.value="Infinity":"-inf.0"==b.value&&(b.value="-Infinity"));return b}var TreeNode=function(a,b,c){this.origText=a;this.text=a.toLowerCase();this.typeName=b;this.line=c;this.children=[]};
function convertToObject(a,b){var c=a.getToken(),c=new TreeNode(c.getText(),b.getTokenNames()[c.getType()],c.line);if(0<a.getChildCount())for(var d=a.getChildren(),e=0;e<d.length;e++)c.children.push(convertToObject(d[e],b)),!c.line&&c.children[c.children.length-1].line&&(c.line=c.children[c.children.length-1].line);return c}var funcEvalMap={},evaluatingLine=null;
funcEvalMap.LINES=function(a,b){if(0==a.children.length)return new Material(0);for(var c,d=0;d<a.children.length;d++){if("return"==a.children[d].text)throw{returnVal:!0,data:evaluateNode(a.children[d].children[0],b)};c=evaluateNode(a.children[d],b)}return c};funcEvalMap.NEGATE=function(a,b){return negate(evaluateNode(a.children[0],b).toNum())};
function negate(a){if(a instanceof Vector)return a.apply(negate);if("boolean"==typeof a)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";return new Material(fn["-"](a.value),a.units?a.units.clone():void 0)}funcEvalMap.AND=function(a,b){return funAnd(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function funAnd(a,b){return a instanceof Vector?a.combine(b,funAnd,!1):b instanceof Vector?b.combine(a,funAnd,!0):trueValue(a)&&trueValue(b)}funcEvalMap.OR=function(a,b){return funOr(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function funOr(a,b){return a instanceof Vector?a.combine(b,funOr,!1):b instanceof Vector?b.combine(a,funOr,!0):trueValue(a)||trueValue(b)}funcEvalMap.NOT=function(a,b){return fNot(evaluateNode(a.children[0],b).toNum())};
function fNot(a){return a instanceof Vector?a.apply(fNot):!trueValue(a)}funcEvalMap.NOTEQUALS=function(a,b){return neq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function neq(a,b){if("boolean"==typeof a&&!(b instanceof Vector)||"boolean"==typeof b&&!(a instanceof Vector))return trueValue(a)!=trueValue(b);if("string"==typeof a&&!(b instanceof Vector)||"string"==typeof b&&!(a instanceof Vector))return(a.toLowerCase?a.toLowerCase():a)!=(b.toLowerCase?b.toLowerCase():b);if(a instanceof Vector)return a.combine(b,neq,!1);if(b instanceof Vector)return b.combine(a,neq,!0);if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);if(0==c)return!0;b.value=
fn["*"](b.value,c);b.units=a.units?a.units.clone():void 0}return!fn["="](a.value,b.value)}funcEvalMap.EQUALS=function(a,b){return eq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function eq(a,b){if("boolean"==typeof a&&!(b instanceof Vector)||"boolean"==typeof b&&!(a instanceof Vector))return trueValue(a)==trueValue(b);if("string"==typeof a&&!(b instanceof Vector)||"string"==typeof b&&!(a instanceof Vector))return(a.toLowerCase?a.toLowerCase():a)==(b.toLowerCase?b.toLowerCase():b);if(a instanceof Vector)return a.combine(b,eq,!1);if(b instanceof Vector)return b.combine(a,eq,!0);if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);if(0==c)return!1;b.value=fn["*"](b.value,
c);b.units=a.units?a.units.clone():void 0}return fn["="](a.value,b.value)}funcEvalMap.LT=function(a,b){return lessThan(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function lessThan(a,b){if(a instanceof Vector)return a.combine(b,lessThan,!1);if(b instanceof Vector)return b.combine(a,lessThan,!0);if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);0==c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units?a.units.clone():void 0)}return fn["<"](a.value,b.value)}funcEvalMap.LTEQ=function(a,b){return lessThanEq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function lessThanEq(a,b){if(a instanceof Vector)return a.combine(b,lessThanEq,!1);if(b instanceof Vector)return b.combine(a,lessThanEq,!0);if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);0==c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units?a.units.clone():void 0)}return fn["<="](a.value,b.value)}funcEvalMap.GT=function(a,b){return greaterThan(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function greaterThan(a,b){if(a instanceof Vector)return a.combine(b,greaterThan,!1);if(b instanceof Vector)return b.combine(a,greaterThan,!0);if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);0==c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units?a.units.clone():void 0)}return fn[">"](a.value,b.value)}funcEvalMap.GTEQ=function(a,b){return greaterThanEq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function greaterThanEq(a,b){if(a instanceof Vector)return a.combine(b,greaterThanEq,!1);if(b instanceof Vector)return b.combine(a,greaterThanEq,!0);if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);0==c?unitAlert(a.units,b.units,"comparison"):b.value=fn["*"](b.value,c)}return fn[">="](a.value,b.value)}funcEvalMap.PLUS=function(a,b){return plus(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function plus(a,b){if(a instanceof Vector)return a.combine(b,plus,!1);if(b instanceof Vector)return b.combine(a,plus,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);0==c?unitAlert(a.units,b.units,"addition"):(b.value=fn["*"](b.value,c),b.units=a.units?a.units.clone():void 0)}return new Material(fn["+"](a.value,
b.value),b.units?b.units.clone():void 0)}funcEvalMap.MINUS=function(a,b){return minus(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function minus(a,b){if(a instanceof Vector)return a.combine(b,minus,!1);if(b instanceof Vector)return b.combine(a,minus,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(!unitsEqual(a.units,b.units)){var c=convertUnits(b.units,a.units);0==c?unitAlert(a.units,b.units,"subtraction"):(b.value=fn["*"](b.value,c),b.units=a.units?a.units.clone():void 0)}return new Material(fn["-"](a.value,
b.value),b.units?b.units.clone():void 0)}funcEvalMap.MULT=function(a,b){return mult(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function mult(a,b){if(a instanceof Vector)return a.combine(b,mult,!1);if(b instanceof Vector)return b.combine(a,mult,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=new Material(fn["*"](a.value,b.value));a.units&&b.units?(c.units=a.units.clone(),c.units.multiplyUnitStore(b.units,1),c.simplify()):a.units?c.units=a.units.clone():b.units&&(c.units=b.units.clone());
return c}funcEvalMap.DIV=function(a,b){return div(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function div(a,b){if(a instanceof Vector)return a.combine(b,div,!1);if(b instanceof Vector)return b.combine(a,div,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=new Material(fn["/"](a.value,b.value));if(a.units&&b.units)c.units=a.units.clone(),c.units.multiplyUnitStore(b.units,-1),c.simplify();else if(a.units)c.units=a.units.clone();else if(b.units){c.units=
b.units.clone();for(var d=0;d<c.units.exponents.length;d++)c.units.exponents[d]=-c.units.exponents[d]}return c}funcEvalMap.POWER=function(a,b){if(1==a.children.length)return evaluateNode(a.children[0],b);for(var c=evaluateNode(a.children[a.children.length-1],b).toNum(),d=a.children.length-1;0<d;d--){var e=evaluateNode(a.children[d-1],b).toNum();if(c instanceof Vector||unitless(c.units))c=power(e,c);else throw"MSG: Exponents may not have units.";}return c};
function power(a,b){if(a instanceof Vector)return a.combine(b,power,!1);if(b instanceof Vector)return b.combine(a,power,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(a.units)for(var c=0;c<a.units.exponents.length;c++)a.units.exponents[c]*=b.value;c=a.value;"number"==typeof c&&(c=sn("#e"+c));return new Material(fn.expt(c,b.value),a.units?a.units.clone():void 0)}
funcEvalMap.MOD=function(a,b){return doMod(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function doMod(a,b){if(a instanceof Vector)return a.combine(b,doMod,!1);if(b instanceof Vector)return b.combine(a,doMod,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(unitless(b.units))return new Material(fn.mod(a.value,b.value),a.units?a.units.clone():void 0);throw'MSG: The right hand side of "mod" may not have units.';}
funcEvalMap.IDENT=function(a,b){for(var c=a.text;!(c in b);)if(b["-parent"])b=b["-parent"];else{if(c in functionBank)return"fn"in functionBank[c]?functionBank[c].fn([]):functionBank[c]([]);if("x"==c&&void 0===window.timeStep)throw"PLOT";if("i"==c)return new Material(sn("i"));throw'MSG: The variable "'+a.origText+'" does not exist.';}return b[c].fullClone?b[c].fullClone():b[c]};funcEvalMap.ARRAY=function(a,b){for(var c=[],d=0;d<a.children.length;d++)c.push(evaluateNode(a.children[d],b));return new Vector(c)};
funcEvalMap.FUNCALL=function(a,b){if(!a.functionFingerprint){a.functionFingerprint="FINGERPRINT-"+Math.random();var c=a.children[0].text;if(functionBank[c])functionBank[c].fn?a.fn=functionBank[c].fn:(a.delayEvalParams=functionBank[c].delayEvalParams,a.fn=functionBank[c]);else throw'MSG: The function "'+a.children[0].origText+'" does not exist.';}c=[];if(a.delayEvalParams)for(var d=1;d<a.children.length;d++)c.push({node:a.children[d],scope:b});else for(d=1;d<a.children.length;d++)c.push(evaluateNode(a.children[d],
b));return a.fn(c,a.functionFingerprint)};
function makeFunctionCall(a,b,c,d){var e={localScope:{}};e.localScope.nVars=b.length;for(var f=0;f<b.length;f++)e.localScope[f+=""]=b[f];e.localScope["-parent"]=varBank;e.defaults=c;e.fn=function(b){if(e.localScope.nVars-e.defaults.length>b.length||b.length>e.localScope.nVars){for(var b=[],c=0;c<e.localScope.nVars;c++)-1<e.defaults.length-(e.localScope.nVars-c)?b.push(e.localScope[c+=""]+"="+e.defaults[e.defaults.length-(e.localScope.nVars-c)]):b.push(e.localScope[c+=""]);throw"MSG: Wrong number of parameters for "+
a+"("+b.join(", ")+").";}for(var f={"-parent":varBank},c=0;c<b.length;c++)f[e.localScope[c+=""]]=b[c];for(c=b.length;c<e.localScope.nVars;c++)f[e.localScope[c+=""]]=e.defaults[e.defaults.length-(e.localScope.nVars-c)];try{return evaluateNode(d,f)}catch(l){if(l.returnVal)return l.data;throw l;}};return e}funcEvalMap.WHILE=function(a,b){for(var c=new Material(0),d={"-parent":b};trueValue(evaluateNode(a.children[0],b).toNum());)c=evaluateNode(a.children[1],d);return c};
funcEvalMap.IFTHENELSE=function(a,b){for(var c={"-parent":b},d=0;d<a.children[0].children.length;d++)if(trueValue(evaluateNode(a.children[0].children[d],b).toNum()))return evaluateNode(a.children[1].children[d],c);return a.children[0].children.length!=a.children[1].children.length?evaluateNode(a.children[1].children[d],c):new Material(0)};
funcEvalMap.FORIN=function(a,b){var c=new Material(0),d=a.children[0].text,e={"-parent":b},f=evaluateNode(a.children[1],b);if(!(f instanceof Vector))throw"MSG: The in argument of a For-In loop mush be a a vector.";for(var g=0;g<f.items.length;g++)e[d]=f.items[g],c=evaluateNode(a.children[2],e);return c};
funcEvalMap.FOR=function(a,b){var c=new Material(0),d=a.children[0].text,e=evaluateNode(a.children[1].children[0],b).toNum(),f=new Material(1);3==a.children[1].children.length&&(f=evaluateNode(a.children[1].children[2],b).toNum());var g={"-parent":b};for(g[d]=e;fn[0<=f.value?"<=":">="](g[d].value,evaluateNode(a.children[1].children[1],b).toNum());)c=evaluateNode(a.children[2],g),g[d]=plus(g[d],f);return c};
funcEvalMap.FUNCTION=function(a){var b=a.children[0].children[0].text;functionGenerator(b,a.children[0],a.children[1],a.children[2]);return'"'+b+'" defined'};
funcEvalMap.ASSIGN=function(a,b){var c=a.children.length-1,d=evaluateNode(a.children[a.children.length-1],b);if(1<c&&(!(d instanceof Vector)||d.items.length<c))throw"MSG: Too few elements returned for assignment.";for(var e=0;e<c;e++)if(a.children[e]instanceof PrimitiveStore)1==c?a.children[e].primitive.setValue(d):a.children[e].primitive.setValue(d.items[e]);else{for(var f=a.children[e].text,g=b;null!==b["-parent"]&&!isDefined(b[f]);)b=b["-parent"];null===b["-parent"]&&isUndefined(b[f])&&(b=g);b[f]=
1==c?d:d.items[e]}return 1<c?new Vector(d.items.slice(0,c)):d};funcEvalMap.MATERIAL=function(a,b){var c=evaluateNode(a.children[0],b).toNum();if(!unitless(c.units))throw"MSG: Cannot create material where numeric part itself has units.";return new Material(c.value,a.children[1].clone())};function functionGenerator(a,b,c,d){for(var e=[],f=[],g=1;g<b.children.length;g++)e.push(b.children[g].text);for(g=0;g<c.children.length;g++)f.push(c.children[g]);functionBank[a]=makeFunctionCall(a,e,f,d)}
var unitEvalMap={MULT:function(a){return evaluateUnits(a.children[0]).concat(evaluateUnits(a.children[1]))},POW:function(a){var b=1,c=1;3==a.children.length&&(b*=-1,c++);var d=evaluateUnits(a.children[0]),a=evaluateUnits(a.children[c])*b;if(d instanceof Array){for(b=0;b<d.length;b++)d[b].exponent*=a;return d}return Math.pow(d,a)},DIV:function(a){for(var b=evaluateUnits(a.children[0]),a=evaluateUnits(a.children[1]),c=0;c<a.length;c++)a[c].exponent*=-1;return b.concat(a)}};unitEvalMap.PER=unitEvalMap.DIV;
unitEvalMap.UNIT=function(a){for(var b="",c=0;c<a.children.length;c++)b+=a.children[c].text,c<a.children.length-1&&(b+=" ");return[{id:b,exponent:1}]};
unitEvalMap.UNITCLUMP=function(a){var b=evaluateUnits(a.children[0]);if(1<a.children.length)for(var c=1;c<a.children.length;c++)if("NEGATE"==a.children[c].typeName)for(var d=0;d<b.length;d++)b[d].exponent*=-1;else if("SQUARED"==a.children[c].typeName)for(d=0;d<b.length;d++)b[d].exponent*=2;else if("CUBED"==a.children[c].typeName)for(d=0;d<b.length;d++)b[d].exponent*=3;return b};unitEvalMap.INTEGER=function(a){return parseInt(a.text)};unitEvalMap.FLOAT=function(a){return parseFloat(a.text)};
function evaluateUnits(a){return a instanceof Material?a.value:unitEvalMap[a.typeName](a)}function evaluateNode(a,b){if(a instanceof TreeNode)return evaluatingLine=a.line||evaluatingLine,funcEvalMap[a.typeName](a,b);if(a instanceof PrimitiveStore){if("totalValue"==a.type)return a.primitive.totalContents();if("object"==a.type)return a.primitive}else return a}
var trimEvalMap={POWER:function(a,b){if(1==a.children.length)return trimNode(a.children[0],b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c},TRUE:function(){return!0},FALSE:function(){return!1},STRING:function(a){return a.origText.substr(1,a.origText.length-2).replace(/\\n/g,"\n").replace(/\\r/g,"\r")},INTEGER:function(a){return new Material(sn("#e"+a.text))},MATERIAL:function(a,b){for(var c=a.children[0],d=trimNode(a.children[1],
b),c=evaluateUnits(c),e=[],f=[],g=0;g<c.length;g++){var h=f.indexOf(c[g].id);-1==h?(e.push(c[g].exponent),f.push(c[g].id)):e[h]+=c[g].exponent}if(d instanceof Material){if(!unitless(d.units))throw"MSG: Cannot create material where numeric part itself has units.";return new Material(d.value,new UnitStore(f,e))}c=new TreeNode(a.origText,"MATERIAL",a.line);c.children=[d,new UnitStore(f,e)];return c},MULT:function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(c instanceof Material&&
d instanceof Material)return mult(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e},DIV:function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(c instanceof Material&&d instanceof Material)return div(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e},PLUS:function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(c instanceof Material&&d instanceof Material)return plus(c,d);var e=new TreeNode(a.origText,
a.typeName,a.line);e.children=[c,d];return e},MINUS:function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(c instanceof Material&&d instanceof Material)return minus(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e}};trimEvalMap.FLOAT=trimEvalMap.INTEGER;
trimEvalMap.PRIMITIVE=function(a,b){var c;c="[["==a.text.substr(0,2)?new PrimitiveStore(b[a.text.substr(2,a.text.length-4)],"totalValue"):new PrimitiveStore(b[a.text.substr(1,a.text.length-2)],"object");if("undefined"===typeof c.primitive)throw"MSG: The primitive <i>"+a.origText+"</i> could not be found.";return c};
trimEvalMap.NEGATE=function(a,b){if(0==a.children.length)return new TreeNode(a.origText,a.typeName,a.line);var c=trimNode(a.children[0],b);if(c instanceof Material)return negate(c);var d=new TreeNode(a.origText,a.typeName,a.line);d.children=[c];return d};function trimNode(a,b){if(trimEvalMap.hasOwnProperty(a.typeName))return trimEvalMap[a.typeName](a,b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c}
function trueValue(a){if(a instanceof Vector)throw"MSG: Cannot use a vector as a boolean.";return a&&(isUndefined(a.value)||"0"!=a.value.toString()&&"0."!=a.value.toString())}function isLocal(){return"localhost"==document.location.hostname}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)};defineFunction("RandBoolean",{params:[{name:"Probability",defaultVal:0.5,noUnits:!0,noVector:!0}]},function(a){a=0!=a.length?a[0].toNum().value:0.5;return Rand()<a?!0:!1});defineFunction("Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(Rand(a[0].toNum().value,a[1].toNum().value)):new Material(Rand())});
defineFunction("RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(RandNormal(a[0].toNum().value,a[1].toNum().value)):new Material(RandNormal())});defineFunction("RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(RandExp(a[0].toNum().value)):new Material(RandExp())});
defineFunction("RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,noVector:!0}]},function(a){return new Material(RandLognormal(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},function(a){return new Material(RandBinomial(a[0].toNum().value,a[1].toNum().value))});
defineFunction("RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},function(a){return new Material(RandNegativeBinomial(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},function(a){return new Material(RandGamma(a[0].toNum().value,a[1].toNum().value))});
defineFunction("RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},function(a){return new Material(RandPoisson(a[0].toNum().value))});defineFunction("RandTriangular",{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,noVector:!0}]},function(a){return new Material(RandTriangular(a[0].toNum().value,a[1].toNum().value,a[2].toNum().value))});
defineFunction("Real",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();a.value=fn["real-part"](a.value);return a});defineFunction("Imag",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();a.value=fn["imag-part"](a.value);return a});defineFunction("Magnitude",{params:[{name:"Number"}]},function(a){if(a[0].toNum()instanceof Vector)return functionBank.sqrt([functionBank.sum([mult(a[0],a[0])])]);a=a[0].toNum();a.value=fn.magnitude(a.value);return a});
defineFunction("Angle",{params:[{name:"Number",noVector:!0}]},function(a){return new Material(fn.angle(a[0].toNum().value),new UnitStore(["Radians"],[1]))});defineFunction("Abs",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();a.value=fn.abs(a.value);return a});
defineFunction("sin",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();unitless(a.units)||(a=mult(a,new Material(1,new UnitStore(["Radians"],[-1]))));if(unitless(a.units))return new Material(fn.sin(a.value));throw"MSG: Non-angular units cannot be used in Sin().";});
defineFunction("cos",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();unitless(a.units)||(a=mult(a,new Material(1,new UnitStore(["Radians"],[-1]))));if(unitless(a.units))return new Material(fn.cos(a.value));throw"MSG: Non-angular units cannot be used in Cos().";});
defineFunction("tan",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();unitless(a.units)||(a=mult(a,new Material(1,new UnitStore(["Radians"],[-1]))));if(unitless(a.units))return new Material(fn.tan(a.value));throw"MSG: Non-angular units cannot be used in Tan().";});defineFunction("asin",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.asin(a[0].toNum().value))});defineFunction("acos",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.acos(a[0].toNum().value))});
defineFunction("atan",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.atan(a[0].toNum().value))});defineFunction("arcsin",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.asin(a[0].toNum().value),new UnitStore(["Radians"],[1]))});defineFunction("arccos",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.acos(a[0].toNum().value),new UnitStore(["Radians"],[1]))});
defineFunction("arctan",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.atan(a[0].toNum().value),new UnitStore(["Radians"],[1]))});defineFunction("Sqrt",{params:[{name:"Number",noVector:!0}]},function(a){a=a[0].toNum();a.value=fn.sqrt(a.value);if(a.units)for(var b=0;b<a.units.exponents.length;b++)a.units.exponents[b]/=2;return a});defineFunction("Ln",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.log(a[0].toNum().value))});
defineFunction("Log",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.log(a[0].toNum().value,10))});defineFunction("Logit",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){a=a[0].toNum();a.value=fn["-"](fn.log(a.value),fn.log(fn["-"](1,a.value)));return a});defineFunction("Expit",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){a=a[0].toNum();a.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](a.value))));return a});
defineFunction("Round",{params:[{name:"Number",noVector:!0,noUnits:!1}]},function(a){a=a[0].toNum();a.value=fn.round(a.value);return a});defineFunction("Ceiling",{params:[{name:"Number",noVector:!0,noUnits:!1}]},function(a){a=a[0].toNum();a.value=fn.ceiling(a.value);return a});defineFunction("Floor",{params:[{name:"Number",noVector:!0,noUnits:!1}]},function(a){a=a[0].toNum();a.value=fn.floor(a.value);return a});defineFunction("Exp",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){return new Material(fn.exp(a[0].toNum().value))});
functionBank.ifthenelse=function(a){testArgumentsSize(a,"IfThenElse",3,3);var b=evaluateNode(a[0].node,a[0].scope).toNum();return trueValue(b)?evaluateNode(a[1].node,a[1].scope):evaluateNode(a[2].node,a[2].scope)};functionBank.ifthenelse.delayEvalParams=!0;
functionBank.map=function(a){testArgumentsSize(a,"Map",2,2);var b=evaluateNode(a[0].node,a[0].scope);b instanceof Primitive&&(b=b.toNum());if(!(b instanceof Vector))throw"MSG: Map() requires a vector as its first argument.";var c=a[1].node,d={x:null,"-parent":a[0].scope};return b.apply(function(a){d.x=a;return evaluateNode(c,d)})};functionBank.map.delayEvalParams=!0;
functionBank.sample=function(a){testArgumentsSize(a,"Sample",2,3);var b=a[0].toNum(),c=a[1].toNum().value;if(!(b instanceof Vector))throw"MSG: Sample() requires a vector as its first argument.";if(0==c)return new Vector([]);var d=b.length(),e=a[2]&&trueValue(a[2].toNum());if(0==d)throw"MSG: Sample() requires a non-empty vector.";a=[];if(e)for(e=0;e<c;e++)a.push(b.items[Math.floor(Rand()*d)]);else{if(d<c)throw"MSG: Vector for Sample() is too small for the given sample size.";b=b.items.slice();for(e=
0;e<c;e++)a.push(b.splice(Math.floor(Rand()*b.length),1)[0])}return new Vector(a)};defineFunction("IndexOf",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0}]},function(a){var b=a[1];if(b instanceof Vector){for(var c=[],d=0;d<b.length();d++)c.push(findElement(b.items[d],a[0]));return new Vector(c)}return findElement(b,a[0])});
defineFunction("Contains",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0}]},function(a){return eq(new Material(0),functionBank.indexof(a))?!1:!0});function findElement(a,b){for(var c=0;c<b.length();c++)if(eq(a,b.items[c]))return new Material(c+1);return new Material(0)}
functionBank.filter=function(a){testArgumentsSize(a,"Filter",2,2);var b=evaluateNode(a[0].node,a[0].scope);b instanceof Primitive&&(b=b.toNum());if(!(b instanceof Vector))throw"MSG: Filter() requires a vector as its first agrument.";a=functionBank.map(a);return functionBank.select([b,a])};functionBank.filter.delayEvalParams=!0;functionBank.join=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d instanceof Primitive&&(d=d.toNum());d instanceof Vector?b=b.concat(d.items):b.push(d)}return new Vector(b)};
functionBank.repeat=function(a){testArgumentsSize(a,"Repeat",2,2);for(var b=evaluateNode(a[1].node,a[1].scope).toNum(),c=[],d={x:null,"-parent":a[1].scope},e=0;e<b;e++)d.x=new Material(e+1),c.push(evaluateNode(a[0].node,d));return new Vector(c)};functionBank.repeat.delayEvalParams=!0;
defineFunction("Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},function(a){a[1].toNum();if(a[1]instanceof Vector){for(var b=a[1].toNum(),c=!0,d=0;d<b.length();d++)if(b.items[d]instanceof Material){c=!1;break}if(!0==c){c=[];if(b.length()!=a[0].length())throw"MSG: Length of vector must be equal for boolean selection.";for(d=0;d<b.length();d++)trueValue(b.items[d])&&c.push(a[0].items[d])}else{c=[];for(d=0;d<b.length();d++){var e=b.items[d].value;if(0>=e||e>
a[0].length())throw"MSG: Selected element out of range.";c.push(a[0].items[e-1])}}return new Vector(c)}if(0<a[1].value&&a[1].value<=a[0].length())return a[0].items[a[1].value-1];throw"MSG: Selected element out of range.";});defineFunction("Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(a){return functionBank.join(a).items}},function(a){for(var b=[],c=a.length-1;0<=c;c--)b.push(a[c]);return new Vector(b)});
defineFunction("Sort",{allowEmpty:!0,params:{name:"Items..."},prep:function(a){return functionBank.flatten(a).toNum().items}},function(a){return new Vector(a.sort(function(a,c){return lessThan(a,c)?-1:greaterThan(a,c)?1:0}))});
defineFunction("Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(a){return functionBank.join(a).toNum().items}},function(a){if(0==a.length)return new Vector([]);for(var b=[],c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)if(strictEquals(a[c],b[e])){d=!0;break}d||b.push(a[c])}return new Vector(b)});defineFunction("Union",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){return functionBank.unique(functionBank.join(a).items)});
defineFunction("Intersection",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){for(var b=a[0],a=a[1],c=[],d=0;d<b.items.length;d++)for(var e=0;e<a.items.length;e++)if(strictEquals(b.items[d],a.items[e])){c.push(b.items[d]);break}return functionBank.unique(c)});
defineFunction("Difference",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){for(var b=a[0],a=a[1],c=[],d=0;d<b.items.length;d++){for(var e=!1,f=0;f<a.items.length;f++)if(strictEquals(b.items[d],a.items[f])){e=!0;break}e||c.push(b.items[d])}for(d=0;d<a.items.length;d++){e=!1;for(f=0;f<b.items.length;f++)if(strictEquals(a.items[d],b.items[f])){e=!0;break}e||c.push(a.items[d])}return functionBank.unique(c)});
defineFunction("Factorial",{params:[{name:"Number",noUnits:!0,noVector:!0}]},function(a){return new Material(factorial(a[0].toNum().value))});defineFunction("Max",{params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum().items}},function(a){for(var b=0,c=0;c<a.length;c++)if(!isNaN(0+a[c].value)){b=c;break}c+=1;for(c;c<a.length;c++)greaterThan(a[c],a[b])&&(b=c);return a[b]});
defineFunction("Min",{params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum().items}},function(a){for(var b=0,c=0;c<a.length;c++)if(!isNaN(0+a[c].value)){b=c;break}c+=1;for(c;c<a.length;c++)lessThan(a[c],a[b])&&(b=c);return a[b]});defineFunction("Mean",{params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum().items}},function(a){for(var b=a[0],c=1;c<a.length;c++)b=plus(b,a[c]);return div(b,new Material(a.length))});
defineFunction("Sum",{params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum().items}},function(a){for(var b=a[0],c=1;c<a.length;c++)b=plus(b,a[c]);return b});defineFunction("Product",{params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum().items}},function(a){for(var b=a[0],c=1;c<a.length;c++)b=mult(b,a[c]);return b});
defineFunction("Median",{params:{name:"Items..."},prep:function(a){return functionBank.sort(a).toNum().items}},function(a){return Math.floor((a.length-1)/2)==(a.length-1)/2?a[(a.length-1)/2]:div(plus(a[Math.floor((a.length-1)/2)],a[Math.ceil((a.length-1)/2)]),new Material(2))});
defineFunction("StdDev",{params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum().items}},function(a){if(1<a.length){for(var b=functionBank.mean(a),c=power(minus(a[0],b),new Material(2)),d=1;d<a.length;d++)c=plus(c,power(minus(a[d],b),new Material(2)));a=power(div(c,new Material(a.length-1)),new Material(0.5));return functionBank.real([a])}throw"MSG: You must have at least two elements to calculate the standard deviation.";});
defineFunction("Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){var b=a[0].toNum(),a=a[1].toNum();if(1>=b.length())throw"MSG: You must have at least two elements in your vectors to calculate their correlation.";if(b.length()!=a.length())throw"MSG: The vectors for Correlation() must be of the same size.";var c=functionBank.mean([b]),d=functionBank.mean([a]),e=functionBank.stddev([b]),f=functionBank.stddev([a]);return 0==e.value||0==f.value?new Material(0):
div(functionBank.sum([mult(minus(b.clone(),c),minus(a.clone(),d))]),mult(minus(functionBank.count([b]),new Material(1)),mult(e,f)))});functionBank.count=function(a){a=functionBank.join(a).items;return new Material(sn("#e"+a.length))};functionBank.flatten=function(a){a=functionBank.join(a).items;return new Vector(flatten(new Vector(a)))};function flatten(a){for(var b=[],c=0;c<a.length();c++)a.items[c]instanceof Vector?b=b.concat(flatten(a.items[c])):b.push(a.items[c]);return b}
defineFunction("SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},function(a){Math.seedrandom(a[0].toNum());return"Random Seed Set"});defineFunction("Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){alert(a[0]);return 1});defineFunction("Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){console.log(a[0]);return 1});
defineFunction("Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",defaultVal:"",allowString:!0,allowBoolean:!0}]},function(a){var b=a[1];b instanceof Material&&unitless(b.units)&&(b=b.value);a=prompt(a[0],b);return parseFloat(a).toString()==a?new Material(parseFloat(a)):a});defineFunction("Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){return confirm(a[0])});
function defineFunction(a,b,c){for(var d=b.params,e=$.isArray(d),f=d.length,g=0;g<d.length;g++)if(d[g].hasOwnProperty("defaultVal")){f=g;break}var h;h=e?a+"("+d.map(function(a){return a.name+(a.hasOwnProperty("defaultVal")?"="+a.defaultVal.toString():"")}).join(", ")+")":a+"(items...)";functionBank[a.toLowerCase()]=function(g,l){b.prep&&(g=b.prep(g));if(e&&(g.length>d.length||g.length<f))throw"MSG: Wrong number of parameters for "+h+".";if(!e&&0==g.length&&!b.allowEmpty)throw"MSG: At least one parameter required for "+
a+"().";for(var n=0;n<g.length;n++){var o=e?d[n]:d;if(o.noUnits&&g[n].toNum()instanceof Material&&!unitless(g[n].toNum().units))throw"MSG: "+h+" does not except units for the argument '"+o.name+"'.";if(o.noVector&&g[n]instanceof Vector)throw"MSG: "+h+" does not except vectors for the argument '"+o.name+"'.";if(o.needVector&&(g[n]instanceof Primitive&&(g[n]=g[n].toNum()),!(g[n]instanceof Vector)))throw"MSG: "+h+" requires a vector for the argument '"+o.name+"'.";if(o.needPrimitive&&!(g[n]instanceof
Primitive))throw"MSG: "+h+" requires a primitive for the argument '"+o.name+"'.";if(!o.allowBoolean&&"boolean"==typeof g[n])throw"MSG: "+h+" does not accept boolean values.";o.needAgent&&!(g[n]instanceof Agent)&&(g[n]=agent(g[n],h,o.name));if(!o.allowString&&"string"==typeof g[n])throw"MSG: "+h+" does not accept string values.";o.needAgents&&!(g[n]instanceof Agents)&&(g[n]=agents(g[n],h,o.name));o.needPopulation&&!(g[n]instanceof Vector)&&(g[n]=getPopulation(g[n],h,o.name))}return c(g,l)}}
function factorial(a){if(Math.round(a)!=a)throw"MSG: The factorial() function only accepts integers.";if(0>a)throw"MSG: The factorial() function is only defined for integers 0 or larger.";return 1<a?a*factorial(a-1):1}function testArgumentsSize(a,b,c,d){if(a.length<c||a.length>d)throw"MSG: Wrong number of parameters for "+b+"().";};defineFunction("Stop",{params:[]},function(){throw{msg:"STOP"};});defineFunction("Time",{params:[]},function(){return time.fullClone()});defineFunction("TimeStep",{params:[]},function(){return timeStep.fullClone()});defineFunction("TimeLength",{params:[]},function(){return timeLength.fullClone()});defineFunction("TimeStart",{params:[]},function(){return timeStart.fullClone()});defineFunction("TimeEnd",{params:[]},function(){return plus(timeStart,timeLength)});
defineFunction("Seconds",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["seconds"],[-1])))});defineFunction("Minutes",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["minutes"],[-1])))});
defineFunction("Hours",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["hours"],[-1])))});defineFunction("Days",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["days"],[-1])))});
defineFunction("Weeks",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["weeks"],[-1])))});defineFunction("Months",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["months"],[-1])))});
defineFunction("Years",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?time.fullClone():a[0].toNum();return mult(a,new Material(1,new UnitStore(["years"],[-1])))});defineFunction("Unitless",{params:[{name:"Value",noVector:!0}]},function(a){return new Material(a[0].toNum().value)});
defineFunction("PastMean",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.mean(a[0].getPastValues()):functionBank.mean(a[0].getPastValues(a[1].toNum()))});defineFunction("PastMedian",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.median(a[0].getPastValues()):functionBank.median(a[0].getPastValues(a[1].toNum()))});
defineFunction("PastValues",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){a=1==a.length?a[0].getPastValues():a[0].getPastValues(a[1].toNum());return new Vector(a)});
defineFunction("PastStdDev",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){a=1==a.length?a[0].getPastValues():a[0].getPastValues(a[1].toNum());return 1<a.length?functionBank.stddev(a):new Material(0)});
defineFunction("PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",needPrimitive:!0,noVector:!0}]},function(a){var b;2==a.length?(b=a[0].getPastValues(),a=a[1].getPastValues()):(b=a[0].getPastValues(a[3].toNum()),a=a[1].getPastValues(a[3].toNum()));return 1<b.length?functionBank.correlation([new Vector(b),new Vector(a)]):new Material(0)});
defineFunction("PastMax",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.max(a[0].getPastValues()):functionBank.max(a[0].getPastValues(a[1].toNum()))});defineFunction("PastMin",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.min(a[0].getPastValues()):functionBank.min(a[0].getPastValues(a[1].toNum()))});
defineFunction("Pulse",{params:[{name:"Start Time",noVector:!0},{name:"Height",noVector:!0,defaultVal:1},{name:"Width",noVector:!0,defaultVal:0},{name:"Repeat Period",noVector:!0,defaultVal:0}]},function(a){var b=a[0].toNum(),c=new Material(1),d=new Material(0),e=new Material(0);1<a.length&&(c=a[1].toNum(),2<a.length&&(d=a[2].toNum(),3<a.length&&(e=a[3].toNum())));unitless(b.units)&&(b.units=time.units.clone());unitless(d.units)&&(d.units=time.units.clone());unitless(e.units)&&(e.units=time.units.clone());
if(0>=e.value){if(eq(time,b)||greaterThanEq(time,b)&&lessThanEq(time,plus(b,d)))return c}else if(greaterThanEq(time,b)){var a=minus(time,mult(functionBank.floor([div(minus(time,b),e)]),e)),f=minus(time,b);if(0==minus(functionBank.round([div(f,e)]),div(f,e)).value||greaterThanEq(a,b)&&lessThanEq(a,plus(b,d)))return c}return new Material(0)});
defineFunction("Ramp",{params:[{name:"Start Time",noVector:!0},{name:"Finish Time",noVector:!0},{name:"Height",noVector:!0,defaultVal:1}]},function(a){var b=a[0].toNum(),c=a[1].toNum(),d=new Material(1);3==a.length&&(d=a[2].toNum());unitless(b.units)&&(b.units=time.units.clone());unitless(c.units)&&(c.units=time.units.clone());return greaterThanEq(time,b)?div(mult(functionBank.min([minus(c,b),minus(time,b)]),d),minus(c,b)):new Material(0)});
defineFunction("Step",{params:[{name:"Start Time",noVector:!0},{name:"Height",noVector:!0,defaultVal:1}]},function(a){var b=a[0].toNum(),c=new Material(1);2==a.length&&(c=a[1].toNum());unitless(b.units)&&(b.units=time.units.clone());return greaterThanEq(time,b)?c:new Material(0)});functionBank.staircase=functionBank.step;
defineFunction("Smooth",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The smoothing period must be greater than 0.";return 2==a.length?a[0].smoothF(a[1].toNum()):a[0].smoothF(a[1].toNum(),a[2].toNum())});
defineFunction("Delay",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>a[1].toNum().value)throw"MSG: The delay must be greater than or equal to 0.";return 2==a.length?a[0].pastValue(a[1].toNum()):a[0].pastValue(a[1].toNum(),a[2].toNum())});
defineFunction("Delay1",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The delay must be greater than 0.";return 2==a.length?a[0].expDelayF(1,a[1].toNum()):a[0].expDelayF(1,a[1].toNum(),a[2].toNum())});
defineFunction("Delay3",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The delay must be greater than 0.";return 2==a.length?a[0].expDelayF(3,a[1].toNum()):a[0].expDelayF(3,a[1].toNum(),a[2].toNum())});
defineFunction("Exp",{params:[{name:"Number",noVector:!0,noUnits:!0}]},function(a){a=a[0].toNum();a.value=fn.exp(a.value);if(fn["imag-part"]&&0!=fn["imag-part"](a.value))throw"MSG: Exp() function resulted in an imaginary result.";a.value=fn["real-part"](a.value);return a});
functionBank.fix=function(a,b){testArgumentsSize(a,"Fix",1,2);var c=-1;2==a.length&&(c=evaluateNode(a[1].node,a[1].scope).toNum());for(var d=null,e=0;e<oldAggregateSeries.length;e++)if(oldAggregateSeries[e].match(b)){d=oldAggregateSeries[e];break}null===d&&(d=new AggregateSeries(b,c),oldAggregateSeries.push(d));return d.get(a[0])};functionBank.fix.delayEvalParams=!0;
function getPopulation(a){return a.items?a:a instanceof Agents?new Vector(a.agents.slice()):a.toNum()instanceof Vector?a.toNum():new Vector([agent(a)])}functionBank.populationsize=function(a){testArgumentsSize(a,"PopulationSize",1,1);if(a[0]instanceof Agents)return new Material(sn("#e"+a[0].agents.length));throw"MSG: PopulationSize must be passed an agent population as an argument.";};
defineFunction("Remove",{params:[{needAgent:!0,name:"[Agent]"}]},function(a){a[0].parent.nextDie.push(a[0]);simulate.agentsChanged=!0;return new Material(1)});defineFunction("Add",{params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},function(a){for(;!(a[0]instanceof Agents)&&null!=a[0].parent;)a[0]=a[0].parent;if(!(a[0]instanceof Agents))throw"MSG: You must pass an agent population as the first argument to Create().";return 2==a.length?a[0].add(a[1]):a[0].add()});
defineFunction("FindAll",{params:[{needPopulation:!0,name:"[Agent Population]"}]},function(a){return a[0]});defineFunction("ResetTimer",{params:[{needPrimitive:!0,name:"[Action]"}]},function(a){if(!(a[0]instanceof Action))throw"ResetTimer requires an Action primitive.";a[0].resetTimer();return new Material(0)});
defineFunction("Transition",{params:[{needPrimitive:!0,name:"[Transition]"}]},function(a){if(!(a[0]instanceof Transition))throw"Transition requires an Transition primitive.";a[0].doTransition();return new Material(0)});
defineFunction("Value",{params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},function(a){var b=a[1].id,c=null;a[0]instanceof Agents&&(c=getPopulation(a[0]));a[0]instanceof Vector&&(c=a[0]);if(null!==c){for(var a=[],d=-1,e=0;e<c.items.length;e++)if(-1!=d)a.push(c.items[e].children[d]);else for(var f=0;f<c.items[e].children.length;f++)if(c.items[e].children[f].id==b){a.push(c.items[e].children[f]);d=f;break}return new Vector(a)}if(a[0]instanceof Agent){for(f=0;f<a[0].children.length;f++)if(a[0].children[f].id==
b)return a[0].children[f];throw'MSG: Could not find referenced primitive for "Value()".';}throw'MSG: Invalid type for the first argument of "Value()".';});
defineFunction("SetValue",{params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},function(a){var b=a[1].id,c=null;a[0]instanceof Agents&&(c=getPopulation(a[0]));a[0]instanceof Vector&&(c=a[0]);if(null!==c){for(var d=0;d<c.length();d++)for(var e=0;e<c.items[d].children.length;e++)c.items[d].children[e].id==b&&c.items[d].children[e].setValue(a[2]);return new Material(1)}if(a[0]instanceof Agent){for(e=0;e<a[0].children.length;e++)if(a[0].children[e].id==
b)return a[0].children[e].setValue(a[2]),new Material(1);throw'MSG: Could not find referenced primitive for "SetValue()".';}throw'MSG: Invalid type for the first argument of "SetValue()".';});defineFunction("FindIndex",{params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,noUnits:!0}]},function(a){for(var b=a[0],c=0;c<b.length();c++)if(b.items[c].index+1==a[1].value)return b.items[c];throw"MSG: Index not found in population.";});
defineFunction("FindState",{params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},function(a){var b=a[0];if(!(a[1]instanceof State||"State"==a[1].dna.type))throw"MSG: FindState() requires a State primitive as its second argument.";for(var a=a[1].id,c=[],d=0;d<b.items.length;d++)-1<b.items[d].stateIDs.indexOf(a)&&c.push(b.items[d]);return new Vector(c)});
defineFunction("FindNotState",{params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},function(a){var b=a[0];if(!(a[1]instanceof State||"State"==a[1].dna.type))throw"MSG: FindState() requires a State primitive as its second argument.";for(var a=a[1].id,c=[],d=0;d<b.items.length;d++)-1==b.items[d].stateIDs.indexOf(a)&&c.push(b.items[d]);return new Vector(c)});
defineFunction("FindNearby",{params:[{needPopulation:!0,name:"[Agent Population]"},{needAgent:!0,name:"[Agent]"},{name:"Distance Limit",noVector:!0}]},function(a){for(var b=a[0],c=[],d=0;d<b.length();d++){var e=agent(b.items[d]);e.fullId!=a[1].fullId&&lessThanEq(distance(a[1],e),a[2])&&c.push(e)}return new Vector(c)});
defineFunction("FindNearest",{params:[{needPopulation:!0,name:"[Agent Population]"},{needAgent:!0,name:"[Agent]"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},function(a){var b=a[0],c=1;3==a.length&&(c=a[2].value);var d=[];b.items.forEach(function(b){b=agent(b);if(b.fullId!=a[1].fullId)d.push({distance:distance(a[1],b),item:b});else return null});if(d.length<c)throw"MSG: Can't find nearest "+c+" agents of a population of size "+d.length+".";if(1>c)throw"MSG: You must select at least one agent in FindNearest().";
for(var b=[d[0]],e=1;e<d.length;e++){for(var f=!1,g=0;g<b.length;g++)if(lessThan(d[e].distance,b[g].distance)){b.splice(g,0,d[e]);f=!0;break}!f&&b.length<c?b.push(d[e]):b.length>c&&(b.length=c)}return 1==b.length?b[0].item:new Vector(b.map(function(a){return a.item}))});
defineFunction("FindFurthest",{params:[{needPopulation:!0,name:"[Agent Population]"},{needAgent:!0,name:"[Agent]"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},function(a){var b=a[0],c=1;3==a.length&&(c=a[2].value);if(1>c)throw"MSG: You must select at least one agent in FindFurthest().";var d=[];b.items.forEach(function(b){b=agent(b);if(b.fullId!=a[1].fullId)d.push({distance:distance(a[1],b),item:b});else return null});if(d.length<c)throw"MSG: Can't find furthest "+c+" agents of a population of size "+
d.length+".";for(var b=[d[0]],e=1;e<d.length;e++){for(var f=!1,g=0;g<b.length;g++)if(greaterThan(d[e].distance,b[g].distance)){b.splice(g,0,d[e]);f=!0;break}!f&&b.length<c?b.push(d[e]):b.length>c&&(b.length=c)}return 1==b.length?b[0].item:new Vector(b.map(function(a){return a.item}))});function agent(a,b,c){if(a instanceof Agent)return a;if(a instanceof Primitive)return agent(a.parent,b,c);throw"MSG: An agent is required for '"+c+"' in the function "+b+".";}
function agents(a){if(a instanceof Agents)return a;if(a instanceof Primitive||a instanceof Agent)return agents(a.parent);throw"MSG: An agent population is required for '"+pName+"' in the function "+fnName+".";}defineFunction("Index",{params:[{noVector:!0,needAgent:!0,name:"[Agent]"}]},function(a){return new Material(sn("#e"+(a[0].index+1)))});
defineFunction("Connect",{params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[1]instanceof Vector?a[1].items.map(function(b){a[0].connect(b)}):a[0].connect(a[1]);return new Material(1)});defineFunction("Unconnect",{params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[1]instanceof Vector?a[1].items.map(function(b){a[0].unconnect(b)}):a[0].unconnect(a[1]);return new Material(1)});defineFunction("Connected",{params:[{needAgent:!0,name:"[Agent]"}]},function(a){return new Vector(a[0].connected.slice())});
functionBank.die=function(a){console.log(a);throw'MSG: Terminated using "die".';};functionBank.print=function(a){if(2==a.length)return console.log(a[0].value.toString()),console.log(a[1]),a[1];console.log(a[0]);return a[0]};defineFunction("Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},function(a){return a[0].geoWidth});defineFunction("Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},function(a){return a[0].geoHeight});
defineFunction("Distance",{params:[{name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[0]instanceof Vector||(a[0]=agent(a[0]));a[1]instanceof Vector||(a[1]=agent(a[1]));return distance(a[0],a[1])});var distanceCache={};
function distance(a,b){var c=a instanceof Vector?a:a.location,d=b instanceof Vector?b:b.location,e=c.items[0].toString()+","+c.items[1].toString(),f=d.items[0].toString()+","+d.items[1].toString();if(distanceCache[e+"-"+f])return distanceCache[e+"-"+f];if(distanceCache[f+"-"+e])return distanceCache[f+"-"+e];var g=minus(c.items[0],d.items[0]),c=minus(c.items[1],d.items[1]),d=null;a instanceof Vector?b instanceof Vector||(d=b.parent):d=a.parent;null!==d&&d.geoWrap&&(greaterThan(g,d.halfWidth)?g=minus(d.geoWidth,
g):lessThan(g,negate(d.halfWidth))&&(g=minus(g,negate(d.geoWidth))),greaterThan(c,d.halfHeight)?c=minus(d.geoHeight,c):lessThan(c,negate(d.halfHeight))&&(c=minus(c,negate(d.geoHeight))));var d=g.value,h=c.value;unitsEqual(g.units,c.units)||(h=fn["*"](h,convertUnits(g.units,c.units)));c=fn["real-part"](fn.sqrt(fn["+"](fn["*"](d,d),fn["*"](h,h))));c=new Material(c,g.units?g.units.clone():void 0);return distanceCache[e+f]=c}defineFunction("Location",{params:[{needAgent:!0,name:"[Primitive]"}]},function(a){return a[0].location});
defineFunction("Move",{params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},function(a){var b=a[1].toNum();shiftLocation(a[0],plus(a[0].location,b));return new Material(0)});
defineFunction("MoveTowards",{params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0}]},function(a){var b=a[0],c=a[1]instanceof Vector?a[1]:agent(a[1]).location,d=b.location,e=minus(c.items[0],d.items[0]),c=minus(c.items[1],d.items[1]);if(0==e.value&&0==c.value)return new Material(1);b.parent.geoWrap&&(greaterThan(e,b.parent.halfWidth)?e=minus(b.parent.geoWidth,e):lessThan(e,negate(b.parent.halfWidth))&&(e=minus(e,negate(b.parent.geoWidth))),greaterThan(c,b.parent.halfHeight)?
c=minus(b.parent.geoHeight,c):lessThan(c,negate(b.parent.halfHeight))&&(c=minus(c,negate(b.parent.geoHeight))));b=new Vector([e,c]);shiftLocation(a[0],plus(a[0].location,mult(b,div(a[2],distance(a[0],a[1]instanceof Vector?a[1]:agent(a[1]))))));return new Material(1)});
function shiftLocation(a,b){if(a.parent.geoWrap){for(;lessThan(b.items[0],new Material(0));)b.items[0]=plus(b.items[0],a.parent.geoWidth);for(;greaterThan(b.items[0],a.parent.geoWidth);)b.items[0]=minus(b.items[0],a.parent.geoWidth);for(;lessThan(b.items[1],new Material(0));)b.items[1]=plus(b.items[1],a.parent.geoHeight);for(;greaterThan(b.items[1],a.parent.geoHeight);)b.items[1]=minus(b.items[1],a.parent.geoHeight)}a.location=b}function isUndefined(a){return"undefined"==typeof a}
function isDefined(a){return!isUndefined(a)}function constraintAlert(a,b,c){b="The "+("max"==b?"maximum":"minimum")+" constraint on the primitive <b>"+clean(getName(findID(a.id)))+"</b> has been violated. The primitive's value attempted to become "+c.value+" when the "+("max"==b?"maximum":"minimum")+" allowed value is "+("max"==b?a.dna.maxConstraint:a.dna.minConstraint)+".";error(b,a,!1)}
function error(a,b,c){a={msg:a,primitive:b,showEditor:c};isLocal()&&(console.log("Error:"),console.log(a));throw a;}function testPrimitive(a,b,c){for(var d=0;d<c.length;d++)if(!(a[c[d]]instanceof Primitive))throw"MSG: "+b+"() requires a primitive reference to be passed to it as argument number "+(c[d]+1)+".";}function prepareDisplay(a){return a};function AggregateSeries(a,b){this.id=a;this.spacing=b;this.oldValues=[]}AggregateSeries.method("match",function(a){return this.id==a});
AggregateSeries.method("get",function(a){for(var b=0,b=0>this.spacing?0:0==this.spacing?Math.floor(div(minus(time,timeStart),timeStep).value):Math.floor(div(minus(time,timeStart),this.spacing.forceUnits(timeStart.units)).value);this.oldValues.length-1<b;)this.oldValues.push(evaluateNode(a.node,a.scope));return this.oldValues[b].fullClone?this.oldValues[b].fullClone():this.oldValues[b]});function DataBank(){this.dataSeries=[];this.names=[]}
DataBank.method("clone",function(){var a=new DataBank;a.dataSeries=this.dataSeries.slice(0);a.names=this.names.slice(0);return a});DataBank.method("getSeries",function(a){if(-1<this.names.indexOf(a))return this.dataSeries[this.names.indexOf(a)];this.names.push(a);a=a.split(":")[0];if("Smooth"==a||"ExpDelay"==a)return a=[],this.dataSeries.push(a),a});
DataBank.method("trimValues",function(a){for(var b=0;b<this.names.length;b++){var c=this.names[b],d=c.split(":")[0];"Smooth"==d?(c=this.getSeries(c),c.length-1>a&&c.splice(a+1,c.length-a+1)):"ExpDelay"==d&&(c=this.getSeries(c),c.length-1>a&&c.splice(a+1,c.length-a+1))}});function ExpGroup(a,b,c){this.stocks=[];this.k=b;for(b=1;b<=a;b++)this.stocks.push(c);this.out=c}
ExpGroup.method("moveForward",function(a){var b=new ExpGroup(this.stocks.length,this.k,new Material(0));b.out=this.stocks[this.stocks.length-1];for(var c=this.stocks.length-1;0<c;c--)b.stocks[c]=plus(mult(this.stocks[c],new Material(1-this.k)),mult(this.stocks[c-1],new Material(this.k)));b.stocks[0]=plus(mult(this.stocks[0],new Material(1-this.k)),mult(a,new Material(this.k)));return b});function Primitive(){this.equation=this.dna=this.parent=this.instanceId=this.fullId=this.index=this.agentId=this.id=null;this.pastValues=[];this.pastData=new DataBank;this.cutoff=0}Primitive.method("clone",function(){var a=new this.constructorFunction;a.dna=this.dna;a.parent=this.parent;a.agentId=this.agentId;a.index=this.index;a.id=this.id;a.createIds();a.pastValues=this.pastValues.slice(0);a.cutoff=this.cutoff;this.innerClone(a);return a});Primitive.method("toNum",function(){return this.value()});
Primitive.method("calculateValue",function(){throw"MSG: ["+this.dna.name+"] does not have a value and can not be used as a value in an equation.";});Primitive.method("createIds",function(){this.fullId=":"+this.id+"-"+this.agentId+"-"+this.index;this.instanceId=":"+this.agentId+"-"+this.index});Primitive.method("clearPastValues",function(a){this.pastValues.splice(this.pastValues.length-1-a,a);this.pastData.trimValues(this.pastValues.length-1)});
Primitive.method("getPastValues",function(a){var b=[];if(isUndefined(a))b=map(this.pastValues.slice(),function(a){return new Material(fn["real-part"](a.value),a.units?a.units.clone():void 0)});else for(var c=Math.ceil(div(a.forceUnits(timeStart.units),timeStep).value),a=this.pastValues.length-1;a>=Math.max(0,this.pastValues.length-1-c);a--)b.push(new Material(fn["real-part"](this.pastValues[a].value),this.pastValues[a].units?this.pastValues[a].units.clone():void 0));if(4==RKOrder){c=!0;for(a=0;a<
b.length;a++)if(c=!c)b.splice(a,1),a--}return b});
Primitive.method("pastValue",function(a,b){var c;c=this.pastValues.length-1<Math.round((time.value-timeStart.value)/timeStep.value)?div(a.forceUnits(timeStart.units),timeStep).value:div(a.forceUnits(timeStart.units),timeStep).value+1;if(0==c)return this.value();if(Math.ceil(c)>this.pastValues.length)return isUndefined(b)?0<this.pastValues.length?this.pastValues[0].fullClone():this.value():b;if(c==Math.round(c))return 0==c?value:this.pastValues[this.pastValues.length-c].fullClone();var d=c-Math.floor(c),
e=Math.floor(c);c=0==e?this.value():this.pastValues[this.pastValues.length-e];e=this.pastValues[this.pastValues.length-1-e];return plus(mult(c,new Material(1-d)),mult(e,new Material(d)))});
Primitive.method("smoothF",function(a,b){var c=div(timeStep,a.forceUnits(timeStart.units)).value,d=this.pastData.getSeries("Smooth: "+c+","+b);0==d.length&&(isUndefined(b)?(this.value(),d.push(this.pastValues[0])):d.push(b));for(var e=d.length;e<=Math.round((time.value-timeStart.value)/timeStep.value)-1;e++)d.push(plus(mult(d[e-1],new Material(1-c)),mult(new Material(c),this.pastValues[e])));return d[d.length-1].fullClone()});
Primitive.method("expDelayF",function(a,b,c){this.value();var d=div(timeStep,b.forceUnits(timeStart.units)).value*a,b=this.pastData.getSeries("ExpDelay: "+a+","+b.value+","+c);0==b.length&&(isUndefined(c)?b.push(new ExpGroup(a,d,this.pastValues[0])):(a=new ExpGroup(a,d,c),b.push(a.moveForward(this.pastValues[0]))));for(a=b.length;a<this.pastValues.length;a++)b.push(b[a-1].moveForward(this.pastValues[a]));return b[b.length-1].out.fullClone()});
Primitive.method("testUnits",function(a,b){if(unitless(this.dna.units)&&!(a instanceof Vector)&&!unitless(a.units))error("Wrong units generated for <i>"+clean(this.dna.name)+"</i>. Expected no units and got <i>"+clean(a.units.toString())+"</i>. Either specify units for the primitive or adjust the equation.",this,!0);else if(!unitless(this.dna.units)&&a instanceof Vector)error("Units error for <i>"+clean(this.dna.name)+"</i>. Expected <i>"+clean(this.dna.units.toString())+"</i> and the equation resulted in a vector.",
this,!0);else if(!unitsEqual(this.dna.units,a.units)){var c=convertUnits(a.units,this.dna.units,!0);if(0==c){isLocal()&&(console.log(a.units),console.log(this.dna.units));error("Wrong units generated for <i>"+clean(this.dna.name)+"</i>. Expected <i>"+clean(this.dna.units.toString())+"</i>, and got <i>"+clean(a.units.toString())+"</i>.",this,!0);return}a.value*=c;a.units=this.dna.units.clone()}this instanceof Flow&&!0!=b&&this.dna.flowUnitless&&(c=mult(a,new Material(1,timeLength.units.clone())),a.value=
c.value,a.units=c.units)});Primitive.method("setValue",function(){throw"MSG: You cannot set the value for that primitive.";});
Primitive.method("value",function(){if(this.pastValues.length-1<timeIndex){try{var a=this.calculateValue().toNum();if(a instanceof Material&&isNaN(a.value))throw"MSG: The result of this calculation is not a number (are you dividing by 0?).";}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!0):error(b,this,!0)}this instanceof State||(this.testUnits(a),this.testConstraints(a));this.pastValues.length-1<timeIndex-1&&(this.pastValues=[],this.cutoff=
timeIndex);this.pastValues.push(a)}return(a=this.pastValues[timeIndex-this.cutoff])&&a.fullClone?a.fullClone():a});Primitive.method("testConstraints",function(a){(1==this.dna.maxConstraintType&&a.value>this.dna.maxConstraint||2==this.dna.maxConstraintType&&a.value>=this.dna.maxConstraint)&&constraintAlert(this,"max",a);(1==this.dna.minConstraintType&&a.value<this.dna.minConstraint||2==this.dna.minConstraintType&&a.value<=this.dna.minConstraint)&&constraintAlert(this,"min",a)});
Primitive.method("setEquation",function(a,b){if(this instanceof Flow||this instanceof Transition)null!==this.omega&&(b.omega=this.omega),null!==this.alpha&&(b.alpha=this.alpha);try{this.equation=trimTree(a,b)}catch(c){isLocal()&&console.log(c),error(c.substr(4,c.length),this,!0)}});function Placeholder(a,b){this.dna=a;this.id=a.id;this.primitive=b}Placeholder.inherits(Primitive);
Placeholder.method("calculateValue",function(){error("["+clean(this.dna.name)+"] is a placeholder and cannot be used as a direct value in equations.",this.primitive,!0)});function State(){Primitive.call(this);this.oldArrivalTime=this.arrivalTime=this.oldActive=this.active=null;this.constructorFunction=State}State.inherits(Primitive);State.method("innerClone",function(a){a.active=this.active;a.oldActive=this.oldActive;a.arrivalTime=this.arrivalTime;a.oldArrivalTime=this.oldArrivalTime});
State.method("setValue",function(a){!1===this.active&&trueValue(a)&&(this.arrivalTime=time.fullClone());this.active=trueValue(a);this.value();this.clearPastValues(1);this.agentId&&this.parent.updateStates()});State.method("preserveActive",function(){this.oldActive=this.active;this.oldArrivalTime=this.arrivalTime});State.method("restoreActive",function(){this.active=this.oldActive;this.arrivalTime=this.oldArrivalTime;this.agentId&&this.parent.updateStates()});
State.method("calculateValue",function(){null===this.active&&this.setInitialActive();return this.active?new Material(1):new Material(0)});
State.method("setInitialActive",function(){var a;try{a=evaluateTree(this.equation,varBank).toNum()}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!0):error(b,this,!0)}a instanceof Vector&&error("Cannot set the initial active state to a vector.",this,!0);if(this.active=trueValue(a))this.arrivalTime=timeStart.fullClone();this.agentId&&this.parent.updateStates()});
State.method("getActive",function(){null===this.active&&this.setInitialActive();return this.active});function Transition(){Primitive.call(this);this.omega=this.alpha=null;this.oldBlock=this.block=!1;this.constructorFunction=Transition}Transition.inherits(Primitive);Transition.method("innerClone",function(){});Transition.method("setEnds",function(a,b){this.alpha=a;this.omega=b});Transition.method("preserveState",function(){this.oldBlock=this.block});
Transition.method("restoreState",function(){this.block=this.oldBlock});Transition.method("calculateValue",function(){var a=evaluateTree(this.equation,varBank).toNum();a instanceof Vector&&error("You cannot set the value of a transition to a vector.",this,!0);if(!0===a)return new Material(1);if(!1===a)return new Material(0);"Timeout"==this.dna.trigger&&unitless(a.units)&&(a.units=time.units.clone());return a});
Transition.method("transition",function(){if(!this.block&&(!this.alpha||this.alpha&&this.alpha.getActive())&&(!this.alpha||eq(timeStart,time)||!eq(this.alpha.arrivalTime,time)))if("Timeout"==this.dna.trigger){var a=this.value().toNum();this.alpha?greaterThanEq(minus(time,this.alpha.arrivalTime),a)&&this.doTransition():greaterThanEq(minus(time,timeStart),a)&&(this.block=!0,this.doTransition())}else"Condition"==this.dna.trigger?trueValue(this.value().toNum())&&this.doTransition():"Probability"==this.dna.trigger?
(a=this.value().toNum(),unitless(a.units)?greaterThanEq(a,new Material(1))?this.doTransition():lessThanEq(a,new Material(0))||Rand()<minus(new Material(1),power(minus(new Material(1),a),new Material(timeStep.value))).value&&this.doTransition():error("The probability for the trigger had units of "+this.value().units.toString()+". Probabilities must be unitless.",this,!0)):error("Unknown trigger: "+this.dna.trigger,this,!0);else this.value()});
Transition.method("doTransition",function(){this.alpha&&(this.alpha.active=!1,this.alpha.arrivalTime=null);this.omega&&(this.omega.active=!0,this.omega.arrivalTime=time.fullClone());this.agentId&&this.parent.updateStates()});function Action(){Primitive.call(this);this.timerStart=this.action=null;this.constructorFunction=Action}Action.inherits(Primitive);Action.method("innerClone",function(a){a.timerStart=this.timerStart});Action.method("resetTimer",function(){this.timerStart=time.fullClone()});
Action.method("test",function(){var a;try{a=evaluateTree(this.equation,varBank).toNum()}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!1):error(b,this,!1)}"Timeout"==this.dna.trigger?(unitless(a.units)&&(a.units=time.units.clone()),greaterThanEq(minus(time,this.timerStart),a)&&this.act()):"Condition"==this.dna.trigger?trueValue(a)&&this.act():"Probability"==this.dna.trigger?unitless(a.units)?greaterThanEq(a,new Material(1))?this.act():
lessThanEq(a,new Material(0))||Rand()<minus(new Material(1),power(minus(new Material(1),a),new Material(timeStep.value))).value&&this.act():error("The probability for the trigger had units of "+this.value().units.toString()+". Probabilities must be unitless.",this,!0):error("Unknown trigger: "+this.dna.trigger,this,!0)});
Action.method("act",function(){try{evaluateTree(this.action,varBank)}catch(a){if(!a.substr)throw a;isLocal()&&console.log(a);"MSG:"==a.substr(0,4)?error(a.substr(4,a.length),this,!0):error(a,this,!0)}});function Agents(){Primitive.call(this);this.DNAs=this.geoWrap=this.geoDimUnitsObject=this.geoDimUnits=this.halfHeight=this.halfWidth=this.geoHeight=this.geoWidth=this.agents=this.size=null;this.nextDie=[];this.nextCreate=[];this.stateIds=[];this.constructorFunction=Agents}Agents.inherits(Primitive);
Agents.method("collectData",function(){for(var a=[],b=0;b<this.agents.length;b++){var c=this.agents[b];a.push({id:c.id,instanceId:c.instanceId,connected:c.connected.map(function(a){return a.instanceId}),location:simpleNum(c.location.clone(),this.geoDimUnitsObject),state:0<c.states.length?c.states.slice():null})}return a});Agents.method("states",function(){return this.stateIds.slice(0)});
Agents.method("toNum",function(){throw"MSG: ["+clean(this.dna.name)+"] is a population of agents and cannot be used as a direct value in equations.";});
Agents.method("add",function(a){this.size=1+parseInt(this.size,10);if(a){a=a.agentClone();a.setIndex(this.size-1);a.createAgentIds();for(var b=0;b<this.DNAs.length;b++)a.children[b].parent=a,linkPrimitive(a.children[b],this.DNAs[b])}else{a=new Agent;a.parent=this;a.children=[];a.childrenId={};a.agentId=this.agentId;for(b=0;b<this.DNAs.length;b++)decodeDNA(this.DNAs[b],a);a.setIndex(this.size-1);a.createAgentIds();for(b=0;b<this.DNAs.length;b++)linkPrimitive(a.children[b],this.DNAs[b]);setAgentInitialValues(a);
var c=getPrimitiveNeighborhood(this,this.dna);"Custom Function"==this.placement?(c.self=a,a.location=simpleUnitsTest(simpleEquation(this.placementFunction,varBank,c),this.geoDimUnitsObject)):a.location=new Vector([mult(this.geoWidth,new Material(Rand())),mult(this.geoHeight,new Material(Rand()))]);if("Custom Function"==this.network)for(var d=trimTree(createTree(this.networkFunction),c),b=b+1;b<this.agents.length;b++)trueValue(simpleEquation(this.networkFunction,{"-parent":varBank,a:a,b:this.agents[b]},
c,d))&&a.connect(this.agents[b])}this.nextCreate.push(a);simulate.agentsChanged=!0});function Agent(){Primitive.call(this);this.location=this.children=this.index=null;this.connected=[];this.dead=!1;this.constructorFunction=Agent;this.stateIDs=[];this.states=[]}Agent.inherits(Primitive);Agent.method("toString",function(){return"Agent "+(this.index+1)});Agent.method("toNum",function(){return this});
Agent.method("updateStates",function(){this.states=[];this.stateIDs=[];for(var a=0;a<this.children.length;a++)this.children[a].active&&(this.states.push(this.children[a]),this.stateIDs.push(this.children[a].dna.id))});
Agent.method("agentClone",function(){var a=new Agent;a.dna=this.dna;a.children=[];a.childrenId={};for(var b=0;b<this.children.length;b++)a.children.push(this.children[b].clone()),a.childrenId[a.children[b].dna.id]=a.children[b];a.location=this.location.clone();a.connected=this.connected.slice(0);a.parent=this.parent;return a});Agent.method("setIndex",function(a){this.index=a;for(var b=0;b<this.children.length;b++)this.children[b].index=a});
Agent.method("createAgentIds",function(){this.createIds();for(var a=0;a<this.children.length;a++)this.children[a].createIds()});Agent.method("die",function(){for(;0<this.connected.length;)this.unconnect(this.connected[0]);for(var a=0;a<this.parent.agents.length;a++)if(this.parent.agents[a].fullId==this.fullId){this.parent.agents.splice(a,1);break}this.dead=!0;simulate.agentsChanged=!0});
Agent.method("connect",function(a){a.instanceId!=this.instanceId&&-1==indexOfID(this.connected,a.instanceId)&&(this.connected.push(a),a.connected.push(this))});Agent.method("unconnect",function(a){if(a.instanceId!=this.instanceId){var b=indexOfID(this.connected,a.instanceId);-1!=b&&(this.connected.splice(b,1),b=indexOfID(a.connected,this.instanceId),a.connected.splice(b,1))}});function indexOfID(a,b){for(var c=0;c<a.length;c++)if(a[c].instanceId==b)return c;return-1}
function Stock(){Primitive.call(this);this.level=[null];this.oldLevel=[];this.constructorFunction=Stock}Stock.inherits(Primitive);Stock.method("innerClone",function(a){a.level=this.level.slice(0);a.oldLevel=this.oldLevel.slice(0)});Stock.method("setValue",function(a){this.level[this.level.length-1]=a;this.value();this.clearPastValues(1)});
Stock.method("stepForward",function(){if(1<this.level.length)for(var a=this.level.length-1;0<a;a--)this.level[a]=plus(this.level[a],this.level[a-1]),this.level[a-1]=new Material(0,this.dna.units?this.dna.units.clone():void 0)});Stock.method("preserveLevels",function(){this.oldLevel=[];for(var a=0;a<this.level.length;a++)this.oldLevel.push(this.level[a])});Stock.method("restoreLevels",function(){this.level=[];for(var a=0;a<this.oldLevel.length;a++)this.level.push(this.oldLevel[a])});
Stock.method("setDelay",function(){this.setBuckets(this.dna.delay?Math.ceil(div(this.dna.delay,timeStep).value)+1:1)});Stock.method("setBuckets",function(a){this.level=[];for(var b=0;b<a;b++)this.level.push(new Material(0,this.dna.units?this.dna.units.clone():void 0))});
Stock.method("setInitialValue",function(){var a;try{a=evaluateTree(this.equation,varBank).toNum()}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!0):error(b,this,!0)}a instanceof Vector&&error("Cannot set the initial value of a stock to a vector.",this,!0);"boolean"==typeof a&&(a=a?new Material(1):new Material(0));this.dna.nonNegative&&0>a.value&&(a=new Material(0,this.dna.units?this.dna.units.clone():void 0));unitless(a.units)&&(a.units=
this.dna.units?this.dna.units.clone():void 0);a=[a];if(1==this.level.length)this.level=a;else{a=div(a[0],new Material(this.level.length-1));for(var c=1;c<this.level.length;c++)this.level[c]=a}});Stock.method("subtract",function(a){this.level[this.level.length-1]=minus(this.level[this.level.length-1],a);this.dna.nonNegative&&0>this.level[this.level.length-1].value&&(this.level[this.level.length-1]=new Material(0,this.dna.units?this.dna.units.clone():void 0))});
Stock.method("add",function(a){this.level[0]=plus(this.level[0],a);this.dna.nonNegative&&0>this.level[0].value&&(this.level[0]=new Material(0,this.dna.units?this.dna.units.clone():void 0))});Stock.method("totalContents",function(){for(var a=new Material(0,this.dna.units?this.dna.units.clone():void 0),b=0;b<this.level.length;b++)a=plus(a,this.level[b]);return a});
Stock.method("calculateValue",function(){null===this.level[0]&&this.setInitialValue();return 1<this.level.length&&4==RKOrder?plus(this.level[this.level.length-1],this.level[this.level.length-2]):this.level[this.level.length-1]});function Converter(){Primitive.call(this);this.source=null;this.constructorFunction=Converter}Converter.inherits(Primitive);Converter.method("innerClone",function(){});Converter.method("setSource",function(a){this.source=a});
Converter.method("getInputValue",function(){var a;"*time"==this.source?a=time:(a=this.source.value().toNum())||error("Undefined input value.",this,!1);return a});Converter.method("calculateValue",function(){return new Material(this.getOutputValue().value,this.dna.units?this.dna.units.clone():void 0)});
Converter.method("getOutputValue",function(){var a=this.getInputValue();if(0==this.dna.inputs.length)return new Material(0);for(var b=0;b<this.dna.inputs.length;b++)if("discrete"==this.dna.interpolation){if(greaterThan(this.dna.inputs[b],a))return 0==b?this.dna.outputs[0]:this.dna.outputs[b-1]}else if("linear"==this.dna.interpolation){if(eq(this.dna.inputs[b],a))return this.dna.outputs[b];if(greaterThan(this.dna.inputs[b],a))return 0==b?this.dna.outputs[0]:div(plus(mult(minus(a,this.dna.inputs[b-
1]),this.dna.outputs[b]),mult(minus(this.dna.inputs[b],a),this.dna.outputs[b-1])),minus(this.dna.inputs[b],this.dna.inputs[b-1]))}return this.dna.outputs[this.dna.outputs.length-1]});function Variable(){Primitive.call(this);this.constructorFunction=Variable}Variable.inherits(Primitive);Variable.method("innerClone",function(){});
Variable.method("calculateValue",function(){var a=evaluateTree(this.equation,varBank);if("boolean"==typeof a)a=a?new Material(1):new Material(0);else if(a instanceof Vector)return a;unitless(a.units)&&(a.units=this.dna.units?this.dna.units.clone():void 0);return a});function Flow(){Primitive.call(this);this.primaryRateScale=this.primaryRate=this.omega=this.alpha=null;this.RKPrimary=[];this.constructorFunction=Flow}Flow.inherits(Primitive);Flow.method("innerClone",function(){});
Flow.method("setEnds",function(a,b){this.alpha=a;this.omega=b});Flow.method("calculateValue",function(){this.predict();var a=this.primaryRateScaled.fullClone();return!this.dna.onlyPositive||0<=a.value?a:new Material(0,this.dna.units?this.dna.units.clone():void 0)});Flow.method("clean",function(){this.primaryRateScaled=this.primaryRate=null;this.RKPrimary=[]});
Flow.method("predict",function(){if(null===this.primaryRate){try{var a=evaluateTree(this.equation,varBank).toNum()}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!0):error(b,this,!0)}a instanceof Vector?error("Cannot set the value of a flow to a vector.",this,!0):"boolean"==typeof a&&(a=a?new Material(1):new Material(0));this.primaryRate=a.fullClone();unitless(this.primaryRate.units)&&(this.primaryRate.units=this.dna.units?this.dna.units.clone():
void 0);this.testUnits(this.primaryRate,!0);this.primaryRate=mult(this.primaryRate,timeStep);this.RKPrimary.push(this.primaryRate);this.primaryRateScaled=this.scaledPrimaryRate()}});
Flow.method("scaledPrimaryRate",function(){var a=null==this.primaryRate?null:this.primaryRate.fullClone();4==RKOrder&&(1==RKPosition?a=this.RKPrimary[0]:2==RKPosition?a=this.RKPrimary[1]:3==RKPosition?a=this.RKPrimary[2]:4==RKPosition&&(a=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[4]),new Material(6))));return a=div(a,timeStep)});
Flow.method("apply",function(){try{var a=this.primaryRateScaled.fullClone(),b=a=mult(a,timeStep),c=a;if(!1==this.dna.onlyPositive||0<=a.value){if(null!==this.omega&&this.omega.dna.nonNegative&&0>plus(this.omega.value().toNum(),c).value)var d=plus(this.omega.value().toNum(),c),c=minus(c,d),b=minus(b,d);null!==this.alpha&&this.alpha.dna.nonNegative&&0>minus(this.alpha.value().toNum(),b).value&&(d=minus(this.alpha.value().toNum(),b),c=plus(c,d),b=plus(b,d));null!==this.omega&&this.omega.dna.nonNegative&&
0>plus(this.omega.value().toNum(),c).value&&error("Inconsistent non-negative constraints for flow.",this,!1);null!==this.omega&&this.omega.add(c);null!==this.alpha&&this.alpha.subtract(b)}this.primaryRate=null}catch(e){if(!e.substr)throw e;"MSG:"==e.substr(0,4)?error(e.substr(4,e.length),this,!0):error(e,thi,!0)}});var timeStart,timeEnd,userTimeStep,time,timeStep,RKPosition,oldAggregateSeries,timeLength,timeIndex,doFullSpeed=!1,simulate=function(a,b,c){function d(a,b,c){var e=a.id+"-"+(b?b.id():"");if(e in d)return d[e];var f=1;c&&(f=(new Quantities(timeLength.units)).toBase);b=new Quantities(b);d[e]=fn["/"](fn["/"](sn("#e"+b.toBase),a.dna.toBase),sn("#e"+f));return d[e]}function e(a){a.results.Time.push(parseFloat(time.value.toPrecision(20)));for(var b=0;b<a.displayed.length;b++){var c=a.displayed[b];if(c instanceof
Agents)a.results[c.id].dataMode="agents",a.results[c.id].results.push({current:c.collectData()});else{var e=c.value();e instanceof Vector?(a.results[c.id].results.push(e),a.results[c.id].dataMode="auto"):(a.displayed[b].unitless&&!unitless(e.units)&&error("The result of the calculation has units "+e.units.toString()+", but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.",findID(c.id),!0),a.displayed[b]instanceof Flow&&!a.displayed[b].dna.flowUnitless&&
(e=mult(e,new Material(1,timeLength.units.clone()))),e=a.displayed[b]instanceof State||unitless(e.units)&&!c instanceof Flow?e.value:fn["*"](e.value,d(c,e.units,c instanceof Flow)),a.results[c.id].results.push(0+e))}}}var f=!1;if(isDefined(b)){f=!0;distanceCache={};simulate.model=a;simulate.agentsChanged=!1;simulate.config=b;simulate.callback=c;simulate.timeLengthNumber=div(a.timeLength,a.timeStep).value.toPrecision(21);simulate.timeCounter=0;simulate.results={Time:[]};simulate.displayed=[];simulate.displayInformation=
{ids:[]};a.submodels.base.agents[0].children.forEach(function(a){a instanceof Action||(simulate.displayInformation.ids.push(a.id),simulate.displayed.push(a))});for(var g=0;g<simulate.displayed.length;g++)a=simulate.displayed[g],c={},simulate.displayed[g]instanceof Agents&&(c.width=a.geoWidth,c.height=a.geoHeight,c.units=a.geoDimUnitsObject,c.states=a.states()),simulate.results[a.id]={data:c,results:[],dataMode:"float"};fillDataSeries(simulate)}else b=simulate.config;try{for(var h=(new Date).getTime();lessThanEq(time,
timeEnd);){timeIndex=Math.round((time.value-timeStart.value)/timeStep.value);RKPosition=1;if(!eq(time,timeStart)){if(simulate.agentsChanged){for(var k in submodels)if(k=submodels[k],"base"!=k.id){k.agents=k.agents.concat(k.nextCreate);k.nextCreate=[];for(g=0;g<k.nextDie.length;g++)k.nextDie[g].die();k.nextDie=[]}fillDataSeries(simulate);simulate.agentsChanged=!1}simulate.actions.forEach(function(a){a.test()})}simulate.flows.forEach(function(a){a.predict()});simulate.valued.forEach(function(a){a.value()});
for(RKPosition=1;RKPosition<RKOrder;RKPosition++){1!=RKPosition&&simulate.valued.forEach(function(a){a.value()});simulate.stocks.forEach(function(a){a.preserveLevels()});simulate.states.forEach(function(a){a.preserveActive()});simulate.transitions.forEach(function(a){a.preserveState()});var l=1;4==RKOrder&&3==RKPosition&&(l=2);for(var n=1;n<=l;n++)simulate.flows.forEach(function(a){a.apply()}),simulate.transitions.forEach(function(a){a.transition()}),simulate.stocks.forEach(function(a){a.stepForward()}),
time=plus(time,timeStep),timeIndex=Math.round((time.value-timeStart.value)/timeStep.value),2==l&&1==n&&simulate.valued.forEach(function(a){a.value()});RKPosition++;simulate.flows.forEach(function(a){a.primaryRate=null;a.predict()});RKPosition--;simulate.valued.forEach(function(a){a.value()});simulate.stocks.forEach(function(a){a.restoreLevels()});simulate.states.forEach(function(a){a.restoreActive()});simulate.transitions.forEach(function(a){a.restoreState()});4==RKOrder&&(3==RKPosition?simulate.valued.forEach(function(a){a.clearPastValues(3)}):
(1==RKPosition||2==RKPosition)&&simulate.valued.forEach(function(a){a.clearPastValues(2)}));time=plus(timeStart,mult(new Material(simulate.timeCounter),userTimeStep));timeIndex=Math.round((time.value-timeStart.value)/timeStep.value)}e(simulate);l=1;4==RKOrder&&(l=2);for(n=1;n<=l;n++)simulate.flows.forEach(function(a){a.apply();n==l&&a.clean()}),simulate.transitions.forEach(function(a){a.transition()}),simulate.stocks.forEach(function(a){a.stepForward()}),time=plus(time,timeStep),timeIndex=Math.round((time.value-
timeStart.value)/timeStep.value),2==l&&1==n&&simulate.valued.forEach(function(a){a.value()});simulate.timeCounter+=1;time=plus(timeStart,mult(userTimeStep,new Material(sn("#e"+simulate.timeCounter))));timeIndex=Math.round((time.value-timeStart.value)/timeStep.value);var o=(new Date).getTime()-h;if(!b.silent&&!doFullSpeed&&(!f&&600<o||0.12>simulate.timeCounter/simulate.timeLengthNumber&&200<o||1E3<o)){simulatorProgress.updateProgress(simulate.timeCounter/simulate.timeLengthNumber,"Current Time: "+
round(Math.min(timeEnd.value,time.value).toString(),12)+" "+time.units.names[0]);setTimeout(simulate,50);return}}}catch(p){if("STOP"!=p.msg)throw p;}if(b.silent)return simulate.results;simulatorProgress.close();simulate.callback(simulate.results,simulate.displayInformation,simulate.config)};
function fillDataSeries(a){var b=a.model.submodels;a.valued=[];a.actions=[];a.flows=[];a.stocks=[];a.states=[];a.transitions=[];for(var c in b){c=b[c];for(var d=0;d<c.agents.length;d++)if(!c.agents[d].dead)for(var e=0;e<c.agents[d].children.length;e++){var f=c.agents[d].children[e];f instanceof Action?a.actions.push(f):f instanceof Agents||(a.valued.push(f),f instanceof Flow?a.flows.push(f):f instanceof Stock?a.stocks.push(f):f instanceof State?a.states.push(f):f instanceof Transition&&a.transitions.push(f))}}}
;var simulatorProgress,strictUnits=null,submodels=null;function runSimulation(a){try{return innerRunSimulation(a)}catch(b){isLocal()&&console.log(b);isDefined(simulatorProgress)&&null!=simulatorProgress&&simulatorProgress.close();var c;c=b.msg?{error:b.msg,errorPrimitive:findID(b.primitive.id)}:{error:"Unknown model error.",errorPrimitive:null};if(a.onError)a.onError(c);if(a.silent)return c;handleErrorObject(b)}}var timeUnits=null;
function innerRunSimulation(a){allPlaceholders=[];var b={};submodels={base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}};var c=getSetting();strictUnits=isTrue(c.getAttribute("StrictUnits"));timeUnits=c.getAttribute("TimeUnits").toLowerCase();var d=new UnitStore([timeUnits],[1]);b.timeStep=new Material(sn("#i"+c.getAttribute("TimeStep")),d.clone());b.timeLength=new Material(sn("#i"+c.getAttribute("TimeLength")),d.clone());b.timeStart=new Material(sn("#i"+c.getAttribute("TimeStart")),
d.clone());b.RKOrder="RK4"==c.getAttribute("SolutionAlgorithm")?4:1;var e=c.getAttribute("Units");if(isDefined(e)){for(var f=c.getAttribute("Units").split("\n"),g=[],h=[],k=[],e=0;e<f.length;e++)d=f[e].split("<>"),""!=Ext.String.trim(d[2])&&(g.push(d[0]),h.push(d[1]),k.push(createUnitStore(d[2]).toStringShort()));loadUnits(g,k,h)}d=primitives();for(e=0;e<d.length;e++)if("Agents"==d[e].value.nodeName){var l=d[e],g=l.getAttribute("Agent");if(isUndefined(g))throw{msg:"You must select a base agent for <i>"+
clean(l.getAttribute("name"))+"</i>.",primitive:l,showEditor:!1};f=new Agents;f.dna=new DNA("Agents",l,g.id,l.getAttribute("name"));f.id=l.id;f.agentId=g;f.createIds();f.geoDimUnits=l.getAttribute("GeoDimUnits");f.geoDimUnitsObject=createUnitStore(l.getAttribute("GeoDimUnits"));f.geoWidth=simpleUnitsTest(simpleEquation(l.getAttribute("GeoWidth")),f.geoDimUnitsObject);f.geoHeight=simpleUnitsTest(simpleEquation(l.getAttribute("GeoHeight")),f.geoDimUnitsObject);f.halfWidth=div(f.geoWidth,new Material(2));
f.halfHeight=div(f.geoHeight,new Material(2));f.geoWrap=isTrue(l.getAttribute("GeoWrap"));f.placement=l.getAttribute("Placement");f.placementFunction=l.getAttribute("PlacementFunction");f.network=l.getAttribute("Network");f.networkFunction=l.getAttribute("NetworkFunction");h=getChildren(findID(g));f.DNAs=[];for(g=0;g<h.length;g++)modelType(h[g].value.nodeName)&&f.DNAs.push(getDNA(h[g])),"State"==h[g].value.nodeName&&f.stateIds.push(h[g].id);f.size=l.getAttribute("Size");f.agents=[];f.dna.agents=f;
submodels[l.id]=f;submodels.base.DNAs.push(f.dna)}else inAgent(d[e])||modelType(d[e].value.nodeName)&&submodels.base.DNAs.push(getDNA(d[e]));for(var n in submodels){n=submodels[n];for(g=0;g<n.size;g++){d=new Agent;"base"==n.id?d=n.agents[0]:(d.parent=n,d.index=g,d.children=[],d.childrenId={},d.agentId=l.id,d.createIds(),n.agents.push(d));for(e=0;e<n.DNAs.length;e++)decodeDNA(n.DNAs[e],d)}}oldAggregateSeries=[];timeStart=b.timeStart;timeLength=b.timeLength;timeEnd=plus(timeStart,timeLength);timeStep=
userTimeStep=b.timeStep;time=timeStart;timeIndex=0;RKOrder=b.RKOrder;RKPosition=1;PreviousRandLists=[];lastRandPos=RandLoc=-1;timeIndex=Math.round((time.value-timeStart.value)/timeStep.value);4==RKOrder&&(timeStep=div(timeStep,new Material(2)));for(n in submodels){n=submodels[n];for(g=0;g<n.size;g++)for(e=0;e<n.DNAs.length;e++)linkPrimitive(n.agents[g].children[e],n.DNAs[e])}if(isDefined(c.getAttribute("Macros")))try{evaluateMacros(c.getAttribute("Macros"))}catch(o){throw showMacros(),a="An error with the macros prevented the simulation from running.",
o.msg?a=a+"<br/><br/>"+o.msg:"MSG:"==o.toString().substr(0,4)&&(a=a+"<br/><br/>"+o.toString().substr(4)),{msg:a};}for(n in submodels){n=submodels[n];for(g=0;g<n.size;g++)setAgentInitialValues(n.agents[g])}for(n in submodels)if("base"!=n){try{buildNetwork(submodels[n])}catch(p){throw isLocal()&&console.log(p),a="An error with the custom network function prevented the simulation from running.",p.msg?a=a+"<br/><br/>"+p.msg:"MSG:"==p.toString().substr(0,4)&&(a=a+"<br/><br/>"+p.toString().substr(4)),{msg:a,
primitive:submodels[n].cell,showEditor:!1};}try{buildPlacements(submodels[n])}catch(r){throw isLocal()&&console.log(r),a="An error with the agent placement function prevented the simulation from running.",r.msg?a=a+"<br/><br/>"+r.msg:"MSG:"==r.toString().substr(0,4)&&(a=a+"<br/><br/>"+r.toString().substr(4)),{msg:a,primitive:submodels[n].cell,showEditor:!1};}}b.submodels=submodels;if(a.silent){n=formatSimResults(simulate(b,a));if(a.onSuccess)a.onSuccess(n);return n}simulatorProgress=Ext.MessageBox.show({msg:"Processing Model...",
icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0});simulate(b,a,finishSim)}function formatSimResults(a){a.error="none";a.errorPrimitive=null;a.names={};for(var b=submodels.base.agents[0].children,c=0;c<b.length;c++)a.names[b[c].name]=b[c].id;a.value=function(a){return this[a.id].results};a.lastValue=function(a){return this[a.id].results[this[a.id].results.length-1]};a.periods=a.Time.length;a.times=a.Time;return a}
function createUnitStore(a){return""==a.trim()||"unitless"==a.trim().toLowerCase()?void 0:simpleEquation("{1 "+a+"}").units}function simpleEquation(a,b,c,d){b||(b={});c||(c={});d||(d=trimTree(createTree(a),c));return evaluateTree(d,b)}
function simpleNum(a,b){if(a instanceof Vector)return new Vector(a.items.map(function(a){return simpleNum(a,b)}));if(unitless(b)&&!unitless(a.units))throw"The result of the calculation has units "+a.units.toString()+", but the no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.";if(unitless(a.units))return 0+a.value;var c=new Quantities(a.units),d=new Quantities(b);return 0+fn["*"](a.value,fn["/"](sn("#e"+c.toBase),d.toBase))}
function simpleUnitsTest(a,b){if(a instanceof Vector)return new Vector(a.items.map(function(a){return simpleUnitsTest(a,b)}));if(unitless(a.units)&&unitless(b))return a;if(unitless(a.units))return a.units=b,a;if(unitsEqual(a.units,b))return a;var c=convertUnits(a.units,b,!0);if(0==c)throw isLocal()&&(console.log(a.units),console.log(b)),"MSG: Wrong units generated. Expected <i>"+clean(this.units.toString())+"</i>, and got <i>"+clean(m.units.toString())+"</i>.";a.value*=c;a.units=b;return a}
function tally(a){var b={"null":0},c;a.sort();for(var d=0;d<a.length;d++)null==a[d]?b["null"]+=1:a[d]!==c?b[a[d].toString()]=1:b[c.toString()]+=1,c=a[d];return b}
function aggregateAgentSeries(a){var b=a.results.map(function(b){var c=[];b.current.forEach(function(a){c=c.concat(a.state?a.state.map(function(a){return a.id.toString()}):[])});var f=tally(c);a.data.states.forEach(function(a){isUndefined(f[a.toString()])&&(f[a.toString()]=0)});return f}),c={};a.data.states.forEach(function(a){c[a.toString()]=[];b.forEach(function(b){c[a.toString()].push(b[a.toString()])})});return c}
function finishSim(a,b,c){for(var d=[],e=[],f={},g=[],h=[],k=[],l=[],n=[],o=0;o<b.ids.length;o++){var p=b.ids[o],r=findID(p);h.push(p);k.push(getName(r));if("Agents"==r.value.nodeName){var s=aggregateAgentSeries(a[p]);f[p.toString()]={id:p,item:r,data:a[p].data,results:a[p].results,aggregate:s};for(var u in s)r=findID(u),d.push(p),e.push(getName(r)),l.push(getLineColor(r)),g.push(u),"float"==a[p].dataMode?n.push(commaStr):"agents"==a[p].dataMode?n.push(function(){return"Agent Population"}):n.push(void 0)}else d.push(p),
e.push(getName(r)),l.push(getLineColor(r)),g.push(!1),"float"==a[p].dataMode?n.push(commaStr):n.push(void 0)}b.colors=l;b.ids=d;b.headers=e;b.agents=f;b.displayedHeaders=k;b.displayedIds=h;b.renderers=n;b.res=a;b.times=a.Time;h=[];for(k=0;k<a.Time.length;k++){h.push({});h[k].Time=k;h[k].TimeValue=a.Time[k];for(o=0;o<d.length;o++)h[k]["series"+o]=g[o]?f[d[o].toString()].aggregate[g[o].toString()][k]:a[d[o]].results[k]}f=[{type:"float",name:"Time"},{type:"float",name:"TimeValue"}];for(o=0;o<e.length;o++)f.push({type:a[d[o]].dataMode,
name:"series"+o});d=new Ext.data.Store({fields:f,data:h});b.store=d;b=createResultsWindow(b);c.onSuccess&&(a=formatSimResults(a),a.window=b,c.onSuccess(a))}function handleErrorObject(a){simulatorProgress&&simulatorProgress.close();isLocal()&&console.log(a);if(a.msg){if(isDefined(a.primitive)){var b=findID(a.primitive.id);highlight(b);a.showEditor&&showEditor(b)}mxUtils.alert(a.msg)}else a.error&&mxUtils.alert(a)}function evaluateMacros(a){evaluateTree(trimTree(createTree(a),{}),varBank)}
function DNA(a,b,c,d){this.type=a;this.cell=b;this.id=c;this.name=d;this.units=null}
function getDNA(a){var b=a.value.nodeName,c=new DNA(b,a,a.id,a.getAttribute("name"));if("Flow"==b||"Transition"==b)null!==a.target&&(c.targetId=orig(a.target).id),null!==a.source&&(c.sourceId=orig(a.source).id);if("Converter"==b)c.value=getValue(a);else try{c.value=createTree(getValue(a))}catch(d){isLocal()&&(console.log(this),console.log(eq),console.log(neighborhood),console.log(d)),error("The primitive <i>"+clean(c.name)+"</i> has an equation error that must be corrected before the model can be run.",
a,!0)}if("Action"==b){c.trigger=a.getAttribute("Trigger");try{c.triggerValue=createTree(a.getAttribute("Value"))}catch(e){error("The trigger for <i>"+clean(c.name)+"</i> has an equation error that must be corrected before the model can be run.",c.cell,!1)}}else if("Transition"==b)c.trigger=a.getAttribute("Trigger");else if("Stock"==b){if(c.nonNegative=isTrue(a.getAttribute("NonNegative")),"Conveyor"==a.getAttribute("StockMode")){c.stockType="Conveyor";try{c.delay=evaluateTree(trimTree(createTree(a.getAttribute("Delay")),
{})),unitless(c.delay.units)&&(c.delay.units=new UnitStore([timeUnits],[1]))}catch(f){throw isLocal()&&console.log(f),{msg:"Invalid conveyor delay.",primitive:a,showEditor:!1};}}}else if("Flow"==b)c.onlyPositive=isTrue(a.getAttribute("OnlyPositive"));else if("Converter"==b){c.source=a.getAttribute("Source");c.interpolation="Linear"==a.getAttribute("Interpolation")?"linear":"discrete";var g=a.getAttribute("Data").split(";"),h=[],k=[],l;l="Time"==c.source?new UnitStore([timeUnits],[1]):createUnitStore(orig(findID(c.source)).getAttribute("Units"));
for(var n=0;n<g.length;n++){var o=g[n].split(",");h.push(new Material(sn(Ext.String.trim(o[0])),l?l.clone():void 0));k.push(new Material(sn(Ext.String.trim(o[1]))))}c.inputs=h;c.outputs=k}if("State"!=b){if("Transition"!=b&&"Action"!=b){g=a.getAttribute("Units");try{"Flow"!=b||""!=g.trim()&&"unitless"!=g.trim().toLowerCase()?c.units=createUnitStore(g):(c.units=new UnitStore([timeUnits],[-1]),c.flowUnitless=!0)}catch(p){throw isLocal()&&console.log(p),{msg:'Invalid units specified for primitive: "'+
clean(g)+'".',primitive:a,showEditor:!0};}}else"Timeout"==c.trigger&&(c.units=new UnitStore([timeUnits],[1]));c.maxConstraint=a.getAttribute("MaxConstraint");c.maxConstraintType=isTrue(a.getAttribute("MaxConstraintUsed"))?1:null;c.minConstraint=a.getAttribute("MinConstraint");c.minConstraintType=isTrue(a.getAttribute("MinConstraintUsed"))?1:null}c.toBase=c.units?(new Quantities(c.units)).toBase:1;c.unitless=!c.units||unitless(c.units);return c}
function decodeDNA(a,b){var c=a.type,d;"Variable"==c?d=new Variable:"State"==c?d=new State:"Transition"==c?d=new Transition:"Action"==c?d=new Action:"Stock"==c?d=new Stock:"Flow"==c?d=new Flow:"Converter"==c&&(d=new Converter);d?(d.dna=a,d.id=a.id,d.index=b.index,d.agentId=b.agentId,d.parent=b,d.createIds(),b.children.push(d),b.childrenId[d.id]=d):"Agents"==c&&(b.children.push(a.agents),b.childrenId[a.id]=a)}
function linkPrimitive(a,b){var c=b.type;if("Agents"!=c){var d=getPrimitiveNeighborhood(a,b);if("Flow"==c||"Transition"==c){var e=null,f=null;d.alpha&&(e=d.alpha);d.omega&&(f=d.omega);a.setEnds(e,f)}if("Action"==c){try{a.equation=trimTree(b.triggerValue,d)}catch(g){error("The trigger for <i>"+clean(b.name)+"</i> has an equation error that must be corrected before the model can be run.",b.cell,!1)}try{a.action=trimTree(b.value,d)}catch(h){error("The primitive <i>"+clean(b.name)+"</i> has an equation error that must be corrected before the model can be run.",
b.cell,!0)}a.resetTimer()}else if("Converter"==c)if("Time"==b.source)a.setSource("*time");else{var c=orig(findID(b.source)).id,k;for(k in d)if(c==d[k].id){a.setSource(d[k]);break}}else a.setEquation(b.value,d)}}
function setAgentInitialValues(a){for(var b=0;b<a.children.length;b++)if(a.children[b]instanceof Stock){a.children[b].setDelay();try{a.children[b].setInitialValue()}catch(c){if(isLocal()&&console.log(c),c instanceof String)error(c.substr(4,c.length),a.children[b],!0);else throw c;}}else if(a.children[b]instanceof State)try{null===a.children[b].active&&a.children[b].setInitialActive()}catch(d){if(isLocal()&&console.log(d),d instanceof String)error(d.substr(4,d.length),a.children[b],!0);else throw d;
}}function buildNetwork(a){if("Custom Function"==a.network)for(var b=getPrimitiveNeighborhood(a,a.dna),c=trimTree(createTree(a.networkFunction),b),d=0;d<a.agents.length-1;d++)for(var e=d+1;e<a.agents.length;e++)trueValue(simpleEquation(a.networkFunction,{"-parent":varBank,a:a.agents[d],b:a.agents[e]},b,c))&&a.agents[d].connect(a.agents[e]);else if("None"!=a.network)throw{msg:"Unknown network type: "+a.network+".",primitive:a.cell,showEditor:!1};}
function buildPlacements(a){var b,c,d;if("Random"==a.placement)a.agents.forEach(function(b){b.location=new Vector([mult(a.geoWidth,new Material(Rand())),mult(a.geoHeight,new Material(Rand()))])});else if("Custom Function"==a.placement)a.agents.forEach(function(b){var c=getPrimitiveNeighborhood(a,a.dna);c.self=b;b.location=simpleUnitsTest(simpleEquation(a.placementFunction,varBank,c),a.geoDimUnitsObject)});else if("Grid"==a.placement){b=trimTree(createTree("<<x*width(agent), y*height(agent)>>"),{});
var e=a.agents.length,f=simpleNum(simpleEquation("width(agent)/height(agent)",{agent:a},{}),a.geoDimUnitsObject);d=Math.sqrt(e/f);c=Math.floor(d*f);d=Math.ceil(d);!d*c>=e&&(c+=1);var g=0;a.agents.forEach(function(e){var f=(Math.floor(g/c)+0.5)/d;e.location=simpleUnitsTest(simpleEquation("<<x*width(agent), y*height(agent)>>",{agent:e,x:new Material((g%c+0.5)/c),y:new Material(f)},{},b),a.geoDimUnitsObject);g++})}else if("Ellipse"==a.placement)b=trimTree(createTree("<<width(agent), height(agent)>>/2+<<sin(index(agent)/size*2*3.14159), cos(index(agent)/size*2*3.14159)>>*<<width(agent), height(agent)>>/2"),
{}),e=new Material(a.agents.length),a.agents.forEach(function(c){c.location=simpleUnitsTest(simpleEquation("<<width(agent), height(agent)>>/2+<<sin(index(agent)/size*2*3.14159), cos(index(agent)/size*2*3.14159)>>*<<width(agent), heigh(agent)>>/2",{agent:c,size:e},{},b),a.geoDimUnitsObject)});else if("Network"==a.placement){b=trimTree(createTree("<<x*width(agent), y*height(agent)>>"),{});var h=new Graph,k=a.agents.map(function(a){return h.newNode({data:a})}),l=function(a){for(var b=0;b<k.length;b++)if(k[b].data.data.fullId==
a.fullId)return k[b];return null};a.agents.forEach(function(a){a.connected.forEach(function(b){h.newEdge(l(a),l(b))})});for(var f=new Layout.ForceDirected(h,400,600,0.5),n=0;30>n;n++)f.applyCoulombsLaw(),f.applyHookesLaw(),f.attractToCentre(),f.updateVelocity(0.03),f.updatePosition(0.03);var o=f.getBoundingBox();o.width=o.topright.x-o.bottomleft.x;o.height=o.topright.y-o.bottomleft.y;f.eachNode(function(c,d){var e=(d.p.y-o.bottomleft.y)/o.height;c.data.data.location=simpleUnitsTest(simpleEquation("<<x*width(agent), y*height(agent)>>",
{agent:a,x:new Material((d.p.x-o.bottomleft.x)/o.width),y:new Material(e)},{},b),a.geoDimUnitsObject)})}else throw{msg:"Unknown placement type: "+a.placement+".",primitive:a.cell,showEditor:!1};}var allPlaceholders={};
function getPrimitiveNeighborhood(a,b){var c=neighborhood(b.cell),d=allPlaceholders[b.id]?allPlaceholders[b.id]:{},e={self:a};if(!c.placeholders&&"Agents"==b.type)for(var f=0;f<a.DNAs.length;f++)d[a.DNAs[f].name.toLowerCase()]=new Placeholder(a.DNAs[f],a);for(var g=0;g<c.length;g++){var h=c[g].item;if("Agents"==h.value.nodeName){if(e[submodels[h.id].dna.name.toLowerCase()]=submodels[h.id],!c.placeholders)for(f=0;f<submodels[h.id].DNAs.length;f++)e[submodels[h.id].DNAs[f].name.toLowerCase()]=new Placeholder(submodels[h.id].DNAs[f],
a)}else{f=!1;if(a.parent&&a.parent.childrenId[h.id]){var k=a.parent.childrenId[h.id].dna.name.toLowerCase();e[k]=a.parent.childrenId[h.id];f=!0}!f&&submodels.base.agents[0].childrenId[h.id]&&(k=submodels.base.agents[0].childrenId[h.id].dna.name.toLowerCase(),e[k]=submodels.base.agents[0].childrenId[h.id]);if("Flow"==b.type||"Transition"==b.type)e[k]&&(b.targetId==e[k].id?e.omega=e[k]:b.sourceId==e[k].id&&(e.alpha=e[k]))}}c=Object.keys(d);for(f=0;f<c.length;f++)e[c[f]]=d[c[f]];allPlaceholders[b.id]=
d;return e}function modelType(a){return!("Link"==a||"Picture"==a||"Text"==a||"Button"==a||"Folder"==a||"Setting"==a||"Display"==a||"Ghost"==a)};
